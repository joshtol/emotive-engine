<!DOCTYPE html>
<html>
<head>
    <title>Undertone Debug</title>
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 20px;
        }
        canvas {
            border: 1px solid #0f0;
            display: block;
            margin: 20px 0;
        }
        button {
            margin: 5px;
            padding: 10px;
            background: #111;
            color: #0f0;
            border: 1px solid #0f0;
            cursor: pointer;
        }
        button:hover {
            background: #222;
        }
        #log {
            height: 200px;
            overflow-y: scroll;
            border: 1px solid #0f0;
            padding: 10px;
            margin-top: 20px;
            white-space: pre;
        }
    </style>
</head>
<body>
    <h1>Undertone Debugging</h1>
    <canvas id="emotiveCanvas" width="800" height="600"></canvas>
    
    <div>
        <button onclick="setUndertone('nervous')">Nervous</button>
        <button onclick="setUndertone('confident')">Confident</button>
        <button onclick="setUndertone('tired')">Tired</button>
        <button onclick="setUndertone(null)">Clear Undertone</button>
        <button onclick="rapidSwitch()">Rapid Switch (Doppler!)</button>
    </div>
    
    <div id="log"></div>

    <script type="module">
        import EmotiveMascot from './src/EmotiveMascot.js';
        
        const canvas = document.getElementById('emotiveCanvas');
        const log = document.getElementById('log');
        
        // Override console.log to capture output
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog(...args);
            const msg = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            log.textContent = msg + '\n' + log.textContent;
            log.textContent = log.textContent.substring(0, 10000); // Limit log size
        };
        
        const mascot = new EmotiveMascot(canvas);
        window.mascot = mascot;
        
        // Monkey patch to debug (commented out to prevent console spam)
        // const originalApplyMods = mascot.renderer.applyUndertoneModifiers;
        // mascot.renderer.applyUndertoneModifiers = function(undertone) {
        //     console.log('applyUndertoneModifiers called with:', undertone);
        //     const result = originalApplyMods.call(this, undertone);
        //     console.log('state.sizeMultiplier after:', this.state.sizeMultiplier);
        //     return result;
        // };
        
        window.setUndertone = function(undertone) {
            const currentEmotion = mascot.getCurrentState().emotion;
            console.log(`Setting undertone: ${undertone} on emotion: ${currentEmotion}`);
            mascot.setEmotion(currentEmotion, undertone);
        };
        
        window.rapidSwitch = async function() {
            console.log('Starting rapid switch sequence...');
            const undertones = ['nervous', 'confident', 'tired', 'subdued', 'intense'];
            for (let i = 0; i < 10; i++) {
                const undertone = undertones[i % undertones.length];
                mascot.setEmotion('neutral', undertone);
                await new Promise(r => setTimeout(r, 100));
            }
            console.log('Rapid switch complete - doppler effect achieved!');
        };
        
        mascot.setEmotion('neutral');
        mascot.start();
    </script>
</body>
</html>