@tailwind base;
@tailwind components;
@tailwind utilities;

/* Single Dark Theme - Brand Consistent */
:root{
  /* Brand Color Palette - Primary */
  --brand-primary: #DD4A9A;        /* Magenta Majesty - Main accent */
  --brand-secondary: #4090CE;       /* Smooth Azure - Secondary accent */
  --brand-tertiary: #32ACE2;       /* Supple Blue - Tertiary accent */
  --brand-accent: #84CFC5;         /* Eye Tea Green - Accent color */
  
  /* Brand Neutrals */
  --brand-black: #0E0E0E;          /* Flex Tape - Pure black */
  --brand-white: #F2F1F1;          /* Not Paper - Off-white */
  
  /* Dark Theme Color System */
  --bg-primary: #1a1a1a;           /* Main background */
  --bg-secondary: #2a2a2a;         /* Secondary background */
  --bg-tertiary: #333333;          /* Tertiary background */
  --bg-overlay: rgba(14, 14, 14, 0.95); /* Overlay backgrounds */
  
  /* Text Colors */
  --text-primary: #F2F1F1;         /* Primary text */
  --text-secondary: #B8B8B8;       /* Secondary text */
  --text-tertiary: #888888;        /* Tertiary text */
  --text-muted: #666666;           /* Muted text */
  
  /* Interactive Colors */
  --accent-primary: var(--brand-primary);    /* Main accent */
  --accent-secondary: var(--brand-secondary); /* Secondary accent */
  --accent-tertiary: var(--brand-tertiary);   /* Tertiary accent */
  --accent-success: var(--brand-accent);      /* Success/accent */
  
  /* Border Colors */
  --border-primary: rgba(221, 74, 154, 0.3);   /* Primary borders */
  --border-secondary: rgba(64, 144, 206, 0.2); /* Secondary borders */
  --border-muted: rgba(242, 241, 241, 0.1);    /* Muted borders */
  
  /* Button Colors */
  --button-primary: var(--brand-primary);
  --button-primary-hover: rgba(221, 74, 154, 0.8);
  --button-secondary: rgba(64, 144, 206, 0.2);
  --button-secondary-hover: rgba(64, 144, 206, 0.3);
  --button-bg: rgba(0, 0, 0, 0.4);
  --button-bg-hover: rgba(221, 74, 154, 0.1);
  --button-bg-active: rgba(221, 74, 154, 0.2);
  
  /* System Colors */
  --header-bg: rgba(26, 26, 26, 0.95);
  --canvas-bg: rgba(0, 0, 0, 0.3);
  --system-bar-bg: rgba(0, 0, 0, 0.7);
  --panel-bg: transparent;
  
  /* Gradient Overlays */
  --gradient-primary: linear-gradient(135deg, rgba(221, 74, 154, 0.1) 0%, rgba(64, 144, 206, 0.05) 100%);
  --gradient-secondary: linear-gradient(45deg, rgba(50, 172, 226, 0.08) 0%, rgba(132, 207, 197, 0.06) 100%);
  --gradient-accent: linear-gradient(180deg, rgba(221, 74, 154, 0.12) 0%, transparent 50%, rgba(64, 144, 206, 0.08) 100%);
  --gradient-subtle: linear-gradient(90deg, rgba(242, 241, 241, 0.02) 0%, rgba(221, 74, 154, 0.03) 50%, rgba(242, 241, 241, 0.02) 100%);
  --gradient-overlay: linear-gradient(135deg, rgba(14, 14, 14, 0.4) 0%, rgba(26, 26, 26, 0.2) 100%);
  
  /* Enhanced Glow Effects */
  --glow-primary: rgba(221, 74, 154, 0.4);
  --glow-secondary: rgba(64, 144, 206, 0.3);
  --glow-accent: rgba(132, 207, 197, 0.3);
  --glow-subtle: rgba(221, 74, 154, 0.15);
  --glow-intense: rgba(221, 74, 154, 0.6);
  
  /* px → vp @1920×1080 helpers */
  --vp-0_3px: min(0.016vw, 0.028vh);
  --vp-0_5px: min(0.026vw, 0.046vh);
  --vp-0_8px: min(0.042vw, 0.074vh);
  --vp-1px:   min(0.052vw, 0.093vh);
  --vp-1_6px: min(0.083vw, 0.148vh);
  --vp-2px:   min(0.104vw, 0.185vh);
  --vp-4px:   min(0.208vw, 0.370vh);
  --vp-5px:   min(0.260vw, 0.463vh);
  --vp-6px:   min(0.313vw, 0.556vh);
  --vp-8px:   min(0.417vw, 0.741vh);
  --vp-10px:  min(0.521vw, 0.926vh);
  --vp-12px:  min(0.625vw, 1.111vh);
  --vp-15px:  min(0.781vw, 1.389vh);
  --vp-16px:  min(0.833vw, 1.481vh);
  --vp-20px:  min(1.042vw, 1.852vh);
  --vp-24px:  min(1.250vw, 2.222vh);
  --vp-28px:  min(1.458vw, 2.593vh);
  --vp-30px:  min(1.563vw, 2.778vh);
  --vp-32px:  min(1.667vw, 2.963vh);
  --vp-40px:  min(2.083vw, 3.704vh);
  --vp-42px:  min(2.188vw, 3.889vh);
  --vp-50px:  min(2.604vw, 4.630vh);
  --vp-52px:  min(2.708vw, 4.815vh);
  --vp-160px: min(8.333vw, 14.815vh);

  /* Typography families */
  --font-primary: 'Poppins', sans-serif;
  --font-heading: 'Montserrat', sans-serif;

  /* Font sizes (rem → vp approximations) */
  --text-xs:   min(0.542vw, 0.963vh);
  --text-sm:   min(0.625vw, 1.111vh);
  --text-base: min(0.708vw, 1.259vh);
  --text-md:   min(0.833vw, 1.481vh);
  --text-lg:   min(1.000vw, 1.778vh);
  --text-xl:   var(--vp-24px);
  --text-2xl:  var(--vp-32px);

  /* Calculated font sizes */
  --text-xl-plus-1:   calc(var(--text-xl) + var(--vp-1_6px));
  --text-xl-plus-2:   calc(var(--text-xl) + min(0.167vw, 0.296vh));
  --text-xl-plus-3:   calc(var(--text-xl) + min(0.250vw, 0.444vh));
  --text-2xl-plus-2:  calc(var(--text-2xl) + min(0.167vw, 0.296vh));
  --text-md-plus-1:   calc(var(--text-md) + var(--vp-1_6px));
  --text-sm-plus:     calc(var(--text-sm) + var(--vp-0_8px));
  --text-base-plus:   calc(var(--text-base) + var(--vp-0_8px));

  /* Weights */
  --font-light: 300; --font-normal: 400; --font-medium: 500; --font-semibold: 600; --font-bold: 700;

  /* Radii */
  --radius-sm:  var(--vp-2px);
  --radius-base:var(--vp-4px);
  --radius-md:  var(--vp-6px);
  --radius-lg:  var(--vp-8px);
  --radius-xl:  var(--vp-15px);
  --radius-round: 50%;

  /* Spacing */
  --spacing-xs:   var(--vp-2px);
  --spacing-sm:   var(--vp-4px);
  --spacing-base: var(--vp-8px);
  --spacing-md:   var(--vp-10px);
  --spacing-lg:   var(--vp-16px);
  --spacing-xl:   var(--vp-20px);

  /* Typography families - Premium Apple Style */
  --font-primary: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-heading: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  /* Font sizes - Responsive Apple Style */
  --text-xs: clamp(0.75rem, 1.2vw, 0.875rem);
  --text-sm: clamp(0.875rem, 1.4vw, 1rem);
  --text-base: clamp(1rem, 1.6vw, 1.125rem);
  --text-lg: clamp(1.125rem, 1.8vw, 1.25rem);
  --text-xl: clamp(1.25rem, 2vw, 1.5rem);
  --text-2xl: clamp(1.5rem, 2.4vw, 1.875rem);
  --text-3xl: clamp(1.875rem, 3vw, 2.25rem);
  --text-4xl: clamp(2.25rem, 3.6vw, 3rem);

  /* Font weights - Heavy Premium */
  --font-light: 300;
  --font-normal: 400;
  --font-medium: 500;
  --font-semibold: 600;
  --font-bold: 700;
  --font-extrabold: 800;
  --font-black: 900;

  /* Letter spacing - Apple Style */
  --spacing-letter-tight: -0.025em;
  --spacing-letter-normal: 0;
  --spacing-letter-wide: 0.025em;
  --spacing-letter-wider: 0.05em;
  --spacing-letter-widest: 0.1em;

  /* Line heights - Apple Style */
  --line-height-tight: 1.25;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.625;
  --line-height-loose: 2;

  /* Shadows and borders */
  --border-thin:   var(--vp-1px) solid var(--border-color);
  --border-medium: var(--vp-2px) solid var(--border-color);
  --border-accent: var(--vp-2px) solid var(--accent-primary);

  --shadow-sm:    0 var(--vp-1px)  var(--vp-2px)  rgba(0,0,0,0.4);
  --shadow-base:  0 var(--vp-2px)  var(--vp-4px)  rgba(0,0,0,0.3);
  --shadow-md:    0 var(--vp-2px)  var(--vp-8px)  rgba(0,0,0,0.3);
  --shadow-lg:    0 var(--vp-2px)  var(--vp-10px) rgba(0,0,0,0.05);
  --shadow-xl:    0 var(--vp-2px)  var(--vp-20px) rgba(0,0,0,0.5);
  --shadow-2xl:   0 var(--vp-4px)  var(--vp-12px) rgba(0,0,0,0.4);
  --shadow-inset: inset 0 var(--vp-2px) var(--vp-4px) rgba(0,0,0,0.5);

  /* Colors (dark theme defaults) */
  --bg-grid: rgba(242, 241, 241, 0.05);
  --border-color: var(--border-primary);
  --system-btn-bg: var(--button-bg);
  --system-btn-hover: var(--button-bg-hover);

  /* Opacity helpers */
  --opacity-20: 0.2; --opacity-33: 0.33; --opacity-60: 0.6; --opacity-80: 0.8;

  /* Glow helpers for keyframes */
  --glow-cyan-20: rgba(221, 74, 154, 0.2);
  --glow-cyan-40: rgba(221, 74, 154, 0.4);
  --glow-cyan-60: rgba(221, 74, 154, 0.6);
  /* Dynamic heading scales */
  --heading-xl: min(2.4vw, 4.2vh);
  --heading-lg: min(1.9vw, 3.4vh);
  --heading-md: min(1.3vw, 2.4vh);
  --heading-sm: min(0.9vw, 1.8vh);
}

html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
body { 
  background: var(--bg-primary); 
  background-image:
    linear-gradient(rgba(221, 74, 154, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(221, 74, 154, 0.05) 1px, transparent 1px);
  background-size: 25px 25px;
  color: var(--text-primary); 
  font-family: var(--font-primary), sans-serif; 
}
* { box-sizing: border-box; }

/* Theme variables */
:root[data-theme='dark'] { 
  --panel: var(--bg-secondary); 
  --canvas: var(--bg-primary); 
  --header: var(--header-bg); 
}

:root[data-theme='light'] { 
  --panel: #e5e7eb; 
  --canvas: #f3f4f6; 
  --header: #ffffff; 
}

:root[data-theme='night'] { 
  --panel: var(--bg-tertiary); 
  --canvas: var(--brand-black); 
  --header: var(--bg-overlay); 
}

/* Single Dark Theme Body */
body {
  background: var(--bg-primary);
  background-image:
    var(--gradient-subtle),
    linear-gradient(rgba(221, 74, 154, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(221, 74, 154, 0.05) 1px, transparent 1px);
  background-size: 100% 100%, 25px 25px, 25px 25px;
  color: var(--text-primary);
}

/* Container */
.emotive-container { 
  height: 100vh; 
  width: 100vw; 
  display: grid; 
  grid-template-rows: 8vh 1fr 5vh; 
  grid-template-areas: 'header' 'main' 'footer'; 
  min-width: 0; 
  contain: layout style paint;
}
.emotive-header { 
  grid-area: header; 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  padding: calc(0.5vh + 0.2vw) calc(1vw + 0.5vh); 
  background: var(--header-bg);
  background-image: var(--gradient-overlay);
  border-bottom: 1px solid var(--border-primary);
  contain: layout style paint;
}

/* Header System Controls */
.header-system-controls {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  flex: 1;
  margin: 0 2rem;
}

.header-system-controls .system-controls-bar {
  position: relative;
  top: auto;
  left: auto;
  transform: none;
  width: auto;
  max-width: none;
  gap: 0.5rem;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-end;
}

.header-system-controls .system-controls-bar .sci-fi-btn {
  width: 3vh;
  height: 3vh;
  min-width: auto;
  min-height: auto;
  flex-shrink: 0;
}

.header-system-controls .system-controls-bar .controls-container {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-end;
  gap: 0.5rem;
}

/* General controls container - always horizontal */
.controls-container {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-end;
  gap: 0.5rem;
  position: relative;
}

/* Three-dot menu button */
.system-controls-bar .sci-fi-btn.menu {
  position: relative;
  z-index: 10;
  transition: all 0.2s ease;
}

.system-controls-bar .sci-fi-btn.menu:hover {
  background: rgba(0, 229, 255, 0.1);
  border-color: rgba(0, 229, 255, 0.3);
}

.system-controls-bar .sci-fi-btn.menu.expanded {
  background: rgba(0, 229, 255, 0.2);
  border-color: rgba(0, 229, 255, 0.4);
  box-shadow: 0 0 10px rgba(0, 229, 255, 0.3);
}

/* Expanded menu container - completely redesigned */
.expanded-menu {
  position: absolute;
  right: 100%;
  top: 50%;
  transform: translateY(-50%) translateX(20px);
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.75rem;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(20, 20, 20, 0.95));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border-radius: 25px;
  padding: 0.75rem 1rem 0.75rem 0.75rem;
  margin-right: 0.75rem;
  opacity: 0;
  visibility: hidden;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  pointer-events: none;
  z-index: 5;
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.expanded-menu.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(-50%) translateX(0);
  pointer-events: auto;
}

.expanded-menu .sci-fi-btn {
  width: 2.5vh;
  height: 2.5vh;
  min-width: auto;
  min-height: auto;
  transition: all 0.2s ease;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.expanded-menu .sci-fi-btn:hover {
  background: rgba(0, 229, 255, 0.15);
  border-color: rgba(0, 229, 255, 0.3);
  transform: scale(1.05);
  box-shadow: 0 0 8px rgba(0, 229, 255, 0.2);
}

.expanded-menu .sci-fi-btn:active {
  transform: scale(0.95);
}

.expanded-menu .sci-fi-btn.active {
  background: rgba(0, 229, 255, 0.2);
  border-color: rgba(0, 229, 255, 0.4);
  box-shadow: 0 0 12px rgba(0, 229, 255, 0.3);
}

.expanded-menu .sci-fi-btn.active:hover {
  background: rgba(0, 229, 255, 0.25);
  border-color: rgba(0, 229, 255, 0.5);
  box-shadow: 0 0 15px rgba(0, 229, 255, 0.4);
}
.emotive-logo { 
  display: flex; 
  align-items: center; 
  gap: calc(0.3vw + 0.2vh); 
}

.emotive-logo-svg {
  height: min(4vh, 3vw);
  width: auto;
  filter: invert(1) brightness(1);
}

/* Theme toggle - dynamic scaling with 1:1 aspect ratio */
.theme-toggle-button {
  width: calc(2/3 * min(8vh, max(5vh, 4vh + 0.5vw)));
  height: calc(2/3 * min(8vh, max(5vh, 4vh + 0.5vw)));
  aspect-ratio: 1;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.theme-toggle-button:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  transform: scale(1.05);
}

.theme-icon {
  width: 60%;
  height: 60%;
  filter: brightness(1.1) contrast(1.1);
}

/* Auth section - Screenshot Style */
.auth-pill {
  display: flex;
  align-items: center;
  gap: calc(0.8vw + 0.4vh);
  padding: calc(0.4vh + 0.3vw) calc(1.2vw + 0.6vh);
  background: transparent;
  border: none;
  border-radius: calc(2vh + 1vw);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  height: calc(2/3 * min(8vh, max(5vh, 4vh + 0.5vw)));
}

.auth-signin-btn {
  font-size: clamp(10px, 1.2vw, 14px);
  font-weight: 600;
  color: var(--text-primary);
  background: var(--button-primary);
  background-image: linear-gradient(135deg, var(--button-primary) 0%, var(--button-primary-hover) 100%);
  border: 1px solid var(--button-primary);
  border-radius: calc(1vh + 0.5vw);
  padding: calc(0.3vh + 0.2vw) calc(0.8vw + 0.5vh);
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  box-shadow: 
    0 2px 4px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.2),
    inset 0 -1px 0 rgba(0, 0, 0, 0.1);
}

.auth-signin-btn:hover {
  background: var(--button-primary-hover);
  border-color: var(--button-primary-hover);
  transform: translateY(-1px);
  box-shadow: 
    0 4px 8px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.25),
    inset 0 -1px 0 rgba(0, 0, 0, 0.15);
}


/* Header Typography */
.emotive-logo-svg { height: clamp(28px, 4vh, 42px); width:auto; filter: invert(1) brightness(1) contrast(1.1); drop-shadow: 0 0 8px rgba(255,107,53,.3); }

/* Global utilities (visuals only) */
/* Focus visible */
:focus-visible { outline: var(--vp-2px) solid var(--accent-primary); outline-offset: var(--vp-2px); }
:focus { outline: none; }

/* Selection */
::selection, ::-moz-selection { background: var(--accent-primary); color: var(--bg-primary); }

/* Scrollbars */
::-webkit-scrollbar { width: var(--vp-8px); height: var(--vp-8px); }
::-webkit-scrollbar-track { background: var(--button-bg); }
::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: var(--radius-base); }
::-webkit-scrollbar-thumb:hover { background: var(--accent-primary); }
.emotive-sidebar, .emotive-controls { scrollbar-width: thin; scrollbar-color: var(--border-color) var(--button-bg); }

/* Input number spinners (hide) */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
input[type="number"] { -moz-appearance: textfield; }

/* Keyframes (vp units) */
@keyframes pulse {
  0%,100% { opacity: var(--opacity-80); transform: scale(1); box-shadow: 0 0 var(--vp-10px) var(--accent-glow); }
  50% { opacity: 1; transform: scale(1.02); }
}
@keyframes subtle-glow { 0%,100% { background-color: var(--accent-primary); } 50% { background-color: var(--accent-glow); } }
@keyframes subtle-glow-cyan {
  0%,100% { color: var(--accent-primary); text-shadow: 0 0 var(--vp-5px) var(--accent-glow); }
  50% { color: var(--accent-glow); text-shadow: 0 0 var(--vp-8px) var(--accent-glow); }
}
@keyframes rotate-cw { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes rotate-ccw { from { transform: rotate(0deg); } to { transform: rotate(-360deg); } }
@keyframes rotate-centered { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
@keyframes beatPulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0; } 100% { transform: scale(2); opacity: 0; } }
@keyframes pulse-recording { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }
@keyframes pending-pulse { 0%,100% { opacity: 0.6; } 50% { opacity: 1; } }
@keyframes trigger-flash { 0% { transform: scale(1); } 50% { transform: scale(1.05); box-shadow: 0 0 var(--vp-20px) var(--vp-5px) rgba(0,255,100,0.6);} 100% { transform: scale(1);} }
@keyframes pneumatic-extend { 0% { transform: translateY(calc(-1 * var(--vp-60px))); } 90% { transform: translateY(var(--vp-2px)); } 100% { transform: translateY(0); } }
@keyframes pneumatic-retract { 0% { transform: translateY(0); } 10% { transform: translateY(var(--vp-1px)); } 100% { transform: translateY(calc(-1 * var(--vp-60px))); } }
@keyframes tooltip-activate { 0% { transform: translateX(-50%) scale(1); box-shadow: 0 0 var(--vp-20px) var(--glow-cyan-20);} 50% { transform: translateX(-50%) scale(1.1); box-shadow:0 0 var(--vp-40px) var(--glow-cyan-60);} 100% { transform: translateX(-50%) scale(1); box-shadow:0 0 var(--vp-30px) var(--glow-cyan-40);} }
@keyframes tooltip-activate-warm { 0% { transform: translateX(-50%) scale(1); box-shadow:0 0 var(--vp-20px) rgba(204,102,51,0.2);} 50% { transform: translateX(-50%) scale(1.1); box-shadow:0 0 var(--vp-40px) rgba(204,102,51,0.6);} 100% { transform: translateX(-50%) scale(1); box-shadow:0 0 var(--vp-30px) rgba(204,102,51,0.4);} }
@keyframes brake-pulse { 0% { box-shadow:0 0 0 0 currentColor; } 50% { box-shadow:0 0 var(--vp-20px) var(--vp-5px) currentColor; opacity: var(--opacity-80);} 100% { box-shadow:0 0 0 0 currentColor; opacity:1; } }


.emotive-sidebar { 
  grid-area: sidebar; 
  overflow-y:auto; 
  overflow-x:hidden; 
  padding:2.0vh 1.8vw; 
  min-width: 0;
  /* Grid/button sizing variables (vp only) */
  --cols: 3; /* default columns */
  --gap: 1.0vh; /* grid gap */
  --pad: max(1.4vh, 1.2vw); /* button horizontal padding */
  background: var(--sidebar-bg);
  contain: layout style paint;
}
.emotive-controls { 
  grid-area: controls; 
  overflow-y:auto; 
  overflow-x:hidden; 
  padding:2.0vh 1.8vw; 
  min-width: 0;
  /* same variables mirrored on right */
  --cols: 3;
  --gap: 1.0vh;
  --pad: max(1.4vh, 1.2vw);
  background: var(--sidebar-bg);
  contain: layout style paint;
}


.emotive-footer { 
  grid-area: footer; 
  contain: layout style paint;
}
.emotive-main { 
  grid-area: main; 
  display: grid; 
  grid-template-columns: 25vw 1fr 25vw; 
  grid-template-areas: 'sidebar canvas controls'; 
  min-width: 0; 
  position: relative;
  contain: layout style paint;
}

.canvas-container {
  grid-area: canvas;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  position: relative;
  min-width: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  contain: layout style paint;
}

.game-canvas-area { 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  padding: 0 calc(100vw * 0.5 / 9 / 2); 
  position: relative; 
  background: var(--canvas-bg);
  background-image: var(--gradient-accent);
  overflow: hidden;
  contain: layout style paint;
  isolation: isolate;
  aspect-ratio: 1;
  width: min(calc(100vw - 50vw), calc(100vh - 8vh - 5vh));
  height: min(calc(100vw - 50vw), calc(100vh - 8vh - 5vh));
  flex-shrink: 0;
}

/* Engine Canvas */
#emotive-canvas {
  width: 100%;
  height: 100%;
  will-change: transform;
  transform: translateZ(0);
  image-rendering: optimizeSpeed;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
  display: block;
}

/* Performance Monitoring */
.fps-display {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.7);
  color: #00ff00;
  padding: 5px 10px;
  font-family: monospace;
  font-size: 12px;
  border-radius: 3px;
  z-index: 1000;
  display: none;
}

/* State columns */
.state-column { position:absolute; top:50%; transform:translateY(-50%); display:flex; flex-direction:column; z-index:5; }
.state-column-left { left: 2%; }
.state-column-right { right: 2%; }
.state-icon { 
  width: min(calc(100vw * 0.5 / 9), calc(100vh - 8vh - 8vh - calc(100vw * 0.5 / 9)) / 5); 
  height: min(calc(100vw * 0.5 / 9), calc(100vh - 8vh - 8vh - calc(100vw * 0.5 / 9)) / 5); 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  background:transparent; 
  border-radius:50%; 
  cursor: pointer; 
  transition: transform 0.2s ease, background-color 0.2s ease;
  will-change: transform;
  transform: translateZ(0);
}
.state-icon:hover { background: rgba(255, 255, 255, 0.1); transform: scale(1.05); }
.state-icon:active { background: rgba(255, 255, 255, 0.2); transform: scale(0.95); }
.state-icon-svg { width:90%; height:90%; }

/* Dual Shape Selector Bars */
.shape-selector-bar { 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  gap: 2vw;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  z-index: 30;
}

.shape-selector-bar-top {
  top: 5%;
}

.shape-selector-bar-bottom {
  bottom: 5%;
}

.shape-selector-inside { position:absolute; left:calc(100vw * 0.5 / 9 / 2); bottom:0; right:calc(100vw * 0.5 / 9 / 2); z-index:20; height: calc(100vw * 0.5 / 9); }
.shape-selector-outside { position:absolute; left:calc(100vw * 0.5 / 9 / 2); bottom:0; right:calc(100vw * 0.5 / 9 / 2); z-index:20; height: calc(100vw * 0.5 / 9); }
.shape-selector-button { 
  width: 4vw; 
  height: 4vw;
  min-width: 3vw;
  max-width: 5vw;
  aspect-ratio: 1; 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  border-radius: 0.8vh; 
  background: var(--button-bg);
  background-image: var(--gradient-primary);
  border: 1px solid var(--border-muted); 
  box-shadow: inset 0 0 var(--vp-5px) rgba(255,255,255,0.06), 0 0 var(--vp-10px) rgba(0,0,0,0.35); 
  transition: all 0.18s ease; 
  box-sizing: border-box;
  will-change: transform;
  transform: translateZ(0);
}
.shape-selector-button:hover { 
  background: var(--button-bg-hover);
  background-image: var(--gradient-secondary);
  box-shadow: inset 0 0 var(--vp-8px) rgba(255,255,255,0.08), 0 0 var(--vp-15px) var(--glow-subtle); 
  transform: translateY(var(--vp-1px)); 
  border-color: var(--border-primary); 
}
.shape-selector-button[aria-pressed="true"], .shape-selector-button.active, .shape-selector-button:focus-visible { 
  background: var(--button-bg-active);
  background-image: var(--gradient-primary);
  box-shadow: 0 0 var(--vp-25px) var(--glow-intense), inset 0 0 var(--vp-12px) var(--button-bg-active); 
  border-color: var(--button-primary); 
  outline: none; 
}
.shape-selector-icon { width: 60%; height: 60%; display:block; filter: brightness(0) invert(1) opacity(0.7); transition: opacity 0.18s ease; will-change: opacity; }
.shape-selector-button:hover .shape-selector-icon { opacity: 1; }
.shape-selector-button[aria-pressed="true"] .shape-selector-icon, .shape-selector-button.active .shape-selector-icon, .shape-selector-button:focus-visible .shape-selector-icon { opacity: 1; }

/* System Controls Bar - Glass Morphism Sci-Fi Premium */
.system-controls-bar { 
  position: absolute; 
  top: 2%; 
  left: 50%; 
  transform: translateX(-50%); 
  display: flex; 
  flex-direction: row;
  align-items: center; 
  justify-content: center;
  gap: 1vw; 
  z-index: 20; 
  padding: 0; 
  background: transparent; 
  border: none; 
  backdrop-filter: none; 
  -webkit-backdrop-filter: none; 
  box-shadow: none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  width: 60%;
  max-width: 60%;
}


/* System bar buttons - Glass Morphism */
.system-controls-bar .sci-fi-btn { 
  width: 4vh; 
  height: 4vh;
  min-width: auto; 
  min-height: auto; 
  padding: 0; 
  border-radius: 50%; 
  background: rgba(255, 255, 255, 0.08); 
  border: 1px solid rgba(255, 255, 255, 0.15); 
  color: rgba(255, 255, 255, 0.9); 
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 -1px 0 rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  font-weight: normal;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
  aspect-ratio: 1;
}

.system-controls-bar .sci-fi-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.05) 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.system-controls-bar .sci-fi-btn:hover { 
  background: rgba(255, 255, 255, 0.12); 
  border-color: rgba(255, 255, 255, 0.25); 
  box-shadow: 
    0 6px 20px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(255, 255, 255, 0.08);
  transform: translateY(-2px) scale(1.05);
}

.system-controls-bar .sci-fi-btn:hover::before {
  opacity: 1;
}

.system-controls-bar .sci-fi-btn.active, 
.system-controls-bar .sci-fi-btn:focus-visible { 
  background: rgba(0, 200, 255, 0.2); 
  border-color: rgba(0, 200, 255, 0.4); 
  box-shadow: 
    0 0 24px rgba(0, 200, 255, 0.4),
    0 4px 16px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.2),
    inset 0 -1px 0 rgba(0, 200, 255, 0.1);
  outline: none;
  transform: scale(1.1);
}

.system-control-icon { 
  width: 2.4vh; 
  height: 2.4vh; 
  display: block; 
  margin: 0 auto; 
  filter: brightness(1.1) contrast(1.1);
  transition: all 0.3s ease;
}

.system-controls-bar .sci-fi-btn:hover .system-control-icon {
  filter: brightness(1.3) contrast(1.2);
}

/* Light theme - Glass Morphism */
.light .system-controls-bar { 
  background: rgba(255, 255, 255, 0.15); 
  border-color: rgba(0, 0, 0, 0.1); 
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.3),
    inset 0 -1px 0 rgba(0, 0, 0, 0.05);
}

.light .system-controls-bar:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(0, 0, 0, 0.15);
  box-shadow: 
    0 12px 40px rgba(0, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.4),
    inset 0 -1px 0 rgba(0, 0, 0, 0.08);
}

.light .system-controls-bar .sci-fi-btn {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(0, 0, 0, 0.08);
  color: rgba(0, 0, 0, 0.8);
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.4),
    inset 0 -1px 0 rgba(0, 0, 0, 0.05);
}

.light .system-controls-bar .sci-fi-btn::before {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, transparent 50%, rgba(0, 0, 0, 0.05) 100%);
}

.light .system-controls-bar .sci-fi-btn:hover {
  background: rgba(255, 255, 255, 0.25);
  border-color: rgba(0, 0, 0, 0.12);
  box-shadow: 
    0 6px 20px rgba(0, 0, 0, 0.12),
    inset 0 1px 0 rgba(255, 255, 255, 0.5),
    inset 0 -1px 0 rgba(0, 0, 0, 0.08);
}

.light .system-controls-bar .sci-fi-btn.active,
.light .system-controls-bar .sci-fi-btn:focus-visible {
  background: rgba(0, 122, 204, 0.15);
  border-color: rgba(0, 122, 204, 0.3);
  box-shadow: 
    0 0 24px rgba(0, 122, 204, 0.3),
    0 4px 16px rgba(0, 0, 0, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.4),
    inset 0 -1px 0 rgba(0, 122, 204, 0.1);
}

.light .system-control-icon { 
  filter: brightness(0.9) contrast(1.1);
}

/* Night theme - Blue Blocking Glass Morphism */
.night .system-controls-bar { 
  background: rgba(10, 20, 40, 0.2); 
  border-color: rgba(100, 150, 255, 0.3); 
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.4),
    0 0 20px rgba(100, 150, 255, 0.1),
    inset 0 1px 0 rgba(150, 200, 255, 0.1),
    inset 0 -1px 0 rgba(50, 100, 200, 0.1);
}

.night .system-controls-bar:hover {
  background: rgba(10, 20, 40, 0.25);
  border-color: rgba(100, 150, 255, 0.4);
  box-shadow: 
    0 12px 40px rgba(0, 0, 0, 0.5),
    0 0 30px rgba(100, 150, 255, 0.15),
    inset 0 1px 0 rgba(150, 200, 255, 0.15),
    inset 0 -1px 0 rgba(50, 100, 200, 0.15);
}

.night .system-controls-bar .sci-fi-btn {
  background: rgba(50, 100, 200, 0.1);
  border-color: rgba(100, 150, 255, 0.2);
  color: rgba(200, 220, 255, 0.9);
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.3),
    0 0 8px rgba(100, 150, 255, 0.1),
    inset 0 1px 0 rgba(150, 200, 255, 0.1),
    inset 0 -1px 0 rgba(50, 100, 200, 0.1);
}

.night .system-controls-bar .sci-fi-btn::before {
  background: linear-gradient(135deg, rgba(150, 200, 255, 0.1) 0%, transparent 50%, rgba(100, 150, 255, 0.05) 100%);
}

.night .system-controls-bar .sci-fi-btn:hover {
  background: rgba(50, 100, 200, 0.15);
  border-color: rgba(100, 150, 255, 0.3);
  box-shadow: 
    0 6px 20px rgba(0, 0, 0, 0.4),
    0 0 12px rgba(100, 150, 255, 0.15),
    inset 0 1px 0 rgba(150, 200, 255, 0.15),
    inset 0 -1px 0 rgba(50, 100, 200, 0.15);
}

.night .system-controls-bar .sci-fi-btn.active,
.night .system-controls-bar .sci-fi-btn:focus-visible {
  background: rgba(100, 150, 255, 0.2);
  border-color: rgba(150, 200, 255, 0.4);
  box-shadow: 
    0 0 24px rgba(100, 150, 255, 0.4),
    0 4px 16px rgba(0, 0, 0, 0.4),
    0 0 16px rgba(150, 200, 255, 0.2),
    inset 0 1px 0 rgba(200, 220, 255, 0.2),
    inset 0 -1px 0 rgba(100, 150, 255, 0.1);
}

.night .system-control-icon { 
  filter: brightness(1.2) contrast(1.1) hue-rotate(200deg) saturate(1.3);
}

/* Buttons and grids */
.button-grid { 
  --btn-aspect: 3 / 1; 
  display: grid; 
  gap: var(--gap); 
  grid-auto-rows: minmax(0, auto); /* Allow rows to size based on content */
  grid-template-columns: repeat(var(--cols), 1fr); 
  width: 100%; 
  min-width: 0; 
  height: auto; /* Let grid size itself */
  contain: layout style;
}

/* Responsive grid columns purely by viewport */
@media (max-width: 100vh), (max-width: 900px) {
  .emotive-sidebar, .emotive-controls { --cols: 2; }
  .button-grid { --btn-aspect: 2.6 / 1; }
}
@media (max-width: 70vh), (max-width: 640px) {
  .emotive-sidebar, .emotive-controls { --cols: 1; }
  .button-grid { --btn-aspect: 2.2 / 1; }
}
.button-grid-3 { grid-template-columns: repeat(3, 1fr); }
.button-grid-2 { grid-template-columns: repeat(2, 1fr); }
.button-grid-1 { grid-template-columns: 1fr; }

/* Match exact image styling with proper spacing and centering */
h2.section-header {
  font-family: var(--font-heading);
  font-size: calc(0.8vw + 0.6vh);
  font-weight: var(--font-normal);
  letter-spacing: var(--spacing-letter-normal);
  line-height: var(--line-height-normal);
  text-transform: uppercase;
  color: var(--text-white);
  margin-bottom: 0.25rem;
  border-bottom: none;
  padding-bottom: 0;
  text-decoration: none;
  text-align: center;
}


/* Button styling to match the EXACT image colors and weights */
.sci-fi-btn {
  background: var(--button-bg);
  color: var(--text-white);
  border: 1px solid var(--border-light);
  border-radius: 4px;
  padding: calc(6px + 0.3vh);
  font-family: 'Poppins', sans-serif;
  font-size: clamp(min(0.8vw, 1.2vh), 1.5vh, max(1.2vw, 1.6vh));
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  line-height: 1.2;
  transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
  will-change: transform;
  transform: translateZ(0);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  aspect-ratio: var(--btn-aspect, 3 / 1);
  min-height: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  box-shadow: 
    0 2px 4px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 -1px 0 rgba(0, 0, 0, 0.2);
}

.sci-fi-btn.active,
.sci-fi-btn:focus-visible,
.sci-fi-btn[aria-pressed="true"] {
  background: var(--button-active-bg);
  color: var(--text-white);
  border: 1px solid var(--button-active-bg);
  box-shadow: 
    0 0 8px rgba(255, 152, 0, 0.4),
    0 2px 4px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.2),
    inset 0 -1px 0 rgba(255, 152, 0, 0.2);
  font-weight: 500;
}

.sci-fi-btn:hover {
  background: #554a4a;
  border-color: #777777;
  box-shadow: 
    0 4px 8px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.25);
}



.status-text {
  position: absolute;
  font-family: var(--font-primary);
  font-size: clamp(0.8rem, 1.2vw, 1.2rem);
  font-weight: var(--font-normal);
  letter-spacing: var(--spacing-letter-normal);
  line-height: var(--line-height-normal);
  color: var(--text-primary);
}

.status-text.emotion {
  position: absolute;
  top: 5%;
  left: 10%;
  width: 3vw;
  height: 3vw;
  min-width: 2.5vw;
  max-width: 4vw;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.2);
  background-image: linear-gradient(135deg, rgba(221, 74, 154, 0.05) 0%, rgba(64, 144, 206, 0.03) 100%);
  border-radius: 50%;
  white-space: nowrap;
  font-size: clamp(0.6rem, 0.8vw, 0.9rem);
  border: 1px solid rgba(221, 74, 154, 0.1);
  box-shadow: 0 0 var(--vp-5px) rgba(221, 74, 154, 0.08);
  opacity: 0.4;
  transition: opacity 0.3s ease, transform 0.2s ease;
  transform: translateZ(0);
}

.status-text.stability {
  position: absolute;
  top: 5%;
  right: 10%;
  width: 3vw;
  height: 3vw;
  min-width: 2.5vw;
  max-width: 4vw;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.2);
  background-image: linear-gradient(45deg, rgba(50, 172, 226, 0.05) 0%, rgba(132, 207, 197, 0.03) 100%);
  border-radius: 50%;
  font-size: clamp(0.6rem, 0.8vw, 0.9rem);
  border: 1px solid rgba(50, 172, 226, 0.1);
  box-shadow: 0 0 var(--vp-5px) rgba(50, 172, 226, 0.08);
  opacity: 0.4;
  transition: opacity 0.3s ease, transform 0.2s ease;
  transform: translateZ(0);
}

/* Status indicator hover and fade states */
.status-text.emotion:hover,
.status-text.stability:hover {
  opacity: 0.8;
  transform: scale(1.05) translateZ(0);
}

.status-text.emotion.fade-out,
.status-text.stability.fade-out {
  opacity: 0.1;
  transform: scale(0.95) translateZ(0);
}

.status-text.emotion.fade-in,
.status-text.stability.fade-in {
  opacity: 0.6;
  transform: scale(1.02) translateZ(0);
}


/* Button label wrapper (lets us measure real text width) */
.btn-label { display:inline-block; max-width:100%; overflow:hidden; text-overflow:ellipsis; }

/* Effects visuals (holo, info/fps displays) */
.holo-element { pointer-events: none; }
.corner-bracket { z-index: var(--z-max); width: var(--size-btn-base); height: var(--size-btn-base); pointer-events: none; }
.corner-bracket::before, .corner-bracket::after { content:''; position:absolute; background-color: var(--accent-glow); animation: subtle-glow var(--anim-glow); }

.info-display { font-family: var(--font-primary); font-size: var(--text-md); pointer-events:none; }
.info-display > * { pointer-events: auto; }
.info-display > .status-text { animation: subtle-glow-cyan var(--anim-glow); text-transform: none; }

.fps-display { font-family: var(--font-primary); font-size: var(--text-sm); color: var(--accent-primary); background: var(--bg-black-60); border: none; padding: var(--spacing-base) calc(var(--spacing-base) * 1.5); text-align: right; line-height: var(--line-height-normal); pointer-events: auto; display: none; }
.fps-display.active { display: block; }
.fps-display .fps-value { font-size: var(--text-lg); font-weight: var(--font-bold); }
.fps-indicator, .indicator, .message-indicator, .message, .display-content .indicator { font-size: var(--text-base); color: var(--text-secondary); }

/* Performance-optimized animation classes for JavaScript engine */
.animate-transform {
  will-change: transform;
  transform: translateZ(0);
}

.animate-opacity {
  will-change: opacity;
}

.animate-scale {
  will-change: transform;
  transform: translateZ(0);
}

.animate-rotation {
  will-change: transform;
  transform: translateZ(0);
}

/* GPU-accelerated particle container */
.particle-container {
  will-change: transform;
  transform: translateZ(0);
  contain: layout style paint;
}

/* Optimized for frequent updates */
.dynamic-element {
  will-change: transform, opacity;
  transform: translateZ(0);
  contain: layout style paint;
}

/* Theme overrides for effects */
.light .fps-display { background: rgba(255,255,255,0.95); border: var(--border-light); color: var(--text-primary); box-shadow: var(--shadow-md); }
.light .info-display .status-text { color: var(--text-primary) !important; text-shadow: none; animation: none !important; }
.night .fps-display { background: rgba(20,14,10,0.8); border: 1px solid var(--color-orange-bright); color: var(--color-orange-bright); }
.night .info-display .status-text { color: var(--color-orange-bright) !important; text-shadow: 0 0 var(--vp-15px) #ff8800; animation: none !important; }
.dark .info-display .status-text { color: var(--color-white-pure) !important; text-shadow: 0 0 var(--vp-15px) #00e5ff; animation: none !important; }

/* Emotions visuals (no layout) */
.emotion-panel { pointer-events: auto; z-index: var(--z-max) !important; }
.emotion-state-indicator { font-size: var(--text-base); color: var(--text-secondary); }

/* Undertone Dial Styles */
.undertone-dial-container {
  margin-bottom: 1rem;
}

.undertone-dial-wrapper {
  position: relative;
  width: 120px;
  height: 120px;
  margin: 0 auto;
}

.undertone-dial {
  position: relative;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: conic-gradient(
    from 0deg,
    hsl(0, 0%, 50%) 0deg,      /* CLEAR - 0% saturation */
    hsl(0, 15%, 50%) 60deg,    /* NERVOUS - +15% saturation */
    hsl(180, 30%, 50%) 120deg, /* CONFIDENT - +30% saturation */
    hsl(0, -20%, 50%) 180deg,  /* TIRED - -20% saturation */
    hsl(0, 60%, 50%) 240deg,   /* INTENSE - +60% saturation */
    hsl(300, -50%, 50%) 300deg, /* SUBDUED - -50% saturation */
    hsl(0, 0%, 50%) 360deg     /* CLEAR - back to start */
  );
  border: 2px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  transition: transform 0.1s ease;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  will-change: transform;
  transform: translateZ(0);
}


.dial-center {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 20px;
  height: 20px;
  transform: translate(-50%, -50%);
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  border: 2px solid rgba(0, 0, 0, 0.3);
  z-index: 10;
}

.dial-pointer {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 2px;
  height: 30px;
  background: rgba(0, 0, 0, 0.8);
  transform: translate(-50%, -100%);
  transform-origin: 50% 100%;
  border-radius: 1px;
}

.current-undertone {
  text-align: center;
  margin-top: 10px;
  font-size: 12px;
  font-weight: 600;
  color: var(--text-white);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.double-fade-rule {
  height: 2px;
  background: linear-gradient(
    to right,
    transparent 0%,
    rgba(255, 255, 255, 0.1) 20%,
    rgba(255, 255, 255, 0.3) 50%,
    rgba(255, 255, 255, 0.1) 80%,
    transparent 100%
  );
  margin: 3rem 0 1rem 0;
  position: relative;
}

.double-fade-rule::after {
  content: '';
  position: absolute;
  top: 4px;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(
    to right,
    transparent 0%,
    rgba(255, 255, 255, 0.05) 20%,
    rgba(255, 255, 255, 0.15) 50%,
    rgba(255, 255, 255, 0.05) 80%,
    transparent 100%
  );
}

.single-fade-rule {
  height: 1px;
  background: linear-gradient(
    to right,
    transparent 0%,
    rgba(255, 255, 255, 0.1) 20%,
    rgba(255, 255, 255, 0.3) 50%,
    rgba(255, 255, 255, 0.1) 80%,
    transparent 100%
  );
  margin: 0rem 0 0.5rem 0;
}

/* Undertone readout in info display */
.info-display > .undertone-text { border: none; padding: var(--spacing-xs) var(--spacing-sm); border-radius: var(--radius-base); color: var(--text-secondary); font-size: var(--text-base); text-transform: uppercase; }
.light .info-display > .undertone-text { background: rgba(0,122,204,0.15); border: var(--vp-1px) solid rgba(0,122,204,0.4); color: var(--accent-primary); }
.night .info-display > .undertone-text { background: rgba(20,14,10,0.8); border: var(--vp-1px) solid var(--color-orange-bright); color: var(--color-orange-pale); }

/* Emoji buttons (theme-immune) */
.emotion-panel .emotion-btn {
  background: transparent;
  border: none;
  outline: none;
  color: inherit; /* do not recolor emoji */
  filter: none;   /* theme-immune */
  transition: transform var(--transition-smooth), filter var(--transition-base);
}
.emotion-panel .emotion-btn:hover { transform: translateY(var(--vp-2px)) scale(1.08); filter: drop-shadow(0 0 var(--vp-10px) rgba(0,229,255,0.35)); }
.emotion-panel .emotion-btn:active { transform: scale(1.02); filter: drop-shadow(0 0 var(--vp-8px) rgba(0,229,255,0.3)); }
.emotion-panel .emotion-btn.active { transform: scale(1.15); filter: drop-shadow(0 0 var(--vp-15px) rgba(0,229,255,0.6)); }

/* Footer visuals (no layout) */
.hero-spacer { flex-shrink: 0; }
.legal-footer { 
  background: var(--system-bar-bg); 
  backdrop-filter: var(--blur-light); 
  -webkit-backdrop-filter: var(--blur-light); 
  border-top: var(--vp-1px) solid rgba(255,255,255,0.1); 
  padding: calc(0.5vh + 0.2vw) calc(1vw + 0.5vh); 
  font-family: var(--font-primary); 
  font-size: clamp(8px, 1.2vw, 12px); 
  color: var(--color-white-70); 
  display: flex; 
  justify-content: center; 
  align-items: center; 
  box-sizing: border-box; 
  height: 100%;
}
.legal-footer:hover { color: var(--color-white-90); }
.footer-content { 
  display: flex; 
  align-items: center; 
  gap: clamp(8px, 1vw, 16px); 
  flex-wrap: wrap;
  justify-content: center;
}
.trademark { 
  font-weight: var(--font-medium); 
  opacity: var(--opacity-heavy); 
  letter-spacing: var(--spacing-letter-normal); 
  font-size: clamp(8px, 1.2vw, 12px);
}
.separator { 
  opacity: var(--opacity-20); 
  user-select: none; 
  margin: 0 clamp(4px, 0.5vw, 8px); 
  font-size: clamp(8px, 1.2vw, 12px);
}
.copyright { 
  opacity: var(--opacity-60); 
  font-weight: var(--font-normal); 
  font-size: clamp(8px, 1.2vw, 12px);
}
.footer-links { 
  display: flex; 
  gap: clamp(8px, 1vw, 16px); 
}
.footer-link { 
  color: var(--text-secondary); 
  text-decoration: none; 
  opacity: var(--opacity-strong); 
  transition: opacity var(--transition-base); 
  font-size: clamp(8px, 1.2vw, 12px); 
  letter-spacing: var(--spacing-letter-tight); 
}
.footer-link:hover { opacity: var(--opacity-80); }

/* Light theme footer visuals */
.light .legal-footer { background: rgba(255,255,255,var(--opacity-heavy)); border-top: var(--vp-1px) solid rgba(0,0,0,var(--opacity-subtle)); box-shadow: 0 calc(-1 * var(--vp-1px)) var(--vp-5px) var(--shadow-light); color: rgba(0,0,0,0.8); }
.light .legal-footer .trademark { color: rgba(0,0,0,0.75); opacity: 1; }
.light .legal-footer .copyright { color: rgba(0,0,0,0.7); opacity: 1; }
.light .legal-footer .separator { color: rgba(0,0,0,0.3); opacity: 1; }
.light .legal-footer .footer-link { color: rgba(0,0,0,0.7); opacity: 1; }
.light .legal-footer .footer-link:hover { color: rgba(0,0,0,0.9); opacity: 1; }

/* Gesture queue visual feedback (visuals only) */
.gesture-queued { position: relative; opacity: 0.7; animation: queue-pulse 1s ease-in-out infinite; }
.gesture-queued::after { content: attr(data-queue-position); position: absolute; top: calc(-1 * var(--vp-8px)); right: calc(-1 * var(--vp-8px)); width: var(--vp-20px); height: var(--vp-20px); background: var(--accent-primary); color: var(--text-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: var(--vp-12px); font-weight: var(--font-bold); z-index: 10; }
.queue-full { animation: queue-full-shake 0.3s ease-in-out; border-color: var(--color-error, #f44336) !important; }
.cooldown-active { opacity: 0.4 !important; cursor: not-allowed !important; animation: none !important; }
.cooldown-active::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 0%, rgba(128,128,128,0.3) 100%); animation: cooldown-sweep 0.3s linear; pointer-events: none; }

@keyframes cooldown-sweep { 0% { transform: translateY(-100%);} 100% { transform: translateY(0);} }
.gesture-triggered { animation: gesture-trigger-flash 0.2s ease-out; transform: scale(1.1); }
@keyframes queue-pulse { 0%,100%{ transform: scale(1); opacity: 0.7;} 50%{ transform: scale(1.05); opacity: 0.9;} }
@keyframes queue-full-shake { 0%,100%{ transform: translateX(0);} 25%{ transform: translateX(calc(-1 * var(--vp-5px))); } 75%{ transform: translateX(var(--vp-5px)); } }
@keyframes gesture-trigger-flash { 0%{ background-color: var(--accent-primary); transform: scale(1.2);} 100%{ background-color: transparent; transform: scale(1);} }

.gesture-btn.beat-sync-enabled { border-style: dashed; border-color: var(--accent-primary); }
.rhythm-mode-active .gesture-btn:not(.gesture-queued):hover { cursor: wait; opacity: 0.8; }
.rhythm-mode-active .gesture-btn:not(.gesture-queued):hover::before { content: '♪'; position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: var(--vp-20px); opacity: 0.5; pointer-events: none; }
.gesture-btn[data-queue-position="1"]::after { background-color: var(--color-success, #4CAF50); animation: next-in-queue 0.5s ease-in-out infinite; }
@keyframes next-in-queue { 0%,100%{ transform: scale(1);} 50%{ transform: scale(1.2);} }

/* Light theme – milder queue colors */
.light .gesture-queued::after { background: rgba(0,122,204,0.25); color: rgba(0,0,0,0.85); border: var(--vp-1px) solid rgba(0,0,0,0.08); }
.light .gesture-btn[data-queue-position="1"]::after { background-color: rgba(76,175,80,0.6); }
.light .gesture-btn.beat-sync-enabled { border-color: rgba(0,122,204,0.4); }
.light .rhythm-mode-active .gesture-btn:not(.gesture-queued):hover::before { color: var(--accent-primary); opacity: 0.35; }

/* Header visuals (no layout) */
.page-header { background: #000000; color: var(--text-primary); }
.light .page-header { background: #ffffff; border-bottom: var(--vp-1px) solid rgba(0,0,0,0.1); }
.header-content { padding: 0 var(--vp-20px); }
.header-title { color: rgba(255,255,255,0.7); font-size: var(--heading-md); font-weight: var(--font-medium); letter-spacing: min(0.18vw, 0.32vh); text-transform: uppercase; }
.light .header-title { color: rgba(0,0,0,0.7); }
.header-logo { opacity: 0.9; transition: filter var(--transition-slow); }
.dark .header-logo { filter: brightness(0) invert(1) sepia(1) saturate(2) hue-rotate(150deg) brightness(0.95); }
.night .header-logo { filter: brightness(0) invert(1) sepia(1) saturate(2) hue-rotate(15deg) brightness(0.9); }
.light .header-logo { filter: brightness(0) sepia(1) saturate(5) hue-rotate(190deg) brightness(0.4); }
.header-nav { gap: var(--vp-30px); }
.header-nav-item { color: rgba(255,255,255,0.6); text-decoration: none; font-size: var(--heading-sm); transition: color var(--transition-slow); }
.header-nav-item:hover { color: rgba(255,255,255,0.9); }
.light .header-nav-item { color: rgba(0,0,0,0.6); }
.light .header-nav-item:hover { color: rgba(0,0,0,0.9); }

/* Mobile header visual tweaks */
@media (max-width: 768px) {
  .header-logo { width: min(3.646vw, 6.481vh); }
  .header-title { font-size: min(0.9vw, 1.8vh); }
  .header-nav-item { font-size: min(0.75vw, 1.5vh); }
}

/* Notifications (visuals only) */
.notification-container { pointer-events: none; z-index: calc(var(--z-max) - 1); display: flex; flex-direction: column; justify-content: flex-end; align-items: center; }
.notification { position: relative; max-width: 80%; margin: 0.5% 0; padding: 1.5% 3%; background: var(--bg-black-90); border: var(--border-accent); border-radius: var(--radius-lg); font-family: var(--font-primary); font-size: var(--text-base); line-height: var(--line-height-normal); color: var(--text-primary); pointer-events: auto; opacity: 0; transform: translateY(20%); transition: all var(--transition-base); box-shadow: 0 0 var(--vp-20px) rgba(0,0,0,0.3); backdrop-filter: blur(var(--vp-10px)); -webkit-backdrop-filter: blur(var(--vp-10px)); overflow: hidden; }
.notification.visible { opacity: 1; transform: translateY(0); }
.notification.hiding { opacity: 0; transform: translateY(-20%); }
.notification.info { border-color: var(--accent-primary); background: linear-gradient(135deg, rgba(0,229,255,0.05) 0%, rgba(0,229,255,0.02) 100%); }
.notification.info .notification-progress { background: rgba(0,229,255,0.08); }
.notification.success { border-color: #00ff88; background: linear-gradient(135deg, rgba(0,255,136,0.05) 0%, rgba(0,255,136,0.02) 100%); }
.notification.success .notification-progress { background: rgba(0,255,136,0.08); }
.notification.warning { border-color: #ffaa00; background: linear-gradient(135deg, rgba(255,170,0,0.05) 0%, rgba(255,170,0,0.02) 100%); }
.notification.warning .notification-progress { background: rgba(255,170,0,0.08); }
.notification.error { border-color: #ff4444; background: linear-gradient(135deg, rgba(255,68,68,0.05) 0%, rgba(255,68,68,0.02) 100%); }
.notification.error .notification-progress { background: rgba(255,68,68,0.08); }
.notification.tutorial { border-color: #aa66ff; background: linear-gradient(135deg, rgba(170,102,255,0.05) 0%, rgba(170,102,255,0.02) 100%); }
.notification.tutorial .notification-progress { background: rgba(170,102,255,0.08); }
.notification-content { display: flex; align-items: center; gap: 2%; }
.notification-icon { flex-shrink: 0; font-size: var(--text-lg); width: 1.5em; text-align: center; }
.notification-message { flex: 1; margin: 0; }
.notification-close { flex-shrink: 0; cursor: pointer; opacity: 0.6; transition: opacity var(--transition-fast); font-size: var(--text-lg); padding: 0.5%; margin: -0.5%; }
.notification-close:hover { opacity: 1; }
.notification-progress { position: absolute; top: 0; left: 0; height: 100%; background: rgba(0,229,255,0.1); border-radius: var(--radius-lg); transition: width linear; z-index: -1; pointer-events: none; }
@keyframes notification-slide-in { from { opacity: 0; transform: translateY(100%);} to { opacity: 1; transform: translateY(0);} }
@keyframes notification-slide-out { from { opacity: 1; transform: translateY(0);} to { opacity: 0; transform: translateY(-100%);} }
@keyframes notification-pulse { 0%,100%{ box-shadow: 0 0 var(--vp-20px) rgba(0,229,255,0.2);} 50%{ box-shadow: 0 0 var(--vp-30px) rgba(0,229,255,0.4);} }
.notification.important { animation: notification-pulse 2s infinite; }
.light .notification { background: rgba(255,255,255,0.95); color: var(--text-primary); box-shadow: 0 var(--vp-2px) var(--vp-10px) rgba(0,0,0,0.1); }
.light .notification-progress { background: rgba(0,122,204,0.08); }
.light .notification.info { border-color: var(--accent-primary); background: linear-gradient(135deg, rgba(0,122,204,0.05) 0%, rgba(0,122,204,0.02) 100%); }
.light .notification.success { border-color: #00aa44; background: linear-gradient(135deg, rgba(0,170,68,0.05) 0%, rgba(0,170,68,0.02) 100%); }
.light .notification.warning { border-color: #ff8800; background: linear-gradient(135deg, rgba(255,136,0,0.05) 0%, rgba(255,136,0,0.02) 100%); }
.light .notification.error { border-color: #dd2222; background: linear-gradient(135deg, rgba(221,34,34,0.05) 0%, rgba(221,34,34,0.02) 100%); }
.night .notification { background: rgba(30,20,10,0.9); border-color: var(--color-orange-bright); color: var(--color-orange-pale); }
.night .notification-progress { background: rgba(255,136,0,0.1); }
@media (max-width: 768px) {
  .notification { max-width: 90%; font-size: var(--text-sm); }
}
.notification:focus-visible { outline: var(--vp-2px) solid var(--accent-primary); outline-offset: var(--vp-2px); }
.notification-container.stacked .notification:not(:last-child) { margin-bottom: 1%; transform: scale(0.95); opacity: 0.8; }
.notification-container.stacked .notification:not(:last-child):hover { transform: scale(0.98); opacity: 0.9; }

/* Rhythm Sync Visualizer (visuals only) */
.rhythm-sync-visualizer { pointer-events: auto; opacity: 0; transform: translateY(var(--vp-10px)); transition: opacity var(--transition-base), transform var(--transition-base); display: none; }
.rhythm-sync-visualizer.visible { opacity: 0.4; transform: translateY(0); }
.rhythm-sync-wrapper { width: 100%; height: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 var(--spacing-sm); background: rgba(0,0,0,0.6); backdrop-filter: blur(var(--vp-10px)); -webkit-backdrop-filter: blur(var(--vp-10px)); border-radius: var(--radius-lg); border: var(--vp-1px) solid rgba(255,255,255,0.05); gap: var(--spacing-sm); }
.rhythm-speed-btn { padding: 0; background: transparent; border: none; cursor: pointer; transition: transform var(--transition-smooth); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.rhythm-speed-btn:hover { transform: scale(1.1); }
.rhythm-speed-btn:active { transform: scale(0.95); }
.rhythm-speed-btn img { width: 100%; height: 100%; filter: brightness(0) invert(1); transition: opacity var(--transition-smooth); }
.rhythm-speed-single img { opacity: 0.7; }
.rhythm-speed-single:hover img { opacity: 1; }
.rhythm-speed-double img { opacity: 0.4; }
.rhythm-speed-double:hover img { opacity: 0.8; }
.rhythm-speed-left img { transform: rotate(180deg); }
.rhythm-bpm-display { display: flex; align-items: baseline; gap: var(--spacing-xs); padding: 0 var(--spacing-sm); margin-left: var(--spacing-sm); border-left: var(--vp-1px) solid rgba(255,255,255,0.1); }
.rhythm-bpm-value { font-size: var(--text-lg); font-weight: var(--font-bold); color: var(--accent-primary); min-width: 3ch; text-align: right; }
.rhythm-bpm-label { font-size: var(--text-xs); color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: var(--spacing-letter-wide); }
.rhythm-beats-container { flex: 1; height: 60%; display: flex; gap: calc(var(--spacing-base) * 0.5); align-items: center; justify-content: center; padding: 0 var(--spacing-xs); }
.rhythm-beat-indicator { flex: 1; max-width: calc(100% / 8); height: 100%; background: rgba(0,229,255,0.08); border: var(--vp-1px) solid rgba(0,229,255,0.2); border-radius: var(--radius-sm); position: relative; transform-origin: center; will-change: transform; }
.rhythm-beat-indicator.active { background: rgba(0,229,255,0.3); border-color: var(--accent-primary); }
.rhythm-beat-indicator.pulse { animation: beat-pulse 0.15s ease-out; }
@keyframes beat-pulse { 0%{ transform: scale(1);} 50%{ transform: scale(1.1);} 100%{ transform: scale(1);} }
.rhythm-subdiv-indicator { position: absolute; right: calc(-1 * var(--spacing-base) * 0.25); top: 40%; width: var(--vp-2px); height: 20%; background: rgba(0,229,255,0.3); opacity: 0; transition: opacity 0.2s; }

/* Theme Variations */
.light .rhythm-sync-wrapper { background: rgba(255,255,255,0.9); border-color: rgba(0,0,0,0.1); }
.light .rhythm-speed-btn img { filter: none; opacity: 0.4; }
.light .rhythm-speed-btn:hover img { opacity: 0.8; }
.light .rhythm-bpm-value { color: var(--text-primary); }
.light .rhythm-beat-indicator { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.1); }
.light .rhythm-beat-indicator.active { background: rgba(0,0,0,0.15); border-color: var(--text-primary); }

.night .rhythm-sync-wrapper { background: rgba(30,15,5,0.8); border-color: rgba(255,150,50,0.2); }
.night .rhythm-speed-btn img { filter: brightness(0) saturate(100%) invert(73%) sepia(93%) saturate(441%) hue-rotate(357deg) brightness(102%) contrast(101%); opacity: 0.5; }
.night .rhythm-speed-btn:hover img { opacity: 0.9; }
.night .rhythm-bpm-value { color: var(--color-orange-bright); }
.night .rhythm-beat-indicator { background: rgba(255,150,50,0.08); border-color: rgba(255,150,50,0.2); }
.night .rhythm-beat-indicator.active { background: rgba(255,150,50,0.3); border-color: var(--color-orange-bright); }

/* Mobile visuals */
@media (max-width: 768px) {
  .rhythm-sync-wrapper { padding: 0 var(--spacing-xs); gap: var(--spacing-xs); }
  .rhythm-speed-single { }
  .rhythm-speed-double { }
  .rhythm-bpm-display { padding: 0 var(--spacing-xs); margin-left: var(--spacing-xs); }
  .rhythm-beats-container { gap: calc(var(--spacing-base) * 0.25); padding: 0 var(--spacing-xs); }
}

/* Visual-only buttons from legacy site (vp units, no layout) */
.dice-icon { width: var(--vp-24px); height: var(--vp-24px); filter: var(--icon-filter, none); vertical-align: middle; display: inline-block; }

/* Chain Combo Buttons */
.chain-btn { background: var(--button-bg); border: var(--border-thin); border-radius: var(--radius-sm); position: relative; overflow: hidden; }
.chain-btn:hover { background: var(--button-hover); border-color: var(--accent-primary); box-shadow: 0 0 var(--vp-1px) var(--accent-glow); }
.chain-btn[data-chain="rise"]{ --chain-hue: 0deg; }
.chain-btn[data-chain="flow"]{ --chain-hue: 30deg; }
.chain-btn[data-chain="burst"]{ --chain-hue: 60deg; }
.chain-btn[data-chain="drift"]{ --chain-hue: 90deg; }
.chain-btn[data-chain="chaos"]{ --chain-hue: 120deg; }
.chain-btn[data-chain="morph"]{ --chain-hue: 150deg; }
.chain-btn[data-chain="rhythm"]{ --chain-hue: 180deg; }
.chain-btn[data-chain="spiral"]{ --chain-hue: 210deg; }
.chain-btn[data-chain="routine"]{ --chain-hue: 240deg; }
.chain-btn[data-chain="radiance"]{ --chain-hue: 270deg; }
.chain-btn[data-chain="twinkle"]{ --chain-hue: 300deg; }
.chain-btn[data-chain="stream"]{ --chain-hue: 330deg; }
.chain-btn.pulsing { animation: chainFlash 0.3s ease-out; }
@keyframes chainFlash { 0%{ background: var(--button-bg); box-shadow:none; filter:hue-rotate(0deg);} 50%{ background: var(--accent-primary); box-shadow:0 0 var(--vp-20px) var(--accent-glow); transform:scale(1.05); filter:hue-rotate(var(--chain-hue,0deg)) brightness(1.5);} 100%{ background:var(--button-bg); box-shadow:none; transform:scale(1); filter:hue-rotate(0deg);} }

/* Track Selection Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.modal-content {
  background: var(--bg-primary);
  border: var(--border-thin);
  border-radius: var(--radius-md);
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow: hidden;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  border-bottom: var(--border-thin);
  background: var(--bg-secondary);
}

.modal-title {
  font-size: var(--text-lg);
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
}

.modal-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: var(--text-xl);
  cursor: pointer;
  padding: var(--spacing-xs);
  border-radius: var(--radius-sm);
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: var(--bg-hover);
  color: var(--accent-primary);
}

.modal-body {
  padding: var(--spacing-md);
  max-height: 400px;
  overflow-y: auto;
}

.track-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.track-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background: var(--bg-secondary);
  border: var(--border-thin);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s ease;
}

.track-item:hover {
  background: var(--bg-hover);
  border-color: var(--accent-primary);
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
}

.track-info {
  flex: 1;
}

.track-name {
  font-size: var(--text-base);
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: var(--spacing-xs);
}

.track-filename {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  font-family: var(--font-mono);
}

.track-play-icon {
  font-size: var(--text-lg);
  color: var(--accent-primary);
  opacity: 0.7;
  transition: opacity 0.2s ease;
}

.track-item:hover .track-play-icon {
  opacity: 1;
}

.modal-footer {
  padding: var(--spacing-md);
  border-top: var(--border-thin);
  background: var(--bg-secondary);
  display: flex;
  justify-content: flex-end;
}

.modal-cancel {
  background: var(--button-bg);
  border: var(--border-thin);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  padding: var(--spacing-sm) var(--spacing-md);
  cursor: pointer;
  transition: all 0.2s ease;
}

.modal-cancel:hover {
  background: var(--button-hover);
  border-color: var(--accent-primary);
}

/* Gesture/Glow Effect Buttons */
.gesture-btn { background: var(--button-bg); border: var(--border-thin); border-radius: var(--radius-sm); transition: all 0.2s ease-out; }
.gesture-btn:hover { background: var(--button-hover); border-color: var(--accent-primary); box-shadow: 0 0 var(--vp-1px) var(--accent-glow); }
.gesture-btn.active { background: var(--accent-primary); color: var(--bg-primary); border-color: var(--accent-glow); box-shadow: 0 0 var(--vp-1px) var(--accent-glow); animation: gestureActivate 0.4s ease-out; }
@keyframes gestureActivate { 0%{ transform:scale(1); filter:hue-rotate(0deg);} 25%{ transform:scale(1.1); filter:hue-rotate(calc(var(--chain-index,0) * 60deg)) brightness(1.3);} 50%{ transform:scale(1.05); filter:hue-rotate(calc(var(--chain-index,0) * 60deg)) brightness(1.2);} 100%{ transform:scale(1); filter:hue-rotate(0deg);} }

/* Sound Toggle */
.sound-toggle { background: transparent; border: var(--border-accent); color: var(--accent-primary); padding: var(--spacing-sm); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all var(--transition-slow); }
.sound-toggle:hover { background: var(--button-hover); transform: scale(1.05); }
.sound-toggle.active { background: var(--accent-primary); color: var(--bg-primary); }
.sound-toggle svg { width: var(--size-logo); height: var(--size-logo); }

/* Shape controls (visuals only) */
.shape-controls-hero { background: rgba(0,0,0,0.5); backdrop-filter: var(--blur-medium); -webkit-backdrop-filter: var(--blur-medium); box-shadow: 0 calc(-1 * var(--vp-2px)) var(--vp-20px) var(--shadow-dark); pointer-events: auto; border-top: var(--vp-1px) solid rgba(255,255,255,0.1); }
.shape-controls-hero .shape-btn { aspect-ratio: 1 / 1; font-size: calc(var(--text-2xl) * 1.2); border-radius: var(--radius-lg); background: rgba(0,0,0,0.6); backdrop-filter: blur(var(--vp-10px)); border: var(--border-light); transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; justify-content: center; padding: 0; margin: 0; box-sizing: border-box; cursor: pointer; color: var(--text-secondary); outline: none; pointer-events: auto; }
.shape-controls-hero .shape-btn:hover { background: linear-gradient(135deg, rgba(0,229,255,0.15) 0%, rgba(0,229,255,0.08) 100%); transform: translateY(var(--vp-2px)) scale(1.08); box-shadow: 0 var(--vp-4px) var(--vp-12px) rgba(0,229,255,0.3), 0 0 var(--vp-20px) rgba(0,229,255,0.15), inset 0 var(--vp-1px) 0 rgba(255,255,255,0.2); border-color: rgba(0,229,255,0.4); }
.shape-controls-hero .shape-btn.active { background: linear-gradient(135deg, rgba(0,229,255,0.4) 0%, rgba(0,229,255,0.25) 100%); box-shadow: 0 0 var(--vp-25px, 1.302vw) rgba(0,229,255,0.5), 0 var(--vp-2px) var(--vp-8px) rgba(0,229,255,0.3), inset 0 0 var(--vp-15px) rgba(0,229,255,0.2), inset 0 var(--vp-1px) 0 rgba(255,255,255,0.3); transform: scale(1.05); border-color: rgba(0,229,255,0.6); color: var(--accent-primary); }

/* Light/Night variants (visuals only) */
.light .shape-controls-hero, body.light .shape-controls-hero { background: rgba(255,255,255,0.7) !important; border-top: var(--vp-1px) solid rgba(240,240,240,0.3) !important; box-shadow: 0 var(--vp-1px) var(--vp-3px, 0.156vw) rgba(0,0,0,0.01), inset 0 var(--vp-1px) 0 rgba(255,255,255,0.8) !important; backdrop-filter: blur(var(--vp-10px)) !important; -webkit-backdrop-filter: blur(var(--vp-10px)) !important; }
.light .shape-controls-hero .shape-btn { background: linear-gradient(180deg, rgba(255,255,255,0.98) 0%, rgba(252,252,253,0.95) 100%); color: rgba(55,60,70,0.75); border: var(--border-light); box-shadow: 0 var(--vp-2px) var(--vp-3px, 0.156vw) rgba(0,0,0,0.03), 0 var(--vp-1px) var(--vp-2px) rgba(0,0,0,0.02), inset 0 var(--vp-1px) 0 rgba(255,255,255,1); }
.light .shape-controls-hero .shape-btn:hover { background: linear-gradient(135deg, rgba(245,247,250,1) 0%, rgba(235,240,245,1) 100%); color: rgba(30,35,45,0.95); border-color: rgba(180,190,200,0.6); transform: translateY(var(--vp-2px)) scale(1.08); box-shadow: 0 var(--vp-6px, 0.313vw) var(--vp-16px, 0.833vw) rgba(0,20,40,0.12), 0 var(--vp-2px) var(--vp-6px, 0.313vw) rgba(0,20,40,0.06), inset 0 var(--vp-1px) 0 rgba(255,255,255,1), inset 0 calc(-1 * var(--vp-1px)) 0 rgba(220,225,230,0.3); }
.light .shape-controls-hero .shape-btn.active { background: linear-gradient(135deg, rgba(70,130,200,0.95) 0%, rgba(50,110,180,0.92) 100%); color: rgba(255,255,255,0.98); border-color: rgba(70,130,200,0.6); transform: scale(1.05); box-shadow: 0 0 var(--vp-20px) rgba(70,130,200,0.35), 0 var(--vp-4px) var(--vp-12px) rgba(50,110,180,0.25), inset 0 var(--vp-1px) 0 rgba(255,255,255,0.3), inset 0 calc(-1 * var(--vp-1px)) 0 rgba(40,90,160,0.2); }
.night .shape-controls-hero { background: rgba(30,20,10,0.8) !important; border-top: var(--vp-1px) solid rgba(255,150,50,0.2) !important; box-shadow: 0 calc(-1 * var(--vp-2px)) var(--vp-16px, 0.833vw) rgba(255,100,0,0.1), 0 calc(-1 * var(--vp-1px)) var(--vp-8px) rgba(255,150,50,0.05), inset 0 var(--vp-1px) 0 rgba(255,200,100,0.1) !important; backdrop-filter: blur(var(--vp-12px)) !important; -webkit-backdrop-filter: blur(var(--vp-12px)) !important; }
.night .shape-controls-hero .shape-btn { background: linear-gradient(135deg, rgba(40,25,15,0.9) 0%, rgba(30,20,10,0.85) 100%); color: rgba(255,200,150,0.8); border: 1px solid rgba(255,150,50,0.25); box-shadow: 0 var(--vp-2px) var(--vp-6px) rgba(0,0,0,0.3), inset 0 var(--vp-1px) 0 rgba(255,200,100,0.1); }
.night .shape-controls-hero .shape-btn:hover { background: linear-gradient(135deg, rgba(255,150,50,0.2) 0%, rgba(255,120,30,0.15) 100%); color: rgba(255,200,100,0.95); border-color: rgba(255,150,50,0.5); transform: translateY(var(--vp-2px)) scale(1.08); box-shadow: 0 var(--vp-6px) var(--vp-20px) rgba(255,120,30,0.25), 0 var(--vp-2px) var(--vp-8px) rgba(255,150,50,0.15), inset 0 var(--vp-1px) 0 rgba(255,220,150,0.2), inset 0 calc(-1 * var(--vp-1px)) 0 rgba(200,100,30,0.1); }
.night .shape-controls-hero .shape-btn.active { background: linear-gradient(135deg, rgba(255,140,40,0.9) 0%, rgba(255,100,20,0.85) 100%); color: rgba(255,255,255,0.95); border-color: rgba(255,150,50,0.6); transform: scale(1.05); box-shadow: 0 0 var(--vp-25px, 1.302vw) rgba(255,140,40,0.4), 0 var(--vp-4px) var(--vp-12px) rgba(255,100,20,0.3), inset 0 var(--vp-1px) 0 rgba(255,220,150,0.3), inset 0 calc(-1 * var(--vp-1px)) 0 rgba(200,80,20,0.2); }

/* Emotion buttons (visuals) */
.emotion-btn { background: transparent; font-size: var(--text-xl-plus-3); line-height: var(--line-height-tight); }
.emotion-panel .emotion-btn { display:flex; align-items:center; justify-content:center; border:none; outline:none; background:transparent; transition: all var(--transition-smooth); cursor:pointer; color: var(--text-primary); }
.emotion-panel .emotion-btn:hover { transform: translateY(var(--vp-2px)) scale(1.1); filter: brightness(1.2); }
.emotion-panel .emotion-btn.active { transform: scale(1.15); filter: drop-shadow(0 0 var(--vp-10px) rgba(0,255,255,0.6)); }

/* BPM modifier (visuals) */
.bpm-modifier-btn { background: transparent; border: none; color: var(--accent-primary); }
.bpm-modifier-btn.active { background: rgba(0,255,255,0.1); color: var(--accent-primary); }
.light .bpm-modifier-btn { background: transparent; border: none; color: rgba(0,0,0,0.5); }
.light .bpm-modifier-btn:hover { background: rgba(0,122,204,0.08); color: rgba(0,122,204,0.9); transform: scale(1.05); }
.light .bpm-modifier-btn.active { background: rgba(0,122,204,0.15); color: var(--accent-primary); box-shadow: 0 0 var(--vp-8px) rgba(0,122,204,0.15), inset 0 0 var(--vp-6px) rgba(0,122,204,0.08); }

/* Gesture queue states (visuals) */
.gesture-queued { background: var(--button-hover) !important; color: var(--accent-primary) !important; box-shadow: 0 0 var(--vp-10px) rgba(0,229,255,0.4), inset 0 0 var(--vp-5px) rgba(0,229,255,0.2) !important; position: relative; overflow: visible; }
.gesture-triggered { animation: gestureTriggered 0.2s ease-out; }
@keyframes gestureTriggered { 0%{ transform:scale(1); box-shadow:0 0 0 rgba(0,229,255,0);} 50%{ transform:scale(1.1); box-shadow:0 0 var(--vp-20px) rgba(0,229,255,0.6);} 100%{ transform:scale(1); box-shadow:0 0 0 rgba(0,229,255,0);} }

