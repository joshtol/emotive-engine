!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).EmotiveMascotLean={})}(this,function(e){"use strict";class t{constructor(){this.errors=[],this.maxErrors=10,this.errorCounts=new Map,this.defaults={emotion:"neutral",gesture:null,audioLevel:0,particleCount:0,glowIntensity:.7,coreSize:1,breathRate:1,color:"#B0B0B0"}}wrap(e,t,i=null){return(...a)=>{try{return e(...a)}catch(e){return this.logError(e,t),null!==i?i:this.getDefault(t)}}}logError(e,t){const i={timestamp:(new Date).toISOString(),context:t,message:e.message,stack:e.stack};this.errors.push(i);const a=this.errorCounts.get(t)||0;this.errorCounts.set(t,a+1),this.errors.length>this.maxErrors&&this.errors.shift()}getDefault(e){const t={"emotion-transition":this.defaults.emotion,"gesture-execution":this.defaults.gesture,"audio-processing":this.defaults.audioLevel,"particle-system":this.defaults.particleCount,rendering:{glowIntensity:this.defaults.glowIntensity,coreSize:this.defaults.coreSize,color:this.defaults.color},"canvas-operations":null,"state-management":this.defaults.emotion};return{}.hasOwnProperty.call(t,e)?t[e]:null}validateInput(e,t,i){try{switch(t){case"emotion":return["neutral","joy","sadness","anger","fear","surprise","disgust","love","euphoria"].includes(e)?e:i;case"undertone":return null===e||["nervous","confident","tired","intense","subdued"].includes(e)?e:null;case"gesture":return["bounce","pulse","shake","spin","nod","tilt","expand","contract","flash","drift"].includes(e)?e:i;case"number":return"number"!=typeof e||isNaN(e)?i:e;case"string":return"string"==typeof e?e:i;case"boolean":return"boolean"==typeof e?e:i;default:return null!=e?e:i}}catch(e){return this.logError(e,"input-validation"),i}}hasExceededThreshold(e,t=5){return(this.errorCounts.get(e)||0)>=t}getErrorStats(){return{totalErrors:this.errors.length,errorsByContext:Object.fromEntries(this.errorCounts),recentErrors:this.errors.slice(-5)}}clearErrors(){this.errors=[],this.errorCounts.clear()}async attemptRecovery(e,t,i=3){let a=0;for(;a<i;)try{return await t()}catch(t){if(a++,this.logError(t,`recovery-${e}-attempt-${a}`),a>=i)throw new Error(`Recovery failed for ${e} after ${i} attempts`);await new Promise(e=>setTimeout(e,100*Math.pow(2,a)))}}}const i=new Map;var a={registerPluginEmotion:function(e,t){return!!t.color&&(t.name||(t.name=e),t.visual||(t.visual={primaryColor:t.color,particleCount:t.particleCount||15,particleSize:t.particleSize||{min:2,max:6}}),t.modifiers||(t.modifiers={speed:1,amplitude:1,intensity:1}),i.set(e,t),!0)},unregisterPluginEmotion:function(e){return!!i.has(e)&&(i.delete(e),!0)},getPluginEmotion:function(e){return i.get(e)||null},getAllPluginEmotions:function(){return Array.from(i.keys())},clearPluginEmotions:function(){i.clear()},createLegacyAdapter:function(e){return{name:e.name||"unknown",emoji:e.emoji||"üîå",color:e.primaryColor||e.color||"#7B68EE",energy:e.energy||"medium",visual:{primaryColor:e.primaryColor||e.color||"#7B68EE",secondaryColor:e.secondaryColor,particleCount:e.particleCount||e.particleRate||15,particleSize:e.particleSize||{min:2,max:6},glowIntensity:e.glowIntensity||.5,trailLength:e.trailLength||5,pulseRate:e.pulseRate||e.breathRate||1},particles:{behavior:e.particleBehavior||"ambient",density:e.particleDensity||"medium",speed:e.particleSpeed||"normal"},modifiers:{speed:e.speedMultiplier||1,amplitude:e.amplitudeMultiplier||1,intensity:e.intensityMultiplier||1,smoothness:e.smoothnessMultiplier||1},gestures:e.gestures||[],transitions:e.transitions||{}}}},s={name:"suspicion",emoji:"ü§®",description:"Paranoid watchfulness with surveillance scanning",visual:{glowColor:"#6B46C1",particleRate:4,minParticles:6,maxParticles:12,particleBehavior:"surveillance",particleSpeed:.2,breathRate:.6,breathDepth:.04,coreJitter:.02,blinkRate:1.1,blinkSpeed:1,particleColors:[{color:"#6B46C1",weight:30},{color:"#4A5568",weight:25},{color:"#8B4789",weight:20},{color:"#9F7AEA",weight:15},{color:"#2D3748",weight:10}],threatLevel:0,getGlowIntensity(){return.3+.7*this.threatLevel},getParticleSpeed(){return.2+.8*this.threatLevel},getGlowColor(){const e=this.threatLevel||0,t=Math.round(107+113*e),i=Math.round(70+-32*e),a=Math.round(193+-66*e),s=e=>e.toString(16).padStart(2,"0");return`#${s(t)}${s(i)}${s(a)}`}},modifiers:{speed:.4,amplitude:.6,intensity:1.2,smoothness:.3,regularity:.2,focus:1.5,addWobble:!0},typicalGestures:["scan","twitch","peek","tilt","hold"],transitions:{duration:500,easing:"linear",priority:4},special:{coreSquint:.6,scanInterval:2e3,scanDuration:1200,scanAngle:60,twitchChance:.02,peekInterval:4e3,maxThreatDistance:300,alertThreshold:.7},"3d":{rotation:{type:"suspicious",speed:1,axes:[0,0,0],musicSync:!1},glow:{color:"#6B46C1",intensity:.85,pulse:{speed:.6,range:[.7,1]}},scale:{base:1,breathe:{enabled:!0,depth:.04,rate:.6}}},soulAnimation:{driftSpeed:.9,shimmerSpeed:1.8,turbulence:.4},rhythmModifiers:{windowMultiplier:.9,visualNoise:.3,inputDelay:0,tempoShift:0}},n={name:"calm",emoji:"üòå",description:"Serene, peaceful state with gentle movements",visual:{glowColor:"#66D9CC",particleRate:6,minParticles:10,maxParticles:50,particleBehavior:"zen",breathRate:.4,breathDepth:.12,coreJitter:!1,blinkRate:.8,blinkSpeed:1,particleColors:[{color:"#66D9CC",weight:35},{color:"#99E6D9",weight:25},{color:"#40BFB3",weight:20},{color:"#B3F2E6",weight:15},{color:"#339980",weight:5}]},modifiers:{speed:.5,amplitude:.3,intensity:.4,smoothness:2,regularity:1.5,addWeight:!1,floatHeight:.2,swayAmount:.15,duration:1.5},typicalGestures:["breathe","float","drift","idle"],transitions:{duration:800,easing:"easeInOutSine",priority:1},movement:{floatPattern:"sine_slow",floatPeriod:6e3,floatAmplitude:8,swayPattern:"gentle",swayPeriod:8e3,swayAmplitude:5,microMovements:!1},getCoreParams(e){const t=e.time||Date.now(),i=.5*Math.sin(6e-4*t)+.5;return{scaleX:1-.02*i,scaleY:1-.02*i,eyeOpenness:.85,eyeExpression:"serene",pupilOffset:{x:2*Math.sin(3e-4*t),y:1*Math.cos(4e-4*t)},glowPulse:.95+.05*i}},updateParticle(e,t){e.x+=.1*Math.sin(.001*e.life),e.y-=.02*t,e.opacity=.3*Math.sin(.002*e.life)+.2,e.size=e.baseSize*(1+.2*Math.sin(.001*e.life))},renderCore:(e,t,i,a)=>!1,"3d":{rotation:{type:"gentle",speed:.5,axes:[0,.3,0],musicSync:!0},glow:{color:"#66D9CC",intensity:.6,pulse:{speed:.4,range:[.5,.7]}},scale:{base:1,breathe:{enabled:!0,depth:.12,rate:.4}}},soulAnimation:{driftSpeed:.3,shimmerSpeed:.4,turbulence:.1},rhythmModifiers:{windowMultiplier:1.2,visualNoise:0,inputDelay:0,tempoShift:0}};const r=new Map,o={happy:"joy",peaceful:"calm",curious:"surprise",frustrated:"anger",sad:"sadness",excitement:"excited"};function l(e){e.name&&r.set(e.name,e)}function h(e){const t=o[e]||e,i=r.get(t);return i||(a.getPluginEmotion(t)||null)}function c(e){const t=h(e);if(!t)return h("neutral").visual;if(!t.visual)return{};const{visual:i}=t,a={};for(const e in i)"function"!=typeof i[e]&&(a[e]=i[e]);return"function"==typeof i.getGlowIntensity&&(a.glowIntensity=i.getGlowIntensity()),"function"==typeof i.getParticleSpeed&&(a.particleSpeed=i.getParticleSpeed()),"function"==typeof i.getParticleRate&&(a.particleRate=i.getParticleRate()),"function"==typeof i.getGlowColor&&(a.glowColor=i.getGlowColor()),a}function u(e){const t=h(e);return t?t.modifiers:h("neutral").modifiers}function d(){return[...Array.from(r.keys()),...a.getAllPluginEmotions()]}function p(){const e={};return r.forEach((t,i)=>{e[i]=t}),e}function g(e){const t=o[e]||e;return r.has(t)||null!==a.getPluginEmotion(t)}function m(e,t){o[e]=t}function y(e,t){const i=h(e),a=h(t);return i&&a?a.transitions&&a.transitions[e]?a.transitions[e]:{duration:1e3,easing:"ease-in-out",gesture:a.transitions?.defaultGesture||null}:{duration:1e3,easing:"ease-in-out"}}function f(e){const t=h(e);return t?.gestures||[]}function b(e){const t=h(e);return t?.rhythmModifiers??{windowMultiplier:1,visualNoise:0,inputDelay:0,tempoShift:0}}function w(e){if(!e||0===e.length)return{windowMultiplier:1,visualNoise:0,inputDelay:0,tempoShift:0};if(1===e.length){const t=b(e[0].emotion),i=e[0].intensity;return{windowMultiplier:1+(t.windowMultiplier-1)*i,visualNoise:t.visualNoise*i,inputDelay:t.inputDelay*i,tempoShift:t.tempoShift*i}}let t=0;for(let i=1;i<e.length;i++)e[i].intensity>e[t].intensity&&(t=i);const i={windowMultiplier:0,visualNoise:0,inputDelay:0,tempoShift:0},a=e.filter((e,i)=>i!==t),s=a.length>0?.25/a.length:0,n=b(e[t].emotion),r=e[t].intensity;i.windowMultiplier+=.75*(1+(n.windowMultiplier-1)*r),i.visualNoise+=n.visualNoise*r*.75,i.inputDelay+=n.inputDelay*r*.75,i.tempoShift+=n.tempoShift*r*.75;for(const e of a){const t=b(e.emotion),a=e.intensity;i.windowMultiplier+=(1+(t.windowMultiplier-1)*a)*s,i.visualNoise+=t.visualNoise*a*s,i.inputDelay+=t.inputDelay*a*s,i.tempoShift+=t.tempoShift*a*s}return i}[{name:"neutral",emoji:"üòê",description:"Calm, balanced emotional state",visual:{glowColor:"#00BCD4",particleRate:2,minParticles:8,maxParticles:10,particleBehavior:"ambient",breathRate:1,breathDepth:.08,coreJitter:!1,blinkRate:1,blinkSpeed:1,particleColors:[{color:"#00BCD4",weight:25},{color:"#00ACC1",weight:20},{color:"#26C6DA",weight:15},{color:"#B2EBF2",weight:15},{color:"#0097A7",weight:10},{color:"#80DEEA",weight:10},{color:"#E0F7FA",weight:5}]},modifiers:{speed:1,amplitude:1,intensity:1,smoothness:1,regularity:1},typicalGestures:["breathe","float","idle","blink"],transitions:{duration:500,easing:"easeInOut",priority:0},getCoreParams:e=>({scaleX:1,scaleY:1,eyeOpenness:1,eyeExpression:"neutral",pupilOffset:{x:0,y:0}}),renderCore:(e,t,i,a)=>!1,"3d":{rotation:{type:"gentle",speed:1,axes:[0,.3,0],musicSync:!1},glow:{color:"#00BCD4",intensity:.9,pulse:{speed:1,range:[.8,1]}},scale:{base:1,breathe:{enabled:!0,depth:.08,rate:1}}},soulAnimation:{driftSpeed:.5,shimmerSpeed:.5,turbulence:.2},rhythmModifiers:{windowMultiplier:1,visualNoise:0,inputDelay:0,tempoShift:0}},{name:"joy",emoji:"üòä",description:"Playful happiness and celebration",visual:{glowColor:"#FFEB3B",particleRate:8,minParticles:0,maxParticles:50,particleBehavior:"popcorn",breathRate:1.5,breathDepth:.1,coreJitter:!1,blinkRate:1.3,blinkSpeed:1.1,particleColors:[{color:"#FFEB3B",weight:25},{color:"#FFC107",weight:20},{color:"#FFFF00",weight:15},{color:"#FFD700",weight:15},{color:"#FFF59D",weight:10},{color:"#FF9800",weight:10},{color:"#FFFDE7",weight:5}]},modifiers:{speed:1.8,amplitude:1.9,intensity:1.1,smoothness:1,regularity:.9,addBounce:!0},typicalGestures:["bounce","spin","wave","expand","shake","float"],transitions:{duration:400,easing:"easeOutBack",priority:5,burstOnEntry:!0},getCoreParams:e=>({scaleX:1,scaleY:1,eyeOpenness:1,eyeExpression:"happy",pupilOffset:{x:0,y:-.1},sparkle:!0}),"3d":{rotation:{type:"rhythmic",speed:1.8,axes:[0,.3,0],musicSync:!0},glow:{color:"#FFEB3B",intensity:1.6,pulse:{speed:1.5,range:[1.2,1.8]}},scale:{base:1,breathe:{enabled:!0,depth:.1,rate:1.5}}},soulAnimation:{driftSpeed:1.2,shimmerSpeed:1.5,turbulence:.3},rhythmModifiers:{windowMultiplier:1.3,visualNoise:0,inputDelay:0,tempoShift:0}},{name:"sadness",emoji:"üò¢",description:"Deep melancholic sorrow",visual:{glowColor:"#4169E1",particleRate:6,minParticles:0,maxParticles:50,particleBehavior:"falling",breathRate:.6,breathDepth:.12,coreJitter:!1,blinkRate:.6,blinkSpeed:.8,particleColors:[{color:"#4169E1",weight:25},{color:"#1E90FF",weight:20},{color:"#6495ED",weight:15},{color:"#B0C4DE",weight:15},{color:"#191970",weight:10},{color:"#87CEEB",weight:10},{color:"#2F4F4F",weight:5}]},modifiers:{speed:.7,amplitude:.6,intensity:.8,smoothness:1.3,regularity:1.1,addGravity:!0},typicalGestures:["droop","sway","contract","drift","sink"],transitions:{duration:800,easing:"easeInOut",priority:3},"3d":{rotation:{type:"gentle",speed:.7,axes:[0,.2,0],musicSync:!1},glow:{color:"#4169E1",intensity:.65,pulse:{speed:.6,range:[.5,.8]}},scale:{base:1,breathe:{enabled:!0,depth:.12,rate:.6}}},soulAnimation:{driftSpeed:.2,shimmerSpeed:.3,turbulence:.1},rhythmModifiers:{windowMultiplier:1,visualNoise:0,inputDelay:45,tempoShift:0}},{name:"anger",emoji:"üò†",description:"Intense rage and aggression",visual:{glowColor:"#DC143C",particleRate:8,minParticles:8,maxParticles:50,particleBehavior:"aggressive",breathRate:2.2,breathDepth:.15,coreJitter:!0,blinkRate:1.6,blinkSpeed:1.3,particleColors:[{color:"#DC143C",weight:25},{color:"#FF0000",weight:20},{color:"#B22222",weight:15},{color:"#FF4500",weight:15},{color:"#8B0000",weight:10},{color:"#FF6347",weight:10},{color:"#660000",weight:5}]},modifiers:{speed:1.5,amplitude:1.4,intensity:1.3,smoothness:.3,regularity:.7,addShake:!0},typicalGestures:["shake","vibrate","expand","pulse","flicker","strike"],transitions:{duration:300,easing:"easeOutExpo",priority:8,shakeOnEntry:!0},special:{screenShake:!0,particleTrails:"fire",glowPulse:!0,temperatureEffect:"hot"},"3d":{rotation:{type:"unstable",speed:1.5,axes:[0,.3,0],shake:{amplitude:.02,frequency:7},eruption:{enabled:!0,interval:3e3,speedMultiplier:3.5,duration:400},musicSync:!1},glow:{color:"#DC143C",intensity:1.8,pulse:{speed:2.2,range:[.8,2]}},scale:{base:1,breathe:{enabled:!0,depth:.15,rate:2.2}}},soulAnimation:{driftSpeed:2,shimmerSpeed:.8,turbulence:.8},rhythmModifiers:{windowMultiplier:.75,visualNoise:0,inputDelay:0,tempoShift:0}},{name:"fear",emoji:"üò®",description:"Anxious state with fleeing particles",visual:{glowColor:"#8A2BE2",particleRate:8,minParticles:8,maxParticles:50,particleBehavior:"scattering",breathRate:2.5,breathDepth:.06,coreJitter:!0,blinkRate:1.7,blinkSpeed:1.4,particleColors:[{color:"#8A2BE2",weight:25},{color:"#4B0082",weight:20},{color:"#9400D3",weight:15},{color:"#6B46C1",weight:15},{color:"#9932CC",weight:10},{color:"#E6E6FA",weight:8},{color:"#301934",weight:7}]},modifiers:{speed:1.4,amplitude:.8,intensity:1.2,smoothness:.5,regularity:.5,addJitter:!0},typicalGestures:["shake","vibrate","contract","flicker","retreat"],transitions:{duration:400,easing:"easeOut",priority:7},"3d":{rotation:{type:"unstable",speed:1.4,axes:[0,.3,0],shake:{amplitude:.015,frequency:3.5},musicSync:!1},glow:{color:"#8A2BE2",intensity:.9,pulse:{speed:2.5,range:[.6,1.2]}},scale:{base:1,breathe:{enabled:!0,depth:.06,rate:2.5}}},soulAnimation:{driftSpeed:1.8,shimmerSpeed:2.5,turbulence:.6},rhythmModifiers:{windowMultiplier:1,visualNoise:.6,inputDelay:0,tempoShift:0}},{name:"surprise",emoji:"üò≤",description:"Sudden shock with explosive particles",visual:{glowColor:"#FFD700",particleRate:5,minParticles:0,maxParticles:15,particleBehavior:"burst",breathRate:.3,breathDepth:.18,coreJitter:!1,blinkRate:1.4,blinkSpeed:1.2,particleColors:[{color:"#FFD700",weight:25},{color:"#FFA500",weight:20},{color:"#FFFF00",weight:15},{color:"#FF6347",weight:15},{color:"#FFE4B5",weight:10},{color:"#FF4500",weight:10},{color:"#FFFACD",weight:5}]},modifiers:{speed:1.6,amplitude:1.5,intensity:1.4,smoothness:.7,regularity:.8,addPop:!0},typicalGestures:["expand","bounce","flash","pulse","pop"],transitions:{duration:200,easing:"easeOutBack",priority:6},"3d":{rotation:{type:"unstable",speed:1.6,axes:[0,.45,0],shake:{amplitude:.01,frequency:3},musicSync:!1},glow:{color:"#FFD700",intensity:1.8,pulse:{speed:.3,range:[1,2.2]}},scale:{base:1,breathe:{enabled:!0,depth:.18,rate:.3}}},soulAnimation:{driftSpeed:1.5,shimmerSpeed:2,turbulence:.5},rhythmModifiers:{windowMultiplier:2,visualNoise:0,inputDelay:0,tempoShift:0}},{name:"disgust",emoji:"ü§¢",description:"Revulsion with repelling particles",visual:{glowColor:"#9ACD32",particleRate:4,minParticles:5,maxParticles:12,particleBehavior:"repelling",breathRate:.7,breathDepth:.04,coreJitter:!1,blinkRate:.9,blinkSpeed:.9,particleColors:[{color:"#9ACD32",weight:25},{color:"#ADFF2F",weight:20},{color:"#7FFF00",weight:15},{color:"#BDB76B",weight:15},{color:"#6B8E23",weight:10},{color:"#CCFF00",weight:8},{color:"#556B2F",weight:7}]},modifiers:{speed:.9,amplitude:.7,intensity:.9,smoothness:.8,regularity:1,addRecoil:!0},typicalGestures:["contract","shake","recoil","wobble"],transitions:{duration:600,easing:"easeIn",priority:4},"3d":{rotation:{type:"gentle",speed:.9,axes:[0,.25,0],musicSync:!1},glow:{color:"#9ACD32",intensity:1,pulse:{speed:.7,range:[.7,1.2]}},scale:{base:1,breathe:{enabled:!0,depth:.04,rate:.7}}},soulAnimation:{driftSpeed:.4,shimmerSpeed:.6,turbulence:.35},rhythmModifiers:{windowMultiplier:.85,visualNoise:.2,inputDelay:0,tempoShift:0}},{name:"love",emoji:"üíï",description:"Warm affection with orbiting particles",visual:{glowColor:"#FF1493",particleRate:6,minParticles:15,maxParticles:50,particleBehavior:"orbiting",breathRate:.75,breathDepth:.15,coreJitter:!1,blinkRate:1.2,blinkSpeed:1,particleColors:[{color:"#FF1493",weight:30},{color:"#FF69B4",weight:25},{color:"#FF007F",weight:15},{color:"#FFB6C1",weight:10},{color:"#FF45A0",weight:10},{color:"#E91E63",weight:5},{color:"#FFC0CB",weight:5}]},modifiers:{speed:.9,amplitude:1.1,intensity:1.2,smoothness:1.4,regularity:1.2,addWarmth:!0},typicalGestures:["pulse","sway","orbit","glow","breathe","float"],transitions:{duration:700,easing:"easeInOut",priority:5},"3d":{rotation:{type:"gentle",speed:.9,axes:[0,.28,0],musicSync:!0},glow:{color:"#FF1493",intensity:1.8,pulse:{speed:.75,range:[1.3,2]}},scale:{base:1,breathe:{enabled:!0,depth:.15,rate:.75}}},soulAnimation:{driftSpeed:.8,shimmerSpeed:1.2,turbulence:.2},rhythmModifiers:{windowMultiplier:1.15,visualNoise:0,inputDelay:0,tempoShift:0}},s,{name:"excited",emoji:"ü§©",description:"High energy with rapid particles",visual:{glowColor:"#FF6B35",particleRate:8,minParticles:10,maxParticles:50,particleBehavior:"burst",breathRate:2,breathDepth:.14,coreJitter:!0,blinkRate:1.5,blinkSpeed:1.2,particleColors:[{color:"#FF6B35",weight:25},{color:"#FF1744",weight:20},{color:"#FFC107",weight:15},{color:"#FF9100",weight:15},{color:"#FFEB3B",weight:10},{color:"#FF5722",weight:10},{color:"#FFF59D",weight:5}]},modifiers:{speed:1.4,amplitude:1.3,intensity:1.3,smoothness:.8,regularity:.7,addVibration:!0},typicalGestures:["bounce","spin","vibrate","expand","shake","pulse"],transitions:{duration:300,easing:"easeOutElastic",priority:6},"3d":{rotation:{type:"unstable",speed:1.4,axes:[0,.4,0],shake:{amplitude:.01,frequency:4},musicSync:!1},glow:{color:"#FF6B35",intensity:1.5,pulse:{speed:2,range:[1,1.8]}},scale:{base:1,breathe:{enabled:!0,depth:.14,rate:2}}},soulAnimation:{driftSpeed:1.5,shimmerSpeed:2,turbulence:.5},rhythmModifiers:{windowMultiplier:1.2,visualNoise:.1,inputDelay:0,tempoShift:0}},{name:"resting",emoji:"üò¥",description:"Deep relaxation with slow drift",visual:{glowColor:"#9370DB",particleRate:1,minParticles:3,maxParticles:5,particleBehavior:"resting",breathRate:.8,breathDepth:.12,coreJitter:!1,blinkRate:.4,blinkSpeed:.7,particleColors:[{color:"#9370DB",weight:30},{color:"#A591C4",weight:20},{color:"#B366FF",weight:20},{color:"#B8A1E6",weight:15},{color:"#674D9B",weight:15}]},modifiers:{speed:.5,amplitude:.4,intensity:.5,smoothness:1.4,regularity:.9,addWeight:!0},typicalGestures:["breathe","drift","sway","float"],transitions:{duration:1e3,easing:"easeInOut",priority:2},"3d":{rotation:{type:"gentle",speed:.5,axes:[0,.15,0],musicSync:!1},glow:{color:"#9370DB",intensity:.8,pulse:{speed:.8,range:[.6,1]}},scale:{base:1,breathe:{enabled:!0,depth:.12,rate:.8}}},soulAnimation:{driftSpeed:.15,shimmerSpeed:.1,turbulence:.05},rhythmModifiers:{windowMultiplier:1.1,visualNoise:0,inputDelay:0,tempoShift:0}},{name:"euphoria",emoji:"üåü",description:"Radiant hope and new beginnings",visual:{glowColor:"#FFB6C1",particleRate:6,minParticles:15,maxParticles:30,particleBehavior:"radiant",breathRate:1.3,breathDepth:.25,coreJitter:!1,blinkRate:1.4,blinkSpeed:1.1,particleColors:[{color:"#FFB6C1",weight:20},{color:"#FFD700",weight:18},{color:"#87CEEB",weight:15},{color:"#DDA0DD",weight:15},{color:"#98FB98",weight:12},{color:"#FFA07A",weight:10},{color:"#E6E6FA",weight:8},{color:"#FFFFFF",weight:2}]},modifiers:{speed:1.4,amplitude:1.5,intensity:1.6,smoothness:1.3,regularity:.8,addWarmth:!0,addLift:!0},typicalGestures:["expand","radiate","pulse","glow","float","bloom"],transitions:{duration:600,easing:"easeOutExpo",priority:8},"3d":{rotation:{type:"rhythmic",speed:1.4,axes:[0,.35,0],musicSync:!0},glow:{color:"#FFB6C1",intensity:1.2,pulse:{speed:1.3,range:[.9,1.5]}},scale:{base:1,breathe:{enabled:!0,depth:.25,rate:1.3}}},soulAnimation:{driftSpeed:1.8,shimmerSpeed:2.5,turbulence:.7},rhythmModifiers:{windowMultiplier:1.5,visualNoise:0,inputDelay:0,tempoShift:0}},{name:"focused",emoji:"üéØ",description:"Intense concentration with directed flow",visual:{glowColor:"#00CED1",particleRate:4,minParticles:5,maxParticles:12,particleBehavior:"directed",breathRate:1.2,breathDepth:.08,coreJitter:!0,blinkRate:.7,blinkSpeed:1,particleColors:[{color:"#00CED1",weight:30},{color:"#4A9FA0",weight:20},{color:"#00FFFF",weight:20},{color:"#5FE5E7",weight:15},{color:"#006B6D",weight:15}],eyeOpenness:.7,microAdjustments:!0},modifiers:{speed:1,amplitude:.9,intensity:1.1,smoothness:1.1,regularity:1.2,addPrecision:!0},typicalGestures:["track","lock","scan","pulse","vibrate"],transitions:{duration:400,easing:"easeIn",priority:5},getCoreParams:e=>({scaleX:1.1,scaleY:.7,eyeOpenness:.7,eyeExpression:"focused",pupilOffset:{x:0,y:0},microAdjustments:!0}),"3d":{rotation:{type:"still",speed:.5,axes:[0,.1,0],musicSync:!1},glow:{color:"#00CED1",intensity:1.2,pulse:{speed:1.2,range:[1,1.3]}},scale:{base:1,breathe:{enabled:!0,depth:.08,rate:1.2}}},soulAnimation:{driftSpeed:.6,shimmerSpeed:.2,turbulence:.1},rhythmModifiers:{windowMultiplier:.85,visualNoise:0,inputDelay:0,tempoShift:0}},{name:"glitch",emoji:"üåà",description:"Surprised sadness with rainbow colors and glitch wiggle",visual:{primaryColor:"#FF6B9D",glowColor:"#4169E1",glowIntensity:1.2,particleRate:5,minParticles:5,maxParticles:15,particleBehavior:"burst",particleSpeed:1,breathRate:.4,breathDepth:.15,coreJitter:!1,coreSize:1,eyeOpenness:.8,blinkRate:1.3,blinkSpeed:1.2,particleColors:[{color:"#FF0080",weight:18},{color:"#00FF80",weight:18},{color:"#8000FF",weight:18},{color:"#FF8000",weight:15},{color:"#0080FF",weight:15},{color:"#FFFF00",weight:10},{color:"#FF6B9D",weight:6}],particleGlitchWiggle:!0,glitchWiggleIntensity:.3,glitchWiggleFrequency:.1},modifiers:{speed:1.1,amplitude:1,intensity:1.1,smoothness:.8,regularity:.7,focus:.6},typicalGestures:["bounce","sway","pulse","drift","flash"],transitions:{duration:300,easing:"easeInOut",priority:5},"3d":{rotation:{type:"unstable",speed:1.1,axes:[0,.35,0],shake:{amplitude:.02,frequency:5},musicSync:!1},glow:{color:"#FF6B9D",intensity:1.2,pulse:{speed:.4,range:[.8,1.6]}},scale:{base:1,breathe:{enabled:!0,depth:.15,rate:.4}}},rhythmModifiers:{windowMultiplier:1,visualNoise:.8,inputDelay:20,tempoShift:0}},n].forEach(e=>{e&&e.name&&r.set(e.name,e)});var v={registerEmotion:l,getEmotion:h,getEmotionVisualParams:c,getEmotionParams:c,getEmotionModifiers:u,getEmotionRhythmModifiers:b,getBlendedRhythmModifiers:w,listEmotions:d,getAllEmotions:p,hasEmotion:g,addEmotionAlias:m,getTransitionParams:y,getEmotionGestures:f,pluginAdapter:a},M=Object.freeze({__proto__:null,addEmotionAlias:m,default:v,getAllEmotions:p,getBlendedRhythmModifiers:w,getEmotion:h,getEmotionGestures:f,getEmotionModifiers:u,getEmotionRhythmModifiers:b,getEmotionVisualParams:c,getTransitionParams:y,hasEmotion:g,listEmotions:d,pluginAdapter:a,registerEmotion:l});const S=new Map;var x={registerPluginGesture:function(e,t){return!(!t.apply&&!t.type||(t.name||(t.name=e),t.type||(t.type="blending"),S.set(e,t),0))},unregisterPluginGesture:function(e){return!!S.has(e)&&(S.delete(e),!0)},getPluginGesture:function(e){return S.get(e)||null},getAllPluginGestures:function(){return Array.from(S.keys())},clearPluginGestures:function(){S.clear()},createLegacyAdapter:function(e){return{name:e.name||"unknown",type:e.type||"blending",emoji:e.emoji||"üîå",description:e.description||"Plugin gesture",config:e.config||{},apply(t,i,a,s,n,r){e.animate?e.animate(t,i,a,s,n,r):e.apply&&e.apply(t,i,a,s,n,r)},cleanup:e.cleanup||function(e){e.gestureData&&e.gestureData[this.name]&&delete e.gestureData[this.name]}}}},k={name:"breathe",emoji:"ü´Å",type:"blending",description:"Breathing rhythm with inhale and exhale",config:{musicalDuration:{musical:!0,bars:1,minBeats:2,maxBeats:16},phases:[{name:"inhale",beats:1.5},{name:"hold_in",beats:.5},{name:"exhale",beats:1.5},{name:"hold_out",beats:.5}],inhaleRadius:1.5,exhaleRadius:.3,breathRate:.3,spiralStrength:.002,scaleAmount:.25,glowAmount:.4,frequency:1,easing:"sine",strength:.8,particleMotion:{type:"breathe",strength:.8,inhaleRadius:1.5,exhaleRadius:.3}},rhythm:{enabled:!0,syncMode:"phrase",breathRateSync:{mode:"tempo",bpm:"auto",subdivision:"whole",curve:"sine"},radiusSync:{inhale:{onUpbeat:1.8,onDownbeat:1.4,curve:"ease-in"},exhale:{onUpbeat:.2,onDownbeat:.4,curve:"ease-out"}},durationSync:{mode:"phrases",phrases:2,hold:"fermata"},accentResponse:{enabled:!0,multiplier:1.5,type:"expansion"},patternOverrides:{ballad:{breathRateSync:{subdivision:"double-whole"},radiusSync:{inhale:{onUpbeat:2.2,onDownbeat:1.8},exhale:{onUpbeat:.1,onDownbeat:.2}}},uptempo:{breathRateSync:{subdivision:"half"},radiusSync:{inhale:{onUpbeat:1.4,onDownbeat:1.2},exhale:{onUpbeat:.3,onDownbeat:.4}}},ambient:{breathRateSync:{subdivision:"whole",curve:"ease"},radiusSync:{inhale:{onUpbeat:1.6,onDownbeat:1.6},exhale:{onUpbeat:.2,onDownbeat:.2}}}},dynamics:{forte:{radiusSync:{inhale:{multiplier:1.8},exhale:{multiplier:.5}},spiralStrength:.004,scaleAmount:.4},piano:{radiusSync:{inhale:{multiplier:1.2},exhale:{multiplier:.8}},spiralStrength:.001,scaleAmount:.1}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a;e.gestureData.breathe={startX:e.x,startY:e.y,angle:Math.atan2(n,s),baseRadius:Math.sqrt(s*s+n*n),phaseOffset:.2*Math.random()-.1}},apply(e,t,i,a,s,n){e.gestureData?.breathe||this.initialize(e,i,s,n);const r={...this.config,...i},o=(Math.sin(t*Math.PI*2*r.breathRate)+1)/2,l=100*(e.scaleFactor||1),h=r.inhaleRadius*l,c=r.exhaleRadius*l,u=c+(h-c)*o,d=e.x-s,p=e.y-n,g=Math.sqrt(d*d+p*p),m=u-g,y=.05*(i.strength||.8)*a;if(g>0){const t=d/g*m*y,s=p/g*m*y;e.vx+=t,e.vy+=s;const n=r.spiralStrength*a*(i.strength||1),l=-p/g,h=d/g;e.vx+=l*n*o,e.vy+=h*n*o}e.vx*=.98,e.vy*=.98},cleanup(e){e.gestureData?.breathe&&delete e.gestureData.breathe},"3d":{evaluate(e,t){const i=(t.config||{}).breathRate||.3,a=Math.sin(e*Math.PI*2*i);let s=1;if(e>.8){const t=(e-.8)/(1-.8);s=1-t*t*t}const n=.2*a*s;return{position:[0,.05*a*s,0],rotation:[0,0,0],scale:1+.35*a*s,glowIntensity:1+n,glowBoost:Math.max(0,2*n)}}}},O={name:"expand",emoji:"üí´",type:"blending",description:"Radial expansion from center",config:{duration:600,scaleAmount:3,scaleTarget:3,glowAmount:.5,easing:"back",strength:3,particleMotion:{type:"pulse",strength:3,direction:"outward",persist:!0}},rhythm:{enabled:!0,syncMode:"crescendo",strengthSync:{pianissimo:1.5,fortissimo:5,crescendo:"build",sforzando:"burst"},scaleTargetSync:{verse:2,chorus:4.5,climax:6,curve:"exponential"},durationSync:{mode:"phrases",build:1.2,release:.8,sustain:"hold"},accentResponse:{enabled:!0,multiplier:2.8,type:"strength"},patternOverrides:{orchestral:{strengthSync:{pianissimo:2,fortissimo:6.5,crescendo:"dramatic"},scaleTargetSync:{climax:8}},rock:{strengthSync:{pianissimo:1.8,fortissimo:5.5,curve:"power"},accentResponse:{multiplier:3.2}},ambient:{strengthSync:{pianissimo:1.2,fortissimo:3.5,crescendo:"organic"},durationSync:{build:1.8,release:1.2}},electronic:{strengthSync:{pianissimo:1.6,fortissimo:4.8,curve:"digital"},scaleTargetSync:{curve:"linear"}}},dynamics:{forte:{strengthSync:{pianissimo:{multiplier:1.4},fortissimo:{multiplier:1.8}},scaleTargetSync:{multiplier:1.6},accentResponse:{multiplier:3.5}},piano:{strengthSync:{pianissimo:{multiplier:.8},fortissimo:{multiplier:1.2}},scaleTargetSync:{multiplier:.7},accentResponse:{multiplier:2}}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a;e.gestureData.expand={startX:e.x,startY:e.y,angle:Math.atan2(n,s),baseRadius:Math.sqrt(s*s+n*n),initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.expand?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.expand,o={...this.config,...i},l=o.strength||1,h=1+(o.scaleTarget-1)*t*l,c=r.baseRadius*h,u=s+Math.cos(r.angle)*c,d=n+Math.sin(r.angle)*c,p=u-e.x,g=d-e.y;e.vx+=.8*p*a,e.vy+=.8*g*a,e.vx*=.95,e.vy*=.95},cleanup(e){e.gestureData?.expand&&delete e.gestureData.expand},"3d":{evaluate(e,t){const i={...this.config,...t},a=i.strength||3;return{position:[0,0,0],rotation:[0,0,0],scale:1+e*(i.scaleAmount||3)*(a/3),glowIntensity:1+.25*e,glowBoost:.8*e}}}},A={name:"contract",emoji:"üåÄ",type:"blending",description:"Radial contraction toward center",config:{duration:600,scaleAmount:.2,scaleTarget:.2,glowAmount:-.2,easing:"cubic",strength:2.5,particleMotion:{type:"pulse",strength:2.5,direction:"inward",persist:!0}},rhythm:{enabled:!0,syncMode:"tension",strengthSync:{onTension:4,onRelease:1.5,curve:"magnetic"},scaleTargetSync:{forte:.1,piano:.4,crescendo:"gradual",diminuendo:"ease"},durationSync:{mode:"phrases",shortPhrase:.8,longPhrase:1.5,hold:"sustain"},accentResponse:{enabled:!0,multiplier:2.2,type:"strength"},patternOverrides:{classical:{strengthSync:{onTension:3.5,onRelease:1.8},scaleTargetSync:{forte:.15,piano:.35}},metal:{strengthSync:{onTension:5,onRelease:2,curve:"sharp"},scaleTargetSync:{forte:.05,piano:.25}},ambient:{strengthSync:{onTension:2.8,onRelease:1.2,curve:"ease"},durationSync:{shortPhrase:1.2,longPhrase:2}},trap:{strengthSync:{onTension:4.5,onRelease:1,dropBeat:6},scaleTargetSync:{forte:.08,piano:.3}}},dynamics:{forte:{strengthSync:{onTension:{multiplier:1.8},onRelease:{multiplier:1.4}},scaleTargetSync:{multiplier:.6},accentResponse:{multiplier:2.8}},piano:{strengthSync:{onTension:{multiplier:.7},onRelease:{multiplier:.8}},scaleTargetSync:{multiplier:1.4},accentResponse:{multiplier:1.6}}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a;e.gestureData.contract={startX:e.x,startY:e.y,angle:Math.atan2(n,s),baseRadius:Math.sqrt(s*s+n*n),initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.contract?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.contract,o={...this.config,...i},l=o.strength||1,h=1-(1-o.scaleTarget)*t*l,c=r.baseRadius*h,u=s+Math.cos(r.angle)*c,d=n+Math.sin(r.angle)*c,p=u-e.x,g=d-e.y;e.vx+=.5*p*a,e.vy+=.5*g*a,e.vx*=.95,e.vy*=.95},cleanup(e){e.gestureData?.contract&&delete e.gestureData.contract},"3d":{evaluate(e,t){const i={...this.config,...t},a=i.strength||2.5,s=i.scaleTarget||.2,n=1-e*(1-s)*(a/2.5),r=1-.15*e;return{position:[0,0,0],rotation:[0,0,0],scale:Math.max(s,n),glowIntensity:r}}}},C={name:"pulse",emoji:"üíó",type:"blending",description:"Radial expansion and contraction from center",config:{duration:600,amplitude:30,frequency:1,holdPeak:.1,easing:"sine",scaleAmount:.2,glowAmount:.3,strength:.15,direction:"outward",particleMotion:{type:"pulse",strength:.15,direction:"outward",frequency:1}},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:1.6,offBeat:.8,curve:"pulse"},frequencySync:{mode:"locked",subdivision:"quarter"},durationSync:{mode:"beats",beats:1},accentResponse:{enabled:!0,multiplier:2},patternOverrides:{waltz:{amplitudeSync:{onBeat:2,offBeat:.5},durationSync:{beats:3}},swing:{amplitudeSync:{onBeat:1.8,offBeat:.6,curve:"ease"},frequencySync:{subdivision:"swing"}},dubstep:{amplitudeSync:{onBeat:1.2,dropBeat:4,curve:"pulse"}},breakbeat:{frequencySync:{mode:"random",range:[.5,2]},amplitudeSync:{onBeat:2.5,offBeat:.3}}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a,r=Math.sqrt(s*s+n*n),o=Math.atan2(n,s);e.gestureData.pulse={baseDistance:r,angle:o,startX:e.x,startY:e.y,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.pulse?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.pulse,o={...this.config,...i},l=i.strength||1,h=this.easeInOutSine(t);let c,{frequency:u}=o,{amplitude:d}=o;i.rhythmModulation&&(d*=i.rhythmModulation.amplitudeMultiplier||1,d*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(u*=i.rhythmModulation.frequencyMultiplier));const p=h*u*2%2;c=o.holdPeak>0&&p>1-o.holdPeak&&p<1+o.holdPeak?1:Math.sin(h*Math.PI*2*u);const g=c*d*l*e.scaleFactor,m=r.baseDistance+g,y=s+Math.cos(r.angle)*m,f=n+Math.sin(r.angle)*m,b=.15*a;if(e.vx+=(y-e.x)*b*.1,e.vy+=(f-e.y)*b*.1,t>.9){const i=1-10*(t-.9);e.vx*=.9+.1*i,e.vy*=.9+.1*i}},cleanup(e){e.gestureData?.pulse&&delete e.gestureData.pulse},easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,"3d":{evaluate(e,t){const i=t||{},a=i.frequency||1,s=i.strength||.15,n=i.scaleAmount||.2,r=i.glowAmount||.3,o=-(Math.cos(Math.PI*e)-1)/2,l=Math.sin(o*Math.PI*2*a);return{position:[0,0,0],rotation:[0,0,0],scale:1+l*n*s,glowIntensity:1+Math.max(-.3,Math.min(.3,l*r*s*2)),glowBoost:Math.max(0,.8*l)}}}},I={name:"sway",type:"blending",emoji:"üåä",description:"Gentle side-to-side swaying motion",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},amplitude:20,frequency:1,strength:.5},rhythm:{enabled:!0,syncMode:"bar",amplitudeSync:{onBeat:1.2,offBeat:.9,curve:"ease"},durationSync:{mode:"bars",bars:1},patternOverrides:{waltz:{durationSync:{bars:1},amplitudeSync:{onBeat:1.5,curve:"ease"}},swing:{amplitudeSync:{onBeat:1.3,offBeat:.7,curve:"bounce"}}}},apply(e,t,i,a,s,n){const r={...this.config,...i},o=r.amplitude||this.config.amplitude,l=r.frequency||this.config.frequency,h=r.strength||this.config.strength,c=Math.sin(t*Math.PI*2*l)*o;e.vx+=.01*c*a*h,e.vy+=.5*Math.cos(t*Math.PI*4)*a*h},cleanup(e){},"3d":{evaluate(e,t){const i={...this.config,...t};let a=i.amplitude||this.config.amplitude;const s=i.frequency||this.config.frequency,n=i.strength||this.config.strength;t.rhythmModulation&&(a*=t.rhythmModulation.amplitudeMultiplier||1,a*=t.rhythmModulation.accentMultiplier||1);const r=Math.sin(e*Math.PI*2*s),o=a*n*.3*.01,l=.15*r*n,h=.08*r*n;return{position:[r*o,.3*Math.cos(e*Math.PI*4)*o,Math.sin(e*Math.PI*s)*o*.5],rotation:[0,h,l],scale:1}}}},z={name:"float",type:"blending",emoji:"üéà",description:"Gentle floating upward motion",config:{duration:2e3,musicalDuration:{musical:!0,bars:2},amplitude:80,wobbleAmount:20,strength:1},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:1.5,offBeat:.8,curve:"bounce"},wobbleSync:{subdivision:"eighth",intensity:.7},durationSync:{mode:"bars",bars:2},accentResponse:{enabled:!0,multiplier:1.3},patternOverrides:{waltz:{wobbleSync:{subdivision:"quarter",intensity:.9}},dubstep:{amplitudeSync:{onBeat:2,curve:"pulse"}}}},apply(e,t,i,a,s,n){e.gestureData||(e.gestureData={}),e.gestureData.float||(e.gestureData.float={originalSize:e.size,originalOpacity:e.opacity||1});const r={...this.config,...i};let o=r.amplitude||this.config.amplitude,l=r.wobbleAmount||this.config.wobbleAmount;const h=r.strength||this.config.strength;i.rhythmModulation&&(o*=i.rhythmModulation.amplitudeMultiplier||1,o*=i.rhythmModulation.accentMultiplier||1,l*=i.rhythmModulation.wobbleMultiplier||1);const c=Math.sin(t*Math.PI*4)*l;e.vy-=.01*o*a*h*(1-.5*t),e.vx+=.01*c*a*h,e.size=e.baseSize*(1+.1*t),e.opacity=1-.3*t},cleanup(e){e.gestureData?.float?(e.opacity=e.gestureData.float.originalOpacity,e.size=e.gestureData.float.originalSize,delete e.gestureData.float):(e.opacity=1,e.size=e.baseSize),e.vx*=.5,e.vy*=.5},"3d":{evaluate(e,t){const i={...this.config,...t};let a=i.amplitude||this.config.amplitude,s=i.wobbleAmount||this.config.wobbleAmount;const n=i.strength||this.config.strength;t.rhythmModulation&&(a*=t.rhythmModulation.amplitudeMultiplier||1,a*=t.rhythmModulation.accentMultiplier||1,s*=t.rhythmModulation.wobbleMultiplier||1);const r=Math.sin(e*Math.PI),o=a*r*n*.005,l=Math.sin(e*Math.PI*4)*s*.3*.005,h=Math.sin(e*Math.PI)*Math.PI*.5*n,c=Math.sin(e*Math.PI);return{position:[l,o,0],rotation:[c*Math.sin(e*Math.PI*2)*.1,h,c*Math.cos(e*Math.PI*3)*.08],scale:1+.1*r}}}};const F={left:{x:-1,y:0},right:{x:1,y:0},up:{x:0,y:1},down:{x:0,y:-1}};function D(e){return e.charAt(0).toUpperCase()+e.slice(1)}function q(e){const t=F[e];if(!t)throw new Error(`Invalid float direction: ${e}`);const i="up"===e||"down"===e;return{name:`float${D(e)}`,emoji:"up"===e?"üéà":"down"===e?"üçÇ":"left"===e?"üå¨Ô∏è":"üí®",type:"blending",description:`Gentle floating ${e}`,config:{duration:2e3,amplitude:80,wobbleAmount:20,strength:1,direction:e},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:1.5,offBeat:.8,curve:"bounce"},wobbleSync:{subdivision:"eighth",intensity:.7},durationSync:{mode:"bars",bars:2},accentResponse:{enabled:!0,multiplier:1.3}},apply(e,a,s,n,r,o){e.gestureData||(e.gestureData={}),e.gestureData.float||(e.gestureData.float={originalSize:e.size,originalOpacity:e.opacity||1});const l={...this.config,...s};let h=l.amplitude||80,c=l.wobbleAmount||20;const u=l.strength||1;s.rhythmModulation&&(h*=s.rhythmModulation.amplitudeMultiplier||1,h*=s.rhythmModulation.accentMultiplier||1,c*=s.rhythmModulation.wobbleMultiplier||1);const d=Math.sin(a*Math.PI*4)*c,p=.01*h*n*u*(1-.5*a);i?(e.vy+=t.y*p,e.vx+=.01*d*n*u):(e.vx+=t.x*p,e.vy+=.01*d*n*u),e.size=e.baseSize*(1+.1*a),e.opacity=1-.3*a},cleanup(e){e.gestureData?.float?(e.opacity=e.gestureData.float.originalOpacity,e.size=e.gestureData.float.originalSize,delete e.gestureData.float):(e.opacity=1,e.size=e.baseSize),e.vx*=.5,e.vy*=.5},"3d":{evaluate(e,a){const s=a||{};let n=s.amplitude||80,r=s.wobbleAmount||20;const o=s.strength||1;a.rhythmModulation&&(n*=a.rhythmModulation.amplitudeMultiplier||1,n*=a.rhythmModulation.accentMultiplier||1,r*=a.rhythmModulation.wobbleMultiplier||1);const l=Math.sin(e*Math.PI),h=n*l*o*.005,c=Math.sin(e*Math.PI*4)*r*.3*.005,u=Math.sin(e*Math.PI)*Math.PI*.5*o,d=Math.sin(e*Math.PI),p=d*Math.sin(e*Math.PI*2)*.1,g=d*Math.cos(e*Math.PI*3)*.08,m=1+.1*l;let y=0,f=0;return i?(f=t.y*h,y=c):(y=t.x*h,f=c),{cameraRelativePosition:[y,f,0],rotation:[p,u,g],scale:m}}}}}var R=q("up"),B=q("down"),E=q("left"),P=q("right"),T={name:"lean",emoji:"‚ÜóÔ∏è",type:"blending",description:"Diagonal tilting motion with smooth return",config:{duration:1200,musicalDuration:{musical:!0,beats:2},amplitude:10,frequency:1,direction:"right",strength:.7,particleMotion:{type:"lean",direction:"right",strength:.7,frequency:1}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:3,blendable:!0,crossfadePoint:"anyBeat",amplitudeSync:{onBeat:1.3,offBeat:.8,curve:"ease"},durationSync:{mode:"beats",beats:2},accentResponse:{enabled:!0,multiplier:1.4},patternOverrides:{waltz:{durationSync:{beats:3},amplitudeSync:{onBeat:1.5,offBeat:.6}},swing:{amplitudeSync:{onBeat:1.6,offBeat:.5,curve:"bounce"}}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.lean={startX:e.x,startY:e.y,startVx:e.vx,startVy:e.vy,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.lean?.initialized||this.initialize(e,i);const r={...this.config,...i},o=r.strength||this.config.strength||1,l=this.easeInOutCubic(t),h=r.frequency||this.config.frequency;let c=r.amplitude*o*e.scaleFactor;i.rhythmModulation&&(c*=i.rhythmModulation.amplitudeMultiplier||1,c*=i.rhythmModulation.accentMultiplier||1);const u=Math.sin(l*Math.PI*h),d="left"===r.direction?-1:1;if(e.vx+=u*c*.015*a*d,e.vy+=u*c*.01*a*d*.5,t>.9){const i=1-10*(t-.9);e.vx=e.vx*(.95+.05*i),e.vy=e.vy*(.95+.05*i)}},cleanup(e){e.gestureData?.lean&&delete e.gestureData.lean},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,t){const i=t||{},a=i.amplitude||10,s=i.frequency||1,n=i.strength||.7,r=i.direction||"right",o=.003*a*n,l=e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,h=Math.sin(l*Math.PI*s),c="left"===r?-1:1;return{position:[h*o*c,0,0],rotation:[0,0,.35*h*c],scale:1}}}};function j(e){if("left"!==e&&"right"!==e)throw new Error(`Invalid lean direction: ${e}. Only 'left' and 'right' are supported.`);const t=F[e];return{name:`lean${D(e)}`,emoji:"left"===e?"‚ÜñÔ∏è":"‚ÜóÔ∏è",type:"blending",description:`Lean ${e} with smooth return`,config:{duration:800,amplitude:10,frequency:1,strength:.7,direction:e},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:3,blendable:!0,durationSync:{mode:"beats",beats:2},amplitudeSync:{onBeat:1.3,offBeat:.8,curve:"ease"},accentResponse:{enabled:!0,multiplier:1.4}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.lean={startX:e.x,startY:e.y,initialized:!0}},apply(e,i,a,s,n,r){e.gestureData?.lean?.initialized||this.initialize(e,a);const o={...this.config,...a},l=o.strength||.7,h=this.easeInOutCubic(i);let c=o.amplitude*l*e.scaleFactor;a.rhythmModulation&&(c*=a.rhythmModulation.amplitudeMultiplier||1,c*=a.rhythmModulation.accentMultiplier||1);const u=Math.sin(h*Math.PI*o.frequency);if(e.vx+=u*c*.015*s*t.x,e.vy+=u*c*.01*s*t.x*.5,i>.9){const t=1-10*(i-.9);e.vx*=.95+.05*t,e.vy*=.95+.05*t}},cleanup(e){e.gestureData?.lean&&delete e.gestureData.lean},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,i){const a=i||{},s=a.amplitude||10,n=a.frequency||1,r=.003*s*(a.strength||.7),o=e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,l=Math.sin(o*Math.PI*n),h=.35*l*t.x;return{cameraRelativePosition:[l*r*t.x,0,0],cameraRelativeRotation:[0,0,h],scale:1}}}}}var V=j("left"),$=j("right"),W={name:"jitter",type:"blending",emoji:"ü´®",description:"Nervous jittery movement",config:{duration:1e3,musicalDuration:{musical:!0,beats:2},intensity:15,frequency:30,strength:1},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2},amplitudeSync:{onBeat:2,offBeat:.5,curve:"pulse"},patternOverrides:{breakbeat:{amplitudeSync:{onBeat:3,offBeat:.3}},dubstep:{amplitudeSync:{onBeat:5,offBeat:.1,curve:"pulse"}}}},apply(e,t,i,a,s,n){e.gestureData||(e.gestureData={}),e.gestureData.jitter||(e.gestureData.jitter={originalSize:e.size});const r={...this.config,...i};let o=r.intensity||this.config.intensity;const l=r.strength||this.config.strength;i.rhythmModulation&&(o*=i.rhythmModulation.amplitudeMultiplier||1,o*=i.rhythmModulation.accentMultiplier||1);const h=(Math.random()-.5)*o*l,c=(Math.random()-.5)*o*l,u=1-.5*t;e.vx+=.1*h*a*u,e.vy+=.1*c*a*u,e.size=e.baseSize*(1+.1*(Math.random()-.5))},cleanup(e){e.gestureData?.jitter?(e.size=e.gestureData.jitter.originalSize,delete e.gestureData.jitter):e.size=e.baseSize,e.vx*=.7,e.vy*=.7},"3d":{evaluate(e,t){const i={...this.config,...t};let a=i.intensity||this.config.intensity;const s=i.strength||this.config.strength;t.rhythmModulation&&(a*=t.rhythmModulation.amplitudeMultiplier||1,a*=t.rhythmModulation.accentMultiplier||1);const n=Math.sin(e*Math.PI),r=a*s*.002*n;return{position:[(Math.random()-.5)*r,(Math.random()-.5)*r,(Math.random()-.5)*r],rotation:[.005*(Math.random()-.5)*n,.005*(Math.random()-.5)*n,.005*(Math.random()-.5)*n],scale:1+.02*(Math.random()-.5)*n}}}},G={name:"twitch",emoji:"‚ö°",type:"blending",description:"Nervous, paranoid twitching",config:{intensity:8,frequency:.08,duration:100,musicalDuration:{musical:!0,beats:.5},recovery:200,maxOffset:15,sharpness:.9},rhythm:{enabled:!0,syncMode:"subdivision",durationSync:{mode:"beats",beats:.5},probabilitySync:{subdivision:"sixteenth",onBeat:.3,offBeat:.05,accentBoost:2},intensitySync:{onBeat:2,offBeat:.8,curve:"pulse"},patternOverrides:{breakbeat:{probabilitySync:{onBeat:.5,offBeat:.1},intensitySync:{onBeat:3,offBeat:.5}},dubstep:{intensitySync:{onBeat:1.5,dropBeat:5,curve:"pulse"}}}},apply(e,t,i,a,s,n){e.gestureData||(e.gestureData={}),e.gestureData.twitch||(e.gestureData.twitch={twitchOffset:{x:0,y:0},targetOffset:{x:0,y:0},isTwitching:!1,twitchTimer:0,cooldownTimer:0,lastTwitch:0});const r=e.gestureData.twitch,{config:o}=this;let l=i.intensity||o.intensity;i.rhythmModulation&&(l*=i.rhythmModulation.amplitudeMultiplier||1,l*=i.rhythmModulation.accentMultiplier||1);const h=Date.now();if(!r.isTwitching&&r.cooldownTimer<=0&&Math.random()<(i.frequency||o.frequency)){r.isTwitching=!0,r.twitchTimer=o.duration,r.cooldownTimer=o.recovery;const e=Math.random()*Math.PI*2,t=.5*o.maxOffset+Math.random()*(.5*o.maxOffset);r.targetOffset={x:Math.cos(e)*t*l/8,y:Math.sin(e)*t*l/8},r.lastTwitch=h}if(r.cooldownTimer>0&&(r.cooldownTimer-=16*a),r.isTwitching)if(r.twitchTimer-=16*a,r.twitchTimer>0){const{sharpness:e}=o;r.twitchOffset.x+=(r.targetOffset.x-r.twitchOffset.x)*e,r.twitchOffset.y+=(r.targetOffset.y-r.twitchOffset.y)*e}else r.isTwitching=!1;else r.twitchOffset.x*=.85,r.twitchOffset.y*=.85;e.vx+=r.twitchOffset.x*a*.5,e.vy+=r.twitchOffset.y*a*.5,Math.random()<.1&&(e.vx+=(Math.random()-.5)*l*.3,e.vy+=(Math.random()-.5)*l*.3)},cleanup(e){e.gestureData?.twitch&&delete e.gestureData.twitch},"3d":{evaluate(e,t){const i=t.config||{};let a=.6*(i.intensity||8);const s=i.maxOffset||15,n=i.frequency||.08;t.rhythmModulation&&(a*=t.rhythmModulation.amplitudeMultiplier||1,a*=t.rhythmModulation.accentMultiplier||1);const r=9999*Math.floor(10*e),o=e=>{const t=1e4*Math.sin(r+e);return t-Math.floor(t)};if(o(0)<3*n){const e=o(1)*Math.PI*2,t=s*a/8*.003;return{position:[Math.cos(e)*t*o(2),Math.sin(e)*t*o(3),(o(4)-.5)*t],rotation:[.12*(o(5)-.5),.12*(o(6)-.5),.12*(o(7)-.5)],scale:1+.06*(o(8)-.5)}}{const e=.3;return{position:[(o(10)-.5)*e,(o(11)-.5)*e,(o(12)-.5)*e],rotation:[.006*(o(13)-.5),.006*(o(14)-.5),.006*(o(15)-.5)],scale:1}}}}},L={name:"vibrate",emoji:"üì≥",type:"blending",description:"High frequency vibration",config:{duration:500,frequency:20,amplitude:8,easing:"linear",strength:2,particleMotion:{type:"shake",strength:2,frequency:20,amplitude:8}},rhythm:{enabled:!0,syncMode:"subdivision",frequencySync:{subdivision:"thirty-second",baseFrequency:20,tempoScaling:!0},amplitudeSync:{onBeat:1.5,offBeat:.8,curve:"pulse"},durationSync:{mode:"beats",beats:1},patternOverrides:{dubstep:{frequencySync:{subdivision:"sixteenth"},amplitudeSync:{onBeat:2,dropBeat:3}},breakbeat:{frequencySync:{mode:"random",range:[15,30]}}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.vibrate={timer:0,seed:1e3*Math.random(),initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.vibrate?.initialized||this.initialize(e,i);const r=e.gestureData.vibrate,o={...this.config,...i},l=o.strength||this.config.strength||1;let{amplitude:h}=o,{frequency:c}=o;i.rhythmModulation&&(h*=i.rhythmModulation.amplitudeMultiplier||1,h*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(c*=i.rhythmModulation.frequencyMultiplier)),r.timer+=a*c;const u=(Math.random()-.5)*h*l,d=(Math.random()-.5)*h*l;if(e.vx+=.5*u*a,e.vy+=.5*d*a,e.vx*=.9,e.vy*=.9,t>.8){const i=1-5*(t-.8);e.vx*=i,e.vy*=i}},cleanup(e){e.gestureData?.vibrate&&delete e.gestureData.vibrate},"3d":{evaluate(e,t){const i={...this.config,...t};let{amplitude:a}=i;const s=i.strength||this.config.strength||1;t.rhythmModulation&&(a*=t.rhythmModulation.amplitudeMultiplier||1,a*=t.rhythmModulation.accentMultiplier||1);const n=Math.sin(e*Math.PI),r=a*s*.003*n;return{position:[(Math.random()-.5)*r,(Math.random()-.5)*r,(Math.random()-.5)*r],rotation:[.01*(Math.random()-.5)*n,.01*(Math.random()-.5)*n,.01*(Math.random()-.5)*n],scale:1+.01*(Math.random()-.5)*n}}}},_={name:"shake",emoji:"ü´®",type:"blending",description:"Random jitter movement for vibration effects",config:{duration:400,amplitude:15,frequency:15,decay:.9,smoothing:.1,axes:"both",easing:"linear",strength:3,particleMotion:{type:"shake",strength:3,frequency:15,decay:!1}},rhythm:{enabled:!0,syncMode:"subdivision",amplitudeSync:{subdivision:"sixteenth",onBeat:2.5,offBeat:.7,curve:"pulse"},frequencySync:{mode:"tempo",baseFrequency:15,scaling:"linear"},durationSync:{mode:"beats",beats:2},patternOverrides:{breakbeat:{amplitudeSync:{onBeat:3,offBeat:.2},frequencySync:{mode:"random",range:[8,20]}},dubstep:{amplitudeSync:{subdivision:"eighth",onBeat:4,dropBeat:6,curve:"pulse"}},swing:{amplitudeSync:{onBeat:1.8,offBeat:1,curve:"ease"}}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.shake={originalX:e.x,originalY:e.y,randomAngle:Math.random()*Math.PI*2,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.shake?.initialized||this.initialize(e,i);const r=e.gestureData.shake,o={...this.config,...i},l=o.strength||this.config.strength||1;let{amplitude:h}=o,{frequency:c}=o;i.rhythmModulation&&(h*=i.rhythmModulation.amplitudeMultiplier||1,h*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(c*=i.rhythmModulation.frequencyMultiplier));const u=o.decay?1-t:1,d=Math.sin(t*Math.PI*c)*h*u*l*e.scaleFactor,p=d*Math.cos(r.randomAngle),g=d*Math.sin(r.randomAngle);e.x=r.originalX+p,e.y=r.originalY+g},pseudoRandom(e){const t=1e4*Math.sin(e);return t-Math.floor(t)},cleanup(e){e.gestureData?.shake&&(e.x=e.gestureData.shake.originalX,e.y=e.gestureData.shake.originalY,delete e.gestureData.shake)},"3d":{evaluate(e,t){const i=t||{},a=.003*(i.amplitude||15),s=i.frequency||15,n=.5*(i.strength||1),r=i.decay?1-e:1,o=Math.sin(e*Math.PI*s)*a*r*n,l=Math.floor(e*s);return{position:[o*(1e4*Math.sin(l)%1-.5)*2,0,o*(1e4*Math.sin(1.3*l)%1-.5)*2],rotation:[0,0,o*(1e4*Math.sin(1.7*l)%1-.5)*.2],scale:1}}}},H={name:"wiggle",emoji:"„Ä∞Ô∏è",type:"additive",description:"Rapid side-to-side oscillation",config:{duration:600,musicalDuration:{musical:!0,beats:1},amplitude:15,frequency:6,strength:1,damping:.3,easing:"linear",particleMotion:{type:"wiggle",strength:1,amplitude:15,frequency:6}},rhythm:{enabled:!0,syncMode:"beat",frequencySync:{subdivision:"sixteenth",wigglePerBeat:4},amplitudeSync:{onBeat:1.5,offBeat:.8,curve:"bounce"},durationSync:{mode:"beats",beats:1}},apply(e,t,i,a,s,n,r){const o=(i.amplitude||this.config.amplitude)*s,l=i.frequency||this.config.frequency,h=1-a*(i.damping||this.config.damping),c=Math.sin(a*Math.PI*l)*o*h;e.vx+=.5*c;const u=Math.cos(a*Math.PI*l*2)*o*.1*h;e.vy+=.3*u},"3d":{evaluate(e,t){const i=t.config||{},a=t.strength||1,s=i.amplitude||15,n=Math.pow(1-e,.5),r=Math.sin(e*Math.PI*14)*n,o=Math.cos(e*Math.PI*14*.7)*n*.4,l=s/15*a,h=.15*r*a;return{cameraRelativePosition:[.08*r*l,.02*Math.abs(o)*l,0],cameraRelativeRotation:[0,0,h],scale:1+.05*Math.abs(r),glowIntensity:1+.2*Math.abs(r)}}}};function U(e){const t=F[e];if(!t)throw new Error(`Invalid step direction: ${e}`);return{name:`step${D(e)}`,emoji:"left"===e?"üëà":"right"===e?"üëâ":"up"===e?"üëÜ":"üëá",type:"blending",description:`Quick step ${e} and return`,config:{duration:400,amplitude:25,strength:.7,direction:e},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:5,blendable:!0,durationSync:{mode:"beats",beats:1},amplitudeSync:{onBeat:1.4,offBeat:.8,curve:"snap"}},apply(e,i,a,s,n,r){const o={...this.config,...a};let l,h=o.amplitude*o.strength*e.scaleFactor;a.rhythmModulation&&(h*=a.rhythmModulation.amplitudeMultiplier||1,h*=a.rhythmModulation.accentMultiplier||1),l=i<.3?this.easeOutQuad(i/.3):1-this.easeInOutCubic((i-.3)/.7);const c=t.x*h*l*.01*s,u=t.y*h*l*.01*s;e.vx+=c,e.vy+=u},cleanup(e){},easeOutQuad:e=>1-(1-e)*(1-e),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,i){const a=i||{},s=a.amplitude||25,n=a.strength||.7;let r,o=.008*s*n;if(i.rhythmModulation&&(o*=i.rhythmModulation.amplitudeMultiplier||1),e<.3)r=1-(1-e/.3)*(1-e/.3);else{const t=(e-.3)/.7;r=1-(t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2)}const l=t.x*o*r,h=t.y*o*r,c=.12*r*n,u=-t.x*c;return{cameraRelativePosition:[l,h,0],rotation:[t.y*c*.5,0,u],scale:1}}}}}function Q(e){const t=F[e];if(!t)throw new Error(`Invalid slide direction: ${e}`);return{name:`slide${D(e)}`,emoji:"left"===e?"‚¨ÖÔ∏è":"‚û°Ô∏è",type:"blending",description:`Smooth slide ${e} and return`,config:{duration:800,amplitude:35,strength:.6,direction:e},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:4,blendable:!0,durationSync:{mode:"beats",beats:2},amplitudeSync:{onBeat:1.2,offBeat:.9,curve:"ease"}},apply(e,i,a,s,n,r){const o={...this.config,...a};let l=o.amplitude*o.strength*e.scaleFactor;a.rhythmModulation&&(l*=a.rhythmModulation.amplitudeMultiplier||1,l*=a.rhythmModulation.accentMultiplier||1);const h=Math.sin(i*Math.PI),c=t.x*l*h*.008*s,u=t.y*l*h*.008*s;e.vx+=c,e.vy+=u},cleanup(e){},"3d":{evaluate(e,i){const a=i||{},s=a.amplitude||35,n=a.strength||.6;let r=.008*s*n;i.rhythmModulation&&(r*=i.rhythmModulation.amplitudeMultiplier||1);const o=Math.sin(e*Math.PI),l=t.x*r*o,h=t.y*r*o,c=.08*o*n,u=-t.x*c,d=t.x*c*.5;return{cameraRelativePosition:[l,h,.02*Math.sin(e*Math.PI*2)*n],rotation:[0,d,u],scale:1+.03*o}}}}}var Y=U("left"),X=U("right"),N=U("up"),J=U("down"),Z=Q("left"),K=Q("right"),ee={name:"runningman",emoji:"üèÉ",type:"effect",description:"Hip-hop running man shuffle",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},slideDistance:30,stepHeight:15,speed:1.2,strength:.8,particleMotion:{type:"runningman",strength:.7}},rhythm:{enabled:!0,syncToBeat:!0,durationSync:{mode:"bars",bars:1},beatMultiplier:1,accentBeats:[1,3]},apply:(e,t,i,a,s,n)=>!1,blend:(e,t,i)=>!1,"3d":{evaluate(e,t){const i={...this.config,...t}.strength||.8;return{position:[.1*Math.sin(e*Math.PI*4)*i,.05*Math.abs(Math.sin(e*Math.PI*8))*i,0],rotation:[0,0,.035*Math.sin(e*Math.PI*4)*i],scale:1-.035*Math.abs(Math.sin(e*Math.PI*8))*i,glowIntensity:1+.25*Math.abs(Math.sin(e*Math.PI*8)),glowBoost:.35*Math.max(0,Math.abs(Math.sin(e*Math.PI*8)))}}}},te={name:"charleston",emoji:"üï∫",type:"effect",description:"Hip-hop Charleston shuffle with crisscross",config:{duration:2500,musicalDuration:{musical:!0,bars:1.5},kickDistance:35,swivelRange:40,bounceHeight:12,strength:.9,particleMotion:{type:"charleston",strength:.8}},rhythm:{enabled:!0,syncToBeat:!0,durationSync:{mode:"bars",bars:1.5},beatMultiplier:2,accentBeats:[1,2.5,3,4.5]},apply:(e,t,i,a,s,n)=>!1,blend:(e,t,i)=>!1,"3d":{evaluate(e,t){const i={...this.config,...t}.strength||.9;return{position:[.12*Math.sin(e*Math.PI*8)*i,.05*Math.abs(Math.sin(e*Math.PI*8))*i,0],rotation:[0,0,.05*Math.sin(e*Math.PI*8)*i],scale:1-.04*Math.abs(Math.sin(e*Math.PI*8))*i,glowIntensity:1+.3*Math.abs(Math.sin(e*Math.PI*8)),glowBoost:.4*Math.max(0,Math.abs(Math.sin(e*Math.PI*8)))}}}},ie={name:"hula",emoji:"üåÄ",type:"override",description:"Hula-hoop motion with vertical waves",config:{speed:.015,maintainRadius:!1,elliptical:!0,use3D:!0,zPhaseOffset:Math.PI/4,verticalOscillation:.3,wobbleAmount:.15,duration:2500,musicalDuration:{musical:!0,bars:1.5},particleMotion:{type:"hula",strength:1,verticalOscillation:.3}},rhythm:{enabled:!0,syncMode:"bar",durationSync:{mode:"bars",bars:1.5},speedSync:{mode:"tempo",baseSpeed:.015,scaling:"proportional"},wobbleSync:{onBeat:.25,offBeat:.1,curve:"sine"},verticalSync:{subdivision:"quarter",amplitude:.4,phase:"sequential"},dynamics:{forte:{wobbleAmount:.3,speed:1.2},piano:{wobbleAmount:.05,speed:.8}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a,r=Math.sqrt(s*s+n*n),o=Math.random()<.5?1:-1,l=Math.max(r,100+180*Math.random()),h=r<5?Math.random()*Math.PI*2:Math.atan2(n,s);e.gestureData.hula={radius:l,angle:h,initialAngle:h,originalVx:e.vx,originalVy:e.vy,originalZ:e.z||0,zPhase:Math.random()*Math.PI*2,wobblePhase:Math.random()*Math.PI*2,direction:o}},apply(e,t,i,a,s,n){e.gestureData?.hula||this.initialize(e,i,s,n);const r=e.gestureData.hula,o=(i.speed||this.config.speed)*(i.strength||1);let l=1;t<.1?(l=t/.1,l=Math.sin(l*Math.PI*.5)):t>.9&&(l=(1-t)/.1,l=Math.sin(l*Math.PI*.5)),r.angle+=o*a*r.direction*l;const h=Math.sin(2*r.angle+r.wobblePhase)*(i.wobbleAmount||this.config.wobbleAmount)*l,c=r.radius*(1+h)*l,u=r.radius*(.7+h)*l,d=s+Math.cos(r.angle)*c,p=n+Math.sin(r.angle)*u;if(t<.1){const t=e.x-s,i=e.y-n;Math.sqrt(t*t+i*i)<50?(e.x=s+Math.cos(r.angle)*c,e.y=n+Math.sin(r.angle)*u):(e.x=e.x+(d-e.x)*l*.5,e.y=e.y+(p-e.y)*l*.5)}else e.x=d,e.y=p;const g=r.angle+r.zPhase+(i.zPhaseOffset||this.config.zPhaseOffset);e.z=.9*Math.sin(g)*l;const m=i.verticalOscillation||this.config.verticalOscillation,y=Math.cos(2*g)*m*r.radius*.2*l;e.y+=y;const f=e.z*r.radius*.1;e.y-=f;const b=-Math.sin(r.angle)*c*o,w=Math.cos(r.angle)*u*o;t<.1?(e.vx=r.originalVx+(b-r.originalVx)*l,e.vy=r.originalVy+(w-r.originalVy)*l):t>.9?(e.vx=b*l+r.originalVx*(1-l),e.vy=w*l+r.originalVy*(1-l),e.z=e.z*l+r.originalZ*(1-l)):(e.vx=b,e.vy=w)},cleanup(e){if(e.gestureData?.hula){const t=e.gestureData.hula;e.vx=t.originalVx,e.vy=t.originalVy,e.z=t.originalZ,delete e.gestureData.hula}},"3d":{evaluate(e,t){const{particle:i}=t;if(!i||!i.gestureData?.hula)return{position:[0,0,0],rotation:[0,0,0],scale:1};const a=i.gestureData.hula,s=t.config||{};let n=1;e<.15?(n=e/.15,n=Math.sin(n*Math.PI*.5)):e>.85&&(n=(1-e)/.15,n=Math.sin(n*Math.PI*.5));const r=a.initialAngle+e*Math.PI*2*a.direction,o=.25*Math.cos(r)*n,l=.25*Math.sin(r)*n,h=s.verticalOscillation||.3;return{position:[o,Math.sin(2*r+a.wobblePhase)*h*n,l],rotation:[0,(r-a.initialAngle)*n,0],scale:1+.15*Math.abs(Math.sin(r))*n}}}},ae={name:"twist",emoji:"üåÄ",type:"override",description:"Twisting dance motion with alternating rotation",config:{duration:1200,musicalDuration:{musical:!0,beats:3},rotationAngle:45,contractionFactor:.8,twistFrequency:2,easing:"smooth",strength:.8,particleMotion:{type:"twist",rotationAngle:45,contractionFactor:.8,twistFrequency:2}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:3},timingSync:"nextBeat",interruptible:!0,priority:4,blendable:!1,crossfadePoint:"anyBeat",amplitudeSync:{onBeat:1.5,offBeat:.7,curve:"elastic"},patternOverrides:{funk:{rotationAngle:60,contractionFactor:.7},disco:{twistFrequency:3,rotationAngle:50},latin:{rotationAngle:35,contractionFactor:.85,twistFrequency:2.5}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.twist={startX:e.x,startY:e.y,startAngle:Math.atan2(e.y-t.centerY,e.x-t.centerX),startDistance:Math.sqrt(Math.pow(e.x-t.centerX,2)+Math.pow(e.y-t.centerY,2)),initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.twist?.initialized||this.initialize(e,{...i,centerX:s,centerY:n});const r={...this.config,...i},o=e.gestureData.twist,l=r.strength||this.config.strength||1,h=t*r.twistFrequency*Math.PI*2,c=Math.sin(h)*l;let{rotationAngle:u}=r,{contractionFactor:d}=r;i.rhythmModulation&&(u*=i.rhythmModulation.amplitudeMultiplier||1,d=1-(1-d)*(i.rhythmModulation.amplitudeMultiplier||1));const p=u*Math.PI/180*c,g=1-(1-d)*Math.abs(c),m=o.startAngle+p,y=o.startDistance*g,f=s+Math.cos(m)*y,b=n+Math.sin(m)*y,w=.15*l;e.x+=(f-e.x)*w,e.y+=(b-e.y)*w,e.vx=.05*(f-e.x),e.vy=.05*(b-e.y);const v=5*Math.sin(t*Math.PI*4)*l;if(e.y+=.1*v,t>.9){const i=1-10*(t-.9);e.vx*=i,e.vy*=i}},cleanup(e){e.gestureData?.twist&&delete e.gestureData.twist},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||.8,s=e>.85?(1-e)/.15:1,n=e*(i.twistFrequency||2)*Math.PI*2,r=Math.sin(n)*a*s,o=r*((i.rotationAngle||45)*Math.PI/180);return{position:[.05*Math.sin(n)*a*s,.02*Math.abs(Math.sin(2*n))*a*s,0],rotation:[.08*Math.cos(n)*a*s,o,.12*Math.sin(.5*n)*a*s],scale:1-(1-(i.contractionFactor||.8))*Math.abs(r),glowIntensity:1+.3*Math.abs(r)}}}},se={name:"pop",emoji:"üí•",type:"blending",description:"Quick scale pulse - the classic beat hit",config:{duration:200,musicalDuration:{musical:!0,beats:.5},strength:1},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",durationSync:{mode:"beats",beats:.5},interruptible:!0,priority:5,blendable:!0},apply:(e,t,i)=>!1,blend:(e,t,i)=>!1,"3d":{isAccent:!0,evaluate(e,t){const i=t?.strength||1;let a;return e<.15?(a=e/.15,a=1-Math.pow(1-a,3)):(a=1-(e-.15)/.85,a=Math.pow(a,2)),{position:[0,0,0],rotation:[0,0,0],scale:1,scaleBoost:1+.08*a*i,glowBoost:.3*a*i,positionBoost:[0,.02*a*i,0]}}}},ne={name:"flare",emoji:"üî•",type:"blending",description:"Dramatic scale burst with intense glow - for big moments",config:{duration:400,musicalDuration:{musical:!0,beats:1},strength:1},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",durationSync:{mode:"beats",beats:1},interruptible:!0,priority:6,blendable:!0},apply:(e,t,i)=>!1,blend:(e,t,i)=>!1,"3d":{isAccent:!0,evaluate(e,t){const i=t?.strength||1;let a;if(e<.1){const t=e/.1;a=1-Math.pow(1-t,4)}else if(e<.3){const t=(e-.1)/.2;a=1-.1*Math.sin(t*Math.PI)}else a=1-(e-.3)/.7,a=Math.pow(a,.6);return{position:[0,0,0],rotation:[0,0,0],scale:1,scaleBoost:1+(.15*a+.15*Math.sin(e*Math.PI*4)*(1-e)*.02)*i,glowBoost:.8*a*i,positionBoost:[0,.04*a*i,0]}}}},re={name:"swell",emoji:"üåü",type:"blending",description:"Glow build with scale - for transitions and builds",config:{duration:600,musicalDuration:{musical:!0,beats:1.5},strength:1},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",durationSync:{mode:"beats",beats:1.5},interruptible:!0,priority:4,blendable:!0},apply:(e,t,i)=>!1,blend:(e,t,i)=>!1,"3d":{isAccent:!0,evaluate(e,t){const i=t?.strength||1;let a;if(e<.6){const t=e/.6;a=t*t}else{const t=(e-.6)/.4;a=1-t*t}return{position:[0,0,0],rotation:[0,0,0],scale:1,scaleBoost:1+.1*a*i,glowBoost:.4*a*i,positionBoost:[0,.03*Math.sin(e*Math.PI)*i,0]}}}},oe={name:"swagger",emoji:"üòé",type:"blending",description:"Side lean with drift - confident swagger",config:{duration:400,musicalDuration:{musical:!0,beats:1},strength:1},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",durationSync:{mode:"beats",beats:1},interruptible:!0,priority:4,blendable:!0},apply:(e,t,i)=>!1,blend:(e,t,i)=>!1,"3d":{isAccent:!0,evaluate(e,t){const i=t?.strength||1;let a;if(e<.3){const t=e/.3;a=1-Math.pow(1-t,2)}else if(e<.7)a=1;else{const t=(e-.7)/.3;a=1-t*t}return{position:[0,0,0],rotation:[0,0,0],scale:1,rotationBoost:[0,0,.12*a*i*1],positionBoost:[.04*a*i*1,.01*a*i,0],scaleBoost:1+.03*a*i}}}},le={name:"dip",emoji:"‚¨áÔ∏è",type:"blending",description:"Downward bob - groove dip feel",config:{duration:250,musicalDuration:{musical:!0,beats:.5},strength:1},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",durationSync:{mode:"beats",beats:.5},interruptible:!0,priority:5,blendable:!0},apply:(e,t,i)=>!1,blend:(e,t,i)=>!1,"3d":{isAccent:!0,evaluate(e,t){const i=t?.strength||1,a=Math.sin(e*Math.PI);return{position:[0,0,0],rotation:[0,0,0],scale:1,positionBoost:[0,.015*-a*i,0],scaleBoost:1-.015*a*i}}}},he={name:"bounce",emoji:"‚¨ÜÔ∏è",type:"blending",description:"Vertical oscillation with smooth easing",config:{duration:800,musicalDuration:{musical:!0,beats:2},amplitude:30,frequency:2,axis:"vertical",damping:!0,easing:"sine",strength:.6,particleMotion:{type:"bounce",axis:"vertical",strength:.6,frequency:2}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:3,blendable:!0,crossfadePoint:"anyBeat",amplitudeSync:{onBeat:1.8,offBeat:.6,curve:"bounce"},frequencySync:{mode:"tempo",multiplier:1},durationSync:{mode:"beats",beats:4},accentResponse:{enabled:!0,multiplier:1.5},patternOverrides:{waltz:{frequencySync:{multiplier:.75},durationSync:{beats:3}},swing:{amplitudeSync:{onBeat:2,offBeat:.4,curve:"ease"}},dubstep:{amplitudeSync:{onBeat:1.5,dropBeat:3,curve:"pulse"}},breakbeat:{frequencySync:{multiplier:1.5},amplitudeSync:{onBeat:2.2,offBeat:.3}}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.bounce={startY:e.y,startX:e.x,startVx:e.vx,startVy:e.vy,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.bounce?.initialized||this.initialize(e,i);const r={...this.config,...i},o=r.strength||this.config.strength||1,l=this.easeInOutCubic(t);let{frequency:h}=r;const c=i.phase||0;let u=r.amplitude*o*e.scaleFactor;i.rhythmModulation&&(u*=i.rhythmModulation.amplitudeMultiplier||1,u*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(h*=i.rhythmModulation.frequencyMultiplier));const d=Math.sin((l+c)*Math.PI*2*h);if(r.damping&&t>.7&&(u*=1-(t-.7)/.3*.8),"vertical"===r.axis?(e.vy+=d*u*.01*a,t>.9&&(e.vx*=.98)):"horizontal"===r.axis&&(e.vx+=d*u*.01*a,t>.9&&(e.vy*=.98)),t>.9){const i=1-10*(t-.9);e.vx=e.vx*(.95+.05*i),e.vy=e.vy*(.95+.05*i)}},cleanup(e){e.gestureData?.bounce&&delete e.gestureData.bounce},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,t){const i=t||{},a=i.amplitude||30,s=i.frequency||2,n=.003*a*(i.strength||.6),r=(e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2)*Math.PI*s,o=Math.abs(Math.sin(r));let l=n;return e>.7&&(l*=1-(e-.7)/.3*.8),{position:[0,o*l,0],rotation:[0,0,0],scale:1+.08*o}}}},ce={name:"orbit",emoji:"ü™ê",type:"override",description:"Orbital motion around center",config:{speed:.02,maintainRadius:!0,elliptical:!1,use3D:!0,zPhaseOffset:0,verticalOscillation:0,duration:3e3,musicalDuration:{musical:!0,bars:2},particleMotion:{type:"orbit",strength:1}},rhythm:{enabled:!0,syncMode:"harmonic",durationSync:{mode:"bars",bars:2},speedSync:{tonic:.02,fifth:.03,octave:.04,third:.025,curve:"smooth"},radiusSync:{bass:150,mid:100,treble:50,scaling:"logarithmic"},depthSync:{major:{z:1,phase:0},minor:{z:-1,phase:Math.PI},diminished:{z:.5,phase:Math.PI/2},augmented:{z:.8,phase:-Math.PI/2}},phaseSync:{mode:"harmonic",intervals:[1,1.5,2],drift:.05},dynamics:{forte:{speed:.04,maintainRadius:!1},piano:{speed:.01,maintainRadius:!0}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a,r=Math.sqrt(s*s+n*n),o=Math.random()<.5?1:-1,l=Math.max(r,100+180*Math.random()),h=r<5?Math.random()*Math.PI*2:Math.atan2(n,s);e.gestureData.orbit={radius:l,targetRadius:l,angle:h,initialAngle:h,originalVx:e.vx,originalVy:e.vy,originalZ:e.z||0,zPhase:Math.random()*Math.PI*2,direction:o}},apply(e,t,i,a,s,n){e.gestureData?.orbit||this.initialize(e,i,s,n);const r=e.gestureData.orbit,o=(i.speed||this.config.speed)*(i.strength||1);r.angle+=o*a*r.direction;let{radius:l}=r;if(i.maintainRadius||(l=r.radius*(1+.1*Math.sin(t*Math.PI*2))),e.x=s+Math.cos(r.angle)*l,e.y=n+Math.sin(r.angle)*l,!1!==i.use3D){const t=r.angle+r.zPhase+(i.zPhaseOffset||0);if(e.z=.8*Math.sin(t),i.verticalOscillation){const a=Math.cos(t)*i.verticalOscillation*l*.1;e.y+=a}}if(e.vx=-Math.sin(r.angle)*l*o,e.vy=Math.cos(r.angle)*l*o,t>.9){const i=10*(1-t);e.vx=e.vx*i+r.originalVx*(1-i),e.vy=e.vy*i+r.originalVy*(1-i)}},cleanup(e){if(e.gestureData?.orbit){const t=e.gestureData.orbit;e.vx=t.originalVx,e.vy=t.originalVy,e.z=t.originalZ,delete e.gestureData.orbit}},"3d":{evaluate(e,t){const i=t?.particle;if(!i||!i.gestureData?.orbit)return{position:[0,0,0],rotation:[0,0,0],scale:1};const a=i.gestureData.orbit;let s=1;e<.15?s=Math.sin(e/.15*Math.PI*.5):e>.85&&(s=Math.sin((1-e)/.15*Math.PI*.5));const n=a.initialAngle+e*Math.PI*2*a.direction,r=.3*Math.cos(n)*s,o=.3*Math.sin(n)*s,l=(n+Math.PI/2-(a.initialAngle+Math.PI/2))*s,h=i.z||0;return{position:[r,0,o+.1*h*s],rotation:[0,l,0],scale:1+.15*h*s}}}};function ue(e){const t=F[e];if(!t)throw new Error(`Invalid orbit direction: ${e}`);const i="up"===e||"down"===e,a="left"===e||"up"===e?1:-1;return{name:`orbit${D(e)}`,emoji:"left"===e?"üîÑ":"right"===e?"üîÉ":"up"===e?"üåÄ":"üí´",type:"override",description:`Orbit ${"left"===e?"counter-clockwise":"right"===e?"clockwise":e}`,config:{duration:1500,musicalDuration:{musical:!0,beats:4},speed:.02,maintainRadius:!0,use3D:!0,rotations:1,strength:1,direction:e,verticalOscillation:i?.3:0,particleMotion:{type:"orbit",strength:1,rotations:1}},rhythm:{enabled:!0,syncMode:"harmonic",durationSync:{mode:"bars",bars:1},speedSync:{tonic:.02,fifth:.03,octave:.04,curve:"smooth"},radiusSync:{bass:150,mid:100,treble:50,scaling:"logarithmic"},dynamics:{forte:{speed:.04,maintainRadius:!1},piano:{speed:.01,maintainRadius:!0}}},initialize(e,t,i,s){e.gestureData||(e.gestureData={});const n=e.x-i,r=e.y-s,o=Math.sqrt(n*n+r*r),l=Math.max(o,80+100*Math.random()),h=o<5?Math.random()*Math.PI*2:Math.atan2(r,n);e.gestureData.orbit={radius:l,targetRadius:l,angle:h,initialAngle:h,originalVx:e.vx,originalVy:e.vy,originalZ:e.z||0,zPhase:Math.random()*Math.PI*2,direction:a,initialized:!0}},apply(e,a,s,n,r,o){e.gestureData?.orbit?.initialized||this.initialize(e,s,r,o);const l=e.gestureData.orbit,h={...this.config,...s},c=s.strength||1,u=(h.speed||.02)*c;let d=1;a<.15?(d=a/.15,d=Math.sin(d*Math.PI*.5)):a>.85&&(d=(1-a)/.15,d=Math.sin(d*Math.PI*.5)),l.angle+=u*n*l.direction*d;let{radius:p}=l;h.maintainRadius||(p=l.radius*(1+.1*Math.sin(a*Math.PI*2)));const g=p*d+(1-d)*l.radius*.5;if(e.x=r+Math.cos(l.angle)*g,e.y=o+Math.sin(l.angle)*g,!1!==h.use3D){const s=l.angle+l.zPhase;if(e.z=.8*Math.sin(s)*d,i&&h.verticalOscillation){const i=t.y*a*h.verticalOscillation*p*.5;e.y+=i}}if(e.vx=-Math.sin(l.angle)*g*u*d,e.vy=Math.cos(l.angle)*g*u*d,a>.9){const t=10*(1-a);e.vx=e.vx*t+l.originalVx*(1-t),e.vy=e.vy*t+l.originalVy*(1-t)}},cleanup(e){if(e.gestureData?.orbit){const t=e.gestureData.orbit;e.vx=t.originalVx,e.vy=t.originalVy,e.z=t.originalZ,delete e.gestureData.orbit}},"3d":{evaluate(e,s){const n=s.config||s||{},r=s.strength||1,o=n.rotations||1;let l=1;e<.15?l=Math.sin(e/.15*Math.PI*.5):e>.85&&(l=Math.sin((1-e)/.15*Math.PI*.5));const h=.25*r,c=e*Math.PI*2*o*a,u=Math.cos(c)*h*l,d=Math.sin(c)*h*l;let p=0;return i&&(p=t.y*e*.2*r*l),{cameraRelativePosition:[u,p,d],rotation:[0,c*l*.5,0],scale:1+.2*d}}}}}var de=ue("left"),pe=ue("right"),ge=ue("up"),me=ue("down"),ye={name:"jump",emoji:"ü¶ò",type:"override",description:"Squash, leap, and land with classic animation principles",config:{duration:800,musicalDuration:{musical:!0,beats:2},jumpHeight:60,squashAmount:.8,stretchAmount:1.2,anticipation:.2,hangTime:.1,landingImpact:!0,driftOutward:!0,easing:"quad",particleMotion:{type:"jump",strength:.9,jumpHeight:60,squash:.8,stretch:1.2}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2},phaseSync:{anticipation:"eighth",jump:"beat",landing:"sixteenth"},heightSync:{onBeat:1.5,offBeat:.8,accent:2,curve:"exponential"},deformationSync:{squashOnBeat:.6,stretchOnBeat:1.4,timing:"anticipatory"},hangTimeSync:{mode:"tempo",baseDuration:.1,scaling:"inverse"},dynamics:{forte:{jumpHeight:80,stretch:1.3},piano:{jumpHeight:30,stretch:1.1}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={}),e.gestureData.jump={startX:e.x,startY:e.y,startSize:e.size,originalVx:e.vx,originalVy:e.vy,driftDirection:.1*(e.x-i),initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.jump?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.jump,o={...this.config,...i},l=i.strength||1,h=o.jumpHeight*l*e.scaleFactor,c=o.squashAmount,u=o.stretchAmount,d=o.anticipation,p=1-.5*o.anticipation;if(t<d){const i=t/d,a=this.easeOutQuad(i);e.size=r.startSize*(1-(1-c)*a),e.y=r.startY+5*a*e.scaleFactor,e.vx=0,e.vy=0}else if(t<p){const i=(t-d)/(p-d);let a=Math.sin(i*Math.PI);if(o.hangTime>0&&i>.4&&i<.6){const e=(i-.4)/.2;a=.95+.05*this.easeInOutCubic(e)}if(e.y=r.startY-a*h,o.driftOutward&&(e.x=r.startX+a*r.driftDirection),i<.5){const t=2*i;e.size=r.startSize*(c+(u-c)*t)}else{const t=2*(i-.5);e.size=r.startSize*(u-(u-1)*t*.8)}e.vx=.5*r.driftDirection,e.vy=-Math.cos(i*Math.PI)*h*.1}else{const i=(t-p)/(1-p),a=this.easeOutBounce(i);if(e.y=r.startY,o.landingImpact)if(i<.3){const t=i/.3;e.size=r.startSize*(1-(1-.8*c)*(1-t))}else{const t=(i-.3)/.7;e.size=r.startSize*(.8*c+(1-.8*c)*t)}else e.size=r.startSize*(c+(1-c)*a);e.vx=r.originalVx*a,e.vy=r.originalVy*a}},cleanup(e){if(e.gestureData?.jump){const t=e.gestureData.jump;e.size=t.startSize,e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.jump}},easeOutQuad:e=>e*(2-e),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeOutBounce(e){const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375},"3d":{evaluate(e,t){const i=t.config||t||{},a=t.strength||1,s=.004*(i.jumpHeight||60)*a,n=i.squashAmount||.8,r=i.stretchAmount||1.2,o=i.anticipation||.2,l=1-.5*o;let h=0,c=1,u=0;if(e<o){const t=e/o,i=t*(2-t);c=1-(1-n)*i,h=.02*-i}else if(e<l){const t=(e-o)/(l-o);h=Math.sin(t*Math.PI)*s,c=t<.5?n+2*t*(r-n):r-2*(t-.5)*(r-1)*.8,u=.05*Math.sin(t*Math.PI)}else{const t=(e-l)/(1-l);if(t<.5){const e=2*t;h=-Math.sin(e*Math.PI)*s*.15}else h=0;c=!1!==i.landingImpact?t<.3?1-(1-.8*n)*(1-t/.3):.8*n+(t-.3)/.7*(1-.8*n):n+(1-n)*t}return{position:[0,h,0],rotation:[u,0,0],scale:c}}}};function fe(e){const t=F[e];if(!t)throw new Error(`Invalid jump direction: ${e}`);const i="up"===e||"down"===e;return{name:`jump${D(e)}`,emoji:"up"===e?"ü¶ò":"down"===e?"üí•":"left"===e?"‚¨ÖÔ∏è":"‚û°Ô∏è",type:"override",description:`Jump ${e} with squash & stretch`,config:{duration:800,musicalDuration:{musical:!0,beats:2},jumpDistance:60,squashAmount:.8,stretchAmount:1.2,anticipation:.2,hangTime:.1,landingImpact:!0,easing:"quad",strength:1,direction:e,particleMotion:{type:"jump",strength:.9,jumpDistance:60,squash:.8,stretch:1.2}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2},phaseSync:{anticipation:"eighth",jump:"beat",landing:"sixteenth"},distanceSync:{onBeat:1.5,offBeat:.8,accent:2,curve:"exponential"},deformationSync:{squashOnBeat:.6,stretchOnBeat:1.4,timing:"anticipatory"},dynamics:{forte:{jumpDistance:80,stretch:1.3},piano:{jumpDistance:30,stretch:1.1}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={}),e.gestureData.jump={startX:e.x,startY:e.y,startSize:e.size,originalVx:e.vx,originalVy:e.vy,initialized:!0}},apply(e,a,s,n,r,o){e.gestureData?.jump?.initialized||this.initialize(e,s,r,o);const l=e.gestureData.jump,h={...this.config,...s},c=s.strength||1,u=h.jumpDistance*c*e.scaleFactor,d=h.squashAmount,p=h.stretchAmount,g=h.anticipation,m=1-.5*h.anticipation;if(a<g){const s=a/g,n=this.easeOutQuad(s);e.size=l.startSize*(1-(1-d)*n),i?e.y=l.startY-t.y*n*5*e.scaleFactor:e.x=l.startX-t.x*n*5*e.scaleFactor,e.vx=0,e.vy=0}else if(a<m){const s=(a-g)/(m-g);let n=Math.sin(s*Math.PI);if(h.hangTime>0&&s>.4&&s<.6){const e=(s-.4)/.2;n=.95+.05*this.easeInOutCubic(e)}if(i?(e.y=l.startY+t.y*n*u,e.x=l.startX+3*Math.sin(s*Math.PI*2)):(e.x=l.startX+t.x*n*u,e.y=l.startY-Math.sin(s*Math.PI)*u*.3),s<.5){const t=2*s;e.size=l.startSize*(d+(p-d)*t)}else{const t=2*(s-.5);e.size=l.startSize*(p-(p-1)*t*.8)}i?(e.vy=t.y*Math.cos(s*Math.PI)*u*.1,e.vx=0):(e.vx=t.x*Math.cos(s*Math.PI)*u*.1,e.vy=-Math.cos(s*Math.PI)*u*.05)}else{const t=(a-m)/(1-m),i=this.easeOutBounce(t);if(e.x=l.startX,e.y=l.startY,h.landingImpact)if(t<.3){const i=t/.3;e.size=l.startSize*(1-(1-.8*d)*(1-i))}else{const i=(t-.3)/.7;e.size=l.startSize*(.8*d+(1-.8*d)*i)}else e.size=l.startSize*(d+(1-d)*i);e.vx=l.originalVx*i,e.vy=l.originalVy*i}},cleanup(e){if(e.gestureData?.jump){const t=e.gestureData.jump;e.size=t.startSize,e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.jump}},easeOutQuad:e=>e*(2-e),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeOutBounce(e){const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375},"3d":{evaluate(e,a){const s=a.config||a||{},n=a.strength||1,r=.004*(s.jumpDistance||60)*n,o=s.squashAmount||.8,l=s.stretchAmount||1.2,h=s.anticipation||.2,c=1-.5*h;let u=0,d=0,p=1,g=0,m=0,y=0;if(e<h){const a=e/h,s=a*(2-a);p=1-(1-o)*s,i?d=-t.y*s*.02:u=-t.x*s*.02}else if(e<c){const a=(e-h)/(c-h),s=Math.sin(a*Math.PI);i?d=t.y*s*r:(u=t.x*s*r,d=Math.sin(a*Math.PI)*r*.3),p=a<.5?o+2*a*(l-o):l-2*(a-.5)*(l-1)*.8,i?g=t.y*Math.sin(a*Math.PI)*.1:(m=t.x*Math.sin(a*Math.PI)*.15,y=-t.x*Math.sin(a*Math.PI)*.05)}else{const a=(e-c)/(1-c);if(a<.5){const e=2*a;i?d=-t.y*Math.sin(e*Math.PI)*r*.15:u=-t.x*Math.sin(e*Math.PI)*r*.1}p=!1!==s.landingImpact?a<.3?1-(1-.8*o)*(1-a/.3):.8*o+(a-.3)/.7*(1-.8*o):o+(1-o)*a}return{cameraRelativePosition:[u,d,0],rotation:[g,m,y],scale:p}}}}}var be=fe("down"),we=fe("left"),ve=fe("right");function Me(e){if(!["forward","back","left","right","up","down"].includes(e))throw new Error(`Invalid rush direction: ${e}`);return{name:`rush${D(e)}`,emoji:{forward:"üí®",back:"üèÉ",left:"‚¨ÖÔ∏è",right:"‚û°Ô∏è",up:"‚¨ÜÔ∏è",down:"‚¨áÔ∏è"}[e],type:"override",description:{forward:"Quick rush toward camera",back:"Quick retreat away",left:"Quick strafe left",right:"Quick strafe right",up:"Quick leap upward",down:"Quick dive downward"}[e],config:{duration:600,musicalDuration:{musical:!0,beats:1.5},strength:1,direction:e,particleMotion:{type:"rush",strength:1,direction:e}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1.5},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.4}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.direction||"forward";let n=0,r=0,o=0,l=0,h=0,c=1,u=1,d=0;const p={forward:{x:0,y:0,z:1,lean:{x:.2,z:0}},back:{x:0,y:0,z:-1,lean:{x:-.2,z:0}},left:{x:-1,y:0,z:0,lean:{x:0,z:.2}},right:{x:1,y:0,z:0,lean:{x:0,z:-.2}},up:{x:0,y:1,z:0,lean:{x:-.15,z:0}},down:{x:0,y:-1,z:0,lean:{x:.2,z:0}}}[s],g=.2;if(e<.2){const t=e/.2,i=1-Math.pow(1-t,2);l=i*p.lean.x*a,h=i*p.lean.z*a,r="up"===s?.03*-i*a:.02*-i*a,u=1+.3*i}else if(e<.6){const t=(e-.2)/.4,i=1-Math.pow(1-t,3);n=p.x*i*g*a,r=p.y*i*g*a,o=p.z*i*g*a,"up"===s?r+=.05*i*a:"down"!==s&&(r+=(.04*i-.02)*a),l=p.lean.x*a,h=p.lean.z*a,c=1+.08*i,u=1.3+.5*i,d=.35*i,h+=Math.sin(t*Math.PI*12)*(1-t)*.015*a}else{const t=(e-.6)/.4,i=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;if(n=p.x*g*(1-i)*a,r=p.y*g*(1-i)*a,o=p.z*g*(1-i)*a,l=p.lean.x*(1-i)*a,h=p.lean.z*(1-i)*a,c=1.08-.08*i,t>.7){const e=(t-.7)/.3;r-=.02*Math.sin(e*Math.PI)*a}u=1.8-.8*i,d=.35*(1-i)}return{cameraRelativePosition:[n,r,o],cameraRelativeRotation:[l,0,h],scale:c,glowIntensity:u,glowBoost:d}}}}}var Se={name:"lunge",emoji:"ü§∫",type:"override",description:"Forward thrust lunge with emphasis",config:{duration:500,musicalDuration:{musical:!0,beats:1},distance:.25,direction:"forward",recover:!0,strength:1,particleMotion:{type:"lunge",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.distance||.25,n=!1!==i.recover;let r;e<.3?(r=e/.3,r=1-Math.pow(1-r,3)):e<.6?r=1:n?(r=1-(e-.6)/.4,r=Math.pow(r,2)):r=1;const o=r*s*a;return{position:[0,.05*-Math.sin(r*Math.PI)*a,o],rotation:[.2*r*a,0,0],scale:1+.1*r*a,glowIntensity:1+.3*r,glowBoost:e<.4?.4*r:0}}}};function xe(e){if(!{...F,forward:{x:0,y:0,z:-1},back:{x:0,y:0,z:1}}[e])throw new Error(`Invalid lunge direction: ${e}`);return{name:`lunge${D(e)}`,emoji:{forward:"ü§∫",back:"üèÉ",left:"üëà",right:"üëâ",up:"‚òùÔ∏è",down:"üëá"}[e]||"ü§∫",type:"override",description:`Lunge thrust ${e}`,config:{duration:500,musicalDuration:{musical:!0,beats:1},distance:.25,recover:!0,strength:1,direction:e,particleMotion:{type:"lunge",strength:1,direction:e}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.distance||.25,n=!1!==i.recover,r=i.direction||"forward";let o;e<.3?(o=e/.3,o=1-Math.pow(1-o,3)):e<.6?o=1:n?(o=1-(e-.6)/.4,o=Math.pow(o,2)):o=1;let l=0,h=0,c=0,u=0,d=0;switch(r){case"forward":c=o*s*a,u=.2*o*a,h=.05*-Math.sin(o*Math.PI)*a;break;case"back":c=-o*s*a,u=.2*-o*a,h=.05*-Math.sin(o*Math.PI)*a;break;case"left":l=-o*s*a,d=.2*-o*a,h=.03*-Math.sin(o*Math.PI)*a;break;case"right":l=o*s*a,d=.2*o*a,h=.03*-Math.sin(o*Math.PI)*a;break;case"up":h=o*s*a,u=.15*-o*a;break;case"down":h=-o*s*a,u=.25*o*a}return{cameraRelativePosition:[l,h,c],cameraRelativeRotation:[u,0,d],scale:1+.1*o*a,glowIntensity:1+.3*o,glowBoost:e<.4?.4*o:0}}}}}var ke={name:"spin",emoji:"üåÄ",type:"override",description:"Orbital rotation around center point",config:{duration:600,musicalDuration:{musical:!0,beats:1},rotations:1,direction:"random",radiusMultiplier:1,spiralOut:!1,accelerate:!0,maintainDistance:!0,scaleAmount:.1,easing:"linear",strength:.7,particleMotion:{type:"spin",strength:.7,rotations:1,radius:1}},rhythm:{enabled:!0,syncMode:"bar",rotationSync:{mode:"bars",rotationsPerBar:1,accelerateOnBeat:!0},radiusSync:{subdivision:"quarter",expandOnBeat:1.2,contractOffBeat:.9,curve:"bounce"},durationSync:{mode:"beats",beats:4},patternOverrides:{waltz:{rotationSync:{rotationsPerBar:.75},radiusSync:{curve:"ease"}},swing:{rotationSync:{accelerateOnBeat:!1},direction:"alternating"},dubstep:{radiusSync:{subdivision:"eighth",expandOnBeat:1.5,dropMultiplier:2},spiralOut:!0},breakbeat:{rotationSync:{mode:"random",range:[.5,2]},direction:"random"}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a;let r=t.direction||this.config.direction;"random"===r&&(r=Math.random()<.5?"clockwise":"counter-clockwise"),e.gestureData.spin={startAngle:Math.atan2(n,s),startRadius:Math.sqrt(s*s+n*n)||30,originalX:e.x,originalY:e.y,originalVx:e.vx,originalVy:e.vy,direction:r,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.spin?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.spin,o={...this.config,...i},l=i.strength||1;let{rotations:h}=o,{radiusMultiplier:c}=o;i.rhythmModulation&&(i.rhythmModulation.rotationMultiplier&&(h*=i.rhythmModulation.rotationMultiplier),i.rhythmModulation.radiusMultiplier&&(c*=i.rhythmModulation.radiusMultiplier));let u=t;o.accelerate&&(u=t<.5?.5*this.easeInQuad(2*t):.5+.5*this.easeOutQuad(2*(t-.5)));const d=h*Math.PI*2*l,p="counter-clockwise"===r.direction?-1:1,g=r.startAngle+d*u*p;let m=r.startRadius;o.spiralOut&&(m*=1+.5*t),1!==c&&(m*=1+(c-1)*Math.sin(t*Math.PI));const y=s+Math.cos(g)*m,f=n+Math.sin(g)*m;if(e.x+=.25*(y-e.x),e.y+=.25*(f-e.y),e.vx=.5*(y-e.x),e.vy=.5*(f-e.y),t>.9){const i=10*(1-t);e.vx=e.vx*i+r.originalVx*(1-i),e.vy=e.vy*i+r.originalVy*(1-i)}},cleanup(e){if(e.gestureData?.spin){const t=e.gestureData.spin;e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.spin}},easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),"3d":{evaluate(e,t){const i=t?.config||t||{},a=t?.strength||1,s=t?.particle;let n=1;s?.gestureData?.spin?n="counter-clockwise"===s.gestureData.spin.direction?-1:1:"counter-clockwise"!==i.direction&&"left"!==i.direction||(n=-1);let r=e;return!1!==i.accelerate&&(r=e<.5?e*e*4*.5:.5+(e-.5)*(2-(e-.5))*.5),{position:[0,0,0],rotation:[0,(i.rotations||1)*Math.PI*2*a*r*n,0],scale:1+(i.scaleAmount||.1)*Math.sin(e*Math.PI)*a}}}};const Oe={left:"counter-clockwise",right:"clockwise"};function Ae(e){const t=Oe[e];if(!t)throw new Error(`Invalid spin direction: ${e}`);const i="left"===e?-1:1;return{name:`spin${D(e)}`,emoji:"left"===e?"‚Ü∫":"‚Üª",type:"override",description:`Spin ${t}`,config:{duration:600,rotations:1,direction:t,radiusMultiplier:1,spiralOut:!1,accelerate:!0,maintainDistance:!0,scaleAmount:.1,strength:.7},rhythm:{enabled:!0,syncMode:"bar",timingSync:"nextBeat",interruptible:!1,priority:7,blendable:!1,durationSync:{mode:"beats",beats:4},rotationSync:{mode:"bars",rotationsPerBar:1,accelerateOnBeat:!0}},initialize(e,i,a,s){e.gestureData||(e.gestureData={});const n=e.x-a,r=e.y-s;e.gestureData.spin={startAngle:Math.atan2(r,n),startRadius:Math.sqrt(n*n+r*r)||30,originalX:e.x,originalY:e.y,originalVx:e.vx,originalVy:e.vy,direction:t,initialized:!0}},apply(e,t,a,s,n,r){e.gestureData?.spin?.initialized||this.initialize(e,a,n,r);const o=e.gestureData.spin,l={...this.config,...a},h=a.strength||1;let{rotations:c,radiusMultiplier:u}=l;a.rhythmModulation&&(a.rhythmModulation.rotationMultiplier&&(c*=a.rhythmModulation.rotationMultiplier),a.rhythmModulation.radiusMultiplier&&(u*=a.rhythmModulation.radiusMultiplier));let d=t;l.accelerate&&(d=t<.5?.5*this.easeInQuad(2*t):.5+.5*this.easeOutQuad(2*(t-.5)));const p=c*Math.PI*2*h,g=o.startAngle+p*d*i;let m=o.startRadius;l.spiralOut&&(m*=1+.5*t),1!==u&&(m*=1+(u-1)*Math.sin(t*Math.PI));const y=n+Math.cos(g)*m,f=r+Math.sin(g)*m;if(e.x+=.25*(y-e.x),e.y+=.25*(f-e.y),e.vx=.5*(y-e.x),e.vy=.5*(f-e.y),t>.9){const i=10*(1-t);e.vx=e.vx*i+o.originalVx*(1-i),e.vy=e.vy*i+o.originalVy*(1-i)}},cleanup(e){if(e.gestureData?.spin){const t=e.gestureData.spin;e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.spin}},easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),"3d":{evaluate(e,t){const a=t?.config||t||{},s=t?.strength||1;let n=e;return!1!==a.accelerate&&(n=e<.5?e*e*4*.5:.5+(e-.5)*(2-(e-.5))*.5),{position:[0,0,0],rotation:[0,(a.rotations||1)*Math.PI*2*s*n*i,0],scale:1+(a.scaleAmount||.1)*Math.sin(e*Math.PI)*s}}}}}var Ce=Ae("left"),Ie=Ae("right"),ze={name:"flip",emoji:"ü§∏",type:"override",description:"Front flip rotation with arc trajectory",config:{duration:800,musicalDuration:{musical:!0,beats:2},rotations:1,height:.3,direction:"forward",strength:1,particleMotion:{type:"flip",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.3}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.rotations||1,n=i.height||.3,r=(e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2)*(2*-Math.PI*s),o=Math.sin(e*Math.PI)*n*a;let l=1;if(e<.1)l=1-e/.1*.15;else if(e<.2)l=.85+(e-.1)/.1*.2;else if(e>.9){const t=(e-.9)/.1;l=1.05-.1*Math.sin(t*Math.PI)}else l=1.05;return e>=.99&&(l=1),{position:[0,o,0],rotation:[r,0,0],scale:l,glowIntensity:1+.4*Math.sin(e*Math.PI),glowBoost:e>.2&&e<.8?.3:0}}}},Fe={name:"backflip",emoji:"‚¨ÜÔ∏è",type:"override",description:"Backwards flip with dramatic arc trajectory",config:{duration:900,musicalDuration:{musical:!0,beats:2},rotations:1,height:.35,strength:1,particleMotion:{type:"backflip",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.4}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.rotations||1,n=i.height||.35,r=(e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2)*(2*Math.PI*s),o=Math.sin(e*Math.PI)*n*a,l=.1*Math.sin(e*Math.PI)*a;let h=1;if(e<.1)h=1-e/.1*.15;else if(e<.2)h=.85+(e-.1)/.1*.25;else if(e>.9){const t=(e-.9)/.1;h=1.1-.15*Math.sin(t*Math.PI)}else h=1.1;return e>=.99&&(h=1),{position:[0,o,l],rotation:[r,0,0],scale:h,glowIntensity:1+.5*Math.sin(e*Math.PI),glowBoost:.4*Math.sin(e*Math.PI)}}}},De={name:"point",emoji:"üëâ",type:"blending",description:"Directional pointing motion with forward momentum",config:{duration:1e3,musicalDuration:{musical:!0,beats:2},amplitude:15,direction:"right",strength:.8,particleMotion:{type:"point",direction:"right",strength:.8}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:4,blendable:!0,crossfadePoint:"anyBeat",amplitudeSync:{onBeat:1.5,offBeat:.7,curve:"ease"},durationSync:{mode:"beats",beats:2},accentResponse:{enabled:!0,multiplier:1.6},patternOverrides:{march:{amplitudeSync:{onBeat:2,offBeat:.5,curve:"pulse"}},swing:{amplitudeSync:{onBeat:1.4,offBeat:.8,curve:"bounce"}}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.point={startX:e.x,startY:e.y,startVx:e.vx,startVy:e.vy,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.point?.initialized||this.initialize(e,i);const r={...this.config,...i},o=r.strength||this.config.strength||1,l=this.easeInOutCubic(t);let h=r.amplitude*o*e.scaleFactor;i.rhythmModulation&&(h*=i.rhythmModulation.amplitudeMultiplier||1,h*=i.rhythmModulation.accentMultiplier||1);const c=Math.sin(l*Math.PI);let u=0,d=0;switch(r.direction||"right"){case"right":u=1;break;case"left":u=-1;break;case"up":d=-1;break;case"down":d=1}if(e.vx+=c*h*.02*a*u,e.vy+=c*h*.02*a*d,t>.9){const i=1-10*(t-.9);e.vx=e.vx*(.95+.05*i),e.vy=e.vy*(.95+.05*i)}},cleanup(e){e.gestureData?.point&&delete e.gestureData.point},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,t){const i=t||{},a=i.amplitude||15,s=i.strength||.8,n=i.direction||"right",r=.005*a*s,o=e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,l=Math.sin(o*Math.PI);let h=0,c=0;switch(n){case"right":h=l*r,c=.25*l;break;case"left":h=-l*r,c=.25*-l;break;case"up":case"down":c=0}return{position:[h,0,0],rotation:[0,c,0],scale:1}}}};function qe(e){const t=F[e];if(!t)throw new Error(`Invalid point direction: ${e}`);const i="up"===e||"down"===e;return{name:`point${D(e)}`,emoji:"up"===e?"‚òùÔ∏è":"down"===e?"üëá":"left"===e?"üëà":"üëâ",type:"blending",description:`Point ${e} with extension and return`,config:{duration:500,amplitude:15,strength:.8,direction:e},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:4,blendable:!0,durationSync:{mode:"beats",beats:1},amplitudeSync:{onBeat:1.5,offBeat:.7,curve:"ease"},accentResponse:{enabled:!0,multiplier:1.6}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.point={startX:e.x,startY:e.y,initialized:!0}},apply(e,i,a,s,n,r){e.gestureData?.point?.initialized||this.initialize(e,a);const o={...this.config,...a},l=o.strength||.8,h=this.easeInOutCubic(i);let c=o.amplitude*l*e.scaleFactor;a.rhythmModulation&&(c*=a.rhythmModulation.amplitudeMultiplier||1,c*=a.rhythmModulation.accentMultiplier||1);const u=Math.sin(h*Math.PI);if(e.vx+=u*c*.02*s*t.x,e.vy+=u*c*.02*s*-t.y,i>.9){const t=1-10*(i-.9);e.vx*=.95+.05*t,e.vy*=.95+.05*t}},cleanup(e){e.gestureData?.point&&delete e.gestureData.point},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,a){const s=a||{},n=.005*(s.amplitude||15)*(s.strength||.8),r=e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,o=Math.sin(r*Math.PI),l=t.x*o*n,h=t.y*o*n;let c=0,u=0,d=0;return i?c=t.y*o*.2:(u=t.x*o*.25,d=-t.x*o*.1),{cameraRelativePosition:[l,h,0],rotation:[c,u,d],scale:1}}}}}var Re=qe("up"),Be=qe("down"),Ee=qe("left"),Pe=qe("right");function Te(e){if("left"!==e&&"right"!==e)throw new Error(`Invalid kick direction: ${e}. Only 'left' and 'right' are supported.`);const t=F[e];return{name:`kick${D(e)}`,emoji:"left"===e?"ü¶µ":"ü¶∂",type:"blending",description:`Quick kick ${e} with snap return`,config:{duration:400,amplitude:30,strength:.8,direction:e},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:5,blendable:!0,durationSync:{mode:"beats",beats:1},amplitudeSync:{onBeat:1.5,offBeat:.7,curve:"snap"},accentResponse:{enabled:!0,multiplier:1.5}},apply(e,i,a,s,n,r){const o={...this.config,...a};let l,h=o.amplitude*o.strength*e.scaleFactor;a.rhythmModulation&&(h*=a.rhythmModulation.amplitudeMultiplier||1,h*=a.rhythmModulation.accentMultiplier||1),l=i<.25?this.easeOutQuad(i/.25):i<.5?1:1-this.easeInQuad((i-.5)/.5);const c=t.x*h*l*.012*s,u=t.y*h*l*.012*s;e.vx+=c,e.vy+=u},cleanup(e){},easeOutQuad:e=>1-(1-e)*(1-e),easeInQuad:e=>e*e,"3d":{evaluate(e,i){const a=i||{},s=a.amplitude||30,n=a.strength||.8;let r,o=.008*s*n;if(i.rhythmModulation&&(o*=i.rhythmModulation.amplitudeMultiplier||1),e<.25)r=1-(1-e/.25)*(1-e/.25);else if(e<.5)r=1;else{const t=(e-.5)/.5;r=1-t*t}const l=.15*r*n;return{cameraRelativePosition:[t.x*o*r,t.y*o*r*.3,0],rotation:[.08*r*n,0,t.x*l],scale:1+.05*r}}}}}var je=Te("left"),Ve=Te("right"),$e={name:"bow",emoji:"üôá",type:"override",description:"Graceful forward bow of respect",config:{duration:1200,musicalDuration:{musical:!0,beats:3},depth:.4,holdTime:.4,graceful:!0,strength:1,particleMotion:{type:"bow",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:3},timingSync:"onBeat"},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.depth||.4,n=i.holdTime||.4;let r;const o=.4*(1-n),l=1-.6*(1-n);return e<o?(r=e/o,r=Math.sin(r*Math.PI/2)):e<l?r=1:(r=1-(e-l)/(1-l),r=Math.sin(r*Math.PI/2)),{cameraRelativePosition:[0,.1*-r*a,.05*-r*a],cameraRelativeRotation:[r*s*Math.PI*a,0,0],scale:1,glowIntensity:1-.2*r,glowBoost:0}}}},We={name:"nod",emoji:"üôÇ",type:"blending",description:"Vertical nodding motion",config:{duration:500,amplitude:15,frequency:2,easing:"sine",strength:.4,particleMotion:{type:"bounce",axis:"vertical",strength:.4,frequency:2,phase:0}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!1,priority:5,blendable:!1,minDuration:"halfBar",frequencySync:{mode:"subdivision",subdivision:"half",multiplier:1},amplitudeSync:{onBeat:1.4,offBeat:.8,curve:"ease"},durationSync:{mode:"beats",beats:2},patternOverrides:{waltz:{frequencySync:{subdivision:"quarter"},amplitudeSync:{onBeat:1.6,curve:"ease"}},swing:{amplitudeSync:{onBeat:1.5,offBeat:.9}},dubstep:{amplitudeSync:{onBeat:1.2,dropBeat:3,curve:"pulse"}}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.nod={startY:e.y,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.nod?.initialized||this.initialize(e,i);const r={...this.config,...i},o=r.strength||this.config.strength||1;let{frequency:l}=r,{amplitude:h}=r;i.rhythmModulation&&(h*=i.rhythmModulation.amplitudeMultiplier||1,h*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(l*=i.rhythmModulation.frequencyMultiplier));const c=Math.sin(t*Math.PI*2*l);h=h*o*e.scaleFactor,e.vy+=c*h*.01*a,t>.9&&(e.vy*=.95)},cleanup(e){e.gestureData?.nod&&delete e.gestureData.nod},"3d":{evaluate(e,t){const i={...this.config,...t};let{amplitude:a}=i;t.rhythmModulation&&(a*=t.rhythmModulation.amplitudeMultiplier||1,a*=t.rhythmModulation.accentMultiplier||1);let s=0;if(e<.4){const t=e/.4;s=.12*Math.sin(t*Math.PI)}else if(e<.8){const t=(e-.4)/.4;s=.07*Math.sin(t*Math.PI)}return s*=a/15,{cameraRelativePosition:[0,0,s],scale:1-.3*Math.abs(s),glowIntensity:1+.5*Math.abs(s)}}}},Ge={name:"reach",emoji:"üôå",type:"blending",description:"Upward reaching motion with scale increase",config:{duration:1400,musicalDuration:{musical:!0,beats:2},amplitude:25,strength:.9,scaleMax:1.05,particleMotion:{type:"reach",strength:.9,scaleMax:1.05}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:4,blendable:!0,crossfadePoint:"anyBeat",amplitudeSync:{onBeat:1.4,offBeat:.9,curve:"ease"},durationSync:{mode:"beats",beats:2},accentResponse:{enabled:!0,multiplier:1.5},patternOverrides:{uplifting:{amplitudeSync:{onBeat:1.8,offBeat:.7,curve:"ease"},durationSync:{beats:3}},ambient:{amplitudeSync:{onBeat:1.2,offBeat:1,curve:"linear"}}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.reach={startY:e.y,startVy:e.vy,originalSize:e.size,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.reach?.initialized||this.initialize(e,i);const r={...this.config,...i},o=r.strength||this.config.strength||1,l=r.scaleMax||this.config.scaleMax||1.05,h=this.easeInOutCubic(t);let c=r.amplitude*o*e.scaleFactor;i.rhythmModulation&&(c*=i.rhythmModulation.amplitudeMultiplier||1,c*=i.rhythmModulation.accentMultiplier||1);const u=Math.sin(h*Math.PI);e.vy-=u*c*.015*a;const d=1+u*(l-1);if(e.size=e.baseSize*d,t>.9){const i=1-10*(t-.9);e.vy=e.vy*(.95+.05*i)}},cleanup(e){e.gestureData?.reach&&(e.gestureData.reach.originalSize?e.size=e.gestureData.reach.originalSize:e.size=e.baseSize,delete e.gestureData.reach)},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,t){const i=t||{},a=i.amplitude||25,s=i.strength||.9,n=i.scaleMax||1.05,r=.004*a*s,o=e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,l=Math.sin(o*Math.PI);return{position:[0,l*r,0],rotation:[.1*l,0,0],scale:1+l*(n-1)}}}},Le={name:"headBob",emoji:"üéß",type:"additive",description:"Rhythmic vertical bobbing to music",config:{duration:600,musicalDuration:{musical:!0,beats:1},amplitude:12,frequency:2,strength:1,damping:.1,easing:"linear",particleMotion:{type:"headBob",strength:1,amplitude:12,frequency:2}},rhythm:{enabled:!0,syncMode:"beat",frequencySync:{subdivision:"eighth",bobsPerBeat:2},amplitudeSync:{onBeat:1.3,offBeat:1,curve:"pulse"},durationSync:{mode:"beats",beats:1}},apply(e,t,i,a,s,n,r){const o=(i.amplitude||this.config.amplitude)*s,l=i.frequency||this.config.frequency,h=1-a*(i.damping||this.config.damping),c=Math.sin(a*Math.PI*2*l)*o*h;e.vy+=.5*c;const u=Math.cos(a*Math.PI*2*l*1.5)*o*.05*h;e.vx+=.2*u},"3d":{evaluate(e,t){const i=t.config||{},a=t.strength||1,s=i.amplitude||12,n=e<.15?e/.15:Math.pow(1-(e-.15)/.85,2),r=s/12*a;return{cameraRelativePosition:[0,0,.08*n*r],position:[0,.015*-n*r,0],scale:1-.05*n,glowIntensity:1+.15*n}}}},_e={name:"crouch",emoji:"ü¶é",type:"override",description:"Compress down into a low crouch position",config:{duration:600,musicalDuration:{musical:!0,beats:1.5},depth:.3,widen:.2,holdTime:.5,strength:1,particleMotion:{type:"crouch",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1.5},timingSync:"onBeat"},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.depth||.3,n=i.widen||.2;let r;const o=(1-(i.holdTime||.5))/2,l=1-o;return r=e<o?e/o:e<l?1:1-(e-l)/o,r=Math.sin(r*Math.PI/2),{position:[0,-r*s*a,0],rotation:[.15*r*a,0,0],scale:(1+r*n*a+(1-.25*r*a))/2,glowIntensity:1-.3*r,glowBoost:0}}}},He={name:"tilt",emoji:"ü§î",type:"override",description:"Gather particles then tilt as unified group",config:{duration:500,musicalDuration:{musical:!0,beats:1},gatherPhase:.2,tiltAngle:45,swayAmount:80,liftAmount:60,frequency:3,homeRadius:20,easing:"sine",strength:2.5,particleMotion:{type:"tilt",strength:2.5,frequency:3,swayAmount:80,liftAmount:60},smoothness:.25},rhythm:{enabled:!0,syncMode:"swing",durationSync:{mode:"beats",beats:1},angleSync:{onBeat:45,offBeat:-30,swing:15,subdivision:"triplet",curve:"ease-in-out"},gatherSync:{beatsBefore:.5,releaseAfter:.25,intensity:"dynamic"},swaySync:{verse:60,chorus:100,bridge:80,syncopated:!0},liftSync:{upOnTilt:!0,heightOnAccent:80,normalHeight:40,curve:"bounce"},dynamics:{forte:{tiltAngle:60,swayAmount:120,frequency:4},piano:{tiltAngle:20,swayAmount:40,frequency:2}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a,r=Math.atan2(n,s),o=Math.sqrt(s*s+n*n),l=Math.random(),h=({...this.config,...t}.homeRadius+20*Math.random())*e.scaleFactor;e.gestureData.tilt={startX:e.x,startY:e.y,originalVx:e.vx,originalVy:e.vy,angle:r,distance:o,homeRadius:h,homeX:i+Math.cos(r)*h,homeY:a+Math.sin(r)*h,role:l,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.tilt?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.tilt,o={...this.config,...i},l=i.strength||1;let h,c;if(t<o.gatherPhase){const i=t/o.gatherPhase,a=this.easeInOutCubic(i);h=r.startX+(r.homeX-r.startX)*a,c=r.startY+(r.homeY-r.startY)*a;const s=.6;e.x+=(h-e.x)*s,e.y+=(c-e.y)*s}else{const i=(t-o.gatherPhase)/(1-o.gatherPhase)*Math.PI*o.frequency,a=Math.sin(i),u=o.tiltAngle*Math.PI/180*l,d=r.angle+a*u,p=Math.abs(a)*o.liftAmount*e.scaleFactor,g=r.homeRadius+p;h=s+Math.cos(d)*g,c=n+Math.sin(d)*g-.3*p;const m=o.smoothness+.1*r.role;e.x+=(h-e.x)*m,e.y+=(c-e.y)*m;const y=-Math.sin(d),f=Math.cos(d);e.vx=y*a*2,e.vy=f*a*2}if(t<o.gatherPhase&&(e.vx=.25*(h-e.x),e.vy=.25*(c-e.y)),t>.9){const i=10*(1-t),a=r.startX+(e.x-r.startX)*i,s=r.startY+(e.y-r.startY)*i;e.x=a,e.y=s,e.vx=e.vx*i+r.originalVx*(1-i),e.vy=e.vy*i+r.originalVy*(1-i)}},cleanup(e){if(e.gestureData?.tilt){const t=e.gestureData.tilt;e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.tilt}},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,t){const i=t.config||{},a=t.strength||1,s=i.gatherPhase||.2,n=i.frequency||3,r=i.tiltAngle||45;let o=0;if(e>=s){const t=(e-s)/(1-s)*Math.PI*n;o=Math.sin(t)*(r*Math.PI/180*a*.4)}return{position:[0,0,0],rotation:[0,0,o],scale:1}}}};function Ue(e){const t=F[e];if(!t)throw new Error(`Invalid tilt direction: ${e}`);const i="up"===e||"down"===e;return{name:`tilt${D(e)}`,emoji:"up"===e?"üî≠":"down"===e?"üòî":"left"===e?"ü§î":"üßê",type:"override",description:`Tilt ${e} with curious expression`,config:{duration:500,musicalDuration:{musical:!0,beats:1},gatherPhase:.2,tiltAngle:45,tiltAmount:40,holdPhase:.4,homeRadius:20,easing:"sine",strength:1,direction:e,smoothness:.25,particleMotion:{type:"tilt",strength:1,tiltAmount:40}},rhythm:{enabled:!0,syncMode:"swing",durationSync:{mode:"beats",beats:1},angleSync:{onBeat:45,offBeat:30,subdivision:"triplet",curve:"ease-in-out"},gatherSync:{beatsBefore:.5,releaseAfter:.25,intensity:"dynamic"},dynamics:{forte:{tiltAngle:60,tiltAmount:60},piano:{tiltAngle:25,tiltAmount:25}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a,r=Math.atan2(n,s),o=Math.sqrt(s*s+n*n),l=({...this.config,...t}.homeRadius+20*Math.random())*e.scaleFactor;e.gestureData.tilt={startX:e.x,startY:e.y,originalVx:e.vx,originalVy:e.vy,angle:r,distance:o,homeRadius:l,homeX:i+Math.cos(r)*l,homeY:a+Math.sin(r)*l,role:Math.random(),initialized:!0}},apply(e,a,s,n,r,o){e.gestureData?.tilt?.initialized||this.initialize(e,s,r,o);const l=e.gestureData.tilt,h={...this.config,...s},c=s.strength||1;let u,d;if(a<h.gatherPhase){const t=a/h.gatherPhase,i=this.easeInOutCubic(t);u=l.startX+(l.homeX-l.startX)*i,d=l.startY+(l.homeY-l.startY)*i;const s=.6;e.x+=(u-e.x)*s,e.y+=(d-e.y)*s}else if(a<h.gatherPhase+h.holdPhase){const s=(a-h.gatherPhase)/h.holdPhase,n=this.easeOutCubic(Math.min(2*s,1)),r=h.tiltAmount*c*e.scaleFactor*n;i?(u=l.homeX,d=l.homeY+t.y*r):(u=l.homeX+t.x*r,d=l.homeY-Math.abs(t.x)*r*.2);const o=h.smoothness+.1*l.role;e.x+=(u-e.x)*o,e.y+=(d-e.y)*o,e.vx=.5*(u-e.x),e.vy=.5*(d-e.y)}else{const t=(a-h.gatherPhase-h.holdPhase)/(1-h.gatherPhase-h.holdPhase),i=this.easeInOutCubic(t);u=e.x+(l.startX-e.x)*i,d=e.y+(l.startY-e.y)*i,e.x=u,e.y=d,e.vx=l.originalVx*i,e.vy=l.originalVy*i}a<h.gatherPhase&&(e.vx=.25*(u-e.x),e.vy=.25*(d-e.y))},cleanup(e){if(e.gestureData?.tilt){const t=e.gestureData.tilt;e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.tilt}},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeOutCubic:e=>1-Math.pow(1-e,3),"3d":{evaluate(e,a){const s=a.config||a||{},n=a.strength||1,r=s.gatherPhase||.2,o=s.holdPhase||.4,l=s.tiltAngle||45,h=s.tiltAmount||40;let c=0,u=0,d=0,p=0,g=0;if(e<r);else if(e<r+o){const a=(e-r)/o,s=1-Math.pow(1-Math.min(2*a,1),3),m=l*Math.PI/180*n*.4*s,y=.004*h*n*s;i?(d=t.y*m,u=t.y*y):(g=-t.x*m,c=t.x*y*.5,p=t.x*m*.3)}else{const a=(e-r-o)/(1-r-o),s=a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2,m=l*Math.PI/180*n*.4*(1-s),y=.004*h*n*(1-s);i?(d=t.y*m,u=t.y*y):(g=-t.x*m,c=t.x*y*.5,p=t.x*m*.3)}return{cameraRelativePosition:[c,u,0],rotation:[d,p,g],scale:1}}}}}var Qe=Ue("up"),Ye=Ue("down"),Xe=Ue("left"),Ne=Ue("right");function Je(e){if(!["left","right","front","back","up","down"].includes(e))throw new Error(`Invalid oof direction: ${e}`);return{name:`oof${D(e)}`,emoji:{left:"ü§ú",right:"ü§õ",front:"üëä",back:"üò´",up:"ü•ä",down:"üí•"}[e],type:"override",description:{left:"Punched from left",right:"Punched from right",front:"Gut punch",back:"Kidney shot",up:"Uppercut",down:"Hammer fist"}[e],config:{duration:500,musicalDuration:{musical:!0,beats:1},intensity:1,strength:1,direction:e,particleMotion:{type:"oof",strength:1,direction:e}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1;let s,n;if(e<.25){const t=e/.25;s=t*(2-t)}else{const t=(e-.25)/.75;s=1-t*t}n=e<.1?e/.1:e<.4?1:1-(e-.4)/.6;const r=.2*a,o=.35*a;let l=0,h=0,c=0,u=0,d=0,p=[0,0,.4];switch(i.direction||"front"){case"left":l=-s*r,d=s*o,p=[.4,0,0];break;case"right":l=s*r,d=-s*o,p=[-.4,0,0];break;case"front":c=-s*r,h=.03*-s,u=s*o*.7,p=[0,0,.4];break;case"back":c=s*r,u=-s*o*.6,p=[0,0,-.4];break;case"up":h=s*r,u=-s*o*.4,p=[0,.8,0];break;case"down":h=-s*r,u=s*o*.3,p=[0,-.8,0]}let g=1,m=0;if(e<.15){const t=e/.15;g=1+.6*(1-t),m=.4*(1-t)}return{cameraRelativePosition:[l,h,c],cameraRelativeRotation:[u,0,d],scale:1,glowIntensity:g,glowBoost:m,deformation:{enabled:!0,strength:n*a*2,impactPoint:p,falloffRadius:.5}}}}}}var Ze={name:"recoil",emoji:"üò±",type:"override",description:"Snap backwards in shock or surprise",config:{duration:600,musicalDuration:{musical:!0,beats:1.5},distance:.2,intensity:1,recover:!0,strength:1,particleMotion:{type:"recoil",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1.5},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.6}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.distance||.2,n=i.intensity||1,r=!1!==i.recover;let o;return e<.15?(o=e/.15,o=1-Math.pow(1-o,4)):e<.4?o=1:r?(o=1-(e-.4)/.6,o=Math.pow(o,.5)):o=1,{position:[0,.05*o*a,-o*s*a*n],rotation:[.25*-o*a*n,0,0],scale:1-.1*o*n,glowIntensity:1+(e<.2?3*(.2-e):0),glowBoost:e<.15?.5:0}}}};function Ke(e){if(!{...F,forward:{x:0,y:0,z:-1},back:{x:0,y:0,z:1}}[e])throw new Error(`Invalid recoil direction: ${e}`);return{name:`recoil${D(e)}`,emoji:{back:"üò±",forward:"üòµ",left:"üò∞",right:"üò∞",up:"üò≤",down:"üò®"}[e]||"üò±",type:"override",description:`Recoil ${e} in shock`,config:{duration:600,musicalDuration:{musical:!0,beats:1.5},distance:.2,intensity:1,recover:!0,strength:1,direction:e,particleMotion:{type:"recoil",strength:1,direction:e}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1.5},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.6}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.distance||.2,n=i.intensity||1,r=!1!==i.recover,o=i.direction||"back";let l;e<.15?(l=e/.15,l=1-Math.pow(1-l,4)):e<.4?l=1:r?(l=1-(e-.4)/.6,l=Math.pow(l,.5)):l=1;let h=0,c=0,u=0,d=0,p=0;switch(o){case"back":u=-l*s*a*n,d=.25*-l*a*n,c=.05*l*a;break;case"forward":u=l*s*a*n,d=.25*l*a*n,c=.05*-l*a;break;case"left":h=-l*s*a*n,p=.2*l*a*n;break;case"right":h=l*s*a*n,p=.2*-l*a*n;break;case"up":c=l*s*a*n,d=.1*-l*a*n;break;case"down":c=-l*s*a*n,d=.3*l*a*n}return{cameraRelativePosition:[h,c,u],cameraRelativeRotation:[d,0,p],scale:1-.1*l*n,glowIntensity:1+(e<.2?3*(.2-e):0),glowBoost:e<.15?.5:0}}}}}var et={name:"knockdown",emoji:"üí•",type:"override",description:"Quick knockdown with fast recovery",config:{duration:1500,musicalDuration:{musical:!0,bars:1},strength:1,particleMotion:{type:"knockdown",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.4}},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1;let a=0,s=0,n=0,r=0,o=1,l=1,h=0;if(e<.15){const t=e/.15,a=1-Math.pow(1-t,2);s=.1*a*i,n=.2*-a*i,l=1+.6*a,h=.5*a}else if(e<.4){const t=(e-.15)/.25,s=t*t;a=.2*-s*i,n=(.6*s-.2)*i,r=.3*s*i,t>.7&&(o=1-(t-.7)/.3*.1),l=1.6-.5*t,h=.5-.4*t}else if(e<.6){const t=(e-.4)/.2;a=-.2*i,n=.4*i,r=.3*i,r+=.02*Math.sin(t*Math.PI*2),o=.9,l=.8}else{const t=(e-.6)/.4,s=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;if(a=(.2*s-.2)*i,n=(.4-.4*s)*i,r=(.3-.3*s)*i,o=.9+.1*s,t>.7){const e=(t-.7)/.3;r+=.03*Math.sin(e*Math.PI*4)*(1-e)}l=.8+.2*s,t>.9&&(h=(t-.9)/.1*.2)}return{position:[0,a,s],rotation:[n,0,r],scale:o,glowIntensity:l,glowBoost:h}}}},tt={name:"knockout",emoji:"üí´",type:"override",description:"Theatrical knockout with failed rise attempt, then recovery",config:{duration:4e3,musicalDuration:{musical:!0,bars:2},strength:1,particleMotion:{type:"knockout",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:2},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.3}},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1;let a=0,s=0,n=0,r=0,o=0,l=1,h=1,c=0;if(e<.1){const t=e/.1,a=1-Math.pow(1-t,3);s=.15*a*i,n=.3*-a*i,h=1+.8*a,c=.6*a,o=.1*Math.sin(t*Math.PI*4)*a}else if(e<.25){const t=(e-.1)/.15,s=t*t;a=.25*-s*i,n=(.8*s-.3)*i,o=.4*s*i,t>.8&&(l=1-(t-.8)/.2*.15),h=1.8-.6*t,c=.6-.4*t}else if(e<.35){const t=(e-.25)/.1;a=-.25*i,n=.5*i,o=.4*i,o+=.03*Math.sin(t*Math.PI*6)*(1-t),l=.85,h=1-.3*t}else if(e<.45){const t=(e-.35)/.1,s=1-Math.pow(1-t,2);a=(.15*s-.25)*i,n=(.5-.3*s)*i,o=(.4-.2*s)*i,l=.85+.1*s,h=.7+.4*s}else if(e<.55){const t=(e-.45)/.1,s=t*t;a=(-.1-.15*s)*i,n=(.2+.35*s)*i,o=(.2+.25*s)*i,l=.95-.12*s,t>.7&&(c=(t-.7)/.3*.3),h=1.1-.4*t}else if(e<.75){const t=(e-.55)/.2;a=-.25*i,n=.55*i,o=.45*i,l=.83;const s=.02*Math.sin(t*Math.PI*4)*Math.sin(t*Math.PI);o+=s,h=.6+2*s}else if(e<.9){const t=(e-.75)/.15,s=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;a=(.25*s-.25)*i,n=(.55-.55*s)*i,o=(.45-.45*s)*i,l=.83+.17*s,h=.6+.5*s}else{const t=(e-.9)/.1;a=0,n=0,o=Math.sin(t*Math.PI*6)*(1-t)*.08*i,r=Math.sin(t*Math.PI*8)*(1-t)*.1*i,l=1,h=1+.2*Math.sin(t*Math.PI*3)*(1-t),c=.2*Math.sin(t*Math.PI)}return{position:[0,a,s],rotation:[n,r,o],scale:l,glowIntensity:h,glowBoost:c}}}},it={name:"inflate",emoji:"üéà",type:"override",description:"Puff up dramatically like a balloon",config:{duration:800,musicalDuration:{musical:!0,beats:2},maxScale:1.4,holdTime:.3,deflate:!0,strength:1,particleMotion:{type:"inflate",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2},timingSync:"onBeat",strengthSync:{onBeat:1.3,offBeat:.8}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.maxScale||1.4,n=i.holdTime||.3,r=!1!==i.deflate;let o;const l=.5*(1-n),h=1-l;e<l?(o=e/l,o=1-Math.pow(1-o,2)):e<h||!r?o=1:(o=1-(e-h)/l,o=Math.pow(o,2));const c=1+(s-1)*o*a,u=.08*o*a,d=1+.4*o*a,p=.3*o,g=o>.8?.02*Math.sin(e*Math.PI*8):0;return{position:[g,u,0],rotation:[0,0,2*g],scale:c,glowIntensity:d,glowBoost:p}}}},at={name:"deflate",emoji:"üí®",type:"override",description:"Shrink down sadly like a deflating balloon",config:{duration:1e3,musicalDuration:{musical:!0,beats:2.5},minScale:.6,droop:.15,reinflate:!0,strength:1,particleMotion:{type:"deflate",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2.5},timingSync:"onBeat"},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.minScale||.6,n=i.droop||.15,r=!1!==i.reinflate;let o;return e<.5?(o=e/.5,o=Math.pow(o,.7)):e<.7||!r?o=1:(o=1-(e-.7)/.3,o=Math.pow(o,1.5)),{position:[0,-o*n*a,0],rotation:[.15*o*a,0,.1*o*a],scale:1-(1-s)*o*a,glowIntensity:1-.4*o,glowBoost:0}}}},st={name:"squash",emoji:"ü´ì",type:"override",description:"Flatten horizontally like a cartoon impact",config:{duration:500,musicalDuration:{musical:!0,beats:1},squashAmount:.5,stretchAmount:1.5,bounce:!0,strength:1,particleMotion:{type:"squash",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.squashAmount||.5,n=i.stretchAmount||1.5,r=!1!==i.bounce;let o;if(e<.15)o=e/.15,o=1-Math.pow(1-o,3);else if(r){const t=(e-.15)/.85,i=Math.exp(4*-t);o=Math.cos(t*Math.PI*3)*i,o=Math.max(0,o)}else o=0;const l=1+o*(n-1)*a;return{position:[0,.15*-o*a,0],rotation:[0,0,0],scale:[l,1-o*(1-s)*a,l],glowIntensity:1+(e<.2?3*(.2-e):0),glowBoost:e<.15?.6:0}}}},nt={name:"stretch",emoji:"‚ÜîÔ∏è",type:"override",description:"Scale particles along X and Y axes",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},scaleX:1.3,scaleY:.9,alternate:!1,elastic:!0,overshoot:.1,frequency:1,easing:"sine",strength:1,particleMotion:{type:"stretch",scaleX:1.8,scaleY:.6,strength:1},centerBased:!0,preserveArea:!1},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},scaleSync:{onBeat:{x:1.5,y:.7},offBeat:{x:.8,y:1.3},subdivision:"eighth",curve:"elastic"},alternateSync:{pattern:"XYXY",beatsPerChange:1,overlap:.1},overshootSync:{normal:.1,accent:.3,downbeat:.2,curve:"spring"},preservationSync:{verse:!0,chorus:!1,bridge:!0},dynamics:{forte:{scaleX:2,scaleY:.5,overshoot:.4},piano:{scaleX:1.1,scaleY:.95,overshoot:.05}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a;e.gestureData.stretch={offsetX:s,offsetY:n,startX:e.x,startY:e.y,originalVx:e.vx,originalVy:e.vy,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.stretch?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.stretch,o={...this.config,...i},l=i.strength||1;let h,c,{scaleX:u}=o,{scaleY:d}=o;if(o.preserveArea&&1!==u&&1!==d){const e=u*d,t=Math.sqrt(1/e);u*=t,d*=t}if(o.alternate)if(t<.5){const e=2*t;u=1+(u-1)*this.getElasticProgress(e,o),d=1+(1/u-1)*(o.preserveArea?1:0)}else{const e=2*(t-.5);u+=(1-u)*this.getElasticProgress(e,o),d=1+(d-1)*this.getElasticProgress(e,o)}else{const e=this.getElasticProgress(t,o);u=1+(u-1)*e*l,d=1+(d-1)*e*l}if(o.centerBased?(h=s+r.offsetX*u,c=n+r.offsetY*d):(h=r.startX*u,c=r.startY*d),e.x=h,e.y=c,e.vx=r.offsetX*(u-1)*l*.1,e.vy=r.offsetY*(d-1)*l*.1,t>.9){const i=10*(1-t);e.vx=e.vx*i+r.originalVx*(1-i),e.vy=e.vy*i+r.originalVy*(1-i)}},getElasticProgress(e,t){if(!t.elastic)return this.easeInOutCubic(e);if(0===e)return 0;if(1===e)return 1;const i=t.overshoot||.1;if(e<.5){const t=2*e;return.5*this.easeInElastic(t,i)}{const t=2*(e-.5);return.5+.5*this.easeOutElastic(t,i)}},cleanup(e){if(e.gestureData?.stretch){const t=e.gestureData.stretch;e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.stretch}},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInElastic:(e,t)=>0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin((e-1-.075)*(2*Math.PI)/.3)*(1+t),easeOutElastic:(e,t)=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)*(1+t)+1,"3d":{evaluate(e,t){const{particle:i}=t;if(!i||!i.gestureData?.stretch)return{position:[0,0,0],rotation:[0,0,0],scale:1};const a=t.config||{},s=t.strength||1;let n;if(a.elastic){const t=a.overshoot||.1;if(e<.5){const i=2*e,a=.3,s=a/4;n=-Math.pow(2,10*(i-1))*Math.sin((i-1-s)*(2*Math.PI)/a)*(1+t)*.5}else{const i=2*(e-.5),a=.3,s=a/4;n=.5+.5*(Math.pow(2,-10*i)*Math.sin((i-s)*(2*Math.PI)/a)*(1+t)+1)}}else n=e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2;let r,o=1;if(e>.8){const t=(e-.8)/(1-.8);o=1-t*t*t}r=a.alternate?e<.5?2*e*.8:.8-2*(e-.5)*1.4:1*n*s;const l=1+r*o;return{position:[0,0,0],rotation:[0,0,.1*Math.sin(e*Math.PI*4)*n*o],scale:l}}}},rt={name:"pancake",emoji:"ü•û",type:"override",description:"Extreme flatten and hold - cartoon pancake effect",config:{duration:1600,musicalDuration:{musical:!0,bars:1},squashAmount:.2,stretchAmount:2,holdRatio:.5,strength:1,particleMotion:{type:"pancake",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.squashAmount||.2,n=i.stretchAmount||2,r=.1+.6*(i.holdRatio||.5);let o=0,l=0;if(e<.1){const t=e/.1;o=1-Math.pow(1-t,2)}else if(e<r){o=1;const t=(e-.1)/(r-.1);l=Math.sin(t*Math.PI*4)*(1-t)*.02}else{const t=(e-r)/(1-r);if(o=1-(t<.3?t/.3*.3:.3+(t-.3)/.7*.7),t>.8){const e=(t-.8)/.2,i=.15*Math.sin(e*Math.PI);o=Math.max(0,o-i)}}const h=1+o*(n-1)*a;let c=1,u=0;return e<.15?(c=1+.8*(1-e/.15),u=.6*(1-e/.15)):e<r?(c=1.3,u=.2):c=1.3-(e-r)/(1-r)*.3,{position:[l*a,.2*-o*a,0],rotation:[0,0,2*l*a],scale:[h,1-o*(1-s)*a,h],glowIntensity:c,glowBoost:u}}}},ot={name:"rage",emoji:"üí¢",type:"override",description:"Barbarian rage - intense buildup and release",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},strength:1,particleMotion:{type:"rage",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.6}},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1;let a=0,s=0,n=0,r=0,o=1,l=1,h=0;if(e<.2){const t=e/.2,o=t*t;s=.05*-o*i,n=.15*o*i;const h=Math.sin(80*e)*o*.02;r=h*i,a=.02*h*i,l=1+.3*o}else if(e<.6){const t=(e-.2)/.4,c=t*t;s=(-.05-.03*c)*i,n=(.15+.1*c)*i;const u=.02+.04*c,d=100+50*t,p=Math.sin(e*d)*u;r=p*i,a=.03*p*i,o=1+.1*c,l=1.3+.7*c,h=.5*c}else if(e<.8){const t=(e-.6)/.2;s=(.15*t-.08)*i,n=(.25-.4*t)*i,r=Math.sin(150*e)*(1-.5*t)*.05*i,o=1.1+.08*Math.sin(t*Math.PI),l=2-.3*t,h=.5+.3*Math.sin(t*Math.PI)}else{const t=(e-.8)/.2,a=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;s=(.07-.07*a)*i,n=(.15*a-.15)*i,r=Math.sin(50*e)*(1-a)*.02*i,o=1.1-.1*a,l=1.7-.7*a,h=.5*(1-a)}return{position:[a,s,0],rotation:[n,0,r],scale:o,glowIntensity:l,glowBoost:h}}}},lt={name:"fury",emoji:"üò§",type:"override",description:"Quick fury burst - intense flash of anger",config:{duration:800,musicalDuration:{musical:!0,beats:2},strength:1,particleMotion:{type:"fury",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1;let a=0,s=0,n=0,r=1,o=1,l=0;if(e<.2){const t=e/.2,s=1-Math.pow(1-t,3);r=1+.15*s*i;const h=Math.sin(120*e)*s*.04;n=h*i,a=.02*h*i,o=1+1.2*s,l=.7*s}else if(e<.5){const t=(e-.2)/.3;r=1.15+.03*Math.sin(t*Math.PI*3);const h=.05*Math.sin(150*e)*(1-.3*t);n=h*i,a=.025*h*i,s=.1*Math.sin(t*Math.PI)*i,o=2.2-.3*t,l=.7-.2*t}else{const t=(e-.5)/.5,a=t*t;r=1.15-.15*a,n=Math.sin(80*e)*(1-a)*.03*i,s=.1*(1-a)*i,o=1.9-.9*a,l=.5*(1-a)}return{position:[a,0,0],rotation:[s,0,n],scale:r,glowIntensity:o,glowBoost:l}}}},ht={name:"battlecry",emoji:"üì£",type:"override",description:"Warrior battlecry - inhale, expand, roar",config:{duration:1500,musicalDuration:{musical:!0,bars:1},strength:1,particleMotion:{type:"battlecry",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1;let a=0,s=0,n=0,r=0,o=1,l=1,h=0;if(e<.25){const t=e/.25,r=t*t;s=.08*r*i,n=.15*-r*i,a=.03*-r*i,o=1+.05*r,l=1+.4*r}else if(e<.4){const t=(e-.25)/.15;s=(.08+.02*t)*i,n=(-.15-.1*t)*i,a=(.05*t-.03)*i,o=1.05+.08*t,l=1.4+.5*t,h=.4*t}else if(e<.6){const t=(e-.4)/.2,c=1-Math.pow(1-t,3);s=(.1-.2*c)*i,n=(.4*c-.25)*i,a=(.02+.08*c)*i,o=1.13+.12*c,l=1.9+.6*c,h=.4+.4*c,r=Math.sin(t*Math.PI*20)*(1-t)*.02*i}else{const t=(e-.6)/.4,c=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;s=-.1*(1-c)*i,n=.15*(1-c)*i,a=.1*(1-c)*i,o=1.25-.25*c,r=Math.sin(t*Math.PI*8)*(1-c)*.015*i,l=2.5-1.5*c,h=.8-.8*c}return{position:[0,a,s],rotation:[n,0,r],scale:o,glowIntensity:l,glowBoost:h}}}},ct={name:"charge",emoji:"üêÇ",type:"override",description:"Bull charge - wind up and rush forward",config:{duration:1200,musicalDuration:{musical:!0,beats:3},strength:1,particleMotion:{type:"charge",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:3},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1;let a=0,s=0,n=0,r=0,o=0,l=1,h=1,c=0;if(e<.2){const t=e/.2,a=t*t;s=.08*-a*i,n=.1*a*i,r=.25*a*i,l=1-.05*a,h=1+.4*a}else if(e<.6){const t=(e-.2)/.4,a=1-Math.pow(1-t,2);n=(.1-.35*a)*i,r=(.25+.1*a)*i,s=(.06*a-.08)*i,l=.95+.15*a,h=1.4+.6*a,c=.4*a,o=Math.sin(t*Math.PI*10)*a*.02*i}else if(e<.85){const t=(e-.6)/.25;n=-.25*i,r=(.35-.1*t)*i;const s=Math.sin(t*Math.PI*15)*(1-t)*.04;o=s*i,a=.02*s*i,l=1.1+.05*Math.sin(t*Math.PI),h=2-.3*t,c=.4*(1-.5*t)}else{const t=(e-.85)/.15,a=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;n=-.25*(1-a)*i,r=.25*(1-a)*i,s=-.02*(1-a)*i,l=1.1-.1*a,h=1.7-.7*a,c=.2*(1-a)}return{cameraRelativePosition:[a,s,n],rotation:[r,0,o],scale:l,glowIntensity:h,glowBoost:c}}}},ut={name:"wobble",emoji:"ü•¥",type:"override",description:"Unsteady circular wobbling motion",config:{duration:1500,musicalDuration:{musical:!0,beats:4},wobbleRadius:.08,wobbleAngle:.2,rotations:2,decay:.5,strength:1,particleMotion:{type:"wobble",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:4},timingSync:"onBeat"},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.wobbleRadius||.08,n=i.wobbleAngle||.2,r=i.rotations||2,o=i.decay||.5,l=e*r*Math.PI*2,h=1-o*e,c=Math.sin(l)*s*h*a,u=Math.cos(l)*s*h*a,d=Math.cos(l)*n*h*a,p=Math.sin(l)*n*h*a;return{position:[c,.02*Math.sin(2*l)*h*a,u],rotation:[d,0,p],scale:1+.05*Math.sin(2*l)*h,glowIntensity:1+.2*Math.sin(l)*h,glowBoost:0}}}},dt={name:"teeter",emoji:"‚öñÔ∏è",type:"override",description:"Rock back and forth unstably like losing balance",config:{duration:1200,musicalDuration:{musical:!0,beats:3},tiltAngle:.25,frequency:3,irregularity:.3,strength:1,particleMotion:{type:"teeter",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:3},timingSync:"onBeat"},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.tiltAngle||.25,n=i.frequency||3,r=i.irregularity||.3,o=(Math.sin(e*n*Math.PI*2)+Math.sin(e*(n+1.7)*Math.PI*2)*r+Math.sin(e*(.5*n)*Math.PI*2)*r*.5)/(1+1.5*r),l=o*s*a*.7,h=Math.sin(e*n*Math.PI*2+.5)*s*a*.5;return{position:[.15*h,0,.1*l],rotation:[l,0,h],scale:1+.05*Math.abs(o),glowIntensity:1+.2*Math.abs(o),glowBoost:0}}}},pt={name:"rock",emoji:"ü™®",type:"override",description:"Gentle front-back rocking motion",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},rockAngle:.15,rockCycles:2,smooth:!0,strength:1,particleMotion:{type:"rock",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat"},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.rockAngle||.15,n=e*(i.rockCycles||2)*Math.PI*2,r=Math.sin(n),o=r*s*a,l=.05*r*a;return{position:[0,.02*Math.abs(r)*a,l],rotation:[o,0,0],scale:1+.02*Math.sin(.5*n),glowIntensity:1+.1*r,glowBoost:0}}}},gt={name:"pendulum",emoji:"üï∞Ô∏è",type:"override",description:"Swing side to side like a pendulum clock",config:{duration:1500,musicalDuration:{musical:!0,beats:4},swingAngle:.4,swings:2,damping:.3,strength:1,particleMotion:{type:"pendulum",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:4},timingSync:"onBeat"},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.swingAngle||.4,n=i.swings||2,r=i.damping||.3,o=e*n*Math.PI*2,l=1-r*e,h=Math.sin(o)*l,c=h*s*a;return{position:[.1*h*a,.03*-Math.abs(h)*a,0],rotation:[0,0,c],scale:1,glowIntensity:1+.15*Math.abs(h),glowBoost:0}}}};function mt(e){const t={front:{screenOffset:[0,0],screenDirection:[0,0],recoilDir:[0,0,-1]},back:{screenOffset:[0,0],screenDirection:[0,0],recoilDir:[0,0,1]},left:{screenOffset:[-.1,0],screenDirection:[1,0],recoilDir:[1,0,0]},right:{screenOffset:[.1,0],screenDirection:[-1,0],recoilDir:[-1,0,0]},up:{screenOffset:[0,.1],screenDirection:[0,-1],recoilDir:[0,-1,0]},down:{screenOffset:[0,-.1],screenDirection:[0,1],recoilDir:[0,1,0]}},i=t[e]||t.front;return{name:`crack${e.charAt(0).toUpperCase()+e.slice(1)}`,emoji:"üíî",type:"override",category:"reactions",description:`Surface cracks spreading from ${e} impact`,config:{duration:2e3,strength:1,glowStrength:.3,holdTime:500},rhythm:{enabled:!0,syncMode:"accent",strengthSync:{onBeat:1.2,offBeat:.8}},"3d":{evaluate(e,t){const a={strength:1,glowStrength:.3,...t},{strength:s,glowStrength:n}=a,r=.03*Math.max(0,1-4*e)*s,{recoilDir:o}=i,l=e<.05;return{cameraRelativePosition:[o[0]*r,o[1]*r,o[2]*r],crack:{enabled:!0,trigger:l,amount:s,propagation:.8,screenOffset:i.screenOffset,screenDirection:i.screenDirection,glowStrength:n}}}}}}const yt=mt("front"),ft=mt("back"),bt=mt("left"),wt=mt("right"),vt=mt("up"),Mt=mt("down"),St={name:"crackHeal",emoji:"‚ú®",type:"override",category:"reactions",description:"Heal and fade existing cracks",config:{duration:1500,glowStrength:.5},"3d":{evaluate(e,t){const i={duration:1500,...t},a=e<.05;return{cameraRelativePosition:[0,.02*Math.sin(e*Math.PI),0],crack:{enabled:!1,heal:!0,healTrigger:a,healDuration:i.duration},glowBoost:.1*Math.sin(e*Math.PI)}}}};var xt={name:"shatter",emoji:"üí•",type:"override",description:"Particles explode outward then freeze like shattered glass",config:{duration:1500,musicalDuration:{musical:!0,bars:1},explosionPhase:.3,freezePhase:.7,distance:100,tumble:1,strength:1,particleMotion:{type:"shatter",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=Math.random()*Math.PI*2,n=.5+.5*Math.random();e.gestureData.shatter={originalX:e.x,originalY:e.y,originalOpacity:e.opacity??1,velocityX:Math.cos(s)*n,velocityY:Math.sin(s)*n,tumbleAngle:0,tumbleSpeed:4*(Math.random()-.5),frozenX:null,frozenY:null,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.shatter?.initialized||this.initialize(e,i,s,n);const r={...this.config,...i},o=r.strength||1,l=r.distance||100,h=e.gestureData.shatter,c=r.explosionPhase||.3,u=r.freezePhase||.7;if(t<c){const i=t/c,a=1-Math.pow(1-i,3),s=h.velocityX*l*a*o,n=h.velocityY*l*a*o;e.x=h.originalX+s,e.y=h.originalY+n,h.tumbleAngle+=h.tumbleSpeed*(1-i)}else if(t<u){const i=(t-c)/(u-c),a=h.originalX+h.velocityX*l*o,s=h.originalY+h.velocityY*l*o,n=h.velocityX*l*.2*i*o,r=h.velocityY*l*.2*i*o;e.x=a+n,e.y=s+r,h.tumbleAngle+=.3*h.tumbleSpeed*(1-i),i>.95&&null===h.frozenX&&(h.frozenX=e.x,h.frozenY=e.y)}else if(null!==h.frozenX&&(e.x=h.frozenX,e.y=h.frozenY),t>.9){const i=(t-.9)/.1;e.opacity=h.originalOpacity*(1-.5*i)}},cleanup(e){if(e.gestureData?.shatter){const t=e.gestureData.shatter;e.x=t.originalX,e.y=t.originalY,e.opacity=t.originalOpacity,delete e.gestureData.shatter}},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1;let a=1,s=1,n=1,r=0,o=0,l=0,h=0,c=0,u=0,d=1,p=0;if(e<.1){const t=e/.1,r=1-Math.pow(1-t,2);s=1-.4*r*i,a=1+.2*r*i,n=1+.2*r*i,c=.1*-r*i,d=1+1*r,p=.8*r}else if(e<.4){const t=(e-.1)/.3,g=1-.6*t,m=40,y=Math.sin(e*m*Math.PI)*g,f=Math.cos(e*m*1.3*Math.PI)*g,b=Math.sin(e*m*.7*Math.PI)*g,w=1+.3*(1-Math.pow(1-t,2))*i;a=w+.15*y*i,s=w+.15*f*i,n=w+.15*b*i,r=.4*y*i,o=.5*f*i,l=.3*b*i,h=.15*y*i,c=.12*f*i+.1*t,u=.1*b*i,d=1.5+.5*Math.abs(y),p=.5*g}else if(e<.7){const t=(e-.4)/.3,r=t*t,o=1-r,h=20*o,u=Math.sin(e*h*Math.PI)*o,g=1.3-.4*r;a=g+.05*u*i,s=g+.05*u*i,n=g+.05*u*i,l=.15*u*i,c=.1*o,d=1.5-.3*r,p=.3*o}else{const t=(e-.7)/.3,i=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,r=Math.sin(t*Math.PI*2)*(1-t)*.05;if(a=.9+.1*i+r,s=.9+.1*i+r,n=.9+.1*i+r,d=1.2-.2*i,e>.95){const t=(e-.95)/.05;p=.3*Math.sin(t*Math.PI)}}return{position:[h,c,u],rotation:[r,o,l],scale:[a,s,n],glowIntensity:d,glowBoost:p}}}};const kt={default:{name:"shatter",emoji:"üí•",description:"Dramatic shattering effect",duration:2500,beats:4,intensity:1,impactPoint:[0,0,.4],impactDirection:[0,0,-1],reassemble:!1,revealSoul:!1},explosive:{name:"shatterExplosive",emoji:"üî•",description:"Explosive outward shatter",duration:2e3,beats:3,intensity:1.5,impactPoint:[0,0,0],impactDirection:[0,1,0],reassemble:!1,revealSoul:!0},crumble:{name:"shatterCrumble",emoji:"ü™®",description:"Slow crumbling collapse",duration:8e3,beats:16,intensity:.15,impactPoint:[0,-.4,0],impactDirection:[0,-1,0],reassemble:!1,revealSoul:!0,gravity:-.8,explosionForce:.1,rotationForce:.5,shatterTriggerAt:0},reform:{name:"shatterReform",emoji:"‚ú®",description:"Shatter then magically reassemble",duration:4e3,beats:8,intensity:1,impactPoint:[0,0,.4],impactDirection:[0,0,-1],reassemble:!0,reassembleAt:.5,reassembleDuration:1500,revealSoul:!0},punchLeft:{name:"shatterPunchLeft",emoji:"üëä",description:"Shatter from left impact with deformation",duration:1500,beats:2,intensity:1.2,impactPoint:[-.4,0,0],impactDirection:[1,0,0],reassemble:!1,useDeformation:!0,direction:"left",revealSoul:!1},punchRight:{name:"shatterPunchRight",emoji:"üëä",description:"Shatter from right impact with deformation",duration:1500,beats:2,intensity:1.2,impactPoint:[.4,0,0],impactDirection:[-1,0,0],reassemble:!1,useDeformation:!0,direction:"right",revealSoul:!1},punchFront:{name:"shatterPunchFront",emoji:"üëä",description:"Shatter from front impact with deformation",duration:1500,beats:2,intensity:1.2,impactPoint:[0,0,.4],impactDirection:[0,0,-1],reassemble:!1,useDeformation:!0,direction:"front",revealSoul:!1},suspend:{name:"shatterSuspend",emoji:"üåå",description:"Shatter, freeze mid-air, then reassemble",duration:4e3,beats:8,intensity:.8,impactPoint:[0,0,0],impactDirection:[0,1,0],reassemble:!0,reassembleAt:.7,reassembleDuration:1200,revealSoul:!0,isSuspendMode:!0,suspendAt:.12,suspendDuration:.2,gravity:-2,explosionForce:1.2},freeze:{name:"shatterFreeze",emoji:"‚ùÑÔ∏è",description:"Shatter and freeze mid-air (call triggerReassembly to reform)",duration:2e3,beats:4,intensity:.8,impactPoint:[0,0,0],impactDirection:[0,1,0],reassemble:!1,revealSoul:!0,isFreezeMode:!0,isSuspendMode:!0,suspendAt:.12,suspendDuration:.2,gravity:-2,explosionForce:1.2},implode:{name:"shatterImplode",emoji:"üåÄ",description:"Shards implode inward to center (or implode existing frozen shards)",duration:2500,beats:4,intensity:.8,impactPoint:[0,0,0],impactDirection:[0,1,0],reassemble:!1,revealSoul:!0,isDualMode:!0,dualModeType:"implode",dualModeDuration:1800,gravity:-3,explosionForce:1.2},gravity:{name:"shatterGravity",emoji:"‚¨áÔ∏è",description:"Shards fall with gravity and bounce on floor (or drop frozen shards)",duration:4e3,beats:8,intensity:.6,impactPoint:[0,0,0],impactDirection:[0,-1,0],reassemble:!1,revealSoul:!0,isDualMode:!0,dualModeType:"gravity",dualModeDuration:3e3,floorY:-.35,gravity:-2,explosionForce:.4},orbit:{name:"shatterOrbit",emoji:"ü™ê",description:"Shards orbit around the soul then reassemble",duration:5e3,beats:10,intensity:.6,impactPoint:[0,0,0],impactDirection:[0,1,0],reassemble:!0,reassembleAt:.75,reassembleDuration:1200,revealSoul:!0,isDualMode:!0,dualModeType:"orbit",dualModeDuration:3500,orbitSpeed:1.5,radiusMultiplier:1.2,gravity:-3,explosionForce:1}};function Ot(e="default"){const t=kt[e]||kt.default;return{name:t.name,emoji:t.emoji,type:"override",description:t.description,config:{duration:t.duration,musicalDuration:{musical:!0,beats:t.beats},intensity:t.intensity,variant:e},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:t.beats},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.3}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.intensity||1,s=i.variant||"default",n=kt[s]||kt.default,r=n.useDeformation||!1,o=n.direction||"front";let l=!1,h=!1,c=1,u=0,d=1,p=null,g=null,m=null;const y=n.reassemble,f=n.reassembleAt||.5;if(r){let t;if(e<.3){const i=e/.3;t=i*(2-i)}else t=0;let i=0;e<.25?i=e/.25:e<.3&&(i=1);const s=.15*a,r=.25*a;let h=0,d=0;const y=0;let f=0,b=0;switch(o){case"left":h=t*s,b=-t*r;break;case"right":h=-t*s,b=t*r;break;case"front":d=-t*s,f=t*r*.7}if(t>0&&(g=[h,y,d],m=[f,0,b]),i>0&&(p={enabled:!0,strength:i*a*2.5,impactPoint:n.impactPoint,falloffRadius:.5}),e>=.28&&e<.32&&(l=!0),e<.35){const t=e/.35;c=1+.8*(1-t),u=.5*(1-t)}}else{const t=void 0!==n.shatterTriggerAt?n.shatterTriggerAt:.1,i=t+.02;if(e<t){if(t>0){const i=e/t,a=i*i;c=1+.6*a,u=.3*a,d=1+.05*a,"explosive"===s&&(d+=.01*Math.sin(200*e)*i)}}else if(e<i)l=e>=t&&e<t+.005,c=1.6,u=.4,d=1.05;else{if(y&&e>=f&&e<f+.02&&(h=!0),y&&e>=f){const t=(e-f)/(1-f),i=t*t;c=1+.8*i,u=.5*i,e>.95&&(c=2,u=.8)}else{const t=(e-i)/(y?f-i:1-i),a=Math.min(1,t),s=1-(1-a)*(1-a);c=1.6-.6*s,u=.4-.4*s}d=1}}const b={scale:d,glowIntensity:c,glowBoost:u,shatter:{enabled:l,impactPoint:n.impactPoint,impactDirection:n.impactDirection||[0,0,-1],intensity:a*n.intensity,variant:s,reassemble:h,reassembleDuration:n.reassembleDuration||1e3,revealSoul:!1!==n.revealSoul,isSuspendMode:n.isSuspendMode||!1,suspendAt:n.suspendAt||.25,suspendDuration:n.suspendDuration||.35,isFreezeMode:n.isFreezeMode||!1,gravity:n.gravity,explosionForce:n.explosionForce,rotationForce:n.rotationForce,gestureDuration:n.duration,isDualMode:n.isDualMode||!1,dualModeType:n.dualModeType,dualModeConfig:{duration:n.dualModeDuration||2e3,impactPoint:n.impactPoint,windDirection:n.windDirection,windForce:n.windForce,turbulence:n.turbulence,waveSpeed:n.waveSpeed,floorY:n.floorY,orbitSpeed:n.orbitSpeed,radiusMultiplier:n.radiusMultiplier,reassemble:n.reassemble,reassembleDuration:n.reassembleDuration}}};return p&&(b.deformation=p),g&&(b.cameraRelativePosition=g),m&&(b.cameraRelativeRotation=m),b}}}}const At={up:{name:"dissolveUp",emoji:"üå¨Ô∏è",description:"Shards blow upward like rising dust",windDirection:[0,1,.1],windForce:2.5,turbulence:.6},down:{name:"dissolveDown",emoji:"üí®",description:"Shards blow downward like falling ash",windDirection:[0,-1,.1],windForce:1.8,turbulence:.4},left:{name:"dissolveLeft",emoji:"‚¨ÖÔ∏è",description:"Shards blow left in the wind",windDirection:[-1,.15,0],impactDir:[1,.15,0],windForce:2.2,turbulence:.5},right:{name:"dissolveRight",emoji:"‚û°Ô∏è",description:"Shards blow right in the wind",windDirection:[1,.15,0],impactDir:[-1,.15,0],windForce:2.2,turbulence:.5},away:{name:"dissolveAway",emoji:"üå´Ô∏è",description:"Shards blow away from camera into distance",windDirection:[0,.1,-1],windForce:2,turbulence:.4},toward:{name:"dissolveToward",emoji:"üå™Ô∏è",description:"Shards blow toward camera",windDirection:[0,.1,1],windForce:2.5,turbulence:.6}};function Ct(e="away"){const t=At[e]||At.away;return{name:t.name,emoji:t.emoji,type:"override",description:t.description,config:{duration:3500,musicalDuration:{musical:!0,beats:6},intensity:.7,direction:e},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:6},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.2}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.intensity||.7,s=i.direction||"away",n=At[s]||At.away;let r=!1,o=1,l=0,h=1;const c=.06;if(e<c){const t=e/c;o=1+.4*t,l=.2*t,h=1+.03*t}else if(e<.08)r=e>=c&&e<.065,o=1.4,l=.3;else{const t=(e-c)/.94;o=1.4-.6*t,l=Math.max(0,.3-.3*t)}return{scale:h,glowIntensity:o,glowBoost:l,shatter:{enabled:r,impactPoint:[0,0,0],impactDirection:n.impactDir||n.windDirection,intensity:.5*a,variant:`dissolve_${s}`,revealSoul:!0,isSuspendMode:!1,isFreezeMode:!1,gravity:-.5,explosionForce:.3,gestureDuration:3500,isDualMode:!0,dualModeType:"dissolve",dualModeConfig:{duration:3e3,windDirection:n.windDirection,windForce:n.windForce*a,turbulence:n.turbulence}}}}}}}const It={splash:{name:"splash",emoji:"üí¶",description:"Transform to water and splash outward",duration:2e3,beats:4,intensity:1.2,elemental:"water",elementalParam:.3,impactPoint:[0,-.2,0],impactDirection:[0,1,.3],revealSoul:!0,gravity:-4,explosionForce:1.8,rotationForce:2},drip:{name:"drip",emoji:"ü´†",description:"Melt downward like wax",duration:4e3,beats:8,intensity:.4,elemental:"water",elementalParam:.7,impactPoint:[0,.3,0],impactDirection:[0,-1,0],revealSoul:!0,gravity:-1.5,explosionForce:.1,rotationForce:.3,shatterTriggerAt:0},ripple:{name:"ripple",emoji:"üåä",description:"Wobble and dissolve like disturbed water",duration:3e3,beats:6,intensity:.8,elemental:"water",elementalParam:.2,impactPoint:[0,0,0],impactDirection:[1,0,0],revealSoul:!1,gravity:-2,explosionForce:.6,rotationForce:1,useWobble:!0},smokebomb:{name:"smokebomb",emoji:"üí®",description:"Poof into dispersing smoke cloud",duration:2500,beats:4,intensity:1,elemental:"smoke",elementalParam:.5,impactPoint:[0,0,0],impactDirection:[0,1,0],revealSoul:!1,gravity:.5,explosionForce:1.5,rotationForce:3},vanish:{name:"vanish",emoji:"üëª",description:"Fade into wispy nothing",duration:3e3,beats:6,intensity:.5,elemental:"smoke",elementalParam:.1,impactPoint:[0,0,0],impactDirection:[0,1,0],revealSoul:!1,gravity:.8,explosionForce:.3,rotationForce:1,fadeOut:!0},materialize:{name:"materialize",emoji:"‚ú®",description:"Condense from smoke (reverse smokebomb)",duration:2500,beats:4,intensity:1,elemental:"smoke",elementalParam:.8,impactPoint:[0,0,0],impactDirection:[0,-1,0],revealSoul:!0,reassemble:!0,reassembleAt:.4,reassembleDuration:1500,isDualMode:!0,dualModeType:"implode",dualModeDuration:1e3,gravity:-1,explosionForce:.8},ignite:{name:"ignite",emoji:"üî•",description:"Catch fire and burn away",duration:3e3,beats:6,intensity:1.2,elemental:"fire",elementalParam:.6,overlay:"smoke",overlayParam:.3,impactPoint:[0,-.3,0],impactDirection:[0,1,0],revealSoul:!0,gravity:1,explosionForce:1,rotationForce:4},ember:{name:"ember",emoji:"ü™®",description:"Smolder and crumble (low temperature)",duration:6e3,beats:12,intensity:.3,elemental:"fire",elementalParam:.15,impactPoint:[0,0,0],impactDirection:[0,-1,0],revealSoul:!0,gravity:-.5,explosionForce:.1,rotationForce:.5,shatterTriggerAt:0},freeze:{name:"iceFreeze",emoji:"üßä",description:"Crystallize solid then freeze mid-air",duration:2500,beats:4,intensity:.8,elemental:"ice",elementalParam:0,impactPoint:[0,0,0],impactDirection:[0,1,0],revealSoul:!0,isFreezeMode:!0,isSuspendMode:!0,suspendAt:.15,suspendDuration:.15,gravity:-2,explosionForce:.8},shatterIce:{name:"shatterIce",emoji:"‚ùÑÔ∏è",description:"Freeze then shatter into ice shards",duration:2e3,beats:4,intensity:1.3,elemental:"ice",elementalParam:.1,impactPoint:[0,0,.3],impactDirection:[0,0,-1],revealSoul:!0,gravity:-9.8,explosionForce:2,rotationForce:6,preFreezePhase:!0},thaw:{name:"thaw",emoji:"üíß",description:"Ice melts to water transition",duration:4e3,beats:8,intensity:.6,elemental:"ice",elementalParam:.9,impactPoint:[0,.2,0],impactDirection:[0,-1,0],revealSoul:!0,gravity:-3,explosionForce:.3,rotationForce:1,meltTransition:!0},shock:{name:"shock",emoji:"‚ö°",description:"Brief electric surge with arcs",duration:1500,beats:2,intensity:1,elemental:"electric",elementalParam:.5,impactPoint:[0,0,0],impactDirection:[0,1,0],revealSoul:!0,reassemble:!0,reassembleAt:.5,reassembleDuration:700,gravity:-5,explosionForce:1.5,rotationForce:8,electricFlicker:!0},overload:{name:"overload",emoji:"üí•",description:"Charge builds then explodes",duration:3e3,beats:6,intensity:2,elemental:"electric",elementalParam:1,impactPoint:[0,0,0],impactDirection:[0,1,0],revealSoul:!0,gravity:-2,explosionForce:3,rotationForce:10,chargeBuildup:!0,shatterTriggerAt:.3},glitch:{name:"glitch",emoji:"üì∫",description:"Flicker and static displacement",duration:2e3,beats:4,intensity:.7,elemental:"electric",elementalParam:.2,impactPoint:[0,0,0],impactDirection:[1,0,0],revealSoul:!1,reassemble:!0,reassembleAt:.6,reassembleDuration:800,gravity:-4,explosionForce:.5,rotationForce:2,glitchEffect:!0},consume:{name:"consume",emoji:"üï≥Ô∏è",description:"Void swallows inward",duration:3e3,beats:6,intensity:1,elemental:"void",elementalParam:.7,impactPoint:[0,0,0],impactDirection:[0,0,0],revealSoul:!1,isDualMode:!0,dualModeType:"implode",dualModeDuration:2500,gravity:.3,explosionForce:.5,rotationForce:2,voidPull:!0},corrupt:{name:"corrupt",emoji:"üñ§",description:"Dark tendrils spread over surface",duration:4e3,beats:8,intensity:.6,elemental:"void",elementalParam:.4,impactPoint:[0,-.3,0],impactDirection:[0,1,0],revealSoul:!0,gravity:-1,explosionForce:.3,rotationForce:1.5,corruptSpread:!0,shatterTriggerAt:.4},singularity:{name:"singularity",emoji:"‚ö´",description:"Implode to point then vanish",duration:2500,beats:4,intensity:1.5,elemental:"void",elementalParam:1,impactPoint:[0,0,0],impactDirection:[0,0,0],revealSoul:!1,isDualMode:!0,dualModeType:"implode",dualModeDuration:2e3,gravity:2,explosionForce:.1,rotationForce:5,singularityCollapse:!0}};function zt(e){const t=It[e];return t?{name:t.name,emoji:t.emoji,type:"override",description:t.description,usesShatter:!0,config:{duration:t.duration,musicalDuration:{musical:!0,beats:t.beats},intensity:t.intensity,variant:e,elemental:t.elemental,elementalParam:t.elementalParam},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:t.beats},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.3}},"3d":{evaluate(i,a){const s=(a.config||this.config||{}).intensity||1;let n=!1,r=!1,o=1,l=0,h=1;const c=void 0!==t.shatterTriggerAt?t.shatterTriggerAt:.1,u=t.reassemble,d=t.reassembleAt||.5;if(t.useWobble&&i<c){const e=i/c;h=1+.03*Math.sin(e*Math.PI*6)*e}if(t.chargeBuildup&&i<c){const e=i/c;o=1+1.5*e+.2*Math.sin(100*i)*e,l=.8*e}if(t.glowPulse&&(o+=.2*Math.sin(i*Math.PI*4)),t.corruptSpread&&i<c){const e=i/c;o=1-.3*e,l=.2*-e}if(t.preFreezePhase&&i<c){const e=i/c;o=1+.3*e,l=.4*e}if(i<c){if(c>0){const e=i/c,a=e*e;t.chargeBuildup||t.corruptSpread||(o=1+.6*a,l=.3*a),t.useWobble||(h=1+.03*a)}}else if(i<c+.02)n=i>=c&&i<c+.005,"void"===t.elemental?(o=.5,l=-.3):"electric"===t.elemental?(o=2.5,l=1):(o=1.8,l=.5),h=1.03;else{if(u&&i>=d&&i<d+.02&&(r=!0),u&&i>=d){const e=(i-d)/(1-d),t=e*e;o=1+.8*t,l=.5*t,i>.95&&(o=2,l=.8)}else{const e=(i-c-.02)/(u?d-c-.02:1-c-.02),t=Math.min(1,Math.max(0,e)),a=1-(1-t)*(1-t);o=1.8-.8*a,l=.5-.5*a}h=1}return{scale:h,glowIntensity:o,glowBoost:l,shatter:{enabled:n,impactPoint:t.impactPoint,impactDirection:t.impactDirection,intensity:s*t.intensity,variant:e,elemental:t.elemental,elementalParam:t.elementalParam,overlay:t.overlay,overlayParam:t.overlayParam,reassemble:r,reassembleDuration:t.reassembleDuration||1e3,revealSoul:!1!==t.revealSoul,isSuspendMode:t.isSuspendMode||!1,suspendAt:t.suspendAt||.15,suspendDuration:t.suspendDuration||.2,isFreezeMode:t.isFreezeMode||!1,gravity:t.gravity,explosionForce:t.explosionForce,rotationForce:t.rotationForce,gestureDuration:t.duration,isDualMode:t.isDualMode||!1,dualModeType:t.dualModeType,dualModeConfig:{duration:t.dualModeDuration||2e3,impactPoint:t.impactPoint,reassemble:t.reassemble,reassembleDuration:t.reassembleDuration}}}}}}:null}var Ft=Zt({name:"shock",emoji:"‚ö°",type:"blending",description:"Brief electric surge - mascot is shocked",duration:1200,beats:2,intensity:1,category:"electrocute",spawnMode:{type:"surface",pattern:"scattered",embedDepth:.1,cameraFacing:.4,clustering:.35,count:6,scale:1,models:["arc-small","spark-node","arc-medium"],minDistance:.12,ephemeral:{lifetime:{min:100,max:300},flashIn:30,fadeOut:80,respawn:!0},animation:{appearAt:.02,disappearAt:.95,stagger:.01,enter:{type:"flash",duration:.01,easing:"linear"},exit:{type:"flash",duration:.02,easing:"linear"},flicker:{intensity:.5,rate:30,pattern:"random"},emissive:{min:1,max:3,frequency:25,pattern:"random",dutyCycle:.6},rotate:{axis:[1,1,0],speed:.5,oscillate:!0,range:Math.PI/3},cutout:{strength:.55,primary:{pattern:1,scale:1.2,weight:.7},secondary:{pattern:7,scale:.8,weight:.3},blend:"multiply",travel:"oscillate",travelSpeed:2.5,strengthCurve:"bell"},grain:{type:3,strength:.25,scale:.3,speed:3,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"above",intensity:.7,sizeScale:1.5,progressCurve:"pulse"}],flash:{events:[{at:.15,intensity:2},{at:.5,intensity:3}],decay:.02},scaleVariance:.4,lifetimeVariance:.5,delayVariance:.2,blending:"additive",renderOrder:15,intensityScaling:{scale:1.3,flickerIntensity:1.5,emissiveMax:1.8}}},jitterFrequency:60,jitterAmplitude:.015,jitterDecay:.3,glowColor:[.3,.9,1],glowIntensityMin:.8,glowIntensityMax:2.5,glowFlickerRate:25,scaleVibration:.03,scaleFrequency:40}),Dt=Zt({name:"overload",emoji:"üí•",type:"blending",description:"Intense charge buildup, extreme shock",duration:2500,beats:4,intensity:2,category:"electrocute",spawnMode:{type:"surface",pattern:"shell",embedDepth:.1,cameraFacing:.35,clustering:.2,count:12,scale:1.1,models:["arc-small","arc-medium","arc-cluster","spark-node"],minDistance:.1,ephemeral:{lifetime:{min:80,max:150},flashIn:15,fadeOut:40,respawn:!0,stagger:30,progression:{duration:2500,lifetime:[80,150,300,600],flashIn:[15,40],fadeOut:[40,150],respawnDelay:[0,30,0,0]}},animation:{appearAt:.02,disappearAt:.92,stagger:.015,enter:{type:"flash",duration:.01,easing:"linear"},exit:{type:"flash",duration:.03,easing:"linear"},flicker:{intensity:.6,rate:35,pattern:"random"},emissive:{min:1.2,max:4,frequency:30,pattern:"random",dutyCycle:.7},cutout:{strength:.6,primary:{pattern:8,scale:1,weight:.7},secondary:{pattern:5,scale:.6,weight:.3},blend:"multiply",travel:"radial",travelSpeed:1.8,strengthCurve:"fadeIn"},grain:{type:3,strength:.3,scale:.25,speed:2.5,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.6,sizeScale:1.2,progressCurve:"pulse"}],flash:{events:[{at:.3,intensity:1.5},{at:.55,intensity:2.5},{at:.75,intensity:3.5}],decay:.02},scaleVariance:.35,lifetimeVariance:.4,blending:"additive",renderOrder:15,intensityScaling:{scale:1.4,flickerIntensity:1.6,emissiveMax:2}}},jitterFrequency:80,jitterAmplitude:.03,jitterDecay:.1,glowColor:[.5,.95,1],glowIntensityMin:1,glowIntensityMax:4,glowFlickerRate:35,scaleVibration:.05,scaleFrequency:50,buildupPhase:.3,buildupGlowRamp:!0}),qt=Zt({name:"glitch",emoji:"üì∫",type:"blending",description:"Digital corruption, static displacement",duration:1800,beats:3,intensity:.7,category:"electrocute",spawnMode:{type:"surface",pattern:"scattered",embedDepth:.15,cameraFacing:.5,clustering:.4,count:2,scale:.7,models:["spark-node"],minDistance:.25,ephemeral:{lifetime:{min:25,max:80},flashIn:8,fadeOut:15,respawn:!0,respawnDelay:{min:80,max:400}},animation:{appearAt:.05,disappearAt:.9,stagger:.02,enter:{type:"flash",duration:.005,easing:"linear"},exit:{type:"flash",duration:.01,easing:"linear"},flicker:{intensity:.4,rate:20,pattern:"random"},emissive:{min:.8,max:2.5,frequency:15,pattern:"random",dutyCycle:.4},cutout:{strength:.5,primary:{pattern:3,scale:1,weight:.65},secondary:{pattern:1,scale:.7,weight:.35},blend:"multiply",travel:"oscillate",travelSpeed:1.5,strengthCurve:"bell"},grain:{type:3,strength:.2,scale:.35,speed:2,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.1,sizeScale:.8,progressCurve:"sustain"}],scaleVariance:.5,lifetimeVariance:.6,delayVariance:.4,blending:"additive",renderOrder:15,intensityScaling:{scale:1.1,flickerIntensity:1.3,emissiveMax:1.5}}},jitterFrequency:20,jitterAmplitude:.04,jitterDecay:.5,glowColor:[.4,.8,1],glowIntensityMin:.5,glowIntensityMax:2,glowFlickerRate:15,scaleVibration:.04,scaleFrequency:12,holdFrames:!0,holdProbability:.15,holdDuration:.05}),Rt=Zt({name:"crackle",emoji:"‚ú®",type:"blending",description:"Rapid stuttering bolts crackling across surface",duration:2e3,beats:3,intensity:.8,category:"powered",spawnMode:{type:"surface",pattern:"spikes",embedDepth:.08,cameraFacing:.5,clustering:.3,count:3,scale:1.2,models:["spark-spike","arc-small","spark-spike"],minDistance:.2,animation:{appearAt:.1,disappearAt:.85,stagger:.08,enter:{type:"pop",duration:.015,easing:"elasticOut",overshoot:1.3},exit:{type:"fade",duration:.15,easing:"easeOutCubic"},flicker:{intensity:.5,rate:20,pattern:"random"},emissive:{min:.8,max:2.5,frequency:8,pattern:"sine"},cutout:{strength:.5,primary:{pattern:8,scale:1.2,weight:.7},secondary:{pattern:2,scale:.8,weight:.3},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"fadeOut"},grain:{type:3,strength:.15,scale:.4,speed:2,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.1,sizeScale:.6,progressCurve:"sustain"}],flash:{events:[{at:.2,intensity:2},{at:.35,intensity:1.5},{at:.5,intensity:2.5},{at:.65,intensity:1},{at:.75,intensity:1.8}],decay:.015},scaleVariance:.3,lifetimeVariance:.15,blending:"additive",renderOrder:12}},jitterFrequency:0,jitterAmplitude:0,jitterDecay:.2,glowColor:[.4,.9,1],glowIntensityMin:1,glowIntensityMax:1.8,glowFlickerRate:10,scaleVibration:.02,scaleFrequency:2,scalePulse:!0,rotationDrift:.01}),Bt=Zt({name:"chargeUp",emoji:"üîã",type:"blending",description:"Building up electrical power, growing intensity",duration:2500,beats:4,intensity:1.2,category:"powered",spawnMode:{type:"surface",pattern:"crown",embedDepth:.1,cameraFacing:.4,clustering:.3,count:6,scale:1,models:["spark-node","arc-small","arc-medium"],minDistance:.12,ephemeral:{lifetime:{min:50,max:100},flashIn:12,fadeOut:30,respawn:!0,stagger:50,progression:{duration:2500,lifetime:[50,100,400,700],flashIn:[12,60],fadeOut:[30,200],respawnDelay:[0,20,100,250]}},animation:{appearAt:.05,disappearAt:.92,stagger:.03,enter:{type:"grow",duration:.04,easing:"easeOutQuad"},exit:{type:"flash",duration:.02,easing:"linear"},pulse:{amplitude:.18,frequency:3,easing:"easeInOut",sync:"global"},emissive:{min:.6,max:2.8,frequency:4,pattern:"sine"},drift:{direction:"up",speed:.025,noise:.15},rotate:{axis:"y",speed:.08,oscillate:!1},cutout:{strength:.45,primary:{pattern:2,scale:1.3,weight:.65},secondary:{pattern:6,scale:.7,weight:.35},blend:"multiply",travel:"radial",travelSpeed:1.2,strengthCurve:"fadeIn"},grain:{type:3,strength:.1,scale:.35,speed:2,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"above",intensity:.1,sizeScale:.6,progressCurve:"rampUp"}],scaleVariance:.25,lifetimeVariance:.2,blending:"additive",renderOrder:12,intensityScaling:{scale:1.35,emissiveMax:1.6,driftSpeed:1.3}}},jitterFrequency:30,jitterAmplitude:.005,jitterDecay:.2,glowColor:[.3,.95,1],glowIntensityMin:.8,glowIntensityMax:3,glowFlickerRate:12,scaleVibration:.01,scaleFrequency:3,scalePulse:!0,scaleGrowth:.08,rampUp:!0,riseAmount:.02}),Et=Zt({name:"electricAuraEffect",emoji:"üí´",type:"blending",description:"Electric rings rising slowly from center",duration:3e3,beats:4,intensity:1,category:"powered",spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"center",easing:"easeOut",startScale:.9,endScale:1.3,startDiameter:1.6,endDiameter:2.2,orientation:"camera"},formation:{type:"spiral",count:3,strands:1,spacing:.15,arcOffset:120,phaseOffset:.05},count:3,scale:2,models:["plasma-ring","arc-ring-small","plasma-ring"],animation:{appearAt:.05,disappearAt:.85,stagger:.06,enter:{type:"fade",duration:.12,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},flicker:{intensity:.15,rate:8,pattern:"sine"},emissive:{min:.9,max:1.8,frequency:2.5,pattern:"sine"},cutout:{strength:.4,primary:{pattern:0,scale:1,weight:.6},secondary:{pattern:1,scale:.8,weight:.4},blend:"multiply",travel:"angular",travelSpeed:.6,strengthCurve:"constant"},grain:{type:3,strength:.08,scale:.4,speed:1,blend:"multiply"},rotate:{axis:"y",rotations:.5,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"additive",renderOrder:10,modelOverrides:{"plasma-ring":{scaleMultiplier:1.1,shaderAnimation:{type:1,arcWidth:.7,arcSpeed:.5,arcCount:1},orientationOverride:"camera"},"arc-ring-small":{scaleMultiplier:.9,shaderAnimation:{type:1,arcWidth:.6,arcSpeed:.8,arcCount:2},orientationOverride:"camera"}}}},jitterFrequency:0,jitterAmplitude:0,jitterDecay:.3,glowColor:[.5,.85,1],glowIntensityMin:1.2,glowIntensityMax:2,glowFlickerRate:4,scaleVibration:.015,scaleFrequency:1.5,scalePulse:!0,rotationDrift:.02,hover:!0,hoverAmount:.01}),Pt=Zt({name:"staticDischarge",emoji:"‚ö°",type:"blending",description:"Low-level static electricity, ambient sparks",duration:1500,beats:2,intensity:.4,category:"powered",spawnMode:{type:"surface",pattern:"scattered",embedDepth:.15,cameraFacing:.35,clustering:.3,count:2,scale:.6,models:["spark-node"],minDistance:.3,ephemeral:{lifetime:{min:40,max:100},flashIn:10,fadeOut:30,respawn:!0,stagger:200,respawnDelay:{min:250,max:600}},animation:{appearAt:.05,disappearAt:.92,stagger:.03,enter:{type:"flash",duration:.008,easing:"linear"},exit:{type:"fade",duration:.05,easing:"easeOut"},emissive:{min:.6,max:1.5,frequency:20,pattern:"random",dutyCycle:.3},cutout:{strength:.35,primary:{pattern:3,scale:.8,weight:.6},secondary:{pattern:0,scale:.6,weight:.4},blend:"multiply",travel:"oscillate",travelSpeed:.8,strengthCurve:"bell"},grain:{type:3,strength:.1,scale:.45,speed:1.5,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.08,sizeScale:.8,progressCurve:"sustain"}],scaleVariance:.3,lifetimeVariance:.4,blending:"additive",renderOrder:10,intensityScaling:{scale:1,emissiveMax:1.2}}},jitterFrequency:5,jitterAmplitude:.002,jitterDecay:.4,glowColor:[.5,.8,1],glowIntensityMin:.9,glowIntensityMax:1.3,glowFlickerRate:20,scaleVibration:.005,scaleFrequency:8,scalePulse:!1,sparkBursts:!0,sparkProbability:.1}),Tt=Zt({name:"electriccrown",emoji:"üëë",type:"blending",description:"Crackling lightning crown above the head",duration:3e3,beats:4,intensity:1,category:"powered",spawnMode:{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.05,z:0},orientation:"flat",bob:{amplitude:.02,frequency:.3}},count:1,scale:1.2,models:["lightning-ring"],animation:{appearAt:0,disappearAt:.75,stagger:0,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.02,frequency:2,easing:"easeInOut"},rotate:{axis:"z",rotations:1,phase:0},atmospherics:[{preset:"ozone",targets:["lightning-ring"],anchor:"above",intensity:.04,sizeScale:.6,progressCurve:"sustain"}],scaleVariance:0,lifetimeVariance:0,blending:"additive",renderOrder:15}},jitterFrequency:0,jitterAmplitude:0,jitterDecay:.2,glowColor:[.3,.9,1],glowIntensityMin:.8,glowIntensityMax:.8,glowFlickerRate:0,scaleVibration:.003,scaleFrequency:3,scaleGrowth:0,scalePulse:!0,rotationDrift:.01}),jt=Zt({name:"electricdance",emoji:"üíÉ",type:"blending",description:"Vertical lightning rings dancing and rising",duration:1500,beats:3,intensity:1.3,category:"powered",spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.4,endScale:1.8,startDiameter:1.3,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:2,spacing:0,arcOffset:180,phaseOffset:0},count:2,scale:2,models:["lightning-ring"],animation:{appearAt:.02,disappearAt:.5,stagger:.02,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},flicker:{intensity:.35,rate:14,pattern:"random"},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},cutout:{strength:.75,primary:{pattern:6,scale:2,weight:1},secondary:{pattern:7,scale:1.5,weight:.6},blend:"add",travel:"spiral",travelSpeed:2.5,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.12,tip:.28}},grain:{type:3,strength:.06,scale:.15,speed:1,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.4,centrifugal:{speed:.5,tangentialBias:.5}}],rotate:[{axis:"y",rotations:2,phase:0},{axis:"y",rotations:-2,phase:90}],scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:11,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}}}},jitterFrequency:0,jitterAmplitude:0,jitterDecay:.2,glowColor:[.3,.9,1],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:6,scaleVibration:.015,scaleFrequency:4,scaleGrowth:.01,scalePulse:!0,rotationDrift:.01}),Vt=Zt({name:"electrichelix",emoji:"üß¨",type:"blending",description:"Double helix of lightning rings ascending",duration:2e3,beats:3,intensity:1.2,category:"powered",spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeInOut",startScale:.9,endScale:1.1,startDiameter:1.8,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:2,strands:2,spacing:.2,arcOffset:180,phaseOffset:.05},count:2,scale:2,models:["lightning-ring"],animation:{appearAt:0,disappearAt:.7,stagger:.06,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},flicker:{intensity:.25,rate:12,pattern:"random"},pulse:{amplitude:.06,frequency:4,easing:"easeInOut"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},cutout:{strength:.8,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:6,scale:1.8,weight:.6},blend:"max",travel:"angular",travelSpeed:3,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.1,tip:.25}},grain:{type:3,strength:.08,scale:.2,speed:1.5,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:.8,tangentialBias:.4}}],rotate:{axis:"y",rotations:2,phase:0},scaleVariance:.1,lifetimeVariance:.1,blending:"additive",renderOrder:16,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}}}},jitterFrequency:0,jitterAmplitude:0,jitterDecay:.2,glowColor:[.35,.9,1],glowIntensityMin:1,glowIntensityMax:1.8,glowFlickerRate:5,scaleVibration:.01,scaleFrequency:3,scalePulse:!0,rotationDrift:.015});const $t={enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.08,frequency:4,easing:"easeInOut"},emissive:{min:1,max:2,frequency:5,pattern:"sine"},grain:{type:3,strength:.25,scale:.3,speed:2,blend:"multiply"},rotate:{axis:"z",rotations:1,phase:0},scaleVariance:.1,lifetimeVariance:.08,blending:"additive",renderOrder:12,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.65,arcSpeed:3,arcCount:1},orientationOverride:"flat"},"plasma-ring":{shaderAnimation:{type:1,arcWidth:.55,arcSpeed:4,arcCount:2},orientationOverride:"flat"}}};var Wt=Zt({name:"electricpillar",emoji:"üóº",type:"blending",description:"Rising pillar of stacked lightning rings",duration:3e3,beats:4,intensity:1.3,category:"powered",spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"center",easing:"easeOut",startScale:1,endScale:1.3,startDiameter:1.5,endDiameter:1.8,orientation:"flat"},formation:{type:"stack",count:2,spacing:.3},count:2,scale:1.5,models:["lightning-ring"],animation:{...$t,appearAt:0,disappearAt:.85,stagger:.04,atmospherics:[{preset:"ozone",targets:["lightning-ring"],anchor:"above",intensity:.1,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.5}],cutout:{strength:.5,primary:{pattern:1,scale:1,weight:.65},secondary:{pattern:2,scale:.8,weight:.35},blend:"add",travel:"angular",travelSpeed:1.5,strengthCurve:"bell"}}},{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"above",easing:"easeOut",startScale:.9,endScale:1.2,startDiameter:1.3,endDiameter:1.6,orientation:"flat"},formation:{type:"stack",count:2,spacing:.3},count:2,scale:1.4,models:["plasma-ring"],animation:{...$t,appearAt:.08,disappearAt:.88,stagger:.04,cutout:{strength:.55,primary:{pattern:8,scale:1.2,weight:.7},secondary:{pattern:1,scale:.7,weight:.3},blend:"multiply",travel:"radial",travelSpeed:1.8,strengthCurve:"bell"}}},{type:"axis-travel",axisTravel:{axis:"y",start:"above",end:"far-above",easing:"easeOut",startScale:.8,endScale:1.1,startDiameter:1.1,endDiameter:1.4,orientation:"flat"},formation:{type:"stack",count:2,spacing:.3},count:2,scale:1.3,models:["lightning-ring"],animation:{...$t,appearAt:.15,disappearAt:.9,stagger:.04,cutout:{strength:.45,primary:{pattern:3,scale:1,weight:.6},secondary:{pattern:7,scale:.8,weight:.4},blend:"add",travel:"oscillate",travelSpeed:1.2,strengthCurve:"fadeOut"}}}],jitterFrequency:0,jitterAmplitude:0,jitterDecay:.2,glowColor:[.35,.9,1],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:5,scaleVibration:.01,scaleFrequency:3,scalePulse:!0,rotationDrift:.015}),Gt=Zt({name:"electricdrill",emoji:"üî©",type:"blending",description:"Fast tight descending lightning helix",duration:1200,beats:2,intensity:1.5,category:"electrocute",spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"feet",end:"below",easing:"easeIn",startScale:1,endScale:.8,startDiameter:1.8,endDiameter:1.4,orientation:"vertical"},formation:{type:"spiral",count:2,spacing:.1,arcOffset:180,phaseOffset:0},count:2,scale:2,models:["lightning-ring"],animation:{appearAt:0,disappearAt:.6,stagger:.03,enter:{type:"fade",duration:.05,easing:"linear"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},flicker:{intensity:.4,rate:25,pattern:"random"},pulse:{amplitude:.08,frequency:10,easing:"linear"},emissive:{min:1.5,max:3.5,frequency:12,pattern:"random"},cutout:{strength:.55,primary:{pattern:3,scale:1.5,weight:1},secondary:{pattern:8,scale:.8,weight:.35},blend:"add",travel:"vertical",travelSpeed:3,strengthCurve:"constant"},grain:{type:3,strength:.3,scale:.2,speed:4,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"below",intensity:.3,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:1,tangentialBias:.3}}],rotate:{axis:"y",rotations:4,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"additive",renderOrder:16,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:3,arcCount:1},orientationOverride:"vertical"}}}},jitterFrequency:45,jitterAmplitude:.01,jitterDecay:.25,glowColor:[.3,.9,1],glowIntensityMin:1.3,glowIntensityMax:2.8,glowFlickerRate:15,scaleVibration:.02,scaleFrequency:8,scaleGrowth:.03}),Lt=Zt({name:"electricflourish",emoji:"‚öîÔ∏è",type:"blending",description:"Spinning lightning flourish with electric trails",duration:1200,beats:4,intensity:1.3,category:"powered",spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.7,endScale:1.2,startDiameter:1.8,endDiameter:2.8,orientation:"camera"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:.05,zOffset:0},count:3,scale:2,models:["lightning-ring"],animation:{appearAt:0,disappearAt:.45,stagger:.12,enter:{type:"fade",duration:.03,easing:"easeOut"},exit:{type:"burst-fade",duration:.85,easing:"easeIn",burstScale:1.15},procedural:{scaleSmoothing:.05,geometryStability:!0},flicker:{intensity:.3,rate:14,pattern:"random"},pulse:{amplitude:.15,frequency:5,easing:"easeInOut",perElement:!0},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},cutout:{strength:.6,primary:{pattern:1,scale:1,weight:1},secondary:{pattern:8,scale:.6,weight:.5},blend:"multiply",strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.15,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.4}],drift:{speed:.3,distance:.18,pattern:"radial",accelerate:!0},opacityGradient:[1,.85,.7],rotate:[{axis:"z",rotations:2.5,phase:0},{axis:"z",rotations:-2,phase:120},{axis:"z",rotations:1.8,phase:240}],tilt:{axis:"y",oscillate:!0,range:.4,speed:3.5},wobble:{axis:"x",oscillate:!0,range:.15,speed:2,phase:90},scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:12,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1,arcCount:2},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:-.7,y:.4,z:.05},orientation:"camera",startScale:.4,endScale:1.2,scaleEasing:"easeOutCubic"},count:1,scale:1.8,models:["plasma-ring"],animation:{appearAt:.12,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},cutout:{strength:.5,primary:{pattern:1,scale:1,weight:1},secondary:{pattern:8,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},drift:{speed:.9,distance:.35,direction:{x:1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:1,phase:-45}],blending:"additive",renderOrder:14,modelOverrides:{"plasma-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:4,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:.7,y:.4,z:.05},orientation:"camera",startScale:.4,endScale:1.2,scaleEasing:"easeOutCubic"},count:1,scale:1.8,models:["plasma-ring"],animation:{appearAt:.12,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},cutout:{strength:.5,primary:{pattern:1,scale:1,weight:1},secondary:{pattern:8,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},drift:{speed:.9,distance:.35,direction:{x:-1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:1,phase:45}],blending:"additive",renderOrder:14,modelOverrides:{"plasma-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:4,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:2,models:["lightning-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},flicker:{intensity:.25,rate:12,pattern:"random"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},cutout:{strength:.5,primary:{pattern:8,scale:.8,weight:1},secondary:{pattern:1,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},rotate:[{axis:"z",rotations:.001,phase:45}],blending:"additive",renderOrder:10,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:2,models:["lightning-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},flicker:{intensity:.25,rate:12,pattern:"random"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},cutout:{strength:.5,primary:{pattern:8,scale:.8,weight:1},secondary:{pattern:1,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},rotate:[{axis:"z",rotations:.001,phase:-45}],blending:"additive",renderOrder:10,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}}],jitterFrequency:0,jitterAmplitude:0,jitterDecay:.2,glowColor:[.35,.9,1],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:6,scaleVibration:.015,scaleFrequency:4,scalePulse:!0}),_t=Zt({name:"electricvortex",emoji:"üåÄ",type:"blending",description:"Lightning tornado spiraling around mascot",duration:1500,beats:5,intensity:1.4,category:"powered",spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.2,endScale:1.5,startDiameter:.6,endDiameter:1.6,orientation:"flat"},formation:{type:"spiral",count:2,spacing:0,arcOffset:180,phaseOffset:0},count:2,scale:2,models:["lightning-ring"],animation:{appearAt:.05,disappearAt:.7,stagger:.02,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},flicker:{intensity:.35,rate:14,pattern:"random"},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1,max:2,frequency:5,pattern:"sine"},cutout:{strength:.5,primary:{pattern:1,scale:1.2,weight:.6},secondary:{pattern:3,scale:.8,weight:.4},blend:"add",travel:"angular",travelSpeed:2.5,strengthCurve:"bell",trailDissolve:{enabled:!0,offset:-.4,softness:1.2}},grain:{type:3,strength:.2,scale:.3,speed:2.5,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.2,sizeScale:1.2,progressCurve:"sustain",velocityInheritance:.6,centrifugal:{speed:1.2,tangentialBias:.3}}],flash:{events:[{at:.2,intensity:2},{at:.45,intensity:3},{at:.6,intensity:1.5}],decay:.02},scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:12,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:5,arcCount:1},scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.1},y:{expand:!1,rate:.3},z:{expand:!0,rate:1.1}}},orientationOverride:"flat"}}}},jitterFrequency:0,jitterAmplitude:0,jitterDecay:.2,glowColor:[.4,.85,1],glowIntensityMin:1.2,glowIntensityMax:2.2,glowFlickerRate:6,scaleVibration:.02,scaleFrequency:4,scaleGrowth:.03,scalePulse:!0,rotationDrift:.02}),Ht=Zt({name:"electricbarrage",emoji:"üèπ",type:"blending",description:"Electric arcs orbit mascot then launch outward",duration:1500,beats:4,intensity:1.4,category:"powered",spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"above",radius:1.2,endRadius:2.8,speed:3,easing:"easeIn",startScale:1,endScale:.6,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.8,models:["arc-cluster","arc-medium","spark-node"],animation:{appearAt:0,disappearAt:.65,stagger:.04,enter:{type:"scale",duration:.08,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.3},procedural:{scaleSmoothing:.08,geometryStability:!0},flicker:{intensity:.4,rate:16,pattern:"random"},grain:{type:3,strength:.12,scale:.3,speed:2,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.25,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.7}],flash:{events:[{at:.1,intensity:1.5},{at:.3,intensity:2.5},{at:.5,intensity:3}],decay:.02},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1.2,max:3,frequency:8,pattern:"sine"},rotate:[{axis:"x",rotations:2,phase:0},{axis:"y",rotations:-3,phase:40},{axis:"z",rotations:2.5,phase:100},{axis:"x",rotations:-2,phase:180},{axis:"y",rotations:3,phase:250}],scaleVariance:.2,lifetimeVariance:.1,blending:"additive",renderOrder:12}},jitterFrequency:10,jitterAmplitude:.005,jitterDecay:.2,glowColor:[.4,.9,1],glowIntensityMin:1.5,glowIntensityMax:3,glowFlickerRate:12,scaleVibration:.015,scaleFrequency:4,scaleGrowth:.02,scalePulse:!0}),Ut=Zt({name:"electricimpact",emoji:"üí•",type:"blending",description:"Electric arcs orbit then crash inward",duration:1500,beats:4,intensity:1.5,category:"electrocute",spawnMode:{type:"orbit",orbit:{height:"above",endHeight:"center",radius:3.5,endRadius:.1,speed:3,easing:"easeOut",startScale:.4,endScale:1.8,orientation:"vertical"},formation:{type:"ring",count:7},count:7,scale:1.4,models:["arc-cluster","arc-medium","arc-small","spark-spike"],animation:{appearAt:0,disappearAt:.6,stagger:.02,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"burst-fade",duration:.05,easing:"easeOut",burstScale:.2},procedural:{scaleSmoothing:.04,geometryStability:!0},grain:{type:3,strength:.15,scale:.3,speed:2.5,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"around",intensity:.5,sizeScale:1,progressCurve:"burst",velocityInheritance:.7}],pulse:{amplitude:.12,frequency:8,easing:"easeInOut"},emissive:{min:1,max:3,frequency:9,pattern:"sine"},rotate:[{axis:"z",rotations:-4,phase:0},{axis:"x",rotations:3.5,phase:50},{axis:"y",rotations:-3,phase:100},{axis:"z",rotations:4,phase:155},{axis:"x",rotations:-3.5,phase:210},{axis:"y",rotations:3,phase:260},{axis:"z",rotations:-4.5,phase:315}],scaleVariance:.2,lifetimeVariance:.08,blending:"additive",renderOrder:12}},jitterFrequency:70,jitterAmplitude:.02,jitterDecay:.15,glowColor:[.45,.9,1],glowIntensityMin:1.6,glowIntensityMax:2.8,glowFlickerRate:20,scaleVibration:.03,scaleFrequency:15}),Qt=Zt({name:"electricblast",emoji:"üí•",type:"blending",description:"Explosive electrical discharge burst",duration:1e3,beats:2,intensity:1.5,category:"electrocute",spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.1},orientation:"camera",startScale:.2,endScale:2.2,scaleEasing:"easeOutQuad"},count:1,scale:2,models:["plasma-ring"],animation:{appearAt:0,disappearAt:.45,enter:{type:"scale",duration:.04,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},flicker:{intensity:.3,rate:14,pattern:"random"},cutout:{strength:.5,primary:{pattern:2,scale:1.5,weight:1},blend:"multiply",travel:"radial",travelSpeed:1.5,strengthCurve:"fadeOut"},grain:{type:3,strength:.3,scale:.25,speed:3,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"above",intensity:.8,sizeScale:2,progressCurve:"pulse"}],flash:{events:[{at:0,intensity:4},{at:.15,intensity:1.5}],decay:.03},blending:"additive",renderOrder:8,modelOverrides:{"plasma-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.3,endScale:1.5,scaleEasing:"easeOutQuad"},count:1,scale:1,models:["spark-spike"],animation:{appearAt:0,disappearAt:.5,enter:{type:"scale",duration:.03,easing:"easeOutBack"},exit:{type:"fade",duration:.15,easing:"easeIn"},flicker:{intensity:.35,rate:16,pattern:"random"},cutout:{strength:.5,primary:{pattern:1,scale:1,weight:1},blend:"multiply",travel:"vertical",travelSpeed:1.2,strengthCurve:"fadeOut"},drift:{speed:1.4,distance:.8,direction:{x:0,y:1,z:0},easing:"easeOutQuad"},blending:"additive",renderOrder:12,modelOverrides:{"spark-spike":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.25,endScale:1.3,scaleEasing:"easeOutQuad"},count:1,scale:.9,models:["spark-spike"],animation:{appearAt:.02,disappearAt:.5,enter:{type:"scale",duration:.03,easing:"easeOutBack"},exit:{type:"fade",duration:.15,easing:"easeIn"},flicker:{intensity:.35,rate:16,pattern:"random"},cutout:{strength:.5,primary:{pattern:8,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.3,distance:.75,direction:{x:-.8,y:.7,z:0},easing:"easeOutQuad"},blending:"additive",renderOrder:12,modelOverrides:{"spark-spike":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.25,endScale:1.3,scaleEasing:"easeOutQuad"},count:1,scale:.9,models:["spark-spike"],animation:{appearAt:.02,disappearAt:.5,enter:{type:"scale",duration:.03,easing:"easeOutBack"},exit:{type:"fade",duration:.15,easing:"easeIn"},flicker:{intensity:.35,rate:16,pattern:"random"},cutout:{strength:.5,primary:{pattern:8,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.3,distance:.75,direction:{x:.8,y:.7,z:0},easing:"easeOutQuad"},blending:"additive",renderOrder:12,modelOverrides:{"spark-spike":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:3,radius:.05,endRadius:.6,angleSpread:360,startAngle:30,orientation:"camera",startScale:.2,endScale:.9,scaleEasing:"easeOutQuad"},count:3,scale:.6,models:["arc-ring-small"],animation:{appearAt:.02,disappearAt:.4,stagger:.01,enter:{type:"scale",duration:.03,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},flicker:{intensity:.4,rate:18,pattern:"random"},cutout:{strength:.4,primary:{pattern:3,scale:.7,weight:1},blend:"multiply",travel:"radial",travelSpeed:1,strengthCurve:"fadeOut"},scaleVariance:.3,lifetimeVariance:.15,blending:"additive",renderOrder:14,modelOverrides:{"arc-ring-small":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}}],jitterFrequency:60,jitterAmplitude:.02,jitterDecay:.25,glowColor:[.4,.9,1],glowIntensityMin:1.2,glowIntensityMax:2.5,glowFlickerRate:15,scaleVibration:.04,scaleFrequency:10,scaleGrowth:.02}),Yt=Zt({name:"electricsurge",emoji:"üì°",type:"blending",description:"Expanding electromagnetic shockwave",duration:2e3,beats:3,intensity:.9,category:"powered",spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.4,endScale:2.5,startDiameter:.5,endDiameter:3,orientation:"camera"},formation:{type:"stack",count:1,spacing:0},count:1,scale:1.3,models:["plasma-ring"],animation:{appearAt:0,disappearAt:.85,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},cutout:{strength:.5,primary:{pattern:2,scale:1.5,weight:.6},secondary:{pattern:8,scale:1,weight:.4},blend:"multiply",travel:"radial",travelSpeed:1,strengthCurve:"fadeOut",trailDissolve:{enabled:!0,offset:-.3,softness:1.5}},grain:{type:3,strength:.15,scale:.35,speed:2,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"above",intensity:.2,sizeScale:1.2,progressCurve:"rampUp"}],pulse:{amplitude:.08,frequency:3,easing:"easeInOut"},emissive:{min:.8,max:2,frequency:4,pattern:"sine"},blending:"additive",renderOrder:8,modelOverrides:{"plasma-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.3,arcCount:1},orientationOverride:"camera"}}}},jitterFrequency:0,jitterAmplitude:0,jitterDecay:.3,glowColor:[.4,.85,1],glowIntensityMin:.8,glowIntensityMax:1.5,glowFlickerRate:4,scaleVibration:.01,scaleFrequency:2,scalePulse:!0,rotationDrift:.01}),Xt=Zt({name:"zap",emoji:"‚ö°",type:"blending",description:"Explosive multi-layer lightning burst",duration:2e3,beats:4,intensity:1.7,category:"powered",spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeIn",startScale:.5,endScale:1.6,startDiameter:.8,endDiameter:1,orientation:"camera"},formation:{type:"spiral",count:1,strands:1,spacing:0,arcOffset:0,phaseOffset:0},count:1,scale:1.5,models:["arc-medium"],animation:{appearAt:0,disappearAt:.75,enter:{type:"scale",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.06,geometryStability:!0},flicker:{intensity:.35,rate:14,pattern:"random"},emissive:{min:1.2,max:3,frequency:8,pattern:"sine"},cutout:{strength:.35,primary:{pattern:7,scale:1,weight:1},blend:"multiply",travel:"vertical",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.12,scale:.25,speed:2,blend:"multiply"},atmospherics:[{preset:"ozone",targets:null,anchor:"above",intensity:.5,sizeScale:1.2,progressCurve:"pulse"}],flash:{events:[{at:.1,intensity:2.5},{at:.3,intensity:4},{at:.5,intensity:5},{at:.68,intensity:3}],decay:.02},rotate:{axis:"y",rotations:1.5,phase:0},blending:"additive",renderOrder:10,modelOverrides:{"arc-medium":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:-.1,y:.1,z:.05},orientation:"camera",startScale:.3,endScale:1.6,scaleEasing:"easeOutQuad"},count:1,scale:1.8,models:["spark-spike"],animation:{appearAt:.05,disappearAt:.65,enter:{type:"scale",duration:.05,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.2},flicker:{intensity:.3,rate:14,pattern:"random"},drift:{speed:1.2,distance:1,direction:{x:-1,y:.5,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:-.25,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"spark-spike":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:.1,y:.1,z:.05},orientation:"camera",startScale:.3,endScale:1.6,scaleEasing:"easeOutQuad"},count:1,scale:1.8,models:["spark-spike"],animation:{appearAt:.05,disappearAt:.65,enter:{type:"scale",duration:.05,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.2},flicker:{intensity:.3,rate:14,pattern:"random"},drift:{speed:1.2,distance:1,direction:{x:1,y:.5,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:.25,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"spark-spike":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:2,radius:.05,endRadius:.4,angleSpread:120,startAngle:240,orientation:"camera",startScale:.3,endScale:.8,scaleEasing:"easeOutQuad"},count:2,scale:.6,models:["arc-small"],animation:{appearAt:.15,disappearAt:.55,stagger:.03,enter:{type:"scale",duration:.04,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},flicker:{intensity:.4,rate:18,pattern:"random"},scaleVariance:.2,blending:"additive",renderOrder:14,modelOverrides:{"arc-small":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}}],jitterFrequency:8,jitterAmplitude:.005,jitterDecay:.2,glowColor:[.35,.9,1],glowIntensityMin:1.4,glowIntensityMax:3.5,glowFlickerRate:10,scaleVibration:.02,scaleFrequency:4,scaleGrowth:.03,scalePulse:!0,riseAmount:.02});function Nt(e){return(43758.5453*Math.sin(127.1*e+311.7*e)%1+1)%1}function Jt(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return Nt(t)*(1-a)+Nt(t+1)*a}function Zt(e){return{name:e.name,emoji:e.emoji,type:e.type,description:e.description,config:{duration:e.duration,beats:e.beats,intensity:e.intensity,...e},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:1.5,offBeat:1,curve:"powered"===e.category?"smooth":"sharp"}},"3d":{evaluate(t,i){const a={...e,...i},s=t*a.duration/1e3,n="powered"===a.category;let r=1;a.buildupPhase&&t<a.buildupPhase&&(r=t/a.buildupPhase,a.buildupGlowRamp&&(r=Math.pow(r,.5))),a.rampUp&&(r=Math.pow(t,.7)),t>1-a.jitterDecay&&(r*=1-(t-(1-a.jitterDecay))/a.jitterDecay);let o=0,l=0,h=0;if(a.jitterAmplitude>0){const e=s*a.jitterFrequency;let t=1;a.holdFrames&&Nt(Math.floor(3*e))<a.holdProbability&&(t=.1),o=(Jt(e)-.5+.5*(Jt(2.3*e+50)-.5)+.25*(Jt(4.7*e+100)-.5))*a.jitterAmplitude*r*t,l=(Jt(e+33)-.5+.5*(Jt(2.1*e+83)-.5)+.25*(Jt(5.3*e+133)-.5))*a.jitterAmplitude*r*t,h=(Jt(e+66)-.5+.5*(Jt(1.9*e+116)-.5)+.25*(Jt(3.7*e+166)-.5))*a.jitterAmplitude*r*t*.5}a.hover&&a.hoverAmount&&(l+=Math.sin(s*Math.PI*.5)*a.hoverAmount*r),a.riseAmount&&(l+=a.riseAmount*r);let c=0,u=0,d=0;if(!n&&a.jitterAmplitude>0){const e=s*a.jitterFrequency,t=2*a.jitterAmplitude;c=(Jt(1.3*e+200)-.5)*t*r,u=(Jt(1.7*e+250)-.5)*t*r,d=(Jt(2.1*e+300)-.5)*t*r*.5}else a.rotationDrift&&(u=s*a.rotationDrift*r);let p=1;const g=s*a.scaleFrequency;a.scalePulse?(p=1+(.5*Math.sin(g*Math.PI*2)+.5)*a.scaleVibration*r,a.scaleGrowth&&(p+=a.scaleGrowth*r)):p=1+(.5*Math.sin(g*Math.PI*2)+.3*Math.sin(g*Math.PI*3.7))*a.scaleVibration*r;const m=s*a.glowFlickerRate;let y;return n?(y=.3*Math.sin(m*Math.PI*2)+.7,a.sparkBursts&&Nt(Math.floor(10*s))<a.sparkProbability&&(y=1)):y=.4*Math.sin(m*Math.PI*2)+.3*Math.sin(m*Math.PI*5.3+1.7)+.5*(Nt(Math.floor(2*m))>.7?1:0)+.5,{position:[o,l,h],rotation:[c,u,d],scale:p,glowIntensity:a.glowIntensityMin+(a.glowIntensityMax-a.glowIntensityMin)*y*r,glowBoost:(.8*y+.2)*r*a.intensity,glowColorOverride:a.glowColor,electricOverlay:{enabled:r>.1,strength:r*a.intensity,charge:r*a.intensity,category:a.category,spawnMode:a.spawnMode||null,duration:a.duration,progress:t,time:s,animation:e.spawnMode?.animation,models:e.spawnMode?.models,count:e.spawnMode?.count,scale:e.spawnMode?.scale,embedDepth:e.spawnMode?.embedDepth}}}}}}const Kt=Ft,ei=Dt,ti=qt,ii=Rt,ai=Bt,si=Et,ni=Pt,ri=Tt,oi=jt,li=Vt,hi=Wt,ci=Gt,ui=Lt,di=_t,pi=Ht,gi=Ut,mi=Qt,yi=Yt,fi=Xt,bi=Xt;var wi=Zt({name:"electricmeditation",emoji:"üßò",type:"blending",description:"Electric mandala ‚Äî controlled charge energy in meditative focus",duration:4e3,beats:4,intensity:.7,category:"powered",charge:.5,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"easeInOut",startScale:1,endScale:1,startDiameter:1.8,endDiameter:1.8,orientation:"camera"},formation:{type:"mandala",count:5,radius:.5,arcOffset:45,scales:[1,.6,.6,.6,.6]},count:5,scale:1.2,models:["lightning-ring"],animation:{appearAt:0,disappearAt:.8,stagger:0,enter:{type:"fade",duration:.5,easing:"easeInOut"},exit:{type:"fade",duration:.4,easing:"easeInOut"},procedural:{scaleSmoothing:.15,geometryStability:!0},pulse:{amplitude:.12,frequency:2,easing:"easeInOut"},flicker:{intensity:.1,rate:6,pattern:"step"},emissive:{min:.8,max:1.5,frequency:2,pattern:"sine"},cutout:{strength:.6,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:6,scale:1.5,weight:.5},blend:"add",travel:"angular",travelSpeed:.8,strengthCurve:"bell",bellPeakAt:.5,bellWidth:1,geometricMask:{type:"distance",core:.1,tip:.3}},grain:{type:3,strength:.35,scale:.4,speed:.8,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.2,sizeScale:.6,speedScale:.5,progressCurve:"sustain"}],rotate:[{axis:"z",rotations:.35,phase:0},{axis:"z",rotations:-.3,phase:0},{axis:"z",rotations:.25,phase:0},{axis:"z",rotations:-.3,phase:0},{axis:"z",rotations:.35,phase:0}],scaleVariance:0,lifetimeVariance:0,blending:"additive",renderOrder:-5,modelOverrides:{"lightning-ring":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:.6,arcCount:2},orientationOverride:"camera"}}}},decayRate:.2,glowColor:[.5,.7,1],glowIntensityMin:.5,glowIntensityMax:.9,glowFlickerRate:3,scaleVibration:.005,scaleFrequency:2,scaleGrowth:0,rotationEffect:!1});function vi(e){return.5*Math.sin(1*e)+.3*Math.sin(2.3*e+1.3)+.2*Math.sin(4.1*e+2.7)}function Mi(e){return{name:e.name,emoji:e.emoji,type:e.type,description:e.description,config:{duration:e.duration,beats:e.beats,intensity:e.intensity,...e},rhythm:{enabled:!0,syncMode:"phrase",amplitudeSync:{onBeat:1.3,offBeat:1,curve:"smooth"}},"3d":{evaluate(t,i){const a=e["3d"]?.evaluate,s=a?a(t,i):null,n={...e,...i},r=t*n.duration/1e3,{category:o}=n;let l=1;if("impact"===o)if(n.impactBurst&&t<n.burstDuration)l=t/n.burstDuration,l=Math.pow(l,.3);else if(n.rampUp)l=Math.pow(t,.5);else{const e=n.burstDuration||.2;if(t>e){const i=(t-e)/(1-e);l=1-Math.pow(i,n.wobbleDecay+.5)}}"transform"===o&&(l=n.formLoss?.3+.7*t:Math.min(2*t,1)),"ambient"===o&&(l=.8+.1*Math.sin(t*Math.PI*2)+.2*t),t>.85&&(l*=1-(t-.85)/.15);let h=0,c=0,u=0;if(n.flowFrequency){const e=r*n.flowFrequency*Math.PI*2;h=Math.sin(e)*n.flowAmplitude*l,n.flowPhaseOffset&&(c=Math.sin(e+Math.PI*n.flowPhaseOffset)*n.flowAmplitude*.5*l),n.verticalBob&&(c+=Math.sin(.5*e)*n.verticalBob*l)}if(n.wobbleAmplitude>0){const e=r*n.wobbleFrequency;let i=n.wobbleAmplitude*l;n.wobbleDecay<0&&(i*=1+t*Math.abs(n.wobbleDecay)*2),h+=vi(e)*i,c+=vi(e+33)*i*.7,u+=vi(e+66)*i*.5}n.sinkAmount&&(c-=n.sinkAmount*l),n.settleDown&&(c-=n.settleDown*t*l),n.meltDown&&(c-=.02*t*l);const d=s?.rotation||[0,0,0];let p=d[0]||0,g=d[1]||0,m=d[2]||0;if(n.rotationFlow&&(g+=r*n.rotationFlow*l),n.rotationSway){const e=r*(n.flowFrequency||1)*Math.PI*2;m+=Math.sin(e)*n.rotationSway*l}if(n.wobbleAmplitude>0&&"ambient"!==o){const e=r*n.wobbleFrequency,t=.3*n.wobbleAmplitude*l;p+=vi(.7*e+100)*t,m+=vi(.9*e+150)*t}let y=1,f=1,b=1,w=1;if(n.scaleWobble){const e=r*n.scaleFrequency*Math.PI*2,t=.5*Math.sin(e)+.5;y=n.concentricPulse&&n.pulseCount?1+(.5*Math.sin(e*n.pulseCount)+.5)*n.scaleWobble*l:1+t*n.scaleWobble*l}n.scaleGrowth&&(y+=n.scaleGrowth*t*l),n.scaleCompression&&(y+=n.scaleCompression*l),n.scaleSquash?(b=y-n.scaleSquash*t*l,f=y+(n.scaleStretch||.5*n.scaleSquash)*t*l,w=f):n.stretchVertical?(b=y+n.stretchVertical*t*l,f=y-.3*n.stretchVertical*t*l,w=f):f=b=w=y;const v=r*n.glowPulseRate*Math.PI*2;let M=.5*Math.sin(v)+.5;return n.impactBurst&&t<n.burstDuration&&(M=1),n.saturationBuild&&(M=Math.max(M,t)),{position:[h,c,u],rotation:[p,g,m],scale:(f+b+w)/3,scaleXYZ:[f,b,w],glowIntensity:n.glowIntensityMin+(n.glowIntensityMax-n.glowIntensityMin)*M*l,glowBoost:.6*M*l*n.intensity,glowColorOverride:n.glowColor,waterOverlay:{enabled:l>.1,strength:l*n.intensity,wetness:l*n.intensity,turbulence:n.turbulence,category:n.category,spawnMode:n.spawnMode||null,duration:n.duration,progress:t,time:r,animation:e.spawnMode?.animation,models:e.spawnMode?.models,count:e.spawnMode?.count,scale:e.spawnMode?.scale,embedDepth:e.spawnMode?.embedDepth}}}}}}var Si=Mi({name:"splash",emoji:"üí¶",type:"blending",description:"Explosive water splash with curling waves and spray",duration:1e3,beats:2,intensity:1.3,category:"impact",turbulence:.8,spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.1},orientation:"camera",startScale:.2,endScale:2,scaleEasing:"easeOutQuad"},count:1,scale:1.5,models:["splash-ring"],animation:{appearAt:0,disappearAt:.4,enter:{type:"scale",duration:.05,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.6,primary:{pattern:2,scale:1.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:1,strengthCurve:"fadeOut"},grain:{type:3,strength:.5,scale:.3,speed:1.5,blend:"multiply"},blending:"additive",renderOrder:8,rotate:{axis:"z",rotations:0,phase:0},modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}},atmospherics:[{preset:"spray",targets:null,anchor:"above",intensity:1,sizeScale:1.2,burstCount:25,progressCurve:"burst"}]}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.3,endScale:1.6,scaleEasing:"easeOutQuad"},count:1,scale:1.2,models:["droplet-large"],animation:{appearAt:0,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.4,primary:{pattern:4,scale:1,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.4,distance:.8,direction:{x:0,y:1,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"droplet-large":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.25,endScale:1.3,scaleEasing:"easeOutQuad"},count:1,scale:1,models:["droplet-large"],animation:{appearAt:.02,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.45,primary:{pattern:0,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:.6,strengthCurve:"fadeOut"},drift:{speed:1.3,distance:.75,direction:{x:-.7,y:.85,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"droplet-large":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.25,endScale:1.3,scaleEasing:"easeOutQuad"},count:1,scale:1,models:["droplet-large"],animation:{appearAt:.02,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.45,primary:{pattern:0,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:.6,strengthCurve:"fadeOut"},drift:{speed:1.3,distance:.75,direction:{x:.7,y:.85,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"droplet-large":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:1.1,scaleEasing:"easeOutQuad"},count:1,scale:.85,models:["droplet-large"],animation:{appearAt:.03,disappearAt:.45,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.18,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.4,primary:{pattern:4,scale:1.2,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.1,distance:.6,direction:{x:-.95,y:.5,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:11,modelOverrides:{"droplet-large":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:1.1,scaleEasing:"easeOutQuad"},count:1,scale:.85,models:["droplet-large"],animation:{appearAt:.03,disappearAt:.45,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.18,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.4,primary:{pattern:4,scale:1.2,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.1,distance:.6,direction:{x:.95,y:.5,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:11,modelOverrides:{"droplet-large":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:8,radius:.05,endRadius:.65,angleSpread:360,startAngle:22,orientation:"camera",startScale:.2,endScale:.9,scaleEasing:"easeOutQuad"},count:8,scale:.6,models:["droplet-small"],animation:{appearAt:.02,disappearAt:.4,stagger:.008,enter:{type:"scale",duration:.03,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},cutout:{strength:.35,primary:{pattern:0,scale:.7,weight:1},blend:"multiply",travel:"radial",travelSpeed:.8,strengthCurve:"fadeOut"},rotate:{axis:"z",rotations:0,phase:0},scaleVariance:.3,lifetimeVariance:.15,blending:"additive",renderOrder:14,modelOverrides:{"droplet-small":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:12,radius:.03,endRadius:.5,angleSpread:360,startAngle:0,orientation:"camera",startScale:.1,endScale:.35,scaleEasing:"easeOutQuad"},count:12,scale:.2,models:["droplet-small"],animation:{appearAt:.01,disappearAt:.3,stagger:.005,enter:{type:"scale",duration:.02,easing:"easeOut"},exit:{type:"fade",duration:.1,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},cutout:{strength:.25,primary:{pattern:7,scale:.5,weight:1},blend:"multiply",travel:"radial",travelSpeed:1,strengthCurve:"fadeOut"},rotate:{axis:"z",rotations:0,phase:0},scaleVariance:.5,lifetimeVariance:.25,blending:"additive",renderOrder:16,modelOverrides:{"droplet-small":{shaderAnimation:{type:1,arcWidth:.98,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:-.1,z:.12},orientation:"camera",startScale:.2,endScale:.9,scaleEasing:"easeOutQuad"},count:1,scale:.7,models:["bubble-cluster"],animation:{appearAt:.05,disappearAt:.6,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},cutout:{strength:.5,primary:{pattern:0,scale:1.2,weight:1},blend:"multiply",travel:"radial",travelSpeed:.5,strengthCurve:"constant"},pulse:{amplitude:.1,frequency:8,easing:"easeInOut"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:6,modelOverrides:{"bubble-cluster":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:2},orientationOverride:"camera"}}}}],wobbleFrequency:6,wobbleAmplitude:.018,wobbleDecay:.4,scaleWobble:.035,scaleFrequency:7,scaleGrowth:.015,glowColor:[.35,.65,1],glowIntensityMin:1.2,glowIntensityMax:2.2,glowPulseRate:6}),xi=Mi({name:"drench",emoji:"üåä",type:"blending",description:"Expanding water shockwave",duration:1e3,beats:2,intensity:1,category:"impact",turbulence:.4,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.2,endScale:2.5,startDiameter:.3,endDiameter:2.5,orientation:"camera"},formation:{type:"stack",count:1,spacing:0},count:1,scale:1.2,models:["splash-ring"],animation:{appearAt:0,disappearAt:.8,stagger:0,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.06,geometryStability:!0},parameterAnimation:{turbulence:{start:.5,peak:.3,end:.1,curve:"bell"}},cutout:{strength:.5,primary:{pattern:0,scale:1.3,weight:1},secondary:{pattern:3,scale:.6,weight:.7},blend:"multiply",travel:"radial",travelSpeed:1.5,strengthCurve:"fadeOut",trailDissolve:{enabled:!0,offset:-.3,softness:1.4}},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},pulse:{amplitude:.05,frequency:2,easing:"easeOut"},blending:"additive",renderOrder:10,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.4,arcCount:1},orientationOverride:"camera"}},atmospherics:[{preset:"spray",targets:null,anchor:"above",intensity:.8,sizeScale:1,burstCount:20,progressCurve:"burst",velocityInheritance:.4}]}},wobbleFrequency:2,wobbleAmplitude:.01,wobbleDecay:.6,scaleWobble:.01,scaleFrequency:2,scaleGrowth:0,glowColor:[.2,.5,.9],glowIntensityMin:.8,glowIntensityMax:1.3,glowPulseRate:2}),ki=Mi({name:"soak",emoji:"üíß",type:"blending",description:"Contracting water shockwave (reverse drench)",duration:1e3,beats:2,intensity:1,category:"impact",turbulence:.4,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:1.8,endScale:.3,startDiameter:2,endDiameter:.4,orientation:"camera"},formation:{type:"stack",count:1,spacing:0},count:1,scale:1.2,models:["splash-ring"],animation:{appearAt:0,disappearAt:.85,stagger:0,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"scale",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.06,geometryStability:!0},parameterAnimation:{turbulence:{start:.1,peak:.35,end:.5,curve:"bell"}},cutout:{strength:.5,primary:{pattern:0,scale:1.3,weight:1},secondary:{pattern:3,scale:.6,weight:.7},blend:"multiply",travel:"radial",travelSpeed:1.5,strengthCurve:"fadeIn",trailDissolve:{enabled:!0,offset:-.3,softness:1.4}},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},pulse:{amplitude:.05,frequency:2,easing:"easeIn"},blending:"additive",renderOrder:10,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.4,arcCount:1},orientationOverride:"camera"}},atmospherics:[{preset:"spray",targets:null,anchor:"around",intensity:.5,sizeScale:.8,burstCount:12,progressCurve:"burst",velocityInheritance:.3}]}},wobbleFrequency:2,wobbleAmplitude:.01,wobbleDecay:.6,scaleWobble:.01,scaleFrequency:2,scaleGrowth:0,glowColor:[.2,.5,.9],glowIntensityMin:.8,glowIntensityMax:1.3,glowPulseRate:2}),Oi=Mi({name:"flow",emoji:"„Ä∞Ô∏è",type:"blending",description:"Gentle river current drifting across",duration:3e3,beats:4,intensity:.7,category:"ambient",turbulence:.2,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",startOffset:.25,endOffset:.25,easing:"linear",startScale:.7,endScale:1.1,startDiameter:1,endDiameter:1.3,orientation:"camera"},formation:{type:"ring",count:3,phaseOffset:.2},count:3,scale:1,models:["splash-ring"],animation:{appearAt:0,disappearAt:.85,stagger:.18,enter:{type:"fade",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},drift:{speed:.45,distance:2.2,direction:{x:1,y:.05,z:0},easing:"easeInOut"},cutout:{strength:.5,primary:{pattern:4,scale:1.3,weight:1},secondary:{pattern:1,scale:.6,weight:.35},blend:"multiply",travel:"angular",travelSpeed:1.2,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:1.5,blend:"multiply"},rotate:[{axis:"z",rotations:.25,phase:0},{axis:"z",rotations:-.2,phase:120},{axis:"z",rotations:.3,phase:240}],pulse:{amplitude:.07,frequency:2,easing:"easeInOut"},blending:"additive",renderOrder:8,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.75,arcSpeed:.8,arcCount:2},orientationOverride:"camera"}}}},{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",startOffset:-.2,endOffset:-.2,easing:"linear",startScale:.6,endScale:1,startDiameter:.9,endDiameter:1.2,orientation:"camera"},formation:{type:"ring",count:2,phaseOffset:.25},count:2,scale:.9,models:["wave-curl"],animation:{appearAt:.1,disappearAt:.9,stagger:.2,enter:{type:"fade",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},drift:{speed:.4,distance:2,direction:{x:1,y:-.03,z:0},easing:"easeInOut"},cutout:{strength:.45,primary:{pattern:4,scale:1.4,weight:1},secondary:{pattern:1,scale:.7,weight:.3},blend:"multiply",travel:"angular",travelSpeed:1,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:1.5,blend:"multiply"},rotate:[{axis:"z",rotations:-.3,phase:45},{axis:"z",rotations:.25,phase:225}],pulse:{amplitude:.06,frequency:2.5,easing:"easeInOut"},blending:"additive",renderOrder:6,modelOverrides:{"wave-curl":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:1.2,arcCount:1},orientationOverride:"camera"}}}}],wobbleFrequency:1.5,wobbleAmplitude:.008,wobbleDecay:.3,scaleWobble:.01,scaleFrequency:2,scaleGrowth:.008,glowColor:[.3,.55,.9],glowIntensityMin:.8,glowIntensityMax:1.4,glowPulseRate:2}),Ai=Mi({name:"tide",emoji:"üåä",type:"blending",description:"Single wave with animated tidal cutout",duration:1500,beats:2,intensity:.8,category:"ambient",turbulence:.3,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",startOffset:0,endOffset:0,easing:"linear",startScale:1,endScale:1,startDiameter:1,endDiameter:1,orientation:"camera"},formation:{type:"ring",count:1,phaseOffset:0},count:1,scale:4.4,models:["wave-curl"],animation:{appearAt:0,disappearAt:.9,stagger:0,enter:{type:"grow",duration:.3,easing:"easeOut"},exit:{type:"fade",duration:.35,easing:"easeIn"},procedural:{scaleSmoothing:.15,geometryStability:!0},cutout:{strength:.55,primary:{pattern:4,scale:1.2,weight:1},secondary:{pattern:0,scale:.6,weight:.25},blend:"multiply",travel:"angular",travelSpeed:-1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:1,blend:"multiply"},rotate:{axis:"z",rotations:-.25,phase:0},pulse:{amplitude:.15,frequency:.6,easing:"easeInOut"},blending:"additive",renderOrder:6,modelOverrides:{"wave-curl":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:.8,arcCount:2},orientationOverride:"camera"}}}},wobbleFrequency:.8,wobbleAmplitude:.005,wobbleDecay:.4,scaleWobble:.008,scaleFrequency:.8,glowColor:[.15,.45,.85],glowIntensityMin:.85,glowIntensityMax:1.4,glowPulseRate:.8}),Ci=Mi({name:"liquefy",emoji:"üíß",type:"blending",description:"Dramatic tears falling with dissolve trails",duration:2200,beats:3,intensity:.9,category:"transform",turbulence:.4,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"top",end:"bottom",startOffset:.15,endOffset:-.3,easing:"easeInQuad",startScale:.5,endScale:1.3,startDiameter:.7,endDiameter:1.1,orientation:"camera"},formation:{type:"ring",count:4,phaseOffset:.15},count:4,scale:1.1,models:["droplet-large"],animation:{appearAt:0,disappearAt:.9,stagger:.12,enter:{type:"grow",duration:.12,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},cutout:{strength:.55,primary:{pattern:7,scale:1.3,weight:1},secondary:{pattern:0,scale:.5,weight:.25},blend:"multiply",travel:"vertical",travelSpeed:1.8,strengthCurve:"fadeIn",trailDissolve:{enabled:!0,offset:-.5,softness:1.8}},grain:{type:3,strength:.25,scale:.2,speed:2,blend:"multiply"},rotate:{axis:"z",rotations:0,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"additive",renderOrder:8,modelOverrides:{"droplet-large":{shaderAnimation:{type:3,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"axis-travel",axisTravel:{axis:"y",start:"top",end:"bottom",startOffset:.05,endOffset:-.15,easing:"easeInCubic",startScale:.4,endScale:.9,startDiameter:.6,endDiameter:.9,orientation:"camera"},formation:{type:"ring",count:6,phaseOffset:.1},count:6,scale:.6,models:["droplet-small"],animation:{appearAt:.08,disappearAt:.85,stagger:.08,enter:{type:"grow",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.06,geometryStability:!0},cutout:{strength:.5,primary:{pattern:7,scale:1,weight:1},secondary:{pattern:0,scale:.4,weight:.2},blend:"multiply",travel:"vertical",travelSpeed:2.5,strengthCurve:"fadeIn",trailDissolve:{enabled:!0,offset:-.4,softness:1.2}},grain:{type:3,strength:.2,scale:.15,speed:2.5,blend:"multiply"},rotate:{axis:"z",rotations:0,phase:0},scaleVariance:.25,lifetimeVariance:.2,blending:"additive",renderOrder:10,modelOverrides:{"droplet-small":{shaderAnimation:{type:3,arcWidth:.98,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}}],wobbleFrequency:2,wobbleAmplitude:.006,wobbleDecay:.2,scaleWobble:.02,scaleFrequency:3,glowColor:[.25,.5,.9],glowIntensityMin:.9,glowIntensityMax:1.6,glowPulseRate:3}),Ii=Mi({name:"pool",emoji:"ü´ó",type:"blending",description:"Submerging sensation with contracting water rings",duration:2800,beats:4,intensity:.7,category:"transform",turbulence:.2,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",startOffset:.35,endOffset:.35,easing:"easeInOutQuad",startScale:1.4,endScale:.5,startDiameter:3.2,endDiameter:.6,orientation:"flat"},formation:{type:"ring",count:1},count:1,scale:1,models:["splash-ring"],animation:{appearAt:0,disappearAt:.85,enter:{type:"fade",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.12,geometryStability:!0},cutout:{strength:.5,primary:{pattern:4,scale:1.6,weight:1},secondary:{pattern:0,scale:.6,weight:.35},blend:"multiply",travel:"radial",travelSpeed:-.8,strengthCurve:"fadeIn"},grain:{type:3,strength:.25,scale:.3,speed:.8,blend:"multiply"},rotate:{axis:"y",rotations:.15,phase:0},pulse:{amplitude:.05,frequency:1.5,easing:"easeInOut"},blending:"additive",renderOrder:5,modelOverrides:{"splash-ring":{shaderAnimation:{type:5,arcWidth:.85,arcSpeed:.4,arcCount:2}}}}},{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",startOffset:0,endOffset:0,easing:"easeInOutQuad",startScale:1.5,endScale:.4,startDiameter:3.5,endDiameter:.5,orientation:"flat"},formation:{type:"ring",count:1},count:1,scale:1.1,models:["splash-ring"],animation:{appearAt:.05,disappearAt:.9,enter:{type:"fade",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.12,geometryStability:!0},cutout:{strength:.55,primary:{pattern:4,scale:1.5,weight:1},secondary:{pattern:0,scale:.7,weight:.4},blend:"multiply",travel:"radial",travelSpeed:-1,strengthCurve:"fadeIn"},grain:{type:3,strength:.25,scale:.3,speed:1,blend:"multiply"},rotate:{axis:"y",rotations:-.12,phase:45},pulse:{amplitude:.06,frequency:1.5,easing:"easeInOut"},blending:"additive",renderOrder:6,modelOverrides:{"splash-ring":{shaderAnimation:{type:5,arcWidth:.9,arcSpeed:.5,arcCount:2}}}}},{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",startOffset:-.35,endOffset:-.35,easing:"easeInOutQuad",startScale:1.3,endScale:.5,startDiameter:3,endDiameter:.7,orientation:"flat"},formation:{type:"ring",count:1},count:1,scale:.95,models:["splash-ring"],animation:{appearAt:.1,disappearAt:.85,enter:{type:"fade",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.12,geometryStability:!0},cutout:{strength:.5,primary:{pattern:4,scale:1.4,weight:1},secondary:{pattern:0,scale:.6,weight:.35},blend:"multiply",travel:"radial",travelSpeed:-.9,strengthCurve:"fadeIn"},grain:{type:3,strength:.25,scale:.3,speed:.8,blend:"multiply"},rotate:{axis:"y",rotations:.18,phase:90},pulse:{amplitude:.05,frequency:1.5,easing:"easeInOut"},blending:"additive",renderOrder:4,modelOverrides:{"splash-ring":{shaderAnimation:{type:5,arcWidth:.85,arcSpeed:.4,arcCount:2}}}}},{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"center",startOffset:-.2,endOffset:.3,easing:"easeOutQuad",startScale:.3,endScale:.8,startDiameter:.8,endDiameter:1.2,orientation:"camera"},formation:{type:"ring",count:4,phaseOffset:.15},count:4,scale:.5,models:["bubble-cluster"],animation:{appearAt:.15,disappearAt:.8,stagger:.1,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},cutout:{strength:.4,primary:{pattern:0,scale:1,weight:1},blend:"multiply",travel:"angular",travelSpeed:.8,strengthCurve:"constant"},grain:{type:3,strength:.15,scale:.25,speed:1.5,blend:"multiply"},pulse:{amplitude:.1,frequency:3,easing:"easeInOut"},blending:"additive",renderOrder:8,modelOverrides:{"bubble-cluster":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.6,arcCount:2},orientationOverride:"camera"}}}}],wobbleFrequency:1.5,wobbleAmplitude:.01,wobbleDecay:.35,scaleWobble:.012,scaleFrequency:1.5,glowColor:[.2,.45,.8],glowIntensityMin:.7,glowIntensityMax:1.3,glowPulseRate:1.5}),zi=Mi({name:"watervortex",emoji:"üåÄ",type:"blending",description:"Water tornado spiraling around mascot",duration:1500,beats:5,intensity:1.4,category:"transform",turbulence:.75,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.4,endScale:1.7,startDiameter:.6,endDiameter:2,orientation:"flat"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["splash-ring"],animation:{appearAt:.05,disappearAt:.9,stagger:.02,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.1},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{turbulence:{start:.4,peak:.85,end:.5,curve:"bell"}},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:12,intensityScaling:{scale:1.4,pulseAmplitude:1.3},modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:6,arcCount:1},scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.1},y:{expand:!1,rate:.3},z:{expand:!0,rate:1.1}}},orientationOverride:"flat"}},atmospherics:[{preset:"spray",targets:null,anchor:"around",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.6,centrifugal:{speed:1.2,tangentialBias:.3}}]}},wobbleFrequency:4,wobbleAmplitude:.015,wobbleDecay:.2,glowColor:[.2,.55,1],glowIntensityMin:1.2,glowIntensityMax:2.2,glowPulseRate:6,scaleWobble:.02,scaleFrequency:4,scaleGrowth:.03}),Fi=Mi({name:"watercrown",emoji:"üëë",type:"blending",description:"Majestic water crown above the head",duration:3e3,beats:4,intensity:1,category:"ambient",turbulence:.2,spawnMode:{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.1,z:0},orientation:"flat",bob:{amplitude:.025,frequency:.3}},count:1,scale:2,models:["splash-ring"],animation:{appearAt:0,disappearAt:.75,stagger:0,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},parameterAnimation:{turbulence:{start:.1,peak:.25,end:.15,curve:"bell"}},pulse:{amplitude:.06,frequency:2,easing:"easeInOut"},rotate:{axis:"z",rotations:1,phase:0},scaleVariance:0,lifetimeVariance:0,blending:"normal",renderOrder:15,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.8,arcCount:3}}}}},wobbleFrequency:1.5,wobbleAmplitude:.005,wobbleDecay:.3,scaleWobble:.008,scaleFrequency:2,scaleGrowth:.01,glowColor:[.3,.6,1],glowIntensityMin:.9,glowIntensityMax:1.4,glowPulseRate:3}),Di=Mi({name:"waterdance",emoji:"üíÉ",type:"blending",description:"Vertical splash rings dancing and rising",duration:1500,beats:3,intensity:1.3,category:"ambient",turbulence:.4,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.4,endScale:1.8,startDiameter:1.3,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["splash-ring"],animation:{appearAt:.02,disappearAt:.5,stagger:.02,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},cutout:{strength:.7,primary:{pattern:0,scale:.8,weight:1},secondary:{pattern:1,scale:.6,weight:.5},blend:"multiply",travel:"angular",travelSpeed:.3,strengthCurve:"fadeIn",fadeInDuration:.167,trailDissolve:{enabled:!0,offset:-.8,softness:2}},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},parameterAnimation:{turbulence:{start:.2,peak:.45,end:.25,curve:"bell"}},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},rotate:[{axis:"y",rotations:2,phase:0},{axis:"y",rotations:-2,phase:60},{axis:"y",rotations:3,phase:120}],scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:11,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}},atmospherics:[{preset:"spray",targets:null,anchor:"above",intensity:.25,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.4,centrifugal:{speed:.5,tangentialBias:.5}}]}},wobbleFrequency:3,wobbleAmplitude:.01,wobbleDecay:.2,scaleWobble:.018,scaleFrequency:4,scaleGrowth:.025,glowColor:[.25,.55,.95],glowIntensityMin:1.2,glowIntensityMax:2.5,glowPulseRate:6,rotationFlow:.02}),qi=Mi({name:"waterdrill",emoji:"üî©",type:"blending",description:"Fast tight descending water helix",duration:1200,beats:2,intensity:1.5,category:"transform",turbulence:.6,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"feet",end:"below",easing:"easeIn",startScale:1,endScale:.8,startDiameter:1.8,endDiameter:1.4,orientation:"vertical"},formation:{type:"spiral",count:6,spacing:.1,arcOffset:60,phaseOffset:0},count:6,scale:.8,models:["splash-ring"],animation:{appearAt:0,disappearAt:.6,stagger:.03,enter:{type:"fade",duration:.05,easing:"linear"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{turbulence:{start:.3,peak:.7,end:.5,curve:"bell"}},cutout:{strength:.55,primary:{pattern:6,scale:1.5,weight:1},secondary:{pattern:1,scale:.8,weight:.35},blend:"add",travel:"vertical",travelSpeed:3,strengthCurve:"constant"},grain:{type:3,strength:.3,scale:.2,speed:4,blend:"multiply"},pulse:{amplitude:.08,frequency:10,easing:"linear"},rotate:{axis:"y",rotations:4,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:16,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:3,arcCount:1},orientationOverride:"vertical"}},atmospherics:[{preset:"spray",targets:null,anchor:"above",intensity:.25,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:1,tangentialBias:.3}}]}},wobbleFrequency:8,wobbleAmplitude:.01,wobbleDecay:.15,scaleWobble:.02,scaleFrequency:8,scaleGrowth:.03,glowColor:[.2,.5,1],glowIntensityMin:1.3,glowIntensityMax:2.8,glowPulseRate:10,rotationFlow:.05}),Ri=Mi({name:"waterhelix",emoji:"üß¨",type:"blending",description:"DNA-style double helix ascending water",duration:2e3,beats:4,intensity:1.2,category:"ambient",turbulence:.35,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeInOut",startScale:.9,endScale:1.1,startDiameter:1.8,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:6,strands:2,spacing:.2,arcOffset:120,phaseOffset:.05},count:6,scale:.7,models:["splash-ring"],animation:{appearAt:0,disappearAt:.7,stagger:.06,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{turbulence:{start:.2,peak:.4,end:.25,curve:"bell"}},cutout:{strength:.5,primary:{pattern:6,scale:1.3,weight:1},secondary:{pattern:0,scale:.7,weight:.3},blend:"multiply",travel:"vertical",travelSpeed:1.2,strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.4,softness:1}},grain:{type:3,strength:.2,scale:.25,speed:1.5,blend:"multiply"},pulse:{amplitude:.08,frequency:3,easing:"easeInOut"},rotate:{axis:"y",rotations:2.5,phase:0},scaleVariance:.1,lifetimeVariance:.1,blending:"normal",renderOrder:16,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}},atmospherics:[{preset:"spray",targets:null,anchor:"above",intensity:.25,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:.8,tangentialBias:.4}}]}},wobbleFrequency:2,wobbleAmplitude:.008,wobbleDecay:.2,scaleWobble:.015,scaleFrequency:3,scaleGrowth:.02,glowColor:[.3,.55,.9],glowIntensityMin:1.1,glowIntensityMax:2.2,glowPulseRate:4,rotationFlow:.015}),Bi=Mi({name:"watermeditation",emoji:"üßò",type:"blending",description:"Meditative water rings with breathing pulse",duration:4e3,beats:4,intensity:.5,category:"ambient",turbulence:.1,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"easeInOut",startScale:1.3,endScale:1.3,startDiameter:2.2,endDiameter:2.2,orientation:"camera"},formation:{type:"mandala",count:3,radius:.5,arcOffset:60,scales:[1,.7,.7]},count:3,scale:1.8,models:["splash-ring"],animation:{appearAt:0,disappearAt:.8,stagger:0,enter:{type:"fade",duration:.5,easing:"easeInOut"},exit:{type:"fade",duration:.4,easing:"easeInOut"},procedural:{scaleSmoothing:.15,geometryStability:!0},parameterAnimation:{turbulence:{start:.05,peak:.12,end:.08,curve:"sine"}},cutout:{strength:.6,primary:{pattern:0,scale:.8,weight:1},secondary:{pattern:1,scale:.6,weight:.5},blend:"multiply",travel:"angular",travelSpeed:.5,strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.5,softness:1.8}},grain:{type:3,strength:.15,scale:.3,speed:.8,blend:"multiply"},pulse:{amplitude:.15,frequency:1.5,easing:"easeInOut"},rotate:[{axis:"z",rotations:.4,phase:0},{axis:"z",rotations:-.35,phase:0},{axis:"z",rotations:.3,phase:0}],scaleVariance:0,lifetimeVariance:0,blending:"additive",renderOrder:-5,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.5,arcCount:2},orientationOverride:"camera"}}}},wobbleFrequency:1,wobbleAmplitude:.003,wobbleDecay:.5,scaleWobble:.004,scaleFrequency:1.5,scaleGrowth:0,glowColor:[.3,.6,.9],glowIntensityMin:.7,glowIntensityMax:1.1,glowPulseRate:1.5});const Ei={appearAt:0,disappearAt:.7,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"burst-fade",duration:.4,easing:"easeIn",burstScale:1.2,burstDirection:"up"},procedural:{scaleSmoothing:.1,geometryStability:!0},parameterAnimation:{turbulence:{start:.15,peak:.3,end:.2,curve:"bell"}},pulse:{amplitude:.08,frequency:3,easing:"easeInOut",perElement:!0,phaseOffset:30},grain:{type:3,strength:.3,scale:.35,speed:.6,blend:"multiply"},drift:{speed:.15,distance:.08,direction:{x:0,y:1,z:0},easing:"easeOut"},tilt:{axis:"x",oscillate:!0,range:.08,speed:1.5,perElement:!0,phaseOffset:15},scaleVariance:.03,lifetimeVariance:.02,blending:"normal",renderOrder:15,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.8,arcCount:3}}},atmospherics:[{preset:"spray",targets:["splash-ring"],anchor:"above",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.5}]};var Pi=Mi({name:"waterpillar",emoji:"üèõÔ∏è",type:"blending",description:"Majestic rising pillar of water",duration:3e3,beats:4,intensity:1.3,category:"ambient",turbulence:.25,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:0},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1,models:["splash-ring"],animation:{...Ei,stagger:.03,cutout:{strength:.55,primary:{pattern:4,scale:1.4,weight:1},secondary:{pattern:0,scale:.8,weight:.35},blend:"multiply",travel:"angular",travelSpeed:1,strengthCurve:"fadeIn",fadeInDuration:.3,trailDissolve:{enabled:!0,offset:-.5,softness:1.2}},rotate:[{axis:"z",rotations:.3,phase:0},{axis:"z",rotations:.3,phase:180}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:.5},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1,models:["splash-ring"],animation:{...Ei,stagger:.05,cutout:{strength:.6,primary:{pattern:0,scale:1.2,weight:1},secondary:{pattern:1,scale:1.5,weight:.5},blend:"multiply",travel:"radial",travelSpeed:1.5,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.5,trailDissolve:{enabled:!0,offset:-.4,softness:1}},rotate:[{axis:"z",rotations:-.5,phase:60},{axis:"z",rotations:-.5,phase:240}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:1},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1,models:["splash-ring"],animation:{...Ei,stagger:.07,cutout:{strength:.65,primary:{pattern:1,scale:1.8,weight:1},secondary:{pattern:7,scale:1.5,weight:.4},blend:"add",travel:"oscillate",travelSpeed:2,strengthCurve:"fadeOut",fadeOutDuration:.4,trailDissolve:{enabled:!0,offset:-.3,softness:.8}},rotate:[{axis:"z",rotations:.7,phase:90},{axis:"z",rotations:.7,phase:270}]}}],wobbleFrequency:1.5,wobbleAmplitude:.005,wobbleDecay:.3,scaleWobble:.008,scaleFrequency:2,scaleGrowth:.025,glowColor:[.25,.55,.9],glowIntensityMin:1,glowIntensityMax:2,glowPulseRate:3}),Ti=Mi({name:"waterflourish",emoji:"üî±",type:"blending",description:"Spinning water flourish with wave trails",duration:1200,beats:4,intensity:1.3,category:"ambient",turbulence:.5,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.7,endScale:1.2,startDiameter:1.8,endDiameter:2.8,orientation:"camera"},formation:{type:"spiral",count:5,spacing:0,arcOffset:72,phaseOffset:.05,zOffset:0},count:5,scale:.9,models:["splash-ring"],animation:{appearAt:0,disappearAt:.45,stagger:.12,enter:{type:"fade",duration:.03,easing:"easeOut"},exit:{type:"burst-fade",duration:.85,easing:"easeIn",burstScale:1.15},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{turbulence:{start:.35,peak:.7,end:.2,curve:"bell"}},cutout:{strength:.6,primary:{pattern:0,scale:1,weight:1},secondary:{pattern:3,scale:.6,weight:.5},blend:"multiply",strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.6,softness:1.5}},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},pulse:{amplitude:.15,frequency:5,easing:"easeInOut",perElement:!0},drift:{speed:.3,distance:.18,pattern:"radial",accelerate:!0},opacityGradient:[1,.9,.8,.7,.6],rotate:[{axis:"z",rotations:2.5,phase:0},{axis:"z",rotations:-2,phase:72},{axis:"z",rotations:1.8,phase:144},{axis:"z",rotations:-2.3,phase:216},{axis:"z",rotations:2,phase:288}],tilt:{axis:"y",oscillate:!0,range:.4,speed:3.5},wobble:{axis:"x",oscillate:!0,range:.15,speed:2,phase:90},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:-8,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1,arcCount:2},orientationOverride:"camera"}},atmospherics:[{preset:"spray",targets:["splash-ring"],anchor:"above",intensity:.25,sizeScale:1,progressCurve:"sustain",velocityInheritance:.4}]}},{type:"anchor",anchor:{landmark:"center",offset:{x:-.7,y:.4,z:0},orientation:"camera",startScale:.4,endScale:1.2,scaleEasing:"easeOutCubic"},count:1,scale:.7,models:["splash-ring"],animation:{appearAt:.12,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{turbulence:{start:.4,peak:.6,end:.2,curve:"bell"}},cutout:{strength:.5,primary:{pattern:1,scale:1,weight:1},secondary:{pattern:0,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},drift:{speed:.9,distance:.35,direction:{x:1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:1,phase:-45}],blending:"additive",renderOrder:-6,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:2,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:.7,y:.4,z:0},orientation:"camera",startScale:.4,endScale:1.2,scaleEasing:"easeOutCubic"},count:1,scale:.7,models:["splash-ring"],animation:{appearAt:.12,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{turbulence:{start:.4,peak:.6,end:.2,curve:"bell"}},cutout:{strength:.5,primary:{pattern:1,scale:1,weight:1},secondary:{pattern:0,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},drift:{speed:.9,distance:.35,direction:{x:-1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:1,phase:45}],blending:"additive",renderOrder:-6,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:2,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:.9,models:["splash-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{turbulence:{start:.4,peak:.7,end:.25,curve:"bell"}},cutout:{strength:.5,primary:{pattern:0,scale:.8,weight:1},secondary:{pattern:1,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},rotate:[{axis:"z",rotations:.001,phase:45}],blending:"normal",renderOrder:-10,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:.9,models:["splash-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{turbulence:{start:.4,peak:.7,end:.25,curve:"bell"}},cutout:{strength:.5,primary:{pattern:0,scale:.8,weight:1},secondary:{pattern:1,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},rotate:[{axis:"z",rotations:.001,phase:-45}],blending:"normal",renderOrder:-10,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}}],wobbleFrequency:2,wobbleAmplitude:.01,wobbleDecay:.15,glowColor:[.3,.6,1],glowIntensityMin:1,glowIntensityMax:2,glowPulseRate:6,scaleWobble:.012,scaleFrequency:8,scaleGrowth:.015}),ji=Mi({name:"waterbarrage",emoji:"üèπ",type:"blending",description:"Water orbits mascot then launches upward",duration:1500,beats:4,intensity:1.4,category:"transform",turbulence:.6,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"above",radius:1.2,endRadius:2.8,speed:3,easing:"easeIn",startScale:1,endScale:.6,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.4,models:["droplet-small","droplet-large","bubble-cluster","wave-curl"],animation:{appearAt:0,disappearAt:.65,stagger:.04,enter:{type:"scale",duration:.08,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.3},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{turbulence:{start:.4,peak:.7,end:.3,curve:"fadeOut"}},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},rotate:[{axis:"x",rotations:2,phase:0},{axis:"y",rotations:-3,phase:40},{axis:"z",rotations:2.5,phase:100},{axis:"x",rotations:-2,phase:180},{axis:"y",rotations:3,phase:250}],scaleVariance:.2,lifetimeVariance:.1,blending:"normal",renderOrder:12,atmospherics:[{preset:"spray",targets:null,anchor:"around",intensity:.5,sizeScale:.8,burstCount:12,progressCurve:"burst",velocityInheritance:.7}]}},wobbleFrequency:10,wobbleAmplitude:.012,glowColor:[.2,.5,1],glowIntensityMin:1.2,glowIntensityMax:2,glowPulseRate:8,scaleWobble:.015,scaleFrequency:4,scaleGrowth:.02}),Vi=Mi({name:"waterimpact",emoji:"üí•",type:"blending",description:"Water orbits then crashes inward with impact",duration:1500,beats:4,intensity:1.5,category:"transform",turbulence:.8,spawnMode:{type:"orbit",orbit:{height:"above",endHeight:"center",radius:3.5,endRadius:.1,speed:3,easing:"easeOut",startScale:.4,endScale:1.8,orientation:"vertical"},formation:{type:"ring",count:7},count:7,scale:1.4,models:["bubble-cluster","wave-curl"],animation:{appearAt:0,disappearAt:.6,stagger:.02,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"burst-fade",duration:.05,easing:"easeOut",burstScale:.2},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{turbulence:{start:.3,peak:.9,end:.85,curve:"fadeIn"}},pulse:{amplitude:.12,frequency:8,easing:"easeInOut"},emissive:{min:1,max:3,frequency:9,pattern:"sine"},rotate:[{axis:"z",rotations:-4,phase:0},{axis:"x",rotations:3.5,phase:50},{axis:"y",rotations:-3,phase:100},{axis:"z",rotations:4,phase:155},{axis:"x",rotations:-3.5,phase:210},{axis:"y",rotations:3,phase:260},{axis:"z",rotations:-4.5,phase:315}],scaleVariance:.2,lifetimeVariance:.08,blending:"normal",renderOrder:12,atmospherics:[{preset:"spray",targets:null,anchor:"around",intensity:.8,sizeScale:1,burstCount:15,progressCurve:"burst",velocityInheritance:.7}]}},wobbleFrequency:12,wobbleAmplitude:.018,glowColor:[.15,.45,1],glowIntensityMin:1.6,glowIntensityMax:2.8,glowPulseRate:12,scaleWobble:.025,scaleFrequency:6,scaleContract:.05,tremor:.018,tremorFrequency:9}),$i=Mi({name:"watercrush",emoji:"üåä",type:"blending",description:"Walls of water crushing inward on mascot",duration:1200,beats:2,intensity:1.4,category:"impact",turbulence:.7,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"center",easing:"linear",startScale:2.2,endScale:.3,startDiameter:2.5,endDiameter:.5,orientation:"camera"},formation:{type:"stack",count:3,spacing:.35},count:3,scale:1.4,models:["splash-ring"],animation:{appearAt:0,disappearAt:.75,stagger:.06,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"burst-fade",duration:.1,easing:"easeIn",burstScale:.3},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{turbulence:{start:.3,peak:.8,end:.9,curve:"fadeIn"}},cutout:{strength:.5,primary:{pattern:0,scale:1.3,weight:1},secondary:{pattern:3,scale:.6,weight:.6},blend:"multiply",travel:"radial",travelSpeed:1.5,strengthCurve:"fadeIn",trailDissolve:{enabled:!0,offset:-.3,softness:1.4}},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},pulse:{amplitude:.08,frequency:4,easing:"easeInOut"},blending:"additive",renderOrder:10,modelOverrides:{"splash-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.4,arcCount:1},orientationOverride:"camera"}},atmospherics:[{preset:"spray",targets:null,anchor:"above",intensity:1,sizeScale:1.2,burstCount:30,progressCurve:"burst",velocityInheritance:.4}]}},{type:"radial-burst",radialBurst:{count:6,radius:.05,endRadius:.5,angleSpread:360,startAngle:0,orientation:"camera",startScale:.15,endScale:.7,scaleEasing:"easeOutQuad"},count:6,scale:.5,models:["bubble-cluster"],animation:{appearAt:.35,disappearAt:.75,stagger:.01,enter:{type:"scale",duration:.04,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.4,primary:{pattern:0,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:1,strengthCurve:"fadeOut"},scaleVariance:.3,lifetimeVariance:.15,blending:"additive",renderOrder:12,modelOverrides:{"bubble-cluster":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}}],wobbleFrequency:4,wobbleAmplitude:.025,wobbleDecay:.3,scaleWobble:.03,scaleFrequency:3,scaleContract:.06,glowColor:[.1,.35,.9],glowIntensityMin:1,glowIntensityMax:2,glowPulseRate:4,tremor:.015,tremorFrequency:8});function Wi(e){return(43758.5453*Math.sin(e)%1+1)%1}function Gi(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return Wi(t)*(1-a)+Wi(t+1)*a}function Li(e){return{name:e.name,emoji:e.emoji,type:e.type,description:e.description,config:{duration:e.duration,beats:e.beats,intensity:e.intensity,...e},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:1.8,offBeat:1,curve:"radiating"===e.category?"smooth":"sharp"}},"3d":{evaluate(t,i){const a=e["3d"]?.evaluate,s=a?a(t,i):null,n={...e,...i},r=t*n.duration/1e3,o="radiating"===n.category;let l=1;if(n.buildupPhase&&t<n.buildupPhase&&(l=t/n.buildupPhase,l=Math.pow(l,1.5)),n.burstPhase&&t>=n.buildupPhase){const e=(t-n.buildupPhase)/n.burstPhase;l=e<.3?1+3.33*e:2*(1-(e-.3)/.7)}t>1-n.flickerDecay&&(l*=1-(t-(1-n.flickerDecay))/n.flickerDecay);let h=0,c=0,u=0;if(n.flickerAmplitude>0){const e=r*n.flickerFrequency;if(h=(Gi(e)-.5+.4*(Gi(2.1*e+50)-.5))*n.flickerAmplitude*l,c=(Gi(e+33)-.5+.5*(Gi(1.8*e+83)-.5))*n.flickerAmplitude*l,u=(Gi(e+66)-.5)*n.flickerAmplitude*l*.5,n.burstJitter&&t>=n.buildupPhase){const e=l>1?l:0;h+=(Gi(50*r)-.5)*n.burstJitter*e,c+=(Gi(50*r+100)-.5)*n.burstJitter*e,u+=(Gi(50*r+200)-.5)*n.burstJitter*e*.5}}n.riseAmount&&(c+=n.riseAmount*l),n.hover&&n.hoverAmount&&(c+=Math.sin(r*Math.PI*.5)*n.hoverAmount*l);let d=1;const p=r*n.scaleFrequency;if(n.scalePulse?(d=1+(.5*Math.sin(p*Math.PI*2)+.5)*n.scaleVibration*l,n.scaleGrowth&&(d+=n.scaleGrowth*l)):d=1+(.5*Math.sin(p*Math.PI*2)+.3*Math.sin(p*Math.PI*3.3))*n.scaleVibration*l,n.heatExpansion&&(d+=n.heatExpansion*l),n.scaleBurst&&t>=n.buildupPhase){const e=l>1?l-1:0;d+=n.scaleBurst*e}const g=r*n.glowFlickerRate;let m;m=o?.3*Math.sin(g*Math.PI*2)+.7:.3*Math.sin(g*Math.PI*2)+.2*Math.sin(g*Math.PI*4.7+1.3)+.4*(Wi(Math.floor(3*g))>.6?1:0)+.5;const y=n.glowIntensityMin+(n.glowIntensityMax-n.glowIntensityMin)*m*l,f=(.7*m+.3)*l*n.intensity,b=s?.rotation||[0,0,0];return{position:[h,c,u],rotation:[b[0]||0,b[1]||0,b[2]||0],scale:d,glowIntensity:y,glowBoost:f,glowColorOverride:n.glowColor,fireOverlay:{enabled:l>.1,strength:l*n.intensity,heat:l*n.intensity,temperature:n.temperature,category:n.category,spawnMode:n.spawnMode||null,duration:n.duration,progress:t,time:r,animation:e.spawnMode?.animation,models:e.spawnMode?.models,count:e.spawnMode?.count,scale:e.spawnMode?.scale,embedDepth:e.spawnMode?.embedDepth}}}}}}var _i=Li({name:"burn",emoji:"üî•",type:"blending",description:"Flames flickering across surface, being consumed",duration:2500,beats:4,intensity:1,category:"burning",temperature:.6,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.15,cameraFacing:.3,clustering:.25,count:8,scale:1.25,models:["flame-wisp","flame-tongue"],minDistance:.12,animation:{appearAt:.05,disappearAt:.85,stagger:.03,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.15},procedural:{scaleSmoothing:.08,geometryStability:!0},gestureGlow:{baseGlow:.8,peakGlow:2.5,curve:"easeIn"},parameterAnimation:{temperature:{start:.4,peak:.65,end:.35,curve:"bell"}},flicker:{intensity:.35,rate:12,pattern:"random"},pulse:{amplitude:.15,frequency:8,easing:"easeInOut"},emissive:{min:.8,max:2,frequency:10,pattern:"sine"},cutout:{strength:.7,primary:{pattern:5,scale:2,weight:1},secondary:{pattern:4,scale:1.5,weight:.5},blend:"multiply",travel:"radial",travelSpeed:2.5,strengthCurve:"fadeIn",fadeInDuration:.4,trailDissolve:{offset:-.15,softness:.3},geometricMask:{type:"distance",core:.08,tip:.18}},grain:{type:3,strength:.04,scale:.1,speed:.5,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.8,progressCurve:"sustain"}],drift:{direction:"up",distance:.12,noise:.025},scaleVariance:.35,lifetimeVariance:.3,delayVariance:.1,blending:"additive",renderOrder:10,intensityScaling:{scale:1.3,pulseAmplitude:1.5,flickerIntensity:1.4,emissiveMax:1.6},modelOverrides:{"ember-cluster":{scaling:{mode:"uniform-pulse",amplitude:.2,frequency:4},drift:{direction:"rising",speed:.025,noise:.25,buoyancy:!0},opacityLink:"flicker"},"flame-wisp":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.7},y:{expand:!0,rate:1.6},z:{expand:!1,rate:.7}}},drift:{direction:"rising",speed:.03,noise:.15,buoyancy:!0},orientationOverride:"rising"},"flame-tongue":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.8,oscillate:!0},y:{expand:!0,rate:1.4},z:{expand:!1,rate:.8,oscillate:!0}},wobbleFrequency:5,wobbleAmplitude:.15},drift:{direction:"rising",speed:.025,noise:.2}}}}},flickerFrequency:12,flickerAmplitude:.015,flickerDecay:.2,glowColor:[1,.5,.1],glowIntensityMin:1.2,glowIntensityMax:2.5,glowFlickerRate:15,scaleVibration:.02,scaleFrequency:8,riseAmount:.01}),Hi=Li({name:"scorch",emoji:"ü´†",type:"blending",description:"Core meltdown, internal heat escaping",duration:1200,beats:3,intensity:1.3,category:"burning",temperature:.8,spawnMode:{type:"surface",pattern:"shell",embedDepth:.1,cameraFacing:.3,clustering:.2,count:12,scale:.9,models:["flame-wisp","ember-cluster"],minDistance:.12,animation:{appearAt:.05,disappearAt:.85,stagger:.03,enter:{type:"fade",duration:.12,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{temperature:{start:.5,peak:.8,end:.4,curve:"sustained"}},flicker:{intensity:.3,rate:12,pattern:"random"},emissive:{min:1.5,max:3,frequency:6,pattern:"sine"},cutout:{strength:.55,primary:{pattern:7,scale:1.5,weight:1},secondary:{pattern:5,scale:1.2,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,trailDissolve:{offset:-.1,softness:.25}},grain:{type:3,strength:.08,scale:.2,speed:.8,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain"}],drift:{speed:.3,distance:.3,direction:{x:0,y:1,z:0},easing:"easeOutCubic"},scaleVariance:.25,lifetimeVariance:.2,blending:"additive",renderOrder:12}},flickerFrequency:6,flickerAmplitude:.008,flickerDecay:.25,glowColor:[1,.8,.3],glowIntensityMin:1.5,glowIntensityMax:3.5,glowFlickerRate:8,scaleVibration:.01,scaleFrequency:3,heatExpansion:.03,shimmerEffect:!0,shimmerIntensity:.02}),Ui=Li({name:"combust",emoji:"üí•",type:"blending",description:"Building heat then sudden flame burst",duration:2e3,beats:4,intensity:1.5,category:"burning",temperature:.9,spawnMode:{type:"surface",pattern:"spikes",embedDepth:.1,cameraFacing:.35,clustering:.3,count:12,scale:1.2,models:["fire-burst","flame-tongue","ember-cluster"],minDistance:.08,animation:{appearAt:.55,disappearAt:.95,stagger:.01,enter:{type:"fade",duration:.03,easing:"easeOut"},exit:{type:"fade",duration:.1,easing:"easeInCubic"},procedural:{scaleSmoothing:.06,geometryStability:!0},parameterAnimation:{temperature:{start:.5,peak:.95,end:.6,curve:"spike"}},flicker:{intensity:.5,rate:25,pattern:"random"},pulse:{amplitude:.25,frequency:15,easing:"easeOut"},emissive:{min:1.5,max:4,frequency:20,pattern:"sine"},cutout:{strength:.75,primary:{pattern:3,scale:2.5,weight:1},secondary:{pattern:8,scale:2,weight:.6},blend:"multiply",travel:"radial",travelSpeed:6,strengthCurve:"fadeIn",fadeInDuration:.15,geometricMask:{type:"tip-boost",core:0,tip:.2}},grain:{type:2,strength:.15,scale:.1,speed:4,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain"}],drift:{direction:"outward",distance:.15,noise:.02},scaleVariance:.4,lifetimeVariance:.25,delayVariance:.05,blending:"additive",renderOrder:15,intensityScaling:{scale:1.5,emissiveMax:2,flickerIntensity:1.6,driftSpeed:1.4},scalePerElement:[1,.5,1.3,.6,1.5,.4,1.2,.7,1.4,.55,1.1,.65],modelOverrides:{"fire-burst":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.8},y:{expand:!0,rate:2},z:{expand:!0,rate:1.8}}},drift:{direction:"outward",speed:.06,noise:.15},opacityLink:"inverse-scale"},"flame-tongue":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.4,oscillate:!0},y:{expand:!0,rate:1.6},z:{expand:!0,rate:1.4,oscillate:!0}},wobbleFrequency:8,wobbleAmplitude:.2},drift:{direction:"outward",speed:.04,noise:.1}},"ember-cluster":{drift:{direction:"outward",speed:.05,noise:.3},opacityLink:"flicker"}}}},buildupPhase:.6,burstPhase:.4,flickerFrequency:20,flickerAmplitude:.025,flickerDecay:.15,glowColor:[1,.6,.2],glowIntensityMin:.8,glowIntensityMax:4,glowFlickerRate:25,scaleVibration:.03,scaleFrequency:15,scaleBurst:.08,burstJitter:.03}),Qi=Li({name:"radiate",emoji:"‚òÄÔ∏è",type:"blending",description:"Expanding flame rings radiating outward",duration:1500,beats:4,intensity:.8,category:"radiating",temperature:.4,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"bottom",easing:"linear",startScale:1.2,endScale:1.8,startDiameter:1.2,endDiameter:3.5,orientation:"vertical"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["flame-ring"],animation:{appearAt:.02,disappearAt:.85,stagger:.03,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.13,easing:"easeOutQuad"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{temperature:{start:.7,peak:.6,end:.35,curve:"linear"}},flicker:{intensity:.25,rate:10,pattern:"smooth"},pulse:{amplitude:.12,frequency:3,easing:"easeInOut"},emissive:{min:1.2,max:2.8,frequency:4,pattern:"sine"},cutout:{strength:.6,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:6,scale:1.5,weight:.4},blend:"add",travel:"radial",travelSpeed:2,geometricMask:{type:"distance",core:.1,tip:.25}},grain:{type:3,strength:.05,scale:.15,speed:1,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain"}],rotate:[{axis:"y",rotations:1.5,phase:0},{axis:"y",rotations:1.5,phase:120},{axis:"y",rotations:1.5,phase:240}],scaleVariance:.1,lifetimeVariance:.05,blending:"additive",renderOrder:8,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.8,arcSpeed:.8,arcCount:1},orientationOverride:"vertical"}}}},{type:"radial-burst",radialBurst:{startRadius:.1,endRadius:1.2,height:0,easing:"easeOutExpo"},formation:{type:"ring",count:6,startAngle:0},count:6,scale:1,models:["flame-tongue","fire-burst","flame-tongue","fire-burst","flame-tongue","fire-burst"],animation:{appearAt:.45,disappearAt:.8,stagger:.02,enter:{type:"scale",duration:.08,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.2,easing:"easeInCubic",burstScale:1.3},procedural:{scaleSmoothing:.06,geometryStability:!0},parameterAnimation:{temperature:{start:.7,peak:.95,end:.5,curve:"bell"}},flicker:{intensity:.4,rate:18,pattern:"random"},pulse:{amplitude:.15,frequency:8,easing:"easeOut"},emissive:{min:2,max:4,frequency:10,pattern:"sine"},cutout:{strength:.7,primary:{pattern:2,scale:2.5,weight:1},secondary:{pattern:5,scale:1.5,weight:.6},blend:"multiply",travel:"radial",travelSpeed:4,geometricMask:{type:"tip-boost",core:0,tip:.15}},scalePerElement:[1,.8,1.1,.75,.95,.85],blending:"additive",renderOrder:12}}],flickerFrequency:8,flickerAmplitude:.01,flickerDecay:.2,glowColor:[1,.7,.3],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:6,scaleVibration:.015,scaleFrequency:3,scaleGrowth:.02,rotationEffect:!0,rotationSpeed:.3}),Yi=Li({name:"blaze",emoji:"üîÜ",type:"blending",description:"Flagship fire aura with pulsing flame star",duration:1800,beats:3,intensity:1.3,category:"radiating",temperature:.75,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"feet",end:"center",easing:"easeOut",startScale:1,endScale:.7,startDiameter:.8,endDiameter:1.4,orientation:"radial"},formation:{type:"spiral",count:6,spacing:.15,arcOffset:60,phaseOffset:0},count:6,scale:3,models:["ember-cluster","flame-wisp","ember-cluster","ember-cluster","flame-wisp","flame-wisp"],animation:{appearAt:0,disappearAt:.75,stagger:.12,staggerExit:.1,enter:{type:"scale",duration:.15,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.18,easing:"easeInCubic",burstScale:1.2},drift:{direction:"up",distance:.4,noise:.25},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{temperature:{start:.6,peak:.85,end:.5,curve:"bell"}},flicker:{intensity:.6,rate:30,pattern:"random"},pulse:{amplitude:.55,frequency:8,easing:"linear",perElement:!0},emissive:{min:2.5,max:8,frequency:12,pattern:"random"},cutout:{strength:.55,primary:{pattern:7,scale:.8,weight:1},secondary:{pattern:5,scale:1.2,weight:.6},blend:"multiply",travel:"radial",travelSpeed:6,strengthCurve:"bell",bellPeakAt:.6,bellWidth:.4,geometricMask:{type:"tip-boost",core:0,tip:.15}},grain:{type:3,strength:.03,scale:.1,speed:.3,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.8,progressCurve:"sustain"}],rotate:[{axis:"y",rotations:2.3,phase:0},{axis:"y",rotations:-1.7,phase:67},{axis:"y",rotations:3.1,phase:155},{axis:"y",rotations:-2.2,phase:98},{axis:"y",rotations:1.4,phase:233},{axis:"y",rotations:-2.8,phase:301}],scalePerElement:[1.6,.65,1.4,.7,1.5,.68],blending:"additive",renderOrder:16}}],flickerFrequency:4,flickerAmplitude:.008,flickerDecay:.2,glowColor:[1,.55,.12],glowIntensityMin:1.5,glowIntensityMax:3,glowFlickerRate:5,scaleVibration:.015,scaleFrequency:2,scalePulse:!0,scaleGrowth:.03,hover:!0,hoverAmount:.01}),Xi=Li({name:"flame-vortex",emoji:"üåÄ",type:"blending",description:"Fire tornado spiraling around mascot",duration:1500,beats:5,intensity:1.4,category:"burning",temperature:.75,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.4,endScale:1.7,startDiameter:.6,endDiameter:1.2,orientation:"flat"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["flame-ring"],animation:{appearAt:.05,disappearAt:.9,stagger:.02,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.12,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{temperature:{start:.5,peak:.8,end:.6,curve:"bell"}},flicker:{intensity:.4,rate:18,pattern:"random"},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1,max:2.5,frequency:8,pattern:"sine"},cutout:{strength:.7,primary:{pattern:6,scale:2.5,weight:1},secondary:{pattern:4,scale:1.8,weight:.5},blend:"add",travel:"spiral",travelSpeed:4,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.5,geometricMask:{type:"distance",core:.1,tip:.25}},grain:{type:2,strength:.12,scale:.15,speed:2.5,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.8,progressCurve:"sustain"}],scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:12,intensityScaling:{scale:1.4,emissiveMax:1.6,pulseAmplitude:1.3},modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:6,arcCount:1},scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.1},y:{expand:!1,rate:.3},z:{expand:!0,rate:1.1}}},orientationOverride:"flat"}}}},flickerFrequency:15,flickerAmplitude:.01,flickerDecay:.15,glowColor:[1,.55,.15],glowIntensityMin:1.3,glowIntensityMax:2.8,glowFlickerRate:12,scaleVibration:.02,scaleFrequency:4,scaleGrowth:.03,rotationEffect:!0,rotationSpeed:.5}),Ni=Li({name:"firedance",emoji:"üíÉ",type:"blending",description:"Vertical flame rings dancing and rising",duration:1500,beats:3,intensity:1.3,category:"radiating",temperature:.7,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.4,endScale:1.8,startDiameter:1.3,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["flame-ring"],animation:{appearAt:.02,disappearAt:.5,stagger:.02,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{temperature:{start:.5,peak:.75,end:.55,curve:"bell"}},flicker:{intensity:.35,rate:14,pattern:"random"},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},cutout:{strength:.75,primary:{pattern:6,scale:2,weight:1},secondary:{pattern:7,scale:1.5,weight:.6},blend:"add",travel:"spiral",travelSpeed:2.5,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.12,tip:.28}},grain:{type:3,strength:.06,scale:.15,speed:1,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain",velocityInheritance:.4,centrifugal:{speed:.5,tangentialBias:.5}}],rotate:[{axis:"y",rotations:2,phase:0},{axis:"y",rotations:-2,phase:60},{axis:"y",rotations:3,phase:120}],scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:11,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}}}},flickerFrequency:12,flickerAmplitude:.012,flickerDecay:.15,glowColor:[1,.5,.15],glowIntensityMin:1.2,glowIntensityMax:2.5,glowFlickerRate:10,scaleVibration:.018,scaleFrequency:4,scaleGrowth:.025,rotationEffect:!0,rotationSpeed:.4}),Ji=Li({name:"phoenix",emoji:"ü¶Ö",type:"blending",description:"Ascending fire vortex - mixed flames spiral upward in rebirth",duration:4e3,beats:4,intensity:1.7,category:"radiating",temperature:.85,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:1,endScale:1.8,startDiameter:1.8,endDiameter:2.8,orientation:"rising"},formation:{type:"spiral",count:7,strands:2,spacing:.2,arcOffset:51,phaseOffset:.1},count:7,scale:1.1,models:["flame-wisp","ember-cluster","flame-tongue","flame-tongue","flame-tongue","fire-burst","fire-burst"],animation:{appearAt:0,disappearAt:.75,stagger:.08,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.35,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},parameterAnimation:{temperature:{start:.5,peak:.95,end:.7,curve:"bell"}},flicker:{intensity:.3,rate:12,pattern:"smooth"},pulse:{amplitude:.15,frequency:4,easing:"easeInOut"},emissive:{min:1.2,max:4,frequency:6,pattern:"sine"},cutout:{strength:.65,primary:{pattern:7,scale:1.5,weight:1},secondary:{pattern:5,scale:2,weight:.5},blend:"add",travel:"angular",travelSpeed:2,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.5,geometricMask:{type:"distance",core:.1,tip:.3}},grain:{type:0,strength:.1,scale:.25,speed:1.5,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.8,progressCurve:"sustain"}],rotate:{axis:"y",rotations:1.5,phase:0},scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:14,modelOverrides:{"flame-wisp":{scaleMultiplier:1.2,orientationOverride:"rising"},"ember-cluster":{scaleMultiplier:1,orientationOverride:"rising"},"flame-tongue":{scaleMultiplier:1.4,orientationOverride:"rising"},"fire-burst":{scaleMultiplier:1.3,orientationOverride:"camera"}}}},flickerFrequency:10,flickerAmplitude:.015,flickerDecay:.12,glowColor:[1,.6,.2],glowIntensityMin:1.4,glowIntensityMax:3.5,glowFlickerRate:8,scaleVibration:.02,scaleFrequency:3,scaleGrowth:.04,rotationEffect:!0,rotationSpeed:.35}),Zi=Li({name:"fireflourish",emoji:"‚öîÔ∏è",type:"blending",description:"Spinning sword flourish with fire trail",duration:1200,beats:4,intensity:1.3,category:"radiating",temperature:.65,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.7,endScale:1.2,startDiameter:1.8,endDiameter:2.8,orientation:"camera"},formation:{type:"spiral",count:5,spacing:0,arcOffset:72,phaseOffset:.05,zOffset:.02},count:5,scale:.9,models:["flame-ring"],animation:{appearAt:0,disappearAt:.45,stagger:.12,enter:{type:"fade",duration:.03,easing:"easeOut"},exit:{type:"burst-fade",duration:.85,easing:"easeIn",burstScale:1.15},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{temperature:{start:.65,peak:.95,end:.3,curve:"bell"}},flicker:{intensity:.2,rate:10,pattern:"sine"},pulse:{amplitude:.15,frequency:5,easing:"easeInOut",perElement:!0},emissive:{min:2,max:5,frequency:6,pattern:"sine",decayOnExit:!0,perElementScale:[1,.95,.88,.8,.72]},grain:{type:0,strength:.35,scale:.3,speed:2,blend:"multiply"},atmospherics:[{preset:"smoke",targets:["flame-ring"],anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain",velocityInheritance:.4}],cutout:{strength:.85,pattern:6,scale:2.5,travel:"spiral",travelSpeed:2},drift:{speed:.3,distance:.18,pattern:"radial",accelerate:!0},opacityGradient:[1,.9,.8,.7,.6],rotate:[{axis:"z",rotations:2.5,phase:0},{axis:"z",rotations:-2,phase:72},{axis:"z",rotations:1.8,phase:144},{axis:"z",rotations:-2.3,phase:216},{axis:"z",rotations:2,phase:288}],tilt:{axis:"y",oscillate:!0,range:.4,speed:3.5},wobble:{axis:"x",oscillate:!0,range:.15,speed:2,phase:90},scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:12,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1,arcCount:2},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:-.8,y:.5,z:.3},orientation:"camera",startScale:.3,endScale:1.4,scaleEasing:"easeOutCubic"},count:1,scale:1,models:["flame-tongue"],animation:{appearAt:.15,disappearAt:.55,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.35,easing:"easeOutQuad"},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{temperature:{start:.8,peak:.95,end:.4,curve:"bell"}},flicker:{intensity:.3,rate:15,pattern:"random"},emissive:{min:2.5,max:4.5,frequency:8,pattern:"sine"},drift:{speed:.8,distance:.4,direction:{x:1.2,y:-.8,z:-.2},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:.5,phase:-45}],blending:"additive",renderOrder:14}},{type:"anchor",anchor:{landmark:"center",offset:{x:.8,y:.5,z:.3},orientation:"camera",startScale:.3,endScale:1.4,scaleEasing:"easeOutCubic"},count:1,scale:1,models:["flame-tongue"],animation:{appearAt:.15,disappearAt:.55,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.35,easing:"easeOutQuad"},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{temperature:{start:.8,peak:.95,end:.4,curve:"bell"}},flicker:{intensity:.3,rate:15,pattern:"random"},emissive:{min:2.5,max:4.5,frequency:8,pattern:"sine"},drift:{speed:.8,distance:.4,direction:{x:-1.2,y:-.8,z:-.2},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:.5,phase:45}],blending:"additive",renderOrder:14}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.2},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:.9,models:["flame-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{temperature:{start:.7,peak:.9,end:.35,curve:"bell"}},flicker:{intensity:.25,rate:12,pattern:"smooth"},emissive:{min:2,max:4,frequency:6,pattern:"sine"},rotate:[{axis:"z",rotations:.001,phase:45}],blending:"additive",renderOrder:10,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.2},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:.9,models:["flame-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{temperature:{start:.7,peak:.9,end:.35,curve:"bell"}},flicker:{intensity:.25,rate:12,pattern:"smooth"},emissive:{min:2,max:4,frequency:6,pattern:"sine"},rotate:[{axis:"z",rotations:.001,phase:-45}],blending:"additive",renderOrder:10,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}}],flickerFrequency:15,flickerAmplitude:.01,flickerDecay:.15,glowColor:[1,.55,.15],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:12,scaleVibration:.012,scaleFrequency:8,scaleGrowth:.015,rotationEffect:!1}),Ki=Li({name:"firecrown",emoji:"üëë",type:"blending",description:"Majestic flame crown above the head",duration:3e3,beats:4,intensity:1,category:"radiating",temperature:.65,spawnMode:{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.05,z:0},orientation:"flat",bob:{amplitude:.02,frequency:.3}},count:1,scale:1.2,models:["flame-ring"],animation:{appearAt:0,disappearAt:.75,stagger:0,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},cutout:{strength:.65,primary:{pattern:5,scale:1.5,weight:1},secondary:{pattern:6,scale:2,weight:.4},blend:"add",travel:"angular",travelSpeed:1.5,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.6,geometricMask:{type:"distance",core:.15,tip:.3}},grain:{type:0,strength:.35,scale:.25,speed:1.5,blend:"multiply"},parameterAnimation:{temperature:{start:.5,peak:.7,end:.6,curve:"bell"}},flicker:{intensity:.15,rate:8,pattern:"sine"},pulse:{amplitude:.06,frequency:2,easing:"easeInOut"},emissive:{min:1.2,max:2,frequency:3,pattern:"sine"},atmospherics:[{preset:"smoke",targets:["flame-ring"],anchor:"above",intensity:.25,sizeScale:.8,progressCurve:"sustain"}],rotate:{axis:"z",rotations:1,phase:0},scaleVariance:0,lifetimeVariance:0,blending:"additive",renderOrder:15,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.8,arcCount:3}}}}},flickerFrequency:6,flickerAmplitude:.006,flickerDecay:.25,glowColor:[1,.7,.3],glowIntensityMin:.9,glowIntensityMax:1.4,glowFlickerRate:5,scaleVibration:.008,scaleFrequency:3,scaleGrowth:.01,rotationEffect:!1}),ea=Li({name:"firemeditation",emoji:"üßò",type:"blending",description:"Meditative flame rings with breathing pulse",duration:4e3,beats:4,intensity:.7,category:"radiating",temperature:.5,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"easeInOut",startScale:1,endScale:1,startDiameter:1.8,endDiameter:1.8,orientation:"camera"},formation:{type:"mandala",count:5,radius:.5,arcOffset:45,scales:[1,.6,.6,.6,.6]},count:5,scale:1.2,models:["flame-ring"],animation:{appearAt:0,disappearAt:.8,stagger:0,enter:{type:"fade",duration:.5,easing:"easeInOut"},exit:{type:"fade",duration:.4,easing:"easeInOut"},procedural:{scaleSmoothing:.15,geometryStability:!0},parameterAnimation:{temperature:{start:.4,peak:.55,end:.45,curve:"sine"}},flicker:{intensity:.08,rate:4,pattern:"sine"},pulse:{amplitude:.15,frequency:1.5,easing:"easeInOut"},emissive:{min:.9,max:1.5,frequency:1.5,pattern:"sine"},cutout:{strength:.6,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:6,scale:1.5,weight:.5},blend:"add",travel:"angular",travelSpeed:.6,strengthCurve:"bell",bellPeakAt:.5,bellWidth:1,geometricMask:{type:"distance",core:.1,tip:.3}},grain:{type:2,strength:.5,scale:.5,speed:.5,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:1,speedScale:.6,progressCurve:"sustain"}],rotate:[{axis:"z",rotations:.4,phase:0},{axis:"z",rotations:-.35,phase:0},{axis:"z",rotations:.25,phase:0},{axis:"z",rotations:-.35,phase:0},{axis:"z",rotations:.4,phase:0}],scaleVariance:0,lifetimeVariance:0,blending:"additive",renderOrder:-5,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.5,arcCount:2},orientationOverride:"camera"}}}},flickerFrequency:4,flickerAmplitude:.004,flickerDecay:.4,glowColor:[1,.65,.3],glowIntensityMin:.7,glowIntensityMax:1.1,glowFlickerRate:3,scaleVibration:.004,scaleFrequency:1.5,scaleGrowth:0,rotationEffect:!1}),ta=Li({name:"firedrill",emoji:"üî©",type:"blending",description:"Fast tight ascending flame helix",duration:1200,beats:2,intensity:1.5,category:"radiating",temperature:.8,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"feet",end:"below",easing:"easeIn",startScale:1,endScale:.8,startDiameter:1.8,endDiameter:1.4,orientation:"vertical"},formation:{type:"spiral",count:6,spacing:.1,arcOffset:60,phaseOffset:0},count:6,scale:.8,models:["flame-ring"],animation:{appearAt:0,disappearAt:.6,stagger:.03,enter:{type:"fade",duration:.05,easing:"linear"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{temperature:{start:.6,peak:.9,end:.7,curve:"bell"}},flicker:{intensity:.4,rate:25,pattern:"random"},pulse:{amplitude:.08,frequency:10,easing:"linear"},emissive:{min:1.5,max:3.5,frequency:12,pattern:"random"},cutout:{strength:.85,primary:{pattern:8,scale:2.5,weight:1},secondary:{pattern:3,scale:3,weight:.7},blend:"multiply",travel:"oscillate",travelSpeed:5,geometricMask:{type:"distance",core:.08,tip:.2},trailDissolve:{offset:.1,softness:.25}},grain:{type:2,strength:.1,scale:.1,speed:3,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:1,tangentialBias:.3}}],rotate:{axis:"y",rotations:4,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"additive",renderOrder:16,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:3,arcCount:1},orientationOverride:"vertical"}}}},flickerFrequency:20,flickerAmplitude:.015,flickerDecay:.1,glowColor:[1,.4,.1],glowIntensityMin:1.3,glowIntensityMax:2.8,glowFlickerRate:18,scaleVibration:.02,scaleFrequency:8,scaleGrowth:.03,rotationEffect:!0,rotationSpeed:.8});const ia={appearAt:0,disappearAt:.7,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},parameterAnimation:{temperature:{start:.55,peak:.8,end:.65,curve:"bell"}},flicker:{intensity:.12,rate:8,pattern:"sine"},pulse:{amplitude:.05,frequency:3,easing:"easeInOut"},emissive:{min:1.3,max:2.5,frequency:4,pattern:"sine"},grain:{type:2,strength:.5,scale:.15,speed:2.5,blend:"multiply"},atmospherics:[{preset:"smoke",targets:["flame-ring"],anchor:"above",intensity:.4,sizeScale:1,progressCurve:"sustain",velocityInheritance:.5}],scaleVariance:.03,lifetimeVariance:.02,blending:"additive",renderOrder:15,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.8,arcCount:3}}}};var aa=Li({name:"firepillar",emoji:"üèõÔ∏è",type:"blending",description:"Majestic rising pillar of flame",duration:3e3,beats:4,intensity:1.3,category:"radiating",temperature:.7,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:0},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1,models:["flame-ring"],animation:{...ia,stagger:.03,cutout:{strength:.6,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:7,scale:1.5,weight:.4},blend:"add",travel:"angular",travelSpeed:1.2,strengthCurve:"fadeIn",fadeInDuration:.3,geometricMask:{type:"distance",core:.1,tip:.25}},rotate:[{axis:"z",rotations:.3,phase:0},{axis:"z",rotations:.3,phase:180}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:.5},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1,models:["flame-ring"],animation:{...ia,stagger:.05,cutout:{strength:.65,primary:{pattern:7,scale:1.8,weight:1},secondary:{pattern:5,scale:1.5,weight:.5},blend:"multiply",travel:"radial",travelSpeed:1.8,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.5,geometricMask:{type:"tip-boost",core:0,tip:.2}},rotate:[{axis:"z",rotations:-.6,phase:60},{axis:"z",rotations:-.6,phase:240}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:1},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1,models:["flame-ring"],animation:{...ia,stagger:.07,cutout:{strength:.7,primary:{pattern:5,scale:1.5,weight:1},secondary:{pattern:6,scale:2,weight:.4},blend:"add",travel:"oscillate",travelSpeed:2.5,strengthCurve:"fadeOut",fadeOutDuration:.4,geometricMask:{type:"distance",core:.15,tip:.3}},rotate:[{axis:"z",rotations:.9,phase:90},{axis:"z",rotations:.9,phase:270}]}}],flickerFrequency:6,flickerAmplitude:.006,flickerDecay:.25,glowColor:[1,.65,.25],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:5,scaleVibration:.008,scaleFrequency:3,scaleGrowth:.025,rotationEffect:!1}),sa=Li({name:"firehelix",emoji:"üß¨",type:"blending",description:"DNA-style double helix ascending flame",duration:2e3,beats:4,intensity:1.2,category:"radiating",temperature:.7,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeInOut",startScale:.9,endScale:1.1,startDiameter:1.8,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:6,strands:2,spacing:.2,arcOffset:120,phaseOffset:.05},count:6,scale:.7,models:["flame-ring"],animation:{appearAt:0,disappearAt:.7,stagger:.06,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{temperature:{start:.5,peak:.8,end:.6,curve:"bell"}},flicker:{intensity:.25,rate:12,pattern:"smooth"},pulse:{amplitude:.06,frequency:4,easing:"easeInOut"},emissive:{min:1.2,max:2.5,frequency:6,pattern:"smooth"},cutout:{strength:.8,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:6,scale:1.8,weight:.6},blend:"max",travel:"angular",travelSpeed:3,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.1,tip:.25}},grain:{type:0,strength:.08,scale:.2,speed:1.5,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:.8,tangentialBias:.4}}],rotate:{axis:"y",rotations:2,phase:0},scaleVariance:.1,lifetimeVariance:.1,blending:"additive",renderOrder:16,modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}}}},flickerFrequency:10,flickerAmplitude:.012,flickerDecay:.15,glowColor:[1,.5,.2],glowIntensityMin:1.1,glowIntensityMax:2.2,glowFlickerRate:8,scaleVibration:.015,scaleFrequency:5,scaleGrowth:.02,rotationEffect:!0,rotationSpeed:.4}),na=Li({name:"firebarrage",emoji:"üèπ",type:"blending",description:"Fire orbits mascot then launches upward",duration:1500,beats:4,intensity:1.4,category:"radiating",temperature:.8,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"above",radius:1.2,endRadius:2.8,speed:3,easing:"easeIn",startScale:1,endScale:.6,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.8,models:["flame-wisp","flame-tongue","ember-cluster"],animation:{appearAt:0,disappearAt:.65,stagger:.04,enter:{type:"scale",duration:.08,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.3},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{temperature:{start:.6,peak:.9,end:.4,curve:"fadeOut"}},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.25,sizeScale:.6,progressCurve:"sustain",velocityInheritance:.7}],rotate:[{axis:"x",rotations:2,phase:0},{axis:"y",rotations:-3,phase:40},{axis:"z",rotations:2.5,phase:100},{axis:"x",rotations:-2,phase:180},{axis:"y",rotations:3,phase:250}],scaleVariance:.2,lifetimeVariance:.1,blending:"additive",renderOrder:12}},flickerFrequency:14,flickerAmplitude:.012,glowColor:[1,.5,.15],glowIntensityMin:1.2,glowIntensityMax:2,glowFlickerRate:8,scaleVibration:.015,scaleFrequency:4,scaleGrowth:.02}),ra=Li({name:"fireimpact",emoji:"üí•",type:"blending",description:"Fire orbits then crashes inward with impact",duration:1500,beats:4,intensity:1.5,category:"transform",temperature:.9,spawnMode:{type:"orbit",orbit:{height:"above",endHeight:"center",radius:3.5,endRadius:.1,speed:3,easing:"easeOut",startScale:.4,endScale:1.8,orientation:"vertical"},formation:{type:"ring",count:7},count:7,scale:1.4,models:["flame-wisp","flame-tongue","ember-cluster","fire-burst"],animation:{appearAt:0,disappearAt:.6,stagger:.02,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"burst-fade",duration:.05,easing:"easeOut",burstScale:.2},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{temperature:{start:.4,peak:.95,end:.9,curve:"fadeIn"}},pulse:{amplitude:.12,frequency:8,easing:"easeInOut"},emissive:{min:1,max:3,frequency:9,pattern:"sine"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain",velocityInheritance:.7}],rotate:[{axis:"z",rotations:-4,phase:0},{axis:"x",rotations:3.5,phase:50},{axis:"y",rotations:-3,phase:100},{axis:"z",rotations:4,phase:155},{axis:"x",rotations:-3.5,phase:210},{axis:"y",rotations:3,phase:260},{axis:"z",rotations:-4.5,phase:315}],scaleVariance:.2,lifetimeVariance:.08,blending:"additive",renderOrder:12}},flickerFrequency:18,flickerAmplitude:.018,glowColor:[1,.4,.1],glowIntensityMin:1.6,glowIntensityMax:2.8,glowFlickerRate:12,scaleVibration:.025,scaleFrequency:6,scaleContract:.05,tremor:.018,tremorFrequency:9}),oa=Li({name:"fireblast",emoji:"üí•",type:"blending",description:"Explosive fire blast with bursting flames and ember spray",duration:1e3,beats:2,intensity:1.3,category:"impact",temperature:.9,spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.1},orientation:"camera",startScale:.2,endScale:2,scaleEasing:"easeOutQuad"},count:1,scale:1.5,models:["flame-ring"],animation:{appearAt:0,disappearAt:.4,enter:{type:"scale",duration:.05,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.6,primary:{pattern:2,scale:1.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:1,strengthCurve:"fadeOut",trailDissolve:{enabled:!0,offset:-.25,softness:1.2}},grain:{type:3,strength:.5,scale:.3,speed:1.5,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.3,sizeScale:.8,progressCurve:"sustain"}],blending:"additive",renderOrder:8,rotate:{axis:"z",rotations:0,phase:0},modelOverrides:{"flame-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.3,endScale:1.6,scaleEasing:"easeOutQuad"},count:1,scale:1.2,models:["fire-burst"],animation:{appearAt:0,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.4,primary:{pattern:5,scale:1,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.4,distance:.8,direction:{x:0,y:1,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"fire-burst":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.25,endScale:1.3,scaleEasing:"easeOutQuad"},count:1,scale:1,models:["fire-burst"],animation:{appearAt:.02,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.45,primary:{pattern:5,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:.6,strengthCurve:"fadeOut"},drift:{speed:1.3,distance:.75,direction:{x:-.7,y:.85,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"fire-burst":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.25,endScale:1.3,scaleEasing:"easeOutQuad"},count:1,scale:1,models:["fire-burst"],animation:{appearAt:.02,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.45,primary:{pattern:5,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:.6,strengthCurve:"fadeOut"},drift:{speed:1.3,distance:.75,direction:{x:.7,y:.85,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"fire-burst":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:1.1,scaleEasing:"easeOutQuad"},count:1,scale:.85,models:["fire-burst"],animation:{appearAt:.03,disappearAt:.45,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.18,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.4,primary:{pattern:5,scale:1.2,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.1,distance:.6,direction:{x:-.95,y:.5,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:11,modelOverrides:{"fire-burst":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:1.1,scaleEasing:"easeOutQuad"},count:1,scale:.85,models:["fire-burst"],animation:{appearAt:.03,disappearAt:.45,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.18,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.4,primary:{pattern:5,scale:1.2,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.1,distance:.6,direction:{x:.95,y:.5,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:11,modelOverrides:{"fire-burst":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:8,radius:.05,endRadius:.65,angleSpread:360,startAngle:22,orientation:"camera",startScale:.2,endScale:.9,scaleEasing:"easeOutQuad"},count:8,scale:.6,models:["flame-tongue"],animation:{appearAt:.02,disappearAt:.4,stagger:.008,enter:{type:"scale",duration:.03,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},cutout:{strength:.35,primary:{pattern:5,scale:.7,weight:1},blend:"multiply",travel:"radial",travelSpeed:.8,strengthCurve:"fadeOut"},rotate:{axis:"z",rotations:0,phase:0},scaleVariance:.3,lifetimeVariance:.15,blending:"additive",renderOrder:14,modelOverrides:{"flame-tongue":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:12,radius:.03,endRadius:.5,angleSpread:360,startAngle:0,orientation:"camera",startScale:.1,endScale:.35,scaleEasing:"easeOutQuad"},count:12,scale:.2,models:["ember-cluster"],animation:{appearAt:.01,disappearAt:.3,stagger:.005,enter:{type:"scale",duration:.02,easing:"easeOut"},exit:{type:"fade",duration:.1,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},cutout:{strength:.25,primary:{pattern:7,scale:.5,weight:1},blend:"multiply",travel:"radial",travelSpeed:1,strengthCurve:"fadeOut"},rotate:{axis:"z",rotations:0,phase:0},scaleVariance:.5,lifetimeVariance:.25,blending:"additive",renderOrder:16,modelOverrides:{"ember-cluster":{shaderAnimation:{type:1,arcWidth:.98,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:-.1,z:.12},orientation:"camera",startScale:.2,endScale:.9,scaleEasing:"easeOutQuad"},count:1,scale:.7,models:["ember-cluster"],animation:{appearAt:.05,disappearAt:.6,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},cutout:{strength:.5,primary:{pattern:5,scale:1.2,weight:1},blend:"multiply",travel:"radial",travelSpeed:.5,strengthCurve:"constant"},pulse:{amplitude:.1,frequency:8,easing:"easeInOut"},rotate:{axis:"z",rotations:0,phase:0},blending:"additive",renderOrder:6,modelOverrides:{"ember-cluster":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:2},orientationOverride:"camera"}}}}],flickerFrequency:14,flickerAmplitude:.02,flickerDecay:.4,scaleVibration:.035,scaleFrequency:7,scaleGrowth:.015,glowColor:[1,.5,.15],glowIntensityMin:1.2,glowIntensityMax:2.5,glowFlickerRate:10});const la={puff:{name:"puff",emoji:"üí®",type:"blending",description:"Quick burst of smoke puff",duration:1500,beats:2,intensity:1,category:"emanating",density:.4,riseSpeed:.02,riseAcceleration:.5,decayRate:.3,tint:[.95,.93,.9],windDir:[.1,0],swirl:0,glowColor:[.7,.7,.75],glowIntensityMin:.9,glowIntensityMax:1.1,glowFlickerRate:5,scaleVibration:.01,scaleFrequency:4,scalePulse:!0,scaleBurst:.05},billow:{name:"billow",emoji:"üå´Ô∏è",type:"blending",description:"Rolling clouds of smoke rising slowly",duration:3500,beats:5,intensity:.8,category:"emanating",density:.6,riseSpeed:.008,riseAcceleration:.2,decayRate:.2,tint:[.85,.85,.87],windDir:[.05,.03],swirl:.15,turbulenceAmount:.015,turbulenceSpeed:2,glowColor:[.6,.6,.65],glowIntensityMin:.85,glowIntensityMax:1,glowFlickerRate:3,scaleVibration:.02,scaleFrequency:1.5,scalePulse:!0,scaleGrowth:.03},fume:{name:"fume",emoji:"‚ô®Ô∏è",type:"blending",description:"Steady low smoke emission, fuming angrily",duration:4e3,beats:6,intensity:.5,category:"emanating",density:.3,riseSpeed:.005,riseAcceleration:.1,decayRate:.15,tint:[1,.95,.8],windDir:[.02,0],swirl:0,turbulenceAmount:.008,turbulenceSpeed:1.5,glowColor:[.8,.78,.7],glowIntensityMin:.95,glowIntensityMax:1.05,glowFlickerRate:2,scaleVibration:.008,scaleFrequency:1,scalePulse:!0},shroud:{name:"shroud",emoji:"üåë",type:"blending",description:"Smoke enveloping and obscuring - ominous and claustrophobic",duration:3200,beats:4,intensity:1.4,category:"afflicted",density:.5,riseSpeed:0,riseAcceleration:0,decayRate:.22,tint:[.52,.54,.62],windDir:[-.02,0],swirl:.4,turbulenceAmount:.025,turbulenceSpeed:2.5,glowColor:[.32,.34,.42],glowIntensityMin:.55,glowIntensityMax:.78,glowFlickerRate:3.5,scaleVibration:.018,scaleFrequency:1.8,scalePulse:!1,scaleContraction:.035,rotationWobble:.015,rotationWobbleSpeed:1.2},haze:{name:"haze",emoji:"üåÅ",type:"blending",description:"Light foggy haze overlay",duration:3500,beats:4,intensity:.5,category:"afflicted",density:.2,riseSpeed:0,riseAcceleration:0,decayRate:.1,tint:[.85,.88,.95],windDir:[.08,.04],swirl:.1,turbulenceAmount:.005,turbulenceSpeed:1,glowColor:[.8,.8,.85],glowIntensityMin:.9,glowIntensityMax:1,glowFlickerRate:1.5,scaleVibration:.005,scaleFrequency:.8,scalePulse:!0},choke:{name:"choke",emoji:"üò∂‚Äçüå´Ô∏è",type:"blending",description:"Dense suffocating smoke",duration:2500,beats:4,intensity:1.5,category:"afflicted",density:.9,riseSpeed:0,riseAcceleration:0,decayRate:.2,tint:[.7,.75,.65],windDir:[0,0],swirl:.6,turbulenceAmount:.025,turbulenceSpeed:4,glowColor:[.3,.35,.3],glowIntensityMin:.6,glowIntensityMax:.8,glowFlickerRate:6,scaleVibration:.025,scaleFrequency:5,scalePulse:!1,scaleContraction:.03,jitterAmount:.008,jitterFrequency:8},smokebomb:{name:"smokebomb",emoji:"üí®",type:"blending",description:"Ninja smokebomb - instant thick smoke, ninja gone in a flash",duration:1400,beats:2,intensity:2.5,category:"explosive",density:1,riseSpeed:0,riseAcceleration:0,decayRate:.5,tint:[.55,.55,.58],windDir:[0,0],swirl:.5,turbulenceAmount:.05,turbulenceSpeed:8,glowColor:[.5,.5,.55],glowIntensityMin:.3,glowIntensityMax:.7,glowFlickerRate:12,scaleVibration:.01,scaleFrequency:5,scalePulse:!1,fadeOut:!0,fadeStartAt:.05,fadeEndAt:.28,fadeCurve:"quick"},vanish:{name:"vanish",emoji:"üëª",type:"blending",description:"Magician vanish - elegant smoke envelops, graceful disappearance",duration:2800,beats:4,intensity:1.3,category:"emanating",density:.9,riseSpeed:.025,riseAcceleration:1.2,decayRate:.32,tint:[.8,.83,.9],windDir:[.06,.03],swirl:.4,turbulenceAmount:.018,turbulenceSpeed:2.5,glowColor:[.68,.7,.78],glowIntensityMin:.45,glowIntensityMax:.85,glowFlickerRate:3,scaleVibration:.006,scaleFrequency:1.5,scalePulse:!0,fadeOut:!0,fadeStartAt:.18,fadeEndAt:.52,fadeCurve:"smooth"},materialize:{name:"materialize",emoji:"‚ú®",type:"blending",description:"Magician appear - smoke condenses, mascot emerges from nothing",duration:2500,beats:4,intensity:1.6,category:"emanating",density:.95,riseSpeed:-.018,riseAcceleration:1,decayRate:.38,tint:[.94,.94,.97],windDir:[-.1,-.05],swirl:.5,turbulenceAmount:.028,turbulenceSpeed:3.5,glowColor:[.88,.88,.92],glowIntensityMin:.55,glowIntensityMax:1.4,glowFlickerRate:5,scaleVibration:.008,scaleFrequency:2,scalePulse:!1,fadeIn:!0,fadeStartAt:.32,fadeEndAt:.78,fadeCurve:"smooth"}};function ha(e){return(43758.5453*Math.sin(e)%1+1)%1}function ca(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return ha(t)*(1-a)+ha(t+1)*a}function ua(e){const t=la[e];return t?{name:t.name,emoji:t.emoji,type:t.type,description:t.description,config:{duration:t.duration,beats:t.beats,intensity:t.intensity,...t},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:"afflicted"===t.category?1.3:1.5,offBeat:1,curve:"smooth"}},"3d":{evaluate(e,i){const a={...t,...i},s=e*a.duration/1e3,n="afflicted"===a.category;let r=1;n||e<.2&&(r=e/.2,r=Math.pow(r,.5)),n&&e<.3&&(r=e/.3,r=Math.pow(r,.7)),e>1-a.decayRate&&(r*=1-(e-(1-a.decayRate))/a.decayRate);let o=0,l=0,h=0;if(a.riseSpeed>0&&(l+=a.riseSpeed*(1+s*a.riseAcceleration)*r),a.turbulenceAmount>0){const e=s*a.turbulenceSpeed;o+=(ca(e)-.5)*a.turbulenceAmount*r,h+=(ca(e+50)-.5)*a.turbulenceAmount*r*.5}if(a.jitterAmount>0){const e=s*a.jitterFrequency;o+=(ca(3*e)-.5)*a.jitterAmount*r,l+=(ca(3*e+33)-.5)*a.jitterAmount*r*.5,h+=(ca(3*e+66)-.5)*a.jitterAmount*r*.3}let c=1;const u=s*a.scaleFrequency;if(c=a.scalePulse?1+(.5*Math.sin(u*Math.PI*2)+.5)*a.scaleVibration*r:1+(.5*Math.sin(u*Math.PI*2)+.3*Math.sin(u*Math.PI*3.1))*a.scaleVibration*r,a.scaleBurst){const t=Math.min(e/.3,1),i=t<1?Math.pow(t,.5):1;c+=a.scaleBurst*i*r}a.scaleGrowth&&(c+=a.scaleGrowth*r),a.scaleContraction&&(c-=a.scaleContraction*r);let d=0,p=0,g=0;if(a.rotationWobble){const e=s*a.rotationWobbleSpeed;d=Math.sin(e*Math.PI*2)*a.rotationWobble*r,g=Math.sin(e*Math.PI*1.7+.5)*a.rotationWobble*.7*r,p=Math.sin(e*Math.PI*.8)*a.rotationWobble*.4*r}let m=1;if(a.fadeOut){const t=a.fadeStartAt||.15,i=a.fadeEndAt||.5;if(e>=t){const s=Math.min(1,(e-t)/(i-t));let n;n="quick"===a.fadeCurve?1-Math.pow(s,.5):1-s*s,m=Math.max(0,n)}}if(a.fadeIn){const t=a.fadeStartAt||.25,i=a.fadeEndAt||.75;if(e<t)m=0;else if(e<i){const s=(e-t)/(i-t);let n;n="quick"===a.fadeCurve?Math.pow(s,.5):s*s*(3-2*s),m=n}else m=1}const y=s*a.glowFlickerRate,f=.3*Math.sin(y*Math.PI*2)+.7;return{position:[o,l,h],rotation:[d,p,g],scale:c,meshOpacity:m,glowIntensity:a.glowIntensityMin+(a.glowIntensityMax-a.glowIntensityMin)*f*r,glowBoost:n?-.15*r*a.intensity:.05*r*a.intensity,glowColorOverride:a.glowColor,smokeOverlay:{enabled:r>.1,thickness:r*a.intensity,density:a.density,category:a.category,tint:a.tint,windDir:a.windDir,swirl:a.swirl*r,time:s}}}}}:ua("puff")}const da=ua("puff"),pa=ua("billow"),ga=ua("fume"),ma=ua("shroud"),ya=ua("haze"),fa=ua("choke"),ba=ua("smokebomb"),wa=ua("vanish"),va=ua("materialize");var Ma=$a({name:"voidconsume",emoji:"‚ö´",type:"blending",description:"Being swallowed by void ‚Äî the maw rises and consumes",duration:2500,beats:4,intensity:1.5,category:"annihilation",depth:.85,distortionStrength:.005,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeIn",startScale:.8,endScale:1.5,startDiameter:1.2,endDiameter:2.5,orientation:"flat"},formation:{type:"spiral",count:1,spacing:0,arcOffset:0,phaseOffset:0},count:1,scale:.5,models:["void-ring"],animation:{appearAt:0,disappearAt:.7,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeInCubic"},procedural:{scaleSmoothing:.06,geometryStability:!0},pulse:{amplitude:.08,frequency:4,easing:"easeIn"},emissive:{min:.2,max:.6,frequency:5,pattern:"sine"},cutout:{strength:.6,primary:{pattern:6,scale:1.2,weight:.8},secondary:{pattern:3,scale:.8,weight:.4},blend:"multiply",travel:"vertical",travelSpeed:3,strengthCurve:"fadeIn",trailDissolve:{enabled:!0,offset:-.4,softness:1.5}},atmospherics:[{preset:"darkness",targets:["void-ring"],anchor:"below",intensity:.8,sizeScale:1.5,progressCurve:"sustain"}],blending:"normal",renderOrder:2,modelOverrides:{"void-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:2,arcCount:1},orientationOverride:"flat"}}}},{type:"radial-burst",radialBurst:{count:3,radius:.05,endRadius:.8,angleSpread:360,startAngle:60,orientation:"camera",startScale:.2,endScale:1.2,scaleEasing:"easeOutQuad"},count:3,scale:.5,models:["void-wrap"],animation:{appearAt:.15,disappearAt:.6,stagger:.05,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.55,primary:{pattern:1,scale:1.2,weight:1},secondary:{pattern:0,scale:.7,weight:.3},blend:"multiply",travel:"radial",travelSpeed:2,strengthCurve:"fadeIn",trailDissolve:{enabled:!0,offset:-.5,softness:1.2}},rotate:[{axis:"z",rotations:.5,phase:0},{axis:"z",rotations:-.4,phase:120},{axis:"z",rotations:.6,phase:240}],scaleVariance:.25,lifetimeVariance:.15,blending:"normal",renderOrder:4,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:2.5,arcCount:2}}}}},{type:"surface",pattern:"crown",embedDepth:.1,cameraFacing:.35,clustering:.3,count:8,scale:1.1,models:["void-crack","shadow-tendril","corruption-patch","void-shard"],minDistance:.08,animation:{appearAt:.05,disappearAt:.85,stagger:.02,enter:{type:"grow",duration:.06,easing:"easeOutQuad"},exit:{type:"shrink",duration:.08,easing:"easeInCubic"},pulse:{amplitude:.12,frequency:3,easing:"easeIn"},emissive:{min:.1,max:.4,frequency:4,pattern:"sine"},drift:{direction:"inward",speed:.035,noise:.1},rotate:{axis:"y",speed:.12,oscillate:!1},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:1,modelOverrides:{"void-crack":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.6},y:{expand:!0,rate:1.4},z:{expand:!0,rate:.8}}},drift:{direction:"inward",speed:.04,noise:.1}},"shadow-tendril":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.7},y:{expand:!0,rate:1.8},z:{expand:!1,rate:.7}},wobbleFrequency:3,wobbleAmplitude:.15},drift:{direction:"inward",speed:.035}},"corruption-patch":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.5},y:{expand:!1,rate:.5},z:{expand:!0,rate:1.5}}},drift:{direction:"inward",speed:.03},orientationOverride:"flat"},"void-shard":{drift:{direction:"inward",speed:.045,noise:.08},opacityLink:"inverse-scale"}}}}],pullStrength:.025,spiralRate:2,glowColor:[.1,.05,.15],glowIntensityMin:.2,glowIntensityMax:.5,glowFlickerRate:8,dimStrength:.4,scaleVibration:.03,scaleFrequency:5,scaleShrink:.15,scalePulse:!0,rotationSpeed:1.2,fadeOut:!0,fadeStartAt:.3,fadeEndAt:.85,fadeCurve:"accelerating",decayRate:.15}),Sa=$a({name:"voidcorrupt",emoji:"ü¶†",type:"blending",description:"Descending corruption ‚Äî darkness spirals down and engulfs",duration:3e3,beats:5,intensity:1.2,category:"corruption",depth:.6,distortionStrength:.003,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"above",end:"bottom",easing:"easeIn",startScale:1.2,endScale:.6,startDiameter:2.2,endDiameter:.6,orientation:"flat"},formation:{type:"spiral",count:5,spacing:.1,arcOffset:72,phaseOffset:.06},count:5,scale:.9,models:["void-wrap"],animation:{appearAt:0,disappearAt:.65,stagger:.06,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.1,frequency:3,easing:"easeInOut",perElement:!0},emissive:{min:.2,max:.6,frequency:4,pattern:"sine"},cutout:{strength:.45,primary:{pattern:6,scale:1,weight:.7},secondary:{pattern:3,scale:.8,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"bell",trailDissolve:{enabled:!0,offset:-.4,softness:1.3}},atmospherics:[{preset:"darkness",targets:null,anchor:"around",intensity:.6,sizeScale:1,progressCurve:"sustain",velocityInheritance:.3}],rotate:[{axis:"y",rotations:-2,phase:0},{axis:"y",rotations:-2,phase:72},{axis:"y",rotations:-2,phase:144},{axis:"y",rotations:-2,phase:216},{axis:"y",rotations:-2,phase:288}],scaleVariance:.2,lifetimeVariance:.1,blending:"normal",renderOrder:3,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1.5,arcCount:2},orientationOverride:"flat"}}}},{type:"surface",pattern:"scattered",embedDepth:.15,cameraFacing:.2,clustering:.5,count:5,scale:.9,models:["corruption-patch","void-crack"],minDistance:.12,animation:{appearAt:.2,disappearAt:.75,stagger:.08,enter:{type:"grow",duration:.15,easing:"easeOutQuad"},exit:{type:"fade",duration:.3,easing:"easeIn"},pulse:{amplitude:.06,frequency:2,easing:"easeInOut",sync:"global"},emissive:{min:.2,max:.5,frequency:2,pattern:"sine"},atmospherics:[{preset:"darkness",targets:null,anchor:"around",intensity:.3,sizeScale:.4,progressCurve:"rampUp"}],scaleVariance:.2,lifetimeVariance:.12,blending:"normal",renderOrder:5,modelOverrides:{"corruption-patch":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.3},y:{expand:!1,rate:.5},z:{expand:!0,rate:1.3}}},orientationOverride:"flat"},"void-crack":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.2},y:{expand:!0,rate:1},z:{expand:!0,rate:.8}}}}}}}],glowColor:[.15,.05,.2],glowIntensityMin:.4,glowIntensityMax:.7,glowFlickerRate:4,dimStrength:.3,scaleVibration:.02,scaleFrequency:5,scalePulse:!0,jitterAmount:.006,jitterFrequency:7,decayRate:.22}),xa=$a({name:"voiddrain",emoji:"üï≥Ô∏è",type:"blending",description:"Soul extraction ‚Äî energy drained upward through dark portal",duration:3500,beats:5,intensity:.7,category:"absorption",depth:.4,distortionStrength:.002,spawnMode:[{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.2,z:0},orientation:"flat",startScale:.3,endScale:1,scaleEasing:"easeOutCubic"},count:1,scale:.9,models:["void-wrap"],animation:{appearAt:0,disappearAt:.85,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.04,frequency:1.5,easing:"easeInOut"},emissive:{min:.2,max:.6,frequency:2,pattern:"sine"},cutout:{strength:.35,primary:{pattern:6,scale:.7,weight:.8},secondary:{pattern:3,scale:1,weight:.3},blend:"multiply",travel:"angular",travelSpeed:1,strengthCurve:"bell",trailDissolve:{enabled:!0,offset:-.3,softness:1}},atmospherics:[{preset:"darkness",targets:["void-wrap"],anchor:"above",intensity:.4,sizeScale:1,progressCurve:"sustain"}],rotate:{axis:"z",rotations:.3,phase:0},blending:"normal",renderOrder:2,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1,arcCount:2},orientationOverride:"flat"}}}},{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"above",easing:"easeIn",startScale:1,endScale:.3,startDiameter:.8,endDiameter:.4,orientation:"camera"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:.1},count:3,scale:.5,models:["void-orb"],animation:{appearAt:.1,disappearAt:.8,stagger:.12,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"shrink",duration:.1,easing:"easeInCubic"},procedural:{scaleSmoothing:.06,geometryStability:!0},pulse:{amplitude:.1,frequency:2,easing:"easeInOut",perElement:!0},emissive:{min:.15,max:.5,frequency:3,pattern:"sine"},cutout:{strength:.45,primary:{pattern:3,scale:.5,weight:1},blend:"multiply",travel:"vertical",travelSpeed:2,strengthCurve:"fadeIn",trailDissolve:{enabled:!0,offset:-.5,softness:1.5}},rotate:[{axis:"y",rotations:1,phase:0},{axis:"y",rotations:1,phase:120},{axis:"y",rotations:1,phase:240}],opacityGradient:[1,.8,.5],scaleVariance:.2,lifetimeVariance:.1,blending:"normal",renderOrder:3,modelOverrides:{"void-orb":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1.5,arcCount:1}}}}},{type:"surface",pattern:"scattered",embedDepth:.2,cameraFacing:.2,clustering:.3,count:5,scale:.9,models:["void-shard","corruption-patch"],minDistance:.15,animation:{appearAt:.1,disappearAt:.9,stagger:.06,enter:{type:"fade",duration:.15,easing:"easeOut"},exit:{type:"shrink",duration:.12,easing:"easeInCubic"},pulse:{amplitude:.08,frequency:1,easing:"easeInOut",sync:"global"},emissive:{min:.2,max:.5,frequency:1.5,pattern:"sine"},drift:{direction:"inward",speed:.012,noise:.05},rotate:{axis:"y",speed:.015,oscillate:!1},scaleVariance:.15,lifetimeVariance:.12,blending:"normal",renderOrder:4,modelOverrides:{"void-shard":{drift:{direction:"inward",speed:.015,noise:.05},opacityLink:"dissipate"},"corruption-patch":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.2},y:{expand:!1,rate:.6},z:{expand:!0,rate:1.2}}},drift:{direction:"outward-flat",speed:.01,adherence:.6},orientationOverride:"flat"}}}}],dimRate:.3,dimPulse:!0,pullStrength:.005,glowColor:[.3,.2,.4],glowIntensityMin:.4,glowIntensityMax:.7,glowFlickerRate:2,dimStrength:.25,scaleVibration:.01,scaleFrequency:1.5,scaleShrink:.03,scalePulse:!0,decayRate:.25}),ka=$a({name:"voidhollow",emoji:"üëÅÔ∏è",type:"blending",description:"Becoming empty inside ‚Äî the void grows from within",duration:4e3,beats:6,intensity:.8,category:"absorption",depth:.5,distortionStrength:0,spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},cameraOffset:2.5,orientation:"camera"},count:1,scale:.6,models:["void-disk"],animation:{appearAt:0,disappearAt:.9,stagger:0,enter:{type:"scale",duration:.3,easing:"easeOut"},exit:{type:"shrink",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.04,frequency:.8,easing:"easeInOut"},atmospherics:[{preset:"darkness",targets:["void-disk"],anchor:"around",intensity:.8,sizeScale:.5,speedScale:.1,lifetimeScale:.4,progressCurve:"sustain",gravity:{strength:1.5,spawnRadius:.35}}],scaleVariance:0,lifetimeVariance:0,blending:"normal",renderOrder:1,modelOverrides:{"void-disk":{diskMode:!0}}}},{type:"orbit",orbit:{height:-.2,endHeight:.1,radius:.6,endRadius:.5,speed:.5,easing:"linear",startScale:.6,endScale:1,orientation:"camera"},count:2,scale:.4,models:["void-wrap"],animation:{appearAt:.1,disappearAt:.8,stagger:.15,enter:{type:"fade",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.05,frequency:1,easing:"easeInOut",perElement:!0},emissive:{min:.15,max:.45,frequency:1.5,pattern:"sine"},cutout:{strength:.5,primary:{pattern:0,scale:.8,weight:.7},secondary:{pattern:6,scale:.6,weight:.3},blend:"multiply",travel:"angular",travelSpeed:.6,strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.3,softness:1}},atmospherics:[{preset:"darkness",targets:["void-wrap"],anchor:"around",intensity:.4,sizeScale:.4,progressCurve:"rampUp"}],scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:3,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.4,arcSpeed:.5,arcCount:1}}}}},{type:"surface",pattern:"shell",embedDepth:.25,cameraFacing:.15,clustering:.4,count:5,scale:.8,models:["void-crack","void-shard"],minDistance:.18,animation:{appearAt:.15,disappearAt:.9,stagger:.08,enter:{type:"grow",duration:.2,easing:"easeOutQuad"},exit:{type:"fade",duration:.15,easing:"easeIn"},pulse:{amplitude:.04,frequency:.8,easing:"easeInOut",sync:"global"},emissive:{min:.2,max:.5,frequency:1,pattern:"sine"},atmospherics:[{preset:"darkness",targets:null,anchor:"around",intensity:.3,sizeScale:.3,progressCurve:"rampUp"}],scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:5,modelOverrides:{"void-crack":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.3},y:{expand:!0,rate:1.1},z:{expand:!0,rate:.9}}}},"void-shard":{opacityLink:"dissipate"}}}}],hollowCore:!0,hollowProgress:.7,glowColor:[.25,.25,.35],glowIntensityMin:.5,glowIntensityMax:.75,glowFlickerRate:1.5,dimStrength:.2,scaleVibration:.008,scaleFrequency:1,scaleShrink:.02,scalePulse:!0,tremor:.003,tremorFrequency:6,decayRate:.2}),Oa=$a({name:"voidcrown",emoji:"üëë",type:"blending",description:"Dark void ring hovering above the head, absorbing light",duration:3e3,beats:4,intensity:1,category:"manifestation",depth:.6,distortionStrength:0,spawnMode:{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.05,z:0},orientation:"flat",bob:{amplitude:.02,frequency:.25}},count:1,scale:.85,models:["void-crown"],animation:{appearAt:0,disappearAt:.75,stagger:0,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.02,frequency:1.5,easing:"easeInOut"},rotate:{axis:"z",rotations:.5,phase:0},atmospherics:[{preset:"darkness",targets:["void-crown"],anchor:"above",intensity:.5,sizeScale:1.2,progressCurve:"sustain"}],cutout:{strength:.35,primary:{pattern:6,scale:.8,weight:.7},secondary:{pattern:3,scale:1,weight:.3},blend:"multiply",travel:"angular",travelSpeed:.8,strengthCurve:"bell",trailDissolve:{enabled:!0,offset:-.4,softness:1.2}},scaleVariance:0,lifetimeVariance:0,blending:"normal",renderOrder:3,modelOverrides:{"void-crown":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:.5,arcCount:2},orientationOverride:"flat"}}}},jitterAmount:0,jitterFrequency:0,decayRate:.2,glowColor:[.25,.1,.35],glowIntensityMin:.5,glowIntensityMax:.7,glowFlickerRate:1.5,dimStrength:.25,scaleVibration:.005,scaleFrequency:2,scalePulse:!0,rotationDrift:.008}),Aa=$a({name:"voiddance",emoji:"üíÉ",type:"blending",description:"Vertical void rings dancing and rising",duration:1500,beats:3,intensity:1.3,category:"manifestation",depth:.5,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.4,endScale:1.8,startDiameter:1.3,endDiameter:2,orientation:"flat"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["void-wrap"],animation:{appearAt:.02,disappearAt:.5,stagger:.02,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:.3,max:.8,frequency:6,pattern:"sine"},cutout:{strength:.45,primary:{pattern:6,scale:2,weight:1},secondary:{pattern:7,scale:1.5,weight:.6},blend:"add",travel:"spiral",travelSpeed:2.5,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.12,tip:.28},trailDissolve:{enabled:!0,offset:-.8,softness:2}},atmospherics:[{preset:"darkness",targets:null,anchor:"around",intensity:.5,sizeScale:1.2,progressCurve:"sustain",velocityInheritance:.4,centrifugal:{speed:.5,tangentialBias:.5}}],rotate:[{axis:"y",rotations:2,phase:0},{axis:"y",rotations:-2,phase:60},{axis:"y",rotations:3,phase:120}],scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:3,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:2,arcCount:2},orientationOverride:"flat"}}}},jitterAmount:0,jitterFrequency:0,decayRate:.2,glowColor:[.3,.15,.4],glowIntensityMin:.5,glowIntensityMax:.65,glowFlickerRate:2,dimStrength:.2,scaleVibration:.018,scaleFrequency:4,scalePulse:!0,rotationDrift:.005}),Ca=$a({name:"voidhelix",emoji:"üß¨",type:"blending",description:"DNA double helix of void fragments counter-spiraling upward",duration:2e3,beats:4,intensity:1.2,category:"manifestation",depth:.6,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeInOut",startScale:.7,endScale:2,startDiameter:.4,endDiameter:3,orientation:"camera"},formation:{type:"spiral",count:10,strands:2,spacing:.08,arcOffset:180,phaseOffset:.03},count:10,scale:1.2,models:["void-wrap","void-orb","void-wrap","void-crack","void-wrap","void-orb","void-wrap","void-crack","void-wrap","void-orb"],animation:{appearAt:0,disappearAt:.4,stagger:.02,enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.12,frequency:4,easing:"easeInOut",perElement:!0},emissive:{min:.15,max:.55,frequency:4,pattern:"sine"},cutout:{strength:.4,primary:{pattern:0,scale:1,weight:.7},secondary:{pattern:3,scale:.8,weight:.5},blend:"multiply",travel:"angular",travelSpeed:3,strengthCurve:"bell",bellPeakAt:.5,trailDissolve:{enabled:!0,offset:-.5,softness:1.5}},atmospherics:[{preset:"darkness",targets:null,anchor:"around",intensity:.6,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:.8,tangentialBias:.4}}],rotate:[{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180},{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180},{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180},{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180},{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180}],scaleVariance:.3,lifetimeVariance:.1,blending:"normal",renderOrder:3,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:2,arcCount:2}},"void-orb":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:.8,arcCount:1}},"void-crack":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1.2,arcCount:3}}}}},jitterAmount:0,jitterFrequency:0,decayRate:.2,glowColor:[.25,.1,.35],glowIntensityMin:.5,glowIntensityMax:.8,glowFlickerRate:3,dimStrength:.25,scaleVibration:.01,scaleFrequency:3,scalePulse:!0,rotationDrift:.01});const Ia={appearAt:0,disappearAt:.7,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.05,frequency:3,easing:"easeInOut"},emissive:{min:.3,max:.7,frequency:4,pattern:"sine"},atmospherics:[{preset:"darkness",targets:["void-wrap"],anchor:"above",intensity:.6,sizeScale:1.4,progressCurve:"sustain",velocityInheritance:.5}],scaleVariance:.03,lifetimeVariance:.02,blending:"normal",renderOrder:3,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1,arcCount:2},orientationOverride:"flat"}}};var za=$a({name:"voidpillar",emoji:"üèõÔ∏è",type:"blending",description:"Majestic column of void rings",duration:2500,beats:4,intensity:1.2,category:"manifestation",depth:.65,distortionStrength:.008,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:0},formation:{type:"stack",count:2,spacing:.25},count:2,scale:2.2,models:["void-wrap"],animation:{...Ia,stagger:.03,cutout:{strength:.4,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:7,scale:1.5,weight:.4},blend:"add",travel:"angular",travelSpeed:1.2,strengthCurve:"fadeIn",fadeInDuration:.3,geometricMask:{type:"distance",core:.1,tip:.25},trailDissolve:{enabled:!0,offset:-.5,softness:1.2}},rotate:[{axis:"z",rotations:.3,phase:0},{axis:"z",rotations:.3,phase:180}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:.5},formation:{type:"stack",count:2,spacing:.25},count:2,scale:2.2,models:["void-wrap"],animation:{...Ia,stagger:.05,cutout:{strength:.45,primary:{pattern:7,scale:1.8,weight:1},secondary:{pattern:3,scale:1.5,weight:.5},blend:"multiply",travel:"radial",travelSpeed:1.8,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.5,geometricMask:{type:"tip-boost",core:0,tip:.2},trailDissolve:{enabled:!0,offset:-.4,softness:1.5}},rotate:[{axis:"z",rotations:-.6,phase:60},{axis:"z",rotations:-.6,phase:240}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:1},formation:{type:"stack",count:2,spacing:.25},count:2,scale:2.2,models:["void-wrap"],animation:{...Ia,stagger:.07,cutout:{strength:.5,primary:{pattern:6,scale:1.5,weight:1},secondary:{pattern:3,scale:2,weight:.4},blend:"add",travel:"oscillate",travelSpeed:2.5,strengthCurve:"fadeOut",fadeOutDuration:.4,geometricMask:{type:"distance",core:.15,tip:.3},trailDissolve:{enabled:!0,offset:-.3,softness:1.8}},rotate:[{axis:"z",rotations:.9,phase:90},{axis:"z",rotations:.9,phase:270}]}}],jitterAmount:0,jitterFrequency:0,decayRate:.2,glowColor:[.2,.08,.3],glowIntensityMin:.55,glowIntensityMax:.85,glowFlickerRate:2.5,dimStrength:.3,scaleVibration:.008,scaleFrequency:2,scalePulse:!0,rotationDrift:.005}),Fa=$a({name:"voiddrill",emoji:"‚è¨",type:"blending",description:"Fast tight void helix drilling downward",duration:1200,beats:2,intensity:1.5,category:"manifestation",depth:.75,distortionStrength:0,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"feet",end:"below",easing:"easeIn",startScale:1,endScale:.8,startDiameter:1.8,endDiameter:1.4,orientation:"flat"},formation:{type:"spiral",count:6,spacing:.1,arcOffset:60,phaseOffset:0},count:6,scale:.8,models:["void-wrap"],animation:{appearAt:0,disappearAt:.6,stagger:.03,enter:{type:"fade",duration:.05,easing:"linear"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},pulse:{amplitude:.08,frequency:10,easing:"linear"},emissive:{min:.4,max:1,frequency:12,pattern:"random"},atmospherics:[{preset:"darkness",targets:null,anchor:"below",intensity:.5,sizeScale:1.3,speedScale:.5,progressCurve:"rampUp",velocityInheritance:.5,centrifugal:{speed:1,tangentialBias:.3}}],rotate:{axis:"y",rotations:4,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:3,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.4,arcSpeed:4,arcCount:1},orientationOverride:"flat"}}}},jitterAmount:0,jitterFrequency:0,decayRate:.15,glowColor:[.15,.05,.25],glowIntensityMin:.7,glowIntensityMax:1.2,glowFlickerRate:6,dimStrength:.4,scaleVibration:.02,scaleFrequency:4,scalePulse:!0,rotationDrift:.02}),Da=$a({name:"voidflourish",emoji:"‚ú®",type:"blending",description:"Dark void flourish ‚Äî sweeping arcs of consumed light",duration:1200,beats:4,intensity:1.3,category:"manifestation",depth:.55,distortionStrength:.003,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.8,endScale:1.3,startDiameter:1,endDiameter:2,orientation:"camera"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:.08,zOffset:0},count:3,scale:.4,models:["void-ring"],animation:{appearAt:0,disappearAt:.5,stagger:.1,enter:{type:"fade",duration:.04,easing:"easeOut"},exit:{type:"burst-fade",duration:.7,easing:"easeIn",burstScale:1.1},procedural:{scaleSmoothing:.05,geometryStability:!0},cutout:{strength:.7,primary:{pattern:6,scale:1.5,weight:.8},secondary:{pattern:3,scale:.8,weight:.4},blend:"multiply",travel:"spiral",travelSpeed:2,strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.5,softness:1.5}},pulse:{amplitude:.12,frequency:5,easing:"easeInOut",perElement:!0},emissive:{min:.3,max:.7,frequency:4,pattern:"sine"},drift:{speed:.25,distance:.15,pattern:"radial",accelerate:!0},opacityGradient:[1,.85,.7],rotate:[{axis:"z",rotations:2,phase:0},{axis:"z",rotations:-1.5,phase:120},{axis:"z",rotations:1.8,phase:240}],tilt:{axis:"y",oscillate:!0,range:.3,speed:3},wobble:{axis:"x",oscillate:!0,range:.1,speed:2,phase:90},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:3,modelOverrides:{"void-ring":{shaderAnimation:{type:1,arcWidth:.25,arcSpeed:3,arcCount:1},orientationOverride:"camera"}},atmospherics:[{preset:"darkness",targets:["void-ring"],anchor:"around",intensity:.5,sizeScale:1,progressCurve:"sustain"}]}},{type:"anchor",anchor:{landmark:"center",offset:{x:-.5,y:.3,z:0},orientation:"camera",startScale:.3,endScale:1,scaleEasing:"easeOutCubic"},count:1,scale:.7,models:["void-wrap"],animation:{appearAt:.1,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},cutout:{strength:.5,primary:{pattern:1,scale:1,weight:1},secondary:{pattern:0,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut",trailDissolve:{enabled:!0,offset:-.5,softness:1.5}},drift:{speed:.9,distance:.35,direction:{x:1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:.8,phase:-45}],blending:"normal",renderOrder:5,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.4,arcSpeed:1.5,arcCount:2}}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:.5,y:.3,z:0},orientation:"camera",startScale:.3,endScale:1,scaleEasing:"easeOutCubic"},count:1,scale:.7,models:["void-wrap"],animation:{appearAt:.1,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},cutout:{strength:.5,primary:{pattern:1,scale:1,weight:1},secondary:{pattern:0,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut",trailDissolve:{enabled:!0,offset:-.5,softness:1.5}},drift:{speed:.9,distance:.35,direction:{x:-1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:.8,phase:45}],blending:"normal",renderOrder:5,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.4,arcSpeed:1.5,arcCount:2}}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.3,endScale:2.2,scaleEasing:"easeOutExpo"},count:1,scale:.75,models:["void-ring"],animation:{appearAt:.25,disappearAt:.65,enter:{type:"fade",duration:.05,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},cutout:{strength:.5,primary:{pattern:0,scale:.8,weight:1},secondary:{pattern:1,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.6,softness:1.8}},rotate:[{axis:"z",rotations:.001,phase:45}],blending:"normal",renderOrder:2,modelOverrides:{"void-ring":{shaderAnimation:{type:1,arcWidth:.2,arcSpeed:2,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.3,endScale:2.2,scaleEasing:"easeOutExpo"},count:1,scale:.75,models:["void-ring"],animation:{appearAt:.25,disappearAt:.65,enter:{type:"fade",duration:.05,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},cutout:{strength:.5,primary:{pattern:0,scale:.8,weight:1},secondary:{pattern:1,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.6,softness:1.8}},rotate:[{axis:"z",rotations:.001,phase:-45}],blending:"normal",renderOrder:2,modelOverrides:{"void-ring":{shaderAnimation:{type:1,arcWidth:.2,arcSpeed:2,arcCount:1},orientationOverride:"camera"}}}}],jitterAmount:0,jitterFrequency:0,decayRate:.2,glowColor:[.3,.15,.4],glowIntensityMin:.5,glowIntensityMax:.75,glowFlickerRate:2,dimStrength:.2,scaleVibration:.012,scaleFrequency:3,scalePulse:!0,rotationDrift:.008}),qa=$a({name:"voidvortex",emoji:"üåÄ",type:"blending",description:"Dark void tornado spiraling around mascot",duration:1500,beats:5,intensity:1.3,category:"manifestation",depth:.7,distortionStrength:.003,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.2,endScale:1.5,startDiameter:.6,endDiameter:2,orientation:"flat"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1.5,models:["void-wrap"],animation:{appearAt:.05,disappearAt:.9,stagger:.02,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:.3,max:.8,frequency:5,pattern:"sine"},cutout:{strength:.4,primary:{pattern:6,scale:1.5,weight:.8},secondary:{pattern:3,scale:1,weight:.5},blend:"multiply",travel:"spiral",travelSpeed:3,strengthCurve:"bell",bellPeakAt:.5,trailDissolve:{enabled:!0,offset:-.6,softness:1.8}},atmospherics:[{preset:"darkness",targets:null,anchor:"around",intensity:.6,sizeScale:1.5,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:.8,tangentialBias:.4}}],scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:3,modelOverrides:{"void-wrap":{shaderAnimation:{type:1,arcWidth:.3,arcSpeed:4,arcCount:1},scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.1},y:{expand:!1,rate:.3},z:{expand:!0,rate:1.1}}},orientationOverride:"flat"}}}},jitterAmount:0,jitterFrequency:0,decayRate:.2,glowColor:[.2,.08,.3],glowIntensityMin:.6,glowIntensityMax:1,glowFlickerRate:4,dimStrength:.35,scaleVibration:.015,scaleFrequency:3,scalePulse:!0,rotationDrift:.015}),Ra=$a({name:"voidbarrage",emoji:"üèπ",type:"blending",description:"Void orbs orbit mascot then launch outward",duration:1500,beats:4,intensity:1.4,category:"manifestation",depth:.7,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"above",radius:1.2,endRadius:2.8,speed:3,easing:"easeIn",startScale:1,endScale:.6,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.6,models:["void-orb","void-shard","shadow-tendril"],animation:{appearAt:0,disappearAt:.65,stagger:.04,enter:{type:"scale",duration:.1,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.2},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:.2,max:.7,frequency:4,pattern:"sine"},atmospherics:[{preset:"darkness",targets:null,anchor:"around",intensity:.5,sizeScale:1.2,progressCurve:"sustain",velocityInheritance:.6}],rotate:[{axis:"x",rotations:2,phase:0},{axis:"y",rotations:-3,phase:40},{axis:"z",rotations:2.5,phase:100},{axis:"x",rotations:-2,phase:180},{axis:"y",rotations:3,phase:250}],scaleVariance:.2,lifetimeVariance:.1,blending:"normal",renderOrder:3}},jitterAmount:0,jitterFrequency:0,decayRate:.2,glowColor:[.2,.05,.3],glowIntensityMin:.6,glowIntensityMax:1.2,glowFlickerRate:6,dimStrength:.35,scaleVibration:.012,scaleFrequency:4,scalePulse:!0}),Ba=$a({name:"voidimpact",emoji:"üí•",type:"blending",description:"Void orbs converge inward to strike the mascot",duration:1500,beats:4,intensity:1.5,category:"manifestation",depth:.8,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"center",radius:2.5,endRadius:.5,speed:2,easing:"easeOut",startScale:.6,endScale:1.3,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.6,models:["void-orb","void-crack","corruption-patch"],animation:{appearAt:0,disappearAt:.65,stagger:.03,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"shrink",duration:.1,easing:"easeInCubic"},procedural:{scaleSmoothing:.06,geometryStability:!0},pulse:{amplitude:.12,frequency:6,easing:"easeIn"},emissive:{min:.3,max:1,frequency:5,pattern:"sine"},atmospherics:[{preset:"darkness",targets:null,anchor:"around",intensity:.6,sizeScale:1.4,progressCurve:"rampUp",velocityInheritance:.5}],rotate:[{axis:"y",rotations:2,phase:0},{axis:"x",rotations:-2.5,phase:72},{axis:"z",rotations:3,phase:144},{axis:"y",rotations:-2,phase:216},{axis:"x",rotations:2.5,phase:288}],scaleVariance:.15,lifetimeVariance:.08,blending:"normal",renderOrder:3}},jitterAmount:0,jitterFrequency:0,decayRate:.15,glowColor:[.15,.02,.25],glowIntensityMin:.7,glowIntensityMax:1.5,glowFlickerRate:8,dimStrength:.4,scaleVibration:.02,scaleFrequency:5,scalePulse:!0}),Ea=$a({name:"voidsingularity",emoji:"‚ö´",type:"blending",description:"Collapsing void orb ‚Äî a singularity consuming all light",duration:3e3,beats:4,intensity:1.5,category:"annihilation",depth:.8,distortionStrength:0,spawnMode:{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},cameraOffset:2.5,orientation:"camera",wander:{radius:.12,speedX:.25,speedZ:.18}},count:1,scale:1.2,models:["void-disk"],animation:{appearAt:0,disappearAt:.88,stagger:0,enter:{type:"scale",duration:.3,easing:"easeOut"},exit:{type:"shrink",duration:.06,easing:"easeInCubic"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.08,frequency:1,easing:"easeInOut"},atmospherics:[{preset:"shadow",targets:null,anchor:"around",intensity:.25,sizeScale:1.2,progressCurve:"rampUp"},{preset:"darkness",targets:["void-disk"],anchor:"around",intensity:.7,sizeScale:.6,speedScale:.1,lifetimeScale:.4,progressCurve:"sustain",gravity:{strength:1.8,spawnRadius:.4}}],scaleVariance:0,lifetimeVariance:0,blending:"normal",renderOrder:3,modelOverrides:{"void-disk":{diskMode:!0}}}},jitterAmount:0,jitterFrequency:0,decayRate:.15,glowColor:[.15,.05,.25],glowIntensityMin:.7,glowIntensityMax:1,glowFlickerRate:1.5,dimStrength:.45,scaleVibration:.01,scaleFrequency:1,scalePulse:!0,rotationDrift:.003});const Pa={drain:{name:"drain",emoji:"üï≥Ô∏è",type:"blending",description:"Slowly draining energy, light dims and color fades",duration:3500,beats:5,intensity:.7,category:"absorption",depth:.4,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.2,cameraFacing:.2,clustering:.3,count:5,scale:.9,models:["void-shard","corruption-patch"],minDistance:.15,animation:{appearAt:.1,disappearAt:.9,stagger:.06,enter:{type:"fade",duration:.15,easing:"easeOut"},exit:{type:"shrink",duration:.12,easing:"easeInCubic"},pulse:{amplitude:.08,frequency:1,easing:"easeInOut",sync:"global"},emissive:{min:.2,max:.5,frequency:1.5,pattern:"sine"},drift:{direction:"inward",speed:.012,noise:.05},rotate:{axis:"y",speed:.015,oscillate:!1},scaleVariance:.15,lifetimeVariance:.12,blending:"normal",renderOrder:3,intensityScaling:{scale:.9,emissiveMax:.8},modelOverrides:{"void-shard":{drift:{direction:"inward",speed:.015,noise:.05},opacityLink:"dissipate"},"corruption-patch":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.2},y:{expand:!1,rate:.6},z:{expand:!0,rate:1.2}}},drift:{direction:"outward-flat",speed:.01,adherence:.6},orientationOverride:"flat"}}}},dimRate:.3,dimPulse:!0,glowColor:[.3,.2,.4],glowIntensityMin:.4,glowIntensityMax:.7,glowFlickerRate:2,scaleVibration:.01,scaleFrequency:1.5,scaleShrink:.03,pullStrength:.005,decayRate:.25},siphon:{name:"siphon",emoji:"üåÄ",type:"blending",description:"Active pull of energy inward, swirling absorption",duration:2800,beats:4,intensity:1,category:"absorption",depth:.6,spawnMode:{type:"surface",pattern:"ring",embedDepth:.15,cameraFacing:.3,clustering:.2,count:6,scale:.85,models:["void-crack","shadow-tendril","void-shard"],minDistance:.12},pullStrength:.015,spiralRate:1.5,glowColor:[.2,.1,.3],glowIntensityMin:.3,glowIntensityMax:.6,glowFlickerRate:4,scaleVibration:.02,scaleFrequency:3,scaleShrink:.05,scalePulse:!0,rotationSpeed:.3,decayRate:.2},hollow:{name:"hollow",emoji:"üëÅÔ∏è",type:"blending",description:"Becoming empty inside, shell of former self",duration:4e3,beats:6,intensity:.8,category:"absorption",depth:.5,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.25,cameraFacing:.15,clustering:.4,count:4,scale:.8,models:["void-crack","void-shard"],minDistance:.18},hollowCore:!0,hollowProgress:.7,glowColor:[.25,.25,.35],glowIntensityMin:.5,glowIntensityMax:.75,glowFlickerRate:1.5,scaleVibration:.008,scaleFrequency:1,scaleShrink:.02,tremor:.003,tremorFrequency:6,decayRate:.2},corrupt:{name:"corrupt",emoji:"ü¶†",type:"blending",description:"Darkness spreading across surface, being overtaken",duration:3200,beats:5,intensity:1.2,category:"corruption",depth:.65,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.1,cameraFacing:.2,clustering:.5,count:8,scale:1,models:["corruption-patch","shadow-tendril","void-crack"],minDistance:.1},spreadRate:.4,spreadPulse:!0,glowColor:[.15,.05,.2],glowIntensityMin:.35,glowIntensityMax:.65,glowFlickerRate:5,scaleVibration:.025,scaleFrequency:6,jitterAmount:.01,jitterFrequency:8,rotationWobble:.02,rotationWobbleSpeed:2,decayRate:.22},taint:{name:"taint",emoji:"üíú",type:"blending",description:"Subtle dark infection, insidious corruption",duration:4500,beats:6,intensity:.5,category:"corruption",depth:.35,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.12,cameraFacing:.15,clustering:.35,count:4,scale:.7,models:["corruption-patch","void-shard"],minDistance:.2},spreadRate:.2,glowColor:[.4,.3,.5],glowIntensityMin:.7,glowIntensityMax:.9,glowFlickerRate:2,scaleVibration:.005,scaleFrequency:2,driftAmount:.003,driftSpeed:.8,decayRate:.18},wither:{name:"wither",emoji:"ü•Ä",type:"blending",description:"Life force being consumed, vitality draining",duration:3800,beats:5,intensity:.9,category:"corruption",depth:.55,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.18,cameraFacing:.2,clustering:.4,count:6,scale:.85,models:["shadow-tendril","corruption-patch","void-shard"],minDistance:.12},witherRate:.35,glowColor:[.3,.2,.25],glowIntensityMin:.45,glowIntensityMax:.7,glowFlickerRate:3,scaleVibration:.012,scaleFrequency:2,scaleShrink:.06,droopAmount:.015,droopAcceleration:.5,decayRate:.2},consume:{name:"consume",emoji:"‚ö´",type:"blending",description:"Being swallowed by void, total absorption",duration:2500,beats:4,intensity:1.5,category:"annihilation",depth:.85,spawnMode:{type:"surface",pattern:"crown",embedDepth:.1,cameraFacing:.35,clustering:.3,count:10,scale:1.1,models:["void-crack","shadow-tendril","corruption-patch","void-shard"],minDistance:.08,animation:{appearAt:.05,disappearAt:.88,stagger:.02,enter:{type:"grow",duration:.06,easing:"easeOutQuad"},exit:{type:"shrink",duration:.08,easing:"easeInCubic"},pulse:{amplitude:.12,frequency:3,easing:"easeIn"},emissive:{min:.1,max:.4,frequency:4,pattern:"sine"},drift:{direction:"inward",speed:.035,noise:.1},rotate:{axis:"y",speed:.12,oscillate:!1},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:2,intensityScaling:{scale:.85,driftSpeed:1.5,rotateSpeed:1.4},modelOverrides:{"void-crack":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.6},y:{expand:!0,rate:1.4},z:{expand:!0,rate:.8}}},drift:{direction:"inward",speed:.04,noise:.1}},"shadow-tendril":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.7},y:{expand:!0,rate:1.8},z:{expand:!1,rate:.7}},wobbleFrequency:3,wobbleAmplitude:.15},drift:{direction:"inward",speed:.035}},"corruption-patch":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.5},y:{expand:!1,rate:.5},z:{expand:!0,rate:1.5}}},drift:{direction:"inward",speed:.03},orientationOverride:"flat"},"void-shard":{drift:{direction:"inward",speed:.045,noise:.08},opacityLink:"inverse-scale"}}}},pullStrength:.025,spiralRate:2,glowColor:[.1,.05,.15],glowIntensityMin:.2,glowIntensityMax:.5,glowFlickerRate:8,scaleVibration:.03,scaleFrequency:5,scaleShrink:.15,rotationSpeed:1.2,fadeOut:!0,fadeStartAt:.3,fadeEndAt:.85,fadeCurve:"accelerating",decayRate:.15},erase:{name:"erase",emoji:"üëª",type:"blending",description:"Fading from existence, becoming nothing",duration:3e3,beats:4,intensity:1.3,category:"annihilation",depth:.7,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.2,cameraFacing:.25,clustering:.35,count:7,scale:.95,models:["void-crack","void-shard","corruption-patch"],minDistance:.1},erasePattern:"dissolve",glowColor:[.2,.2,.3],glowIntensityMin:.3,glowIntensityMax:.6,glowFlickerRate:3,scaleVibration:.015,scaleFrequency:2,scaleShrink:.08,driftAmount:.01,driftSpeed:.5,riseAmount:.008,fadeOut:!0,fadeStartAt:.2,fadeEndAt:.9,fadeCurve:"smooth",decayRate:.1},singularity:{name:"singularity",emoji:"üí´",type:"blending",description:"Collapsing to a point, ultimate compression",duration:2e3,beats:3,intensity:2,category:"annihilation",depth:1,spawnMode:{type:"surface",pattern:"shell",embedDepth:.05,cameraFacing:.4,clustering:.15,count:12,scale:1.2,models:["void-crack","shadow-tendril","corruption-patch","void-shard"],minDistance:.06,animation:{appearAt:.02,disappearAt:.95,stagger:.015,enter:{type:"flash",duration:.02,easing:"linear"},exit:{type:"shrink",duration:.05,easing:"easeInCubic"},pulse:{amplitude:.2,frequency:8,easing:"snap"},flicker:{intensity:.25,rate:15,pattern:"random"},emissive:{min:.05,max:.3,frequency:10,pattern:"random"},drift:{direction:"inward",speed:.06,noise:.15},rotate:{axis:"y",speed:.25,oscillate:!1},scaleVariance:.25,lifetimeVariance:.2,blending:"normal",renderOrder:1,intensityScaling:{scale:.7,driftSpeed:1.8,rotateSpeed:1.6},modelOverrides:{"void-crack":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:2},y:{expand:!0,rate:1.8},z:{expand:!1,rate:.6}},wobbleFrequency:6,wobbleAmplitude:.2},drift:{direction:"inward",speed:.06,noise:.15}},"shadow-tendril":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.6},y:{expand:!0,rate:2.2},z:{expand:!1,rate:.6}},wobbleFrequency:5,wobbleAmplitude:.2},drift:{direction:"inward",speed:.055}},"corruption-patch":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.8},y:{expand:!1,rate:.4},z:{expand:!0,rate:1.8}}},drift:{direction:"inward",speed:.05},orientationOverride:"flat"},"void-shard":{drift:{direction:"inward",speed:.065,noise:.1},opacityLink:"inverse-scale"}}}},collapsePhase:.7,pullStrength:.04,spiralRate:3,glowColor:[.05,0,.1],glowIntensityMin:.1,glowIntensityMax:.4,glowFlickerRate:15,scaleVibration:.04,scaleFrequency:10,scaleShrink:.35,rotationSpeed:2.5,fadeOut:!0,fadeStartAt:.5,fadeEndAt:.95,fadeCurve:"accelerating",decayRate:.05}};function Ta(e){return(43758.5453*Math.sin(e)%1+1)%1}function ja(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return Ta(t)*(1-a)+Ta(t+1)*a}function Va(e){const t=Pa[e];return t?{name:t.name,emoji:t.emoji,type:t.type,description:t.description,config:{duration:t.duration,beats:t.beats,intensity:t.intensity,...t},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:"annihilation"===t.category?1.5:1.2,offBeat:1,curve:"absorption"===t.category?"smooth":"sharp"}},"3d":{evaluate(e,i){const a={...t,...i},s=e*a.duration/1e3,{category:n}=a;let r=1;"absorption"===n&&e<.25&&(r=e/.25,r=Math.pow(r,.7)),"corruption"===n&&(e<.3&&(r=e/.3),a.spreadPulse)&&(r*=1+.15*Math.sin(s*Math.PI*3)),"annihilation"===n&&a.collapsePhase&&(r=e<a.collapsePhase?Math.pow(e/a.collapsePhase,1.5):1),e>1-a.decayRate&&(r*=1-(e-(1-a.decayRate))/a.decayRate);let o=0,l=0,h=0;if(a.pullStrength>0){const t=s*(a.spiralRate||1),i=Math.cos(t*Math.PI*2),n=Math.sin(t*Math.PI*2),l=a.pullStrength*r*(1-.5*e);o+=i*l,h+=n*l}if(a.jitterAmount>0){const e=s*a.jitterFrequency;o+=(ja(3*e)-.5)*a.jitterAmount*r,l+=(ja(3*e+33)-.5)*a.jitterAmount*r*.5,h+=(ja(3*e+66)-.5)*a.jitterAmount*r*.3}if(a.tremor>0){const e=s*a.tremorFrequency;o+=(ja(e)-.5)*a.tremor*r,l+=(ja(e+50)-.5)*a.tremor*r*.5}if(a.driftAmount>0){const e=s*a.driftSpeed;o+=Math.sin(e*Math.PI)*a.driftAmount*r,h+=Math.cos(e*Math.PI*.7)*a.driftAmount*r*.5}if(a.droopAmount>0){const t=e*(1+a.droopAcceleration*e);l-=a.droopAmount*t*r}a.riseAmount>0&&(l+=a.riseAmount*e*r);let c=1;const u=s*a.scaleFrequency;if(c=a.scalePulse?1+(.5*Math.sin(u*Math.PI*2)+.5-.5)*a.scaleVibration*r:1+(.5*Math.sin(u*Math.PI*2)+.3*Math.sin(u*Math.PI*3.7))*a.scaleVibration*r,a.scaleShrink>0){const t="annihilation"===n?Math.pow(e,1.5):e;c-=a.scaleShrink*t*r,c=Math.max(.01,c)}let d=0,p=0,g=0;if(a.rotationSpeed>0&&(p=s*a.rotationSpeed*Math.PI*2*r,"annihilation"===n&&(p*=1+e)),a.rotationWobble>0){const e=s*a.rotationWobbleSpeed;d=Math.sin(e*Math.PI*2)*a.rotationWobble*r,g=Math.sin(e*Math.PI*1.7+.5)*a.rotationWobble*.7*r}let m=1;if(a.fadeOut){const t=a.fadeStartAt||.2,i=a.fadeEndAt||.9;if(e>=t){const s=Math.min(1,(e-t)/(i-t));let n;n="accelerating"===a.fadeCurve?1-Math.pow(s,2):1-s,m=Math.max(0,n)}}const y=s*a.glowFlickerRate;let f;"absorption"===n?f=.3*Math.sin(y*Math.PI*2)+.7:"corruption"===n?f=(.2*Math.sin(y*Math.PI*2)+.2*Math.sin(y*Math.PI*3.3+1)+.3)*(Ta(Math.floor(2*y))>.5?.8:1.2):(f=.4*Math.sin(y*Math.PI*2)+.6,f*=1-.5*e);const b=1+(a.glowIntensityMin+(a.glowIntensityMax-a.glowIntensityMin)*f-1)*r,w=-.3*r*a.intensity;return{voidOverlay:{enabled:r>.01,strength:r*a.intensity,depth:a.depth,category:a.category,spawnMode:a.spawnMode||null,time:s,progress:e,duration:a.duration,animation:t.spawnMode?.animation,models:t.spawnMode?.models,count:t.spawnMode?.count,scale:t.spawnMode?.scale,embedDepth:t.spawnMode?.embedDepth,distortionStrength:t.distortionStrength},position:[o,l,h],rotation:[d,p,g],scale:c,meshOpacity:m,glowIntensity:b,glowBoost:w,glowColorOverride:r>.005?a.glowColor:null}}}}:Va("drain")}function $a(e){return{name:e.name,emoji:e.emoji,type:e.type,description:e.description,config:{duration:e.duration,beats:e.beats,intensity:e.intensity,...e},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:"annihilation"===e.category?1.5:1.2,offBeat:1,curve:"manifestation"===e.category?"smooth":"sharp"}},"3d":{evaluate(t,i){const a={...e,...i},s=t*a.duration/1e3,{category:n}=a,r="manifestation"===n;let o=1;a.buildupPhase&&t<a.buildupPhase&&(o=Math.pow(t/a.buildupPhase,.7)),"absorption"===n&&!a.buildupPhase&&t<.25&&(o=Math.pow(t/.25,.7)),"corruption"===n&&(!a.buildupPhase&&t<.3&&(o=t/.3),a.spreadPulse&&(o*=1+.15*Math.sin(s*Math.PI*3))),"annihilation"===n&&a.collapsePhase&&t<a.collapsePhase&&(o=Math.pow(t/a.collapsePhase,1.5));const l=a.decayRate||.2;t>1-l&&(o*=1-(t-(1-l))/l);let h=0,c=0,u=0;if(a.pullStrength>0){const e=s*(a.spiralRate||1),i=a.pullStrength*o*(1-.5*t);h+=Math.cos(e*Math.PI*2)*i,u+=Math.sin(e*Math.PI*2)*i}if(a.jitterAmount>0){const e=s*a.jitterFrequency;h+=(ja(3*e)-.5)*a.jitterAmount*o,c+=(ja(3*e+33)-.5)*a.jitterAmount*o*.5,u+=(ja(3*e+66)-.5)*a.jitterAmount*o*.3}if(a.tremor>0){const e=s*a.tremorFrequency;h+=(ja(e)-.5)*a.tremor*o,c+=(ja(e+50)-.5)*a.tremor*o*.5}if(a.driftAmount>0){const e=s*a.driftSpeed;h+=Math.sin(e*Math.PI)*a.driftAmount*o,u+=Math.cos(e*Math.PI*.7)*a.driftAmount*o*.5}a.droopAmount>0&&(c-=a.droopAmount*t*(1+a.droopAcceleration*t)*o),a.riseAmount>0&&(c+=a.riseAmount*t*o),a.hover&&a.hoverAmount&&(c+=Math.sin(s*Math.PI*.5)*a.hoverAmount*o);let d=1;const p=s*(a.scaleFrequency||2);if(d=a.scalePulse?1+(.5*Math.sin(p*Math.PI*2)+.5-.5)*(a.scaleVibration||.01)*o:1+(.5*Math.sin(p*Math.PI*2)+.3*Math.sin(p*Math.PI*3.7))*(a.scaleVibration||.01)*o,a.scaleShrink>0){const e="annihilation"===n?Math.pow(t,1.5):t;d-=a.scaleShrink*e*o,d=Math.max(.01,d)}a.scaleGrowth&&(d+=a.scaleGrowth*o);let g=0,m=0,y=0;if(a.rotationSpeed>0&&(m=s*a.rotationSpeed*Math.PI*2*o,"annihilation"===n&&(m*=1+t)),a.rotationWobble>0){const e=s*a.rotationWobbleSpeed;g=Math.sin(e*Math.PI*2)*a.rotationWobble*o,y=Math.sin(e*Math.PI*1.7+.5)*a.rotationWobble*.7*o}a.rotationDrift&&(m+=s*a.rotationDrift*o);let f=1;if(a.fadeOut){const e=a.fadeStartAt||.2,i=a.fadeEndAt||.9;if(t>=e){const s=Math.min(1,(t-e)/(i-e));f="accelerating"===a.fadeCurve?Math.max(0,1-Math.pow(s,2)):Math.max(0,1-s)}}const b=s*(a.glowFlickerRate||2);let w;r||"absorption"===n?w=.3*Math.sin(b*Math.PI*2)+.7:"corruption"===n?w=(.2*Math.sin(b*Math.PI*2)+.2*Math.sin(b*Math.PI*3.3+1)+.3)*(Ta(Math.floor(2*b))>.5?.8:1.2):(w=.4*Math.sin(b*Math.PI*2)+.6,w*=1-.5*t);const v=a.glowIntensityMin||.4;return{position:[h,c,u],rotation:[g,m,y],scale:d,meshOpacity:f,glowIntensity:1+(v+((a.glowIntensityMax||.7)-v)*w-1)*o,glowBoost:-(a.dimStrength||.3)*o*a.intensity,glowColorOverride:o>.005?a.glowColor:null,voidOverlay:{enabled:o>.01,strength:o*a.intensity,depth:a.depth||.5,category:n,spawnMode:a.spawnMode||null,duration:a.duration,progress:t,time:s,animation:e.spawnMode?.animation,models:e.spawnMode?.models,count:e.spawnMode?.count,scale:e.spawnMode?.scale,embedDepth:e.spawnMode?.embedDepth,distortionStrength:e.distortionStrength}}}}}}const Wa=Va("siphon"),Ga=Va("taint"),La=Va("wither"),_a=Va("erase"),Ha=Ma,Ua=Sa,Qa=xa,Ya=ka,Xa=Oa,Na=Aa,Ja=Ca,Za=za,Ka=Fa,es=Da,ts=qa,is=Ra,as=Ba,ss=Ea;var ns=$a({name:"voidmeditation",emoji:"üßò",type:"blending",description:"Dark meditative mandala ‚Äî void energy breathing in stillness",duration:4e3,beats:4,intensity:.7,category:"absorption",voidStrength:.5,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"easeInOut",startScale:1,endScale:1,startDiameter:1.8,endDiameter:1.8,orientation:"camera"},formation:{type:"mandala",count:5,radius:.5,arcOffset:45,scales:[1,.6,.6,.6,.6]},count:5,scale:1.2,models:["void-ring"],animation:{appearAt:0,disappearAt:.8,stagger:0,enter:{type:"fade",duration:.5,easing:"easeInOut"},exit:{type:"fade",duration:.4,easing:"easeInOut"},procedural:{scaleSmoothing:.15,geometryStability:!0},pulse:{amplitude:.12,frequency:1.2,easing:"easeInOut"},emissive:{min:.7,max:1.3,frequency:1.2,pattern:"sine"},cutout:{strength:.6,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:6,scale:1.5,weight:.5},blend:"add",travel:"angular",travelSpeed:.4,strengthCurve:"bell",bellPeakAt:.5,bellWidth:1,geometricMask:{type:"distance",core:.1,tip:.3}},grain:{type:3,strength:.4,scale:.5,speed:.3,blend:"multiply"},atmospherics:[{preset:"smoke",targets:null,anchor:"above",intensity:.25,sizeScale:.8,speedScale:.4,progressCurve:"sustain"}],rotate:[{axis:"z",rotations:.3,phase:0},{axis:"z",rotations:-.25,phase:0},{axis:"z",rotations:.2,phase:0},{axis:"z",rotations:-.25,phase:0},{axis:"z",rotations:.3,phase:0}],scaleVariance:0,lifetimeVariance:0,blending:"additive",depthWrite:!1,renderOrder:-5,modelOverrides:{"void-ring":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:.3,arcCount:2},orientationOverride:"camera"}}}},decayRate:.2,glowColor:[.3,.1,.5],glowIntensityMin:.4,glowIntensityMax:.8,glowFlickerRate:2,scaleVibration:.004,scaleFrequency:1.2,scaleGrowth:0,rotationEffect:!1});const rs={appearAt:0,disappearAt:.7,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},parameterAnimation:{frost:{start:.55,peak:.85,end:.65,curve:"bell"}},pulse:{amplitude:.05,frequency:3,easing:"easeInOut"},emissive:{min:.9,max:1.8,frequency:4,pattern:"sine"},grain:{type:3,strength:.35,scale:.2,speed:1.5,blend:"multiply"},atmospherics:[{preset:"mist",targets:["ice-ring"],anchor:"below",anchorOffset:-.1,intensity:.4,sizeScale:1.5,progressCurve:"sustain"}],scaleVariance:.03,lifetimeVariance:.02,blending:"normal",renderOrder:15,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.8,arcCount:2}}}};function os(e){return(43758.5453*Math.sin(e)%1+1)%1}function ls(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return os(t)*(1-a)+os(t+1)*a}function hs(e){return{name:e.name,emoji:e.emoji,type:e.type,description:e.description,config:{duration:e.duration,beats:e.beats,intensity:e.intensity,...e},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:"transform"===e.category?1.4:1.2,offBeat:1,curve:"smooth"}},"3d":{evaluate(t,i){const a={...e,...i},s=t*a.duration/1e3,{category:n}=a;let r=1;"afflicted"===n&&(t<.2&&(r=t/.2),a.frostDecay&&(r*=1-.6*t)),"emanating"===n&&(r*=.2*Math.sin(s*Math.PI*2)+.8),"transform"===n&&(r=a.shatterPoint&&t>a.shatterPoint?1-(t-a.shatterPoint)/(1-a.shatterPoint):Math.min(1,t/.3));const o=a.decayRate||.15;t>1-o&&(r*=1-(t-(1-o))/o);let l=a.frost||.5;a.frostDecay&&(l*=1-.7*t);let h=0,c=0,u=0;if(a.tremor>0){let e=a.tremor;a.tremorDecay&&(e*=1-t*a.tremorDecay);const i=s*(a.tremorFrequency||8);h+=(ls(i)-.5)*e*r,c+=(ls(i+50)-.5)*e*r*.5,u+=(ls(i+100)-.5)*e*r*.3}if(a.shiverAmount>0){const e=s*(a.shiverFrequency||12);h+=Math.sin(e*Math.PI*2)*a.shiverAmount*r,c+=Math.cos(e*Math.PI*3.1)*a.shiverAmount*.5*r}if(a.jitterAmount>0){const e=s*(a.jitterFrequency||15);os(Math.floor(e))>.7&&(h+=(os(e)-.5)*a.jitterAmount*r,c+=(os(e+10)-.5)*a.jitterAmount*.5*r)}if(a.droopAmount>0){const e=t*(1+(a.droopAcceleration||.3)*t);c-=a.droopAmount*e*r}if(a.explosionForce>0&&a.shatterPoint&&t>a.shatterPoint){const e=(t-a.shatterPoint)/(1-a.shatterPoint),i=a.explosionForce*e;h+=(ls(20*s)-.5)*i,c+=(ls(20*s+33)-.5)*i,u+=(ls(20*s+66)-.5)*i}let d=1;const p=s*(a.scaleFrequency||3);a.scalePulse?d=1+(.5*Math.sin(p*Math.PI*2)+.5-.5)*(a.scaleVibration||.015)*r:a.scaleVibration&&(d=1+(.6*Math.sin(p*Math.PI*2)+.4*Math.sin(p*Math.PI*2.7))*a.scaleVibration*r),a.scaleContract>0&&(d-=a.scaleContract*t*r),a.scaleExpand>0&&(d+=a.scaleExpand*t*r),a.scaleGrow>0&&(d+=a.scaleGrow*t*r),a.shatterPoint&&t>a.shatterPoint&&(d+=.1*(ls(15*s)-.5)),d=Math.max(.1,d);let g=0,m=0,y=0;if(a.rotationSpeed>0&&(m=s*a.rotationSpeed*Math.PI*2*r),a.rotationWobble>0){const e=s*(a.rotationWobbleSpeed||1.5);g=Math.sin(e*Math.PI*2)*a.rotationWobble*r,y=Math.sin(e*Math.PI*1.7+.5)*a.rotationWobble*.7*r}const f=s*(a.glowFlickerRate||2);let b;b=a.shatterPoint&&t>a.shatterPoint?1+.5*os(5*f):.3*Math.sin(f*Math.PI*2)+.7;const w=(a.glowIntensityMin||.5)+((a.glowIntensityMax||.8)-(a.glowIntensityMin||.5))*b*r,v=.15*r*a.intensity*l;return{iceOverlay:{enabled:r>.1,strength:r*a.intensity,frost:l,category:a.category,spawnMode:a.spawnMode||null,time:s,progress:t,duration:a.duration,animation:e.spawnMode?.animation,models:e.spawnMode?.models,count:e.spawnMode?.count,scale:e.spawnMode?.scale,embedDepth:e.spawnMode?.embedDepth},position:[h,c,u],rotation:[g,m,y],scale:d,glowIntensity:w,glowBoost:v,glowColorOverride:a.glowColor}}}}}const cs=hs({name:"icecrown",emoji:"üëë",type:"blending",description:"Majestic ice crown above the head",duration:3e3,beats:4,intensity:1,category:"transform",frost:.65,spawnMode:{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.05,z:0},orientation:"flat",bob:{amplitude:.02,frequency:.3}},count:1,scale:1,models:["ice-crown"],animation:{appearAt:0,disappearAt:.75,stagger:0,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.02,frequency:2,easing:"easeInOut"},atmospherics:[{preset:"mist",targets:["ice-crown"],anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain"}],rotate:{axis:"z",rotations:1,phase:0},scaleVariance:0,lifetimeVariance:0,blending:"normal",renderOrder:15}},glowColor:[.6,.85,1],glowIntensityMin:.8,glowIntensityMax:.8,glowFlickerRate:0,scaleVibration:.003,scaleFrequency:3,scaleGrowth:.005,tremor:0,tremorFrequency:0,tremorDecay:0}),us=hs({name:"icedance",emoji:"üíÉ",type:"blending",description:"Vertical ice crystals dancing and rising",duration:1500,beats:3,intensity:1.3,category:"transform",frost:.7,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.2,endScale:1.6,startDiameter:1.3,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["ice-ring"],animation:{appearAt:.02,disappearAt:.5,stagger:.02,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},cutout:{strength:.65,primary:{pattern:3,scale:1.5,weight:1},secondary:{pattern:8,scale:1.2,weight:.5},blend:"add",travel:"angular",travelSpeed:2,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.12,tip:.28}},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.4,centrifugal:{speed:.5,tangentialBias:.5}}],parameterAnimation:{frost:{start:.5,peak:.75,end:.55,curve:"bell"}},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:.8,max:1.6,frequency:6,pattern:"sine"},rotate:[{axis:"y",rotations:2,phase:0},{axis:"y",rotations:-2,phase:60},{axis:"y",rotations:3,phase:120}],scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:11,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}}}},glowColor:[.5,.8,1],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:6,scaleVibration:.018,scaleFrequency:4,scaleGrowth:.025,tremor:.005,tremorFrequency:3}),ds=hs({name:"icepillar",emoji:"üèõÔ∏è",type:"blending",description:"Majestic rising pillar of ice",duration:3e3,beats:4,intensity:1.3,category:"transform",frost:.8,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:0},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1.6,models:["ice-ring"],animation:{...rs,stagger:.03,cutout:{strength:.55,primary:{pattern:0,scale:1.2,weight:1},secondary:{pattern:8,scale:1.5,weight:.4},blend:"add",travel:"angular",travelSpeed:1.2,strengthCurve:"fadeIn",fadeInDuration:.3,geometricMask:{type:"distance",core:.1,tip:.25}},rotate:[{axis:"z",rotations:.3,phase:0},{axis:"z",rotations:.3,phase:180}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:.5},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1.6,models:["ice-ring"],animation:{...rs,stagger:.05,cutout:{strength:.6,primary:{pattern:8,scale:1.4,weight:1},secondary:{pattern:3,scale:1.2,weight:.5},blend:"multiply",travel:"radial",travelSpeed:1.5,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.5,geometricMask:{type:"tip-boost",core:0,tip:.2}},rotate:[{axis:"z",rotations:-.5,phase:60},{axis:"z",rotations:-.5,phase:240}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:1},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1.6,models:["ice-ring"],animation:{...rs,stagger:.07,cutout:{strength:.65,primary:{pattern:3,scale:1.3,weight:1},secondary:{pattern:7,scale:1.5,weight:.4},blend:"add",travel:"oscillate",travelSpeed:2,strengthCurve:"fadeOut",fadeOutDuration:.4,geometricMask:{type:"distance",core:.15,tip:.3}},rotate:[{axis:"z",rotations:.7,phase:90},{axis:"z",rotations:.7,phase:270}]}}],glowColor:[.55,.8,1],glowIntensityMin:.8,glowIntensityMax:1.6,glowFlickerRate:5,scaleVibration:.008,scaleFrequency:3,scaleGrowth:.025,tremor:.002,tremorFrequency:2}),ps=hs({name:"icehelix",emoji:"üß¨",type:"blending",description:"DNA-style double helix ascending ice",duration:2e3,beats:4,intensity:1.2,category:"transform",frost:.75,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeInOut",startScale:.8,endScale:1.1,startDiameter:1.6,endDiameter:1.8,orientation:"vertical"},formation:{type:"spiral",count:6,strands:2,spacing:.2,arcOffset:120,phaseOffset:.05},count:6,scale:1.2,models:["ice-ring"],animation:{appearAt:0,disappearAt:.7,stagger:.06,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{frost:{start:.5,peak:.85,end:.6,curve:"bell"}},pulse:{amplitude:.06,frequency:4,easing:"easeInOut"},emissive:{min:.9,max:2,frequency:6,pattern:"smooth"},cutout:{strength:.7,primary:{pattern:8,scale:1.5,weight:1},secondary:{pattern:3,scale:1.2,weight:.5},blend:"max",travel:"angular",travelSpeed:2.5,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.1,tip:.25}},grain:{type:3,strength:.15,scale:.2,speed:1,blend:"multiply"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:.8,tangentialBias:.4}}],rotate:{axis:"y",rotations:2,phase:0},scaleVariance:.1,lifetimeVariance:.1,blending:"normal",renderOrder:16,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:1.2,arcCount:1},orientationOverride:"vertical"}}}},glowColor:[.6,.85,1],glowIntensityMin:1,glowIntensityMax:1.8,glowFlickerRate:8,scaleVibration:.012,scaleFrequency:5,scaleGrowth:.02,tremor:.003,tremorFrequency:4}),gs=hs({name:"icemeditation",emoji:"üßò",type:"blending",description:"Meditative ice crystals with breathing pulse",duration:4e3,beats:4,intensity:.6,category:"emanating",frost:.5,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"easeInOut",startScale:1.4,endScale:1.4,startDiameter:2.2,endDiameter:2.2,orientation:"camera"},formation:{type:"mandala",count:5,radius:.5,arcOffset:45,scales:[1.1,.7,.7,.7,.7]},count:5,scale:1.6,models:["ice-ring"],animation:{appearAt:0,disappearAt:.8,stagger:0,enter:{type:"fade",duration:.5,easing:"easeInOut"},exit:{type:"fade",duration:.4,easing:"easeInOut"},procedural:{scaleSmoothing:.15,geometryStability:!0},parameterAnimation:{frost:{start:.35,peak:.55,end:.4,curve:"sine"}},cutout:{strength:.55,primary:{pattern:3,scale:1,weight:1},secondary:{pattern:8,scale:1.2,weight:.4},blend:"add",travel:"angular",travelSpeed:.5,strengthCurve:"bell",bellPeakAt:.5,bellWidth:1},grain:{type:3,strength:.2,scale:.3,speed:.5,blend:"multiply"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1.2,progressCurve:"sustain"}],pulse:{amplitude:.15,frequency:1.5,easing:"easeInOut"},emissive:{min:.7,max:1.2,frequency:1.5,pattern:"sine"},rotate:[{axis:"z",rotations:.4,phase:0},{axis:"z",rotations:-.35,phase:0},{axis:"z",rotations:.25,phase:0},{axis:"z",rotations:-.35,phase:0},{axis:"z",rotations:.4,phase:0}],scaleVariance:0,lifetimeVariance:0,blending:"normal",depthWrite:!1,renderOrder:-5,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.4,arcCount:2},orientationOverride:"camera"}}}},glowColor:[.55,.8,.95],glowIntensityMin:.6,glowIntensityMax:1,glowFlickerRate:3,scaleVibration:.004,scaleFrequency:1.5,scaleGrowth:0,tremor:.001,tremorFrequency:1}),ms=hs({name:"icevortex",emoji:"üåÄ",type:"blending",description:"Ice tornado spiraling around mascot",duration:1500,beats:5,intensity:1.4,category:"transform",frost:.8,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.2,endScale:1.5,startDiameter:.6,endDiameter:2,orientation:"flat"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1.5,models:["ice-ring"],animation:{appearAt:.05,disappearAt:.9,stagger:.02,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.1},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{frost:{start:.5,peak:.9,end:.6,curve:"bell"}},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1,max:2,frequency:5,pattern:"sine"},grain:{type:3,strength:.2,scale:.3,speed:2.5,blend:"multiply"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.6,centrifugal:{speed:1.2,tangentialBias:.3}}],scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:12,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:5,arcCount:1},scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.1},y:{expand:!1,rate:.3},z:{expand:!0,rate:1.1}}},orientationOverride:"flat"}}}},glowColor:[.4,.75,1],glowIntensityMin:1.2,glowIntensityMax:2.2,glowFlickerRate:6,scaleVibration:.02,scaleFrequency:4,scaleGrowth:.03,tremor:.008,tremorFrequency:5}),ys=hs({name:"icesplash",emoji:"üí•",type:"blending",description:"Explosive ice shatter with crystals and frost spray",duration:1e3,beats:2,intensity:1.3,category:"transform",frost:.85,spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.1},orientation:"camera",startScale:.2,endScale:2,scaleEasing:"easeOutQuad"},count:1,scale:1.3,models:["crystal-cluster"],animation:{appearAt:0,disappearAt:.4,enter:{type:"scale",duration:.05,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.6,primary:{pattern:2,scale:1.5,weight:1},blend:"multiply",travel:"radial",travelSpeed:1.2,strengthCurve:"fadeOut"},grain:{type:3,strength:.4,scale:.3,speed:1.5,blend:"multiply"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain"}],blending:"normal",renderOrder:8,rotate:{axis:"z",rotations:0,phase:0},modelOverrides:{"crystal-cluster":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.3,endScale:1.6,scaleEasing:"easeOutQuad"},count:1,scale:1,models:["ice-spike"],animation:{appearAt:0,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.5,primary:{pattern:8,scale:1,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.4,distance:.8,direction:{x:0,y:1,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"normal",renderOrder:12,modelOverrides:{"ice-spike":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.25,endScale:1.3,scaleEasing:"easeOutQuad"},count:1,scale:.9,models:["ice-spike"],animation:{appearAt:.02,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.5,primary:{pattern:3,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:.6,strengthCurve:"fadeOut"},drift:{speed:1.3,distance:.75,direction:{x:-.7,y:.85,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"normal",renderOrder:12,modelOverrides:{"ice-spike":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.25,endScale:1.3,scaleEasing:"easeOutQuad"},count:1,scale:.9,models:["ice-spike"],animation:{appearAt:.02,disappearAt:.5,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.5,primary:{pattern:3,scale:.8,weight:1},blend:"multiply",travel:"radial",travelSpeed:.6,strengthCurve:"fadeOut"},drift:{speed:1.3,distance:.75,direction:{x:.7,y:.85,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"normal",renderOrder:12,modelOverrides:{"ice-spike":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:1.1,scaleEasing:"easeOutQuad"},count:1,scale:.8,models:["ice-spike"],animation:{appearAt:.03,disappearAt:.45,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.18,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.5,primary:{pattern:8,scale:1.2,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.1,distance:.6,direction:{x:-.95,y:.5,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"normal",renderOrder:11,modelOverrides:{"ice-spike":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:1.1,scaleEasing:"easeOutQuad"},count:1,scale:.8,models:["ice-spike"],animation:{appearAt:.03,disappearAt:.45,enter:{type:"scale",duration:.04,easing:"easeOutBack"},exit:{type:"fade",duration:.18,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.5,primary:{pattern:8,scale:1.2,weight:1},blend:"multiply",travel:"vertical",travelSpeed:.8,strengthCurve:"fadeOut"},drift:{speed:1.1,distance:.6,direction:{x:.95,y:.5,z:0},easing:"easeOutQuad"},rotate:{axis:"z",rotations:0,phase:0},blending:"normal",renderOrder:11,modelOverrides:{"ice-spike":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:8,radius:.05,endRadius:.65,angleSpread:360,startAngle:22,orientation:"camera",startScale:.2,endScale:.9,scaleEasing:"easeOutQuad"},count:8,scale:.5,models:["crystal-small"],animation:{appearAt:.02,disappearAt:.4,stagger:.008,enter:{type:"scale",duration:.03,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},cutout:{strength:.4,primary:{pattern:3,scale:.7,weight:1},blend:"multiply",travel:"radial",travelSpeed:.8,strengthCurve:"fadeOut"},rotate:{axis:"z",rotations:0,phase:0},scaleVariance:.3,lifetimeVariance:.15,blending:"normal",renderOrder:14,modelOverrides:{"crystal-small":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:12,radius:.03,endRadius:.5,angleSpread:360,startAngle:0,orientation:"camera",startScale:.1,endScale:.35,scaleEasing:"easeOutQuad"},count:12,scale:.2,models:["crystal-small"],animation:{appearAt:.01,disappearAt:.3,stagger:.005,enter:{type:"scale",duration:.02,easing:"easeOut"},exit:{type:"fade",duration:.1,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},cutout:{strength:.3,primary:{pattern:7,scale:.5,weight:1},blend:"multiply",travel:"radial",travelSpeed:1,strengthCurve:"fadeOut"},rotate:{axis:"z",rotations:0,phase:0},scaleVariance:.5,lifetimeVariance:.25,blending:"normal",renderOrder:16,modelOverrides:{"crystal-small":{shaderAnimation:{type:1,arcWidth:.98,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:-.1,z:.12},orientation:"camera",startScale:.2,endScale:.9,scaleEasing:"easeOutQuad"},count:1,scale:.6,models:["crystal-cluster"],animation:{appearAt:.05,disappearAt:.6,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},cutout:{strength:.5,primary:{pattern:3,scale:1.2,weight:1},blend:"multiply",travel:"radial",travelSpeed:.5,strengthCurve:"constant"},pulse:{amplitude:.1,frequency:8,easing:"easeInOut"},rotate:{axis:"z",rotations:0,phase:0},blending:"normal",renderOrder:6,modelOverrides:{"crystal-cluster":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:2},orientationOverride:"camera"}}}}],glowColor:[.5,.8,1],glowIntensityMin:1,glowIntensityMax:2.2,glowFlickerRate:6,scaleVibration:.035,scaleFrequency:7,scaleGrowth:.015,tremor:.01,tremorFrequency:8}),fs=hs({name:"iceencase",emoji:"üßä",type:"blending",description:"Ice crystals growing on mascot surface, encasing in ice",duration:3500,beats:5,intensity:1.2,category:"transform",frost:.85,spawnMode:{type:"surface",pattern:"shell",embedDepth:.2,cameraFacing:.4,clustering:.1,count:10,scale:1.8,minDistance:.1,models:["crystal-cluster","crystal-medium","crystal-small","ice-spike"],animation:{appearAt:.05,disappearAt:.9,stagger:.04,enter:{type:"grow",duration:.12,easing:"easeOutQuad"},exit:{type:"shrink",duration:.15,easing:"easeInQuad"},procedural:{scaleSmoothing:.1,geometryStability:!0},parameterAnimation:{frost:{start:.5,peak:.9,end:.7,curve:"fadeIn"}},pulse:{amplitude:.05,frequency:1.2,easing:"easeInOut",sync:"global"},emissive:{min:.5,max:.9,frequency:1.5,pattern:"sine"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1.2,progressCurve:"sustain"}],cutout:{edgeMask:.3},rotate:{axis:"y",speed:.008,oscillate:!0,range:Math.PI/16},scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:6,intensityScaling:{scale:1.25,emissiveMax:1.2},modelOverrides:{"crystal-small":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1},y:{expand:!0,rate:1.4},z:{expand:!0,rate:1}},easing:"easeOutQuad"}},"crystal-medium":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.1},y:{expand:!0,rate:1.5},z:{expand:!0,rate:1.1}}}},"crystal-cluster":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.3},y:{expand:!0,rate:1.2},z:{expand:!0,rate:1.3}}}},"ice-spike":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.85},y:{expand:!0,rate:1.8},z:{expand:!1,rate:.85}}}}}}},glowColor:[.6,.85,1],glowIntensityMin:.55,glowIntensityMax:.9,glowFlickerRate:2,scaleVibration:.01,scaleFrequency:2,scaleContract:.02,tremor:.004,tremorFrequency:6,tremorDecay:.8,decayRate:.15}),bs=hs({name:"icedrill",emoji:"üî©",type:"blending",description:"Fast tight descending ice helix",duration:1200,beats:2,intensity:1.5,category:"transform",frost:.7,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"feet",end:"below",easing:"easeIn",startScale:1,endScale:.8,startDiameter:1.8,endDiameter:1.4,orientation:"vertical"},formation:{type:"spiral",count:6,spacing:.1,arcOffset:60,phaseOffset:0},count:6,scale:1.4,models:["ice-ring"],animation:{appearAt:0,disappearAt:.6,stagger:.03,enter:{type:"fade",duration:.05,easing:"linear"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{frost:{start:.4,peak:.8,end:.5,curve:"bell"}},cutout:{strength:.55,primary:{pattern:3,scale:1.5,weight:1},secondary:{pattern:8,scale:.8,weight:.35},blend:"add",travel:"vertical",travelSpeed:3,strengthCurve:"constant"},grain:{type:3,strength:.3,scale:.2,speed:4,blend:"multiply"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:1,tangentialBias:.3}}],pulse:{amplitude:.08,frequency:10,easing:"linear"},rotate:{axis:"y",rotations:4,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:16,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:3,arcCount:1},orientationOverride:"vertical"}}}},glowColor:[.4,.75,1],glowIntensityMin:1.3,glowIntensityMax:2.8,glowFlickerRate:10,scaleVibration:.02,scaleFrequency:8,scaleGrowth:.03,tremor:.006,tremorFrequency:8}),ws=hs({name:"iceflourish",emoji:"‚ùÑ",type:"blending",description:"Spinning ice flourish with crystal trails",duration:1200,beats:4,intensity:1.3,category:"ambient",frost:.6,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.7,endScale:1.2,startDiameter:1.8,endDiameter:2.8,orientation:"camera"},formation:{type:"spiral",count:5,spacing:0,arcOffset:72,phaseOffset:.05,zOffset:0},count:5,scale:1.5,models:["ice-ring"],animation:{appearAt:0,disappearAt:.45,stagger:.12,enter:{type:"fade",duration:.03,easing:"easeOut"},exit:{type:"burst-fade",duration:.85,easing:"easeIn",burstScale:1.15},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{frost:{start:.35,peak:.7,end:.2,curve:"bell"}},cutout:{strength:.6,primary:{pattern:3,scale:1,weight:1},secondary:{pattern:8,scale:.6,weight:.5},blend:"multiply",strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.6,softness:1.5}},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},atmospherics:[{preset:"mist",targets:["ice-ring"],anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.4}],pulse:{amplitude:.15,frequency:5,easing:"easeInOut",perElement:!0},drift:{speed:.3,distance:.18,pattern:"radial",accelerate:!0},opacityGradient:[1,.9,.8,.7,.6],rotate:[{axis:"z",rotations:2.5,phase:0},{axis:"z",rotations:-2,phase:72},{axis:"z",rotations:1.8,phase:144},{axis:"z",rotations:-2.3,phase:216},{axis:"z",rotations:2,phase:288}],tilt:{axis:"y",oscillate:!0,range:.4,speed:3.5},wobble:{axis:"x",oscillate:!0,range:.15,speed:2,phase:90},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",depthWrite:!1,renderOrder:-8,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1,arcCount:2},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:-.7,y:.4,z:0},orientation:"camera",startScale:.4,endScale:1.2,scaleEasing:"easeOutCubic"},count:1,scale:1.2,models:["ice-ring"],animation:{appearAt:.12,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{frost:{start:.4,peak:.6,end:.2,curve:"bell"}},cutout:{strength:.5,primary:{pattern:8,scale:1,weight:1},secondary:{pattern:3,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},drift:{speed:.9,distance:.35,direction:{x:1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:1,phase:-45}],blending:"normal",depthWrite:!1,renderOrder:-6,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:2,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:.7,y:.4,z:0},orientation:"camera",startScale:.4,endScale:1.2,scaleEasing:"easeOutCubic"},count:1,scale:1.2,models:["ice-ring"],animation:{appearAt:.12,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{frost:{start:.4,peak:.6,end:.2,curve:"bell"}},cutout:{strength:.5,primary:{pattern:8,scale:1,weight:1},secondary:{pattern:3,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},drift:{speed:.9,distance:.35,direction:{x:-1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:1,phase:45}],blending:"normal",depthWrite:!1,renderOrder:-6,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:2,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:1.5,models:["ice-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{frost:{start:.4,peak:.7,end:.25,curve:"bell"}},cutout:{strength:.5,primary:{pattern:3,scale:.8,weight:1},secondary:{pattern:8,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},rotate:[{axis:"z",rotations:.001,phase:45}],blending:"normal",depthWrite:!1,renderOrder:-10,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:1.5,models:["ice-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{frost:{start:.4,peak:.7,end:.25,curve:"bell"}},cutout:{strength:.5,primary:{pattern:3,scale:.8,weight:1},secondary:{pattern:8,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},rotate:[{axis:"z",rotations:.001,phase:-45}],blending:"normal",depthWrite:!1,renderOrder:-10,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}}],glowColor:[.5,.8,1],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:6,scaleVibration:.012,scaleFrequency:8,scaleGrowth:.015,tremor:.003,tremorFrequency:4}),vs=hs({name:"icebarrage",emoji:"üèπ",type:"blending",description:"Ice crystals orbit mascot then launch upward",duration:1500,beats:4,intensity:1.4,category:"transform",frost:.75,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"above",radius:1.2,endRadius:2.8,speed:3,easing:"easeIn",startScale:1,endScale:.6,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.4,models:["crystal-cluster","crystal-medium","crystal-small","ice-spike"],animation:{appearAt:0,disappearAt:.65,stagger:.04,enter:{type:"scale",duration:.08,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.3},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{frost:{start:.6,peak:.85,end:.4,curve:"fadeOut"}},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.7}],rotate:[{axis:"x",rotations:2,phase:0},{axis:"y",rotations:-3,phase:40},{axis:"z",rotations:2.5,phase:100},{axis:"x",rotations:-2,phase:180},{axis:"y",rotations:3,phase:250}],scaleVariance:.2,lifetimeVariance:.1,blending:"normal",renderOrder:12}},glowColor:[.5,.8,1],glowIntensityMin:1.2,glowIntensityMax:2,glowFlickerRate:6,scaleVibration:.015,scaleFrequency:4,scaleGrowth:.02,tremor:.006,tremorFrequency:5}),Ms=hs({name:"iceimpact",emoji:"üí•",type:"blending",description:"Ice crystals orbit then crash inward with impact burst",duration:1500,beats:4,intensity:1.5,category:"transform",frost:.8,spawnMode:{type:"orbit",orbit:{height:"above",endHeight:"center",radius:3.5,endRadius:.1,speed:3,easing:"easeOut",startScale:.4,endScale:1.8,orientation:"vertical"},formation:{type:"ring",count:7},count:7,scale:1.4,models:["crystal-cluster","crystal-medium","crystal-small","ice-spike"],animation:{appearAt:0,disappearAt:.6,stagger:.02,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"burst-fade",duration:.05,easing:"easeOut",burstScale:.2},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{frost:{start:.3,peak:.95,end:.9,curve:"fadeIn"}},pulse:{amplitude:.12,frequency:8,easing:"easeInOut"},emissive:{min:1,max:3,frequency:9,pattern:"sine"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.7}],rotate:[{axis:"z",rotations:-4,phase:0},{axis:"x",rotations:3.5,phase:50},{axis:"y",rotations:-3,phase:100},{axis:"z",rotations:4,phase:155},{axis:"x",rotations:-3.5,phase:210},{axis:"y",rotations:3,phase:260},{axis:"z",rotations:-4.5,phase:315}],scaleVariance:.2,lifetimeVariance:.08,blending:"normal",renderOrder:12}},glowColor:[.45,.75,1],glowIntensityMin:1.6,glowIntensityMax:2.8,glowFlickerRate:10,scaleVibration:.025,scaleFrequency:6,scaleContract:.05,tremor:.018,tremorFrequency:9});var Ss=hs({name:"icemist",emoji:"üå´Ô∏è",type:"blending",description:"Cold mist emanating outward from mascot",duration:3e3,beats:4,intensity:.7,category:"emanating",frost:.4,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.4,endScale:2.2,startDiameter:.5,endDiameter:2.5,orientation:"camera"},formation:{type:"stack",count:1,spacing:0},count:1,scale:1.3,models:["ice-ring"],animation:{appearAt:0,disappearAt:.85,enter:{type:"fade",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{frost:{start:.2,peak:.5,end:.3,curve:"bell"}},cutout:{strength:.55,primary:{pattern:3,scale:1.2,weight:1},secondary:{pattern:8,scale:1.5,weight:.4},blend:"multiply",travel:"radial",travelSpeed:.8,strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.3,softness:1.5}},grain:{type:3,strength:.2,scale:.35,speed:.6,blend:"multiply"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.4,sizeScale:1.5,progressCurve:"sustain"}],pulse:{amplitude:.08,frequency:2,easing:"easeInOut"},emissive:{min:.8,max:1.8,frequency:3,pattern:"sine"},blending:"normal",renderOrder:8,modelOverrides:{"ice-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.2,arcCount:1},orientationOverride:"camera"}}}},glowColor:[.4,.7,1],glowIntensityMin:.6,glowIntensityMax:1.2,glowFlickerRate:3,scaleVibration:.008,scaleFrequency:2,scaleGrowth:.01}),xs=hs({name:"iceshiver",emoji:"ü•∂",type:"blending",description:"Convulsive cold with frost forming on surface",duration:2500,beats:4,intensity:.9,category:"afflicted",frost:.5,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.1,cameraFacing:.3,clustering:.2,count:8,scale:.9,models:["crystal-small","crystal-medium","crystal-cluster"],minDistance:.1,animation:{appearAt:.05,disappearAt:.85,stagger:.04,enter:{type:"scale",duration:.12,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{frost:{start:.2,peak:.6,end:.3,curve:"bell"}},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:.8,max:1.8,frequency:8,pattern:"sine"},atmospherics:[{preset:"mist",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain"}],scaleVariance:.35,lifetimeVariance:.25,delayVariance:.1,blending:"normal",renderOrder:10}},shiverAmount:.015,shiverFrequency:14,glowColor:[.5,.75,1],glowIntensityMin:.8,glowIntensityMax:1.6,glowFlickerRate:10,scaleVibration:.018,scaleFrequency:10,scaleContract:.02,tremor:.012,tremorFrequency:14});function ks(e){return(43758.5453*Math.sin(e)%1+1)%1}function Os(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return ks(t)*(1-a)+ks(t+1)*a}function As(e){return{name:e.name,emoji:e.emoji,type:e.type,description:e.description,config:{duration:e.duration,beats:e.beats,intensity:e.intensity,...e},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:"afflicted"===e.category?1.5:1.3,offBeat:1,curve:"afflicted"===e.category?"sharp":"smooth"}},"3d":{evaluate(t,i){const a={...e,...i},s=t*a.duration/1e3,{category:n}=a;let r=1;if(a.buildupPhase&&t<a.buildupPhase&&(r=Math.pow(t/a.buildupPhase,.7)),"afflicted"!==n||a.buildupPhase||(a.flashPeak?t<a.flashPeak?r=Math.pow(t/a.flashPeak,.5):(r=1-(t-a.flashPeak)*(a.flashDecay||.5),r=Math.max(.3,r)):t<.2&&(r=t/.2)),"emanating"===n&&!a.buildupPhase)if(a.beaconPulse){const e=s*(a.pulseRate||1.5);r=.6+.4*Math.sin(e*Math.PI*2)}else r=Math.min(1,t/.15);"transform"===n&&!a.buildupPhase&&t<.25&&(r=Math.pow(t/.25,.7)),"manifestation"===n&&!a.buildupPhase&&t<.15&&(r=t/.15);const o=a.decayRate||.2;if(t>1-o){const e=(t-(1-o))/o;a.endFlash?r*=1-.99*e:r*=1-e*e}let l=0,h=0,c=0;if(a.riseAmount>0){const e=Math.pow(t,1+(a.ascendAcceleration||0));h+=a.riseAmount*e*r}if(a.floatAmount>0){const e=s*(a.floatSpeed||1);h+=Math.sin(e*Math.PI*2)*a.floatAmount*r}if(a.recoilAmount>0){const e=s*(a.recoilSpeed||2),t=Math.sin(e*Math.PI);c-=a.recoilAmount*t*r}if(a.driftAmount>0){const e=s*(a.driftSpeed||1);l+=(Os(e)-.5)*a.driftAmount*r,h+=(Os(e+50)-.5)*a.driftAmount*.5*r}if(a.tremor>0){const e=s*(a.tremorFrequency||4);l+=(Os(e)-.5)*a.tremor*r,h+=(Os(e+33)-.5)*a.tremor*.5*r}a.hover&&a.hoverAmount&&(h+=Math.sin(s*Math.PI*.5)*a.hoverAmount*r);let u=1;const d=s*(a.scaleFrequency||2);u=a.scalePulse?1+(.5*Math.sin(d*Math.PI*2)+.5-.5)*(a.scaleVibration||.01)*r:1+Math.sin(d*Math.PI*2)*(a.scaleVibration||.01)*r,a.scaleGrow>0&&(u+=a.scaleGrow*t*r),a.scaleShrink>0&&(u-=a.scaleShrink*t*r,u=Math.max(.1,u));let p=0;a.rotationSpeed>0&&(p=s*a.rotationSpeed*Math.PI*2*r),a.rotationDrift&&(p+=s*a.rotationDrift*r);let g=1;if(a.fadeOut){const e=a.fadeStartAt||.4,i=a.fadeEndAt||.9;if(t>=e){const s=Math.min(1,(t-e)/(i-e));g="accelerating"===a.fadeCurve?Math.max(0,1-Math.pow(s,2)):Math.max(0,1-s)}}const m=s*(a.glowFlickerRate||3);let y;y="afflicted"===n&&a.flashPeak?t<2*a.flashPeak?1+.3*Math.sin(m*Math.PI*4):.7+.2*Math.sin(m*Math.PI*2):a.beaconPulse?.4*Math.sin(m*Math.PI*2)+.6:.25*Math.sin(m*Math.PI*2)+.75;const f=a.glowIntensityMin||.8;return{position:[l,h,c],rotation:[0,p,0],scale:u,meshOpacity:g,glowIntensity:f+((a.glowIntensityMax||1.4)-f)*y*r,glowBoost:.4*r*a.intensity*(a.radiance||.5),glowColorOverride:r>.005?a.glowColor:null,lightOverlay:{enabled:r>.01,strength:r*a.intensity,radiance:a.radiance||.5,category:n,spawnMode:a.spawnMode||null,duration:a.duration,progress:t,time:s,animation:e.spawnMode?.animation,models:e.spawnMode?.models,count:e.spawnMode?.count,scale:e.spawnMode?.scale,embedDepth:e.spawnMode?.embedDepth,distortionStrength:e.distortionStrength}}}}}}var Cs=As({name:"lightblind",emoji:"‚òÄÔ∏è",type:"blending",description:"KAAAAZAAAM! Blinding pulsar flash bang ‚Äî overwhelming radiance",duration:600,beats:1,intensity:2,category:"afflicted",radiance:1,distortionStrength:.8,spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.1},orientation:"camera",startScale:.1,endScale:4,scaleEasing:"easeOutQuad"},count:1,scale:2.8,models:["light-burst"],animation:{appearAt:0,disappearAt:.35,enter:{type:"flash",duration:.01,easing:"linear"},exit:{type:"fade",duration:.12,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},pulse:{amplitude:.18,frequency:15,easing:"easeOut"},emissive:{min:2.5,max:4.5,frequency:18,pattern:"sine"},blending:"additive",renderOrder:20}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:4,scaleEasing:"easeOutCubic"},count:1,scale:2.2,models:["light-ring"],animation:{appearAt:.02,disappearAt:.3,enter:{type:"flash",duration:.01,easing:"linear"},exit:{type:"fade",duration:.1,easing:"easeIn"},emissive:{min:1.8,max:3.5,frequency:12,pattern:"sine"},blending:"additive",renderOrder:19,modelOverrides:{"light-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.15,endScale:3,scaleEasing:"easeOutCubic"},count:1,scale:1.8,models:["light-ring"],animation:{appearAt:.06,disappearAt:.35,enter:{type:"flash",duration:.01,easing:"linear"},exit:{type:"fade",duration:.12,easing:"easeIn"},emissive:{min:1.5,max:3,frequency:10,pattern:"sine"},blending:"additive",renderOrder:18,modelOverrides:{"light-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:8,radius:.1,endRadius:2.2,angleSpread:360,startAngle:0,orientation:"camera",startScale:.3,endScale:.9,scaleEasing:"easeOutQuad"},count:8,scale:.9,models:["sparkle-star"],animation:{appearAt:.01,disappearAt:.4,stagger:.003,enter:{type:"flash",duration:.01,easing:"linear"},exit:{type:"fade",duration:.12,easing:"easeIn"},emissive:{min:1.8,max:4,frequency:15,pattern:"sine"},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:1,sizeScale:2.5,progressCurve:"pulse"}],rotate:[{axis:"z",rotations:2.5,phase:0},{axis:"z",rotations:-3,phase:45},{axis:"z",rotations:3.5,phase:90},{axis:"z",rotations:-2.5,phase:135},{axis:"z",rotations:3,phase:180},{axis:"z",rotations:-3.5,phase:225},{axis:"z",rotations:2.5,phase:270},{axis:"z",rotations:-3,phase:315}],scaleVariance:.3,lifetimeVariance:.1,blending:"additive",renderOrder:21}}],decayRate:.08,endFlash:!0,glowColor:[1,.98,.9],glowIntensityMin:1.2,glowIntensityMax:2.5,glowFlickerRate:12,scaleVibration:.04,scaleFrequency:10,recoilAmount:.02,recoilSpeed:4}),Is=As({name:"lightpurify",emoji:"‚ú®",type:"blending",description:"Healing light converges inward, seals, and releases ‚Äî purifying curse and malady",duration:3e3,beats:5,intensity:1.1,category:"afflicted",radiance:.7,spawnMode:[{type:"orbit",orbit:{height:"center",endHeight:"center",radius:2.2,endRadius:.3,speed:2,easing:"easeOut",startScale:.5,endScale:1.3,orientation:"camera"},formation:{type:"ring",count:5},count:5,scale:1.2,models:["prism-shard","sparkle-star","prism-shard","sparkle-star","prism-shard"],animation:{appearAt:0,disappearAt:.6,stagger:.04,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"shrink",duration:.12,easing:"easeInCubic"},procedural:{scaleSmoothing:.08,geometryStability:!0},emissive:{min:.8,max:2.5,frequency:3,pattern:"sine"},pulse:{amplitude:.1,frequency:3,easing:"easeInOut"},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:.4,sizeScale:.8,progressCurve:"rampUp",velocityInheritance:.5}],rotate:[{axis:"y",rotations:1.5,phase:0},{axis:"x",rotations:-2,phase:72},{axis:"z",rotations:1.5,phase:144},{axis:"y",rotations:-2,phase:216},{axis:"x",rotations:1.5,phase:288}],scaleVariance:.2,lifetimeVariance:.1,blending:"additive",renderOrder:16}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.1,endScale:1.5,scaleEasing:"easeOutBack"},count:1,scale:1.3,models:["sun-ring"],animation:{appearAt:.25,disappearAt:.7,enter:{type:"scale",duration:.12,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.12,frequency:3,easing:"easeInOut"},emissive:{min:1,max:2.5,frequency:3,pattern:"sine"},rotate:{axis:"z",rotations:.5,phase:0},cutout:{strength:.5,primary:{pattern:6,scale:1.5,weight:1},secondary:{pattern:4,scale:2,weight:.5},blend:"add",travel:"angular",travelSpeed:.8,strengthCurve:"bell",bellPeakAt:.5,bellWidth:1,geometricMask:{type:"distance",core:.1,tip:.3}},grain:{type:3,strength:.2,scale:.4,speed:.5,blend:"multiply"},blending:"additive",renderOrder:14,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.8,arcCount:2},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:3,radius:.1,endRadius:1.2,angleSpread:360,startAngle:40,orientation:"camera",startScale:.4,endScale:.8,scaleEasing:"easeOutQuad"},count:3,scale:.8,models:["sparkle-star"],animation:{appearAt:.4,disappearAt:.7,stagger:.02,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.15,easing:"easeIn"},emissive:{min:1.3,max:2.5,frequency:5,pattern:"sine"},rotate:[{axis:"z",rotations:1,phase:0},{axis:"z",rotations:-1.5,phase:120},{axis:"z",rotations:1,phase:240}],scaleVariance:.25,blending:"additive",renderOrder:18}}],decayRate:.18,glowColor:[1,.92,.65],glowIntensityMin:.6,glowIntensityMax:1.3,glowFlickerRate:4,scaleVibration:.015,scaleFrequency:3,scalePulse:!0}),zs=As({name:"lightcleanse",emoji:"üåü",type:"blending",description:"Purifying wave of divine light sweeping upward ‚Äî chase malady, turn undead",duration:2500,beats:4,intensity:.9,category:"afflicted",radiance:.6,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"linear",startScale:1,endScale:1,startDiameter:1.6,endDiameter:1.6,orientation:"flat"},formation:{type:"stack",count:4,spacing:.08,phaseOffset:.03},count:4,scale:1,models:["sun-ring"],animation:{appearAt:0,disappearAt:.65,stagger:.08,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.06,frequency:2,easing:"easeInOut",sync:"global"},emissive:{min:1,max:2,frequency:2.5,pattern:"sine"},rotate:{axis:"z",rotations:.3,phase:0},atmospherics:[{preset:"firefly",targets:null,anchor:"above",intensity:.35,sizeScale:.8,progressCurve:"rampUp",velocityInheritance:.3}],scaleVariance:.05,lifetimeVariance:.05,blending:"additive",renderOrder:15,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:.5,arcCount:2},orientationOverride:"flat"}}}},decayRate:.2,glowColor:[1,.95,.8],glowIntensityMin:.6,glowIntensityMax:1.1,glowFlickerRate:3,scaleVibration:.008,scaleFrequency:2,scalePulse:!0,riseAmount:.006,riseSpeed:.5}),Fs=As({name:"lightradiate",emoji:"üí´",type:"blending",description:"Powerful divine radiance emanating in all directions like a sun",duration:2500,beats:4,intensity:1.4,category:"emanating",radiance:.9,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeInOut",startScale:1.2,endScale:1.6,startDiameter:1,endDiameter:1.8,orientation:"flat"},formation:{type:"spiral",count:4,spacing:.05,arcOffset:90,phaseOffset:0},count:4,scale:1.1,models:["sun-ring"],animation:{appearAt:0,disappearAt:.5,stagger:.03,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.12,frequency:4,easing:"easeInOut"},emissive:{min:1.2,max:2.8,frequency:5,pattern:"sine"},atmospherics:[{preset:"firefly",targets:null,anchor:"above",intensity:.5,sizeScale:1.2,progressCurve:"sustain",velocityInheritance:.4}],rotate:{axis:"z",rotations:.6,phase:0},blending:"additive",renderOrder:15,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.75,arcSpeed:1,arcCount:2},orientationOverride:"flat"}}}},{type:"radial-burst",radialBurst:{count:4,radius:.15,endRadius:1.2,angleSpread:360,startAngle:45,orientation:"camera",startScale:.4,endScale:1.5,scaleEasing:"easeOutQuad"},count:4,scale:1.3,models:["light-ray"],animation:{appearAt:.02,disappearAt:.55,stagger:.02,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.2,easing:"easeIn",burstScale:1.2},emissive:{min:1.3,max:2.5,frequency:4,pattern:"sine"},rotate:[{axis:"z",rotations:.5,phase:0},{axis:"z",rotations:-.5,phase:90},{axis:"z",rotations:.5,phase:180},{axis:"z",rotations:-.5,phase:270}],scaleVariance:.2,blending:"additive",renderOrder:17}}],decayRate:.15,glowColor:[1,.88,.5],glowIntensityMin:.8,glowIntensityMax:1.6,glowFlickerRate:5,scaleVibration:.025,scaleFrequency:4,scalePulse:!0,scaleExpand:.02}),Ds=As({name:"lightglow",emoji:"üí°",type:"blending",description:"Gentle inner warmth, barely-there radiance from within",duration:3500,beats:5,intensity:.6,category:"emanating",radiance:.4,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"center",radius:.8,endRadius:.9,speed:.5,easing:"linear",startScale:.8,endScale:1,orientation:"camera"},formation:{type:"ring",count:3},count:3,scale:.7,models:["sparkle-star","sparkle-star","sparkle-star"],animation:{appearAt:.05,disappearAt:.85,stagger:.08,enter:{type:"fade",duration:.2,easing:"easeInOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.15,geometryStability:!0},pulse:{amplitude:.1,frequency:1.5,easing:"easeInOut",sync:"global"},emissive:{min:.6,max:1.2,frequency:1.5,pattern:"sine"},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:.2,sizeScale:.4,progressCurve:"sustain"}],scaleVariance:.15,lifetimeVariance:.1,blending:"additive",renderOrder:10}},decayRate:.2,glowColor:[1,.9,.7],glowIntensityMin:.5,glowIntensityMax:.9,glowFlickerRate:2,scaleVibration:.008,scaleFrequency:1.5,scalePulse:!0,floatAmount:.003,floatSpeed:1}),qs=As({name:"lightbeacon",emoji:"üî¶",type:"blending",description:"Spinning lighthouse beacon with sweeping beam of divine light",duration:3e3,beats:4,intensity:.9,category:"emanating",radiance:.6,spawnMode:[{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.15,z:0},orientation:"camera",bob:{amplitude:.015,frequency:.5}},count:1,scale:.7,models:["sparkle-star"],animation:{appearAt:0,disappearAt:.75,enter:{type:"scale",duration:.15,easing:"easeOutBack"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.15,frequency:2.5,easing:"easeInOut"},emissive:{min:1,max:2,frequency:2.5,pattern:"sine"},rotate:{axis:"z",rotations:2,phase:0},atmospherics:[{preset:"firefly",targets:["sparkle-star"],anchor:"above",intensity:.4,sizeScale:.6,progressCurve:"sustain"}],blending:"additive",renderOrder:18,modelOverrides:{"sparkle-star":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:2.5,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.02,z:0},orientation:"flat"},count:1,scale:.8,models:["sun-ring"],animation:{appearAt:0,disappearAt:.75,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.12,geometryStability:!0},pulse:{amplitude:.06,frequency:1.5,easing:"easeInOut"},emissive:{min:.6,max:1.2,frequency:2.5,pattern:"sine"},rotate:{axis:"z",rotations:.4,phase:0},cutout:{strength:.4,primary:{pattern:6,scale:1.5,weight:1},secondary:{pattern:4,scale:2,weight:.3},blend:"add",travel:"angular",travelSpeed:.5,strengthCurve:"bell",bellPeakAt:.5},grain:{type:3,strength:.15,scale:.3,speed:.4,blend:"multiply"},blending:"additive",renderOrder:15,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:.4,arcCount:2},orientationOverride:"flat"}}}},{type:"radial-burst",radialBurst:{count:2,radius:.1,endRadius:.9,angleSpread:360,startAngle:0,orientation:"camera",startScale:.3,endScale:1.1,scaleEasing:"easeOutQuad"},count:2,scale:1,models:["light-ray"],animation:{appearAt:.05,disappearAt:.65,stagger:.04,enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:.6,max:1.5,frequency:2.5,pattern:"sine"},rotate:[{axis:"z",rotations:2,phase:0},{axis:"z",rotations:2,phase:180}],blending:"additive",renderOrder:17}},{type:"axis-travel",axisTravel:{axis:"y",start:"top",end:"center",easing:"easeIn",startScale:.5,endScale:.2,startDiameter:.2,endDiameter:.8,orientation:"camera"},formation:{type:"spiral",count:3,spacing:.05,arcOffset:120,phaseOffset:0},count:3,scale:.4,models:["sparkle-star"],animation:{appearAt:.1,disappearAt:.7,stagger:.1,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:.8,max:1.5,frequency:3,pattern:"sine"},scaleVariance:.3,lifetimeVariance:.15,blending:"additive",renderOrder:14}}],decayRate:.2,glowColor:[1,.95,.8],glowIntensityMin:.5,glowIntensityMax:1,glowFlickerRate:4,scaleVibration:.008,scaleFrequency:2.5,scalePulse:!0,tremor:.002,tremorFrequency:3}),Rs=As({name:"lightascend",emoji:"üëº",type:"blending",description:"Being beamed to heaven ‚Äî a portal descends and draws light upward",duration:3e3,beats:5,intensity:1.3,category:"transform",radiance:.85,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"above",end:"top",easing:"easeOut",startScale:1.5,endScale:1.2,startDiameter:2.5,endDiameter:1.8,orientation:"flat"},count:1,scale:1.4,models:["sun-ring"],animation:{appearAt:0,disappearAt:.7,enter:{type:"fade",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.1,frequency:2,easing:"easeInOut"},emissive:{min:1,max:2.5,frequency:2,pattern:"sine"},rotate:{axis:"z",rotations:.5,phase:0},cutout:{strength:.5,primary:{pattern:6,scale:1.5,weight:1},secondary:{pattern:4,scale:2,weight:.4},blend:"add",travel:"angular",travelSpeed:.8,strengthCurve:"bell",bellPeakAt:.5,bellWidth:1},grain:{type:3,strength:.15,scale:.3,speed:.6,blend:"multiply"},atmospherics:[{preset:"firefly",targets:null,anchor:"above",intensity:.6,sizeScale:1.2,progressCurve:"rampUp",velocityInheritance:.3}],blending:"additive",renderOrder:14,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:.8,arcCount:2},orientationOverride:"flat"}}}},{type:"orbit",orbit:{height:"bottom",endHeight:"above",radius:.8,endRadius:.3,speed:2,easing:"easeIn",startScale:.4,endScale:1,orientation:"camera"},formation:{type:"ring",count:5},count:5,scale:.8,models:["sparkle-star"],animation:{appearAt:.05,disappearAt:.65,stagger:.04,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},emissive:{min:1,max:2.8,frequency:4,pattern:"sine"},scaleVariance:.25,lifetimeVariance:.1,blending:"additive",renderOrder:16}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.1},orientation:"camera",startScale:.3,endScale:1.8,scaleEasing:"easeOutQuad"},count:1,scale:1.5,models:["light-burst"],animation:{appearAt:.1,disappearAt:.6,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.12,frequency:3,easing:"easeInOut"},emissive:{min:1.2,max:2.5,frequency:3,pattern:"sine"},blending:"additive",renderOrder:15}}],decayRate:.18,glowColor:[1,.95,.8],glowIntensityMin:.8,glowIntensityMax:1.5,glowFlickerRate:4,scaleVibration:.015,scaleFrequency:3,scalePulse:!0,riseAmount:.012,riseSpeed:.8}),Bs=As({name:"lightilluminate",emoji:"üîÜ",type:"blending",description:"Divine lantern blooming outward ‚Äî concentric waves of illumination",duration:2500,beats:4,intensity:1,category:"emanating",radiance:.65,spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:2,scaleEasing:"easeOutCubic"},count:1,scale:1.6,models:["sun-ring"],animation:{appearAt:0,disappearAt:.6,enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.06,frequency:2.5,easing:"easeInOut"},emissive:{min:1.2,max:2.2,frequency:2.5,pattern:"sine"},rotate:{axis:"z",rotations:.3,phase:0},cutout:{strength:.5,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:6,scale:1.5,weight:.4},blend:"add",travel:"radial",travelSpeed:.8,strengthCurve:"bell",bellPeakAt:.5},grain:{type:3,strength:.15,scale:.3,speed:.6,blend:"multiply"},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:.35,sizeScale:.8,progressCurve:"sustain"}],blending:"additive",renderOrder:14,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.85,arcSpeed:.5,arcCount:2},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.02},orientation:"camera",startScale:.15,endScale:2.5,scaleEasing:"easeOutCubic"},count:1,scale:1.3,models:["sun-ring"],animation:{appearAt:.08,disappearAt:.65,enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},pulse:{amplitude:.06,frequency:2.5,easing:"easeInOut"},emissive:{min:1,max:2,frequency:2.5,pattern:"sine"},rotate:{axis:"z",rotations:-.25,phase:0},blending:"additive",renderOrder:13,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.8,arcSpeed:.4,arcCount:2},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.1,endScale:3,scaleEasing:"easeOutCubic"},count:1,scale:1,models:["sun-ring"],animation:{appearAt:.16,disappearAt:.7,enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},pulse:{amplitude:.05,frequency:2.5,easing:"easeInOut"},emissive:{min:.8,max:1.8,frequency:2.5,pattern:"sine"},rotate:{axis:"z",rotations:.2,phase:0},blending:"additive",renderOrder:12,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.75,arcSpeed:.3,arcCount:2},orientationOverride:"camera"}}}},{type:"orbit",orbit:{height:"center",endHeight:"center",radius:.8,endRadius:1.2,speed:1,easing:"linear",startScale:.6,endScale:1,orientation:"camera"},formation:{type:"ring",count:4},count:4,scale:.9,models:["prism-shard"],animation:{appearAt:.05,disappearAt:.65,stagger:.03,enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:1,max:2.2,frequency:3,pattern:"sine"},rotate:[{axis:"y",rotations:1.5,phase:0},{axis:"x",rotations:-1.5,phase:90},{axis:"z",rotations:1.5,phase:180},{axis:"y",rotations:-1.5,phase:270}],scaleVariance:.2,blending:"additive",renderOrder:16}}],decayRate:.2,glowColor:[1,.95,.75],glowIntensityMin:.7,glowIntensityMax:1.3,glowFlickerRate:3,scaleVibration:.012,scaleFrequency:2.5,scalePulse:!0}),Es=As({name:"lightdissolve",emoji:"üí®",type:"blending",description:"Light fading reluctantly ‚Äî fragments scatter and dim unwillingly",duration:3e3,beats:4,intensity:.8,category:"transform",radiance:.5,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"above",radius:.4,endRadius:2.5,speed:1.5,easing:"easeOut",startScale:1.2,endScale:.3,orientation:"camera"},formation:{type:"ring",count:6},count:6,scale:1,models:["sparkle-star","prism-shard","sparkle-star","prism-shard","sparkle-star","prism-shard"],animation:{appearAt:0,disappearAt:.85,stagger:.04,enter:{type:"fade",duration:.05,easing:"easeOut"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.12,geometryStability:!0},emissive:{min:.4,max:2,frequency:2,pattern:"sine"},pulse:{amplitude:.06,frequency:1.5,easing:"easeInOut"},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:.3,sizeScale:.5,progressCurve:"fadeOut",velocityInheritance:.4}],rotate:[{axis:"z",rotations:1,phase:0},{axis:"z",rotations:-1.5,phase:60},{axis:"z",rotations:1,phase:120},{axis:"z",rotations:-1,phase:180},{axis:"z",rotations:1.5,phase:240},{axis:"z",rotations:-1,phase:300}],scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:15}},decayRate:.25,glowColor:[1,.92,.65],glowIntensityMin:.4,glowIntensityMax:1,glowFlickerRate:3,scaleVibration:.01,scaleFrequency:2,scalePulse:!0}),Ps=As({name:"lightmeditation",emoji:"üßò",type:"blending",description:"Meditative mandala of light with synchronized breathing pulse",duration:4e3,beats:4,intensity:.7,category:"emanating",radiance:.5,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"easeInOut",startScale:1,endScale:1,startDiameter:1.8,endDiameter:1.8,orientation:"camera"},formation:{type:"mandala",count:5,radius:.5,arcOffset:45,scales:[1,.6,.6,.6,.6]},count:5,scale:1.2,models:["sun-ring"],animation:{appearAt:0,disappearAt:.8,stagger:0,enter:{type:"fade",duration:.5,easing:"easeInOut"},exit:{type:"fade",duration:.4,easing:"easeInOut"},procedural:{scaleSmoothing:.15,geometryStability:!0},pulse:{amplitude:.15,frequency:1.5,easing:"easeInOut"},emissive:{min:.8,max:1.6,frequency:1.5,pattern:"sine"},cutout:{strength:.6,primary:{pattern:4,scale:2,weight:1},secondary:{pattern:6,scale:1.5,weight:.5},blend:"add",travel:"angular",travelSpeed:.6,strengthCurve:"bell",bellPeakAt:.5,bellWidth:1,geometricMask:{type:"distance",core:.1,tip:.3}},grain:{type:3,strength:.3,scale:.5,speed:.5,blend:"multiply"},atmospherics:[{preset:"firefly",targets:null,anchor:"above",intensity:.25,sizeScale:.6,speedScale:.5,progressCurve:"sustain"}],rotate:[{axis:"z",rotations:.4,phase:0},{axis:"z",rotations:-.35,phase:0},{axis:"z",rotations:.25,phase:0},{axis:"z",rotations:-.35,phase:0},{axis:"z",rotations:.4,phase:0}],scaleVariance:0,lifetimeVariance:0,blending:"additive",renderOrder:-5,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.5,arcCount:2},orientationOverride:"camera"}}}},decayRate:.2,glowColor:[1,.92,.65],glowIntensityMin:.6,glowIntensityMax:1,glowFlickerRate:2,scaleVibration:.004,scaleFrequency:1.5,scaleGrowth:0,rotationEffect:!1}),Ts=As({name:"lightcrown",emoji:"üëë",type:"blending",description:"Radiant golden halo floating above the head, emanating divine light",duration:3e3,beats:4,intensity:1,category:"manifestation",radiance:.7,spawnMode:{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.05,z:0},orientation:"flat",bob:{amplitude:.02,frequency:.3}},count:1,scale:1,models:["light-crown"],animation:{appearAt:0,disappearAt:.75,stagger:0,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.06,frequency:2,easing:"easeInOut"},emissive:{min:1.2,max:2,frequency:1.5,pattern:"sine"},rotate:{axis:"z",rotations:.5,phase:0},atmospherics:[{preset:"firefly",targets:["light-crown"],anchor:"above",intensity:.4,sizeScale:.6,progressCurve:"sustain"}],scaleVariance:0,lifetimeVariance:0,blending:"additive",renderOrder:15,modelOverrides:{"light-crown":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:.6,arcCount:3},orientationOverride:"flat"}}}},decayRate:.2,glowColor:[1,.92,.65],glowIntensityMin:.8,glowIntensityMax:1.4,glowFlickerRate:2,scaleVibration:.008,scaleFrequency:2,scalePulse:!0,rotationDrift:.01}),js=As({name:"lightdance",emoji:"üíÉ",type:"blending",description:"Rings of light ascending and spinning like golden coins",duration:1500,beats:3,intensity:1.3,category:"manifestation",radiance:.65,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.4,endScale:1.8,startDiameter:1.3,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["sun-ring"],animation:{appearAt:.02,disappearAt:.5,stagger:.02,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:1,max:2.2,frequency:6,pattern:"sine"},cutout:{strength:.55,primary:{pattern:5,scale:1,weight:.8},secondary:{pattern:6,scale:1.5,weight:.5},blend:"add",travel:"spiral",travelSpeed:2.5,strengthCurve:"bell",bellPeakAt:.5},grain:{type:3,strength:.08,scale:.15,speed:1,blend:"multiply"},atmospherics:[{preset:"firefly",targets:null,anchor:"above",intensity:.25,sizeScale:.7,progressCurve:"sustain",velocityInheritance:.4,centrifugal:{speed:.5,tangentialBias:.5}}],rotate:[{axis:"y",rotations:2,phase:0},{axis:"y",rotations:-2,phase:60},{axis:"y",rotations:3,phase:120}],scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:15,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}}}},decayRate:.2,glowColor:[1,.9,.55],glowIntensityMin:1.2,glowIntensityMax:2.5,glowFlickerRate:6,scaleVibration:.018,scaleFrequency:4,scaleGrowth:.025,rotationDrift:.01}),Vs=As({name:"lighthelix",emoji:"üß¨",type:"blending",description:"Double helix of light fragments counter-spiraling upward",duration:2e3,beats:4,intensity:1.2,category:"manifestation",radiance:.7,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeInOut",startScale:.7,endScale:1.8,startDiameter:.4,endDiameter:2.8,orientation:"camera"},formation:{type:"spiral",count:10,strands:2,spacing:.08,arcOffset:180,phaseOffset:.03},count:10,scale:1.2,models:["sun-ring","sparkle-star","prism-shard","sun-ring","prism-shard","sparkle-star","sun-ring","prism-shard","sparkle-star","sun-ring"],animation:{appearAt:0,disappearAt:.4,stagger:.02,enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.12,frequency:4,easing:"easeInOut",perElement:!0},emissive:{min:1,max:2,frequency:4,pattern:"sine"},cutout:{strength:.4,primary:{pattern:5,scale:1,weight:.7},secondary:{pattern:0,scale:.8,weight:.5},blend:"multiply",travel:"angular",travelSpeed:3,strengthCurve:"bell",bellPeakAt:.5,trailDissolve:{enabled:!0,offset:-.5,softness:1.5}},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:.35,sizeScale:.6,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:.8,tangentialBias:.4}}],rotate:[{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180},{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180},{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180},{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180},{axis:"y",rotations:4,phase:0},{axis:"y",rotations:-4,phase:180}],scaleVariance:.3,lifetimeVariance:.1,blending:"additive",renderOrder:15}},decayRate:.2,glowColor:[1,.92,.6],glowIntensityMin:.8,glowIntensityMax:1.4,glowFlickerRate:3,scaleVibration:.01,scaleFrequency:3,scalePulse:!0,rotationDrift:.01}),$s=As({name:"lightpillar",emoji:"üèõÔ∏è",type:"blending",description:"Vertical column of stacked light rings ‚Äî pillar of divine radiance",duration:2500,beats:4,intensity:1.2,category:"manifestation",radiance:.8,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"linear",startScale:1,endScale:1,startDiameter:1.2,endDiameter:1.2,orientation:"flat"},formation:{type:"stack",count:5,spacing:.3,phaseOffset:.04},count:5,scale:1.1,models:["sun-ring"],animation:{appearAt:0,disappearAt:.55,stagger:.04,enter:{type:"scale",duration:.12,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.06,frequency:2,easing:"easeInOut",sync:"global"},emissive:{min:1,max:2.2,frequency:2,pattern:"sine"},rotate:{axis:"z",rotations:.4,phase:0},cutout:{strength:.55,primary:{pattern:6,scale:1,weight:.8},secondary:{pattern:5,scale:1.5,weight:.4},blend:"add",travel:"linear",travelSpeed:1.2,strengthCurve:"bell",bellPeakAt:.5},grain:{type:3,strength:.15,scale:.2,speed:.8,blend:"multiply"},atmospherics:[{preset:"firefly",targets:["sun-ring"],anchor:"above",intensity:.4,sizeScale:1,progressCurve:"sustain"}],scaleVariance:.05,lifetimeVariance:.05,blending:"additive",renderOrder:15,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:.4,arcCount:2},orientationOverride:"flat"}}}},decayRate:.2,glowColor:[1,.95,.75],glowIntensityMin:.9,glowIntensityMax:1.5,glowFlickerRate:2,scaleVibration:.006,scaleFrequency:2,scalePulse:!0}),Ws=As({name:"lightdrill",emoji:"üî©",type:"blending",description:"Light rings drilling downward in a tight spiral",duration:1200,beats:2,intensity:1.5,category:"manifestation",radiance:.75,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"feet",end:"below",easing:"easeIn",startScale:1,endScale:.8,startDiameter:1.8,endDiameter:1.4,orientation:"vertical"},formation:{type:"spiral",count:6,spacing:.1,arcOffset:60,phaseOffset:0},count:6,scale:.8,models:["sun-ring"],animation:{appearAt:0,disappearAt:.6,stagger:.03,enter:{type:"fade",duration:.05,easing:"linear"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},pulse:{amplitude:.08,frequency:10,easing:"linear"},emissive:{min:1.5,max:3.5,frequency:12,pattern:"random"},cutout:{strength:.6,primary:{pattern:8,scale:2.5,weight:1},secondary:{pattern:3,scale:3,weight:.7},blend:"multiply",travel:"oscillate",travelSpeed:5,trailDissolve:{offset:.1,softness:.25}},grain:{type:2,strength:.1,scale:.1,speed:3,blend:"multiply"},atmospherics:[{preset:"firefly",targets:null,anchor:"above",intensity:.3,sizeScale:.7,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:1,tangentialBias:.3}}],rotate:{axis:"y",rotations:4,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"additive",renderOrder:15,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:3,arcCount:1},orientationOverride:"vertical"}}}},decayRate:.15,glowColor:[1,.9,.5],glowIntensityMin:1.3,glowIntensityMax:2.8,glowFlickerRate:10,scaleVibration:.02,scaleFrequency:8,scaleGrowth:.03,scalePulse:!0}),Gs=As({name:"lightflourish",emoji:"üåü",type:"blending",description:"Radial starburst of light fragments exploding outward from center",duration:1500,beats:4,intensity:1.4,category:"manifestation",radiance:.85,spawnMode:{type:"radial-burst",radialBurst:{center:"center",startRadius:.3,endRadius:2.5,easing:"easeOut",startScale:.5,endScale:1.4,orientation:"camera"},formation:{type:"ring",count:8},count:8,scale:1.2,models:["sun-ring","sparkle-star","prism-shard","sun-ring","sparkle-star","prism-shard","sun-ring","sparkle-star"],animation:{appearAt:0,disappearAt:.55,stagger:.01,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.2,easing:"easeIn",burstScale:1.3},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.1,frequency:6,easing:"easeInOut"},emissive:{min:1.2,max:2.5,frequency:5,pattern:"sine"},cutout:{strength:.5,primary:{pattern:5,scale:1,weight:.8},secondary:{pattern:1,scale:1.5,weight:.4},blend:"add",travel:"radial",travelSpeed:2,strengthCurve:"bell",bellPeakAt:.4},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:.4,sizeScale:1,progressCurve:"burst",velocityInheritance:.6}],rotate:[{axis:"z",rotations:1,phase:0},{axis:"z",rotations:-1.5,phase:45},{axis:"z",rotations:1,phase:90},{axis:"z",rotations:-1.5,phase:135},{axis:"z",rotations:1,phase:180},{axis:"z",rotations:-1.5,phase:225},{axis:"z",rotations:1,phase:270},{axis:"z",rotations:-1.5,phase:315}],scaleVariance:.25,lifetimeVariance:.15,blending:"additive",renderOrder:18}},decayRate:.15,glowColor:[1,.95,.7],glowIntensityMin:.9,glowIntensityMax:1.6,glowFlickerRate:6,scaleVibration:.02,scaleFrequency:4,scalePulse:!0}),Ls=As({name:"lightvortex",emoji:"üåÄ",type:"blending",description:"Spiraling tornado of divine light rings around mascot",duration:1500,beats:5,intensity:1.4,category:"manifestation",radiance:.75,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.4,endScale:1.7,startDiameter:.6,endDiameter:1.2,orientation:"flat"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["sun-ring"],animation:{appearAt:.05,disappearAt:.9,stagger:.02,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.12,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},flicker:{intensity:.4,rate:18,pattern:"random"},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1,max:2.5,frequency:8,pattern:"sine"},cutout:{strength:.7,primary:{pattern:6,scale:2.5,weight:1},secondary:{pattern:4,scale:1.8,weight:.5},blend:"add",travel:"spiral",travelSpeed:4,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.5,geometricMask:{type:"distance",core:.1,tip:.25}},grain:{type:2,strength:.12,scale:.15,speed:2.5,blend:"multiply"},atmospherics:[{preset:"firefly",targets:null,anchor:"above",intensity:.3,sizeScale:.8,progressCurve:"sustain"}],scaleVariance:.2,lifetimeVariance:.15,blending:"additive",renderOrder:15,intensityScaling:{scale:1.4,emissiveMax:1.6,pulseAmplitude:1.3},modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:6,arcCount:1},scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.1},y:{expand:!1,rate:.3},z:{expand:!0,rate:1.1}}},orientationOverride:"flat"}}}},decayRate:.2,glowColor:[1,.95,.7],glowIntensityMin:1,glowIntensityMax:2.2,glowFlickerRate:8,scaleVibration:.02,scaleFrequency:4,scalePulse:!0}),_s=As({name:"lightbarrage",emoji:"üèπ",type:"blending",description:"Light fragments orbit mascot then launch outward",duration:1500,beats:4,intensity:1.4,category:"manifestation",radiance:.8,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"above",radius:1.2,endRadius:2.8,speed:3,easing:"easeIn",startScale:1,endScale:.6,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.4,models:["prism-shard","sparkle-star","light-ray","prism-shard","sparkle-star"],animation:{appearAt:0,disappearAt:.65,stagger:.04,enter:{type:"scale",duration:.1,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.3},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:1,max:2.5,frequency:4,pattern:"sine"},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:.4,sizeScale:1.2,progressCurve:"sustain",velocityInheritance:.6}],rotate:[{axis:"x",rotations:2,phase:0},{axis:"y",rotations:-3,phase:40},{axis:"z",rotations:2.5,phase:100},{axis:"x",rotations:-2,phase:180},{axis:"y",rotations:3,phase:250}],scaleVariance:.2,lifetimeVariance:.1,blending:"additive",renderOrder:18}},decayRate:.2,glowColor:[1,.95,.65],glowIntensityMin:.9,glowIntensityMax:1.6,glowFlickerRate:6,scaleVibration:.012,scaleFrequency:4,scalePulse:!0}),Hs=As({name:"lightimpact",emoji:"üí•",type:"blending",description:"Light fragments converge inward to strike the mascot",duration:1500,beats:4,intensity:1.5,category:"manifestation",radiance:.85,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"center",radius:2.5,endRadius:.5,speed:2,easing:"easeOut",startScale:.6,endScale:1.3,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.4,models:["prism-shard","light-ray","sparkle-star","prism-shard","light-ray"],animation:{appearAt:0,disappearAt:.65,stagger:.03,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"shrink",duration:.1,easing:"easeInCubic"},procedural:{scaleSmoothing:.06,geometryStability:!0},pulse:{amplitude:.12,frequency:6,easing:"easeIn"},emissive:{min:1.2,max:2.8,frequency:5,pattern:"sine"},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:.5,sizeScale:1.4,progressCurve:"rampUp",velocityInheritance:.5}],rotate:[{axis:"y",rotations:2,phase:0},{axis:"x",rotations:-2.5,phase:72},{axis:"z",rotations:3,phase:144},{axis:"y",rotations:-2,phase:216},{axis:"x",rotations:2.5,phase:288}],scaleVariance:.15,lifetimeVariance:.08,blending:"additive",renderOrder:18}},decayRate:.15,glowColor:[1,.9,.55],glowIntensityMin:1,glowIntensityMax:1.8,glowFlickerRate:8,scaleVibration:.02,scaleFrequency:5,scalePulse:!0}),Us=As({name:"lightblast",emoji:"üí•",type:"blending",description:"Divine detonation with heavy screen-warping distortion ‚Äî light bends reality",duration:900,beats:2,intensity:1.8,category:"manifestation",radiance:1,distortionStrength:2.5,spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.1},orientation:"camera",startScale:.15,endScale:3.5,scaleEasing:"easeOutQuad"},count:1,scale:2.5,models:["light-burst"],animation:{appearAt:0,disappearAt:.35,enter:{type:"flash",duration:.02,easing:"linear"},exit:{type:"fade",duration:.12,easing:"easeIn"},procedural:{scaleSmoothing:.02,geometryStability:!0},pulse:{amplitude:.15,frequency:12,easing:"easeOut"},emissive:{min:2.5,max:4.5,frequency:10,pattern:"sine"},atmospherics:[{preset:"firefly",targets:null,anchor:"around",intensity:1,sizeScale:2.5,progressCurve:"pulse"}],blending:"additive",renderOrder:18}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera",startScale:.2,endScale:4,scaleEasing:"easeOutCubic"},count:1,scale:2,models:["light-ring"],animation:{appearAt:0,disappearAt:.3,enter:{type:"flash",duration:.02,easing:"linear"},exit:{type:"fade",duration:.1,easing:"easeIn"},emissive:{min:1.8,max:3.5,frequency:10,pattern:"sine"},blending:"additive",renderOrder:16,modelOverrides:{"light-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.15,endScale:3.5,scaleEasing:"easeOutCubic"},count:1,scale:1.6,models:["light-ring"],animation:{appearAt:.06,disappearAt:.35,enter:{type:"flash",duration:.02,easing:"linear"},exit:{type:"fade",duration:.12,easing:"easeIn"},emissive:{min:1.5,max:3,frequency:8,pattern:"sine"},blending:"additive",renderOrder:15,modelOverrides:{"light-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:8,radius:.1,endRadius:2,angleSpread:360,startAngle:22,orientation:"camera",startScale:.2,endScale:1.1,scaleEasing:"easeOutQuad"},count:8,scale:1,models:["prism-shard"],animation:{appearAt:.02,disappearAt:.4,stagger:.005,enter:{type:"scale",duration:.02,easing:"easeOut"},exit:{type:"burst-fade",duration:.12,easing:"easeIn",burstScale:1.3},emissive:{min:1.5,max:3,frequency:10,pattern:"sine"},rotate:[{axis:"z",rotations:2,phase:0},{axis:"z",rotations:-2.5,phase:45},{axis:"z",rotations:3,phase:90},{axis:"z",rotations:-2,phase:135},{axis:"z",rotations:2.5,phase:180},{axis:"z",rotations:-3,phase:225},{axis:"z",rotations:2,phase:270},{axis:"z",rotations:-2.5,phase:315}],scaleVariance:.3,lifetimeVariance:.1,blending:"additive",renderOrder:19}},{type:"radial-burst",radialBurst:{count:4,radius:.2,endRadius:1.5,angleSpread:360,startAngle:67,orientation:"camera",startScale:.3,endScale:.6,scaleEasing:"easeOutQuad"},count:4,scale:.7,models:["sparkle-star"],animation:{appearAt:.03,disappearAt:.45,stagger:.008,enter:{type:"flash",duration:.02,easing:"linear"},exit:{type:"fade",duration:.15,easing:"easeIn"},emissive:{min:1.3,max:2.8,frequency:8,pattern:"sine"},rotate:[{axis:"z",rotations:1.5,phase:0},{axis:"z",rotations:-2,phase:90},{axis:"z",rotations:1.5,phase:180},{axis:"z",rotations:-1.5,phase:270}],scaleVariance:.25,blending:"additive",renderOrder:20}}],decayRate:.1,endFlash:!0,glowColor:[1,.95,.6],glowIntensityMin:1.2,glowIntensityMax:2.5,glowFlickerRate:12,scaleVibration:.05,scaleFrequency:10,scalePulse:!0,recoilAmount:.02,recoilSpeed:4}),Qs=As({name:"lightsurge",emoji:"‚ö°",type:"blending",description:"Divine energy geyser ‚Äî light erupts vertically in a surging plume",duration:1500,beats:3,intensity:1.3,category:"emanating",radiance:.8,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeOut",startScale:1.4,endScale:.9,startDiameter:2,endDiameter:1,orientation:"flat"},formation:{type:"stack",count:3,spacing:.1,phaseOffset:.03},count:3,scale:1.2,models:["sun-ring"],animation:{appearAt:0,disappearAt:.55,stagger:.04,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.2,easing:"easeIn"},procedural:{scaleSmoothing:.06,geometryStability:!0},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:1.2,max:2.5,frequency:6,pattern:"sine"},atmospherics:[{preset:"firefly",targets:null,anchor:"above",intensity:.4,sizeScale:1,progressCurve:"rampUp",velocityInheritance:.5}],rotate:{axis:"z",rotations:.5,phase:0},blending:"additive",renderOrder:15,modelOverrides:{"sun-ring":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:2,arcCount:1},orientationOverride:"flat"}}}},{type:"radial-burst",radialBurst:{count:3,radius:.1,endRadius:.6,angleSpread:120,startAngle:60,orientation:"camera",startScale:.4,endScale:.7,scaleEasing:"easeOutQuad"},count:3,scale:.7,models:["sparkle-star"],animation:{appearAt:.15,disappearAt:.5,stagger:.03,enter:{type:"scale",duration:.04,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:1.3,max:2.5,frequency:8,pattern:"sine"},drift:{speed:.8,distance:.4,direction:{x:0,y:1,z:0},easing:"easeOut"},scaleVariance:.25,blending:"additive",renderOrder:17}}],decayRate:.15,glowColor:[1,.95,.7],glowIntensityMin:.8,glowIntensityMax:1.6,glowFlickerRate:5,scaleVibration:.015,scaleFrequency:4,scalePulse:!0});const Ys={infect:{name:"poisonInfect",emoji:"ü¶†",type:"blending",description:"Poison spreading through body, veins turning toxic",duration:3500,beats:5,intensity:1,category:"afflicted",toxicity:.7,spreadRate:.4,spreadFromCenter:!1,veinPattern:!0,glowColor:[.3,.8,.2],glowIntensityMin:.5,glowIntensityMax:.85,glowFlickerRate:4,scaleVibration:.02,scaleFrequency:3,scaleSwell:.015,tremor:.006,tremorFrequency:7,decayRate:.18},sicken:{name:"poisonSicken",emoji:"ü§¢",type:"blending",description:"Nausea and weakness, poisoned feeling",duration:3e3,beats:4,intensity:.7,category:"afflicted",toxicity:.5,wobbleAmount:.025,wobbleSpeed:2,nauseaWave:!0,glowColor:[.5,.75,.35],glowIntensityMin:.55,glowIntensityMax:.8,glowFlickerRate:3,scaleVibration:.025,scaleFrequency:4,swayAmount:.012,swaySpeed:1.5,droopAmount:.008,droopAcceleration:.4,decayRate:.2},ooze:{name:"poisonOoze",emoji:"ü´†",type:"blending",description:"Toxic slime dripping off body",duration:3200,beats:4,intensity:.9,category:"emanating",toxicity:.65,dripRate:.5,dripSpeed:1.2,slimeTrail:!0,glowColor:[.35,.85,.25],glowIntensityMin:.6,glowIntensityMax:.95,glowFlickerRate:5,scaleVibration:.018,scaleFrequency:3,droopAmount:.01,droopAcceleration:.3,decayRate:.18},seep:{name:"poisonSeep",emoji:"üíß",type:"blending",description:"Poison slowly leaking out",duration:4e3,beats:6,intensity:.6,category:"emanating",toxicity:.4,leakRate:.25,seepPattern:!0,glowColor:[.4,.7,.3],glowIntensityMin:.6,glowIntensityMax:.85,glowFlickerRate:2,scaleVibration:.01,scaleFrequency:2,scaleShrink:.01,droopAmount:.006,droopAcceleration:.2,decayRate:.22},toxic:{name:"poisonToxic",emoji:"‚ò†Ô∏è",type:"blending",description:"Toxic cloud surrounding, poisonous aura",duration:3e3,beats:4,intensity:1.1,category:"emanating",toxicity:.8,cloudSpread:.5,cloudDensity:.7,bubbleEffect:!0,glowColor:[.25,.9,.2],glowIntensityMin:.55,glowIntensityMax:1,glowFlickerRate:6,scaleVibration:.03,scaleFrequency:4,scalePulse:!0,floatAmount:.004,floatSpeed:1.5,decayRate:.15},corrode:{name:"poisonCorrode",emoji:"üî•",type:"blending",description:"Acid eating away at form, corrosion spreading",duration:3500,beats:5,intensity:1.3,category:"transform",toxicity:.85,corrosionRate:.5,etchPattern:!0,glowColor:[.6,.85,.15],glowIntensityMin:.6,glowIntensityMax:1.1,glowFlickerRate:7,scaleVibration:.025,scaleFrequency:5,scaleShrink:.04,jitterAmount:.008,jitterFrequency:10,decayRate:.15},melt:{name:"poisonMelt",emoji:"ü´†",type:"blending",description:"Melting from acid, losing form",duration:3e3,beats:4,intensity:1.4,category:"transform",toxicity:.9,meltRate:.6,meltFromTop:!0,glowColor:[.5,.9,.2],glowIntensityMin:.65,glowIntensityMax:1.15,glowFlickerRate:5,scaleVibration:.03,scaleFrequency:3,scaleShrink:.08,scaleSquash:!0,droopAmount:.02,droopAcceleration:.5,fadeOut:!0,fadeStartAt:.5,fadeEndAt:.95,fadeCurve:"accelerating",decayRate:.1},decay:{name:"poisonDecay",emoji:"üçÇ",type:"blending",description:"Rotting and decomposing, falling apart",duration:4e3,beats:6,intensity:1,category:"transform",toxicity:.7,decayPattern:"organic",crumbleRate:.35,glowColor:[.45,.6,.25],glowIntensityMin:.5,glowIntensityMax:.8,glowFlickerRate:3,scaleVibration:.02,scaleFrequency:4,scaleShrink:.05,droopAmount:.015,droopAcceleration:.4,tremor:.005,tremorFrequency:6,fadeOut:!0,fadeStartAt:.4,fadeEndAt:.9,fadeCurve:"smooth",decayRate:.12},dissolve:{name:"poisonDissolve",emoji:"üíÄ",type:"blending",description:"Dissolving into toxic puddle",duration:2800,beats:4,intensity:1.5,category:"transform",toxicity:.95,dissolveRate:.7,puddleSpread:!0,glowColor:[.4,.95,.2],glowIntensityMin:.7,glowIntensityMax:1.2,glowFlickerRate:8,scaleVibration:.035,scaleFrequency:6,scaleShrink:.12,scaleSquash:!0,droopAmount:.025,droopAcceleration:.6,fadeOut:!0,fadeStartAt:.3,fadeEndAt:.9,fadeCurve:"accelerating",decayRate:.08}};function Xs(e){return(43758.5453*Math.sin(e)%1+1)%1}function Ns(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return Xs(t)*(1-a)+Xs(t+1)*a}function Js(e){const t=Ys[e];return t?{name:t.name,emoji:t.emoji,type:t.type,description:t.description,config:{duration:t.duration,beats:t.beats,intensity:t.intensity,...t},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:"transform"===t.category?1.4:1.2,offBeat:1,curve:"smooth"}},"3d":{evaluate(e,i){const a={...t,...i},s=e*a.duration/1e3,{category:n}=a;let r=1;"afflicted"===n&&(e<.2&&(r=e/.2),a.nauseaWave)&&(r*=1+.15*Math.sin(s*Math.PI*2)),"emanating"===n&&(e<.15&&(r=e/.15),a.bubbleEffect)&&(r*=.1*Math.sin(s*Math.PI*4)+.9),"transform"===n&&(r=Math.pow(e,.7)),e>1-a.decayRate&&(r*=1-(e-(1-a.decayRate))/a.decayRate);let o=0,l=0,h=0;if(a.droopAmount>0){const t=e*(1+a.droopAcceleration*e);l-=a.droopAmount*t*r}if(a.swayAmount>0){const e=s*a.swaySpeed;o+=Math.sin(e*Math.PI*2)*a.swayAmount*r,h+=Math.cos(e*Math.PI*1.7)*a.swayAmount*.5*r}if(a.wobbleAmount>0){const e=s*a.wobbleSpeed;o+=Math.sin(e*Math.PI*2)*a.wobbleAmount*r,l+=Math.sin(e*Math.PI*3.1+1)*a.wobbleAmount*.3*r}if(a.tremor>0){const e=s*a.tremorFrequency;o+=(Ns(e)-.5)*a.tremor*r,l+=(Ns(e+50)-.5)*a.tremor*.5*r}if(a.jitterAmount>0){const e=s*a.jitterFrequency;o+=(Ns(e)-.5)*a.jitterAmount*r,l+=(Ns(e+33)-.5)*a.jitterAmount*.5*r}if(a.floatAmount>0){const e=s*a.floatSpeed;l+=Math.sin(e*Math.PI*2)*a.floatAmount*r}let c=1,u=1;const d=s*a.scaleFrequency;if(c=a.scalePulse?1+(.5*Math.sin(d*Math.PI*2)+.5-.5)*a.scaleVibration*r:1+(.6*Math.sin(d*Math.PI*2)+.4*Math.sin(d*Math.PI*3.3))*a.scaleVibration*r,a.scaleSwell>0&&(c+=a.scaleSwell*e*r),a.scaleShrink>0){const t="transform"===n?Math.pow(e,1.3):e;c-=a.scaleShrink*t*r}u=a.scaleSquash?c*(1-.4*e*r):c,c=Math.max(.1,c),u=Math.max(.1,u);let p=1;if(a.fadeOut){const t=a.fadeStartAt||.4,i=a.fadeEndAt||.9;if(e>=t){const s=Math.min(1,(e-t)/(i-t));let n;n="accelerating"===a.fadeCurve?1-Math.pow(s,2):1-s,p=Math.max(0,n)}}const g=s*a.glowFlickerRate;let m;m=a.bubbleEffect?.5+.25*Math.sin(g*Math.PI*2)+.2*Math.sin(g*Math.PI*3.3+1):.25*Math.sin(g*Math.PI*2)+.75;const y=a.glowIntensityMin+(a.glowIntensityMax-a.glowIntensityMin)*m*r,f=.2*r*a.intensity*a.toxicity;return{poisonOverlay:{enabled:r>.1,strength:r*a.intensity,toxicity:a.toxicity,category:a.category,time:s},position:[o,l,h],rotation:[0,0,0],scale:c,scaleY:a.scaleSquash?u:void 0,meshOpacity:p,glowIntensity:y,glowBoost:f,glowColorOverride:a.glowColor}}}}:Js("infect")}const Zs=Js("infect"),Ks=Js("sicken"),en=Js("ooze"),tn=Js("seep"),an=Js("toxic"),sn=Js("corrode"),nn=Js("melt"),rn=Js("decay"),on=Js("dissolve");function ln(e){return(43758.5453*Math.sin(e)%1+1)%1}function hn(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return ln(t)*(1-a)+ln(t+1)*a}function cn(e){return{name:e.name,emoji:e.emoji,type:e.type,description:e.description,config:{duration:e.duration,beats:e.beats,intensity:e.intensity,...e},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:"emanating"===e.category?1.5:1.2,offBeat:1,curve:"emanating"===e.category?"sharp":"smooth"}},"3d":{evaluate(t,i){const a={...e,...i},s=t*a.duration/1e3,{category:n}=a;let r=1;if(a.buildupPhase&&t<a.buildupPhase&&(r=Math.pow(t/a.buildupPhase,.7)),"afflicted"!==n||a.buildupPhase||t<.2&&(r=t/.2),"emanating"===n&&!a.buildupPhase)if(a.beaconPulse){const e=s*(a.pulseRate||1);r=.6+.4*Math.sin(e*Math.PI*2)}else r=Math.min(1,t/.1);"transform"!==n||a.buildupPhase||(a.shatterPoint?t<a.shatterPoint&&(r=Math.pow(t/a.shatterPoint,.5)):r=Math.min(1,t/.25)),"manifestation"===n&&!a.buildupPhase&&t<.15&&(r=t/.15);const o=a.decayRate||.2;if(t>1-o){const e=(t-(1-o))/o;a.endFlash?r*=1-.99*e:r*=1-e*e}let l=0,h=0,c=0;if(a.shakeAmount>0){const e=s*(a.shakeFrequency||15);let i=a.shakeAmount*r;a.shatterPoint&&t>a.shatterPoint&&(i*=1+(t-a.shatterPoint)/(1-a.shatterPoint)*(a.explosionForce||.5)),l+=(hn(e)-.5)*i,h+=(hn(e+33)-.5)*i*.7,c+=(hn(e+66)-.5)*i*.5}if(a.tremor>0){let e=a.tremor;a.tremorDecay&&(e*=1-t*a.tremorDecay);const i=s*(a.tremorFrequency||4);l+=(hn(i)-.5)*e*r,h+=(hn(i+50)-.5)*e*.5*r}if(a.sinkAmount>0){const e=t*(1+(a.sinkAcceleration||0)*t);h-=a.sinkAmount*e*r}if(a.driftAmount>0){const e=s*(a.driftSpeed||1);l+=(hn(e)-.5)*a.driftAmount*r,h+=(hn(e+50)-.5)*a.driftAmount*.5*r}a.hover&&a.hoverAmount&&(h+=Math.sin(s*Math.PI*.5)*a.hoverAmount*r);let u=1;const d=s*(a.scaleFrequency||2);u=a.scalePulse?1+(.5*Math.sin(d*Math.PI*2)+.5-.5)*(a.scaleVibration||.01)*r:1+Math.sin(d*Math.PI*2)*(a.scaleVibration||.01)*r,a.scaleGrow>0&&(u+=a.scaleGrow*t*r),a.scaleShrink>0&&(u-=a.scaleShrink*t*r,u=Math.max(.1,u)),a.scaleContract>0&&(u-=a.scaleContract*t*r);let p=0;a.rotationSpeed>0&&(p=s*a.rotationSpeed*Math.PI*2*r),a.rotationDrift&&(p+=s*a.rotationDrift*r);let g=1;if(a.fadeOut){const e=a.fadeStartAt||.5,i=a.fadeEndAt||.95;if(t>=e){const s=Math.min(1,(t-e)/(i-e));g="accelerating"===a.fadeCurve?Math.max(0,1-Math.pow(s,2)):Math.max(0,1-s)}}const m=s*(a.glowFlickerRate||2);let y;"emanating"===n?(y=.3*Math.sin(m*Math.PI*2)+.7,y*=.8+.4*ln(Math.floor(3*m))):y=a.shatterPoint&&t>a.shatterPoint?1+.5*hn(5*m):.2*Math.sin(m*Math.PI*2)+.8;const f=a.glowIntensityMin||.5;return{position:[l,h,c],rotation:[0,p,0],scale:u,meshOpacity:g,glowIntensity:f+((a.glowIntensityMax||.8)-f)*y*r,glowBoost:-.15*r*a.intensity*(a.petrification||.5),glowColorOverride:r>.005?a.glowColor:null,earthOverlay:{enabled:r>.01,strength:r*a.intensity,petrification:a.petrification||.5,category:n,spawnMode:a.spawnMode||null,duration:a.duration,progress:t,time:s,animation:e.spawnMode?.animation,models:e.spawnMode?.models,count:e.spawnMode?.count,scale:e.spawnMode?.scale,embedDepth:e.spawnMode?.embedDepth,distortionStrength:e.distortionStrength}}}}}}var un=cn({name:"earthpetrify",emoji:"üóø",type:"blending",description:"Rocks converge from all sides, entombing the mascot in a stone prison",duration:3500,beats:5,intensity:1.2,category:"afflicted",petrification:.95,spawnMode:[{type:"anchor",anchor:{landmark:"feet",offset:{x:0,y:-.02,z:0},orientation:"flat",startScale:.3,endScale:1.2,scaleEasing:"easeOutQuad"},count:1,scale:2,models:["earth-ring"],animation:{appearAt:0,disappearAt:.85,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},emissive:{min:.5,max:1,frequency:1.5,pattern:"sine"},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"above",intensity:.3,sizeScale:1.5,progressCurve:"buildup"}],blending:"normal",renderOrder:4,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.8,arcSpeed:.5,arcCount:2},orientationOverride:"flat"}}}},{type:"orbit",orbit:{height:"center",endHeight:"center",radius:1.8,endRadius:.35,speed:1.5,easing:"easeInQuad",startScale:.5,endScale:1,orientation:"camera"},count:5,scale:.8,models:["boulder","rock-cluster","stone-slab","rock-chunk-medium","boulder"],animation:{appearAt:.05,disappearAt:.75,stagger:.06,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.2,easing:"easeIn"},parameterAnimation:{petrification:{start:.3,peak:.95,end:.9,curve:"fadeIn"}},pulse:{amplitude:.03,frequency:1,easing:"easeInOut",sync:"global"},emissive:{min:.4,max:.9,frequency:1.5,pattern:"sine"},rotate:[{axis:"x",rotations:-.8,phase:0},{axis:"z",rotations:.6,phase:72},{axis:"y",rotations:-.5,phase:144},{axis:"x",rotations:.7,phase:216},{axis:"z",rotations:-.6,phase:288}],atmospherics:[{preset:"earth-dust",targets:null,anchor:"around",intensity:.4,sizeScale:.8,progressCurve:"buildup"}],scaleVariance:.25,lifetimeVariance:.1,blending:"normal",renderOrder:8}},{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.1,z:0},orientation:"flat",startScale:.1,endScale:1,scaleEasing:"easeOutQuad"},count:1,scale:1.5,models:["stone-slab"],animation:{appearAt:.5,disappearAt:.85,enter:{type:"scale",duration:.15,easing:"easeOutBounce"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:.6,max:1.2,frequency:1,pattern:"sine"},atmospherics:[{preset:"earth-gravel",targets:["stone-slab"],anchor:"below",intensity:.4,sizeScale:.6,progressCurve:"burst"}],blending:"normal",renderOrder:12}},{type:"anchor",anchor:{landmark:"feet",offset:{x:0,y:-.05,z:0},orientation:"flat",startScale:.2,endScale:1,scaleEasing:"easeOutQuad"},count:1,scale:1.6,models:["stone-slab"],animation:{appearAt:.35,disappearAt:.85,enter:{type:"scale",duration:.2,easing:"easeOutQuad"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:.4,max:.8,frequency:1,pattern:"sine"},atmospherics:[{preset:"earth-dust",targets:["stone-slab"],anchor:"above",intensity:.2,sizeScale:1,progressCurve:"sustain"}],blending:"normal",renderOrder:4}}],sinkAmount:.02,sinkAcceleration:.4,scaleContract:.015,decayRate:.2,glowColor:[.65,.45,.2],glowIntensityMin:.3,glowIntensityMax:.7,glowFlickerRate:1,tremor:.008,tremorFrequency:3,tremorDecay:.7}),dn=cn({name:"earthburden",emoji:"‚¨áÔ∏è",type:"blending",description:"Stone slabs stack on the mascot, each adding more crushing weight",duration:3e3,beats:4,intensity:.9,category:"afflicted",petrification:.5,spawnMode:[{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.08,z:0},orientation:"flat",startScale:.3,endScale:1,scaleEasing:"easeOutQuad"},count:1,scale:1.6,models:["stone-slab"],animation:{appearAt:0,disappearAt:.85,enter:{type:"scale",duration:.2,easing:"easeOutBounce"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:.3,max:.6,frequency:.8,pattern:"sine"},rotate:{axis:"z",rotations:.001,phase:0},atmospherics:[{preset:"earth-dust",targets:["stone-slab"],anchor:"above",intensity:.15,sizeScale:.6,progressCurve:"sustain"}],blending:"normal",renderOrder:10}},{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.2,z:0},orientation:"flat",startScale:.2,endScale:1,scaleEasing:"easeOutQuad"},count:1,scale:1.1,models:["stone-slab"],animation:{appearAt:.15,disappearAt:.8,enter:{type:"scale",duration:.2,easing:"easeOutBounce"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:.3,max:.6,frequency:.8,pattern:"sine"},rotate:{axis:"z",rotations:.001,phase:45},atmospherics:[{preset:"earth-gravel",targets:["stone-slab"],anchor:"below",intensity:.2,sizeScale:.5,progressCurve:"burst"}],blending:"normal",renderOrder:11}},{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.32,z:0},orientation:"flat",startScale:.2,endScale:1,scaleEasing:"easeOutQuad"},count:1,scale:1.4,models:["stone-slab"],animation:{appearAt:.3,disappearAt:.75,enter:{type:"scale",duration:.2,easing:"easeOutBounce"},exit:{type:"fade",duration:.2,easing:"easeIn"},emissive:{min:.4,max:.7,frequency:1,pattern:"sine"},rotate:{axis:"z",rotations:.001,phase:-30},atmospherics:[{preset:"earth-dust",targets:["stone-slab"],anchor:"above",intensity:.3,sizeScale:.8,progressCurve:"burst"},{preset:"earth-gravel",targets:["stone-slab"],anchor:"below",intensity:.25,sizeScale:.6,progressCurve:"burst"}],blending:"normal",renderOrder:12}}],sinkAmount:.03,sinkAcceleration:.5,decayRate:.2,glowColor:[.7,.5,.25],glowIntensityMin:.3,glowIntensityMax:.5,tremor:.006,tremorFrequency:2}),pn=cn({name:"earthrumble",emoji:"ü´®",type:"blending",description:"Grinding mandala of stone rings trembling at ground level",duration:2500,beats:4,intensity:1.2,category:"emanating",petrification:.4,spawnMode:[{type:"anchor",anchor:{landmark:"feet",offset:{x:0,y:.05,z:0},orientation:"flat",startScale:.5,endScale:1,scaleEasing:"easeOutQuad"},count:1,scale:2,models:["earth-ring"],animation:{appearAt:0,disappearAt:.8,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},pulse:{amplitude:.2,frequency:2,easing:"easeInOut",sync:"global"},emissive:{min:.6,max:1.2,frequency:2,pattern:"sine"},rotate:{axis:"z",rotations:1.5,phase:0},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"above",intensity:.5,sizeScale:1.5,progressCurve:"sustain"}],blending:"normal",renderOrder:8,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:1.5,arcCount:2},orientationOverride:"flat"}}}},{type:"orbit",orbit:{height:"feet",endHeight:"feet",radius:.6,endRadius:.8,speed:.5,easing:"linear",startScale:.6,endScale:.9,orientation:"camera"},count:4,scale:.8,models:["rock-cluster","rock-chunk-medium","boulder","rock-chunk-medium"],animation:{appearAt:.05,disappearAt:.75,stagger:.04,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},pulse:{amplitude:.15,frequency:2,easing:"easeInOut",sync:"global"},emissive:{min:.5,max:1,frequency:2,pattern:"sine"},rotate:[{axis:"x",rotations:-1.2,phase:0},{axis:"z",rotations:1.4,phase:90},{axis:"y",rotations:-1,phase:180},{axis:"x",rotations:1.6,phase:270}],atmospherics:[{preset:"earth-gravel",targets:null,anchor:"below",intensity:.3,sizeScale:.5,progressCurve:"sustain"}],scaleVariance:.2,blending:"normal",renderOrder:9}}],shakeAmount:.025,shakeFrequency:10,decayRate:.2,glowColor:[.8,.55,.25],glowIntensityMin:.5,glowIntensityMax:.9,glowFlickerRate:2,scaleVibration:.012,scaleFrequency:2,tremor:.015,tremorFrequency:8}),gn=cn({name:"earthquake",emoji:"üåç",type:"blending",description:"Ground splits, rocks rain from above, spikes erupt, debris explodes outward",duration:1200,beats:2,intensity:1.5,category:"emanating",petrification:.6,spawnMode:[{type:"anchor",anchor:{landmark:"feet",offset:{x:0,y:0,z:0},orientation:"flat",startScale:.3,endScale:2.5,scaleEasing:"easeOutQuad"},count:1,scale:1.8,models:["earth-ring"],animation:{appearAt:0,disappearAt:.6,enter:{type:"fade",duration:.04,easing:"linear"},exit:{type:"fade",duration:.25,easing:"easeIn"},emissive:{min:1,max:2,frequency:2,pattern:"sine"},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"above",intensity:.6,sizeScale:2,progressCurve:"burst"}],blending:"normal",renderOrder:4,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.9,arcSpeed:2,arcCount:2},orientationOverride:"flat"}}}},{type:"axis-travel",axisTravel:{axis:"y",start:"above",end:"below",easing:"easeIn",startScale:.4,endScale:1.2,startDiameter:1.8,endDiameter:.8,orientation:"camera"},formation:{type:"spiral",count:6,spacing:0,arcOffset:60,phaseOffset:0},count:6,scale:.7,models:["boulder","rock-chunk-medium","rock-cluster","rock-chunk-medium","boulder","rock-chunk-small"],animation:{appearAt:0,disappearAt:.55,stagger:.05,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"burst-fade",duration:.1,easing:"easeIn",burstScale:1.3},emissive:{min:.6,max:1.2,frequency:3,pattern:"sine"},rotate:[{axis:"x",rotations:2,phase:0},{axis:"z",rotations:-1.5,phase:60},{axis:"y",rotations:2.5,phase:120},{axis:"x",rotations:-1.8,phase:180},{axis:"z",rotations:1.2,phase:240},{axis:"y",rotations:-2,phase:300}],atmospherics:[{preset:"earth-gravel",targets:null,anchor:"below",intensity:.5,sizeScale:.8,progressCurve:"burst"}],scaleVariance:.3,lifetimeVariance:.1,blending:"normal",renderOrder:10}},{type:"surface",pattern:"spikes",embedDepth:.18,cameraFacing:.3,clustering:.1,count:3,scale:1.3,minDistance:.15,models:["stone-spike","stone-spike","stone-spike"],animation:{appearAt:.1,disappearAt:.65,stagger:.06,enter:{type:"grow",duration:.08,easing:"easeOutQuad"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.2},procedural:{scaleSmoothing:.05,geometryStability:!0},emissive:{min:.8,max:1.8,frequency:3,pattern:"sine"},pulse:{amplitude:.06,frequency:6,easing:"easeInOut"},scaleVariance:.3,lifetimeVariance:.1,blending:"normal",renderOrder:8,modelOverrides:{"stone-spike":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.6},y:{expand:!0,rate:2.5},z:{expand:!1,rate:.6}}}}}}},{type:"radial-burst",radialBurst:{count:5,radius:.2,endRadius:2,angleSpread:360,startAngle:36,orientation:"camera",startScale:.3,endScale:.7,scaleEasing:"easeOutQuad"},count:5,scale:.45,models:["rock-chunk-small","rock-chunk-medium","rock-chunk-small","rock-chunk-small","rock-chunk-medium"],speedCurve:"burst",animation:{appearAt:.15,disappearAt:.7,stagger:.01,enter:{type:"scale",duration:.04,easing:"easeOut"},exit:{type:"burst-fade",duration:.2,easing:"easeIn",burstScale:1.1},emissive:{min:.5,max:1,frequency:3,pattern:"sine"},rotate:[{axis:"x",rotations:2.5,phase:0},{axis:"z",rotations:-2,phase:72},{axis:"y",rotations:1.8,phase:144},{axis:"x",rotations:-1.5,phase:216},{axis:"z",rotations:2.2,phase:288}],atmospherics:[{preset:"earth-dust",targets:null,anchor:"above",intensity:.4,sizeScale:1.5,progressCurve:"sustain"}],scaleVariance:.3,blending:"normal",renderOrder:12}}],shakeAmount:.04,shakeFrequency:16,endFlash:!0,decayRate:.1,glowColor:[.85,.6,.25],glowIntensityMin:1,glowIntensityMax:2.5,glowFlickerRate:8,tremor:.02,tremorFrequency:12}),mn=cn({name:"earthencase",emoji:"ü™®",type:"blending",description:"Stone clusters growing on mascot surface, encasing in rock",duration:3500,beats:5,intensity:1.2,category:"transform",petrification:.85,spawnMode:{type:"surface",pattern:"shell",embedDepth:.2,cameraFacing:.4,clustering:.1,count:10,scale:1.8,minDistance:.1,models:["rock-cluster","rock-chunk-medium","rock-chunk-small","stone-spike"],animation:{appearAt:.05,disappearAt:.9,stagger:.04,enter:{type:"grow",duration:.12,easing:"easeOutQuad"},exit:{type:"shrink",duration:.15,easing:"easeInQuad"},procedural:{scaleSmoothing:.1,geometryStability:!0},parameterAnimation:{petrification:{start:.5,peak:.9,end:.7,curve:"fadeIn"}},pulse:{amplitude:.05,frequency:1.2,easing:"easeInOut",sync:"global"},emissive:{min:.5,max:.9,frequency:1.5,pattern:"sine"},atmospherics:[{preset:"earth-dust",targets:null,anchor:"below",intensity:.3,sizeScale:1.2,progressCurve:"sustain"}],wetness:{wetness:.5,wetSpeed:.25},cutout:{edgeMask:.3},rotate:{axis:"y",speed:.008,oscillate:!0,range:Math.PI/16},scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:6,intensityScaling:{scale:1.25,emissiveMax:1.2},modelOverrides:{"rock-chunk-small":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1},y:{expand:!0,rate:1.4},z:{expand:!0,rate:1}},easing:"easeOutQuad"}},"rock-chunk-medium":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.1},y:{expand:!0,rate:1.5},z:{expand:!0,rate:1.1}}}},"rock-cluster":{scaling:{mode:"non-uniform",axes:{x:{expand:!0,rate:1.3},y:{expand:!0,rate:1.2},z:{expand:!0,rate:1.3}}}},"stone-spike":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.85},y:{expand:!0,rate:1.8},z:{expand:!1,rate:.85}}}}}}},glowColor:[.85,.6,.25],glowIntensityMin:.55,glowIntensityMax:.9,glowFlickerRate:2,scaleVibration:.01,scaleFrequency:2,scaleContract:.02,tremor:.004,tremorFrequency:6,tremorDecay:.8,decayRate:.15}),yn=cn({name:"earthcrumble",emoji:"üíî",type:"blending",description:"Structural collapse ‚Äî stone cracks, shatters outward, and crumbles to dust",duration:2e3,beats:3,intensity:1.4,category:"transform",petrification:.7,spawnMode:[{type:"surface",pattern:"spikes",embedDepth:.15,cameraFacing:.3,clustering:.15,count:4,scale:.9,minDistance:.12,models:["stone-spike","stone-spike","stone-spike","stone-spike"],animation:{appearAt:0,disappearAt:.4,stagger:.04,enter:{type:"grow",duration:.12,easing:"easeOutQuad"},exit:{type:"burst-fade",duration:.1,easing:"easeIn",burstScale:1.3},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{petrification:{start:.7,peak:.9,end:.5,curve:"bell"}},pulse:{amplitude:.06,frequency:6,easing:"easeInOut"},emissive:{min:.5,max:1.2,frequency:4,pattern:"sine"},cutout:{edgeMask:.25},atmospherics:[{preset:"earth-dust",targets:null,anchor:"around",intensity:.3,sizeScale:.8,progressCurve:"buildup"}],scaleVariance:.25,lifetimeVariance:.1,blending:"normal",renderOrder:6,modelOverrides:{"stone-spike":{scaling:{mode:"non-uniform",axes:{x:{expand:!1,rate:.8},y:{expand:!0,rate:2},z:{expand:!1,rate:.8}}}}}}},{type:"radial-burst",radialBurst:{count:10,radius:.15,endRadius:2.5,angleSpread:360,startAngle:0,orientation:"camera"},startScale:.7,endScale:.2,scaleEasing:"easeInQuad",speedCurve:"burst",count:10,scale:.55,models:["rock-chunk-small","rock-chunk-medium","rock-chunk-small","boulder","rock-chunk-small","rock-chunk-medium","rock-chunk-small","rock-cluster","rock-chunk-small","rock-chunk-medium"],animation:{appearAt:.25,disappearAt:.75,stagger:.01,enter:{type:"scale",duration:.06,easing:"easeOut"},exit:{type:"burst-fade",duration:.2,easing:"easeIn",burstScale:1.1},emissive:{min:.4,max:.8,frequency:3,pattern:"sine"},rotate:[{axis:"z",rotations:3,phase:0},{axis:"x",rotations:-2,phase:36},{axis:"y",rotations:2.5,phase:72},{axis:"z",rotations:-1.5,phase:108},{axis:"x",rotations:2,phase:144},{axis:"y",rotations:-3,phase:180},{axis:"z",rotations:1.5,phase:216},{axis:"x",rotations:-2.5,phase:252},{axis:"y",rotations:2,phase:288},{axis:"z",rotations:-2,phase:324}],atmospherics:[{preset:"earth-gravel",targets:null,anchor:"below",intensity:.6,sizeScale:1,progressCurve:"burst",velocityInheritance:.5},{preset:"earth-dust",targets:null,anchor:"above",intensity:.5,sizeScale:1.5,progressCurve:"sustain"}],scaleVariance:.35,lifetimeVariance:.15,blending:"normal",renderOrder:12}},{type:"anchor",anchor:{landmark:"bottom",offset:{x:0,y:-.05,z:0},orientation:"flat",startScale:.2,endScale:2.5,scaleEasing:"easeOutQuad"},count:1,scale:1,models:["earth-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},cutout:{strength:.75,primary:{pattern:8,scale:2,weight:1},secondary:{pattern:7,scale:1.5,weight:.5},blend:"add",travel:"radial",travelSpeed:3,strengthCurve:"fadeOut",fadeOutDuration:.4,trailDissolve:{offset:-.3,softness:1.5,direction:"outward"}},grain:{type:3,strength:.25,scale:.2,speed:3,blend:"multiply"},emissive:{min:.8,max:1.5,frequency:2,pattern:"sine"},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"above",intensity:.6,sizeScale:2,progressCurve:"burst"}],blending:"normal",renderOrder:4,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:1,arcSpeed:0,arcCount:1}}}}}],shatterPoint:.28,endFlash:!0,fadeOut:!0,fadeStartAt:.5,fadeEndAt:.95,scaleShrink:.15,distortionStrength:1.2,decayRate:.2,glowColor:[.8,.55,.25],glowIntensityMin:.5,glowIntensityMax:1,glowFlickerRate:4,shakeAmount:.03,shakeFrequency:15,tremor:.012,tremorFrequency:8}),fn=cn({name:"earthshatter",emoji:"üí•",type:"blending",description:"Violent shattering explosion ‚Äî stone builds tension then detonates into fragments",duration:1200,beats:2,intensity:1.6,category:"transform",petrification:.8,shatterPoint:.3,spawnMode:{type:"radial-burst",radialBurst:{count:10,radius:.05,endRadius:2.5,angleSpread:360,startAngle:18,orientation:"camera",startScale:.3,endScale:1,scaleEasing:"easeOutQuad"},count:10,scale:.8,models:["rock-chunk-small","boulder","rock-chunk-small","boulder","rock-chunk-small","boulder","rock-chunk-small","boulder","rock-chunk-small","boulder"],animation:{appearAt:.25,disappearAt:.55,stagger:.008,enter:{type:"flash",duration:.02,easing:"linear"},exit:{type:"burst-fade",duration:.12,easing:"easeIn",burstScale:1.4},procedural:{scaleSmoothing:.05,geometryStability:!0},emissive:{min:.6,max:1.2,frequency:6,pattern:"sine"},atmospherics:[{preset:"earth-gravel",targets:["rock-cluster","stone-slab"],anchor:"below",intensity:.5,sizeScale:.8,progressCurve:"burst"},{preset:"earth-dust",targets:["rock-cluster"],anchor:"above",intensity:.4,sizeScale:1.2,progressCurve:"burst"}],rotate:[{axis:"x",rotations:3,phase:0},{axis:"z",rotations:-2.5,phase:36},{axis:"y",rotations:4,phase:72},{axis:"x",rotations:-3,phase:108},{axis:"z",rotations:2,phase:144},{axis:"y",rotations:-3.5,phase:180},{axis:"x",rotations:2.5,phase:216},{axis:"z",rotations:-4,phase:252},{axis:"y",rotations:3,phase:288},{axis:"x",rotations:-2,phase:324}],scaleVariance:.35,lifetimeVariance:.1,blending:"normal",renderOrder:14}},shakeAmount:.05,shakeFrequency:20,explosionForce:1,endFlash:!0,decayRate:.1,glowColor:[.9,.65,.2],glowIntensityMin:.7,glowIntensityMax:1.3,glowFlickerRate:8,scaleVibration:.02,scaleFrequency:8,tremor:.02,tremorFrequency:10}),bn=cn({name:"eartherode",emoji:"üèúÔ∏è",type:"blending",description:"Stone shell crumbles and erodes away, revealing the crystal beneath",duration:3e3,beats:4,intensity:.9,category:"transform",petrification:.9,spawnMode:[{type:"orbit",orbit:{height:"center",endHeight:"center",radius:.35,endRadius:1.8,speed:1,easing:"easeOutQuad",startScale:1,endScale:.3,orientation:"camera"},count:5,scale:.7,models:["boulder","rock-cluster","stone-slab","rock-chunk-medium","rock-cluster"],animation:{appearAt:0,disappearAt:.7,stagger:.05,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"shrink",duration:.25,easing:"easeInQuad"},parameterAnimation:{petrification:{start:.9,peak:.6,end:.15,curve:"fadeOut"}},pulse:{amplitude:.04,frequency:2,easing:"easeInOut"},emissive:{min:.3,max:.6,frequency:1.5,pattern:"sine"},rotate:[{axis:"x",rotations:1.2,phase:0},{axis:"z",rotations:-.8,phase:72},{axis:"y",rotations:1,phase:144},{axis:"x",rotations:-.9,phase:216},{axis:"z",rotations:.7,phase:288}],cutout:{strength:.5,primary:{pattern:8,scale:1.2,weight:1},secondary:{pattern:0,scale:1.5,weight:.3},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"fadeOut",fadeOutDuration:.5},atmospherics:[{preset:"earth-dust",targets:null,anchor:"around",intensity:.5,sizeScale:1.2,progressCurve:"sustain"}],scaleVariance:.3,lifetimeVariance:.15,blending:"normal",renderOrder:6}},{type:"radial-burst",radialBurst:{count:6,radius:.25,endRadius:1.8,angleSpread:360,startAngle:15,orientation:"camera",startScale:.5,endScale:.1,scaleEasing:"easeInQuad"},count:6,scale:.5,models:["rock-chunk-small","rock-chunk-medium","rock-chunk-small","rock-chunk-small","rock-cluster","rock-chunk-small"],animation:{appearAt:.15,disappearAt:.8,stagger:.06,enter:{type:"scale",duration:.08,easing:"easeOut"},exit:{type:"burst-fade",duration:.2,easing:"easeIn",burstScale:.8},emissive:{min:.2,max:.5,frequency:2,pattern:"sine"},rotate:[{axis:"z",rotations:1.5,phase:0},{axis:"x",rotations:-1.2,phase:60},{axis:"y",rotations:1.8,phase:120},{axis:"z",rotations:-1,phase:180},{axis:"x",rotations:1.3,phase:240},{axis:"y",rotations:-1.5,phase:300}],atmospherics:[{preset:"earth-gravel",targets:null,anchor:"below",intensity:.4,sizeScale:.6,progressCurve:"burst"}],scaleVariance:.3,lifetimeVariance:.2,blending:"normal",renderOrder:10}},{type:"anchor",anchor:{landmark:"feet",offset:{x:0,y:-.02,z:0},orientation:"flat",startScale:.4,endScale:2,scaleEasing:"easeOutQuad"},count:1,scale:1,models:["earth-ring"],animation:{appearAt:.2,disappearAt:.75,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},cutout:{strength:.6,primary:{pattern:8,scale:1.5,weight:1},secondary:{pattern:7,scale:2,weight:.5},blend:"add",travel:"radial",travelSpeed:2,strengthCurve:"fadeOut",fadeOutDuration:.5},grain:{type:3,strength:.25,scale:.25,speed:1.5,blend:"multiply"},emissive:{min:.5,max:1,frequency:2,pattern:"sine"},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"above",intensity:.4,sizeScale:1.5,progressCurve:"sustain"}],blending:"normal",renderOrder:4,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.8,arcSpeed:1,arcCount:2},orientationOverride:"flat"}}}}],fadeOut:!0,fadeStartAt:.5,fadeEndAt:.95,fadeCurve:"accelerating",scaleShrink:.08,decayRate:.25,glowColor:[.7,.5,.25],glowIntensityMin:.3,glowIntensityMax:.6,glowFlickerRate:1.5,tremor:.006,tremorFrequency:3,tremorDecay:.7}),wn=cn({name:"earthmeditation",emoji:"üßò",type:"blending",description:"Zen stone garden mandala ‚Äî earth rings orbit in calm meditative formation",duration:4e3,beats:4,intensity:.6,category:"emanating",petrification:.3,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"easeInOut",startScale:1,endScale:1,startDiameter:1.8,endDiameter:1.8,orientation:"camera"},formation:{type:"mandala",count:5,radius:.5,arcOffset:45,scales:[1,.6,.6,.6,.6]},count:5,scale:1,models:["earth-ring"],animation:{appearAt:0,disappearAt:.8,stagger:0,enter:{type:"fade",duration:.5,easing:"easeInOut"},exit:{type:"fade",duration:.4,easing:"easeInOut"},pulse:{amplitude:.1,frequency:1.2,easing:"easeInOut"},emissive:{min:.5,max:.9,frequency:1.2,pattern:"sine"},cutout:{strength:.5,primary:{pattern:4,weight:1},secondary:{pattern:6,weight:.5},blend:"add",travel:"angular",travelSpeed:.5},grain:{type:3,strength:.25,scale:.4,speed:.4,blend:"multiply"},atmospherics:[{preset:"earth-dust",targets:["earth-ring","stone-ring"],anchor:"above",intensity:.2,sizeScale:.9,progressCurve:"sustain"}],rotate:[{axis:"z",rotations:.25},{axis:"z",rotations:-.3},{axis:"z",rotations:.35},{axis:"z",rotations:-.25},{axis:"z",rotations:.3}],blending:"normal",depthWrite:!1,renderOrder:-5,modelOverrides:{"earth-ring":{orientationOverride:"camera",shaderAnimation:{type:1},arcWidth:.8,arcSpeed:.4,arcCount:2}}}},decayRate:.2,glowColor:[.8,.55,.25],glowIntensityMin:.3,glowIntensityMax:.6,scaleVibration:.003,tremor:.002}),vn=cn({name:"earthcrown",emoji:"üëë",type:"blending",description:"Heavy stone crown hovering above the head, grinding with seismic energy",duration:3e3,beats:4,intensity:1,category:"manifestation",petrification:.6,spawnMode:{type:"anchor",anchor:{landmark:"top",offset:{x:0,y:.05,z:0},orientation:"flat",bob:{amplitude:.008,frequency:.2}},count:1,scale:2.2,models:["earth-crown"],animation:{appearAt:0,disappearAt:.75,stagger:0,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.25,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},pulse:{amplitude:.03,frequency:1.5,easing:"easeInOut"},emissive:{min:.6,max:1,frequency:1,pattern:"sine"},rotate:{axis:"z",rotations:.3,phase:0},wetness:{wetness:.65,wetSpeed:.4},atmospherics:[{preset:"earth-dust",targets:["earth-crown"],anchor:"above",intensity:.25,sizeScale:.8,progressCurve:"sustain"}],scaleVariance:0,lifetimeVariance:0,blending:"normal",renderOrder:10,modelOverrides:{"earth-crown":{shaderAnimation:{type:1,arcWidth:.8,arcSpeed:.4,arcCount:2},orientationOverride:"flat"}}}},decayRate:.2,glowColor:[.85,.6,.25],glowIntensityMin:.5,glowIntensityMax:.8,glowFlickerRate:1.5,scaleVibration:.005,scaleFrequency:1.5,scalePulse:!0,rotationDrift:.008,tremor:.003,tremorFrequency:3}),Mn=cn({name:"earthdance",emoji:"üíÉ",type:"blending",description:"Vertical stone rings dancing and rising",duration:1500,beats:3,intensity:1.3,category:"manifestation",petrification:.7,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.2,endScale:1.6,startDiameter:1.3,endDiameter:2,orientation:"vertical"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1,models:["earth-ring"],animation:{appearAt:.02,disappearAt:.5,stagger:.02,enter:{type:"fade",duration:.08,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},cutout:{strength:.65,primary:{pattern:3,scale:1.5,weight:1},secondary:{pattern:8,scale:1.2,weight:.5},blend:"add",travel:"angular",travelSpeed:2,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.12,tip:.28}},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},atmospherics:[{preset:"earth-dust",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.4,centrifugal:{speed:.5,tangentialBias:.5}}],parameterAnimation:{petrification:{start:.5,peak:.75,end:.55,curve:"bell"}},pulse:{amplitude:.1,frequency:5,easing:"easeInOut"},emissive:{min:.8,max:1.6,frequency:6,pattern:"sine"},rotate:[{axis:"y",rotations:2,phase:0},{axis:"y",rotations:-2,phase:60},{axis:"y",rotations:3,phase:120}],scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:11,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:1.5,arcCount:1},orientationOverride:"vertical"}}}},glowColor:[.85,.6,.25],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:6,scaleVibration:.018,scaleFrequency:4,scaleGrowth:.025,tremor:.005,tremorFrequency:3}),Sn=cn({name:"earthhelix",emoji:"üß¨",type:"blending",description:"DNA-style double helix ascending stone",duration:2e3,beats:4,intensity:1.2,category:"manifestation",petrification:.75,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"above",easing:"easeInOut",startScale:.8,endScale:1.1,startDiameter:1.6,endDiameter:1.8,orientation:"vertical"},formation:{type:"spiral",count:6,strands:2,spacing:.2,arcOffset:120,phaseOffset:.05},count:6,scale:1.2,models:["earth-ring"],animation:{appearAt:0,disappearAt:.7,stagger:.06,enter:{type:"scale",duration:.15,easing:"easeOut"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.08,geometryStability:!0},parameterAnimation:{petrification:{start:.5,peak:.85,end:.6,curve:"bell"}},pulse:{amplitude:.06,frequency:4,easing:"easeInOut"},emissive:{min:.9,max:2,frequency:6,pattern:"smooth"},cutout:{strength:.7,primary:{pattern:8,scale:1.5,weight:1},secondary:{pattern:3,scale:1.2,weight:.5},blend:"max",travel:"angular",travelSpeed:2.5,strengthCurve:"bell",bellPeakAt:.5,geometricMask:{type:"distance",core:.1,tip:.25}},grain:{type:3,strength:.15,scale:.2,speed:1,blend:"multiply"},atmospherics:[{preset:"earth-dust",targets:null,anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:.8,tangentialBias:.4}}],rotate:{axis:"y",rotations:2,phase:0},scaleVariance:.1,lifetimeVariance:.1,blending:"normal",renderOrder:16,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.7,arcSpeed:1.2,arcCount:1},orientationOverride:"vertical"}}}},glowColor:[.85,.6,.25],glowIntensityMin:1,glowIntensityMax:1.8,glowFlickerRate:8,scaleVibration:.012,scaleFrequency:5,scaleGrowth:.02,tremor:.003,tremorFrequency:4});const xn={appearAt:0,disappearAt:.7,enter:{type:"scale",duration:.2,easing:"easeOut"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.1,geometryStability:!0},parameterAnimation:{petrification:{start:.55,peak:.85,end:.65,curve:"bell"}},pulse:{amplitude:.05,frequency:3,easing:"easeInOut"},emissive:{min:.9,max:1.8,frequency:4,pattern:"sine"},grain:{type:3,strength:.35,scale:.2,speed:1.5,blend:"multiply"},wetness:{wetness:.55,wetSpeed:.3},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"below",anchorOffset:-.1,intensity:.4,sizeScale:1.5,progressCurve:"sustain"}],scaleVariance:.03,lifetimeVariance:.02,blending:"normal",renderOrder:15,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.8,arcCount:2}}}};var kn=cn({name:"earthpillar",emoji:"üèõÔ∏è",type:"blending",description:"Majestic rising pillar of stone",duration:3e3,beats:4,intensity:1.3,category:"manifestation",petrification:.8,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:0},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1.6,models:["earth-ring"],animation:{...xn,stagger:.03,cutout:{strength:.55,primary:{pattern:0,scale:1.2,weight:1},secondary:{pattern:8,scale:1.5,weight:.4},blend:"add",travel:"angular",travelSpeed:1.2,strengthCurve:"fadeIn",fadeInDuration:.3,geometricMask:{type:"distance",core:.1,tip:.25}},rotate:[{axis:"z",rotations:.3,phase:0},{axis:"z",rotations:.3,phase:180}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:.5},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1.6,models:["earth-ring"],animation:{...xn,stagger:.05,cutout:{strength:.6,primary:{pattern:8,scale:1.4,weight:1},secondary:{pattern:3,scale:1.2,weight:.5},blend:"multiply",travel:"radial",travelSpeed:1.5,strengthCurve:"bell",bellPeakAt:.5,bellWidth:.5,geometricMask:{type:"tip-boost",core:0,tip:.2}},rotate:[{axis:"z",rotations:-.5,phase:60},{axis:"z",rotations:-.5,phase:240}]}},{type:"axis-travel",axisTravel:{axis:"y",start:"below",end:"above",easing:"easeOut",startScale:.6,endScale:1.3,startDiameter:1.2,endDiameter:2.2,orientation:"flat",startOffset:1},formation:{type:"stack",count:2,spacing:.25},count:2,scale:1.6,models:["earth-ring"],animation:{...xn,stagger:.07,cutout:{strength:.65,primary:{pattern:3,scale:1.3,weight:1},secondary:{pattern:7,scale:1.5,weight:.4},blend:"add",travel:"oscillate",travelSpeed:2,strengthCurve:"fadeOut",fadeOutDuration:.4,geometricMask:{type:"distance",core:.15,tip:.3}},rotate:[{axis:"z",rotations:.7,phase:90},{axis:"z",rotations:.7,phase:270}]}}],glowColor:[.85,.6,.25],glowIntensityMin:.8,glowIntensityMax:1.6,glowFlickerRate:5,scaleVibration:.008,scaleFrequency:3,scaleGrowth:.025,tremor:.002,tremorFrequency:2}),On=cn({name:"earthdrill",emoji:"üî©",type:"blending",description:"Fast tight descending stone helix",duration:1200,beats:2,intensity:1.5,category:"manifestation",petrification:.7,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"feet",end:"below",easing:"easeIn",startScale:1,endScale:.8,startDiameter:1.8,endDiameter:1.4,orientation:"vertical"},formation:{type:"spiral",count:6,spacing:.1,arcOffset:60,phaseOffset:0},count:6,scale:1.4,models:["earth-ring"],animation:{appearAt:0,disappearAt:.6,stagger:.03,enter:{type:"fade",duration:.05,easing:"linear"},exit:{type:"fade",duration:.4,easing:"easeIn"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{petrification:{start:.4,peak:.8,end:.5,curve:"bell"}},cutout:{strength:.55,primary:{pattern:3,scale:1.5,weight:1},secondary:{pattern:8,scale:.8,weight:.35},blend:"add",travel:"vertical",travelSpeed:3,strengthCurve:"constant"},grain:{type:3,strength:.3,scale:.2,speed:4,blend:"multiply"},atmospherics:[{preset:"earth-dust",targets:null,anchor:"below",intensity:.3,sizeScale:.8,progressCurve:"sustain",velocityInheritance:.5,centrifugal:{speed:1,tangentialBias:.3}}],pulse:{amplitude:.08,frequency:10,easing:"linear"},rotate:{axis:"y",rotations:4,phase:0},scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:16,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:3,arcCount:1},orientationOverride:"vertical"}}}},glowColor:[.85,.6,.25],glowIntensityMin:1.3,glowIntensityMax:2.8,glowFlickerRate:10,scaleVibration:.02,scaleFrequency:8,scaleGrowth:.03,tremor:.006,tremorFrequency:8}),An=cn({name:"earthflourish",emoji:"üé≠",type:"blending",description:"Spinning stone flourish with crossing arcs",duration:1200,beats:4,intensity:1.3,category:"manifestation",petrification:.6,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",startScale:.7,endScale:1.2,startDiameter:1.8,endDiameter:2.8,orientation:"camera"},formation:{type:"spiral",count:5,spacing:0,arcOffset:72,phaseOffset:.05,zOffset:0},count:5,scale:1.5,models:["earth-ring"],animation:{appearAt:0,disappearAt:.45,stagger:.12,enter:{type:"fade",duration:.03,easing:"easeOut"},exit:{type:"burst-fade",duration:.85,easing:"easeIn",burstScale:1.15},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{petrification:{start:.35,peak:.7,end:.2,curve:"bell"}},cutout:{strength:.6,primary:{pattern:3,scale:1,weight:1},secondary:{pattern:8,scale:.6,weight:.5},blend:"multiply",strengthCurve:"constant",trailDissolve:{enabled:!0,offset:-.6,softness:1.5}},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"below",intensity:.3,sizeScale:1,progressCurve:"sustain",velocityInheritance:.4}],pulse:{amplitude:.15,frequency:5,easing:"easeInOut",perElement:!0},drift:{speed:.3,distance:.18,pattern:"radial",accelerate:!0},opacityGradient:[1,.9,.8,.7,.6],rotate:[{axis:"z",rotations:2.5,phase:0},{axis:"z",rotations:-2,phase:72},{axis:"z",rotations:1.8,phase:144},{axis:"z",rotations:-2.3,phase:216},{axis:"z",rotations:2,phase:288}],tilt:{axis:"y",oscillate:!0,range:.4,speed:3.5},wobble:{axis:"x",oscillate:!0,range:.15,speed:2,phase:90},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",depthWrite:!1,renderOrder:-8,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:1,arcCount:2},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:-.7,y:.4,z:0},orientation:"camera",startScale:.4,endScale:1.2,scaleEasing:"easeOutCubic"},count:1,scale:1.2,models:["earth-ring"],animation:{appearAt:.12,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{petrification:{start:.4,peak:.6,end:.2,curve:"bell"}},cutout:{strength:.5,primary:{pattern:8,scale:1,weight:1},secondary:{pattern:3,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},drift:{speed:.9,distance:.35,direction:{x:1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:1,phase:-45}],blending:"normal",depthWrite:!1,renderOrder:-6,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:2,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:.7,y:.4,z:0},orientation:"camera",startScale:.4,endScale:1.2,scaleEasing:"easeOutCubic"},count:1,scale:1.2,models:["earth-ring"],animation:{appearAt:.12,disappearAt:.5,enter:{type:"scale",duration:.06,easing:"easeOutBack"},exit:{type:"fade",duration:.3,easing:"easeIn"},procedural:{scaleSmoothing:.04,geometryStability:!0},parameterAnimation:{petrification:{start:.4,peak:.6,end:.2,curve:"bell"}},cutout:{strength:.5,primary:{pattern:8,scale:1,weight:1},secondary:{pattern:3,scale:.7,weight:.4},blend:"multiply",travel:"angular",travelSpeed:2,strengthCurve:"fadeOut"},grain:{type:3,strength:.2,scale:.25,speed:2.5,blend:"multiply"},drift:{speed:.9,distance:.35,direction:{x:-1,y:-.7,z:-.15},easing:"easeInOutCubic"},rotate:[{axis:"z",rotations:1,phase:45}],blending:"normal",depthWrite:!1,renderOrder:-6,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.6,arcSpeed:2,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:1.5,models:["earth-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{petrification:{start:.4,peak:.7,end:.25,curve:"bell"}},cutout:{strength:.5,primary:{pattern:3,scale:.8,weight:1},secondary:{pattern:8,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},rotate:[{axis:"z",rotations:.001,phase:45}],blending:"normal",depthWrite:!1,renderOrder:-10,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}},{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:0},orientation:"camera",startScale:.5,endScale:1.8,scaleEasing:"easeOutExpo"},count:1,scale:1.5,models:["earth-ring"],animation:{appearAt:.3,disappearAt:.7,enter:{type:"fade",duration:.06,easing:"easeOut"},exit:{type:"fade",duration:.28,easing:"easeInCubic"},procedural:{scaleSmoothing:.05,geometryStability:!0},parameterAnimation:{petrification:{start:.4,peak:.7,end:.25,curve:"bell"}},cutout:{strength:.5,primary:{pattern:3,scale:.8,weight:1},secondary:{pattern:8,scale:.6,weight:.4},blend:"multiply",travel:"angular",travelSpeed:1.5,strengthCurve:"constant"},grain:{type:3,strength:.2,scale:.25,speed:2,blend:"multiply"},rotate:[{axis:"z",rotations:.001,phase:-45}],blending:"normal",depthWrite:!1,renderOrder:-10,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.35,arcSpeed:1.5,arcCount:1},orientationOverride:"camera"}}}}],glowColor:[.85,.6,.25],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:6,scaleVibration:.012,scaleFrequency:8,scaleGrowth:.015,tremor:.003,tremorFrequency:4}),Cn=cn({name:"earthvortex",emoji:"üå™Ô∏è",type:"blending",description:"Funnel of stone rings narrowing at top, wide at base",duration:1500,beats:5,intensity:1.4,category:"manifestation",petrification:.7,spawnMode:{type:"axis-travel",axisTravel:{axis:"y",start:"bottom",end:"top",easing:"easeInOut",startScale:1.2,endScale:1.2,startDiameter:.6,endDiameter:2,orientation:"flat"},formation:{type:"spiral",count:3,spacing:0,arcOffset:120,phaseOffset:0},count:3,scale:1.5,models:["earth-ring"],animation:{appearAt:.05,disappearAt:.9,stagger:.02,enter:{type:"fade",duration:.1,easing:"easeOut"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.1},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.12,frequency:6,easing:"easeInOut"},emissive:{min:1,max:2,frequency:5,pattern:"sine"},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"around",intensity:.4,sizeScale:1.2,progressCurve:"sustain"},{preset:"earth-gravel",targets:["earth-ring"],anchor:"around",intensity:.2,sizeScale:.6,progressCurve:"sustain"}],scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:12,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.5,arcSpeed:5,arcCount:1},orientationOverride:"flat"}}}},decayRate:.2,glowColor:[.85,.6,.25],glowIntensityMin:.6,glowIntensityMax:1,glowFlickerRate:2,scaleVibration:.008,scaleFrequency:3,scalePulse:!0,tremor:.006,tremorFrequency:4}),In=cn({name:"earthbarrage",emoji:"üèπ",type:"blending",description:"Rocks orbit mascot then launch outward in all directions",duration:2e3,beats:4,intensity:1.3,category:"manifestation",petrification:.7,spawnMode:{type:"orbit",orbit:{height:"center",endHeight:"above",radius:1,endRadius:2.5,speed:2,easing:"easeIn",startScale:1,endScale:.7,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1.2,models:["rock-chunk-medium","boulder","rock-chunk-medium","boulder","rock-chunk-medium"],animation:{appearAt:0,disappearAt:.65,stagger:.04,enter:{type:"scale",duration:.12,easing:"easeOutBack"},exit:{type:"burst-fade",duration:.15,easing:"easeIn",burstScale:1.2},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.06,frequency:3,easing:"easeInOut"},emissive:{min:.5,max:.9,frequency:2,pattern:"sine"},rotate:[{axis:"x",rotations:1.5,phase:0},{axis:"y",rotations:-2,phase:40},{axis:"z",rotations:1.5,phase:100},{axis:"x",rotations:-1.5,phase:180},{axis:"y",rotations:2,phase:250}],atmospherics:[{preset:"earth-gravel",targets:["rock-chunk-medium","boulder"],anchor:"below",intensity:.3,sizeScale:.6,progressCurve:"sustain"},{preset:"earth-dust",targets:["rock-chunk-medium"],anchor:"around",intensity:.2,sizeScale:.8,progressCurve:"sustain"}],scaleVariance:.25,lifetimeVariance:.1,blending:"normal",renderOrder:12}},decayRate:.2,glowColor:[.85,.6,.25],glowIntensityMin:.5,glowIntensityMax:.9,glowFlickerRate:3,scaleVibration:.01,scaleFrequency:3,scalePulse:!0,tremor:.005,tremorFrequency:4}),zn=cn({name:"earthimpact",emoji:"üí•",type:"blending",description:"Converging orbital rocks slam inward to mascot center",duration:1500,beats:3,intensity:1.5,category:"manifestation",petrification:.8,spawnMode:{type:"orbit",orbit:{height:"above",endHeight:"center",radius:2.5,endRadius:.3,speed:2,easing:"easeOut",startScale:.6,endScale:1.2,orientation:"vertical"},formation:{type:"ring",count:5},count:5,scale:1,models:["rock-chunk-small","rock-cluster","rock-chunk-small","rock-cluster","rock-chunk-small"],animation:{appearAt:0,disappearAt:.6,stagger:.03,enter:{type:"scale",duration:.1,easing:"easeOut"},exit:{type:"burst-fade",duration:.1,easing:"easeIn",burstScale:1.5},procedural:{scaleSmoothing:.08,geometryStability:!0},pulse:{amplitude:.08,frequency:4,easing:"easeInOut"},emissive:{min:.6,max:1.1,frequency:3,pattern:"sine"},rotate:[{axis:"x",rotations:2,phase:0},{axis:"z",rotations:-1.5,phase:72},{axis:"y",rotations:2.5,phase:144},{axis:"x",rotations:-2,phase:216},{axis:"z",rotations:1.5,phase:288}],atmospherics:[{preset:"earth-gravel",targets:["rock-chunk-medium","boulder"],anchor:"below",intensity:.4,sizeScale:.7,progressCurve:"burst"},{preset:"earth-dust",targets:["boulder"],anchor:"above",intensity:.3,sizeScale:1,progressCurve:"burst"}],scaleVariance:.2,lifetimeVariance:.08,blending:"normal",renderOrder:12}},decayRate:.15,glowColor:[.85,.6,.25],glowIntensityMin:.7,glowIntensityMax:1.2,glowFlickerRate:3,shakeAmount:.015,shakeFrequency:15,tremor:.008,tremorFrequency:5,endFlash:!0}),Fn=cn({name:"earthblast",emoji:"üí•",type:"blending",description:"Seismic detonation with expanding shockwave and rock debris",duration:1200,beats:2,intensity:1.8,category:"manifestation",petrification:.9,distortionStrength:1.5,spawnMode:[{type:"anchor",anchor:{landmark:"center",offset:{x:0,y:0,z:.05},orientation:"camera"},startScale:.2,endScale:3.5,scaleEasing:"easeOutCubic",count:1,scale:1.8,models:["earth-ring"],animation:{appearAt:0,disappearAt:.3,enter:{type:"flash",duration:.02,easing:"linear"},exit:{type:"fade",duration:.1,easing:"easeIn"},emissive:{min:.8,max:1.5,frequency:8,pattern:"sine"},blending:"normal",renderOrder:10},modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:0,arcCount:1},orientationOverride:"camera"}}},{type:"radial-burst",radialBurst:{count:8,radius:.15,endRadius:2,angleSpread:360,startAngle:22,orientation:"camera"},startScale:.2,endScale:1,scaleEasing:"easeOutQuad",count:8,scale:.9,models:["boulder"],animation:{appearAt:.02,disappearAt:.45,stagger:.005,enter:{type:"scale",duration:.03,easing:"easeOut"},exit:{type:"burst-fade",duration:.12,easing:"easeIn",burstScale:1.3},emissive:{min:.5,max:1,frequency:5,pattern:"sine"},rotate:[{axis:"z",rotations:2,phase:0},{axis:"z",rotations:-3,phase:45},{axis:"z",rotations:2.5,phase:90},{axis:"z",rotations:-2,phase:135},{axis:"z",rotations:3,phase:180},{axis:"z",rotations:-2.5,phase:225},{axis:"z",rotations:2,phase:270},{axis:"z",rotations:-3,phase:315}],atmospherics:[{preset:"earth-gravel",targets:["rock-chunk-medium","boulder"],anchor:"below",intensity:.5,sizeScale:.8,progressCurve:"burst"},{preset:"earth-dust",targets:["rock-chunk-medium"],anchor:"above",intensity:.4,sizeScale:1.2,progressCurve:"burst"}],scaleVariance:.3,blending:"normal",renderOrder:14}},{type:"radial-burst",radialBurst:{count:4,radius:.2,endRadius:1.5,angleSpread:360,startAngle:67,orientation:"camera"},startScale:.3,endScale:.7,scaleEasing:"easeOutQuad",count:4,scale:.7,models:["rock-cluster"],animation:{appearAt:.03,disappearAt:.5,stagger:.008,enter:{type:"scale",duration:.03,easing:"easeOut"},exit:{type:"fade",duration:.15,easing:"easeIn"},emissive:{min:.5,max:.9,frequency:4,pattern:"sine"},rotate:[{axis:"z",rotations:1.5,phase:0},{axis:"z",rotations:-2,phase:90},{axis:"z",rotations:1.5,phase:180},{axis:"z",rotations:-2,phase:270}],scaleVariance:.25,blending:"normal",renderOrder:15}}],decayRate:.1,endFlash:!0,glowColor:[.9,.65,.2],glowIntensityMin:.8,glowIntensityMax:1.5,glowFlickerRate:5,shakeAmount:.025,shakeFrequency:18,tremor:.01,tremorFrequency:6,scaleVibration:.03,scaleFrequency:8}),Dn=cn({name:"earthsurge",emoji:"üåä",type:"blending",description:"Seismic shockwave ripples outward from the mascot",duration:1200,beats:2,intensity:1.5,category:"emanating",petrification:.8,spawnMode:[{type:"axis-travel",axisTravel:{axis:"y",start:"center",end:"center",easing:"linear",speedCurve:"surge",startScale:.4,endScale:2.5,startDiameter:.5,endDiameter:3.5,orientation:"camera"},formation:{type:"spiral",count:1,spacing:0,arcOffset:0,phaseOffset:0},count:1,scale:2,models:["earth-ring"],animation:{appearAt:0,disappearAt:.7,enter:{type:"fade",duration:.03,easing:"linear"},exit:{type:"fade",duration:.5,easing:"easeIn"},procedural:{scaleSmoothing:.03,geometryStability:!0},cutout:{strength:.7,primary:{pattern:8,scale:.8,weight:1},secondary:{pattern:3,scale:1.2,weight:.5},blend:"multiply",travel:"radial",travelSpeed:2,strengthCurve:"fadeOut",trailDissolve:{enabled:!0,offset:-.4,softness:1.8}},grain:{type:3,strength:.3,scale:.2,speed:3,blend:"multiply"},emissive:{min:1.2,max:2.5,frequency:1,pattern:"sine"},atmospherics:[{preset:"earth-dust",targets:["earth-ring"],anchor:"around",intensity:.5,sizeScale:1.5,progressCurve:"burst"}],blending:"normal",depthWrite:!1,renderOrder:-5,modelOverrides:{"earth-ring":{shaderAnimation:{type:1,arcWidth:.95,arcSpeed:.3,arcCount:1},orientationOverride:"camera"}}}},{type:"radial-burst",radialBurst:{count:4,radius:.15,endRadius:2,angleSpread:360,startAngle:45,orientation:"camera",startScale:.4,endScale:1,scaleEasing:"easeOutQuad"},count:4,scale:.7,models:["rock-chunk-medium","rock-cluster","rock-chunk-medium","rock-chunk-small"],animation:{appearAt:.05,disappearAt:.55,stagger:.01,enter:{type:"scale",duration:.04,easing:"easeOut"},exit:{type:"burst-fade",duration:.2,easing:"easeIn",burstScale:1.3},emissive:{min:.6,max:1,frequency:2,pattern:"sine"},rotate:[{axis:"x",rotations:1.5,phase:0},{axis:"z",rotations:-1.2,phase:90},{axis:"y",rotations:1.8,phase:180},{axis:"x",rotations:-1,phase:270}],atmospherics:[{preset:"earth-gravel",targets:null,anchor:"around",intensity:.4,sizeScale:.6,progressCurve:"burst"}],scaleVariance:.3,blending:"normal",renderOrder:12}}],distortionStrength:1.5,decayRate:.15,glowColor:[.85,.6,.25],glowIntensityMin:1,glowIntensityMax:2,glowFlickerRate:4,beaconPulse:!0,scaleVibration:.015,scaleFrequency:6,tremor:.012,tremorFrequency:8,shakeAmount:.015,shakeFrequency:14});const qn={entangle:{name:"natureEntangle",emoji:"üåø",type:"blending",description:"Vines wrapping around, being tangled",duration:3500,beats:5,intensity:1,category:"afflicted",growth:.7,vineCount:6,wrapRate:.4,spiralWrap:!0,spawnMode:{type:"surface",pattern:"spikes",embedDepth:.15,cameraFacing:.2,clustering:.2,count:8,scale:1,models:["vine-tendril","vine-coil","thorn-vine"],minDistance:.15,animation:{appearAt:.1,disappearAt:.88,stagger:.05,enter:{type:"grow",duration:.15,easing:"easeOutCubic"},exit:{type:"shrink",duration:.12,easing:"easeIn"},pulse:{amplitude:.08,frequency:2,easing:"easeInOut"},emissive:{min:.4,max:.7,frequency:2,pattern:"sine"},drift:{direction:"outward",speed:.01,noise:.15},rotate:{axis:[0,1,.5],speed:.008,oscillate:!0,range:Math.PI/10},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:6,intensityScaling:{scale:1.2,driftSpeed:1.15}}},glowColor:[.2,.7,.25],glowIntensityMin:.5,glowIntensityMax:.8,glowFlickerRate:3,scaleVibration:.015,scaleFrequency:2,scaleContract:.02,restrictMovement:!0,tremor:.004,tremorFrequency:5,tremorDecay:.7,rotationTwist:.03,rotationTwistSpeed:.5,decayRate:.18},root:{name:"natureRoot",emoji:"üå±",type:"blending",description:"Roots growing, anchoring to ground",duration:3e3,beats:4,intensity:.9,category:"afflicted",growth:.6,rootDepth:.5,anchorStrength:.8,spreadFromBase:!0,spawnMode:{type:"surface",pattern:"shell",embedDepth:.25,cameraFacing:.1,clustering:.3,count:6,scale:1,models:["root-tendril","moss-patch"],minDistance:.18,animation:{appearAt:.08,disappearAt:.9,stagger:.06,enter:{type:"grow",duration:.12,easing:"easeOutQuad"},exit:{type:"fade",duration:.15,easing:"easeIn"},pulse:{amplitude:.05,frequency:1.2,easing:"easeInOut",sync:"global"},emissive:{min:.3,max:.55,frequency:1.5,pattern:"sine"},drift:{direction:"down",speed:.005,noise:.05},scaleVariance:.15,lifetimeVariance:.1,blending:"normal",renderOrder:4,intensityScaling:{scale:1.15,emissiveMax:1.2}}},glowColor:[.35,.5,.2],glowIntensityMin:.45,glowIntensityMax:.7,glowFlickerRate:2,scaleVibration:.008,scaleFrequency:2,sinkAmount:.015,sinkAcceleration:.3,tremor:.002,tremorFrequency:3,tremorDecay:.9,decayRate:.2},constrict:{name:"natureConstrict",emoji:"üêç",type:"blending",description:"Plants squeezing tight, crushing grip",duration:2800,beats:4,intensity:1.3,category:"afflicted",growth:.8,crushForce:.6,pulsingGrip:!0,vineThickness:.4,spawnMode:{type:"surface",pattern:"shell",embedDepth:.1,cameraFacing:.25,clustering:.4,count:10,scale:1,models:["vine-coil","thorn-vine","vine-tendril"],minDistance:.1,animation:{appearAt:.05,disappearAt:.85,stagger:.025,enter:{type:"grow",duration:.08,easing:"easeOutQuad"},exit:{type:"shrink",duration:.1,easing:"easeInCubic"},pulse:{amplitude:.12,frequency:4,easing:"snap"},emissive:{min:.4,max:.8,frequency:4,pattern:"sine"},drift:{direction:"inward",speed:.015,noise:.08},scaleVariance:.18,lifetimeVariance:.12,blending:"normal",renderOrder:7,intensityScaling:{scale:1.25,pulseAmplitude:1.4,driftSpeed:1.3}}},glowColor:[.25,.75,.2],glowIntensityMin:.55,glowIntensityMax:.9,glowFlickerRate:5,scaleVibration:.025,scaleFrequency:4,scaleContract:.05,scalePulse:!0,tremor:.006,tremorFrequency:8,decayRate:.15},bloom:{name:"natureBloom",emoji:"üå∏",type:"blending",description:"Flowers blooming outward, petals spreading",duration:3200,beats:4,intensity:.8,category:"emanating",growth:.75,bloomRate:.5,petalSpread:.6,flowerCount:8,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.1,cameraFacing:.4,clustering:.15,count:10,scale:1,models:["flower-bloom","flower-bud","petal-scatter"],minDistance:.15,animation:{appearAt:.12,disappearAt:.9,stagger:.06,enter:{type:"pop",duration:.1,easing:"easeOutBack",overshoot:1.2},exit:{type:"fade",duration:.15,easing:"easeIn"},pulse:{amplitude:.1,frequency:1.8,easing:"easeInOut"},emissive:{min:.5,max:.9,frequency:2,pattern:"sine"},drift:{direction:"up",speed:.008,noise:.12},rotate:{axis:"y",speed:.012,oscillate:!0,range:Math.PI/8},scaleVariance:.2,lifetimeVariance:.15,blending:"normal",renderOrder:8,intensityScaling:{scale:1.2,emissiveMax:1.25}}},glowColor:[.9,.6,.7],glowIntensityMin:.65,glowIntensityMax:1,glowFlickerRate:3,scaleVibration:.02,scaleFrequency:2,scaleGrow:.03,scalePulse:!0,floatAmount:.005,floatSpeed:1.2,rotationSpeed:.05,decayRate:.2},sprout:{name:"natureSprout",emoji:"üå±",type:"blending",description:"New growth emerging, shoots appearing",duration:2800,beats:4,intensity:.6,category:"emanating",growth:.5,sproutCount:5,sproutSpeed:.4,freshGrowth:!0,spawnMode:{type:"surface",pattern:"crown",embedDepth:.15,cameraFacing:.3,clustering:.2,count:6,scale:1,models:["leaf-single","leaf-cluster","fern-frond"],minDistance:.18,animation:{appearAt:.1,disappearAt:.88,stagger:.05,enter:{type:"grow",duration:.12,easing:"easeOutCubic"},exit:{type:"fade",duration:.12,easing:"easeIn"},pulse:{amplitude:.08,frequency:2.5,easing:"easeInOut"},emissive:{min:.5,max:.85,frequency:2.5,pattern:"sine"},drift:{direction:"up",speed:.012,noise:.08},scaleVariance:.18,lifetimeVariance:.12,blending:"normal",renderOrder:7,intensityScaling:{scale:1.18,emissiveMax:1.2}}},glowColor:[.5,.9,.35],glowIntensityMin:.6,glowIntensityMax:.95,glowFlickerRate:4,scaleVibration:.018,scaleFrequency:3,scaleGrow:.025,riseAmount:.008,riseSpeed:.6,decayRate:.18},flourish:{name:"natureFlourish",emoji:"üå≥",type:"blending",description:"Lush vegetation spreading, abundant growth",duration:3500,beats:5,intensity:1.1,category:"emanating",growth:.9,vegetationDensity:.8,spreadRate:.5,layeredGrowth:!0,spawnMode:{type:"surface",pattern:"shell",embedDepth:.15,cameraFacing:.3,clustering:.1,count:12,scale:1,models:["leaf-cluster","fern-frond","vine-tendril","flower-bloom"],minDistance:.12,animation:{appearAt:.08,disappearAt:.9,stagger:.035,enter:{type:"grow",duration:.1,easing:"easeOutBack",overshoot:1.15},exit:{type:"fade",duration:.15,easing:"easeIn"},pulse:{amplitude:.1,frequency:2,easing:"easeInOut",sync:"global"},emissive:{min:.55,max:.95,frequency:2,pattern:"sine"},drift:{direction:"outward",speed:.01,noise:.1},rotate:{axis:"y",speed:.01,oscillate:!0,range:Math.PI/10},scaleVariance:.2,lifetimeVariance:.12,blending:"normal",renderOrder:8,intensityScaling:{scale:1.25,emissiveMax:1.3}}},glowColor:[.3,.8,.3],glowIntensityMin:.6,glowIntensityMax:1,glowFlickerRate:3,scaleVibration:.025,scaleFrequency:2,scaleGrow:.05,scalePulse:!0,tremor:.003,tremorFrequency:4,rotationSpeed:.03,decayRate:.15},wilt:{name:"natureWilt",emoji:"ü•Ä",type:"blending",description:"Wilting and drooping, losing vitality",duration:3500,beats:5,intensity:.8,category:"transform",growth:.3,wiltRate:.5,droopPattern:!0,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.1,cameraFacing:.2,clustering:.25,count:5,scale:.9,models:["leaf-single","petal-scatter","flower-bud"],minDistance:.2},glowColor:[.6,.65,.3],glowIntensityMin:.4,glowIntensityMax:.65,glowFlickerRate:2,scaleVibration:.012,scaleFrequency:2,scaleShrink:.04,droopAmount:.02,droopAcceleration:.4,rotationTilt:.05,rotationTiltSpeed:.3,fadeOut:!0,fadeStartAt:.5,fadeEndAt:.95,fadeCurve:"smooth",decayRate:.18},overgrow:{name:"natureOvergrow",emoji:"üå≤",type:"blending",description:"Completely covered by growth, consumed by nature",duration:4e3,beats:6,intensity:1.3,category:"transform",growth:1,coverageRate:.6,layerCount:4,completeEnvelopment:!0,spawnMode:{type:"surface",pattern:"shell",embedDepth:.2,cameraFacing:.25,clustering:.15,count:15,scale:1.1,models:["vine-coil","leaf-cluster","fern-frond","moss-patch","mushroom-cap"],minDistance:.1},glowColor:[.15,.6,.2],glowIntensityMin:.5,glowIntensityMax:.85,glowFlickerRate:2,scaleVibration:.02,scaleFrequency:2,scaleGrow:.08,tremor:.003,tremorFrequency:3,sinkAmount:.005,sinkAcceleration:.2,rotationTwist:.04,rotationTwistSpeed:.3,fadeOut:!0,fadeStartAt:.6,fadeEndAt:.95,fadeCurve:"smooth",decayRate:.1},blossom:{name:"natureBlossom",emoji:"üå∫",type:"blending",description:"Transforming into flower form, becoming one with nature",duration:3500,beats:5,intensity:1,category:"transform",growth:.85,transformRate:.5,petalFormation:!0,colorShift:!0,spawnMode:{type:"surface",pattern:"scattered",embedDepth:.1,cameraFacing:.5,clustering:.2,count:10,scale:1,models:["flower-bloom","petal-scatter","flower-bud","leaf-single"],minDistance:.15},glowColor:[.95,.5,.6],glowIntensityMin:.6,glowIntensityMax:1.05,glowFlickerRate:4,scaleVibration:.025,scaleFrequency:3,scaleGrow:.04,scalePulse:!0,floatAmount:.006,floatSpeed:1,riseAmount:.01,riseSpeed:.4,rotationSpeed:.06,decayRate:.15}};function Rn(e){return(43758.5453*Math.sin(e)%1+1)%1}function Bn(e){const t=Math.floor(e),i=e-t,a=i*i*(3-2*i);return Rn(t)*(1-a)+Rn(t+1)*a}function En(e){const t=qn[e];return t?{name:t.name,emoji:t.emoji,type:t.type,description:t.description,config:{duration:t.duration,beats:t.beats,intensity:t.intensity,...t},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:"emanating"===t.category?1.4:1.2,offBeat:1,curve:"smooth"}},"3d":{evaluate(e,i){const a={...t,...i},s=e*a.duration/1e3,{category:n}=a;let r=1;"afflicted"===n&&(e<.2&&(r=e/.2),a.pulsingGrip)&&(r*=.15*Math.sin(s*Math.PI*3)+.85),"emanating"===n&&(e<.15&&(r=e/.15),r*=.1*Math.sin(s*Math.PI*2)+.9),"transform"===n&&(r=Math.pow(e,.7)),e>1-a.decayRate&&(r*=1-(e-(1-a.decayRate))/a.decayRate);let o=0,l=0,h=0;if(a.floatAmount>0){const e=s*a.floatSpeed;l+=Math.sin(e*Math.PI*2)*a.floatAmount*r}if(a.riseAmount>0&&(l+=a.riseAmount*e*r),a.droopAmount>0){const t=e*(1+a.droopAcceleration*e);l-=a.droopAmount*t*r}if(a.sinkAmount>0){const t=e*(1+a.sinkAcceleration*e);l-=a.sinkAmount*t*r}if(a.tremor>0){let t=a.tremor;a.tremorDecay&&(t*=1-e*a.tremorDecay);const i=s*a.tremorFrequency;o+=(Bn(i)-.5)*t*r,l+=(Bn(i+50)-.5)*t*.5*r,h+=(Bn(i+100)-.5)*t*.3*r}let c=1;const u=s*a.scaleFrequency;c=a.scalePulse?1+(.5*Math.sin(u*Math.PI*2)+.5-.5)*a.scaleVibration*r:1+(.6*Math.sin(u*Math.PI*2)+.4*Math.sin(u*Math.PI*2.7))*a.scaleVibration*r,a.scaleGrow>0&&(c+=a.scaleGrow*e*r),a.scaleContract>0&&(c-=a.scaleContract*e*r),a.scaleShrink>0&&(c-=a.scaleShrink*e*r),c=Math.max(.1,c);let d=0,p=0,g=0;if(a.rotationSpeed>0&&(p=s*a.rotationSpeed*Math.PI*2*r),a.rotationTwist>0){const e=s*a.rotationTwistSpeed;g=Math.sin(e*Math.PI*2)*a.rotationTwist*r}if(a.rotationTilt>0){const t=e*a.rotationTiltSpeed;d=a.rotationTilt*t*r,g=.5*a.rotationTilt*t*r}let m=1;if(a.fadeOut){const t=a.fadeStartAt||.5,i=a.fadeEndAt||.95;if(e>=t){const s=Math.min(1,(e-t)/(i-t));let n;n="accelerating"===a.fadeCurve?1-Math.pow(s,2):1-s,m=Math.max(0,n)}}const y=s*a.glowFlickerRate;let f;f="emanating"===n?.2*Math.sin(y*Math.PI*2)+.8:a.pulsingGrip?.25*Math.sin(y*Math.PI*2)+.75:.15*Math.sin(y*Math.PI*2)+.85;const b=a.glowIntensityMin+(a.glowIntensityMax-a.glowIntensityMin)*f*r,w=.2*r*a.intensity*a.growth;return{natureOverlay:{enabled:r>.1,strength:r*a.intensity,growth:a.growth,category:a.category,spawnMode:a.spawnMode||null,duration:a.duration,time:s,animation:t.spawnMode?.animation,models:t.spawnMode?.models,count:t.spawnMode?.count,scale:t.spawnMode?.scale,embedDepth:t.spawnMode?.embedDepth},position:[o,l,h],rotation:[d,p,g],scale:c,meshOpacity:m,glowIntensity:b,glowBoost:w,glowColorOverride:a.glowColor}}}}:En("entangle")}const Pn=En("entangle"),Tn=En("root"),jn=En("constrict"),Vn=En("bloom"),$n=En("flourish"),Wn=En("blossom");var Gn={name:"morph",emoji:"‚ú®",type:"override",description:"Form geometric patterns and shapes",config:{musicalDuration:{musical:!0,beats:2,minBeats:1,maxBeats:8},phases:[{name:"gather",beats:.25},{name:"form",beats:.75},{name:"hold",beats:.5},{name:"dissolve",beats:.5}],morphType:"fluid",pattern:"star",points:5,innerRadius:.4,size:80,amplitude:20,rotation:0,smooth:!0,randomizeOrder:!1,easing:"sine",strength:1.2,particleMotion:{type:"morph",pattern:"star",strength:1.2,smooth:!0,points:5}},rhythm:{enabled:!0,syncMode:"phrase",patternSync:{verse:"circle",chorus:"star",bridge:"heart",drop:"explosion"},timingSync:{formationBeat:1,holdBeats:2,dissolveBeat:4,curve:"anticipatory"},sizeSync:{onBeat:1.2,offBeat:.95,subdivision:"quarter",curve:"elastic"},rotationSync:{mode:"continuous",degreesPerBar:90,direction:"clockwise"},dynamics:{forte:{points:8,size:100},piano:{points:3,size:60}}},initialize(e,t,i,a,s){e.gestureData||(e.gestureData={});const n={...this.config,...t},r=e.x,o=e.y,l=Math.atan2(e.y-a,e.x-i),h=Math.random()<.5?1:-1;let c,u;const d=n.size*e.scaleFactor,p=(n.rotation||0)*Math.PI/180*h;switch(n.pattern){case"star":c=i,u=a,this.calculateStarPosition(e,l,d,n.points,n.innerRadius,p,i,a);break;case"heart":this.calculateHeartPosition(e,l,d,p,i,a);break;case"square":this.calculateSquarePosition(e,l,d,p,i,a);break;case"triangle":this.calculateTrianglePosition(e,l,d,p,i,a);break;default:{const e=d;c=i+Math.cos(l+p)*e,u=a+Math.sin(l+p)*e;break}}e.gestureData.morph={startX:r,startY:o,targetX:e.gestureData.morphTargetX||c,targetY:e.gestureData.morphTargetY||u,originalVx:e.vx,originalVy:e.vy,rotationDirection:h,initialized:!0}},calculateStarPosition(e,t,i,a,s,n,r,o){const l=((t+Math.PI)%(2*Math.PI)+2*Math.PI)%(2*Math.PI),h=Math.floor(l/(2*Math.PI)*10),c=h%2==0,u=Math.floor(h/2);let d;d=c?72*u*Math.PI/180:(72*u+36)*Math.PI/180,d+=n;const p=c?i:i*s;e.gestureData.morphTargetX=r+Math.cos(d)*p,e.gestureData.morphTargetY=o+Math.sin(d)*p},calculateHeartPosition(e,t,i,a,s,n){const r=(t+Math.PI)/(2*Math.PI),o=.05*i,l=16*Math.pow(Math.sin(r*Math.PI*2),3),h=-(13*Math.cos(r*Math.PI*2)-5*Math.cos(2*r*Math.PI*2)-2*Math.cos(3*r*Math.PI*2)-Math.cos(4*r*Math.PI*2)),c=Math.cos(a),u=Math.sin(a),d=l*c-h*u,p=l*u+h*c;e.gestureData.morphTargetX=s+d*o,e.gestureData.morphTargetY=n+p*o},calculateSquarePosition(e,t,i,a,s,n){const r=((t+a)%(2*Math.PI)+2*Math.PI)%(2*Math.PI);let o,l;const h=i;r<Math.PI/4||r>=7*Math.PI/4?(o=h,l=h*Math.tan(r)):r<3*Math.PI/4?(o=h/Math.tan(r),l=h):r<5*Math.PI/4?(o=-h,l=-h*Math.tan(r)):(o=-h/Math.tan(r),l=-h);const c=Math.cos(a),u=Math.sin(a),d=o*c-l*u,p=o*u+l*c;e.gestureData.morphTargetX=s+d,e.gestureData.morphTargetY=n+p},calculateTrianglePosition(e,t,i,a,s,n){const r=[{x:0,y:-i},{x:.866*-i,y:.5*i},{x:.866*i,y:.5*i}],o=Math.floor((t+Math.PI)/(2*Math.PI)*3)%3,l=(o+1)%3,h=Math.random(),c=r[o].x+(r[l].x-r[o].x)*h,u=r[o].y+(r[l].y-r[o].y)*h,d=Math.cos(a),p=Math.sin(a),g=c*d-u*p,m=c*p+u*d;e.gestureData.morphTargetX=s+g,e.gestureData.morphTargetY=n+m},apply(e,t,i,a,s,n){e.gestureData?.morph?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.morph,o={...this.config,...i};let l,h,c=t;if(o.holdTime>0){const e=.5-o.holdTime/2,i=.5+o.holdTime/2;c=t<e?t/e*.5:t<i?.5:.5+(t-i)/(1-i)*.5}if(c<=.5){const e=2*c;l=r.startX+(r.targetX-r.startX)*this.easeOutQuad(e),h=r.startY+(r.targetY-r.startY)*this.easeOutQuad(e)}else{const e=2*(c-.5);l=r.targetX+(r.startX-r.targetX)*this.easeInQuad(e),h=r.targetY+(r.startY-r.targetY)*this.easeInQuad(e)}if(o.smooth){const t=.2;e.x+=(l-e.x)*t,e.y+=(h-e.y)*t}else e.x=l,e.y=h;if(e.vx=.5*(l-e.x),e.vy=.5*(h-e.y),t>.9){const i=10*(1-t);e.vx=e.vx*i+r.originalVx*(1-i),e.vy=e.vy*i+r.originalVy*(1-i)}},cleanup(e){if(e.gestureData?.morph){const t=e.gestureData.morph;e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.morph,delete e.gestureData.morphTargetX,delete e.gestureData.morphTargetY}},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeOutQuad:e=>e*(2-e),easeInQuad:e=>e*e,"3d":{evaluate(e,t){const i=t?.strength||1,a=Math.sin(e*Math.PI);let s;if(e<=.5){const t=2*e;s=1+t*(2-t)*.25*i}else{const t=2*(e-.5);s=1.25*i+t*t*(1-1.25*i),s=Math.max(1,s)}return{position:[0,0,0],rotation:[0,a*Math.PI*.3*i,.1*Math.sin(e*Math.PI*2)*i],scale:s,glowIntensity:1+.4*a*i,glowBoost:1.5*a*i}}}},Ln={name:"rain",emoji:"üåßÔ∏è",type:"override",description:"Particles fall down from their current positions",config:{duration:3e3,musicalDuration:{musical:!0,bars:2},fallSpeed:8,fallDistance:400,wobbleAmount:1.5,strength:1,particleMotion:{type:"rain",strength:1,fallSpeed:8}},rhythm:{enabled:!0,syncMode:"ambient",durationSync:{mode:"bars",bars:2},intensitySync:{quiet:.5,loud:1.5,crescendo:"increase",diminuendo:"decrease"}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.rain={originalX:e.x,originalY:e.y,originalVx:e.vx,originalVy:e.vy,originalOpacity:e.opacity??e.life??1,currentX:e.x,currentY:e.y,wobblePhase:Math.random()*Math.PI*2,wobbleSpeed:.3+.4*Math.random(),initialized:!0}},apply(e,t,i,a){const s="number"==typeof a?a:1;e.gestureData?.rain?.initialized||this.initialize(e,i);const n=e.gestureData.rain,r={...this.config,...i},o=i?.strength||1,l=(r.fallSpeed||8)*o,h=(r.fallDistance||400)*t*o;n.wobblePhase+=n.wobbleSpeed*s*.1;const c=Math.sin(n.wobblePhase)*(r.wobbleAmount||1.5);if(e.y,e.x=n.originalX+c,e.y=n.originalY+h,e.vx=.3*c,e.vy=10*l,t>.6){const i=(t-.6)/.4;e.opacity=n.originalOpacity*(1-i),void 0!==e.life&&(e.life=n.originalOpacity*(1-i))}else e.opacity=n.originalOpacity,void 0!==e.life&&(e.life=n.originalOpacity)},cleanup(e){if(e.gestureData?.rain){const t=e.gestureData.rain;e.x=t.originalX,e.y=t.originalY,e.vx=t.originalVx,e.vy=t.originalVy,e.opacity=t.originalOpacity,void 0!==e.life&&(e.life=t.originalOpacity),delete e.gestureData.rain}},"3d":{evaluate:(e,t)=>({position:[0,0,0],rotation:[0,0,0],scale:1})}},_n={name:"drift",emoji:"‚òÅÔ∏è",type:"override",description:"Controlled floating with fade effects",config:{duration:800,musicalDuration:{musical:!0,beats:2},distance:50,angle:45,returnToOrigin:!0,fadeOut:!1,holdTime:.2,turbulence:.1,angleSpread:45,smoothness:.08,easing:"ease",strength:1,particleMotion:{type:"drift",strength:1,distance:60}},rhythm:{enabled:!0,syncMode:"ambient",durationSync:{mode:"beats",beats:2},distanceSync:{quiet:30,loud:80,crescendo:"expand",diminuendo:"contract"},angleSync:{major:45,minor:225,modulation:"smooth",cadence:"return"},holdSync:{shortPhrase:.1,longPhrase:.4,fermata:"sustain"},accentResponse:{enabled:!0,multiplier:1.3,type:"distance"},patternOverrides:{ambient:{distanceSync:{quiet:40,loud:100},holdSync:{shortPhrase:.3,longPhrase:.6}},classical:{angleSync:{major:30,minor:210},distanceSync:{quiet:25,loud:60}},jazz:{angleSync:{major:60,minor:240,swing:!0,syncopated:!0}},new_age:{distanceSync:{quiet:35,loud:70},holdSync:{shortPhrase:.4,longPhrase:.8},angleSync:{modulation:"gradual"}}},dynamics:{forte:{distanceSync:{quiet:{multiplier:1.5},loud:{multiplier:1.8}},holdSync:{multiplier:1.2},accentResponse:{multiplier:1.6}},piano:{distanceSync:{quiet:{multiplier:.6},loud:{multiplier:.8}},holdSync:{multiplier:.8},accentResponse:{multiplier:1.1}}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a;let r=Math.atan2(n,s);const o={...this.config,...t}.angleSpread*Math.PI/180,l=(Math.random()-.5)*o;r+=l;const h=30+30*Math.random();e.gestureData.drift={startX:e.x,startY:e.y,originalVx:e.vx,originalVy:e.vy,baseOpacity:e.opacity||e.life||1,driftAngle:r,angleOffset:l,homeRadius:h*e.scaleFactor,homeX:i+Math.cos(r)*h,homeY:a+Math.sin(r)*h,role:Math.random(),turbulencePhase:Math.random()*Math.PI*2,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.drift?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.drift,o={...this.config,...i},l=i.strength||1,h=this.easeInOutCubic(t),c=Math.max(0,h-.1*r.role);let u,d,p;if(o.returnToOrigin)if(c<.4){const e=c/.4,t=this.easeOutQuad(e);u=r.startX+(r.homeX-r.startX)*t,d=r.startY+(r.homeY-r.startY)*t}else if(c<.6+o.holdTime){const t=(c-.4)/(.2+o.holdTime);p=r.homeRadius+Math.sin(t*Math.PI*.5)*o.distance*l*e.scaleFactor}else{const t=(c-.6-o.holdTime)/(.4-o.holdTime);p=r.homeRadius+Math.cos(t*Math.PI*.5)*o.distance*l*e.scaleFactor}else{const t=c;p=r.homeRadius+t*o.distance*l*e.scaleFactor}if(void 0!==p){r.turbulencePhase+=o.turbulence*a;const e=Math.sin(r.turbulencePhase)*o.turbulence*10,t=Math.cos(1.3*r.turbulencePhase)*o.turbulence*10,i=r.driftAngle+r.angleOffset;u=s+Math.cos(i)*p+e,d=n+Math.sin(i)*p+t}const g=o.smoothness+.08*r.role;if(e.x+=(u-e.x)*g,e.y+=(d-e.y)*g,e.vx=.25*(u-e.x),e.vy=.25*(d-e.y),o.fadeOut){let i;i=t<.25?.3+t/.25*.7:t<.75?.7+.3*Math.sin((t-.25)*Math.PI/.5):4*(1-t),e.opacity=r.baseOpacity*i,void 0!==e.life&&(e.life=e.opacity)}t>=.99&&(e.vx=.1*r.originalVx,e.vy=.1*r.originalVy,o.fadeOut&&(e.opacity=r.baseOpacity,void 0!==e.life&&(e.life=r.baseOpacity)))},cleanup(e){if(e.gestureData?.drift){const t=e.gestureData.drift;e.vx=t.originalVx,e.vy=t.originalVy,e.opacity=t.baseOpacity,void 0!==e.life&&(e.life=t.baseOpacity),delete e.gestureData.drift}},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeOutQuad:e=>e*(2-e),"3d":{evaluate(e,t){const i={...this.config,...t},a=t.strength||1,s=(i.angle||45)*Math.PI/180,n=i.returnToOrigin?e<.5?2*e:2*(1-e):e;return{position:[Math.cos(s)*n*.3*a,Math.sin(s)*n*.3*a,.15*Math.sin(e*Math.PI)*a],rotation:[0,10*n*a,0],scale:1+.03*Math.sin(e*Math.PI),glowIntensity:1-.1*n}}}};function Hn(e){const t=F[e];if(!t)throw new Error(`Invalid drift direction: ${e}`);const i="up"===e||"down"===e;return{name:`drift${D(e)}`,emoji:"up"===e?"‚òÅÔ∏è":"down"===e?"üçÉ":"left"===e?"üå´Ô∏è":"üí≠",type:"override",description:`Gentle drifting ${e}`,config:{duration:800,musicalDuration:{musical:!0,beats:2},distance:50,returnToOrigin:!0,fadeOut:!1,holdTime:.2,turbulence:.1,smoothness:.08,strength:1,direction:e,particleMotion:{type:"drift",strength:1,distance:60}},rhythm:{enabled:!0,syncMode:"ambient",durationSync:{mode:"beats",beats:2},distanceSync:{quiet:30,loud:80,crescendo:"expand",diminuendo:"contract"},holdSync:{shortPhrase:.1,longPhrase:.4,fermata:"sustain"},accentResponse:{enabled:!0,multiplier:1.3,type:"distance"}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=(30+30*Math.random())*e.scaleFactor;e.gestureData.drift={startX:e.x,startY:e.y,originalVx:e.vx,originalVy:e.vy,baseOpacity:e.opacity||e.life||1,homeRadius:s,role:Math.random(),turbulencePhase:Math.random()*Math.PI*2,initialized:!0}},apply(e,a,s,n,r,o){e.gestureData?.drift?.initialized||this.initialize(e,s,r,o);const l=e.gestureData.drift,h={...this.config,...s},c=s.strength||1,u=this.easeInOutCubic(a),d=Math.max(0,u-.1*l.role);let p,g=l.startX,m=l.startY;p=h.returnToOrigin?d<.5?2*d:2*(1-d):d;const y=h.distance*c*e.scaleFactor*p;l.turbulencePhase+=h.turbulence*n;const f=Math.sin(l.turbulencePhase)*h.turbulence*10,b=Math.cos(1.3*l.turbulencePhase)*h.turbulence*10;i?(m=l.startY+t.y*y+f,g=l.startX+.5*b):(g=l.startX+t.x*y+b,m=l.startY+.5*f);const w=h.smoothness+.08*l.role;if(e.x+=(g-e.x)*w,e.y+=(m-e.y)*w,e.vx=.25*(g-e.x),e.vy=.25*(m-e.y),h.fadeOut){let t=1;t=a<.25?.3+a/.25*.7:a<.75?.7+.3*Math.sin((a-.25)*Math.PI/.5):4*(1-a),e.opacity=l.baseOpacity*t}a>=.99&&(e.vx=.1*l.originalVx,e.vy=.1*l.originalVy,h.fadeOut&&(e.opacity=l.baseOpacity))},cleanup(e){if(e.gestureData?.drift){const t=e.gestureData.drift;e.vx=t.originalVx,e.vy=t.originalVy,e.opacity=t.baseOpacity,delete e.gestureData.drift}},easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"3d":{evaluate(e,a){const s=a||{},n=s.strength||1,r=s.distance||50,o=!1!==s.returnToOrigin?Math.sin(e*Math.PI):e,l=.004*r*n*o,h=t.x*l,c=t.y*l;let u=0,d=0;return i?u=t.y*o*.1:d=t.x*o*.15,{cameraRelativePosition:[h,c,0],rotation:[u,d,0],scale:1+.03*o,glowIntensity:1-.1*o}}}}}var Un=Hn("up"),Qn=Hn("down"),Yn=Hn("left"),Xn=Hn("right"),Nn={name:"vortex",emoji:"üåÄ",type:"override",description:"Spiral tornado pattern inward or outward",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},direction:"inward",rotationSpeed:2,pullStrength:1,liftAmount:.5,strength:1,particleMotion:{type:"vortex",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",rotationSync:{onBeat:1.5,offBeat:.8}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-(i||0),n=e.y-(a||0);e.gestureData.vortex={originalX:e.x,originalY:e.y,startAngle:Math.atan2(n,s),startDistance:Math.sqrt(s*s+n*n),initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.vortex?.initialized||this.initialize(e,i,s,n);const r={...this.config,...i},o=e.gestureData.vortex,l="outward"!==r.direction,h=r.rotationSpeed||2,c=r.pullStrength||1,u=t*h*Math.PI*2,d=o.startAngle+u;let p;p=l?1-t*c*.8:1+t*c*.5;const g=o.startDistance*p;e.x=s+Math.cos(d)*g,e.y=n+Math.sin(d)*g,l&&t>.7&&(e.opacity=1-(t-.7)/.3)},cleanup(e){if(e.gestureData?.vortex){const t=e.gestureData.vortex;e.x=t.originalX,e.y=t.originalY,e.opacity=1,delete e.gestureData.vortex}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s="outward"!==i.direction,n=i.rotationSpeed||2,r=i.liftAmount||.5,o=e*n*Math.PI*2*a;let l;l=s?1-.3*e*a:1+.2*e*a;const h=e>.85?(1-e)/.15:1;return{position:[0,Math.sin(e*Math.PI)*r*.1*a*h,0],rotation:[.1*Math.sin(o)*a*h,o,.1*Math.cos(o)*a*h],scale:l,glowIntensity:1+.4*e,glowBoost:.3*e}}}};function Jn(e){if(!F[e])throw new Error(`Invalid cascade direction: ${e}`);const t="up"===e||"down"===e,i="down"===e||"right"===e;return{name:`cascade${D(e)}`,emoji:"down"===e?"üåä":"up"===e?"‚ú®":"left"===e?"üçÇ":"üå¨Ô∏è",type:"override",description:`Sequential cascade ${e}`,config:{duration:2e3,musicalDuration:{musical:!0,bars:1},distance:200,waveCount:4,staggerDelay:.15,wobble:1,strength:1,direction:e,particleMotion:{type:"cascade",strength:1,direction:e}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",distanceSync:{quiet:100,loud:300,crescendo:"expand",diminuendo:"contract"}},initialize(e,t){e.gestureData||(e.gestureData={});const i=t?.waveCount||4;let a;a=Math.floor(Math.random()*i),e.gestureData.cascade={originalX:e.x,originalY:e.y,originalOpacity:e.opacity??e.life??1,waveGroup:a,wobblePhase:Math.random()*Math.PI*2,wobbleSpeed:.3+.4*Math.random(),initialized:!0}},apply(e,a,s,n,r,o){e.gestureData?.cascade?.initialized||this.initialize(e,s);const l={...this.config,...s},h=l.strength||1,c=e.gestureData.cascade,u="number"==typeof n?n:1,d=l.waveCount||4,p=l.staggerDelay||.15,g=c.waveGroup*p,m=Math.max(0,(a-g)/(1-g*(d-1)/d));if(m<=0)return;const y=(1-Math.pow(1-m,2))*((l.distance||200)*h)*(i?1:-1);c.wobblePhase+=c.wobbleSpeed*u*.1;const f=Math.sin(c.wobblePhase)*(l.wobble||1)*10;if(t?(e.y=c.originalY+y,e.x=c.originalX+f):(e.x=c.originalX+y,e.y=c.originalY+f),m>.6){const t=(m-.6)/.4;e.opacity=c.originalOpacity*(1-t)}},cleanup(e){if(e.gestureData?.cascade){const t=e.gestureData.cascade;e.x=t.originalX,e.y=t.originalY,e.opacity=t.originalOpacity,delete e.gestureData.cascade}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.direction||"down",n=1-Math.pow(1-e,2);let r=0,o=0;const l=.3*n*a;switch(s){case"down":o=-l;break;case"up":o=l;break;case"left":r=-l;break;case"right":r=l}const h=.03*Math.sin(e*Math.PI*4)*a;"down"===s||"up"===s?r+=h:o+=h;const c=e>.85?(1-e)/.15:1;return{cameraRelativePosition:[r*c,o*c,0],rotation:[("down"===s?.05:"up"===s?-.05:0)*a*c,0,("left"===s?.1:"right"===s?-.1:0)*a*c],scale:1-.1*n,glowIntensity:1+.2*(1-n)}}}}}var Zn=Jn("up"),Kn=Jn("down"),er=Jn("left"),tr=Jn("right"),ir={name:"confetti",emoji:"üéä",type:"effect",description:"Celebratory confetti flutter with chaotic rotation",config:{duration:2500,musicalDuration:{musical:!0,bars:1.5},burstHeight:.3,fallSpeed:1,tumbleSpeed:2,spread:1,strength:1,particleMotion:{type:"confetti",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1.5},timingSync:"onBeat"},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.confetti={originalX:e.x,originalY:e.y,driftX:2*(Math.random()-.5),tumblePhase:Math.random()*Math.PI*2,tumbleSpeed:.5+1.5*Math.random(),flutterAmp:.3+.7*Math.random(),initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.confetti?.initialized||this.initialize(e,i);const r={...this.config,...i},o=r.strength||1,l=e.gestureData.confetti,h=Math.min(t/.2,1),c=Math.max(0,(t-.2)/.8),u=-50*Math.sin(h*Math.PI)*(r.burstHeight||.3),d=c*c*200*(r.fallSpeed||1),p=20*Math.sin(t*Math.PI*8*l.tumbleSpeed)*l.flutterAmp,g=l.driftX*t*100*(r.spread||1);e.x=l.originalX+g+p*o,e.y=l.originalY+u+d*o,t>.7&&(e.opacity=1-(t-.7)/.3)},cleanup(e){e.gestureData?.confetti&&delete e.gestureData.confetti},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1,a=Math.min(e/.2,1),s=Math.max(0,(e-.2)/.8),n=.15*Math.sin(a*Math.PI)-s*s*.3,r=e*Math.PI*4,o=.3*Math.sin(1.3*r)*i,l=.4*Math.sin(.7*r)*i,h=.5*Math.sin(1.1*r)*i,c=e>.85?(1-e)/.15:1;return{position:[.08*Math.sin(e*Math.PI*6)*i*c,n*i*c,0],rotation:[o*c,l*c,h*c],scale:1+.1*Math.sin(2*r)*i,glowIntensity:1+.3*(1-s)}}}},ar={name:"fizz",emoji:"ü´ß",type:"override",description:"Bubbles rising upward with wobble",config:{duration:2500,musicalDuration:{musical:!0,bars:1.5},riseSpeed:6,riseDistance:300,wobbleAmount:2,strength:1,particleMotion:{type:"fizz",strength:1}},rhythm:{enabled:!0,syncMode:"ambient",durationSync:{mode:"bars",bars:1.5},intensitySync:{quiet:.5,loud:1.5}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.fizz={originalX:e.x,originalY:e.y,originalOpacity:e.opacity??e.life??1,wobblePhase:Math.random()*Math.PI*2,wobbleSpeed:.4+.6*Math.random(),riseMultiplier:.7+.6*Math.random(),initialized:!0}},apply(e,t,i,a){e.gestureData?.fizz?.initialized||this.initialize(e,i);const s={...this.config,...i},n=s.strength||1,r=e.gestureData.fizz,o="number"==typeof a?a:1,l=(s.riseDistance||300)*t*n*r.riseMultiplier;r.wobblePhase+=r.wobbleSpeed*o*.1;const h=Math.sin(r.wobblePhase)*(s.wobbleAmount||2)*(1+t);if(e.x=r.originalX+h,e.y=r.originalY-l,e.vx=.3*h,e.vy=10*-(s.riseSpeed||6),t>.6){const i=(t-.6)/.4;e.opacity=r.originalOpacity*(1-i),void 0!==e.life&&(e.life=r.originalOpacity*(1-i))}},cleanup(e){if(e.gestureData?.fizz){const t=e.gestureData.fizz;e.x=t.originalX,e.y=t.originalY,e.opacity=t.originalOpacity,void 0!==e.life&&(e.life=t.originalOpacity),delete e.gestureData.fizz}},"3d":{evaluate(e,t){const i=(t.config||this.config||{}).strength||1;let a=0,s=1,n=1;if(e<.15){const t=e/.15;a=.15*t,s=1+.02*t,n=1+.15*t}else if(e<.7){const t=(e-.15)/.55;a=.5-.15*t,s=1.02+.03*Math.sin(t*Math.PI*6),n=1.2+.15*Math.sin(t*Math.PI*8)}else{const t=(e-.7)/.3;a=.35*(1-t),s=1.02-.02*t,n=1.2-.2*t}const r=35*e;return{position:[.008*Math.sin(1.7*r)*a*i,.006*Math.sin(2.3*r)*a*i,.004*Math.sin(1.9*r)*a*i],rotation:[.03*Math.sin(1.3*r)*a*i,.02*Math.sin(1.1*r)*a*i,.04*Math.sin(1.5*r)*a*i],scale:[s+.015*Math.sin(2.1*r)*a,s+.02*Math.sin(1.8*r)*a,s+.015*Math.sin(2.4*r)*a],glowIntensity:n,glowBoost:.2*a}}}};function sr(e){const t=F[e];if(!t)throw new Error(`Invalid swarm direction: ${e}`);return{name:`swarm${D(e)}`,emoji:"up"===e?"ü¶Ö":"down"===e?"ü¶Ü":"üêü",type:"override",description:`Flock movement ${e}`,config:{duration:1800,musicalDuration:{musical:!0,bars:1},clusterPhase:.3,moveDistance:120,clusterTightness:.5,wobble:1,strength:1,direction:e,particleMotion:{type:"swarm",strength:1,direction:e}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat"},initialize(e,t,i,a){e.gestureData||(e.gestureData={}),e.gestureData.swarm={originalX:e.x,originalY:e.y,originalOpacity:e.opacity??1,wobblePhase:Math.random()*Math.PI*2,wobbleSpeed:.3+.4*Math.random(),timeOffset:.1*Math.random(),initialized:!0}},apply(e,i,a,s,n,r){e.gestureData?.swarm?.initialized||this.initialize(e,a,n,r);const o={...this.config,...a},l=o.strength||1,h=e.gestureData.swarm,c=o.clusterPhase||.3,u=o.moveDistance||120,d=o.clusterTightness||.5,p=Math.max(0,Math.min(1,i-h.timeOffset));let g,m;if(p<c){const e=p/c,t=1-Math.pow(1-e,2);g=h.originalX+(n-h.originalX)*d*t,m=h.originalY+(r-h.originalY)*d*t}else{const e=(p-c)/(1-c),i=1-Math.pow(1-e,2),a=h.originalX+(n-h.originalX)*d,s=h.originalY+(r-h.originalY)*d;g=a+t.x*u*i*l,m=s+t.y*u*i*l}const y="number"==typeof s?s:1;h.wobblePhase+=h.wobbleSpeed*y*.1;const f=Math.sin(3*h.wobblePhase)*o.wobble*5,b=Math.cos(2.5*h.wobblePhase)*o.wobble*5;e.x=g+f,e.y=m+b,p>.8&&(e.opacity=h.originalOpacity*(1-5*(p-.8)))},cleanup(e){if(e.gestureData?.swarm){const t=e.gestureData.swarm;e.x=t.originalX,e.y=t.originalY,e.opacity=t.originalOpacity,delete e.gestureData.swarm}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.direction||"up",n=i.clusterPhase||.3,[r,o]={up:[0,1],down:[0,-1],left:[-1,0],right:[1,0]}[s]||[0,1];let l=0,h=0,c=1;if(e<n)c=1-e/n*.1*a;else{const t=(e-n)/(1-n),i=1-Math.pow(1-t,2);l=r*i*.25*a,h=o*i*.25*a,c=.9+.1*t}const u=e>n?.1:0,d=e>.85?(1-e)/.15:1;return{cameraRelativePosition:[(l+.02*Math.sin(e*Math.PI*6)*a)*d,h*d,0],rotation:[o*u*a,0,-r*u*a],scale:c,glowIntensity:1+(e>n?.2:0)}}}}}var nr=sr("up"),rr=sr("down"),or=sr("left"),lr=sr("right"),hr={name:"burst",emoji:"üí•",type:"blending",description:"Explosive outward burst from center",config:{decay:.5,strength:2},rhythm:{enabled:!0,syncMode:"beat",strengthSync:{onBeat:3.5,offBeat:1,curve:"explosion"},decaySync:{mode:"tempo",fast:.8,slow:.3,curve:"exponential"},durationSync:{mode:"beats",beats:.5,sustain:!1},accentResponse:{enabled:!0,multiplier:2.5,type:"strength"},patternOverrides:{rock:{strengthSync:{onBeat:4,offBeat:1.5},decaySync:{fast:.6,slow:.4}},electronic:{strengthSync:{onBeat:3.8,offBeat:.8,curve:"sharp"},decaySync:{fast:.9,slow:.7}},jazz:{strengthSync:{onBeat:2.8,offBeat:1.8,swing:!0},decaySync:{fast:.5,slow:.2}},orchestral:{strengthSync:{onBeat:3.2,offBeat:.5},accentResponse:{multiplier:3}}},dynamics:{forte:{strengthSync:{onBeat:{multiplier:2},offBeat:{multiplier:1.5}},decaySync:{multiplier:.7},accentResponse:{multiplier:3.5}},piano:{strengthSync:{onBeat:{multiplier:.6},offBeat:{multiplier:.3}},decaySync:{multiplier:1.3},accentResponse:{multiplier:1.8}}}},apply(e,t,i,a,s,n){const r=i.decay||this.config.decay,o=(i.strength||this.config.strength)*(1-t*r),l=e.x-s,h=e.y-n,c=Math.sqrt(l*l+h*h);c>1&&(e.vx+=l/c*o*2*a,e.vy+=h/c*o*2*a)},"3d":{evaluate(e,t){const i=t.strength||2;let a=0,s=1,n=1,r=0;if(e<.15){const t=e/.15,o=1-Math.pow(1-t,3);a=.15*o*i,s=1+.2*o*i,n=1+.5*o,r=.4*o}else if(e<.35){const t=(e-.15)/.2;a=.15*(1-1.5*t)*i,s=1+.2*(1-t)*i-.1*Math.sin(t*Math.PI),n=1+.4*(1-t),r=.2*(1-t)}else{const t=(e-.35)/.65,r=Math.pow(1-t,2),o=Math.sin(t*Math.PI*2)*r;a=.03*o*i,s=1+.05*o,n=1+.15*Math.abs(o)}return{cameraRelativePosition:[0,0,a],position:[0,0,0],rotation:[0,0,0],scale:s,glowIntensity:n,glowBoost:r}}}};function cr(e){const t=F[e];if(!t)throw new Error(`Invalid burst direction: ${e}`);const i="up"===e||"down"===e;return{name:`burst${D(e)}`,emoji:"up"===e?"‚õ≤":"down"===e?"üöø":"üí®",type:"blending",description:`Explosive burst ${e}`,config:{duration:600,musicalDuration:{musical:!0,beats:1},decay:.5,strength:2,spread:.3,direction:e,particleMotion:{type:"burst",strength:2,direction:e}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1},timingSync:"onBeat",strengthSync:{onBeat:3.5,offBeat:1,curve:"explosion"},accentResponse:{enabled:!0,multiplier:2.5,type:"strength"}},apply(e,a,s,n,r,o){const l={...this.config,...s},h=l.decay||.5,c=(l.strength||2)*(1-a*h),u=l.spread||.3;let d=t.x*c*2,p=t.y*c*2;const g=(Math.random()-.5)*u*c;i?d+=g:p+=g,e.vx+=d*n,e.vy+=p*n},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||2,s=i.direction||"up";let n=0,r=0,o=0,l=1,h=1,c=0;const[u,d]={up:[0,1],down:[0,-1],left:[-1,0],right:[1,0]}[s]||[0,1];if(e<.15){const t=e/.15,i=1-Math.pow(1-t,3);n=u*i*.2*a,r=d*i*.2*a,o=.1*i*a,l=1+.15*i*a,h=1+.5*i,c=.4*i}else if(e<.35){const t=(e-.15)/.2,i=1-1.5*t;n=.2*u*i*a,r=.2*d*i*a,o=.1*i*a,l=1+.15*(1-t)*a,h=1+.4*(1-t),c=.2*(1-t)}else{const t=(e-.35)/.65,i=Math.pow(1-t,2),s=Math.sin(t*Math.PI*2)*i;n=u*s*.05*a,r=d*s*.05*a,l=1+.05*s,h=1+.15*Math.abs(s)}return{cameraRelativePosition:[n,r,o],position:[0,0,0],rotation:[0,0,0],scale:l,glowIntensity:h,glowBoost:c}}}}}var ur=cr("up"),dr=cr("down"),pr=cr("left"),gr=cr("right"),mr={name:"ripple",emoji:"üåä",type:"effect",description:"Concentric waves emanating from center",config:{duration:1500,musicalDuration:{musical:!0,bars:1},waveCount:3,waveSpeed:1,amplitude:15,damping:.7,strength:1,particleMotion:{type:"ripple",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",amplitudeSync:{onBeat:1.5,offBeat:.8}},apply(e,t,i,a,s,n){const r={...this.config,...i},o=r.strength||1,l=r.waveCount||3,h=r.amplitude||15,c=r.damping||.7,u=e.x-s,d=e.y-n,p=Math.sqrt(u*u+d*d),g=(p/50-t*l*2)*Math.PI,m=Math.pow(1-t,c),y=Math.sin(g)*h*o*m;if(p>1){const t=.5*Math.cos(g)*o*m;e.x+=u/p*t,e.y+=d/p*t}e.opacity=Math.max(.3,1-.3*Math.abs(y/h))},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.waveCount||3,n=i.damping||.7,r=Math.pow(1-e,n),o=e*Math.PI*s*2,l=Math.sin(o),h=e*Math.PI*4,c=Math.sin(h)*a*r,u=.5*Math.sin(h+Math.PI/2)*a*r,d=.12,p=1-c*d+u*d*.3,g=1+c*d,m=1-c*d-u*d*.3,y=.08*(g-1);return{position:[.01*Math.sin(1.5*h)*r,y,0],rotation:[.04*l*a*r,0,.03*u*a*r],scale:[p,g,m],glowIntensity:1+.3*Math.abs(c),glowBoost:.25*Math.max(0,c)*r}}}},yr={name:"wave",emoji:"üåä",type:"override",description:"Infinity pattern flow with phasing",config:{musicalDuration:{musical:!0,bars:1,minBeats:4,maxBeats:16},phases:[{name:"gather",beats:.5},{name:"rise",beats:.5},{name:"waveLeft",beats:1},{name:"waveRight",beats:1},{name:"settle",beats:1}],amplitude:40,frequency:1,phaseShift:.3,liftHeight:20,fadeInOut:!0,smoothness:.1,easing:"sine",strength:1,particleMotion:{type:"wave",strength:1,amplitude:50}},rhythm:{enabled:!0,syncMode:"wave",amplitudeSync:{onWave:65,onStatic:25,curve:"flowing"},frequencySync:{mode:"phrase",slow:.7,fast:1.8,curve:"melodic"},durationSync:{mode:"bars",adaptToPhrase:!0,sustain:!0},phaseSync:{enabled:!0,multiplier:.5,type:"ensemble"},melodicResponse:{enabled:!0,multiplier:1.4,type:"amplitude"},patternOverrides:{ambient:{amplitudeSync:{onWave:80,onStatic:40,curve:"hypnotic"},frequencySync:{slow:.5,fast:1.2},durationSync:{minBeats:16,maxBeats:64}},ocean:{amplitudeSync:{onWave:90,onStatic:20,curve:"natural"},phaseSync:{multiplier:.8},melodicResponse:{multiplier:1.8}},electronic:{amplitudeSync:{onWave:70,onStatic:30,curve:"digital"},frequencySync:{slow:.8,fast:2.5,curve:"precise"}},orchestral:{amplitudeSync:{onWave:75,onStatic:35},phaseSync:{multiplier:.7},melodicResponse:{multiplier:2}}},dynamics:{forte:{amplitudeSync:{onWave:{multiplier:1.8},onStatic:{multiplier:1.4}},frequencySync:{multiplier:1.3},melodicResponse:{multiplier:2.2}},piano:{amplitudeSync:{onWave:{multiplier:.6},onStatic:{multiplier:.4}},frequencySync:{multiplier:.7},melodicResponse:{multiplier:1.1}}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-i,n=e.y-a,r=Math.atan2(n,s),o=Math.sqrt(s*s+n*n),l=Math.random()<.5?1:-1;e.gestureData.wave={startX:e.x,startY:e.y,originalVx:e.vx,originalVy:e.vy,baseOpacity:e.opacity||e.life||1,angle:r,radius:o,offset:Math.random()*Math.PI*2,role:Math.random(),direction:l,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.wave?.initialized||this.initialize(e,i,s,n);const r=e.gestureData.wave,o={...this.config,...i},l=i.strength||1,h=this.easeInOutSine(t),c=r.role*o.phaseShift,u=Math.max(0,h-c),d=u*Math.PI*2*o.frequency*r.direction+r.offset,p=.5+r.radius/100*.5,g=o.amplitude*p*l*e.scaleFactor,m=s+Math.sin(d)*g,y=n+Math.sin(2*d)*g*.3+-Math.abs(Math.sin(h*Math.PI))*o.liftHeight*e.scaleFactor,f=o.smoothness+.12*r.role;if(e.x+=(m-e.x)*f,e.y+=(y-e.y)*f,e.vx=.3*(m-e.x),e.vy=.3*(y-e.y),o.fadeInOut){let t;t=u<.1?u/.1:u>.9?(1-u)/.1:.5+.5*Math.sin(u*Math.PI),e.opacity=r.baseOpacity*(.3+.7*t),void 0!==e.life&&(e.life=e.opacity)}if(t>=.95){const i=20*(1-t);e.vx=e.vx*i+r.originalVx*(1-i),e.vy=e.vy*i+r.originalVy*(1-i),o.fadeInOut&&(e.opacity=r.baseOpacity*i,void 0!==e.life&&(e.life=e.opacity))}},cleanup(e){if(e.gestureData?.wave){const t=e.gestureData.wave;e.vx=t.originalVx,e.vy=t.originalVy,e.opacity=t.baseOpacity,void 0!==e.life&&(e.life=t.baseOpacity),delete e.gestureData.wave}},easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,"3d":{evaluate(e,t){const i=t?.strength||1,a=t?.frequency||1,s=-(Math.cos(Math.PI*e)-1)/2,n=s*Math.PI*2*a,r=.12*Math.sin(n)*i,o=.06*Math.sin(2*n)*i,l=.03*Math.sin(n)*i,h=.08*Math.sin(2*n)*i,c=.05*Math.sin(n)*i,u=1+.08*Math.abs(Math.sin(s*Math.PI))*i,d=Math.abs(Math.sin(n));return{position:[r,o,l],rotation:[h,0,c],scale:u,glowIntensity:1+.3*d*i,glowBoost:.6*d*i}}}},fr={name:"flash",emoji:"‚ö°",type:"blending",description:"Bright flash burst effect",config:{duration:400,glowAmount:2.5,glowPeak:3,scalePeak:1.1,easing:"cubic",strength:1,particleMotion:{type:"burst",strength:1,decay:.3}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"immediate",interruptible:!0,priority:8,blendable:!0,intensitySync:{onBeat:3.5,offBeat:1,accent:5,subdivision:"quarter",curve:"exponential"},durationSync:{mode:"tempo",baseDuration:400,scaling:"inverse"},scaleSync:{onBeat:1.2,offBeat:1,accent:1.4,curve:"elastic"},strobeSync:{enabled:!1,pattern:"XXOX",subdivision:"sixteenth"},dynamics:{forte:{glowPeak:4,scalePeak:1.3,duration:300},piano:{glowPeak:2,scalePeak:1.05,duration:500}}},initialize(e,t){e.gestureData||(e.gestureData={}),e.gestureData.flash={originalOpacity:e.opacity,originalSize:e.size,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.flash?.initialized||this.initialize(e,i);const r=e.gestureData.flash,o={...this.config,...i},l=o.strength||1;let h;if(h=t<.3?t/.3*o.glowPeak:o.glowPeak*(1-(t-.3)/.7),e.opacity=Math.min(1,r.originalOpacity*(1+h*l)),e.size=r.originalSize*(1+(o.scalePeak-1)*h*l*.1),t<.2){const i=(1-t/.2)*l,r=Math.atan2(e.y-n,e.x-s);e.vx+=Math.cos(r)*i*2*a,e.vy+=Math.sin(r)*i*2*a}e.vx*=1-.1*o.particleMotion.decay,e.vy*=1-.1*o.particleMotion.decay},cleanup(e){e.gestureData?.flash&&(e.opacity=e.gestureData.flash.originalOpacity,e.size=e.gestureData.flash.originalSize,delete e.gestureData.flash)},"3d":{evaluate(e,t){let i;i=e<.3?e/.3:1-(e-.3)/.7;const a=1+.4*i;return{position:[0,0,0],rotation:[0,0,0],scale:1+i*(({...this.config,...t}.scalePeak||1.1)-1),glowIntensity:a,glowBoost:2*i}}}},br={name:"glow",emoji:"‚ú®",type:"blending",description:"Pure luminous glow without movement",config:{duration:1500,amplitude:0,frequency:1,holdPeak:.3,easing:"sine",scaleAmount:.1,glowAmount:.8,strength:0,direction:"none",particleMotion:{type:"glow",strength:0,direction:"none",frequency:1}},rhythm:{enabled:!0,syncMode:"phrase",amplitudeSync:{onBeat:2,offBeat:1.2,curve:"smooth"},frequencySync:{mode:"phrase",subdivision:"bar"},durationSync:{mode:"bars",bars:2},accentResponse:{enabled:!0,multiplier:2.5},patternOverrides:{ambient:{amplitudeSync:{onBeat:2.5,offBeat:1.8},durationSync:{bars:4}},electronic:{amplitudeSync:{onBeat:3,offBeat:.5,curve:"sharp"},frequencySync:{subdivision:"quarter"}}}},initialize(e,t,i,a){e.gestureData||(e.gestureData={}),e.gestureData.glow={startOpacity:e.opacity,startGlow:e.glowSizeMultiplier||0,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.glow?.initialized||this.initialize(e,i,s,n);const r={...this.config,...i},o=this.easeInOutSine(t);let l,{frequency:h}=r,{glowAmount:c}=r;i.rhythmModulation&&(c*=i.rhythmModulation.amplitudeMultiplier||1,c*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(h*=i.rhythmModulation.frequencyMultiplier));const u=o*h*2%2;l=r.holdPeak>0&&u>1-r.holdPeak&&u<1+r.holdPeak?1:Math.sin(o*Math.PI*2*h);let d=1;t>.9&&(d=.5+.5*(1-10*(t-.9))),e.glowIntensity=1+l*c*d},cleanup(e){e.gestureData?.glow&&(e.glowIntensity=1,delete e.gestureData.glow)},easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,"3d":{evaluate(e,t){const i={...this.config,...t},a=-(Math.cos(Math.PI*e)-1)/2,s=Math.sin(a*Math.PI);let n=i.glowAmount||.8;t.rhythmModulation&&(n*=t.rhythmModulation.amplitudeMultiplier||1,n*=t.rhythmModulation.accentMultiplier||1);const r=1+s*n;return{position:[0,0,0],rotation:[0,0,0],scale:1+s*(i.scaleAmount||.1)*.5,glowIntensity:r,glowBoost:1.5*s}}}},wr={name:"bloom",emoji:"üå∏",type:"effect",description:"Particles unfold outward like flower petals opening",config:{duration:1500,musicalDuration:{musical:!0,bars:1},petalCount:6,openingSpeed:1,rotationAmount:.3,strength:1,particleMotion:{type:"bloom",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"bars",bars:1},timingSync:"onBeat",amplitudeSync:{onBeat:1.3,offBeat:.8}},initialize(e,t,i,a){e.gestureData||(e.gestureData={});const s=e.x-(i||0),n=e.y-(a||0);e.gestureData.bloom={originalX:e.x,originalY:e.y,originalOpacity:e.opacity??1,startAngle:Math.atan2(n,s),startDistance:Math.sqrt(s*s+n*n),initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.bloom?.initialized||this.initialize(e,i,s,n);const r={...this.config,...i},o=r.strength||1,l=e.gestureData.bloom,h=Math.pow(t,.7),c=(r.rotationAmount||.3)*Math.PI,u=Math.sin(h*Math.PI)*c,d=1+.5*h*o,p=l.startDistance*d,g=l.startAngle+u;e.x=s+Math.cos(g)*p,e.y=n+Math.sin(g)*p,e.opacity=Math.min(1,l.originalOpacity*(.7+.3*h))},cleanup(e){if(e.gestureData?.bloom){const t=e.gestureData.bloom;e.x=t.originalX,e.y=t.originalY,e.opacity=t.originalOpacity,delete e.gestureData.bloom}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.rotationAmount||.3,n=Math.pow(e,.7),r=1+.2*n*a,o=Math.sin(n*Math.PI)*s*a,l=.1*Math.sin(n*Math.PI*.5)*a,h=e>.85?1-(e-.85)/.15*.3:1;return{position:[0,.05*Math.sin(n*Math.PI)*a*h,0],rotation:[0,o*h,l*h],scale:r*(.7+.3*h),glowIntensity:1+.4*n,glowBoost:.3*n}}}},vr={name:"flicker",emoji:"‚ö°",type:"blending",description:"Rapid opacity changes with motion jitter",config:{duration:800,musicalDuration:{musical:!0,beats:2},flickerRate:15,frequency:6,minOpacity:.3,maxOpacity:1,jitterAmount:2,colorShift:!1,strobe:!1,pulseMode:!1,groupFlicker:.3,easing:"linear",strength:.7,particleMotion:{type:"flicker",strength:.7,frequency:6}},rhythm:{enabled:!0,syncMode:"subdivision",durationSync:{mode:"beats",beats:2},rateSync:{subdivision:"sixteenth",onBeat:30,offBeat:10,triplet:20,curve:"step"},opacitySync:{pattern:"HLMH",subdivision:"eighth",onAccent:.1,regular:.5},jitterSync:{onBeat:5,offBeat:1,accent:10,curve:"random"},strobeSync:{verse:!1,chorus:!0,drop:"intense",pattern:"XOXO"},dynamics:{forte:{flickerRate:25,jitterAmount:5,minOpacity:.1},piano:{flickerRate:8,jitterAmount:1,minOpacity:.5}}},initialize(e,t){e.gestureData||(e.gestureData={});const i={...this.config,...t},a=Math.random()<i.groupFlicker;e.gestureData.flicker={baseOpacity:e.opacity||e.life||1,baseColor:e.color,baseX:e.x,baseY:e.y,flickerTimer:0,lastFlicker:0,flickerState:!0,isGrouped:a,groupId:a?Math.floor(3*Math.random()):-1,phase:Math.random()*Math.PI*2,colorHue:0,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.flicker?.initialized||this.initialize(e,i);const r=e.gestureData.flicker,o={...this.config,...i},l=i.strength||1;let h;if(r.flickerTimer+=a*o.flickerRate,o.strobe)h=(r.flickerTimer+r.phase)%1<.5?1:o.minOpacity;else if(o.pulseMode){const e=r.flickerTimer+r.phase;h=o.minOpacity+(o.maxOpacity-o.minOpacity)*(.5*Math.sin(e)+.5)}else{if(r.flickerTimer-r.lastFlicker>1)if(r.lastFlicker=r.flickerTimer,r.isGrouped){const e=Math.floor(r.flickerTimer)%3;r.flickerState=e===r.groupId}else r.flickerState=Math.random()>.3;const t=r.flickerState?o.maxOpacity:o.minOpacity+.3*Math.random(),i=e.opacity/r.baseOpacity;h=i+.3*(t-i)}const c=r.baseOpacity*(1+(h-1)*l);if(e.opacity=Math.max(0,Math.min(1,c)),void 0!==e.life&&(e.life=e.opacity),o.jitterAmount>0&&h>o.minOpacity){const t=o.jitterAmount*l*e.scaleFactor,i=(Math.random()-.5)*t*h,s=(Math.random()-.5)*t*h;e.vx+=.1*i*a,e.vy+=.1*s*a}if(o.colorShift&&e.color){r.colorHue+=.01*a;const t=30*Math.sin(r.colorHue);e.color=this.shiftHue(r.baseColor,t*l)}let u=1;t<.1?u=t/.1:t>.9&&(u=(1-t)/.1),e.opacity*=u,void 0!==e.life&&(e.life=e.opacity),t>.8&&(e.vx*=.95,e.vy*=.95)},shiftHue(e,t){if(!e||!e.startsWith("#"))return e;const i=e.slice(1),a=parseInt(i.substr(0,2),16)/255,s=parseInt(i.substr(2,2),16)/255,n=parseInt(i.substr(4,2),16)/255,r=t*Math.PI/180,o=Math.cos(r),l=Math.sin(r),h=a*l+s*o,c=n,u=e=>Math.max(0,Math.min(255,Math.round(255*e))).toString(16).padStart(2,"0");return`#${u(a*o-s*l)}${u(h)}${u(c)}`},cleanup(e){if(e.gestureData?.flicker){const t=e.gestureData.flicker;e.opacity=t.baseOpacity,e.color=t.baseColor,void 0!==e.life&&(e.life=t.baseOpacity),delete e.gestureData.flicker}},"3d":{evaluate(e,t){const i=t.config||{},a=t.strength||.7,s=e*(i.flickerRate||15),n=Math.sin(s*Math.PI*2),r=Math.floor(10*s),o=.3*n+.5*(Math.sin(123.456*r)+1)*.7,l=.6+.8*o,h=i.jitterAmount||2,c=.003*a*l,u=(Math.random()-.5)*h*c,d=(Math.random()-.5)*h*c,p=.03*(Math.random()-.5)*a*l;return{position:[u,d,0],rotation:[.5*p,0,p],scale:1+.08*(l-1),glowIntensity:l,glowBoost:1.2*o}}}},Mr={name:"shiver",emoji:"ü•∂",type:"effect",description:"High-frequency micro-vibrations for nervousness or cold",config:{duration:1500,musicalDuration:{musical:!0,bars:1},frequency:30,amplitude:.02,decay:.3,strength:1,particleMotion:{type:"shiver",strength:.8}},rhythm:{enabled:!0,syncMode:"ambient",durationSync:{mode:"bars",bars:1},intensitySync:{quiet:.5,loud:1.5,crescendo:"increase",diminuendo:"decrease"}},apply(e,t,i,a,s,n){const r={...this.config,...i},o=r.strength||1,l=r.frequency||30,h=100*(r.amplitude||.02),c=t*l*Math.PI*2,u=(.6*Math.sin(c)+.3*Math.sin(1.7*c+1.3)+.1*Math.sin(2.3*c+2.7))*h*o,d=Math.sin(t*Math.PI);e.x+=u*d*(Math.random()-.5)*2,e.y+=u*d*(Math.random()-.5)*2},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.frequency||30,n=i.amplitude||.02,r=Math.sin(e*Math.PI),o=e*s*Math.PI*2,l=.6*Math.sin(o)+.3*Math.sin(1.7*o)+.1*Math.sin(2.3*o),h=.5*Math.cos(1.1*o)+.3*Math.cos(1.9*o)+.2*Math.cos(2.7*o);return{position:[l*n*a*r,h*n*a*r,(.4*Math.sin(.9*o+1)+.4*Math.sin(1.5*o+2))*n*.5*a*r],rotation:[.02*h*a*r,0,.02*l*a*r],scale:1+.01*Math.abs(l)*a*r,glowIntensity:1+.1*Math.abs(l)*r}}}},Sr={name:"heartbeat",emoji:"üíì",type:"effect",description:"Rhythmic double-pump heartbeat (lub-dub)",config:{duration:1e3,musicalDuration:{musical:!0,beats:2},lubStrength:.8,dubStrength:1,lubDubGap:.15,strength:1,particleMotion:{type:"heartbeat",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:2},timingSync:"onBeat",amplitudeSync:{onBeat:1.2,offBeat:.8}},apply(e,t,i,a,s,n){const r={...this.config,...i},o=r.strength||1,l=this.t(t,r),h=e.x-s,c=e.y-n,u=Math.sqrt(h*h+c*c)||1,d=10*l*o;e.x+=h/u*d,e.y+=c/u*d},t(e,t){const i=t.lubDubGap||.15,a=t.lubStrength||.8,s=t.dubStrength||1;let n=0;const r=Math.abs(e-.1);r<.08&&(n=Math.cos(r/.08*Math.PI*.5)*a);const o=.1+i+.05,l=Math.abs(e-o);if(l<.1){const e=Math.cos(l/.1*Math.PI*.5)*s;n=Math.max(n,e)}return n},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.lubDubGap||.15,n=i.lubStrength||.8,r=i.dubStrength||1;let o=0;const l=Math.abs(e-.1);l<.08&&(o=Math.cos(l/.08*Math.PI*.5)*n);const h=.1+s+.05,c=Math.abs(e-h);if(c<.1){const e=Math.cos(c/.1*Math.PI*.5)*r;o=Math.max(o,e)}return{position:[0,0,.03*o*a],rotation:[0,0,0],scale:1+.15*o*a,glowIntensity:1+.5*o*a,glowBoost:.8*o*a}}}},xr={name:"snap",emoji:"‚ö°",type:"effect",description:"Quick elastic snap with overshoot and settle",config:{duration:500,musicalDuration:{musical:!0,beats:1},snapDistance:.1,overshoot:1.3,bounces:2,strength:1,particleMotion:{type:"snap",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:1},timingSync:"onBeat",accentResponse:{enabled:!0,multiplier:1.5}},apply(e,t,i,a,s,n){const r={...this.config,...i},o=r.strength||1,l=100*(r.snapDistance||.1),h=r.overshoot||1.3,c=this.i(t,h,r.bounces||2),u=s-e.x,d=n-e.y,p=Math.sqrt(u*u+d*d)||1;e.x+=u/p*c*l*o*.1,e.y+=d/p*c*l*o*.1},i(e,t,i){if(e<.2){const i=e/.2;return(1-Math.pow(1-i,3))*t}{const a=(e-.2)/.8,s=Math.exp(4*-a);return 1+(t-1)*Math.cos(a*Math.PI*i*2)*s}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.snapDistance||.1,n=i.overshoot||1.3,r=i.bounces||2;let o;if(e<.2){const t=e/.2;o=(1-Math.pow(1-t,3))*n}else{const t=(e-.2)/.8,i=Math.exp(4*-t);o=1+(n-1)*Math.cos(t*Math.PI*r*2)*i}return{position:[0,0,(o-1)*s*a],rotation:[0,0,.1*(o-1)*a],scale:1+.15*(o-1),glowIntensity:1+.5*Math.abs(o-1),glowBoost:e<.3?(.3-e)/.3*.4:0}}}},kr={name:"elasticBounce",emoji:"üèÄ",type:"effect",description:"Drop and bounce with elastic oscillation",config:{duration:1200,musicalDuration:{musical:!0,beats:3},dropHeight:.15,bounceCount:3,elasticity:.6,strength:1,particleMotion:{type:"elasticBounce",strength:1}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:3},timingSync:"onBeat",amplitudeSync:{onBeat:1.3,offBeat:.8}},apply(e,t,i,a,s,n){const r={...this.config,...i},o=r.strength||1,l=200*(r.dropHeight||.15),h=r.bounceCount||3,c=r.elasticity||.6,u=this.o(t,l,h,c);e.y+=u*o;const d=.3*Math.max(0,-u/l);e.scaleY=1-d*o,e.scaleX=1+.5*d*o},o(e,t,i,a){let s=t,n=0,r=0,o=.3;for(;r<i&&n<1;){const t=o*Math.pow(a,.5*r);if(e<n+t){const i=(e-n)/t;return 4*i*(1-i)*-s}n+=t,s*=a,r++,o*=a}return 0},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.dropHeight||.15,n=i.bounceCount||3,r=i.elasticity||.6;let o=s,l=0,h=0,c=.3,u=0,d=!1;for(;h<n&&l<1;){const t=c*Math.pow(r,.5*h);if(e<l+t){const i=(e-l)/t;u=o*(4*i*(1-i))*a,d=i>.45&&i<.55;break}l+=t,o*=r,h++,c*=r}let p=1,g=1;if(d){const e=.15*a*Math.pow(r,h);p=1+e,g=1-e}return{position:[0,u,0],rotation:[0,0,0],scale:(p+g)/2,glowIntensity:1+(d?.3:0)}}}},Or={name:"hold",emoji:"‚è∏Ô∏è",type:"override",description:"Hold particles in current position",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},holdStrength:.95,allowDrift:!1,strength:1},rhythm:{enabled:!0,syncMode:"rest",holdSync:{onRest:.98,onSound:.8,curve:"immediate"},durationSync:{mode:"rests",minBeats:.5,maxBeats:8,sustain:!0},pauseResponse:{enabled:!0,multiplier:1.5,type:"strength"},patternOverrides:{classical:{holdSync:{onRest:.99,onSound:.75,curve:"dramatic"},pauseResponse:{multiplier:2}},minimal:{holdSync:{onRest:.95,onSound:.85},durationSync:{minBeats:2,maxBeats:16}},jazz:{holdSync:{onRest:.9,onSound:.7},allowDrift:!0},electronic:{holdSync:{onRest:.99,onSound:.6,curve:"digital"},pauseResponse:{multiplier:1.2}}},dynamics:{forte:{holdSync:{onRest:{multiplier:1.02},onSound:{multiplier:.9}},pauseResponse:{multiplier:2.2}},piano:{holdSync:{onRest:{multiplier:.97},onSound:{multiplier:.85}},pauseResponse:{multiplier:1.3}}}},initialize(e){e.gestureData||(e.gestureData={}),e.gestureData.hold={holdX:e.x,holdY:e.y,originalVx:e.vx,originalVy:e.vy}},apply(e,t,i,a,s,n){e.gestureData?.hold||this.initialize(e);const r=e.gestureData.hold,o=i.holdStrength||this.config.holdStrength;if(i.allowDrift?(e.vx*=o,e.vy*=o):(e.x+=(r.holdX-e.x)*(1-o),e.y+=(r.holdY-e.y)*(1-o),e.vx=0,e.vy=0),t>.9){const i=10*(t-.9);e.vx=e.vx*(1-i)+r.originalVx*i,e.vy=e.vy*(1-i)+r.originalVy*i}},cleanup(e){if(e.gestureData?.hold){const t=e.gestureData.hold;e.vx=t.originalVx,e.vy=t.originalVy,delete e.gestureData.hold}},"3d":{evaluate(e,t){let i=0,a=1;if(e<.15){const t=e/.15;i=t*t*(3-2*t),a=1-.2*i}else if(e<.85)i=1,a=.8;else{const t=(e-.85)/.15;i=1-t*t*(3-2*t),a=.8+.2*t}return i*=(t.config||this.config||{}).strength||1,{position:[0,0,0],rotation:[0,0,0],scale:1,glowIntensity:a,freezeRotation:i,freezeWobble:i,freezeGroove:i,freezeParticles:i}}}},Ar={name:"fade",emoji:"üëª",type:"blending",description:"Fade particle opacity",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},fadeIn:!0,fadeOut:!0,minOpacity:0,maxOpacity:1},rhythm:{enabled:!0,syncMode:"dynamic",durationSync:{mode:"bars",bars:1},opacitySync:{onBeat:.9,offBeat:.3,subdivision:"eighth",curve:"exponential"},fadePhaseSync:{verse:{fadeIn:!0,fadeOut:!1},chorus:{fadeIn:!1,fadeOut:!1},bridge:{fadeIn:!0,fadeOut:!0},outro:{fadeIn:!1,fadeOut:!0}},pulseSync:{enabled:!0,frequency:"quarter",intensity:.2,onAccent:.4},dynamics:{forte:{minOpacity:.5,maxOpacity:1},piano:{minOpacity:0,maxOpacity:.4}}},initialize(e){e.gestureData||(e.gestureData={}),e.gestureData.fade={baseOpacity:e.opacity||e.life||1}},apply(e,t,i,a,s,n){e.gestureData?.fade||this.initialize(e);const r=e.gestureData.fade,o={...this.config,...i};let l;l=o.fadeIn&&!o.fadeOut?o.minOpacity+(o.maxOpacity-o.minOpacity)*t:o.fadeOut&&!o.fadeIn?o.maxOpacity-(o.maxOpacity-o.minOpacity)*t:t<.5?o.minOpacity+(o.maxOpacity-o.minOpacity)*(2*t):o.maxOpacity-(o.maxOpacity-o.minOpacity)*(2*(t-.5)),e.opacity=r.baseOpacity*l,void 0!==e.life&&(e.life=e.opacity)},cleanup(e){e.gestureData?.fade&&(e.opacity=e.gestureData.fade.baseOpacity,void 0!==e.life&&(e.life=e.opacity),delete e.gestureData.fade)},"3d":{evaluate(e,t){const i={...this?.config||{},...t},a=i.fadeIn??!0,s=i.fadeOut??!0;let n;n=a&&!s?e:s&&!a?1-e:e<.5?1-e/.5:(e-.5)/.5;const r=n*n*(3-2*n);return{position:[0,0,0],rotation:[0,0,0],scale:.01+.99*r,glowIntensity:r,glowBoost:0}}}},Cr={name:"settle",emoji:"üçÉ",type:"blending",description:"Gradually settle particles to rest",config:{damping:.02,threshold:.01},rhythm:{enabled:!0,syncMode:"resolution",dampingSync:{onResolution:.035,onTension:.015,curve:"gradual"},thresholdSync:{mode:"dynamics",forte:.02,piano:.005,curve:"exponential"},durationSync:{mode:"phrase",minBeats:2,maxBeats:12,sustain:!0},cadenceResponse:{enabled:!0,multiplier:1.6,type:"damping"},patternOverrides:{ambient:{dampingSync:{onResolution:.025,onTension:.008,curve:"atmospheric"},durationSync:{minBeats:8,maxBeats:32}},jazz:{dampingSync:{onResolution:.04,onTension:.02},cadenceResponse:{multiplier:1.8}},classical:{dampingSync:{onResolution:.045,onTension:.012,curve:"expressive"},cadenceResponse:{multiplier:2}},minimalist:{dampingSync:{onResolution:.02,onTension:.005},durationSync:{minBeats:16,maxBeats:64}}},dynamics:{forte:{dampingSync:{onResolution:{multiplier:1.4},onTension:{multiplier:.8}},thresholdSync:{multiplier:2},cadenceResponse:{multiplier:2.2}},piano:{dampingSync:{onResolution:{multiplier:.7},onTension:{multiplier:1.2}},thresholdSync:{multiplier:.5},cadenceResponse:{multiplier:1.3}}}},apply(e,t,i,a,s,n){const r=i.damping||this.config.damping,o=i.threshold||this.config.threshold;e.vx*=Math.max(0,1-r*a*60),e.vy*=Math.max(0,1-r*a*60),Math.abs(e.vx)<o&&(e.vx=0),Math.abs(e.vy)<o&&(e.vy=0)},"3d":{evaluate(e,t){const i=1-Math.pow(1-e,2),a=.01*(1-i);return{position:[Math.sin(e*Math.PI*2)*a,Math.cos(e*Math.PI*3)*a*.5,0],rotation:[0,0,0],scale:1-.03*i,glowIntensity:1-.15*i}}}},Ir={name:"peek",emoji:"üëÄ",type:"effect",description:"Quick peek and hide motion",config:{peekDistance:40,peekSpeed:.15,holdDuration:200,hideSpeed:.25,stagger:!0,duration:1500},rhythm:{enabled:!0,syncMode:"accent",distanceSync:{onAccent:60,offAccent:25,curve:"quick"},speedSync:{mode:"tempo",fast:.25,slow:.1,hideMultiplier:1.8},durationSync:{mode:"subdivision",beats:.25,staggerBeats:.125,sustain:!1},syncopationResponse:{enabled:!0,multiplier:1.8,type:"distance"},patternOverrides:{funk:{distanceSync:{onAccent:70,offAccent:35,curve:"funky"},syncopationResponse:{multiplier:2.2}},latin:{speedSync:{fast:.3,slow:.12},durationSync:{beats:.5,staggerBeats:.25}},breakbeat:{distanceSync:{onAccent:55,offAccent:40},syncopationResponse:{multiplier:2.5}},classical:{distanceSync:{onAccent:45,offAccent:20,curve:"elegant"},speedSync:{fast:.18,slow:.08}}},dynamics:{forte:{distanceSync:{onAccent:{multiplier:1.6},offAccent:{multiplier:1.3}},speedSync:{multiplier:1.4},syncopationResponse:{multiplier:2.8}},piano:{distanceSync:{onAccent:{multiplier:.6},offAccent:{multiplier:.4}},speedSync:{multiplier:.7},syncopationResponse:{multiplier:1.2}}}},apply(e,t,i,a,s,n){if(e.gestureData||(e.gestureData={}),!e.gestureData.peek){const t=e.x-s,i=e.y-n,a=Math.atan2(i,t),r=Math.sqrt(t*t+i*i);e.gestureData.peek={originalX:e.x,originalY:e.y,peekAngle:a,originalDistance:r,staggerDelay:this.config.stagger?.3*Math.random():0,phase:"waiting",phaseTimer:0,peekOffset:{x:0,y:0}}}const r=e.gestureData.peek,{config:o}=this,l=Math.max(0,Math.min(1,(t-r.staggerDelay)/(1-r.staggerDelay)));0===l?r.phase="waiting":l<.3?r.phase="peeking":l<.6?r.phase="holding":l<1&&(r.phase="hiding");let h=0;switch(r.phase){case"peeking":{const e=l/.3;h=this.easeOutCubic(e)*o.peekDistance;break}case"holding":h=o.peekDistance,Math.random()<.1&&(r.peekOffset.x+=2*(Math.random()-.5),r.peekOffset.y+=2*(Math.random()-.5));break;case"hiding":{const e=(l-.6)/.4;h=(1-this.easeInCubic(e))*o.peekDistance;break}}if("waiting"!==r.phase){const t=Math.cos(r.peekAngle)*h,i=Math.sin(r.peekAngle)*h;r.peekOffset.x+=(t-r.peekOffset.x)*o.peekSpeed,r.peekOffset.y+=(i-r.peekOffset.y)*o.peekSpeed,e.x=r.originalX+r.peekOffset.x,e.y=r.originalY+r.peekOffset.y}void 0!==e.alpha&&("peeking"===r.phase||"holding"===r.phase?e.alpha=.7+.3*Math.random():e.alpha=1)},easeOutCubic:e=>1-Math.pow(1-e,3),easeInCubic:e=>e*e*e,cleanup(e){e.gestureData?.peek&&(e.x=e.gestureData.peek.originalX,e.y=e.gestureData.peek.originalY,void 0!==e.alpha&&(e.alpha=1),delete e.gestureData.peek)},"3d":{evaluate(e,t){const i=.01*({...this.config,...t}.peekDistance||40);let a=0,s=1;if(e<.3){const t=e/.3;a=(1-Math.pow(1-t,3))*i}else if(e<.6)a=i,s=.7+.3*Math.random();else{const t=(e-.6)/.4;a=(1-Math.pow(t,3))*i}return{position:[a,0,0],rotation:[0,0,0],scale:1,glowIntensity:s}}}},zr={name:"directional",emoji:"‚û°Ô∏è",type:"blending",description:"Move particles in a specific direction",config:{angle:0,returnToOrigin:!1,strength:1},rhythm:{enabled:!0,syncMode:"flow",angleSync:{verse:0,chorus:90,bridge:180,outro:270,transition:"smooth"},strengthSync:{onBeat:1.8,offBeat:.6,curve:"wave"},returnSync:{enabled:!0,onSectionChange:!0,duration:"transition",strength:1.2},accentResponse:{enabled:!0,multiplier:2,type:"strength"},patternOverrides:{march:{angleSync:{verse:0,chorus:0},strengthSync:{onBeat:2.5,offBeat:1}},waltz:{angleSync:{verse:45,chorus:135,bridge:225,outro:315,transition:"circular"}},swing:{strengthSync:{onBeat:1.6,offBeat:1.4,swing:!0}},electronic:{angleSync:{transition:"instant"},strengthSync:{onBeat:2.2,offBeat:.4,curve:"sharp"}}},dynamics:{forte:{strengthSync:{onBeat:{multiplier:1.6},offBeat:{multiplier:1.2}},angleSync:{transition:"sharp"},accentResponse:{multiplier:2.5}},piano:{strengthSync:{onBeat:{multiplier:.7},offBeat:{multiplier:.8}},angleSync:{transition:"gradual"},accentResponse:{multiplier:1.4}}}},initialize(e){e.gestureData||(e.gestureData={}),e.gestureData.directional={initialX:e.x,initialY:e.y}},apply(e,t,i,a,s,n){e.gestureData?.directional||this.initialize(e);const r=(i.angle||this.config.angle)*Math.PI/180,o=i.strength||this.config.strength;if(e.vx+=Math.cos(r)*o*.3*a,e.vy+=Math.sin(r)*o*.3*a,i.returnToOrigin&&t>.5){const i=2*(t-.5),s=e.gestureData.directional,n=s.initialX-e.x,r=s.initialY-e.y;e.vx+=n*i*.02*a,e.vy+=r*i*.02*a}},"3d":{evaluate(e,t){const i={...this.config,...t},a=(i.angle||0)*Math.PI/180,s=t.strength||1,n=i.returnToOrigin?e<.5?2*e:2*(1-e):e;return{position:[Math.cos(a)*n*.4*s,Math.sin(a)*n*.4*s,0],rotation:[0,0,0],scale:1,glowIntensity:1}}}};function Fr(e){if(!["forward","back","left","right","up","down","attract","repel"].includes(e))throw new Error(`Invalid magnetic direction: ${e}`);return{name:`magnetic${D(e)}`,emoji:{forward:"üß≤",back:"üß≤",left:"‚¨ÖÔ∏è",right:"‚û°Ô∏è",up:"‚¨ÜÔ∏è",down:"‚¨áÔ∏è",attract:"üß≤",repel:"üí•"}[e],type:"effect",description:{forward:"Magnetic pull toward camera",back:"Magnetic push away from camera",left:"Magnetic pull leftward",right:"Magnetic pull rightward",up:"Magnetic pull upward",down:"Magnetic pull downward",attract:"Magnetic attraction to center",repel:"Magnetic repulsion from center"}[e],config:{duration:1200,musicalDuration:{musical:!0,beats:3},direction:e,pullStrength:1,returnToOrigin:!0,strength:1,particleMotion:{type:"magnetic",strength:1,direction:e}},rhythm:{enabled:!0,syncMode:"beat",durationSync:{mode:"beats",beats:3},timingSync:"onBeat",strengthSync:{onBeat:1.5,offBeat:.7}},initialize(e,t,i,a){e.gestureData||(e.gestureData={}),e.gestureData.magnetic={originalX:e.x,originalY:e.y,originalOpacity:e.opacity??1,initialized:!0}},apply(e,t,i,a,s,n){e.gestureData?.magnetic?.initialized||this.initialize(e,i,s,n);const r={...this.config,...i},o=r.strength||1,l=r.pullStrength||1,h=!1!==r.returnToOrigin,c=e.gestureData.magnetic,u=r.direction||"attract";let d,p,g;switch(d=h?Math.sin(t*Math.PI):Math.min(1,2*t),u){case"left":p=c.originalX-100,g=c.originalY;break;case"right":p=c.originalX+100,g=c.originalY;break;case"up":p=c.originalX,g=c.originalY-100;break;case"down":p=c.originalX,g=c.originalY+100;break;case"repel":{const e=c.originalX-s,t=c.originalY-n,i=Math.sqrt(e*e+t*t)||1;p=c.originalX+e/i*100,g=c.originalY+t/i*100;break}default:p=s,g=n}const m=(p-c.originalX)*d*l*o*.5,y=(g-c.originalY)*d*l*o*.5;e.x=c.originalX+m,e.y=c.originalY+y},cleanup(e){if(e.gestureData?.magnetic){const t=e.gestureData.magnetic;e.x=t.originalX,e.y=t.originalY,e.opacity=t.originalOpacity,delete e.gestureData.magnetic}},"3d":{evaluate(e,t){const i=t.config||this.config||{},a=i.strength||1,s=i.direction||"attract";let n;n=!1!==i.returnToOrigin?Math.sin(e*Math.PI):Math.min(1,2*e);let r=0,o=0,l=0,h=1;const c=.15*n*a;switch(s){case"forward":l=c,h=1+.1*n*a;break;case"back":l=-c,h=1-.08*n*a;break;case"left":r=-c;break;case"right":r=c;break;case"up":o=c;break;case"down":o=-c;break;case"attract":l=c,h=1-.1*n*a;break;case"repel":l=-c,h=1+.1*n*a}const u=1+.4*n,d=.3*n;return{cameraRelativePosition:[r+(n>.5?.01*Math.sin(e*Math.PI*20)*(n-.5)*2:0),o,l],rotation:[0,0,0],scale:h,glowIntensity:u,glowBoost:d}}}}}const Dr={name:"sparkle",emoji:"‚ú®",type:"blending",description:"Bright twinkling sparkle bursts",config:{duration:800,musicalDuration:{musical:!0,beats:2}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",durationSync:{mode:"beats",beats:2},interruptible:!0,priority:5,blendable:!0},apply:(e,t,i)=>!1,blend:(e,t,i)=>!1,"3d":{evaluate(e,t){const i=t?.strength||1,a=Math.pow(Math.max(0,Math.sin(e*Math.PI*6)),3),s=Math.pow(Math.max(0,Math.sin(e*Math.PI*8+1)),3),n=Math.pow(Math.max(0,Math.sin(e*Math.PI*10+2)),3),r=Math.max(a,s,n)*Math.sin(e*Math.PI);return{position:[0,0,0],rotation:[0,0,0],scale:1+.08*r*i,glowIntensity:1+.5*r*i,glowBoost:2*r*i}}}},qr={name:"shimmer",emoji:"üåü",type:"particle",description:"Shimmer effect with sparkling particles",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},particleMotion:"radiant"},rhythm:{enabled:!0,syncType:"beat",durationSync:{mode:"bars",bars:1},intensity:.8},override:(e,t,i)=>(e.shimmerEffect=!0,e.shimmerProgress=t,!0),blend:(e,t,i)=>!1,"3d":{evaluate(e,t){const i=t?.strength||1,a=(.4*Math.sin(e*Math.PI*4)+.35*Math.sin(e*Math.PI*6+.5)+.25*Math.sin(e*Math.PI*10+1)+1)/2;return{position:[0,0,0],rotation:[0,0,0],scale:1+.05*a*i,glowIntensity:1+.3*a*i,glowBoost:1*a*i}}}},Rr=((e,t="‚ú®")=>({name:e,emoji:t,type:"blending",description:`${e} animation`,config:{duration:1e3,musicalDuration:{musical:!0,beats:2}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",durationSync:{mode:"beats",beats:2},interruptible:!0,priority:3,blendable:!0,crossfadePoint:"anyBeat",maxQueue:3},apply:(e,t,i)=>!1,blend:(e,t,i)=>!1}))("groove","üéµ"),Br={},Er=[],Pr=[],Tr=[];function jr(e,t){Br[e.name]=e,t.push(e.name)}function Vr(e,t,i){Object.defineProperty(Br,e,{configurable:!0,enumerable:!0,get(){const i=t();return Object.defineProperty(Br,e,{configurable:!0,enumerable:!0,writable:!0,value:i}),i}}),i.push(e)}[he,C,_,We,L,G,I,z,W,Dr,qr,H,Rr,De,T,Ge,Le,se,re,oe,le,ne,Y,X,N,J,Z,K,V,$,je,Ve,R,B,E,P,Re,Be,Ee,Pe,k,O,A,pt,gt,ut,dt,ie,ce,de,pe,ge,me,ae,ee,te].forEach(e=>jr(e,Er)),[ke,Ce,Ie,ye,be,we,ve,Gn,nt,He,Qe,Ye,Xe,Ne,xt,ze,Fe,_e,Se,Ze,$e,it,at,st,tt,et,yt,ft,bt,wt,vt,Mt,St,ot,lt,ht,ct,rt,Si,xi,ki,Oi,Ai,Ci,Ii,zi,Fi,Di,qi,Ri,Bi,Pi,Ti,ji,Vi,$i,ba,wa,va,_i,Hi,Ui,Xi,Ni,Ji,Zi,Ki,ea,ta,aa,sa,na,ra,oa,Qi,Yi,da,pa,ga,ma,ya,fa,Kt,ei,ti,ii,ai,si,ni,ri,oi,li,hi,ci,ui,di,pi,gi,mi,yi,fi,wi,bi,Qa,Wa,Ya,Ua,Ga,La,Ha,_a,ss,Xa,Na,Ja,Za,Ka,es,ts,is,as,ns,cs,us,ds,ps,gs,ms,ys,fs,bs,ws,vs,Ms,Ss,xs,Cs,Is,zs,Fs,Ds,qs,Rs,Bs,Es,Ts,js,Vs,$s,Ws,Gs,Ls,_s,Hs,Us,Qs,Ps,Zs,Ks,en,tn,an,sn,nn,rn,on,un,dn,pn,gn,mn,yn,fn,bn,wn,vn,Mn,Sn,kn,On,An,Cn,In,zn,Fn,Dn,Pn,Tn,jn,Vn,$n,Wn].forEach(e=>jr(e,Pr)),Vr("lungeForward",()=>xe("forward"),Pr),Vr("lungeBack",()=>xe("back"),Pr),Vr("lungeLeft",()=>xe("left"),Pr),Vr("lungeRight",()=>xe("right"),Pr),Vr("lungeUp",()=>xe("up"),Pr),Vr("lungeDown",()=>xe("down"),Pr),Vr("recoilBack",()=>Ke("back"),Pr),Vr("recoilForward",()=>Ke("forward"),Pr),Vr("recoilLeft",()=>Ke("left"),Pr),Vr("recoilRight",()=>Ke("right"),Pr),Vr("recoilUp",()=>Ke("up"),Pr),Vr("recoilDown",()=>Ke("down"),Pr),Vr("oofLeft",()=>Je("left"),Pr),Vr("oofRight",()=>Je("right"),Pr),Vr("oofFront",()=>Je("front"),Pr),Vr("oofBack",()=>Je("back"),Pr),Vr("oofUp",()=>Je("up"),Pr),Vr("oofDown",()=>Je("down"),Pr),Vr("shatter",()=>Ot("default"),Pr),Vr("shatterExplosive",()=>Ot("explosive"),Pr),Vr("shatterCrumble",()=>Ot("crumble"),Pr),Vr("shatterReform",()=>Ot("reform"),Pr),Vr("shatterPunchLeft",()=>Ot("punchLeft"),Pr),Vr("shatterPunchRight",()=>Ot("punchRight"),Pr),Vr("shatterPunchFront",()=>Ot("punchFront"),Pr),Vr("shatterSuspend",()=>Ot("suspend"),Pr),Vr("shatterImplode",()=>Ot("implode"),Pr),Vr("shatterGravity",()=>Ot("gravity"),Pr),Vr("shatterOrbit",()=>Ot("orbit"),Pr),Vr("dissolveUp",()=>Ct("up"),Pr),Vr("dissolveDown",()=>Ct("down"),Pr),Vr("dissolveLeft",()=>Ct("left"),Pr),Vr("dissolveRight",()=>Ct("right"),Pr),Vr("dissolveAway",()=>Ct("away"),Pr),Vr("dissolveToward",()=>Ct("toward"),Pr),Vr("ignite",()=>zt("ignite"),Pr),Vr("ember",()=>zt("ember"),Pr),Vr("iceFreeze",()=>zt("freeze"),Pr),Vr("shatterIce",()=>zt("shatterIce"),Pr),Vr("thaw",()=>zt("thaw"),Pr),Vr("rushForward",()=>Me("forward"),Pr),Vr("rushBack",()=>Me("back"),Pr),Vr("rushLeft",()=>Me("left"),Pr),Vr("rushRight",()=>Me("right"),Pr),Vr("rushUp",()=>Me("up"),Pr),Vr("rushDown",()=>Me("down"),Pr),[yr,_n,Un,Qn,Yn,Xn,vr,hr,zr,Cr,Ar,Or,fr,br,Ir,Ln,Mr,Sr,ir,ar,Zn,Kn,er,tr,ur,dr,pr,gr,mr,kr,nr,rr,or,lr,wr,xr,Nn].forEach(e=>jr(e,Tr)),Vr("magneticForward",()=>Fr("forward"),Tr),Vr("magneticBack",()=>Fr("back"),Tr),Vr("magneticLeft",()=>Fr("left"),Tr),Vr("magneticRight",()=>Fr("right"),Tr),Vr("magneticUp",()=>Fr("up"),Tr),Vr("magneticDown",()=>Fr("down"),Tr),Vr("magneticAttract",()=>Fr("attract"),Tr),Vr("magneticRepel",()=>Fr("repel"),Tr);const $r={blending:Er,override:Pr,effect:Tr},Wr={idle:["breathe","expand","contract","pulse","sway","float","floatUp","floatDown","floatLeft","floatRight","bob","lean","leanLeft","leanRight","jitter","twitch","vibrate","shake","wiggle"],dance:["stepLeft","stepRight","stepUp","stepDown","slideLeft","slideRight","runningman","charleston","hula","twist","pop","flare","swell","swagger","dip","bounce","orbit","orbitLeft","orbitRight","orbitUp","orbitDown","sparkle","shimmer","groove"],actions:["jump","jumpDown","jumpLeft","jumpRight","rushForward","rushBack","rushLeft","rushRight","rushUp","rushDown","lunge","lungeForward","lungeBack","lungeLeft","lungeRight","lungeUp","lungeDown","spin","spinLeft","spinRight","flip","backflip","point","pointUp","pointDown","pointLeft","pointRight","kickLeft","kickRight","bow","nod","reach","headBob","crouch","tilt","tiltUp","tiltDown","tiltLeft","tiltRight"],reactions:["oofLeft","oofRight","oofFront","oofBack","oofUp","oofDown","recoil","recoilBack","recoilForward","recoilLeft","recoilRight","recoilUp","recoilDown","knockdown","knockout","inflate","deflate","squash","stretch","pancake","crackFront","crackBack","crackLeft","crackRight","crackUp","crackDown","crackHeal","rage","fury","battlecry","charge","wobble","teeter","rock","pendulum"],destruction:["shatter","shatterMesh","shatterExplosive","shatterCrumble","shatterReform","shatterPunchLeft","shatterPunchRight","shatterPunchFront","shatterSuspend","shatterImplode","shatterGravity","shatterOrbit","dissolveUp","dissolveDown","dissolveLeft","dissolveRight","dissolveAway","dissolveToward","splash","drench","soak","flow","tide","liquefy","poolWater","vortexWater","watercrown","waterdance","waterdrill","waterhelix","watermeditation","waterpillar","waterflourish","waterbarrage","waterimpact","watercrush","smokebomb","vanish","materialize","ignite","phoenix","ember","burn","scorch","combust","flameVortex","firedance","fireflourish","firecrown","firemeditation","firedrill","firepillar","firehelix","firebarrage","fireimpact","fireblast","radiate","blaze","puff","billow","fume","shroud","hazeSmoke","chokeSmoke","iceFreeze","shatterIce","thaw","shock","overload","glitch","crackle","chargeUp","electricAuraEffect","staticDischarge","electriccrown","electricdance","electrichelix","electricpillar","electricdrill","electricflourish","electricvortex","electricbarrage","electricimpact","electricblast","electricsurge","electriczap","electricmeditation","zap","drain","siphon","hollow","corrupt","taint","wither","consume","erase","singularity","voidcrown","voiddance","voidhelix","voidpillar","voiddrill","voidflourish","voidvortex","voidbarrage","voidimpact","voidmeditation","iceCrown","iceDance","icePillar","iceHelix","iceMeditation","iceVortex","iceSplash","iceEncase","iceDrill","iceFlourish","iceBarrage","iceImpact","icemist","iceshiver","lightBlind","lightPurify","lightCleanse","lightRadiate","lightGlow","lightBeacon","lightAscend","lightIlluminate","lightDissolve","lightMeditation","lightcrown","lightdance","lighthelix","lightpillar","lightdrill","lightflourish","lightvortex","lightbarrage","lightimpact","lightblast","lightsurge","lightmeditation","poisonInfect","poisonSicken","poisonOoze","poisonSeep","poisonToxic","poisonCorrode","poisonMelt","poisonDecay","poisonDissolve","earthPetrify","earthBurden","earthRumble","earthQuake","earthMeditation","earthEncase","earthCrumble","earthShatter","earthErode","earthcrown","earthdance","earthhelix","earthpillar","earthdrill","earthflourish","earthvortex","earthbarrage","earthimpact","earthblast","earthsurge","earthmeditation","natureEntangle","natureRoot","natureConstrict","natureBloom","natureFlourish","natureBlossom","morph"],atmosphere:["rain","drift","driftUp","driftDown","driftLeft","driftRight","vortex","cascadeUp","cascadeDown","cascadeLeft","cascadeRight","confetti","fizz","swarmUp","swarmDown","swarmLeft","swarmRight","burst","burstUp","burstDown","burstLeft","burstRight","ripple","wave","flash","glow","bloom","flicker","shiver","heartbeat","snap","elasticBounce","hold","fade","settle","peek","directional","magneticForward","magneticBack","magneticLeft","magneticRight","magneticUp","magneticDown","magneticAttract","magneticRepel"]},Gr={};function Lr(e){return Gr[e]||"atmosphere"}function _r(e){return Br[e]?Br[e]:x.getPluginGesture(e)||null}function Hr(e){const t=_r(e);return!!t&&"blending"===t.type}function Ur(e){const t=_r(e);return!!t&&"override"===t.type}function Qr(e,t,i,a,s,n,r){const o=_r(t);return!!o&&(o.apply&&o.apply(e,i,a,s,n,r),i>=1&&o.cleanup&&o.cleanup(e),!0)}function Yr(){const e=[];return Object.values(Br).forEach(t=>{e.push({name:t.name,emoji:t.emoji||"üé≠",type:t.type,category:Gr[t.name]||"atmosphere",description:t.description||"No description",source:"core",usesShatter:t.usesShatter||!1})}),x.getAllPluginGestures().forEach(t=>{const i=x.getPluginGesture(t);e.push({name:i.name,emoji:i.emoji||"üîå",type:i.type,category:i.category||"effect",description:i.description||"Plugin gesture",source:"plugin"})}),e}function Xr(e){return Br[e]||null}function Nr(){return Object.keys(Br).filter(e=>{const t=Object.getOwnPropertyDescriptor(Br,e);return t&&"function"==typeof t.get})}Object.entries(Wr).forEach(([e,t])=>{t.forEach(t=>{Gr[t]=e})});var Jr={GESTURE_REGISTRY:Br,GESTURE_TYPES:$r,GESTURE_CATEGORIES:Wr,GESTURE_TO_CATEGORY:Gr,getGesture:_r,getGestureCategory:Lr,isBlendingGesture:Hr,isOverrideGesture:Ur,applyGesture:Qr,listGestures:Yr,pluginAdapter:x},Zr=Object.freeze({__proto__:null,GESTURE_CATEGORIES:Wr,GESTURE_REGISTRY:Br,GESTURE_TO_CATEGORY:Gr,GESTURE_TYPES:$r,applyGesture:Qr,default:Jr,getGesture:_r,getGestureCategory:Lr,getLazyGestureNames:Nr,isBlendingGesture:Hr,isOverrideGesture:Ur,listGestures:Yr,pluginAdapter:x,resolveGesture:Xr,warmUpGestures:function({onBatch:e,onComplete:t}={}){const i=Object.keys(Br);e&&e(i.map(e=>({name:e,category:Gr[e]||"atmosphere",source:"core"})));try{const t=[];x.getAllPluginGestures().forEach(e=>{const i=x.getPluginGesture(e);t.push({name:i.name,emoji:i.emoji||"üîå",type:i.type,category:i.category||"effect",description:i.description||"Plugin gesture",source:"plugin"})}),t.length&&e&&e(t)}catch(e){}return t&&t(),Nr().map(e=>()=>Xr(e))}});function Kr(e){if(!e||0===e.length)return"#FFFFFF";let t=0,i=0;const a=[];for(const s of e)"string"==typeof s?(a.push({color:s,weight:null}),i++):s&&"object"==typeof s&&s.color&&(a.push({color:s.color,weight:s.weight||null}),s.weight?t+=s.weight:i++);const s=Math.max(0,100-t),n=i>0?s/i:0,r=[];let o=0;for(const e of a)o+=null!==e.weight?e.weight:n,r.push({color:e.color,threshold:o});const l=Math.random()*o;for(const e of r)if(l<=e.threshold)return e.color;return a[a.length-1].color}var eo={name:"ambient",emoji:"‚òÅÔ∏è",description:"Gentle upward drift like smoke",initialize:function(e){e.vx=0,e.vy=-.04-.02*Math.random(),e.lifeDecay=.002,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={upwardSpeed:5e-4,waviness:0,friction:.998}},update:function(e,t,i,a){const s=e.behaviorData;e.vy*=Math.pow(s.friction,t),e.vy-=s.upwardSpeed*t,e.vx=0}};const to=2*Math.PI;var io={name:"orbiting",emoji:"üíï",description:"Romantic firefly dance around the orb",initialize:function(e){e.lifeDecay=.001+.002*Math.random(),e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.isSparkle="#FFE4E1"===e.color||"#FFCCCB"===e.color||"#FFC0CB"===e.color;const t=40*(e.scaleFactor||1)*(1.3+.9*Math.random());e.blinkPhase=Math.random()*to,e.blinkSpeed=.3+1.2*Math.random(),e.blinkIntensity=.6+.4*Math.random(),e.fadePhase=Math.random()*to,e.fadeSpeed=.1+.3*Math.random(),e.minOpacity=.2+.2*Math.random(),e.maxOpacity=.8+.2*Math.random(),e.isSparkle&&(e.blinkSpeed*=2,e.blinkIntensity=1,e.minOpacity=0,e.maxOpacity=1),e.behaviorData={angle:Math.random()*to,radius:t,baseRadius:t,angularVelocity:8e-4+.0017*Math.random(),swayAmount:3+7*Math.random(),swaySpeed:.2+.5*Math.random(),floatOffset:Math.random()*to,floatSpeed:.3+.7*Math.random(),floatAmount:2+6*Math.random(),twinklePhase:Math.random()*to,twinkleSpeed:2+3*Math.random()}},update:function(e,t,i,a){const s=e.behaviorData;s.angle+=s.angularVelocity*t;const n=Math.sin(s.angle*s.swaySpeed)*s.swayAmount,r=6*Math.sin(1.5*s.angle),o=(s.radius||s.baseRadius)+r+.2*n,l=i+Math.cos(s.angle)*o,h=a+Math.sin(s.angle)*o;s.floatOffset+=s.floatSpeed*t*.001;const c=Math.sin(s.floatOffset)*s.floatAmount;e.vx=.1*(l-e.x),e.vy=.1*(h+c-e.y),e.fadePhase+=e.fadeSpeed*t*.001;const u=.5*Math.sin(e.fadePhase)+.5,d=e.minOpacity+(e.maxOpacity-e.minOpacity)*u;let p;e.blinkPhase+=e.blinkSpeed*t*.002,e.isSparkle?(s.twinklePhase+=s.twinkleSpeed*t*.001,p=.7*Math.pow(Math.sin(s.twinklePhase),16)+.2*Math.sin(5*e.blinkPhase)+.1):p=.4*Math.sin(e.blinkPhase)+.3*Math.sin(3*e.blinkPhase)+.2*Math.sin(7*e.blinkPhase)+.1*Math.sin(11*e.blinkPhase);const g=.5*(p+1),m=.2+g*e.blinkIntensity*.8;e.opacity=e.baseOpacity*d*m,e.isSparkle?e.size=e.baseSize*(.5+1*g):e.size=e.baseSize*(.8+.3*g),e.isSparkle&&(e.tempColor=g>.85?"#FFFFFF":e.color)}},ao={name:"rising",emoji:"üéà",description:"Buoyant upward movement like balloons",initialize:function(e){e.vx=.02*(Math.random()-.5),e.vy=-.05-.03*Math.random(),e.lifeDecay=.002,e.baseOpacity=.7+.3*Math.random(),e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={buoyancy:.001,driftAmount:.005}},update:function(e,t,i,a){const s=e.behaviorData;e.vy-=s.buoyancy*t,e.vx+=(Math.random()-.5)*s.driftAmount*t,e.vx*=Math.pow(.995,t),e.vy*=Math.pow(.998,t)}};function so(e){e.fallingData||(e.fallingData={originalX:e.x,originalY:e.y,originalOpacity:e.opacity??e.life??1,wobblePhase:Math.random()*Math.PI*2,wobbleSpeed:.3+.4*Math.random(),fallProgress:0}),e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors));const t=Math.random(),i=Math.random(),a=t*Math.PI*2,s=2*i-1,n=Math.sqrt(1-s*s);e.behaviorData={fallSpeed:8,fallDistance:400,wobbleAmount:1.5,fallingDir:{x:n*Math.cos(a),y:s,z:n*Math.sin(a)},orbitDistanceRatio:.7+.4*Math.random()}}var no={name:"falling",emoji:"üíß",description:"Heavy downward drift like tears",initialize:so,update:function(e,t,i,a){const s=e.behaviorData;let n=e.fallingData;n||(so(e),n=e.fallingData),n.fallProgress+=.02*t;const r=Math.min(n.fallProgress,1),o=s.fallDistance*r;n.wobblePhase+=n.wobbleSpeed*t*.1;const l=Math.sin(n.wobblePhase)*s.wobbleAmount;if(e.x=n.originalX+l,e.y=n.originalY+o,e.vx=.3*l,e.vy=10*s.fallSpeed,r>.6){const t=(r-.6)/.4;e.opacity=n.originalOpacity*(1-t),void 0!==e.life&&(e.life=n.originalOpacity*(1-t))}}};var ro={name:"popcorn",emoji:"üçø",description:"Spontaneous popping with gravity and bounces",initialize:function(e){if(e.vx=.1*(Math.random()-.5),e.vy=.1*(Math.random()-.5),e.lifeDecay=.008+.012*Math.random(),e.emotionColors&&e.emotionColors.length>0)e.color=Kr(e.emotionColors);else{const t=["#FFFFFF","#FFFACD","#FFF8DC","#FFFFE0","#FAFAD2"];e.color=Kr(t)}e.size=Math.random()<.3?(8+4*Math.random())*e.scaleFactor*e.particleSizeMultiplier:(2+4*Math.random())*e.scaleFactor*e.particleSizeMultiplier,e.baseSize=e.size,e.hasGlow=Math.random()<.2,e.glowSizeMultiplier=e.hasGlow?1.2:0,e.behaviorData={popDelay:2e3*Math.random(),hasPopped:!1,popStrength:3+5*Math.random(),gravity:.098,bounceDamping:.7,bounceCount:0,maxBounces:2+Math.floor(2*Math.random()),spinRate:10*(Math.random()-.5),lifetime:0}},update:function(e,t,i,a){const s=e.behaviorData;if(s.lifetime+=16.67*t,!s.hasPopped&&s.lifetime>s.popDelay){s.hasPopped=!0;const t=Math.random()*Math.PI*2;e.vx=Math.cos(t)*s.popStrength*1.5,e.vy=Math.sin(t)*s.popStrength-.3,e.size=1.25*e.baseSize}if(s.hasPopped){e.vy+=s.gravity*t;const i=a+100*e.scaleFactor;e.y>i&&s.bounceCount<s.maxBounces&&(e.y=i,e.vy=-Math.abs(e.vy)*s.bounceDamping,e.vx*=.9,s.bounceCount++,e.size=e.baseSize*(1.5-.1*s.bounceCount)),s.bounceCount>=s.maxBounces&&(e.lifeDecay=.03+.02*Math.random(),e.size*=.95),Math.sqrt(e.vx*e.vx+e.vy*e.vy)<.5&&(e.lifeDecay*=1.5)}}},oo={name:"burst",emoji:"üí•",description:"Explosive expansion from center",initialize:function(e){const t="suspicion"===e.emotion,i="surprise"===e.emotion,a="glitch"===e.emotion,s=Math.random()*to,n=t?1+.8*Math.random():i?7+5*Math.random():a?2+1.5*Math.random():3.5+2.5*Math.random();e.vx=Math.cos(s)*n,e.vy=Math.sin(s)*n,e.lifeDecay=t?.01:i?.006+.008*Math.random():a?.012:.015,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),t&&(e.size=(6+4*Math.random())*(e.scaleFactor||1)*(e.particleSizeMultiplier||1),e.baseSize=e.size,e.opacity=1,e.baseOpacity=e.opacity),e.behaviorData={isSuspicion:t,isSurprise:i,isGlitch:a,age:0,fadeStart:t?.3:.2,glitchPhase:Math.random()*Math.PI*2,glitchIntensity:a?.3:0,glitchFrequency:a?.1:0}},update:function(e,t,i,a){const s=e.behaviorData;if(s.isSurprise)if(s.age+=.016*t,s.age<.15){const i=.98;e.vx*=Math.pow(i,t),e.vy*=Math.pow(i,t)}else if(s.age<.25){const i=.85;e.vx*=Math.pow(i,t),e.vy*=Math.pow(i,t)}else{const i=.99;e.vx*=Math.pow(i,t),e.vy*=Math.pow(i,t),e.vx+=.01*(Math.random()-.5)*t,e.vy+=.01*(Math.random()-.5)*t}else{const i=s.isSuspicion?.99:s.isGlitch?.97:.95;e.vx*=Math.pow(i,t),e.vy*=Math.pow(i,t)}if(s.isSuspicion){const i=.001*Date.now();e.vx+=.01*Math.sin(2*i+e.id)*t}if(s.isGlitch){s.age+=.016*t,s.glitchPhase+=s.glitchFrequency*t;const i=Math.sin(s.glitchPhase)*s.glitchIntensity*t,a=Math.cos(1.3*s.glitchPhase)*s.glitchIntensity*t;if(e.vx+=i,e.vy+=a,Math.random()<.02){const t=Math.random()*Math.PI*2,i=.5+.5*Math.random();e.vx+=Math.cos(t)*i,e.vy+=Math.sin(t)*i}}}},lo={name:"aggressive",emoji:"‚ö°",description:"Sharp, chaotic movement with violent bursts",initialize:function(e){const t=Math.random()*to,i=1.5+2*Math.random();e.vx=Math.cos(t)*i,e.vy=Math.sin(t)*i,e.lifeDecay=.015,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={acceleration:.05,jitter:.3,speedDecay:.95}},update:function(e,t,i,a){const s=e.behaviorData;if(e.vx+=(Math.random()-.5)*s.jitter*t,e.vy+=(Math.random()-.5)*s.jitter*t,e.vx*=Math.pow(s.speedDecay,t),e.vy*=Math.pow(s.speedDecay,t),Math.random()<Math.min(.05*t,.5)){const t=Math.random()*to;e.vx+=Math.cos(t)*s.acceleration,e.vy+=Math.sin(t)*s.acceleration}}},ho={name:"scattering",emoji:"üò®",description:"Particles flee from center in panic",initialize:function(e){e.vx=0,e.vy=0,e.lifeDecay=.008,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={fleeSpeed:2,panicFactor:1.2,initialized:!1}},update:function(e,t,i,a){const s=e.behaviorData;if(!s.initialized){const t=e.x-i,n=e.y-a,r=Math.sqrt(t*t+n*n);if(r>0)e.vx=t/r*s.fleeSpeed,e.vy=n/r*s.fleeSpeed;else{const t=Math.random()*to;e.vx=Math.cos(t)*s.fleeSpeed,e.vy=Math.sin(t)*s.fleeSpeed}s.initialized=!0}const n=e.x-i,r=e.y-a,o=Math.sqrt(n*n+r*r);o>0&&(e.vx+=n/o*s.panicFactor*.01*t,e.vy+=r/o*s.panicFactor*.01*t),e.vx+=.1*(Math.random()-.5)*t,e.vy+=.1*(Math.random()-.5)*t,e.vx*=Math.pow(.98,t),e.vy*=Math.pow(.98,t)}},co={name:"repelling",emoji:"üö´",description:"Particles pushed away from center, maintaining distance",initialize:function(e){e.vx=0,e.vy=0,e.lifeDecay=.01,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={repelStrength:.8,minDistance:50,initialized:!1}},update:function(e,t,i,a){const s=e.behaviorData,n=e.x-i,r=e.y-a,o=Math.sqrt(n*n+r*r);if(!s.initialized||o<s.minDistance){if(o>0){const i=s.repelStrength/Math.max(o,5);e.vx+=n/o*i*t,e.vy+=r/o*i*t}s.initialized=!0}e.vx*=Math.pow(.99,t),e.vy*=Math.pow(.99,t)}},uo={name:"connecting",emoji:"üîó",description:"Chaotic movement with center attraction for social states",initialize:function(e){const t=Math.random()*to,i=2+5*Math.random();e.vx=Math.cos(t)*i,e.vy=Math.sin(t)*i,e.lifeDecay=.012,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={attractionForce:.008,chaosFactor:1,friction:.95}},update:function(e,t,i,a){const s=e.behaviorData;e.vx*=Math.pow(s.friction,t),e.vy*=Math.pow(s.friction,t);const n=(i-e.x)*s.attractionForce,r=(a-e.y)*s.attractionForce,o=(Math.random()-.5)*s.chaosFactor,l=(Math.random()-.5)*s.chaosFactor;e.vx+=n+o,e.vy+=r+l}},po={name:"resting",emoji:"üò¥",description:"Ultra-slow vertical drift for deep rest states",initialize:function(e){e.vx=0,e.vy=-.01,e.lifeDecay=.001,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={upwardSpeed:2e-5,friction:.999}},update:function(e,t,i,a){const s=e.behaviorData;e.vy*=Math.pow(s.friction,t),e.vy-=s.upwardSpeed*t,e.vx=0}},go={name:"radiant",emoji:"‚òÄÔ∏è",description:"Particles radiate outward like sunbeams",initialize:function(e){const t=Math.random()*to,i=.8+.4*Math.random();if(e.vx=Math.cos(t)*i,e.vy=Math.sin(t)*i,e.lifeDecay=.006,e.emotionColors&&e.emotionColors.length>0)e.color=Kr(e.emotionColors);else{const t=["#FFD700","#FFB347","#FFA500","#FF69B4"];e.color=Kr(t)}e.hasGlow=Math.random()<.7,e.glowSizeMultiplier=e.hasGlow?1.5+.5*Math.random():0,e.behaviorData={radialSpeed:.02,shimmer:Math.random()*to,shimmerSpeed:.1,friction:.99}},update:function(e,t,i,a){const s=e.behaviorData,n=e.x-i,r=e.y-a,o=Math.sqrt(n*n+r*r);if(o>0){const i=n/o,a=r/o;e.vx+=i*s.radialSpeed*t,e.vy+=a*s.radialSpeed*t}s.shimmer+=s.shimmerSpeed*t;const l=Math.sin(s.shimmer);e.size=e.baseSize*(1+.2*l),e.opacity=e.baseOpacity*(1+.3*l),e.vx*=Math.pow(s.friction,t),e.vy*=Math.pow(s.friction,t)}};function mo(e){e.vx=.02*(Math.random()-.5),e.vy=-.03-.02*Math.random(),e.lifeDecay=8e-4,e.size=(6+6*Math.random())*(e.scaleFactor||1)*(e.particleSizeMultiplier||1)*1.33,e.baseSize=e.size,e.baseOpacity=.2+.2*Math.random(),e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={ascensionSpeed:3e-4,waveFactor:.5,waveFrequency:.001,friction:.998,fadeStartDistance:100}}var yo={name:"ascending",emoji:"üßò",description:"Slow steady upward float like incense smoke",initialize:mo,update:function(e,t,i,a){const s=e.behaviorData;if(!s)return void mo(e);e.vx*=Math.pow(s.friction,t),e.vy*=Math.pow(s.friction,t),e.vy-=s.ascensionSpeed*t;const n=Math.sin(e.age*s.waveFrequency*1e3)*s.waveFactor;e.vx+=.001*n*t,void 0===e.initialY&&(e.initialY=e.y);const r=e.initialY-e.y;if(r>s.fadeStartDistance){const t=(r-s.fadeStartDistance)/100,i=Math.max(0,1-t);e.baseOpacity*=.995,i<.5&&(e.lifeDecay*=1.02)}Math.abs(e.vx)>.05&&(e.vx*=Math.pow(.95,t)),e.vy<-.1&&(e.vy=-.1)}},fo={name:"erratic",emoji:"üò∞",description:"Nervous jittery movement for anxious states",initialize:function(e){const t=Math.random()*to,i=.1+.15*Math.random();e.vx=Math.cos(t)*i,e.vy=Math.sin(t)*i,e.lifeDecay=.004,e.size=(2+4*Math.random())*(e.scaleFactor||1)*(e.particleSizeMultiplier||1),e.baseSize=e.size,e.baseOpacity=.4+.3*Math.random(),e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={jitterStrength:.02,directionChangeRate:.1,speedVariation:.3,spinRate:.05+.1*Math.random()}},update:function(e,t){const i=e.behaviorData;if(e.vx+=(Math.random()-.5)*i.jitterStrength*t,e.vy+=(Math.random()-.5)*i.jitterStrength*t,Math.random()<Math.min(i.directionChangeRate*t,.5)){const t=Math.random()*to,i=Math.sqrt(e.vx*e.vx+e.vy*e.vy);e.vx=Math.cos(t)*i,e.vy=Math.sin(t)*i}const a=1+(Math.random()-.5)*i.speedVariation*t;e.vx*=a,e.vy*=a;const s=e.age*i.spinRate*1e3;e.size=e.baseSize*(1+.2*Math.sin(s)),e.opacity=e.baseOpacity*(.8+.4*Math.random()),e.vx*=Math.pow(.98,t),e.vy*=Math.pow(.98,t);const n=Math.sqrt(e.vx*e.vx+e.vy*e.vy);n>.5&&(e.vx=e.vx/n*.5,e.vy=e.vy/n*.5)}},bo={name:"cautious",emoji:"ü§®",description:"Slow careful movement with watchful pauses",initialize:function(e){const t=Math.random()*to,i=.02+.03*Math.random();e.vx=Math.cos(t)*i,e.vy=Math.sin(t)*i,e.lifeDecay=.001,e.life=1,e.size=(4+4*Math.random())*(e.scaleFactor||1)*(e.particleSizeMultiplier||1),e.baseSize=e.size,e.baseOpacity=.8+.2*Math.random(),e.opacity=e.baseOpacity,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={pauseTimer:2*Math.random(),pauseDuration:.5+.5*Math.random(),moveDuration:1+.5*Math.random(),isMoving:Math.random()>.5,moveTimer:0,originalVx:e.vx,originalVy:e.vy,watchRadius:50+30*Math.random()}},update:function(e,t,i,a){const s=e.behaviorData;if(s.moveTimer+=t,s.isMoving)s.moveTimer>s.moveDuration?(s.isMoving=!1,s.moveTimer=0,e.vx=0,e.vy=0):(e.vx=s.originalVx,e.vy=s.originalVy);else if(s.moveTimer>s.pauseDuration){s.isMoving=!0,s.moveTimer=0;const t=Math.random()*to,i=.02+.03*Math.random();e.vx=Math.cos(t)*i,e.vy=Math.sin(t)*i,s.originalVx=e.vx,s.originalVy=e.vy}const n=e.x-i,r=e.y-a,o=Math.sqrt(n*n+r*r);if(o>s.watchRadius){const i=.02;e.vx-=n/o*i*t,e.vy-=r/o*i*t}e.vx*=Math.pow(.995,t),e.vy*=Math.pow(.995,t),s.isMoving?e.opacity=e.baseOpacity:e.opacity=e.baseOpacity*(.9+.1*Math.sin(5*e.age))}},wo={name:"surveillance",emoji:"üëÅÔ∏è",description:"Searchlight scanning with paranoid watchfulness",initialize(e,t){e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorState={scanAngle:Math.random()*Math.PI-Math.PI/2,scanDirection:Math.random()<.5?1:-1,scanSpeed:.3+.2*Math.random(),scanRange:Math.PI/3+Math.random()*Math.PI/4,scanCenter:Math.random()*Math.PI*2,pauseTimer:0,pauseDuration:500+500*Math.random(),mode:"scanning",modeTimer:0,nextModeChange:2e3+3e3*Math.random(),dartTarget:{x:0,y:0},dartSpeed:0,patrolRadius:150+100*Math.random(),patrolAngle:Math.random()*Math.PI*2,alertLevel:0,lastPosition:{x:e.x,y:e.y}};const i=Math.random();i<.7?e.behaviorState.primaryRole="scanner":i<.9?(e.behaviorState.primaryRole="patroller",e.behaviorState.mode="patrolling"):(e.behaviorState.primaryRole="watcher",e.behaviorState.mode="frozen")},update(e,t,i){const a=e.behaviorState;if(a){switch(a.modeTimer+=16*t,a.modeTimer>a.nextModeChange&&(this.changeMode(e,a,i),a.modeTimer=0,a.nextModeChange=2e3+4e3*Math.random()),a.mode){case"scanning":this.updateScanning(e,t,a,i);break;case"darting":this.updateDarting(e,t,a,i);break;case"frozen":this.updateFrozen(e,t,a,i);break;case"patrolling":this.updatePatrolling(e,t,a,i)}e.vy+=.05*t,e.x+=e.vx*t,e.y+=e.vy*t,a.lastPosition.x=e.x,a.lastPosition.y=e.y}},updateScanning(e,t,i,a){i.pauseTimer>0?(i.pauseTimer-=16*t,e.vx*=.9,e.vy*=.9):(i.scanAngle+=i.scanDirection*i.scanSpeed*t*.02,Math.abs(i.scanAngle)>i.scanRange/2&&(i.scanDirection*=-1,i.pauseTimer=i.pauseDuration,i.scanAngle=Math.sign(i.scanAngle)*i.scanRange/2));const s=i.scanCenter+i.scanAngle,n=.8+.5*i.alertLevel;e.vx=Math.cos(s)*n,e.vy=Math.sin(s)*n*.3},updateDarting(e,t,i,a){const s=i.dartTarget.x-e.x,n=i.dartTarget.y-e.y,r=Math.sqrt(s*s+n*n);r>5?(e.vx=s/r*i.dartSpeed,e.vy=n/r*i.dartSpeed):(i.mode="scanning",i.modeTimer=0)},updateFrozen(e,t,i,a){e.vx*=.95,e.vy*=.95,Math.random()<.01&&(e.vx+=.5*(Math.random()-.5),e.vy+=.5*(Math.random()-.5))},updatePatrolling(e,t,i,a){i.patrolAngle+=.01*t;const s=a.corePosition?.x??a.canvasWidth/2,n=a.corePosition?.y??a.canvasHeight/2,r=s+Math.cos(i.patrolAngle)*i.patrolRadius,o=n+Math.sin(i.patrolAngle)*i.patrolRadius,l=r-e.x,h=o-e.y;e.vx=.02*l,e.vy=.02*h},changeMode(e,t,i){const a=Math.random(),s=i?.corePosition?.x??(i?.canvasWidth/2||e.x),n=i?.corePosition?.y??(i?.canvasHeight/2||e.y);"scanner"===t.primaryRole?a<.1?(t.mode="darting",t.dartTarget={x:s+200*(Math.random()-.5),y:n+200*(Math.random()-.5)},t.dartSpeed=3+2*Math.random()):t.mode=a<.2?"frozen":"scanning":"patroller"===t.primaryRole?t.mode=a<.1?"frozen":"patrolling":t.mode=a<.3?"scanning":"frozen"}},vo={name:"glitchy",emoji:"‚ö°",description:"Digital glitch with stuttering orbits and corruption",rhythm:{enabled:!0,glitchTiming:{mode:"subdivision",subdivision:"sixteenth",probability:.3,intensityOnBeat:2,intensityOffBeat:.5},stutterSync:{mode:"pattern",patterns:{dubstep:{freezeOnDrop:!0,dropDuration:100},breakbeat:{randomFreeze:.1,duration:50}}},orbitRhythm:{baseSpeed:"tempo",wobbleSync:"eighth",beatAcceleration:1.5,barReset:!0},rgbSync:{enabled:!0,amount:"intensity",direction:"beat",maxSplit:10},noiseRhythm:{trigger:"accent",duration:50,intensity:"drop"}},initialize(e,t,i,a){e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorState={orbitAngle:Math.random()*Math.PI*2,orbitRadius:300+400*Math.random(),orbitSpeed:.01+.02*Math.random(),glitchTimer:0,nextGlitch:500*Math.random()+100,isGlitching:!1,glitchDuration:0,glitchOffset:{x:0,y:0},stutterTimer:0,nextStutter:200*Math.random()+50,isFrozen:!1,frozenPosition:{x:0,y:0},frozenVelocity:{x:0,y:0},hasGhost:Math.random()<.3,ghostOffset:20*Math.random()+10,ghostAngle:Math.random()*Math.PI*2,rgbSplit:Math.random()<.4,rgbPhase:Math.random()*Math.PI*2,noiseLevel:0,noiseBurst:!1,beatPhase:Math.random()*Math.PI*2,beatFrequency:.05+.03*Math.random(),dropIntensity:0},e.lifeDecay=.0015,e.hasGlow=!0,e.glowSizeMultiplier=3+2*Math.random()},update(e,t,i,a){const s=e.behaviorState;if(!s)return;s.glitchTimer+=16*t,s.stutterTimer+=16*t,s.stutterTimer>s.nextStutter&&(s.isFrozen?(s.isFrozen=!1,s.stutterTimer=0,s.nextStutter=100+300*Math.random(),Math.random()<.3&&(e.x+=60*(Math.random()-.5),e.y+=60*(Math.random()-.5))):(s.isFrozen=!0,s.frozenPosition={x:e.x,y:e.y},s.frozenVelocity={x:e.vx,y:e.vy},s.stutterTimer=0,s.nextStutter=20+40*Math.random())),s.glitchTimer>s.nextGlitch&&!s.isGlitching&&(s.isGlitching=!0,s.glitchDuration=50+100*Math.random(),s.glitchOffset={x:80*(Math.random()-.5),y:80*(Math.random()-.5)},s.glitchTimer=0,Math.random()<.5&&e.emotionColors&&(e.color=Kr(e.emotionColors))),s.isGlitching&&s.glitchTimer>s.glitchDuration&&(s.isGlitching=!1,s.glitchTimer=0,s.nextGlitch=200+800*Math.random(),s.glitchOffset={x:0,y:0}),s.beatPhase+=s.beatFrequency*t;const n=.5*Math.sin(s.beatPhase)+.5;if(s.beatPhase%(4*Math.PI)<.5*Math.PI?s.dropIntensity=Math.min(1,s.dropIntensity+.1*t):s.dropIntensity=Math.max(0,s.dropIntensity-.05*t),s.isFrozen)e.vx=.5*(Math.random()-.5),e.vy=.5*(Math.random()-.5);else{s.orbitAngle+=s.orbitSpeed*t*(1+.5*n);const r=s.orbitRadius*(1+.3*s.dropIntensity*Math.sin(4*s.beatPhase));let o=i+Math.cos(s.orbitAngle)*r,l=a+Math.sin(s.orbitAngle)*r*.6;if(s.isGlitching&&(o+=s.glitchOffset.x*Math.random()*.8,l+=s.glitchOffset.y*Math.random()*.8),s.rgbSplit){const e=3*(1+s.dropIntensity);o+=Math.sin(s.rgbPhase)*e,l+=Math.cos(s.rgbPhase)*e,s.rgbPhase+=.1*t}s.dropIntensity>.8&&Math.random()<.1&&(o+=30*(Math.random()-.5),l+=30*(Math.random()-.5));const h=s.isGlitching?.02:.03;e.vx=(o-e.x)*h,e.vy=(l-e.y)*h,e.vx+=(Math.random()-.5)*n*2,e.vy+=(Math.random()-.5)*n*2}e.x+=e.vx*t,e.y+=e.vy*t,Math.random()<.02&&(e.opacity=.1+.9*Math.random()),e.size=e.baseSize*(1+.3*n+.5*s.dropIntensity)}},Mo={name:"spaz",description:"Ultra-aggressive particles with explosive spread and chaotic motion",initialize(e,t,i,a){e.x=i,e.y=a,e.life=1,e.size=3+4*Math.random();const s=Math.random()*Math.PI*2,n=200+300*Math.random();e.vx=Math.cos(s)*n,e.vy=Math.sin(s)*n,e.behaviorState={explosionPhase:0,explosionTimer:0,explosionDuration:1e3+2e3*Math.random(),chaosTimer:0,nextChaosChange:100+200*Math.random(),chaosAngle:s,chaosSpeed:50+100*Math.random(),spazIntensity:.8+.4*Math.random(),zigzagPattern:Math.random()<.5,spiralPattern:Math.random()<.3,teleportChance:.02,sizePulse:!0,sizePulseSpeed:.1+.05*Math.random(),sizePulsePhase:Math.random()*Math.PI*2,colorShift:Math.random()<.3,colorShiftSpeed:.05+.03*Math.random()},e.lifeDecay=8e-4,e.hasGlow=!0,e.glowSizeMultiplier=4+3*Math.random(),e.glowIntensity=1.5+.5*Math.random()},update(e,t,i,a){const s=e.behaviorState;if(s.explosionTimer+=t,s.chaosTimer+=t,0===s.explosionPhase&&s.explosionTimer<500)e.vx*=.98,e.vy*=.98,Math.random()<.1&&(e.vx+=100*(Math.random()-.5),e.vy+=100*(Math.random()-.5));else if(0===s.explosionPhase&&s.explosionTimer>=500)s.explosionPhase=1,s.chaosAngle=Math.random()*Math.PI*2,s.chaosSpeed=30+70*Math.random();else if(1===s.explosionPhase){s.chaosTimer>=s.nextChaosChange&&(s.chaosAngle=Math.random()*Math.PI*2,s.chaosSpeed=20+80*Math.random(),s.nextChaosChange=50+150*Math.random(),s.chaosTimer=0);const t=Math.cos(s.chaosAngle)*s.chaosSpeed,i=Math.sin(s.chaosAngle)*s.chaosSpeed;if(e.vx=.7*e.vx+.3*t,e.vy=.7*e.vy+.3*i,s.zigzagPattern){const t=.01*s.chaosTimer;e.vx+=20*Math.sin(t),e.vy+=20*Math.cos(t)}if(s.spiralPattern){const t=.005*s.chaosTimer,i=50+30*Math.sin(.003*s.chaosTimer);e.vx+=Math.cos(t)*i*.1,e.vy+=Math.sin(t)*i*.1}}if(Math.random()<s.teleportChance){const t=Math.random()*Math.PI*2,s=200+400*Math.random();e.x=i+Math.cos(t)*s,e.y=a+Math.sin(t)*s,e.vx=200*(Math.random()-.5),e.vy=200*(Math.random()-.5)}if(e.x+=e.vx*(t/1e3),e.y+=e.vy*(t/1e3),s.sizePulse){s.sizePulsePhase+=s.sizePulseSpeed*t;const i=1+.5*Math.sin(s.sizePulsePhase);e.size=(3+4*Math.random())*i}s.colorShift&&(s.colorShiftPhase=(s.colorShiftPhase||0)+s.colorShiftSpeed*t),e.vx*=.995,e.vy*=.995,e.life-=e.lifeDecay*t,(e.life<=0||Math.abs(e.x-i)>2e3||Math.abs(e.y-a)>2e3)&&(e.life=0)},getSpawnPosition(e,t){const i=Math.random()*Math.PI*2,a=100+200*Math.random();return{x:e+Math.cos(i)*a,y:t+Math.sin(i)*a}},getVisualProperties:()=>({glowColor:"#FF00AA",glowIntensity:2,particleColors:[{color:"#FF00AA",weight:30},{color:"#00FFAA",weight:25},{color:"#FFAA00",weight:20},{color:"#AA00FF",weight:15},{color:"#00AAFF",weight:10}]})},So={name:"directed",emoji:"üéØ",description:"Focused, straight-line movement toward target",config:{speed:3,acceleration:.15,focusStrength:.8,randomness:.1,edgeBuffer:50},initialize(e,t,i,a,s){const n=t-e.x,r=i-e.y,o=Math.sqrt(n*n+r*r);if(o>0)e.vx=n/o*this.config.speed,e.vy=r/o*this.config.speed;else{const t=Math.random()*Math.PI*2;e.vx=Math.cos(t)*this.config.speed,e.vy=Math.sin(t)*this.config.speed}e.targetX=t,e.targetY=i,e.directedPhase=0},update(e,t,i,a,s,n){e.directedPhase+=.05*t;const r=e.targetX-e.x,o=e.targetY-e.y,l=Math.sqrt(r*r+o*o);if(l>10){const i=r/l*this.config.speed,a=o/l*this.config.speed;e.vx+=(i-e.vx)*this.config.acceleration*t,e.vy+=(a-e.vy)*this.config.acceleration*t,e.vx+=(Math.random()-.5)*this.config.randomness,e.vy+=(Math.random()-.5)*this.config.randomness}else{const t=Math.random()*Math.PI*2,r=100+200*Math.random();e.targetX=i+Math.cos(t)*r,e.targetY=a+Math.sin(t)*r,e.targetX=Math.max(this.config.edgeBuffer,Math.min(s-this.config.edgeBuffer,e.targetX)),e.targetY=Math.max(this.config.edgeBuffer,Math.min(n-this.config.edgeBuffer,e.targetY))}e.x+=e.vx*t,e.y+=e.vy*t,(e.x<=0||e.x>=s)&&(e.vx*=-.8,e.x=Math.max(0,Math.min(s,e.x)),e.targetX=i+300*(Math.random()-.5)),(e.y<=0||e.y>=n)&&(e.vy*=-.8,e.y=Math.max(0,Math.min(n,e.y)),e.targetY=a+300*(Math.random()-.5))},visuals:{trailLength:"medium",opacity:.9,sizeMultiplier:1,blurAmount:.2}},xo={name:"fizzy",emoji:"ü´ß",description:"Bubbly, effervescent movement like carbonation",config:{baseRiseSpeed:2.5,wobbleAmplitude:30,wobbleFrequency:.15,popChance:.002,popForce:8,fizziness:.3,gravity:-.05},initialize(e,t,i,a,s){e.vx=2*(Math.random()-.5),e.vy=-this.config.baseRiseSpeed-2*Math.random(),e.wobblePhase=Math.random()*Math.PI*2,e.wobbleSpeed=this.config.wobbleFrequency*(.8+.4*Math.random()),e.bubbleSize=.5+.5*Math.random(),e.popTimer=0,e.isFizzing=!0},update(e,t,i,a,s,n){e.wobblePhase+=e.wobbleSpeed*t;const r=Math.sin(e.wobblePhase)*this.config.wobbleAmplitude;if(e.vx=.05*r+(Math.random()-.5)*this.config.fizziness,e.vy+=this.config.gravity*t,e.vy+=(Math.random()-.5)*this.config.fizziness,Math.random()<this.config.popChance){const t=Math.random()*Math.PI*2;e.vx=Math.cos(t)*this.config.popForce,e.vy=Math.sin(t)*this.config.popForce*.7,e.popTimer=1,e.bubbleSize=.3+.7*Math.random()}e.popTimer>0&&(e.popTimer-=.05*t,e.vx*=.95,e.vy*=.95),e.x+=e.vx*t,e.y+=e.vy*t,e.y<-50&&(e.y=n+50,e.x=i+300*(Math.random()-.5),e.vy=-this.config.baseRiseSpeed-2*Math.random(),e.bubbleSize=.5+.5*Math.random()),(e.x<=0||e.x>=s)&&(e.vx*=-.5,e.x=Math.max(0,Math.min(s,e.x))),e.y>n+50&&(e.y=n,e.vy=1.5*-this.config.baseRiseSpeed),e.size=e.baseSize*e.bubbleSize*(1+.1*Math.sin(2*e.wobblePhase))},visuals:{trailLength:"short",opacity:.6,sizeMultiplier:1.2,blurAmount:.5,sparkle:!0}},ko={name:"zen",emoji:"‚òØÔ∏è",description:"Peaceful orbital movement like a hovering aura",initialize:function(e){e.vx=.5*(Math.random()-.5),e.vy=.5*(Math.random()-.5),e.lifeDecay=.003,e.emotionColors&&e.emotionColors.length>0&&(e.color=Kr(e.emotionColors)),e.behaviorData={orbitAngle:Math.random()*Math.PI*2,orbitRadius:40+60*Math.random(),orbitSpeed:8e-4+6e-4*Math.random(),floatOffset:Math.random()*Math.PI*2,breathingOffset:Math.random()*Math.PI*2,lifetime:0}},update:function(e,t,i,a){const s=e.behaviorData;if(!s)return;s.lifetime+=t;const n=(s.lifetime+8e3*s.breathingOffset)/8e3,r=.5*Math.sin(n*Math.PI*2)+.5;e.size=e.baseSize*(.95+.05*r),s.orbitAngle+=s.orbitSpeed*t;const o=10*Math.sin(1e-4*s.lifetime+s.floatOffset),l=s.orbitRadius+o,h=i+Math.cos(s.orbitAngle)*l,c=a+Math.sin(s.orbitAngle)*l,u=15*Math.sin(3e-4*s.lifetime+s.breathingOffset),d=h-e.x,p=c+u-e.y;e.vx=.03*d,e.vy=.03*p,e.vx+=.02*(Math.random()-.5),e.vy+=.02*(Math.random()-.5),e.vx*=.98,e.vy*=.98}};const Oo=new Map;var Ao={registerPluginBehavior:function(e,t){return Oo.has(e),!(!t.initialize||"function"!=typeof t.initialize||!t.update||"function"!=typeof t.update||(Oo.set(e,{name:e,emoji:t.emoji||"üîå",description:t.description||`Plugin behavior: ${e}`,initialize:t.initialize,update:t.update,isPlugin:!0}),0))},unregisterPluginBehavior:function(e){return!!Oo.has(e)&&(Oo.delete(e),!0)},getPluginBehavior:function(e){return Oo.get(e)||null},getAllPluginBehaviors:function(){return Array.from(Oo.keys())},createLegacyAdapter:function(e){return{name:e.name||"legacy",emoji:"üîÑ",description:e.description||"Legacy plugin behavior",initialize(t){if(e.size&&(t.size="object"==typeof e.size?e.size.min+Math.random()*(e.size.max-e.size.min):e.size,t.baseSize=t.size),e.speed){const i="object"==typeof e.speed?e.speed.min+Math.random()*(e.speed.max-e.speed.min):e.speed,a=Math.random()*Math.PI*2;t.vx=Math.cos(a)*i,t.vy=Math.sin(a)*i}if(e.lifespan){const i="object"==typeof e.lifespan?e.lifespan.min+Math.random()*(e.lifespan.max-e.lifespan.min):e.lifespan;t.lifeDecay=1e3/i}e.color&&(t.color=Array.isArray(e.color)?Kr(e.color):e.color),e.opacity&&(t.life="object"==typeof e.opacity?e.opacity.min+Math.random()*(e.opacity.max-e.opacity.min):e.opacity),t.behaviorData={movementType:e.movementType||"linear",turbulence:e.turbulence||0,drift:e.drift||0,acceleration:e.acceleration||0,...e.customData}},update(t,i,a,s){const n=t.behaviorData;switch(n.movementType){case"wander":t.vx+=(Math.random()-.5)*n.turbulence*i,t.vy+=(Math.random()-.5)*n.turbulence*i;break;case"fall":t.vy+=.1*i,t.vx+=(Math.random()-.5)*n.drift*i;break;case"rain":t.vy+=n.acceleration*i;break;case"orbit":{const e=t.x-a,n=t.y-s,r=Math.sqrt(e*e+n*n);if(r>0){const o=Math.atan2(n,e)+.02*i;t.x=a+Math.cos(o)*r,t.y=s+Math.sin(o)*r}break}}e.customUpdate&&e.customUpdate(t,i,a,s)}}}};const Co={};function Io(e){return Co[e]?Co[e]:Ao.getPluginBehavior(e)||null}function zo(e,t){const i=Io(t);return i&&i.initialize?(i.initialize(e),!0):"ambient"!==t&&zo(e,"ambient")}function Fo(e,t,i,a,s){const n=Io(t);return!(!n||!n.update||(n.update(e,i,a,s),0))}function Do(){return[...Object.values(Co).map(e=>({name:e.name,emoji:e.emoji||"üéØ",description:e.description||"No description",type:"core"})),...Ao.getAllPluginBehaviors().map(e=>{const t=Ao.getPluginBehavior(e);return{name:t.name,emoji:t.emoji||"üîå",description:t.description||"Plugin behavior",type:"plugin"}})]}[eo,So,xo,io,ao,no,ro,oo,lo,ho,co,uo,po,go,yo,fo,bo,wo,vo,Mo,ko].forEach(e=>{Co[e.name]=e}),"undefined"!=typeof window&&window.DEBUG_PARTICLES&&(window.ParticleBehaviors={registry:Co,list:Do,get:Io});var qo={BEHAVIOR_REGISTRY:Co,getBehavior:Io,initializeBehavior:zo,updateBehavior:Fo,listBehaviors:Do,pluginAdapter:Ao},Ro=Object.freeze({__proto__:null,BEHAVIOR_REGISTRY:Co,default:qo,getBehavior:Io,initializeBehavior:zo,listBehaviors:Do,pluginAdapter:Ao,updateBehavior:Fo});class Bo{constructor(){this.listeners=new Map,this.groups=new Map,this.stats={registered:0,removed:0,active:0}}addEventListener(e,t,i,a={},s="default"){const n=this.generateId(),r={id:n,target:e,eventType:t,handler:i,options:a,group:s,active:!0};return this.listeners.set(n,r),this.groups.has(s)||this.groups.set(s,new Set),this.groups.get(s).add(n),e.addEventListener(t,i,a),this.stats.registered++,this.stats.active++,n}removeEventListener(e){const t=this.listeners.get(e);if(!t||!t.active)return!1;t.target.removeEventListener(t.eventType,t.handler,t.options),t.active=!1;const i=this.groups.get(t.group);return i&&(i.delete(e),0===i.size&&this.groups.delete(t.group)),this.listeners.delete(e),this.stats.removed++,this.stats.active--,!0}removeGroup(e){const t=this.groups.get(e);if(!t)return 0;let i=0;for(const e of t)this.removeEventListener(e)&&i++;return i}removeAllForTarget(e){let t=0;for(const[i,a]of this.listeners.entries())a.target===e&&a.active&&this.removeEventListener(i)&&t++;return t}removeAllOfType(e){let t=0;for(const[i,a]of this.listeners.entries())a.eventType===e&&a.active&&this.removeEventListener(i)&&t++;return t}removeAll(){let e=0;for(const[t,i]of this.listeners.entries())i.active&&this.removeEventListener(t)&&e++;return e}createAutoRemove(e,t,i,a={}){const s=this.addEventListener(e,t,i,a);return{id:s,remove:()=>this.removeEventListener(s)}}once(e,t,i,a={}){const s=this.addEventListener(e,t,e=>{i(e),this.removeEventListener(s)},a);return s}debounced(e,t,i,a=250,s={}){let n;return this.addEventListener(e,t,e=>{clearTimeout(n),n=setTimeout(()=>i(e),a)},s)}throttled(e,t,i,a=100,s={}){let n=!1;return this.addEventListener(e,t,e=>{n||(i(e),n=!0,setTimeout(()=>{n=!1},a))},s)}generateId(){return`listener_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getStats(){return{...this.stats,groups:this.groups.size,listeners:this.listeners.size}}getActiveListeners(){const e=[];for(const[t,i]of this.listeners.entries())i.active&&e.push({id:t,eventType:i.eventType,group:i.group,target:i.target.constructor.name});return e}analyzeLeaks(){const e={totalListeners:this.listeners.size,activeListeners:this.stats.active,inactiveButNotRemoved:0,byTarget:new Map,byType:new Map,potentialLeaks:[]};for(const[t,i]of this.listeners.entries()){const a=i.target.constructor.name;e.byTarget.set(a,(e.byTarget.get(a)||0)+1),e.byType.set(i.eventType,(e.byType.get(i.eventType)||0)+1),i.active||(e.inactiveButNotRemoved++,e.potentialLeaks.push({id:t,eventType:i.eventType,target:a}))}return e.byTarget=Object.fromEntries(e.byTarget),e.byType=Object.fromEntries(e.byType),e}cleanup(){let e=0;for(const[t,i]of this.listeners.entries())i.active||(this.listeners.delete(t),e++);return e}destroy(){const e=this.removeAll();return this.listeners.clear(),this.groups.clear(),this.stats={registered:0,removed:0,active:0},e}}const Eo=new Bo,Po={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4,TRACE:5},To=new class{constructor(e={}){this.config={enabled:!1!==e.enabled,level:e.level||Po.INFO,enableProfiling:!1!==e.enableProfiling,enableErrorTracking:!1!==e.enableErrorTracking,enableMemoryTracking:!1!==e.enableMemoryTracking,maxLogEntries:e.maxLogEntries||1e3,maxProfileEntries:e.maxProfileEntries||500,...e},this.logs=[],this.errors=[],this.profiles=new Map,this.memorySnapshots=[],this.frameTimings=[],this.maxFrameTimings=120,this.errorCounts=new Map,this.lastErrors=new Map,this.capabilities={performance:"undefined"!=typeof performance&&performance.now,memory:"undefined"!=typeof performance&&performance.memory,console:"undefined"!=typeof console,stackTrace:"undefined"!=typeof Error},this.startTime=this.now(),this.setupErrorHandling(),this.config.enabled&&this.log("DEBUG","EmotiveDebugger initialized",{config:this.config,capabilities:this.capabilities})}now(){return this.capabilities.performance?performance.now():Date.now()-this.startTime}setupErrorHandling(){this.config.enableErrorTracking&&"undefined"!=typeof window&&(window.addEventListener("error",e=>{this.trackError("UNHANDLED_ERROR",e.error||new Error(e.message),{filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.trackError("UNHANDLED_REJECTION",e.reason,{promise:e.promise})}))}log(e,t,i=null){if(!this.config.enabled)return;if((Po[e]||Po.INFO)>this.config.level)return;const a=this.now(),s={timestamp:a,level:e,message:t,data:i,stackTrace:this.getStackTrace()};if(this.logs.push(s),this.logs.length>this.config.maxLogEntries&&this.logs.shift(),this.capabilities.console){const s=this.getConsoleMethod(e),n=`[${(a/1e3).toFixed(3)}s]`;i?s(`${n} [${e}] ${t}`,i):s(`${n} [${e}] ${t}`)}}getConsoleMethod(e){return(()=>{}).bind(console)}getStackTrace(){if(!this.capabilities.stackTrace)return null;try{throw new Error}catch(e){return e.stack}}trackError(e,t,i={}){if(!this.config.enableErrorTracking)return;const a={timestamp:this.now(),type:e,message:t.message||String(t),stack:t.stack,context:i,count:1},s=`${e}:${t.message}`;this.errorCounts.has(s)?(this.errorCounts.set(s,this.errorCounts.get(s)+1),a.count=this.errorCounts.get(s)):this.errorCounts.set(s,1),this.errors.push(a),this.lastErrors.set(e,a),this.log("ERROR",`${e}: ${t.message}`,{error:a,context:i})}startProfile(e,t={}){if(!this.config.enableProfiling)return;const i={name:e,startTime:this.now(),metadata:t,samples:[],isActive:!0};this.profiles.set(e,i),this.log("TRACE",`Started profiling: ${e}`,t)}profileSample(e,t,i=null){if(!this.config.enableProfiling)return;const a=this.profiles.get(e);if(!a||!a.isActive)return;const s={timestamp:this.now(),label:t,data:i,relativeTime:this.now()-a.startTime};a.samples.push(s)}endProfile(e){if(!this.config.enableProfiling)return null;const t=this.profiles.get(e);if(!t||!t.isActive)return null;if(t.endTime=this.now(),t.duration=t.endTime-t.startTime,t.isActive=!1,t.stats=this.calculateProfileStats(t),this.log("TRACE",`Ended profiling: ${e}`,{duration:t.duration,samples:t.samples.length,stats:t.stats}),this.profiles.size>this.config.maxProfileEntries){const e=this.profiles.keys().next().value;this.profiles.delete(e)}return{...t}}calculateProfileStats(e){if(0===e.samples.length)return{sampleCount:0};const t=[];for(let i=1;i<e.samples.length;i++)t.push(e.samples[i].relativeTime-e.samples[i-1].relativeTime);if(0===t.length)return{sampleCount:e.samples.length};const i=t.reduce((e,t)=>e+t,0)/t.length,a=Math.min(...t),s=Math.max(...t);return{sampleCount:e.samples.length,avgSampleDuration:i,minSampleDuration:a,maxSampleDuration:s,totalDuration:e.duration}}trackFrameTiming(e){this.config.enableProfiling&&(this.frameTimings.push({timestamp:this.now(),frameTime:e,fps:1e3/e}),this.frameTimings.length>this.maxFrameTimings&&this.frameTimings.shift())}takeMemorySnapshot(e="snapshot"){if(!this.config.enableMemoryTracking||!this.capabilities.memory)return;const t={timestamp:this.now(),label:e,memory:{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit}};this.memorySnapshots.push(t),this.memorySnapshots.length>100&&this.memorySnapshots.shift(),this.log("DEBUG",`Memory snapshot: ${e}`,t.memory)}getDebugReport(){return{timestamp:this.now(),uptime:this.now()-0,config:this.config,capabilities:this.capabilities,logCount:this.logs.length,recentLogs:this.logs.slice(-10),errorCount:this.errors.length,uniqueErrors:this.errorCounts.size,recentErrors:this.errors.slice(-5),errorCounts:Object.fromEntries(this.errorCounts),activeProfiles:Array.from(this.profiles.values()).filter(e=>e.isActive).length,completedProfiles:Array.from(this.profiles.values()).filter(e=>!e.isActive).length,frameTimings:this.getFrameTimingStats(),memorySnapshots:this.memorySnapshots.slice(-5)}}getFrameTimingStats(){if(0===this.frameTimings.length)return{sampleCount:0};const e=this.frameTimings.map(e=>e.frameTime),t=this.frameTimings.map(e=>e.fps);return{sampleCount:this.frameTimings.length,avgFrameTime:e.reduce((e,t)=>e+t,0)/e.length,minFrameTime:Math.min(...e),maxFrameTime:Math.max(...e),avgFPS:t.reduce((e,t)=>e+t,0)/t.length,minFPS:Math.min(...t),maxFPS:Math.max(...t)}}exportDebugData(){return{metadata:{exportTime:Date.now(),debuggerUptime:this.now(),config:this.config,capabilities:this.capabilities},logs:[...this.logs],errors:[...this.errors],profiles:Object.fromEntries(this.profiles),frameTimings:[...this.frameTimings],memorySnapshots:[...this.memorySnapshots],errorCounts:Object.fromEntries(this.errorCounts)}}clear(){this.logs=[],this.errors=[],this.profiles.clear(),this.frameTimings=[],this.memorySnapshots=[],this.errorCounts.clear(),this.lastErrors.clear(),this.log("INFO","Debug data cleared")}destroy(){this.clear(),this.config.enabled=!1}}({enabled:"undefined"!=typeof window&&window.location&&window.location.search.includes("debug=true"),level:Po.INFO}),jo=new class{constructor(){this.capabilities=this.detectCapabilities(),this.performance=this.measurePerformance()}detectCapabilities(){return{es6:this.detectES6(),es2017:this.detectES2017(),modules:this.detectModules(),webGL:this.detectWebGL(),webGL2:this.detectWebGL2(),webWorkers:this.detectWebWorkers(),serviceWorkers:this.detectServiceWorkers(),performanceObserver:this.detectPerformanceObserver(),intersectionObserver:this.detectIntersectionObserver(),resizeObserver:this.detectResizeObserver(),localStorage:this.detectLocalStorage(),sessionStorage:this.detectSessionStorage(),indexedDB:this.detectIndexedDB(),fetch:this.detectFetch(),webSockets:this.detectWebSockets(),touchEvents:this.detectTouchEvents(),pointerEvents:this.detectPointerEvents(),deviceOrientation:this.detectDeviceOrientation(),canvas2d:this.detectCanvas2D(),canvasFilters:this.detectCanvasFilters(),offscreenCanvas:this.detectOffscreenCanvas()}}detectES6(){try{return"undefined"!=typeof Symbol&&"undefined"!=typeof Promise&&"undefined"!=typeof Map&&"undefined"!=typeof Set}catch{return!1}}detectES2017(){try{return"undefined"!=typeof async||function(){try{return"function"==typeof async function(){}.constructor}catch{return!1}}()}catch{return!1}}detectModules(){try{return"undefined"!=typeof document&&"noModule"in document.createElement("script")}catch{return!1}}detectWebGL(){try{const e=document.createElement("canvas");return!(!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch{return!1}}detectWebGL2(){try{return!!document.createElement("canvas").getContext("webgl2")}catch{return!1}}detectWebWorkers(){return"undefined"!=typeof Worker}detectServiceWorkers(){return"serviceWorker"in navigator}detectPerformanceObserver(){return"undefined"!=typeof PerformanceObserver}detectIntersectionObserver(){return"undefined"!=typeof IntersectionObserver}detectResizeObserver(){return"undefined"!=typeof ResizeObserver}detectLocalStorage(){try{return"undefined"!=typeof localStorage&&null!==localStorage}catch{return!1}}detectSessionStorage(){try{return"undefined"!=typeof sessionStorage&&null!==sessionStorage}catch{return!1}}detectIndexedDB(){return"undefined"!=typeof indexedDB}detectFetch(){return"undefined"!=typeof fetch}detectWebSockets(){return"undefined"!=typeof WebSocket}detectTouchEvents(){return"ontouchstart"in window||navigator.maxTouchPoints>0}detectPointerEvents(){return"undefined"!=typeof PointerEvent}detectDeviceOrientation(){return"ondeviceorientation"in window}detectCanvas2D(){try{return!!document.createElement("canvas").getContext("2d")}catch{return!1}}detectCanvasFilters(){try{return"filter"in document.createElement("canvas").getContext("2d")}catch{return!1}}detectOffscreenCanvas(){return"undefined"!=typeof OffscreenCanvas}measurePerformance(){const e={},t=performance.now();e.jsExecutionSpeed=performance.now()-t;try{const t=document.createElement("canvas");t.width=100,t.height=100;const i=t.getContext("2d"),a=performance.now();for(let e=0;e<1e3;e++)i.fillRect(100*Math.random(),100*Math.random(),10,10);e.canvasPerformance=performance.now()-a}catch{e.canvasPerformance=null}return e}getCapabilities(){return{...this.capabilities}}getPerformance(){return{...this.performance}}generateReport(){const e=Object.entries(this.capabilities).filter(([,e])=>e).map(([e])=>e),t=Object.entries(this.capabilities).filter(([,e])=>!e).map(([e])=>e),i=e.length/Object.keys(this.capabilities).length*100;return{timestamp:Date.now(),userAgent:navigator.userAgent,supportedFeatures:e,unsupportedFeatures:t,supportPercentage:Math.round(i),performance:this.performance,recommendations:this.generateRecommendations(i)}}generateRecommendations(e){const t=[];return e<50&&t.push("Consider using the minimal build for better compatibility"),this.capabilities.webGL||t.push("WebGL not supported - advanced graphics features unavailable"),this.capabilities.webWorkers||t.push("Web Workers not supported - background processing unavailable"),this.capabilities.fetch||t.push("Fetch API not supported - consider using XMLHttpRequest polyfill"),this.performance.jsExecutionSpeed>50&&t.push("Slow JavaScript execution detected - consider performance optimizations"),this.performance.canvasPerformance>100&&t.push("Slow canvas performance detected - consider reducing visual complexity"),t}};class Vo{constructor(e){this.canvas=e,this.ctx=e.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),this.dpr=window.devicePixelRatio||1,this.width=0,this.height=0,this.centerX=0,this.centerY=0,this.renderSize=null,this.resizeCallbacks=[],this.handleResize=this.handleResize.bind(this),window.addEventListener("resize",this.handleResize),this.resize()}resize(){if(this.renderSize&&this.renderSize.width&&this.renderSize.height)this.width=this.renderSize.width,this.height=this.renderSize.height,this.canvas.width=this.width,this.canvas.height=this.height;else if(this.canvas.hasAttribute("width")&&this.canvas.hasAttribute("height")){const e=parseInt(this.canvas.getAttribute("width"),10),t=parseInt(this.canvas.getAttribute("height"),10),i=this.canvas.getBoundingClientRect(),a=i.width,s=i.height;e>1.5*a||t>1.5*s?(this.width=a,this.height=s,this.canvas.width=e,this.canvas.height=t,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.dpr,this.dpr)):(this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t)}else{const e=this.canvas.getBoundingClientRect();this.width=e.width,this.height=e.height,this.canvas.width=this.width*this.dpr,this.canvas.height=this.height*this.dpr,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.dpr,this.dpr)}this.centerX=this.width/2,this.centerY=this.height/2,this.resizeCallbacks.forEach(e=>{try{e(this.width,this.height,this.dpr)}catch{}})}onResize(e){"function"==typeof e&&this.resizeCallbacks.push(e)}handleResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.renderSize&&this.renderSize.width&&this.renderSize.height||this.resize()},100)}setRenderSize(e,t){this.renderSize={width:e,height:t},this.resize()}clear(){this.ctx.clearRect(0,0,this.width,this.height)}getCenter(){return{x:this.centerX,y:this.centerY}}setTransform(e=0,t=0,i=1,a=0){this.ctx.save(),this.ctx.translate(e,t),this.ctx.rotate(a),this.ctx.scale(i,i)}restoreTransform(){this.ctx.restore()}getContext(){return this.ctx}getDimensions(){return{width:this.width,height:this.height}}destroy(){window.removeEventListener("resize",this.handleResize),clearTimeout(this.resizeTimeout),this.ctx&&(this.ctx.clearRect(0,0,this.width,this.height),this.ctx=null),this.canvas&&(this.canvas.width=0,this.canvas.height=0,this.canvas=null),this.resizeCallbacks=[],this.resizeTimeout=null}}function $o(e){return 3===(e=e.replace("#","")).length&&(e=e.split("").map(e=>e+e).join("")),{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16)}}function Wo(e,t,i){const a=e=>{const t=Math.round(Math.max(0,Math.min(255,e))).toString(16);return 1===t.length?`0${t}`:t};return`#${a(e)}${a(t)}${a(i)}`}function Go(e,t,i){e/=255,t/=255,i/=255;const a=Math.max(e,t,i),s=Math.min(e,t,i),n=(a+s)/2;let r,o;if(a===s)r=o=0;else{const l=a-s;switch(o=n>.5?l/(2-a-s):l/(a+s),a){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return{h:360*r,s:100*o,l:100*n}}function Lo(e,t,i){e/=360,i/=100;const a=(e,t,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e);let s,n,r;if(0==(t/=100))s=n=r=i;else{const o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;s=a(l,o,e+1/3),n=a(l,o,e),r=a(l,o,e-1/3)}return{r:Math.round(255*s),g:Math.round(255*n),b:Math.round(255*r)}}function _o(e,t,i){const a=$o(e),s=$o(t),n=Go(a.r,a.g,a.b),r=Go(s.r,s.g,s.b),o=n.h;let l=r.h;const h=l-o;h>180?l-=360:h<-180&&(l+=360);const c=Lo(((o+(l-o)*i)%360+360)%360,n.s+(r.s-n.s)*i,n.l+(r.l-n.l)*i);return Wo(c.r,c.g,c.b)}const Ho={intense:1.6,confident:1.3,nervous:1.15,clear:1,tired:.8,subdued:.5};function Uo(e,t){if(!t||"clear"===t)return e;const i=Ho[t.toLowerCase()];return i&&1!==i?function(e,t){const i=$o(e),a=Go(i.r,i.g,i.b);a.s=Math.max(0,Math.min(100,a.s*t));const s=Lo(a.h,a.s,a.l);return Wo(s.r,s.g,s.b)}(e,i):e}function Qo(e){return e}function Yo(e){return e*(2-e)}function Xo(e){return e*e}function No(e){return e<.5?2*e*e:(4-2*e)*e-1}function Jo(e){return 1-Math.pow(1-e,3)}function Zo(e){return e*e*e}function Ko(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function el(e){const t=2*Math.PI/3;return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1}function tl(e){const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375}function il(e){const t=2.5949095;return e<.5?Math.pow(2*e,2)*(7.189819*e-t)/2:(Math.pow(2*e-2,2)*((t+1)*(2*e-2)+t)+2)/2}function al(e){return Math.sin(e*Math.PI/2)}function sl(e){return-(Math.cos(Math.PI*e)-1)/2}function nl(e,t,i,a="linear"){return t+(i-t)*("string"==typeof a?{linear:Qo,easeOutQuad:Yo,easeInQuad:Xo,easeInOutQuad:No,easeOutCubic:Jo,easeInCubic:Zo,easeInOutCubic:Ko,easeOutElastic:el,easeOutBounce:tl,easeInOutBack:il,easeOutSine:al,easeInOutSine:sl}[a]||Qo:a)(Math.max(0,Math.min(1,e)))}Object.fromEntries(Object.entries({neutral:"#B0B0B0",joy:"#FFD700",sadness:"#4169E1",anger:"#DC143C",fear:"#8B008B",surprise:"#FF8C00",disgust:"#9ACD32",love:"#FF69B4"}).map(([e,t])=>{const i=$o(t);return[e,`${i.r}, ${i.g}, ${i.b}`]}));const rl=new class{constructor(){this.emotionCache=new Map,this.visualParamsCache=new Map,this.modifiersCache=new Map,this.transitionCache=new Map,this.stats={hits:0,misses:0,loadTime:0,cacheSize:0},this.isInitialized=!1,this.loadStartTime=0,this.initialize()}initialize(){this.loadStartTime=performance.now();try{const e=d();e.forEach(e=>{this.cacheEmotion(e)}),this.cacheCommonTransitions(e),this.isInitialized=!0,this.stats.loadTime=performance.now()-this.loadStartTime,this.stats.cacheSize=this.emotionCache.size}catch(e){this.isInitialized=!1}}cacheEmotion(e){try{const t=h(e);t&&this.emotionCache.set(e,t);const i=c(e);this.visualParamsCache.set(e,i);const a=u(e);this.modifiersCache.set(e,a)}catch(e){}}cacheCommonTransitions(e){[["neutral","joy"],["neutral","sadness"],["neutral","anger"],["joy","sadness"],["sadness","joy"],["anger","calm"],["calm","anger"]].forEach(([t,i])=>{if(e.includes(t)&&e.includes(i))try{const e=y(t,i),a=`${t}->${i}`;this.transitionCache.set(a,e)}catch(e){}})}getEmotion(e){if(!this.isInitialized)return h(e);const t=this.emotionCache.get(e);return t?(this.stats.hits++,t):(this.stats.misses++,h(e))}getVisualParams(e){if(!this.isInitialized)return c(e);const t=this.visualParamsCache.get(e);return t?(this.stats.hits++,t):(this.stats.misses++,c(e))}getModifiers(e){if(!this.isInitialized)return u(e);const t=this.modifiersCache.get(e);return t?(this.stats.hits++,t):(this.stats.misses++,u(e))}getTransitionParams(e,t){if(!this.isInitialized)return y(e,t);const i=`${e}->${t}`,a=this.transitionCache.get(i);return a?(this.stats.hits++,a):(this.stats.misses++,y(e,t))}hasEmotion(e){return this.emotionCache.has(e)}getStats(){const e=this.stats.hits+this.stats.misses,t=e>0?(this.stats.hits/e*100).toFixed(2):0;return{isInitialized:this.isInitialized,loadTime:this.stats.loadTime,cacheSize:this.stats.cacheSize,hits:this.stats.hits,misses:this.stats.misses,hitRate:`${t}%`,emotions:this.emotionCache.size,visualParams:this.visualParamsCache.size,modifiers:this.modifiersCache.size,transitions:this.transitionCache.size}}clear(){this.emotionCache.clear(),this.visualParamsCache.clear(),this.modifiersCache.clear(),this.transitionCache.clear(),this.isInitialized=!1,this.stats={hits:0,misses:0,loadTime:0,cacheSize:0}}reinitialize(){this.clear(),this.initialize()}};class ol{constructor(e){this.errorBoundary=e,this.state={emotion:"neutral",undertone:null,intensity:1,gesture:null,speaking:!1,audioLevel:0},this.slots=[],this.maxSlots=3,this.u=null,this.p=null,this.m=0,this.v=new Set(["anger","fear","sadness","disgust","suspicion"]),this.transitions={emotional:{current:"neutral",target:null,progress:0,duration:500,startTime:0,isActive:!1},intensity:{from:1,to:1,progress:1,duration:500,startTime:0,isActive:!1},undertone:{current:null,target:null,progress:0,duration:300,startTime:0,isActive:!1,currentWeight:0,targetWeight:0}},this.interpolationCache={lastUpdate:0,cacheInterval:100,cachedProperties:null,cachedRenderState:null},this.initializeEmotionalStates(),this.initializeUndertoneModifiers()}initializeEmotionalStates(){this.emotionalStates=this.loadEmotionalStatesFromCache()}loadEmotionalStatesFromCache(){const e={};return["neutral","joy","sadness","anger","fear","surprise","disgust","love","suspicion","excited","resting","euphoria","focused","glitch","calm"].forEach(t=>{const i=rl.getVisualParams(t);i&&(e[t]={primaryColor:i.primaryColor||"#B0B0B0",glowIntensity:i.glowIntensity||.7,particleRate:i.particleRate||1,minParticles:i.minParticles||3,maxParticles:i.maxParticles||4,particleBehavior:i.particleBehavior||"ambient",coreSize:i.coreSize||1,breathRate:i.breathRate||1,breathDepth:i.breathDepth||.1})}),e}initializeUndertoneModifiers(){this.undertoneModifiers={nervous:{jitterAmount:.3,breathRateMultiplier:1.2,glowIntensityMultiplier:.9,particleRateMultiplier:1.1},confident:{coreSizeMultiplier:1.1,glowIntensityMultiplier:1.2,breathRateMultiplier:.9,particleRateMultiplier:1},tired:{breathRateMultiplier:.7,particleRateMultiplier:.5,glowIntensityMultiplier:.8,coreSizeMultiplier:.95},intense:{amplificationFactor:1.3},subdued:{dampeningFactor:.7}}}setEmotion(e,t=null,i=500){return this.errorBoundary.wrap(()=>{let a=null,s=1;if("string"==typeof t?a=t:t&&"object"==typeof t&&(a=t.undertone??null,i=t.duration??i,s=t.intensity??1),this.interpolationCache.cachedProperties=null,this.interpolationCache.cachedRenderState=null,!g(e)&&!{}.hasOwnProperty.call(this.emotionalStates,e)){const t=[...Object.keys(this.emotionalStates),...d()],i=[...new Set(t)];throw new Error(`Invalid emotion: ${e}. Valid emotions: ${i.join(", ")}`)}if(null!==a&&!{}.hasOwnProperty.call(this.undertoneModifiers,a))throw new Error(`Invalid undertone: ${a}. Valid undertones: ${Object.keys(this.undertoneModifiers).join(", ")}`);return s=Math.max(0,Math.min(1,s)),this.slots=[{emotion:e,intensity:s}],this.p=e,this.state.emotion===e&&this.state.undertone===a&&this.state.intensity===s||(this.state.emotion!==e&&(i>0?(this.transitions.emotional={current:this.state.emotion,target:e,progress:0,duration:Math.max(100,i),startTime:performance.now(),isActive:!0},void 0!==this.M&&(this.M=0)):this.transitions.emotional={current:e,target:null,progress:1,duration:0,startTime:performance.now(),isActive:!1},this.state.emotion=e),this.state.intensity!==s&&(this.transitions.intensity={from:this.state.intensity,to:s,progress:0,duration:Math.max(100,i),startTime:performance.now(),isActive:!0},this.state.intensity=s),this.state.undertone!==a&&(this.transitions.undertone={current:this.state.undertone,target:a,progress:0,duration:300,startTime:performance.now(),isActive:!0,currentWeight:this.state.undertone?1:0,targetWeight:a?1:0},this.state.undertone=a)),!0},"emotion-setting",!1)()}setEventCallback(e){this.u=e}S(e,t){this.u&&this.u(e,t)}k(){const e=this.getDominant(),t=e?e.emotion:null,i=this.p;t!==i&&(this.p=t,this.S("dominantChanged",{previous:i,current:t,intensity:e?e.intensity:0}))}setEmotionDampening(e){this.m=Math.max(0,Math.min(1,e))}getEmotionDampening(){return this.m}setNegativeEmotions(e){this.v=new Set(e)}pushEmotion(e,t=.5){return this.errorBoundary.wrap(()=>{if(!g(e)&&!{}.hasOwnProperty.call(this.emotionalStates,e))return!1;t=Math.max(0,Math.min(1,t)),this.interpolationCache.cachedProperties=null;const i=this.slots.find(t=>t.emotion===e);if(i){const a=i.intensity;i.intensity=Math.min(1,i.intensity+t),this.S("slotChanged",{emotion:e,intensity:i.intensity,action:"push"}),i.intensity>=1&&a<1&&this.S("emotionPeaked",{emotion:e,intensity:i.intensity})}else if(this.slots.length<this.maxSlots)this.slots.push({emotion:e,intensity:t}),this.S("slotChanged",{emotion:e,intensity:t,action:"push"}),t>=1&&this.S("emotionPeaked",{emotion:e,intensity:t});else{let i=0;for(let e=1;e<this.slots.length;e++)this.slots[e].intensity<this.slots[i].intensity&&(i=e);const a=this.slots[i];this.S("slotChanged",{emotion:a.emotion,intensity:0,action:"replaced"}),this.slots[i]={emotion:e,intensity:t},this.S("slotChanged",{emotion:e,intensity:t,action:"push"})}return this.O(),this.k(),!0},"push-emotion",!1)()}nudgeEmotion(e,t,i=1){t>0&&this.m>0&&this.v.has(e)&&(t*=1-this.m),this.interpolationCache.cachedProperties=null;const a=this.slots.find(t=>t.emotion===e);if(a){const s=a.intensity;a.intensity=Math.max(0,Math.min(i,a.intensity+t)),a.intensity<=0?(this.slots=this.slots.filter(e=>e!==a),this.S("slotChanged",{emotion:e,intensity:0,action:"removed"})):(this.S("slotChanged",{emotion:e,intensity:a.intensity,action:"nudge"}),a.intensity>=i&&s<i&&this.S("emotionPeaked",{emotion:e,intensity:a.intensity}))}else if(t>0)return void this.pushEmotion(e,Math.min(i,t));this.O(),this.k()}clearEmotions(){const e=this.slots.length>0;this.slots=[],this.interpolationCache.cachedProperties=null,this.state.emotion="neutral",this.state.intensity=1,e&&(this.S("slotChanged",{emotion:null,intensity:0,action:"cleared"}),this.p=null,this.S("dominantChanged",{previous:this.p,current:null,intensity:0}))}getSlots(){return this.slots}pruneEmptySlots(){const e=this.slots.length,t=this.slots.filter(e=>e.intensity<=0);if(this.slots=this.slots.filter(e=>e.intensity>0),this.slots.length!==e){this.interpolationCache.cachedProperties=null;for(const e of t)this.S("emotionDecayed",{emotion:e.emotion,intensity:0,removed:!0});this.O(),this.k()}}getDominant(){return this.slots.length?this.slots.reduce((e,t)=>t.intensity>e.intensity?t:e):null}getUndercurrents(){const e=this.getDominant();return e?this.slots.filter(t=>t!==e):[]}getEmotionalState(){const e=this.getDominant();return{dominant:e?{...e}:null,undercurrents:this.getUndercurrents().map(e=>({...e})),slots:this.slots.map(e=>({...e}))}}getCurrentRhythmModifiers(){return this.slots.length>0?w(this.slots):w([{emotion:this.state.emotion,intensity:this.state.intensity}])}O(){const e=this.getDominant();e?(this.state.emotion!==e.emotion&&(this.transitions.emotional={current:this.state.emotion,target:e.emotion,progress:0,duration:300,startTime:performance.now(),isActive:!0},this.state.emotion=e.emotion),this.state.intensity=e.intensity):(this.state.emotion="neutral",this.state.intensity=1)}applyUndertone(e,t){if(!t||!{}.hasOwnProperty.call(this.undertoneModifiers,t))return{...e};const i=this.undertoneModifiers[t],a={...e};if(void 0!==i.glowIntensityMultiplier&&(a.glowIntensity*=i.glowIntensityMultiplier),void 0!==i.breathRateMultiplier&&(a.breathRate*=i.breathRateMultiplier),void 0!==i.particleRateMultiplier&&(a.particleRate=Math.round(a.particleRate*i.particleRateMultiplier)),void 0!==i.coreSizeMultiplier&&(a.coreSize*=i.coreSizeMultiplier),void 0!==i.amplificationFactor){const e=i.amplificationFactor;a.glowIntensity*=e,a.breathRate*=e,a.particleRate=Math.round(a.particleRate*e),a.coreSize*=e}if(void 0!==i.dampeningFactor){const e=i.dampeningFactor;a.glowIntensity*=e,a.breathRate*=e,a.particleRate=Math.round(a.particleRate*e),a.coreSize*=e}return void 0!==i.jitterAmount&&(a.jitterAmount=i.jitterAmount),a}update(e){this.errorBoundary.wrap(()=>{this.transitions.emotional.isActive&&this.updateEmotionalTransition(e),this.transitions.intensity.isActive&&this.updateIntensityTransition(e),this.transitions.undertone.isActive&&this.updateUndertoneTransition(e)},"state-machine-update")()}updateUndertoneTransition(e){const t=this.transitions.undertone,i=performance.now()-t.startTime,a=Math.min(i/t.duration,1),s=Ko(a);t.current&&t.target?(t.currentWeight=1-s,t.targetWeight=s):t.current&&!t.target?(t.currentWeight=1-s,t.targetWeight=0):!t.current&&t.target&&(t.currentWeight=0,t.targetWeight=s),t.progress=a,a>=1&&(t.isActive=!1,t.current=t.target,t.currentWeight=t.target?1:0,t.targetWeight=0)}updateIntensityTransition(e){const t=this.transitions.intensity,i=performance.now()-t.startTime;t.progress=Math.min(1,i/t.duration),t.progress>=1&&(t.isActive=!1,t.from=t.to,t.progress=1)}getEffectiveIntensity(){const e=this.transitions.intensity;if(!e.isActive)return this.state.intensity;const t=Ko(e.progress);return e.from+(e.to-e.from)*t}updateEmotionalTransition(e){const t=this.transitions.emotional;let i;void 0!==this.M?(this.M+=e,i=this.M):i=performance.now()-t.startTime,t.progress=Math.min(1,i/t.duration),t.progress>=1&&(t.isActive=!1,t.current=t.target,t.target=null,t.progress=1)}getCurrentEmotionalProperties(){return this.errorBoundary.wrap(()=>{const e=performance.now();if(this.interpolationCache.cachedProperties&&e-this.interpolationCache.lastUpdate<this.interpolationCache.cacheInterval)return this.interpolationCache.cachedProperties;let t;if(this.slots.length>1)t=this.A();else{const e=this.transitions.emotional;t=e.isActive&&e.target?this.interpolateEmotionalProperties(e.current,e.target,e.progress):{...this.emotionalStates[this.state.emotion]||this.emotionalStates.neutral};const i=this.getEffectiveIntensity();i<1&&(t.glowIntensity=this.C(.7,t.glowIntensity,i),t.particleRate=Math.round(this.C(1,t.particleRate,i)),t.breathRate=this.C(1,t.breathRate,i),t.breathDepth=t.breathDepth*i,t.coreSize=this.C(1,t.coreSize,i))}return t=this.applyUndertone(t,this.state.undertone),this.interpolationCache.cachedProperties=t,this.interpolationCache.lastUpdate=e,t},"emotional-properties",()=>this.emotionalStates.neutral)()}A(){const e=this.getDominant(),t=this.getUndercurrents(),i=this.emotionalStates[e.emotion]||this.emotionalStates.neutral,a={...i},s=e.intensity;a.glowIntensity=.75*this.C(.7,i.glowIntensity,s),a.particleRate=i.particleRate*s*.75,a.breathRate=.75*this.C(1,i.breathRate,s),a.breathDepth=i.breathDepth*s*.75,a.coreSize=.75*this.C(1,i.coreSize,s);const n=t.length>0?.25/t.length:0;for(const e of t){const t=this.emotionalStates[e.emotion]||this.emotionalStates.neutral,i=e.intensity;a.glowIntensity+=this.C(.7,t.glowIntensity,i)*n,a.particleRate+=t.particleRate*i*n,a.breathRate+=this.C(1,t.breathRate,i)*n,a.breathDepth+=t.breathDepth*i*n,a.coreSize+=this.C(1,t.coreSize,i)*n}if(a.particleRate=Math.round(a.particleRate),t.length>0){const e=this.slots.reduce((e,t)=>e+t.intensity,0);let s=i.primaryColor;for(const i of t){const t=this.emotionalStates[i.emotion]||this.emotionalStates.neutral,a=i.intensity/e;s=_o(s,t.primaryColor,a)}a.primaryColor=s}return a.particleBehavior=i.particleBehavior,a}C(e,t,i){return e+(t-e)*i}interpolateEmotionalProperties(e,t,i){const a=this.emotionalStates[e]||this.emotionalStates.neutral,s=this.emotionalStates[t]||this.emotionalStates.neutral,n=nl(i,0,1,"easeOutCubic");return{primaryColor:_o(a.primaryColor,s.primaryColor,n),glowIntensity:a.glowIntensity+(s.glowIntensity-a.glowIntensity)*n,particleRate:Math.round(a.particleRate+(s.particleRate-a.particleRate)*n),coreSize:a.coreSize+(s.coreSize-a.coreSize)*n,breathRate:a.breathRate+(s.breathRate-a.breathRate)*n,breathDepth:a.breathDepth+(s.breathDepth-a.breathDepth)*n,particleBehavior:n>.5?s.particleBehavior:a.particleBehavior}}getCurrentState(){return{emotion:this.state.emotion,undertone:this.state.undertone,intensity:this.state.intensity,isTransitioning:this.transitions.emotional.isActive,transitionProgress:this.transitions.emotional.progress,properties:this.getCurrentEmotionalProperties()}}applyUndertoneModifier(e){return this.errorBoundary.wrap(()=>{if(null!==e&&!{}.hasOwnProperty.call(this.undertoneModifiers,e))throw new Error(`Invalid undertone: ${e}. Valid undertones: ${Object.keys(this.undertoneModifiers).join(", ")}`);return this.state.undertone=e,!0},"undertone-application",!1)()}clearUndertone(){this.state.undertone=null}getUndertoneModifier(e){return this.errorBoundary.wrap(()=>{if(this.renderer&&this.renderer.undertoneModifiers&&this.renderer.undertoneModifiers[e])return{...this.renderer.undertoneModifiers[e]};if(!e||!{}.hasOwnProperty.call(this.undertoneModifiers,e))return null;const t={...this.undertoneModifiers[e]};return t.glowRadiusMult||(t.glowRadiusMult=1),t},"undertone-retrieval",null)()}getWeightedUndertoneModifiers(){const e=this.transitions.undertone;if(!e.isActive){if(this.state.undertone){const e=this.getUndertoneModifier(this.state.undertone);if(e)return{...e,weight:1,type:this.state.undertone}}return null}if(e.target){const t=this.getUndertoneModifier(e.target);if(t)return{...t,weight:e.targetWeight,type:e.target}}if(e.current&&e.currentWeight>0){const t=this.getUndertoneModifier(e.current);if(t)return{...t,weight:e.currentWeight,type:e.current}}return null}reset(e=500){this.slots=[],this.setEmotion("neutral",null,e)}isValidEmotion(e){return{}.hasOwnProperty.call(this.emotionalStates,e)}isValidUndertone(e){return null===e||{}.hasOwnProperty.call(this.undertoneModifiers,e)}getAvailableEmotions(){return Object.keys(this.emotionalStates)}getAvailableUndertones(){return Object.keys(this.undertoneModifiers)}isTransitioning(){return this.transitions.emotional.isActive}getTransitionProgress(){return this.transitions.emotional.isActive?this.transitions.emotional.progress:1}completeTransition(){this.transitions.emotional.isActive&&(this.transitions.emotional.progress=1,this.transitions.emotional.isActive=!1,this.transitions.emotional.current=this.transitions.emotional.target,this.transitions.emotional.target=null)}interpolateProperty(e,t,i,a="easeOutCubic"){return e+(t-e)*nl(i,0,1,a)}enableSimulatedTime(e=!0){e?this.M=0:delete this.M}}const ll=16.67,hl=3e4;let cl;"undefined"!=typeof window&&window.__emotiveRhythmEngine?cl=window.__emotiveRhythmEngine:(cl=new class{constructor(){this.bpm=120,this.timeSignature=[4,4],this.isPlaying=!1,this.startTime=0,this.currentBeat=0,this.currentBar=0,this.beatProgress=0,this.barProgress=0,this.beatDuration=6e4/this.bpm,this.barDuration=this.beatDuration*this.timeSignature[0],this.lastBeatTime=0,this.nextBeatTime=0,this.listeners=new Map,this.beatCallbacks=new Set,this.barCallbacks=new Set,this.subdivisions={sixteenth:0,eighth:0,triplet:0,swing:0},this.audioSync=null,this.syncOffset=0,this.autoSync=!1,this.intensity=1,this.groove=0,this.humanize=.05,this.patterns=new Map,this.currentPattern=null,this.initializePatterns()}initializePatterns(){this.patterns.set("4/4",{name:"4/4",description:"Common time - 4 beats per bar",timeSignature:[4,4],groove:0,accents:[1,.5,.7,.5]}),this.patterns.set("straight",{name:"straight",description:"Straight, even timing",groove:0,accents:[1,.5,.7,.5]}),this.patterns.set("swing",{name:"swing",description:"Swing/shuffle timing",groove:.67,accents:[1,.3,.8,.3]}),this.patterns.set("3/4",{name:"3/4",description:"Waltz time - 3 beats per bar",timeSignature:[3,4],accents:[1,.5,.5]}),this.patterns.set("waltz",{name:"waltz",description:"3/4 waltz timing",timeSignature:[3,4],accents:[1,.5,.5]}),this.patterns.set("6/8",{name:"6/8",description:"Compound duple time",timeSignature:[6,8],accents:[1,.3,.3,.7,.3,.3]}),this.patterns.set("5/4",{name:"5/4",description:"Complex meter - 5 beats per bar",timeSignature:[5,4],accents:[1,.5,.6,.5,.7]}),this.patterns.set("7/8",{name:"7/8",description:"Irregular meter",timeSignature:[7,8],accents:[1,.5,.5,.7,.5,.5,.6]}),this.patterns.set("dubstep",{name:"dubstep",description:"Dubstep half-time feel",accents:[.2,.2,1,.2],subdivisions:{wobble:!0}}),this.patterns.set("breakbeat",{name:"breakbeat",description:"Broken beat pattern",accents:[1,.2,.7,.9,.2,.8,.4,.2]})}start(){this.isPlaying||(this.isPlaying=!0,this.isRunning=!0,this.startTime=performance.now(),this.lastBeatTime=this.startTime,this.nextBeatTime=this.startTime+this.beatDuration,this.currentBeat=0,this.currentBar=0,this.emit("start",{bpm:this.bpm,timeSignature:this.timeSignature,pattern:this.currentPattern}),this.update())}stop(){this.isPlaying&&(this.isPlaying=!1,this.emit("stop",{totalBeats:this.currentBeat,totalBars:this.currentBar}))}update(){if(!this.isPlaying)return;const e=(performance.now()-this.startTime)/this.beatDuration,t=Math.floor(e);this.beatProgress=e%1,t>this.currentBeat&&this.onBeat(t);const i=Math.floor(t/this.timeSignature[0]);i>this.currentBar&&this.onBar(i),this.currentBeat=t,this.currentBar=i,this.barProgress=t%this.timeSignature[0]/this.timeSignature[0],this.updateSubdivisions(),this.emit("update",this.getTimeInfo()),this.isPlaying&&requestAnimationFrame(()=>this.update())}onBeat(e){const t=e%this.timeSignature[0],i=this.getAccent(t),a=this.humanize*(Math.random()-.5)*this.beatDuration,s={beat:e,beatInBar:t,bar:this.currentBar,accent:i,intensity:this.intensity*i,humanTiming:a,timestamp:performance.now()};this.emit("beat",s),this.beatCallbacks.forEach(e=>e(s)),this.lastBeatTime=performance.now(),this.nextBeatTime=this.lastBeatTime+this.beatDuration}onBar(e){const t={bar:e,timeSignature:this.timeSignature,pattern:this.currentPattern,timestamp:performance.now()};this.emit("bar",t),this.barCallbacks.forEach(e=>e(t))}updateSubdivisions(){if(this.subdivisions.sixteenth=4*this.beatProgress%1,this.subdivisions.eighth=2*this.beatProgress%1,this.subdivisions.triplet=3*this.beatProgress%1,this.groove>0){const e=.5+.17*this.groove;this.subdivisions.eighth<.5?this.subdivisions.swing=this.subdivisions.eighth/e:this.subdivisions.swing=.5+(this.subdivisions.eighth-.5)/(1-e)}else this.subdivisions.swing=this.subdivisions.eighth}getAccent(e){if(this.currentPattern&&this.patterns.has(this.currentPattern)){const t=this.patterns.get(this.currentPattern);if(t.accents&&void 0!==t.accents[e])return t.accents[e]}return 0===e?1:2===e&&4===this.timeSignature[0]?.7:.5}getTimeInfo(){return{elapsed:performance.now()-this.startTime,beat:this.currentBeat,bar:this.currentBar,beatInBar:this.currentBeat%this.timeSignature[0],beatProgress:this.beatProgress,barProgress:this.barProgress,subdivisions:{...this.subdivisions},bpm:this.bpm,beatDuration:this.beatDuration,timeSignature:[...this.timeSignature],intensity:this.intensity,groove:this.groove,pattern:this.currentPattern,nextBeatIn:this.nextBeatTime-performance.now(),accent:this.getAccent(this.currentBeat%this.timeSignature[0])}}setBPM(e){this.bpm=Math.max(20,Math.min(360,e)),this.beatDuration=6e4/this.bpm,this.barDuration=this.beatDuration*this.timeSignature[0],this.emit("tempoChange",{bpm:this.bpm})}setTimeSignature(e,t){this.timeSignature=[e,t],this.barDuration=this.beatDuration*e,this.emit("timeSignatureChange",{timeSignature:this.timeSignature})}setPattern(e){if(!this.patterns.has(e))return;const t=this.patterns.get(e);this.currentPattern=e,t.timeSignature&&this.setTimeSignature(...t.timeSignature),void 0!==t.groove&&(this.groove=t.groove),this.emit("patternChange",{pattern:e})}onBeatCallback(e){return this.beatCallbacks.add(e),()=>this.beatCallbacks.delete(e)}onBarCallback(e){return this.barCallbacks.add(e),()=>this.barCallbacks.delete(e)}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(e=>e(t))}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{this.listeners.has(e)&&this.listeners.get(e).delete(t)}}syncToAudio(e,t){this.audioSync={context:e,source:t}}getAdapter(){return{getTimeInfo:()=>this.getTimeInfo(),isOnBeat:(e=.1)=>this.beatProgress<e||this.beatProgress>1-e,isOnSubdivision:(e,t=.1)=>{const i=this.subdivisions[e]||0;return i<t||i>1-t},getBeatSync:(e=0,t=1,i="linear")=>{let a=this.beatProgress;switch(i){case"ease":a=.5-Math.cos(a*Math.PI)/2;break;case"bounce":a=Math.abs(Math.sin(a*Math.PI));break;case"pulse":a=Math.pow(Math.sin(a*Math.PI),2)}return e+(t-e)*a},getAccentedValue:(e,t=2)=>e*(1+(this.getAccent(this.currentBeat%this.timeSignature[0])-.5)*t),onBeat:e=>this.onBeatCallback(e),onBar:e=>this.onBarCallback(e),beatsToMs:e=>e*this.beatDuration,msToBeats:e=>e/this.beatDuration,isPlaying:()=>this.isPlaying,getBPM:()=>this.bpm,getPattern:()=>this.currentPattern}}},"undefined"!=typeof window&&(window.__emotiveRhythmEngine=cl));class ul{constructor(e,t={}){this.I=e,this.F={perfect:t.windows?.perfect??30,great:t.windows?.great??60,good:t.windows?.good??100},this.D={perfect:{multiplier:2,label:"Perfect"},great:{multiplier:1.5,label:"Great"},good:{multiplier:1,label:"Good"},miss:{multiplier:0,label:"Miss"}},this.q={multiplier:1},this.R=t.emotionSource??null,this.B=[],this.P=100,this.T=[],this.j=null,this.V=null}evaluate(e=performance.now()){const t=this.I.getTimeInfo(),{beatDuration:i}=t,a=performance.now()-t.elapsed,s=e-a,n=s-s%i,r=n+i,o=s-n<r-s?n:r,l=s-o;return this.$(l,e,o+a)}evaluateAgainst(e,t){return this.$(e-t,e,t)}evaluateSequence(e,t){const i=[],a=new Set;for(const s of e){let e=-1,n=1/0;for(let i=0;i<t.length;i++){if(a.has(i))continue;const r=Math.abs(s-t[i]);r<n&&(n=r,e=i)}e>=0?(a.add(e),i.push(this.evaluateAgainst(s,t[e]))):i.push({grade:"miss",offset:0,absOffset:0,multiplier:0,label:"Miss",timestamp:s,targetTime:null})}return i}$(e,t,i){const a=Math.abs(e),s=this.R?.()??{windowMultiplier:1},n=this.q.multiplier*(s.windowMultiplier||1);let r;r=a<=this.F.perfect*n?"perfect":a<=this.F.great*n?"great":a<=this.F.good*n?"good":"miss";const o={grade:r,offset:e,absOffset:a,multiplier:this.D[r].multiplier,label:this.D[r].label,timestamp:t,targetTime:i};this.B.push(o),this.B.length>this.P&&this.B.shift();for(const e of this.T)e(o);if(this.j&&this.V){const e=this.j[r];e&&this.V(e.emotion,e.delta)}return o}setWindowModifier(e){this.q.multiplier=Math.max(.3,Math.min(3,e))}setEmotionSource(e){this.R=e}getAccuracy(){if(!this.B.length)return{perfect:0,great:0,good:0,miss:0,averageOffset:0,total:0};const e={perfect:0,great:0,good:0,miss:0};let t=0;for(const i of this.B)e[i.grade]++,t+=i.offset;return{...e,averageOffset:t/this.B.length,total:this.B.length}}getHistory(){return[...this.B]}clearHistory(){this.B.length=0}onEvaluate(e){return this.T.push(e),()=>{this.T=this.T.filter(t=>t!==e)}}setEmotionFeedback(e){this.j=e||null}setEmotionTarget(e){this.V=e||null}setWindows(e){Object.assign(this.F,e)}setGrades(e){Object.assign(this.D,e)}destroy(){this.B.length=0,this.T.length=0}}const dl=new class{constructor(){this.enabled=!1,this.adapter=null,this.subsystemConfigs=new Map,this.activeModulations=new Map,this.W=null}initialize(){this.adapter=cl.getAdapter(),this.enabled=!0,this.adapter.onBeat(this.handleBeat.bind(this)),this.adapter.onBar(this.handleBar.bind(this))}updateBPM(e){if(e>=60&&e<=220){if(window.rhythmManuallyStoppedForCurrentAudio)return;if(!cl.isRunning)return this.start(e,"straight"),void(window.rhythmSyncVisualizer&&!window.rhythmSyncVisualizer.state.active&&window.rhythmSyncVisualizer.start());cl.setBPM(e)}}registerConfig(e,t,i){if(!i.rhythm||!i.rhythm.enabled)return;const a=`${e}:${t}`;this.subsystemConfigs.set(a,{type:e,name:t,rhythmConfig:i.rhythm,originalConfig:i})}applyGestureRhythm(e,t,i,a){if(!this.enabled||!e.rhythm?.enabled)return{};const s=e.rhythm,n={};if(s.amplitudeSync){const e=s.amplitudeSync,t=this.adapter.getBeatSync(e.offBeat||.8,e.onBeat||1.5,e.curve||"linear");n.amplitudeMultiplier=t}if(s.wobbleSync){const e=s.wobbleSync;this.adapter.isOnSubdivision(e.subdivision,.1)?n.wobbleMultiplier=1+e.intensity:n.wobbleMultiplier=1}if(s.accentResponse?.enabled){const e=this.adapter.getAccentedValue(1,s.accentResponse.multiplier||1.5);n.accentMultiplier=e}const r=this.adapter.getPattern();return r&&s.patternOverrides?.[r]&&Object.assign(n,s.patternOverrides[r]),n}applyParticleRhythm(e,t){if(!this.enabled||!e.rhythm?.enabled)return{};const i=this.adapter.getTimeInfo(),a=e.rhythm,s={};if(a.particleEmission){const e=a.particleEmission;"beat"===e.syncMode&&this.adapter.isOnBeat(.1)?s.emitBurst=e.burstSize||3:void 0!==e.offBeatRate&&(s.emissionRate=e.offBeatRate)}if(a.glowSync){const e=a.glowSync,t=this.adapter.getBeatSync(e.intensityRange[0]||1,e.intensityRange[1]||2,"pulse");s.glowIntensity=t}if("bars"===a.breathSync?.mode){const e=a.breathSync,t=i.bar%e.barsPerBreath/e.barsPerBreath;s.breathPhase=t*Math.PI*2}return s}applyBehaviorRhythm(e,t,i){if(!this.enabled||!e.rhythm?.enabled)return{};const a=this.adapter.getTimeInfo(),s=e.rhythm,n={};if(s.glitchTiming){const e=s.glitchTiming;if(this.adapter.isOnSubdivision(e.subdivision,.05)&&Math.random()<e.probability){const t=this.adapter.isOnBeat()?e.intensityOnBeat:e.intensityOffBeat;n.triggerGlitch=!0,n.glitchIntensity=t}}if(s.orbitRhythm){const e=s.orbitRhythm;"tempo"===e.baseSpeed&&(n.speedMultiplier=this.adapter.getBPM()/120),e.beatAcceleration&&this.adapter.isOnBeat(.1)&&(n.speedBoost=e.beatAcceleration),e.barReset&&0===a.beatInBar&&(n.resetOrbit=!0)}if(s.stutterSync){const e=s.stutterSync,t=this.adapter.getPattern();if(t&&e.patterns?.[t]){const i=e.patterns[t];i.freezeOnDrop&&2===a.beatInBar?(n.freeze=!0,n.freezeDuration=i.dropDuration):i.randomFreeze&&Math.random()<i.randomFreeze&&(n.freeze=!0,n.freezeDuration=i.duration)}}return n}handleBeat(e){this.lastBeatInfo=e}handleBar(e){this.lastBarInfo=e}getMusicalDuration(e,t){if(!this.enabled||!e?.durationSync)return t;const i=e.durationSync;return"bars"===i.mode?this.adapter.beatsToMs(4*i.bars):"beats"===i.mode?this.adapter.beatsToMs(i.beats):t}isEnabled(){return this.enabled&&this.adapter.isPlaying()}start(e=120,t="straight"){e&&cl.setBPM(e),t&&cl.setPattern(t),cl.start(),this.enabled=!0}stop(){cl.stop(),this.enabled=!1,this.bpmLocked=!1,this.lockedBPM=null}setPattern(e){cl.setPattern(e)}setBPM(e){cl.setBPM(e),this.bpmLocked&&(this.lockedBPM=e)}resampleBPM(){this.bpmLocked=!1,this.lockedBPM=null}setTimeSignature(e){this.timeSignature=e;const t=document.getElementById("time-sig-display");t&&(t.textContent=e),"3/4"===e&&cl.getPattern()}getInputEvaluator(e){return this.W||(this.adapter||this.initialize(),this.W=new ul(this.adapter,e)),this.W}syncToAudio(e,t){cl.syncToAudio(e,t)}};class pl{constructor(e,t,i="ambient",a=1,s=1,n=null){const r=Math.random();this.z=r<1/13?.5+.5*Math.random():.9*Math.random()-1;const o=this.z>0?(20+20*Math.random())*a:3*a,l=Math.random()*Math.PI*2;this.x=e+Math.cos(l)*o,this.y=t+Math.sin(l)*o,this.vx=0,this.vy=0,this.vz=0,this.life=0,this.maxLife=1,this.lifeDecay=.01,this.fadeInTime=.15,this.fadeOutTime=.3,this.isFadingOut=!1,this.age=0,this.scaleFactor=a,this.particleSizeMultiplier=s,this.size=(4+6*Math.random())*a*s,this.baseSize=this.size,this.emotionColors=n,this.color="#ffffff",this.opacity=1,this.hasGlow=Math.random()<.333,this.glowSizeMultiplier=this.hasGlow?1.33+.33*Math.random():0,this.isCellShaded=Math.random()<.333,this.baseOpacity=.3+.4*Math.random(),this.cachedColors=new Map,this.maxCachedColors=20,this.colorAccessOrder=[],this.lastColor=null,this.lastOpacity=-1,this.behavior=i,this.behaviorData={},this.gestureData={initialX:e,initialY:t},zo(this,i)}update(e,t,i,a=null,s=null,n=0,r=null){const o=Math.min(e,50)/ll,l=s&&s.type&&n>0&&Ur(s.type);this.y,l?this.applyGestureMotion(s,n,o,t,i):"falling"===this.gestureBehavior?Fo(this,"falling",o,t,i):"radiant"===this.gestureBehavior?Fo(this,"radiant",o,t,i):(Fo(this,this.behavior,o,t,i),s&&n>0&&this.applyGestureMotion(s,n,o,t,i));const h=this.rainData||"falling"===this.gestureBehavior||this.fallingData||this.gestureData?.rain,c=l||h;if(c||(this.x+=this.vx*o,this.y+=this.vy*o),!c){let e,a;if(r)e=r.width,a=r.height;else{const s=document.getElementById("card-mascot")||document.getElementById("cherokee-guide-mascot")||document.querySelector("canvas");e=s?s.width:2*t,a=s?s.height:2*i}const s=20,n=t-e/2+s,o=t+e/2+s,l=i-a/2+s,h=i+a/2-s;this.x-this.size<n?(this.x=n+this.size,this.vx=.5*Math.abs(this.vx)):this.x+this.size>o&&(this.x=o-this.size,this.vx=.5*-Math.abs(this.vx)),this.y-this.size<l?(this.y=l+this.size,this.vy=.5*Math.abs(this.vy)):this.y+this.size>h&&(this.y=h-this.size,this.vy=.5*-Math.abs(this.vy))}this.age+=this.lifeDecay*o,this.age<this.fadeInTime?this.life=this.age/this.fadeInTime:this.age<1-this.fadeOutTime?this.life=1:(this.life=(1-this.age)/this.fadeOutTime,this.isFadingOut=!0,"popcorn"===this.behavior&&(this.size=this.baseSize*(.5+.5*this.life))),this.life=Math.max(0,Math.min(1,this.life)),"falling"===this.behavior?this.opacity=this.life:this.opacity=this.easeInOutCubic(this.life),"burst"===this.behavior&&this.behaviorData&&this.life<this.behaviorData.fadeStart&&(this.size=this.baseSize*(this.life/this.behaviorData.fadeStart))}applyUndertoneModifier(e,t){}applyGestureMotion(e,t,i,a,s){!function(e,t,i,a,s,n){if(!i||!i.type||a>=1)return;i.type,e.gestureData||(e.gestureData={originalVx:e.vx,originalVy:e.vy,initialX:e.x,initialY:e.y,startAngle:Math.atan2(e.y-n,e.x-s),startRadius:Math.sqrt(Math.pow(e.x-s,2)+Math.pow(e.y-n,2))});const r=_r(i.type);if(!r)return void i.type;i.type;let o=i;if(dl.isEnabled()&&r.rhythm?.enabled){const s=dl.applyGestureRhythm(r,e,a,t);o={...i,amplitude:(i.amplitude||1)*(s.amplitudeMultiplier||1)*(s.accentMultiplier||1),wobbleAmount:(i.wobbleAmount||0)*(s.wobbleMultiplier||1),rhythmModulation:s}}r.apply&&(e.y,r.apply(e,a,o,t,s,n),i.type),a>=.99&&r.cleanup&&(r.cleanup(e),e.gestureData=null)}(this,i,e,t,a,s)}isOutOfBounds(e,t){return this.x<-50||this.x>e+50||this.y<-50||this.y>t+50}isAlive(){return this.life>0}setOutwardVelocity(e){if(this.behaviorData&&void 0!==this.behaviorData.outwardSpeed){const t=this.behaviorData.outwardSpeed;this.vx=Math.cos(e)*t,this.vy=Math.sin(e)*t+(this.behaviorData.upwardBias||0)}}getDepthAdjustedSize(){const e=1+.2*this.z;return this.size*e}getState(){return{position:{x:this.x,y:this.y,z:this.z},velocity:{x:this.vx,y:this.vy,z:this.vz},life:this.life,behavior:this.behavior,size:this.size,opacity:this.opacity}}reset(e,t,i="ambient",a=1,s=1,n=null){const r=Math.random();this.z=r<1/13?.5+.5*Math.random():.9*Math.random()-1;const o=this.z>0?(20+20*Math.random())*a:3*a,l=Math.random()*Math.PI*2;if(this.x=e+Math.cos(l)*o,this.y=t+Math.sin(l)*o,this.vx=0,this.vy=0,this.vz=0,this.life=0,this.age=0,this.scaleFactor=a,this.particleSizeMultiplier=s,this.size=(4+6*Math.random())*a*s,this.baseSize=this.size,this.emotionColors=n,this.cachedColors.clear(),this.colorAccessOrder=[],this.opacity=0,this.isFadingOut=!1,this.baseOpacity=.3+.4*Math.random(),this.color="#ffffff",this.behavior=i,this.gestureData=null,this.behaviorData)for(const e in this.behaviorData)delete this.behaviorData[e];else this.behaviorData={};zo(this,i)}getCachedColor(e,t){const i=Math.round(100*t)/100,a=`${e}_${i}`;if(this.cachedColors.has(a)){const e=this.colorAccessOrder.indexOf(a);-1!==e&&this.colorAccessOrder.splice(e,1),this.colorAccessOrder.push(a)}else{if(this.cachedColors.size>=this.maxCachedColors){const e=this.colorAccessOrder.shift();this.cachedColors.delete(e)}this.cachedColors.set(a,this.hexToRgba(e,i)),this.colorAccessOrder.push(a)}return this.cachedColors.get(a)}hexToRgba(e,t){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?`rgba(${parseInt(i[1],16)}, ${parseInt(i[2],16)}, ${parseInt(i[3],16)}, ${t})`:`rgba(255, 255, 255, ${t})`}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}render(e,t="#ffffff"){if(this.life<=0)return;if(!isFinite(this.x)||!isFinite(this.y))return;const i=this.x,a=this.y,s=Math.max(.1,this.size),n=this.tempColor||this.color||t;if(e.save(),this.isCellShaded){e.strokeStyle=this.getCachedColor(n,.9*this.opacity),e.lineWidth=2,e.beginPath(),e.arc(i,a,s,0,2*Math.PI),e.stroke();const t=Math.floor(3*this.opacity)/3;e.fillStyle=this.getCachedColor(n,t*(this.baseOpacity||.5)*.5),e.beginPath(),e.arc(i,a,Math.max(.1,s-1),0,2*Math.PI),e.fill(),t>.5&&(e.fillStyle=this.getCachedColor("#FFFFFF",.3),e.beginPath(),e.arc(i-.3*s,a-.3*s,.3*s,0,2*Math.PI),e.fill())}else{const t=e.createRadialGradient(i,a,0,i,a,s);if(t.addColorStop(0,this.getCachedColor(n,this.opacity*(this.baseOpacity||.5))),t.addColorStop(.5,this.getCachedColor(n,this.opacity*(this.baseOpacity||.5)*.5)),t.addColorStop(1,this.getCachedColor(n,0)),e.fillStyle=t,e.beginPath(),e.arc(i,a,s,0,2*Math.PI),e.fill(),this.hasGlow&&this.glowSizeMultiplier>0){const t=s*this.glowSizeMultiplier,r=e.createRadialGradient(i,a,.5*s,i,a,t),o=.3,l=Math.max(o,this.opacity),h=Math.min(1,this.glowSizeMultiplier/3);r.addColorStop(0,this.getCachedColor(n,Math.max(.5,.8*l)*h)),r.addColorStop(.25,this.getCachedColor(n,Math.max(.3,.6*l)*h)),r.addColorStop(.5,this.getCachedColor(n,Math.max(.2,.4*l)*h)),r.addColorStop(.75,this.getCachedColor(n,Math.max(.1,.2*l)*h)),r.addColorStop(1,this.getCachedColor(n,0)),e.save(),e.globalCompositeOperation="screen",e.fillStyle=r,e.beginPath(),e.arc(i,a,t,0,2*Math.PI),e.fill(),e.restore()}}e.restore()}}class gl{constructor(e=50){this.poolSize=Math.min(e,50),this.pool=[],this.totalParticlesCreated=0,this.totalParticlesDestroyed=0,this.poolHits=0,this.poolMisses=0}getParticle(e,t,i,a,s,n,r,o=null){let l;return this.pool.length>0?(l=this.pool.pop(),l.reset(e,t,i,a,s,n),this.poolHits++):(l=new pl(e,t,i,a,s,n),this.poolMisses++,this.totalParticlesCreated++),l.emotion=r,o&&(l.gestureBehavior=o),l}returnParticle(e){if(this.pool.length<this.poolSize){if(e.cachedGradient=null,e.cachedGradientKey=null,e.behaviorData)for(const t in e.behaviorData)delete e.behaviorData[t];this.pool.push(e)}else this.totalParticlesDestroyed++}refreshPool(){const e=this.pool.length-this.poolSize;e>0&&(this.pool.splice(this.poolSize),this.totalParticlesDestroyed+=e)}getStats(){return{poolSize:this.pool.length,poolHits:this.poolHits,poolMisses:this.poolMisses,totalCreated:this.totalParticlesCreated,totalDestroyed:this.totalParticlesDestroyed}}clear(){this.pool=[],this.poolHits=0,this.poolMisses=0,this.totalParticlesCreated=0,this.totalParticlesDestroyed=0}}class ml{constructor(){this.spawnAccumulator=0}getSpawnPosition(e,t,i,a,s,n=null){const r=Math.min(a,s)/12,o=2.5*r,l=1.1*o,h=Math.min(t-30,a-t-30),c=Math.min(i-30,s-i-30),u=Math.min(1.5*o,h,c);switch(e){case"ambient":case"resting":{const e=Math.random()*Math.PI*2,a=.9*o;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a,angle:e}}case"rising":{const e=Math.random()*Math.PI*2,a=l+Math.random()*(u-l);return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a}}case"falling":{const e=Math.random()*Math.PI*2,a=.9*o;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a,angle:e}}case"aggressive":{const e=Math.random()*Math.PI*2,a=o+Math.random()*r;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a}}case"scattering":default:return{x:t,y:i};case"burst":{const e=Math.random()*Math.PI*2;if("suspicion"===n){const a=1.5*r;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a}}if("surprise"===n){const a=1.2*r;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a}}return{x:t,y:i}}case"repelling":{const e=Math.random()*Math.PI*2,a=.9*o;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a}}case"orbiting":{const e=Math.random()*Math.PI*2,a=1.2*o+Math.random()*o*.5;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a}}case"glitchy":{const e=Math.random()*Math.PI*2,a=3*o+Math.random()*o*4;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a}}case"spaz":{const e=Math.random()*Math.PI*2,a=2*o+Math.random()*o*3;return{x:t+Math.cos(e)*a,y:i+Math.sin(e)*a}}}}clampToCanvas(e,t,i,a,s=30){return{x:Math.max(s,Math.min(i-s,e)),y:Math.max(s,Math.min(a-s,t))}}calculateSpawnRate(e,t){if(e<=0)return 0;const i=Math.min(t,50),a=e/1e3;this.spawnAccumulator+=a*i,this.spawnAccumulator=Math.min(this.spawnAccumulator,3);let s=0;for(;this.spawnAccumulator>=1;)s++,this.spawnAccumulator-=1;return s}resetAccumulator(){this.spawnAccumulator=0}}class yl{render(e,t,i="#ffffff",a=null){const s=[];for(const e of t)e.life<=0||s.push(e);this.G(e,s,i,a)}renderLayer(e,t,i="#ffffff",a=!1,s=null){const n=[],r=e.canvas.width,o=e.canvas.height;for(const e of t)e.z>=0===a&&(e.x<-50||e.x>r+50||e.y<-50||e.y>o+50||e.life<=0||n.push(e));return n.sort((e,t)=>e.isCellShaded!==t.isCellShaded?e.isCellShaded?-1:1:e.hasGlow!==t.hasGlow?e.hasGlow?-1:1:0),this.G(e,n,i,s),n}G(e,t,i,a=null){e.save();let s=null;for(const n of t)if(n.isCellShaded)n.render(e,i),s=null;else{const t=n.color||i;if(t!==s&&(e.fillStyle=t,s=t),!isFinite(n.x)||!isFinite(n.y))continue;const r=n.getDepthAdjustedSize?n.getDepthAdjustedSize():n.size;let o=Math.max(.1,r),l=1;if(a&&a.fireflyEffect){const e=(.01*n.x+.01*n.y+.1*n.size)%(2*Math.PI),t=a.fireflyTime||.001*Date.now(),i=a.particleGlow||2;l=.3+Math.max(0,Math.sin(3*t+e))*i}if(a&&a.flickerEffect){const e=(.02*n.x+.02*n.y)%(2*Math.PI),t=a.flickerTime||.001*Date.now(),i=a.particleGlow||2;l=.5+Math.sin(12*t+e)*i*.5}if(a&&a.shimmerEffect){const t=n.x-e.canvas.width/2,i=n.y-e.canvas.height/2,s=Math.sqrt(t*t+i*i)/200,r=a.shimmerTime||.001*Date.now(),o=a.shimmerWave||0,h=a.particleGlow||1.2;l=1+.15*Math.sin(3*r-s+o)*h}if(a&&a.glowEffect){const t=a.glowProgress||0,i=a.particleGlow||2,s=n.x-e.canvas.width/2,r=n.y-e.canvas.height/2,l=Math.sqrt(s*s+r*r)/300,h=Math.min(.3*l,.5),c=Math.max(0,(t-h)/(1-h)),u=Math.sin(c*Math.PI);n.L||(n.L={hasGlow:n.hasGlow,glowSizeMultiplier:n.glowSizeMultiplier||0}),n.hasGlow=!0,n.glowSizeMultiplier=Math.max(3,n.L.glowSizeMultiplier)+u*i*3,o*=1+.3*u,t>=.99&&n.L&&(n.hasGlow=n.L.hasGlow,n.glowSizeMultiplier=n.L.glowSizeMultiplier,delete n.L)}if(n.hasGlow||l>1){const t=Math.max(.1,o*(n.glowSizeMultiplier||1.5)*l),i=e.globalCompositeOperation;e.globalCompositeOperation="screen",e.globalAlpha=.15*n.opacity*l,e.beginPath(),e.arc(n.x,n.y,t,0,2*Math.PI),e.fill(),e.globalAlpha=.25*n.opacity*l,e.beginPath(),e.arc(n.x,n.y,.6*t,0,2*Math.PI),e.fill(),e.globalCompositeOperation=i}e.globalAlpha=n.opacity*(n.baseOpacity||.5)*.6*Math.min(2,l),e.beginPath(),e.arc(n.x,n.y,o,0,2*Math.PI),e.fill()}e.restore()}}class fl{constructor(e=50,t=null){this.errorBoundary=t,this.maxParticles=e,this.absoluteMaxParticles=2*e,this.particles=[],this.particlePool=new gl(e),this.particleSpawner=new ml,this.particleRenderer=new yl,this.containmentBounds=null,this.stateChangeCount=0,this.lastMemoryCheck=Date.now(),this.lastLeakedCount=0,this.particleCount=0,this.cleanupTimer=0,this.cleanupInterval=5e3}get pool(){return this.particlePool.pool}get poolSize(){return this.particlePool.poolSize}get poolHits(){return this.particlePool.poolHits}get poolMisses(){return this.particlePool.poolMisses}get totalParticlesCreated(){return this.particlePool.totalParticlesCreated}get totalParticlesDestroyed(){return this.particlePool.totalParticlesDestroyed}get spawnAccumulator(){return this.particleSpawner.spawnAccumulator}set spawnAccumulator(e){this.particleSpawner.spawnAccumulator=e}getParticleFromPool(e,t,i){return this.particlePool.getParticle(e,t,i,this.scaleFactor||1,this.particleSizeMultiplier||1,this.currentEmotionColors,this.currentEmotion,this.gestureBehavior)}returnParticleToPool(e){this.particlePool.returnParticle(e)}spawn(e,t,i,a,s,n,r=null,o=0,l=10,h=1,c=1,u=null,d=null){if(this.scaleFactor=h,this.particleSizeMultiplier=c,this.errorBoundary)return this.errorBoundary.wrap(()=>{this._(e,t,i,a,s,n,r,o,l,u,d)},"particle-spawn")();this._(e,t,i,a,s,n,r,o,l,u,d)}resetAccumulator(){this.particleSpawner.resetAccumulator()}_(e,t,i,a,s,n,r,o=0,l=10,c=null,u=null){this.currentEmotion=t,this.baseEmotionColors=c,this.currentUndertone=u,this.currentEmotionColors=c&&u?function(e,t){return e&&Array.isArray(e)&&t&&"clear"!==t?e.map(e=>"string"==typeof e?Uo(e,t):e&&"object"==typeof e&&e.color?{...e,color:Uo(e.color,t)}:e):e}(c,u):c;let d=i;if(dl.isEnabled()){const i=rl&&rl.isInitialized?rl.getEmotion(t):h(t);if(i){const t=dl.applyParticleRhythm(i,this);if(t.emitBurst)for(let i=0;i<t.emitBurst&&this.particles.length<l;i++)this.spawnSingleParticle(e,a,s);void 0!==t.emissionRate&&(d*=t.emissionRate)}}if(null!==r){for(let t=0;t<r&&this.particles.length<this.maxParticles;t++)this.spawnSingleParticle(e,a,s);return}if(this.skipSpawnThisFrame)return;for(;this.particles.length<o&&this.particles.length<this.maxParticles;)this.spawnSingleParticle(e,a,s);if(this.particles.length>=l)return;if(d<=0)return;const p=this.particleSpawner.calculateSpawnRate(d,n);for(let t=0;t<p&&this.particles.length<l;t++)this.spawnSingleParticle(e,a,s)}getSpawnPosition(e,t,i,a,s){return this.particleSpawner.getSpawnPosition(e,t,i,a,s,this.currentEmotion)}clampToCanvas(e,t,i,a,s=30){return this.particleSpawner.clampToCanvas(e,t,i,a,s)}spawnSingleParticle(e,t,i){if(this.particles.length>=this.absoluteMaxParticles)return;const a=this.canvasWidth||2*t,s=this.canvasHeight||2*i,n=this.particleSpawner.getSpawnPosition(e,t,i,a,s,this.currentEmotion),r=this.particleSpawner.clampToCanvas(n.x,n.y,a,s);n.x=r.x,n.y=r.y;const o=this.getParticleFromPool(n.x,n.y,e);"meditation_swirl"===e&&n.palmCenter&&(o.palmCenter=n.palmCenter,o.swirlAngle=n.swirlAngle),this.particles.push(o),this.particleCount++}update(e,t,i,a=null,s=0,n=null){if(this.errorBoundary)return this.errorBoundary.wrap((e,t,i,a,s,n)=>this.H(e,t,i,a,s,n),"particle-update")(e,t,i,a,s,n);this.H(e,t,i,a,s,n)}H(e,t,i,a=null,s=0,n=null){let r=!1;for(this.particles=this.particles.filter(o=>("rain"!==a?.type||r||(r=!0),o.update(e,t,i,n,a,s,this.containmentBounds),o.isAlive()));this.particles.length>this.maxParticles;)this.removeParticle(0)}setGestureBehavior(e,t){this.gestureBehavior=t?e:null,t?this.particles.forEach(t=>{t.gestureBehavior=e}):this.particles.forEach(e=>{e.gestureBehavior=null})}removeParticle(e){if(e>=0&&e<this.particles.length){const t=this.particles.splice(e,1)[0];t.cachedGradient=null,t.cachedGradientKey=null,this.returnParticleToPool(t),this.particleCount=Math.max(0,this.particleCount-1)}}render(e,t="#ffffff",i=null){if(this.errorBoundary)return this.errorBoundary.wrap(()=>{this.U(e,t,i)},"particle-render")();this.U(e,t,i)}renderBackground(e,t="#ffffff",i=null){if(this.errorBoundary)return this.errorBoundary.wrap(()=>{this.Y(e,t,!1,i)},"particle-render-bg")();this.Y(e,t,!1,i)}renderForeground(e,t="#ffffff",i=null){if(this.errorBoundary)return this.errorBoundary.wrap(()=>{this.Y(e,t,!0,i)},"particle-render-fg")();this.Y(e,t,!0,i)}Y(e,t,i,a=null){this.particleRenderer.renderLayer(e,this.particles,t,i,a)}U(e,t,i=null){this.particleRenderer.render(e,this.particles,t,i)}onVisibilityResume(e,t=null){if(this.resetAccumulator(),e>hl)this.clear();else if(e>1e4){const e=this.particles.length,i=t??e,a=Math.max(10,Math.floor(.5*i));for(;this.particles.length>a;)this.removeParticle(0)}}clear(){for(this.stateChangeCount++;this.particles.length>0;){const e=this.particles.pop();if(e.cachedColors&&e.cachedColors.clear(),e.behaviorData)for(const t in e.behaviorData)delete e.behaviorData[t];this.pool.length<this.poolSize&&!this.pool.includes(e)&&this.pool.push(e)}if(this.particles.length=0,this.particleCount=0,this.spawnAccumulator=0,this.pool.length>this.poolSize){const e=this.pool.length-this.poolSize;this.pool.splice(this.poolSize,e)}}burst(e,t,i,a){if(this.errorBoundary)return this.errorBoundary.wrap(()=>{this.X(e,t,i,a)},"particle-burst")();this.X(e,t,i,a)}X(e,t,i,a){const s=Math.min(e,this.maxParticles-this.particles.length);for(let e=0;e<s;e++)this.spawnSingleParticle(t,i,a)}performCleanup(){if(this.pool.length>this.poolSize){const e=this.pool.length-this.poolSize;for(let t=0;t<e;t++){const e=this.pool.pop();e&&(e.cachedGradient=null,e.cachedGradientKey=null,e.behaviorData=null)}}for(const e of this.particles)e.cachedGradient&&e.life<.5&&(e.cachedGradient=null,e.cachedGradientKey=null)}getStats(){return{activeParticles:this.particles.length,maxParticles:this.maxParticles,poolSize:this.pool.length,poolHits:this.poolHits,poolMisses:this.poolMisses,poolEfficiency:this.poolHits/Math.max(1,this.poolHits+this.poolMisses),spawnAccumulator:this.spawnAccumulator}}setMaxParticles(e){for(this.originalMaxParticles=this.originalMaxParticles||this.maxParticles,this.maxParticles=Math.max(1,e);this.particles.length>this.maxParticles;)this.removeParticle(0)}cleanupDeadParticles(){const e=this.particles.length;this.particles=this.particles.filter(e=>e.isAlive());const t=e-this.particles.length;return this.pool.length>20&&(this.pool.length=20),t}getParticlesByBehavior(e){return this.particles.filter(t=>t.behavior===e)}validateParticles(){for(const e of this.particles)if(!e.isAlive()||e.life<0||e.life>1)return!1;return!0}cleanup(){for(let e=this.particles.length-1;e>=0;e--)this.particles[e].isAlive()||this.removeParticle(e)}refreshPool(){this.particlePool.clear();for(const e of this.particles)e.life=0}setContainmentBounds(e){this.containmentBounds=e}destroy(){this.clear(),this.particlePool.clear()}}const bl=new class{constructor(){this.gestureCache=new Map,this.propertyCache=new Map,this.compositionCache=new Map,this.pluginCache=new Map,this.stats={hits:0,misses:0,loadTime:0,cacheSize:0,gestureHits:0,propertyHits:0,compositionHits:0},this.isInitialized=!1,this.loadStartTime=0}N(){this.isInitialized||this.initialize()}initialize(){this.loadStartTime=performance.now();try{this.cacheCoreGestures(),this.cacheGestureProperties(),this.cacheCommonCombinations(),this.cachePluginGestures(),this.stats.loadTime=performance.now()-this.loadStartTime,this.stats.cacheSize=this.gestureCache.size+this.propertyCache.size+this.compositionCache.size,this.isInitialized=!0}catch(e){this.isInitialized=!1}}cacheCoreGestures(){Object.values(Br).forEach(e=>{e&&e.name&&this.gestureCache.set(e.name,{...e,cached:!0,cacheTime:performance.now()})})}cacheGestureProperties(){this.gestureCache.forEach((e,t)=>{const i={type:e.type,emoji:e.emoji,description:e.description,config:e.config,rhythm:e.rhythm,duration:this.calculateGestureDuration(e),easing:this.extractEasingFunction(e),physics:this.extractPhysicsProperties(e),timing:this.extractTimingProperties(e)};this.propertyCache.set(t,i)})}cacheCommonCombinations(){[["bounce","pulse"],["shake","vibrate"],["orbit","spin"],["morph","glow"],["breathe","fade"],["wave","drift"],["nod","sway"],["jump","stretch"]].forEach(([e,t])=>{const i=`${e}+${t}`,a=this.calculateGestureCombination(e,t);a&&this.compositionCache.set(i,a)})}cachePluginGestures(){try{const e=x.getAllPluginGestures();e&&Object.entries(e).forEach(([e,t])=>{this.pluginCache.set(e,{...t,cached:!0,cacheTime:performance.now(),isPlugin:!0})})}catch(e){}}getGesture(e){return this.N(),this.gestureCache.has(e)?(this.stats.hits++,this.stats.gestureHits++,this.gestureCache.get(e)):this.pluginCache.has(e)?(this.stats.hits++,this.stats.gestureHits++,this.pluginCache.get(e)):(this.stats.misses++,null)}getGestureProperties(e){return this.N(),this.propertyCache.has(e)?(this.stats.hits++,this.stats.propertyHits++,this.propertyCache.get(e)):(this.stats.misses++,null)}getGestureCombination(e,t){this.N();const i=`${e}+${t}`;return this.compositionCache.has(i)?(this.stats.hits++,this.stats.compositionHits++,this.compositionCache.get(i)):(this.stats.misses++,null)}calculateGestureDuration(e){if(!e.config)return 1e3;const{musicalDuration:t,duration:i}=e.config;return t&&t.musical?500*(t.beats||2):i||1e3}extractEasingFunction(e){if(!e.config)return"sine";const{easing:t,particleMotion:i}=e.config;return t||i?.easing||"sine"}extractPhysicsProperties(e){if(!e.config)return{};const{amplitude:t,strength:i,size:a,rotation:s}=e.config;return{amplitude:t||20,strength:i||1,size:a||80,rotation:s||0}}extractTimingProperties(e){if(!e.config)return{};const{phases:t,timingSync:i}=e.config;return{phases:t||[],timingSync:i||{},hasPhases:!!(t&&t.length>0),hasTimingSync:!!(i&&Object.keys(i).length>0)}}calculateGestureCombination(e,t){const i=this.getGesture(e),a=this.getGesture(t);return i&&a?{gestures:[e,t],combinedDuration:Math.max(this.calculateGestureDuration(i),this.calculateGestureDuration(a)),combinedType:i.type===a.type?i.type:"mixed",combinedEasing:this.extractEasingFunction(i),combinedPhysics:this.combinePhysicsProperties(i,a),compatibility:this.calculateCompatibility(i,a)}:null}combinePhysicsProperties(e,t){const i=this.extractPhysicsProperties(e),a=this.extractPhysicsProperties(t);return{amplitude:Math.max(i.amplitude,a.amplitude),strength:(i.strength+a.strength)/2,size:Math.max(i.size,a.size),rotation:(i.rotation+a.rotation)/2}}calculateCompatibility(e,t){return e.type===t.type?"high":"blending"===e.type&&"blending"===t.type?"medium":"override"===e.type||"override"===t.type?"low":"medium"}getStats(){const e=this.stats.hits+this.stats.misses>0?(this.stats.hits/(this.stats.hits+this.stats.misses)*100).toFixed(1):0;return{...this.stats,hitRate:`${e}%`,isInitialized:this.isInitialized,cacheSize:this.stats.cacheSize,coreGestures:this.gestureCache.size,pluginGestures:this.pluginCache.size,properties:this.propertyCache.size,combinations:this.compositionCache.size}}clear(){this.gestureCache.clear(),this.propertyCache.clear(),this.compositionCache.clear(),this.pluginCache.clear(),this.stats={hits:0,misses:0,loadTime:0,cacheSize:0,gestureHits:0,propertyHits:0,compositionHits:0},this.isInitialized=!1}warmUp(e){e.forEach(e=>{this.getGesture(e),this.getGestureProperties(e)})}};function wl(e){if(bl&&bl.isInitialized){const t=bl.getGesture(e);if(t)return t}return _r(e)}const vl={none:{speed:1,amplitude:1,intensity:1,smoothness:1,regularity:1,"3d":{rotation:{speedMultiplier:1,shakeMultiplier:1},glow:{intensityMultiplier:1,pulseSpeedMultiplier:1},scale:{breathDepthMultiplier:1,breathRateMultiplier:1},righting:{strengthMultiplier:1}}},clear:{speed:1,amplitude:1,intensity:1,smoothness:1,regularity:1,"3d":{rotation:{speedMultiplier:1,shakeMultiplier:1},glow:{intensityMultiplier:1,pulseSpeedMultiplier:1},scale:{breathDepthMultiplier:1,breathRateMultiplier:1},righting:{strengthMultiplier:1}}},nervous:{speed:1.2,amplitude:.9,intensity:1.1,smoothness:.7,regularity:.6,addFlutter:!0,addMicroShake:!0,"3d":{rotation:{speedMultiplier:1.5,shakeMultiplier:3.5,enableEpisodicWobble:!0},glow:{intensityMultiplier:1.25,pulseSpeedMultiplier:2},scale:{breathDepthMultiplier:.5,breathRateMultiplier:1.8},righting:{strengthMultiplier:.7}}},confident:{speed:.9,amplitude:1.3,intensity:1.2,smoothness:1.1,regularity:1.2,addPower:!0,addHold:!0,"3d":{rotation:{speedMultiplier:.7,shakeMultiplier:.2},glow:{intensityMultiplier:1.4,pulseSpeedMultiplier:.7},scale:{breathDepthMultiplier:1.5,breathRateMultiplier:.7},righting:{strengthMultiplier:1.6}}},tired:{speed:.7,amplitude:.7,intensity:.8,smoothness:1.3,regularity:.8,addDroop:!0,addPause:!0,"3d":{rotation:{speedMultiplier:.4,shakeMultiplier:.15},glow:{intensityMultiplier:.5,pulseSpeedMultiplier:.5},scale:{breathDepthMultiplier:1.3,breathRateMultiplier:.5},righting:{strengthMultiplier:.6}}},intense:{speed:1.3,amplitude:1.2,intensity:1.4,smoothness:.6,regularity:.9,addPulse:!0,addFocus:!0,"3d":{rotation:{speedMultiplier:1.6,shakeMultiplier:2.5},glow:{intensityMultiplier:1.8,pulseSpeedMultiplier:2.2},scale:{breathDepthMultiplier:1.6,breathRateMultiplier:1.8},righting:{strengthMultiplier:1.3}}},subdued:{speed:.8,amplitude:.8,intensity:.7,smoothness:1.2,regularity:1.1,addSoftness:!0,addFade:!0,"3d":{rotation:{speedMultiplier:.5,shakeMultiplier:.1},glow:{intensityMultiplier:.55,pulseSpeedMultiplier:.6},scale:{breathDepthMultiplier:.7,breathRateMultiplier:.6},righting:{strengthMultiplier:1.4}}}};class Ml{constructor(){this.cache=new Map,this.easingCache=new Map,this.preCalculateEasingCurves()}preCalculateEasingCurves(){const e=["linear","ease-in","ease-out","ease-in-out","bounce"];for(const t of e){const e=new Float32Array(101);for(let i=0;i<=100;i++){const a=i/100;e[i]=this.calculateEasing(a,t)}this.easingCache.set(t,e)}}calculateEasing(e,t){switch(t){case"ease-in":return e*e;case"ease-out":return e*(2-e);case"ease-in-out":return e<.5?2*e*e:(4-2*e)*e-1;case"bounce":return e<.363636?7.5625*e*e:e<.727272?7.5625*(e-=.545454)*e+.75:e<.90909?7.5625*(e-=.818181)*e+.9375:7.5625*(e-=.954545)*e+.984375;default:return e}}getEasingValue(e,t){const i=this.easingCache.get(t);return i?i[Math.min(Math.floor(100*e),100)]:e}compose(e,t,i=null){const a=`${e}-${t}-${i||"none"}`;if(this.cache.has(a))return this.cache.get(a);const s=wl(e),n=s?s.config:{duration:500,amplitude:20,easing:"sine"},r=rl&&rl.isInitialized?rl.getModifiers(t):u(t),o=function(e){return e&&""!==e&&"clear"!==e&&vl[e]||vl.clear}(i),l=this.applyModifiers(n,r,o,e);return this.cache.size>100&&this.cache.clear(),this.cache.set(a,l),l}applyModifiers(e,t,i,a){const s={...e},n=t.speed*i.speed;if(s.duration=Math.round(e.duration/n),void 0!==s.amplitude&&(s.amplitude=e.amplitude*t.amplitude*i.amplitude),void 0!==s.scaleAmount&&(s.scaleAmount=e.scaleAmount*t.intensity*i.intensity),void 0!==s.scaleTarget){const a=t.amplitude*i.amplitude;s.scaleTarget=1+(e.scaleTarget-1)*a}void 0!==s.glowAmount&&(s.glowAmount=e.glowAmount*t.intensity*i.intensity),void 0!==s.glowPeak&&(s.glowPeak=1+(e.glowPeak-1)*t.intensity*i.intensity),void 0!==s.rotations&&(s.rotations=e.rotations*t.amplitude*i.amplitude),void 0!==s.angle&&(s.angle=e.angle*t.amplitude*i.amplitude),void 0!==s.distance&&(s.distance=e.distance*t.amplitude*i.amplitude);const r=t.smoothness*i.smoothness;return s.smoothness=r,s.easing=this.selectEasing(e.easing,r),s.regularity=t.regularity*i.regularity,s.effects=[],t.addBounce&&s.effects.push("bounce"),t.addGravity&&s.effects.push("gravity"),t.addShake&&s.effects.push("shake"),t.addJitter&&s.effects.push("shake"),t.addPop&&s.effects.push("pop"),t.addRecoil&&s.effects.push("recoil"),t.addWarmth&&s.effects.push("warmth"),t.addFlow&&s.effects.push("flow"),t.addWobble&&s.effects.push("wobble"),t.addVibration&&s.effects.push("vibration"),t.addDrag&&s.effects.push("drag"),t.addWeight&&s.effects.push("weight"),t.addTension&&s.effects.push("tension"),t.addPrecision&&s.effects.push("precision"),i.addFlutter&&s.effects.push("flutter"),i.addMicroShake&&s.effects.push("microShake"),i.addPower&&s.effects.push("power"),i.addHold&&s.effects.push("hold"),i.addDroop&&s.effects.push("droop"),i.addPause&&s.effects.push("pause"),i.addPulse&&s.effects.push("pulse"),i.addFocus&&s.effects.push("focus"),i.addSoftness&&s.effects.push("softness"),i.addFade&&s.effects.push("fade"),this.applyGestureSpecificMods(s,a,t,i),e.particleMotion&&(s.particleMotion={...e.particleMotion},void 0!==s.particleMotion.strength&&(s.particleMotion.strength*=t.intensity*i.intensity),void 0!==s.particleMotion.frequency&&(s.particleMotion.frequency*=n),void 0!==s.particleMotion.amplitude&&(s.particleMotion.amplitude*=t.amplitude*i.amplitude)),s}selectEasing(e,t){return t<.5?"linear":t<.8?"quad":t<1.2?e:t<1.5?"cubic":"sine"}applyGestureSpecificMods(e,t,i,a){switch(t){case"bounce":i.addShake&&(e.frequency=Math.floor(1.5*e.frequency)),i.addGravity&&(e.amplitude*=.6,e.frequency=1);break;case"pulse":i.addWarmth&&(e.frequency=2,e.glowAmount*=1.5),a.addFlutter&&(e.irregular=!0);break;case"shake":i.addJitter&&(e.frequency*=1.5,e.amplitude*=1.2),i.addShake&&(e.amplitude*=1.5,e.decay=!1);break;case"spin":i.addBounce&&(e.rotations*=1.5),i.addWobble&&(e.wobble=!0)}}clearCache(){this.cache.clear()}}const Sl=new class{constructor(){this.noteDurations={whole:4,half:2,quarter:1,eighth:.5,sixteenth:.25,triplet:.333,"dotted-quarter":1.5,"dotted-half":3},this.cache=new Map,this.maxCacheSize=100,this.cacheAccessOrder=[],this.lastBPM=0,this.prewarmCache()}prewarmCache(){const e=[{musical:!0,beats:1},{musical:!0,bars:1},{musical:!0,beats:.5},{musical:!0,beats:2}];[60,90,120,140,160,180].forEach(t=>{e.forEach(e=>{const i=`${t}_${JSON.stringify(e)}`,a=this.toMilliseconds(e,t);if(this.cache.size>=this.maxCacheSize){const e=this.cacheAccessOrder.shift();this.cache.delete(e)}this.cache.set(i,a),this.cacheAccessOrder.push(i)})})}toMilliseconds(e,t=null){const i=t||cl.bpm||120;if("number"==typeof e)return e;if("object"==typeof e&&e.musical){const t=6e4/i;if(void 0!==e.beats)return e.beats*t;if(void 0!==e.bars){const i=cl.timeSignature||[4,4];return e.bars*i[0]*t}if(void 0!==e.subdivision)return(this.noteDurations[e.subdivision]||1)*t}return 1e3}toMusical(e,t=null){const i=e/(6e4/(t||cl.bpm||120));let a="quarter",s=Math.abs(i-1);for(const[e,t]of Object.entries(this.noteDurations)){const n=Math.abs(i-t);n<s&&(s=n,a=e)}return{musical:!0,beats:i,bars:i/4,closestSubdivision:a,exact:s<.01}}calculatePhases(e,t){if(!e||0===e.length)return[{name:"main",beats:t,start:0,end:1}];const i=e.reduce((e,t)=>e+(t.beats||1),0),a=t/i;let s=0;return e.map(e=>{const i=(e.beats||1)*a,n=s/t;s+=i;const r=s/t;return{name:e.name,beats:i,start:n,end:r,duration:this.toMilliseconds({musical:!0,beats:i})}})}getBeatProgress(){const e=cl.getTimeInfo();return e?e.beatProgress:0}getBarProgress(){const e=cl.getTimeInfo();return e?e.barProgress:0}timeToNextBoundary(e="beat"){const t=cl.getTimeInfo();if(!t)return 100;switch(e){case"beat":default:return t.nextBeatIn;case"bar":return(t.timeSignature[0]-t.beatInBar)*t.beatDuration;case"phrase":{const e=4,i=t.timeSignature[0];return(e-(t.bar||0)%e)*i*t.beatDuration}}}quantize(e,t="eighth"){const i=6e4/(cl.bpm||120),a=(this.noteDurations[t]||1)*i;return Math.round(e/a)*a}isOnBoundary(e="beat",t=50){const i=this.timeToNextBoundary(e),a=cl.getTimeInfo();return!!a&&(i<t||a.beatDuration-i<t)}getTempoAdaptation(e=120){const t=(cl.bpm||120)/e;return{speed:t,energy:Math.min(2,Math.max(.5,t)),smoothness:t<.8?1.2:t>1.5?.8:1,intensity:t>1.3?1.2:t<.7?.8:1}}};class xl{constructor(e){this.renderer=e,this.scaleFactor=e.scaleFactor||1}applyBounce(e,t){return{offsetY:-Math.abs(Math.sin(t*Math.PI*e.params.frequency))*e.params.amplitude*this.scaleFactor*(e.params.effects&&e.params.effects.includes("gravity")?.6:1)}}applyShake(e,t){e.randomAngle||(e.randomAngle=Math.random()*Math.PI*2);const i=e.params.decay?1-t:1,a=Math.sin(t*Math.PI*e.params.frequency)*e.params.amplitude*i*this.scaleFactor;return{offsetX:a*Math.cos(e.randomAngle),offsetY:a*Math.sin(e.randomAngle)}}applyJump(e,t){let i,a,s=0,n=1;if(t<.2){const i=t/.2;n=1-(1-e.params.squashAmount)*i}else if(t<.7){const i=(t-.2)/.5,a=Math.sin(i*Math.PI);s=-e.params.jumpHeight*a*this.scaleFactor,n=e.params.squashAmount+(e.params.stretchAmount-e.params.squashAmount)*a}else{const i=(t-.7)/.3;n=e.params.stretchAmount-(e.params.stretchAmount-1)*i}if(e.params.effects&&e.params.effects.includes("gravity")){const e=t<.7?(t-.2)/.5:0,s=Math.sin(e*Math.PI);i=1+.2*s,a=1-.15*s}const r={offsetY:s,scale:n};return void 0!==i&&(r.scaleX=i),void 0!==a&&(r.scaleY=a),r}applyVibrate(e,t){if(!e.vibrateAngles){e.vibrateAngles={x:2*Math.random()-1,y:2*Math.random()-1};const t=Math.sqrt(e.vibrateAngles.x**2+e.vibrateAngles.y**2);e.vibrateAngles.x/=t,e.vibrateAngles.y/=t}const i=e.params.amplitude||5,a=e.params.frequency||20,s=Math.sin(t*Math.PI*2*a)*i*this.scaleFactor;return{offsetX:s*e.vibrateAngles.x,offsetY:s*e.vibrateAngles.y}}applyWiggle(e,t){const i=(e.params?.amplitude||15)*this.scaleFactor;void 0===e.wiggleDirection&&(e.wiggleDirection=Math.random()<.5?1:-1);const a=e.wiggleDirection;let s=0,n=0;if(t<.25){const e=t/.25;s=i*a*e,n=3*a*e}else if(t<.5){const e=(t-.25)/.25;s=i*a*(1-2*e),n=3*a*(1-2*e)}else if(t<.75){const e=(t-.5)/.25;s=i*-a*(1-2*e),n=3*-a*(1-2*e)}else{const e=(t-.75)/.25;s=i*a*(1-e),n=3*a*(1-e)}return{offsetX:s,offsetY:-Math.abs(Math.sin(t*Math.PI*4))*i*.15,rotation:n}}}class kl{constructor(e){this.renderer=e,this.scaleFactor=e.scaleFactor||1}applyFlash(e,t){const i=Math.sin(t*Math.PI);return{glow:1+((e.params.glowPeak||2)-1)*i,scale:1+((e.params.scalePeak||1.1)-1)*i}}applyGlow(e,t){const i=Math.sin(t*Math.PI*e.params.frequency);return{scale:1+i*(e.params.scaleAmount||.1),glow:1+i*(e.params.glowAmount||.8)}}applyFlicker(e,t){const i=e.params?.intensity||2,a=e.params?.speed||3,s=1+Math.sin(t*Math.PI*2*a)*i*.3,n=5*Math.sin(t*Math.PI*4)*this.scaleFactor,r=.001*Date.now();return{offsetX:n,glow:s,particleGlow:(.5*Math.sin(t*Math.PI*a*2)+.5)*i,flickerTime:r,flickerEffect:!0}}applySparkle(e,t){const i=e.params?.intensity||2,a=.001*Date.now();return{particleGlow:i,glow:.3*Math.sin(t*Math.PI*4)+.7,fireflyTime:a,fireflyEffect:!0}}applyShimmer(e,t){const i=.001*Date.now(),a=e.params?.intensity||.3,s=Math.sin(2*i+t*Math.PI*2);return{offsetX:0,offsetY:0,glow:1+s*a,scale:1+.01*s,particleGlow:1+.2*s,shimmerTime:i,shimmerWave:s,shimmerEffect:!0}}}class Ol{constructor(e){this.renderer=e}applyBreathe(e,t){const{params:i}=e,a=i.particleMotion?.holdPercent||.1;let s;if(t<.4)s=Math.sin(t/.4*Math.PI/2);else if(t<.4+a)s=1;else if(t<.9){const e=(t-.4-a)/(.5-a);s=Math.cos(e*Math.PI/2)}else s=0;const n=1+s*(i.scaleAmount||.25),r=1+s*(i.glowAmount||.4);return e.breathPhase=s,{scale:n,glow:r,breathPhase:s}}applyBreathIn(e,t){return{scale:1+(e.params.scaleAmount-1)*Math.sin(t*Math.PI/2)}}applyBreathOut(e,t){return{scale:1-(1-e.params.scaleAmount)*Math.sin(t*Math.PI/2)}}applyBreathHold(e,t){return{scale:e.params.scaleAmount}}applyBreathHoldEmpty(e,t){return{scale:e.params.scaleAmount}}}class Al{constructor(e){this.renderer=e,this.scaleFactor=e.scaleFactor||1}applySpin(e,t){return{rotation:Math.min(1.05*t,1)*e.params.rotations*360,scale:1+Math.sin(t*Math.PI)*e.params.scaleAmount}}applyDrift(e,t){t<=.01&&!e.currentDriftAngle&&(e.currentDriftAngle=Math.random()*Math.PI*2);const i=e.params.distance*Math.sin(t*Math.PI)*this.scaleFactor,a=e.currentDriftAngle||0;return t>=.99&&(e.currentDriftAngle=null),{offsetX:Math.cos(a)*i,offsetY:Math.sin(a)*i}}applyWave(e,t){const i=(e.params.amplitude||40)*this.scaleFactor,a=t*Math.PI*2,s=Math.sin(a)*i,n=-Math.sin(t*Math.PI)*i*.3;return{offsetX:s,offsetY:Math.sin(2*a)*i*.2+n,rotation:5*Math.sin(a),scale:1+.05*Math.sin(t*Math.PI*2),glow:1+.2*Math.sin(t*Math.PI)}}applySway(e,t){const i=(e.params?.amplitude||30)*this.scaleFactor,a=e.params?.frequency||1;return{offsetX:Math.sin(t*Math.PI*2*a)*i,offsetY:Math.sin(t*Math.PI*4*a)*i*.1,rotation:5*Math.sin(t*Math.PI*2*a)}}applyFloat(e,t){const i=(e.params?.amplitude||20)*this.scaleFactor,a=e.params?.speed||1,s=Math.sin(t*Math.PI*2*a)*i;return{offsetX:Math.sin(t*Math.PI*3*a)*i*.3,offsetY:s,scale:1+.02*Math.sin(t*Math.PI*4*a)}}applyOrbital(e,t){return{offsetX:0,offsetY:0}}applyHula(e,t){const i=(e.params?.amplitude||40)*this.scaleFactor,a=t*Math.PI*2;return{offsetX:Math.sin(a)*i,offsetY:Math.sin(2*a)*i*.5}}applyOrbit(e,t){const i=(e.params?.radius||30)*this.scaleFactor,a=e.params?.speed||1,s=t*Math.PI*2*a;return{offsetX:Math.cos(s)*i,offsetY:Math.sin(s)*i}}}class Cl{constructor(e){this.renderer=e,this.scaleFactor=e.scaleFactor||1}applyPulse(e,t){const i=Math.sin(t*Math.PI*e.params.frequency);return{scale:1+i*e.params.scaleAmount,glow:1+i*e.params.glowAmount}}applyExpand(e,t){const i=Math.max(e.params.scaleAmount||e.params.scaleTarget||1.5,1),a=Math.sin(t*Math.PI/2);return{scale:1+(i-1)*a,glow:1+Math.abs(e.params.glowAmount||.2)*a}}applyContract(e,t){const i=e.params.scaleAmount||e.params.scaleTarget||.7,a=Math.sin(t*Math.PI/2);return{scale:1+(i-1)*a,glow:1+(e.params.glowAmount||-.2)*a}}applyStretch(e,t){const i=Math.sin(t*Math.PI*e.params.frequency);return{scale:1+((e.params.scaleX+e.params.scaleY)/2-1)*i}}applyMorph(e,t){const i=Math.sin(t*Math.PI*2);return{scale:1+.1*i,rotation:10*i}}}class Il{constructor(e){this.renderer=e,this.scaleFactor=e.scaleFactor||1}applyNod(e,t){return{offsetY:Math.sin(t*Math.PI*e.params.frequency)*e.params.amplitude*this.scaleFactor}}applyTilt(e,t){e.tiltDirection||(e.tiltDirection=Math.random()<.5?-1:1);const i=e.params.frequency||2,a=(e.params.angle||15)*Math.PI/180,s=Math.sin(t*Math.PI*i)*e.tiltDirection;return{rotation:s*a,scaleX:1+.1*Math.abs(s),scaleY:1-.05*Math.abs(s),offsetX:10*s,offsetY:-5*Math.abs(s)}}applySlowBlink(e,t){let i=1;return i=t<.3?1-t/.3:t<.5?0:t<.8?(t-.5)/.3:1,{glow:i}}applyLook(e,t){if(!e.targetX){const t=e.params.lookDirection,i=50*e.params.lookDistance*this.scaleFactor;switch(t){case"left":e.targetX=-i,e.targetY=0;break;case"right":e.targetX=i,e.targetY=0;break;case"up":e.targetX=0,e.targetY=-i;break;case"down":e.targetX=0,e.targetY=i;break;default:{const t=Math.random()*Math.PI*2;e.targetX=Math.cos(t)*i,e.targetY=Math.sin(t)*i;break}}}let i=t;return i=t<.3?t/.3:t<.7?1:1-(t-.7)/.3,{offsetX:e.targetX*i,offsetY:e.targetY*i}}applySettle(e,t){const i=Math.sin(t*Math.PI*e.params.wobbleFreq)*Math.exp(3*-t)*20*this.scaleFactor;return{offsetY:i,scale:1+.01*i}}}class zl{constructor(e){this.renderer=e,this.scaleFactor=e.scaleFactor||1}applyPoint(e,t){void 0===e.pointDirection&&(e.pointDirection=Math.random()<.5?-1:1);const i=void 0!==e.params?.direction?e.params.direction:e.pointDirection,a=(e.params?.distance||40)*this.scaleFactor;let s,n;return t<.4?(s=1-Math.pow(1-t/.4,3),n=s):t<.6?(s=1,n=1):(s=Math.pow(1-(t-.6)/.4,3),n=s),{offsetX:i*a*s,offsetY:-Math.abs(.15*a*s),scale:1+.15*n,rotation:5*i*n}}applyLean(e,t){const i=e.params?.angle||15,a=e.params?.side||1,s=Math.sin(t*Math.PI),n=i*a*s;return{offsetX:10*a*this.scaleFactor*s,rotation:n}}applyReach(e,t){const i=void 0!==e.params?.direction?e.params.direction:-Math.PI/2,a=(e.params?.distance||40)*this.scaleFactor;let s;return s=t<.4?t/.4:t<.6?1:1-(t-.6)/.4,s=s*s*(3-2*s),{offsetX:Math.cos(i)*a*s,offsetY:Math.sin(i)*a*s,scale:1+.15*s}}}class Fl{constructor(e){this.renderer=e,this.scaleFactor=e.scaleFactor||1}applyFlashWave(e,t){e.flashWave||(e.flashWave={innerRadius:0,outerRadius:0,maxRadius:3}),e.flashWave.outerRadius=t*e.flashWave.maxRadius,e.flashWave.innerRadius=Math.max(0,(t-.1)*e.flashWave.maxRadius);const i=Math.max(0,1-.7*t);return e.flashWaveData={innerRadius:e.flashWave.innerRadius,outerRadius:e.flashWave.outerRadius,intensity:i},{glow:1+.3*i,flashWave:e.flashWaveData}}applyRain(e,t){return{offsetX:0,offsetY:0,particleEffect:"rain"}}applyGroove(e,t){const i=(e.params?.amplitude||25)*this.scaleFactor;return{offsetX:Math.sin(t*Math.PI*2)*i+Math.sin(t*Math.PI*3+.5)*i*.4,offsetY:Math.sin(t*Math.PI*4+.3)*i*.25,scale:1+.03*Math.sin(t*Math.PI*3+.7),rotation:8*Math.sin(t*Math.PI*2+.2)}}applyHeadBob(e,t){const i=(e.params?.amplitude||20)*this.scaleFactor,a=t*(e.params?.frequency||2)%1;let s;return s=a<.3?a/.3*-i:-i*(1-(a-.3)/.7),{offsetY:s,rotation:a<.3?-3:0}}applyRunningMan(e,t){const i=20*Math.sin(t*Math.PI*4)*this.scaleFactor;return{offsetX:i,offsetY:10*-Math.abs(Math.sin(t*Math.PI*8))*this.scaleFactor,rotation:.3*i,scaleY:1-.05*Math.abs(Math.sin(t*Math.PI*8))}}applyCharleston(e,t){const i=25*Math.sin(t*Math.PI*8)*this.scaleFactor;return{offsetX:i,offsetY:10*-Math.abs(Math.sin(t*Math.PI*8))*this.scaleFactor,rotation:.6*i,scaleY:1-.06*Math.abs(Math.sin(t*Math.PI*8))}}}class Dl{constructor(e){this.renderer=e,this.activeGestures=new Map,this.scaleFactor=e.scaleFactor||1,this.physicalGestureAnimator=new xl(e),this.visualEffectAnimator=new kl(e),this.breathGestureAnimator=new Ol(e),this.movementGestureAnimator=new Al(e),this.shapeTransformAnimator=new Cl(e),this.expressionGestureAnimator=new Il(e),this.directionalGestureAnimator=new zl(e),this.complexAnimationAnimator=new Fl(e),this.gestureAnimations={bounce:{active:!1,progress:0,params:{}},pulse:{active:!1,progress:0,params:{}},shake:{active:!1,progress:0,params:{}},spin:{active:!1,progress:0,params:{}},nod:{active:!1,progress:0,params:{}},tilt:{active:!1,progress:0,params:{}},expand:{active:!1,progress:0,params:{}},contract:{active:!1,progress:0,params:{}},flash:{active:!1,progress:0,params:{}},drift:{active:!1,progress:0,params:{}},stretch:{active:!1,progress:0,params:{}},glow:{active:!1,progress:0,params:{}},flicker:{active:!1,progress:0,params:{}},vibrate:{active:!1,progress:0,params:{}},orbital:{active:!1,progress:0,params:{}},hula:{active:!1,progress:0,params:{}},wave:{active:!1,progress:0,params:{}},breathe:{active:!1,progress:0,params:{}},morph:{active:!1,progress:0,params:{}},slowBlink:{active:!1,progress:0,params:{}},look:{active:!1,progress:0,params:{}},settle:{active:!1,progress:0,params:{}},breathIn:{active:!1,progress:0,params:{}},breathOut:{active:!1,progress:0,params:{}},breathHold:{active:!1,progress:0,params:{}},breathHoldEmpty:{active:!1,progress:0,params:{}},jump:{active:!1,progress:0,params:{}},sway:{active:!1,progress:0,params:{}},float:{active:!1,progress:0,params:{}},sparkle:{active:!1,progress:0,params:{}},shimmer:{active:!1,progress:0,params:{}},wiggle:{active:!1,progress:0,params:{}},groove:{active:!1,progress:0,params:{}},point:{active:!1,progress:0,params:{}},lean:{active:!1,progress:0,params:{}},reach:{active:!1,progress:0,params:{}},headBob:{active:!1,progress:0,params:{}},orbit:{active:!1,progress:0,params:{}},rain:{active:!1,progress:0,params:{}},runningman:{active:!1,progress:0,params:{}},charleston:{active:!1,progress:0,params:{}}}}startGesture(e){const t=wl(e);if(["bounce","shake","pulse","flash","jump","slam","spin","flicker"].includes(e)&&this.renderer.specialEffects){const t={flash:1,jump:1,shake:.9,bounce:.8,pulse:.7,slam:1,spin:.8,flicker:1}[e]||.8;this.renderer.specialEffects.triggerChromaticAberration(t)}let i;i=this.renderer.gestureCompositor?this.renderer.gestureCompositor.compose(e,this.renderer.state.emotion,this.renderer.currentUndertone):t?.config||{amplitude:20,frequency:2,duration:1e3,scaleAmount:.2,glowAmount:.3,rotations:1,distance:50,angle:15,scaleTarget:1.5,glowPeak:2,scalePeak:1.1,scaleX:1.2,scaleY:.8,maxOpacity:1,minOpacity:.5,lookDirection:"random",lookDistance:1,wobbleFreq:4,squashAmount:.8,stretchAmount:1.2,jumpHeight:100,decay:!0,easing:"sine",effects:[]};let a=1e3;if(t&&t.config)if(t.config.musicalDuration)a=Sl.toMilliseconds(t.config.musicalDuration);else if(t.config.duration){const{duration:e}=t.config;a=e}const s=this.gestureAnimations[e];s&&(s.active=!0,s.startTime=performance.now(),s.progress=0,s.params=i,s.duration=a,"shake"===e?s.randomAngle=void 0:"drift"===e?(s.startX=void 0,s.startY=void 0,s.currentDriftAngle=void 0):"tilt"===e?s.tiltDirection=void 0:"vibrate"===e&&(s.vibrateAngles=void 0))}applyGestureAnimations(){const e=performance.now(),t={offsetX:0,offsetY:0,scale:1,rotation:0,glow:1};for(const[i,a]of Object.entries(this.gestureAnimations)){if(!a.active)continue;const s=e-a.startTime,n=a.duration||(a.params?a.params.duration:1e3);a.progress=Math.min(s/n,1);const r=this.applyEasing(a.progress,a.params.easing);let o={};switch(i){case"bounce":o=this.applyBounce(a,r);break;case"pulse":o=this.applyPulse(a,r);break;case"shake":o=this.applyShake(a,r);break;case"spin":o=this.applySpin(a,r);break;case"nod":o=this.applyNod(a,r);break;case"tilt":o=this.applyTilt(a,r);break;case"expand":o=this.applyExpand(a,r);break;case"contract":o=this.applyContract(a,r);break;case"flash":o=this.applyFlash(a,r);break;case"drift":o=this.applyDrift(a,r);break;case"stretch":o=this.applyStretch(a,r);break;case"glow":o=this.applyGlow(a,r);break;case"flicker":o=this.applyFlicker(a,r);break;case"vibrate":o=this.applyVibrate(a,r);break;case"orbital":o=this.applyOrbital(a,r);break;case"hula":o=this.applyHula(a,r);break;case"wave":o=this.applyWave(a,r);break;case"breathe":o=this.applyBreathe(a,r);break;case"morph":o=this.applyMorph(a,r);break;case"slowBlink":o=this.applySlowBlink(a,r);break;case"look":o=this.applyLook(a,r);break;case"settle":o=this.applySettle(a,r);break;case"breathIn":o=this.applyBreathIn(a,r);break;case"breathOut":o=this.applyBreathOut(a,r);break;case"breathHold":o=this.applyBreathHold(a,r);break;case"breathHoldEmpty":o=this.applyBreathHoldEmpty(a,r);break;case"jump":o=this.applyJump(a,r);break;case"sway":o=this.applySway(a,r);break;case"float":o=this.applyFloat(a,r);break;case"rain":o=this.applyRain(a,r);break;case"runningman":o=this.applyRunningMan(a,r);break;case"charleston":o=this.applyCharleston(a,r);break;case"sparkle":o=this.applySparkle(a,r);break;case"shimmer":o=this.applyShimmer(a,r);break;case"wiggle":o=this.applyWiggle(a,r);break;case"groove":o=this.applyGroove(a,r);break;case"point":o=this.applyPoint(a,r);break;case"lean":o=this.applyLean(a,r);break;case"reach":o=this.applyReach(a,r);break;case"headBob":o=this.applyHeadBob(a,r);break;case"orbit":o=this.applyOrbit(a,r)}t.offsetX+=o.offsetX||0,t.offsetY+=o.offsetY||0,t.scale*=o.scale||1,t.rotation+=o.rotation||0,t.glow=Math.max(t.glow,o.glow||1),o.flashWave&&(t.flashWave=o.flashWave),o.fireflyEffect&&(t.fireflyEffect=o.fireflyEffect,t.particleGlow=o.particleGlow,t.fireflyTime=o.fireflyTime),o.flickerEffect&&(t.flickerEffect=o.flickerEffect,t.particleGlow=o.particleGlow,t.flickerTime=o.flickerTime),o.shimmerEffect&&(t.shimmerEffect=o.shimmerEffect,t.particleGlow=o.particleGlow,t.shimmerTime=o.shimmerTime,t.shimmerWave=o.shimmerWave),o.glowEffect&&(t.glowEffect=o.glowEffect,t.particleGlow=o.particleGlow,t.glowTime=o.glowTime,t.glowProgress=o.glowProgress,t.glowEnvelope=o.glowEnvelope),a.progress>=1&&(a.active=!1,a.progress=0,a.startTime=0,"flash"===i&&(a.flashWave=null,a.flashWaveData=null),o.glowEffect&&(o.glowEffect=null,o.particleGlow=null,o.glowTime=null,o.glowProgress=null,o.glowEnvelope=null),o.fireflyEffect&&(o.fireflyEffect=null,o.particleGlow=null,o.fireflyTime=null),o.flickerEffect&&(o.flickerEffect=null,o.particleGlow=null,o.flickerTime=null),o.shimmerEffect&&(o.shimmerEffect=null,o.particleGlow=null,o.shimmerTime=null,o.shimmerWave=null))}return t}update(e){return this.applyGestureAnimations()}stopAllGestures(){Object.keys(this.gestureAnimations).forEach(e=>{const t=this.gestureAnimations[e];t.active=!1,t.startTime=0,t.progress=0,t.params=null,t.glowEffect&&(t.glowEffect=null,t.particleGlow=null,t.glowTime=null,t.glowProgress=null,t.glowEnvelope=null),t.fireflyEffect&&(t.fireflyEffect=null,t.particleGlow=null,t.fireflyTime=null),t.flickerEffect&&(t.flickerEffect=null,t.particleGlow=null,t.flickerTime=null),t.shimmerEffect&&(t.shimmerEffect=null,t.particleGlow=null,t.shimmerTime=null,t.shimmerWave=null),t.flashWave&&(t.flashWave=null,t.flashWaveData=null)}),this.activeGestures.clear()}getCurrentGesture(){const e=performance.now(),t=this.gestureAnimations.rain;if(t?.active){const i=e-t.startTime,a=t.duration||3e3;Math.min(i/a,1)}const i=["orbital","hula","wave","spin"];for(const t of i){const i=this.gestureAnimations[t];if(i&&i.active){const a=wl(t),s=e-i.startTime,n=i.duration||(i.params?i.params.duration:1e3),r=Math.min(s/n,1);return{name:t,particleMotion:a?.config?.particleMotion||{type:t,strength:i.params?.strength||1},progress:r,params:i.params}}}for(const[t,i]of Object.entries(this.gestureAnimations))if(i.active){const a=wl(t),s=e-i.startTime,n=i.duration||(i.params?i.params.duration:1e3),r=Math.min(s/n,1),o={name:t,particleMotion:a?.config?.particleMotion||i.params?.particleMotion||{type:t,strength:i.params?.strength||1},progress:r,params:i.params};return"breathe"===t&&void 0!==i.breathPhase&&(o.breathPhase=i.breathPhase),o}return null}applyEasing(e,t){switch(t){case"linear":default:return e;case"quad":return e*e;case"cubic":return e*e*e;case"sine":return Math.sin(e*Math.PI/2);case"back":return e*e*(2.7*e-1.7)}}applyBounce(e,t){return this.physicalGestureAnimator.applyBounce(e,t)}applyPulse(e,t){return this.shapeTransformAnimator.applyPulse(e,t)}applyShake(e,t){return this.physicalGestureAnimator.applyShake(e,t)}applySpin(e,t){return this.movementGestureAnimator.applySpin(e,t)}applyNod(e,t){return this.expressionGestureAnimator.applyNod(e,t)}applyTilt(e,t){return this.expressionGestureAnimator.applyTilt(e,t)}applyExpand(e,t){return this.shapeTransformAnimator.applyExpand(e,t)}applyContract(e,t){return this.shapeTransformAnimator.applyContract(e,t)}applyFlash(e,t){return this.visualEffectAnimator.applyFlash(e,t)}applyDrift(e,t){return this.movementGestureAnimator.applyDrift(e,t)}applyStretch(e,t){return this.shapeTransformAnimator.applyStretch(e,t)}applyGlow(e,t){return this.visualEffectAnimator.applyGlow(e,t)}applyFlashWave(e,t){return this.complexAnimationAnimator.applyFlashWave(e,t)}applyFlicker(e,t){return this.visualEffectAnimator.applyFlicker(e,t)}applyVibrate(e,t){return this.physicalGestureAnimator.applyVibrate(e,t)}applyWave(e,t){return this.movementGestureAnimator.applyWave(e,t)}applyBreathe(e,t){return this.breathGestureAnimator.applyBreathe(e,t)}applyMorph(e,t){return this.shapeTransformAnimator.applyMorph(e,t)}applySlowBlink(e,t){return this.expressionGestureAnimator.applySlowBlink(e,t)}applyLook(e,t){return this.expressionGestureAnimator.applyLook(e,t)}applySettle(e,t){return this.expressionGestureAnimator.applySettle(e,t)}applyBreathIn(e,t){return this.breathGestureAnimator.applyBreathIn(e,t)}applyBreathOut(e,t){return this.breathGestureAnimator.applyBreathOut(e,t)}applyBreathHold(e,t){return this.breathGestureAnimator.applyBreathHold(e,t)}applyBreathHoldEmpty(e,t){return this.breathGestureAnimator.applyBreathHoldEmpty(e,t)}applyJump(e,t){return this.physicalGestureAnimator.applyJump(e,t)}applySway(e,t){return this.movementGestureAnimator.applySway(e,t)}applyRain(e,t){return this.complexAnimationAnimator.applyRain(e,t)}applyFloat(e,t){return this.movementGestureAnimator.applyFloat(e,t)}applyOrbital(e,t){return this.movementGestureAnimator.applyOrbital(e,t)}applyHula(e,t){return this.movementGestureAnimator.applyHula(e,t)}applySparkle(e,t){return this.visualEffectAnimator.applySparkle(e,t)}applyShimmer(e,t){return this.visualEffectAnimator.applyShimmer(e,t)}applyWiggle(e,t){return this.physicalGestureAnimator.applyWiggle(e,t)}applyGroove(e,t){return this.complexAnimationAnimator.applyGroove(e,t)}applyPoint(e,t){return this.directionalGestureAnimator.applyPoint(e,t)}applyLean(e,t){return this.directionalGestureAnimator.applyLean(e,t)}applyReach(e,t){return this.directionalGestureAnimator.applyReach(e,t)}applyHeadBob(e,t){return this.complexAnimationAnimator.applyHeadBob(e,t)}applyOrbit(e,t){return this.movementGestureAnimator.applyOrbit(e,t)}startBounce(){this.startGesture("bounce")}startPulse(){this.startGesture("pulse")}startShake(){this.startGesture("shake")}startSpin(){this.startGesture("spin")}startNod(){this.startGesture("nod")}startTilt(){this.startGesture("tilt")}startExpand(){this.startGesture("expand")}startContract(){this.startGesture("contract")}startFlash(){this.startGesture("flash")}startDrift(){this.startGesture("drift")}startStretch(){this.startGesture("stretch")}startGlow(){this.startGesture("glow")}startFlicker(){this.startGesture("flicker")}startVibrate(){this.startGesture("vibrate")}startOrbital(){this.startGesture("orbital")}startHula(){this.startGesture("hula")}startWave(){this.startGesture("wave")}startBreathe(){this.startGesture("breathe")}startMorph(){this.startGesture("morph")}startSlowBlink(){this.startGesture("slowBlink")}startLook(){this.startGesture("look")}startSettle(){this.startGesture("settle")}startBreathIn(){this.startGesture("breathIn")}startBreathOut(){this.startGesture("breathOut")}startBreathHold(){this.startGesture("breathHold")}startBreathHoldEmpty(){this.startGesture("breathHoldEmpty")}startJump(){this.startGesture("jump")}startSway(){this.startGesture("sway")}startFloat(){this.startGesture("float")}startRain(){this.startGesture("rain")}startRunningMan(){this.startGesture("runningman")}startCharleston(){this.startGesture("charleston")}startSparkle(){this.startGesture("sparkle")}startShimmer(){this.startGesture("shimmer")}startWiggle(){this.startGesture("wiggle")}startGroove(){this.startGesture("groove")}startPoint(){this.startGesture("point")}startLean(){this.startGesture("lean")}startReach(){this.startGesture("reach")}startHeadBob(){this.startGesture("headBob")}startOrbit(){this.startGesture("orbit")}applyRunningMan(e,t){return this.complexAnimationAnimator.applyRunningMan(e,t)}applyCharleston(e,t){return this.complexAnimationAnimator.applyCharleston(e,t)}startRunningManGesture(){this.startGesture("runningman")}startCharlestonGesture(){this.startGesture("charleston")}pauseCurrentAnimation(){const e=performance.now();for(const[,t]of Object.entries(this.gestureAnimations))t.active&&(t.pausedAt=e,t.pausedProgress=t.progress);this.isPaused=!0}resumeAnimation(){if(!this.isPaused)return;const e=performance.now();for(const[,t]of Object.entries(this.gestureAnimations))if(t.active&&t.pausedAt){const i=e-t.pausedAt;t.startTime&&(t.startTime+=i),delete t.pausedAt,delete t.pausedProgress}this.isPaused=!1}reset(){for(const[,e]of Object.entries(this.gestureAnimations))e.active=!1,e.progress=0,e.params={},delete e.startTime,delete e.pausedAt,delete e.pausedProgress;this.activeGestures.clear(),this.isPaused=!1}destroy(){this.stopAllGestures(),this.physicalGestureAnimator&&"function"==typeof this.physicalGestureAnimator.destroy&&this.physicalGestureAnimator.destroy(),this.visualEffectAnimator&&"function"==typeof this.visualEffectAnimator.destroy&&this.visualEffectAnimator.destroy(),this.breathGestureAnimator&&"function"==typeof this.breathGestureAnimator.destroy&&this.breathGestureAnimator.destroy(),this.movementGestureAnimator&&"function"==typeof this.movementGestureAnimator.destroy&&this.movementGestureAnimator.destroy(),this.shapeTransformAnimator&&"function"==typeof this.shapeTransformAnimator.destroy&&this.shapeTransformAnimator.destroy(),this.expressionGestureAnimator&&"function"==typeof this.expressionGestureAnimator.destroy&&this.expressionGestureAnimator.destroy(),this.directionalGestureAnimator&&"function"==typeof this.directionalGestureAnimator.destroy&&this.directionalGestureAnimator.destroy(),this.complexAnimationAnimator&&"function"==typeof this.complexAnimationAnimator.destroy&&this.complexAnimationAnimator.destroy(),this.physicalGestureAnimator=null,this.visualEffectAnimator=null,this.breathGestureAnimator=null,this.movementGestureAnimator=null,this.shapeTransformAnimator=null,this.expressionGestureAnimator=null,this.directionalGestureAnimator=null,this.complexAnimationAnimator=null,this.gestureAnimations=null,this.activeGestures.clear(),this.activeGestures=null,this.renderer=null,this.scaleFactor=null,this.isPaused=!1}}class ql{constructor(){this.colorTransition=null}applyUndertoneModifiers(e,t){return t}applyUndertoneToColor(e,t){if(t&&"object"==typeof t&&void 0!==t.weight){const{weight:i}=t,a=t.type||"clear";if("clear"===a||0===i)return e;const s=this.applyUndertoneSaturation(e,a),n=this.hexToRgb(e),r=this.hexToRgb(s),o=Math.round(n.r+(r.r-n.r)*i),l=Math.round(n.g+(r.g-n.g)*i),h=Math.round(n.b+(r.b-n.b)*i);return this.rgbToHex(o,l,h)}return t&&"clear"!==t?this.applyUndertoneSaturation(e,t):e}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}rgbToHsl(e,t,i){e/=255,t/=255,i/=255;const a=Math.max(e,t,i),s=Math.min(e,t,i),n=(a+s)/2;let r,o;if(a===s)r=o=0;else{const l=a-s;switch(o=n>.5?l/(2-a-s):l/(a+s),a){case e:r=((t-i)/l+(t<i?6:0))/6;break;case t:r=((i-e)/l+2)/6;break;case i:r=((e-t)/l+4)/6}}return{h:360*r,s:100*o,l:100*n}}hslToHex(e,t,i){let a,s,n;if(e/=360,i/=100,0==(t/=100))a=s=n=i;else{const r=(e,t,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e),o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;a=r(l,o,e+1/3),s=r(l,o,e),n=r(l,o,e-1/3)}const r=e=>{const t=Math.round(255*e).toString(16);return 1===t.length?`0${t}`:t};return`#${r(a)}${r(s)}${r(n)}`}applyUndertoneSaturation(e,t){const i=this.hexToRgb(e),a=this.rgbToHsl(i.r,i.g,i.b),s={intense:1.5,confident:1.3,energetic:1.2,upbeat:1.2,nervous:1.15,mellow:.8,tired:.8,subdued:.5}[t]||1;return a.s=Math.min(100,a.s*s),this.hslToHex(a.h,a.s,a.l)}rgbToHex(e,t,i){const a=e=>{const t=Math.round(e).toString(16);return 1===t.length?`0${t}`:t};return`#${a(e)}${a(t)}${a(i)}`}startColorTransition(e,t,i=1500){this.currentColor===e&&this.currentIntensity===t||(this.colorTransition={active:!0,fromColor:this.currentColor||"#ffffff",toColor:e,fromIntensity:this.currentIntensity||1,toIntensity:t,progress:0,startTime:performance.now(),duration:i})}updateColorTransition(e){if(!this.colorTransition||!this.colorTransition.active)return null;const t=performance.now()-this.colorTransition.startTime,i=Math.min(t/this.colorTransition.duration,1),a=1-Math.pow(1-i,2),s=this.hexToRgb(this.colorTransition.fromColor),n=this.hexToRgb(this.colorTransition.toColor),r=Math.round(s.r+(n.r-s.r)*a),o=Math.round(s.g+(n.g-s.g)*a),l=Math.round(s.b+(n.b-s.b)*a),h=this.rgbToHex(r,o,l),c=this.colorTransition.fromIntensity+(this.colorTransition.toIntensity-this.colorTransition.fromIntensity)*a;return this.currentColor=h,this.currentIntensity=c,i>=1&&(this.colorTransition.active=!1),{color:h,intensity:c}}}class Rl{constructor(e){this.renderer=e,this.ctx=e.ctx,this.canvas=e.canvasManager?.canvas||e.canvas,this.recordingActive=!1,this.sleepMode=!1,this.speakingActive=!1,this.zenModeActive=!1,this.speakingRings=[],this.ringSpawnTimer=0,this.ringSpawnInterval=300,this.maxRings=3,this.sleepZ=[],this.sparkles=[],this.chromaticAberration={active:!1,intensity:0,targetIntensity:0,fadeSpeed:.01,maxOffset:30},this.scaleValue=t=>e.scaleValue(t),this.hexToRgba=(t,i)=>e.hexToRgba(t,i)}renderRecordingGlow(e,t,i,a){const{ctx:s}=this,n=2.5*i,r=s.createRadialGradient(e,t,0,e,t,n);r.addColorStop(0,`rgba(255, 0, 0, ${.3*a})`),r.addColorStop(.5,`rgba(255, 0, 0, ${.15*a})`),r.addColorStop(1,"rgba(255, 0, 0, 0)"),s.save(),s.globalCompositeOperation="screen",s.fillStyle=r,s.fillRect(e-n,t-n,2*n,2*n),s.restore()}renderRecordingIndicator(e,t){const i=Date.now()/1e3,a=.8+.2*Math.sin(2*i);this.ctx.save(),this.ctx.translate(e,t),this.ctx.shadowBlur=this.scaleValue(15),this.ctx.shadowColor=`rgba(255, 0, 0, ${.8*a})`;const s=this.scaleValue(80);this.ctx.font=`italic 900 ${s}px "Poppins", sans-serif`,this.ctx.fillStyle=`rgba(255, 0, 0, ${a})`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("REC",0,0),this.ctx.shadowBlur=0,this.ctx.font=`italic 900 ${s-1}px "Poppins", sans-serif`,this.ctx.fillStyle=`rgba(255, 255, 255, ${.3*a})`,this.ctx.fillText("REC",-.5,-.5),this.ctx.restore()}renderSleepIndicator(e,t,i){if(this.ringSpawnTimer+=i,this.ringSpawnTimer>=2e3&&this.sleepZ.length<3){const i=["300","500","700","900"],a=i[Math.floor(Math.random()*i.length)],s=Math.random()>.5?"Z":"z";this.sleepZ.push({x:e+Math.random()*this.scaleValue(30)-this.scaleValue(15),y:t+this.scaleValue(80),size:this.scaleValue(3*(24+8*Math.random())),opacity:1,speed:-.025,drift:Math.random()*this.scaleValue(20)-this.scaleValue(10),lifetime:0,rotation:30*Math.random()-15,text:s,weight:a}),this.ringSpawnTimer=0}this.sleepZ=this.sleepZ.filter(e=>{if(e.lifetime+=i,e.y+=e.speed*i,e.x+=Math.sin(8e-4*e.lifetime)*e.drift*.008,e.rotation+=.01*i,e.lifetime<2e3?e.opacity=1:e.lifetime<4e3?e.opacity=1-(e.lifetime-2e3)/2e3:e.opacity=0,e.opacity>.01){this.ctx.save(),this.ctx.translate(e.x,e.y),this.ctx.rotate(e.rotation*Math.PI/180);const t=this.renderer.state.glowColor||"#4a90e2";this.ctx.shadowBlur=this.scaleValue(15),this.ctx.shadowColor=this.hexToRgba(t,.5*e.opacity);const i=this.ctx.createLinearGradient(-e.size/2,-e.size/2,e.size/2,e.size/2);return i.addColorStop(0,this.hexToRgba(t,e.opacity)),i.addColorStop(.5,this.hexToRgba("#ffffff",.9*e.opacity)),i.addColorStop(1,this.hexToRgba(t,.7*e.opacity)),this.ctx.font=`italic ${e.weight||"900"} ${e.size}px 'Poppins', sans-serif`,this.ctx.fillStyle=i,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e.text||"Z",0,0),this.ctx.shadowBlur=0,this.ctx.font=`italic ${e.weight||"900"} ${.9*e.size}px 'Poppins', sans-serif`,this.ctx.fillStyle=this.hexToRgba("#ffffff",.3*e.opacity),this.ctx.fillText(e.text||"Z",-1,-1),this.ctx.restore(),!0}return!1})}renderSpeakingRings(e,t,i,a){this.ringSpawnTimer+=a,this.ringSpawnTimer>=this.ringSpawnInterval&&this.speakingRings.length<this.maxRings&&(this.speakingRings.push({radius:i,opacity:.8,speed:.15}),this.ringSpawnTimer=0),this.speakingRings=this.speakingRings.filter(s=>(s.radius+=s.speed*a,s.opacity=Math.max(0,.8*(1-(s.radius-i)/(2*i))),s.opacity>.01&&(this.ctx.strokeStyle=this.hexToRgba(this.renderer.state.glowColor,s.opacity),this.ctx.lineWidth=this.scaleValue(2),this.ctx.beginPath(),this.ctx.arc(e,t,s.radius,0,2*Math.PI),this.ctx.stroke(),!0)))}renderZenCore(e,t,i,a){const{ctx:s}=this,n=i*(.9+.1*(.5*Math.sin(.001*a)+.5)),r=s.createRadialGradient(e,t,0,e,t,n);r.addColorStop(0,"rgba(147, 112, 219, 0.8)"),r.addColorStop(.7,"rgba(147, 112, 219, 0.3)"),r.addColorStop(1,"rgba(147, 112, 219, 0)"),s.save(),s.globalCompositeOperation="screen",s.fillStyle=r,s.beginPath(),s.arc(e,t,1.5*n,0,2*Math.PI),s.fill(),s.restore()}startRecording(){this.recordingActive=!0}stopRecording(){this.recordingActive=!1}enterSleepMode(){this.sleepMode=!0}wakeUp(){this.sleepMode=!1}startSpeaking(){this.speakingActive=!0}stopSpeaking(){this.speakingActive=!1}createSparkle(e,t,i={}){this.sparkles.push({x:e,y:t,vx:i.velocity?.x||0,vy:i.velocity?.y||0,size:i.size||3,color:i.color||"hsl(50, 100%, 70%)",lifetime:i.lifetime||1e3,maxLifetime:i.lifetime||1e3,rotation:Math.random()*Math.PI*2,rotationSpeed:.2*(Math.random()-.5)})}renderSparkles(){const{ctx:e}=this;this.sparkles.forEach(t=>{const i=1-t.lifetime/t.maxLifetime,a=1-i;e.save(),e.translate(t.x,t.y),e.rotate(t.rotation);const s=this.scaleValue(t.size*(1-.5*i));e.beginPath();const n=s,r=.38*s;for(let t=0;t<10;t++){const i=t*Math.PI/5-Math.PI/2,a=t%2==0?n:r;0===t?e.moveTo(Math.cos(i)*a,Math.sin(i)*a):e.lineTo(Math.cos(i)*a,Math.sin(i)*a)}e.closePath(),e.shadowBlur=this.scaleValue(10),e.shadowColor=t.color,e.fillStyle=t.color.replace("70%",70+30*i+"%").replace(")",`, ${a})`).replace("hsl","hsla"),e.fill(),e.restore()})}triggerChromaticAberration(e=.8){this.chromaticAberration.active=!0,this.chromaticAberration.targetIntensity=Math.min(1,e),this.chromaticAberration.intensity=this.chromaticAberration.targetIntensity;const t=document.getElementById("emotive-canvas")||document.querySelector("canvas")||this.canvas;if(t){if(t.style.animation="none",!document.getElementById("chromatic-styles")){const e=document.createElement("style");e.id="chromatic-styles",e.textContent="\n                    @keyframes chromaticGlitch {\n                        0% {\n                            filter: none;\n                            transform: translateX(0);\n                        }\n                        15% {\n                            filter: drop-shadow(-2px 0 0 rgba(255,0,0,0.7)) drop-shadow(2px 0 0 rgba(0,255,255,0.7));\n                            transform: translateX(-0.5px);\n                        }\n                        30% {\n                            filter: drop-shadow(-3px 0 0 rgba(255,0,0,0.8)) drop-shadow(3px 0 0 rgba(0,255,255,0.8));\n                            transform: translateX(0.5px);\n                        }\n                        45% {\n                            filter: drop-shadow(-2px 0 0 rgba(255,0,0,0.6)) drop-shadow(2px 0 0 rgba(0,255,255,0.6));\n                            transform: translateX(-0.3px);\n                        }\n                        60% {\n                            filter: drop-shadow(-1px 0 0 rgba(255,0,0,0.4)) drop-shadow(1px 0 0 rgba(0,255,255,0.4));\n                            transform: translateX(0.2px);\n                        }\n                        100% {\n                            filter: none;\n                            transform: translateX(0);\n                        }\n                    }\n                ",document.head.appendChild(e)}t.style.animation=`chromaticGlitch ${300+200*e}ms ease-out`}}applyChromaticAberration(e,t){if(!this.chromaticAberration.active||this.chromaticAberration.intensity<=0)return;const{intensity:i}=this.chromaticAberration,a=this.scaleValue(this.chromaticAberration.maxOffset*i),s=e.globalCompositeOperation;e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation="source-over",e.filter="url(#red-channel)",e.drawImage(t,-a,0),e.globalCompositeOperation="screen",e.filter="url(#green-channel)",e.drawImage(t,0,0),e.globalCompositeOperation="screen",e.filter="url(#blue-channel)",e.drawImage(t,a,0),e.filter="none",e.globalCompositeOperation=s,e.restore()}applyChromaticAberrationSimple(e,t,i,a,s){if(!this.chromaticAberration.active||this.chromaticAberration.intensity<=0)return void s();const{intensity:n}=this.chromaticAberration,r=this.scaleValue(this.chromaticAberration.maxOffset*n);e.save(),e.globalCompositeOperation="source-over",e.translate(-r,0),e.globalAlpha=.33,e.fillStyle="#ff0000",e.filter="brightness(3)",s(),e.translate(r,0),e.globalCompositeOperation="screen",e.globalAlpha=.33,e.fillStyle="#00ff00",s(),e.translate(r,0),e.globalAlpha=.33,e.fillStyle="#0000ff",s(),e.restore()}update(e){this.sparkles=this.sparkles.filter(t=>(t.x+=t.vx,t.y+=t.vy,t.rotation+=t.rotationSpeed,t.lifetime-=e,t.vy+=.1,t.lifetime>0)),this.chromaticAberration.active&&(this.chromaticAberration.intensity-=this.chromaticAberration.fadeSpeed,this.chromaticAberration.intensity<=0&&(this.chromaticAberration.intensity=0,this.chromaticAberration.active=!1,this.chromaticAberration.targetIntensity=0))}destroy(){this.speakingRings=[],this.sleepZ=[],this.sparkles=[],this.recordingActive=!1,this.sleepMode=!1,this.speakingActive=!1,this.zenModeActive=!1,this.chromaticAberration.active=!1,this.chromaticAberration.intensity=0,this.chromaticAberration.targetIntensity=0,this.ringSpawnTimer=0,this.renderer=null,this.ctx=null,this.canvas=null}}class Bl{constructor(e){this.renderer=e,this.ctx=e.ctx,this.canvas=e.canvas,this.blinking=!1,this.blinkingEnabled=!0,this.blinkTimer=0,this.nextBlinkTime=this.getRandomBlinkTime(),this.squintAmount=0,this.eyeClose=null,this.eyeOpen=null,this.scaleValue=t=>e.scaleValue(t),this.hexToRgba=(t,i)=>e.hexToRgba(t,i)}update(e){this.blinking&&(this.blinkTimer+=e,this.blinkTimer>=150&&(this.blinking=!1,this.blinkTimer=0,this.nextBlinkTime=Date.now()+this.getRandomBlinkTime())),this.blinkingEnabled&&!this.blinking&&Date.now()>=this.nextBlinkTime&&this.startBlink()}startBlink(){this.blinkingEnabled&&(this.blinking=!0,this.blinkTimer=0)}getRandomBlinkTime(){return 3e3+4e3*Math.random()}getBlinkScale(){if(!this.blinking)return 1;const e=Math.min(this.blinkTimer/150,1);return 1-.7*Math.sin(e*Math.PI)}drawEyes(e,t,i,a,s={}){const{ctx:n}=this,r=s.eyeOpenness||1,o=s.eyeExpression||"neutral";if("zen"===a||"neutral"===a||r<=0)return;n.save(),n.strokeStyle="rgba(0, 0, 0, 0.3)",n.lineWidth=this.scaleValue(2),n.lineCap="round";const l=.4*i,h=t-.1*i,c=.25*i;switch(o){case"happy":this.drawHappyEyes(n,e,h,l,c,r);break;case"sad":this.drawSadEyes(n,e,h,l,c,r);break;case"angry":this.drawAngryEyes(n,e,h,l,c,r);break;case"surprised":this.drawSurprisedEyes(n,e,h,l,c,r);break;case"focused":this.drawFocusedEyes(n,e,h,l,c,r);break;case"sleepy":this.drawSleepyEyes(n,e,h,l,c,r);break;case"suspicious":this.drawSuspiciousEyes(n,e,h,l,c,r)}n.restore()}drawHappyEyes(e,t,i,a,s,n){e.beginPath(),e.arc(t-a,i,s,.2*Math.PI,.8*Math.PI,!1),e.stroke(),e.beginPath(),e.arc(t+a,i,s,.2*Math.PI,.8*Math.PI,!1),e.stroke()}drawSadEyes(e,t,i,a,s,n){e.beginPath(),e.arc(t-a,i+.5*s,s,1.2*Math.PI,1.8*Math.PI,!1),e.stroke(),e.beginPath(),e.arc(t+a,i+.5*s,s,1.2*Math.PI,1.8*Math.PI,!1),e.stroke()}drawAngryEyes(e,t,i,a,s,n){e.beginPath(),e.moveTo(t-a-s,i-.3*s),e.lineTo(t-a+.5*s,i+.3*s),e.stroke(),e.beginPath(),e.moveTo(t+a+s,i-.3*s),e.lineTo(t+a-.5*s,i+.3*s),e.stroke()}drawSurprisedEyes(e,t,i,a,s,n){e.beginPath(),e.arc(t-a,i,1.2*s,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(t+a,i,1.2*s,0,2*Math.PI),e.stroke()}drawFocusedEyes(e,t,i,a,s,n){e.fillStyle="rgba(0, 0, 0, 0.4)",e.beginPath(),e.arc(t-a,i,.3*s,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(t+a,i,.3*s,0,2*Math.PI),e.fill()}drawSleepyEyes(e,t,i,a,s,n){e.beginPath(),e.moveTo(t-a-s,i),e.lineTo(t-a+s,i),e.stroke(),e.beginPath(),e.moveTo(t+a-s,i),e.lineTo(t+a+s,i),e.stroke()}drawSuspiciousEyes(e,t,i,a,s,n){e.beginPath(),e.moveTo(t-a-s,i),e.lineTo(t-a+.7*s,i),e.stroke(),e.beginPath(),e.arc(t+a,i,.8*s,.1*Math.PI,.9*Math.PI,!1),e.stroke()}setBlinkingEnabled(e){this.blinkingEnabled=e,e||(this.blinking=!1,this.blinkTimer=0)}setSquintAmount(e){this.squintAmount=Math.max(0,Math.min(1,e))}forceBlink(){this.startBlink()}}class El{constructor(e){this.renderer=e,this.breathingSpeed=.42,this.breathingDepth=.08,this.breathingPhase=0,this.breathRate=1,this.breathDepth=this.breathingDepth,this.breathRateMult=1,this.breathDepthMult=1,this.breathIrregular=!1,this.customScale=null,this.emotionBreathPatterns={happy:{rate:1.1,depth:1.2},sad:{rate:.8,depth:.7},angry:{rate:1.4,depth:1.3},calm:{rate:.7,depth:.9},excited:{rate:1.5,depth:1.4},focused:{rate:.9,depth:.6},neutral:{rate:1,depth:1},love:{rate:1.2,depth:1.3},surprised:{rate:1.3,depth:1.1},confused:{rate:1.1,depth:.9},amused:{rate:1.2,depth:1.1},bored:{rate:.6,depth:.8},tired:{rate:.5,depth:1.2},anxious:{rate:1.6,depth:.9},determined:{rate:1.1,depth:1},proud:{rate:.9,depth:1.3},content:{rate:.8,depth:1},hopeful:{rate:1,depth:1.1},zen:{rate:.4,depth:1.5},intrigued:{rate:1.1,depth:.8},embarrassed:{rate:1.3,depth:.7},grateful:{rate:.9,depth:1.1},inspired:{rate:1,depth:1.3},silly:{rate:1.4,depth:1.2},sleepy:{rate:.3,depth:1.4}}}update(e,t,i={}){i=i||{};const a=this.emotionBreathPatterns[t]||{rate:1,depth:1},s=i?.breathRateMult||1,n=i?.breathDepthMult||1;this.breathRate=a.rate*this.breathRateMult*s,this.breathDepth=this.breathingDepth*a.depth*this.breathDepthMult*n;let r=this.breathingSpeed*this.breathRate*(e/1e3);this.breathIrregular&&i?.breathIrregular&&(r*=.8+.4*Math.sin(3e-4*Date.now())),this.breathingPhase+=r,this.breathingPhase>2*Math.PI&&(this.breathingPhase-=2*Math.PI)}getBreathingScale(){return null!==this.customScale?this.customScale:1+Math.sin(this.breathingPhase)*this.breathDepth}setCustomScale(e){this.customScale=e}setBreathingSpeed(e){this.breathingSpeed=e}setBreathingDepth(e){this.breathingDepth=Math.max(0,Math.min(1,e))}setBreathRateMultiplier(e){this.breathRateMult=e}setBreathDepthMultiplier(e){this.breathDepthMult=e}setIrregularBreathing(e){this.breathIrregular=e}reset(){this.breathingPhase=0,this.breathRate=1,this.breathDepth=this.breathingDepth,this.breathRateMult=1,this.breathDepthMult=1,this.breathIrregular=!1,this.customScale=null}holdBreath(e=!1){this.customScale=e?.92:1.08}releaseBreath(){this.customScale=null}getBreathingInfo(){return{phase:this.breathingPhase,rate:this.breathRate,depth:this.breathDepth,scale:this.getBreathingScale(),isCustom:null!==this.customScale,isIrregular:this.breathIrregular}}}const Pl=new class{constructor(){this.cache=new Map,this.stats={hits:0,misses:0,evictions:0},this.maxSize=100,this.ttl=6e4,this.accessOrder=[],this.cleanupInterval=setInterval(()=>{this.clearExpired()},6e4)}generateKey(e,t){if("radial"===e){const{x0:e,y0:i,r0:a,x1:s,y1:n,r1:r,stops:o}=t;return`radial:${e},${i},${a},${s},${n},${r}:${o.map(e=>`${e.offset}:${e.color}`).join("|")}`}if("linear"===e){const{x0:e,y0:i,x1:a,y1:s,stops:n}=t;return`linear:${e},${i},${a},${s}:${n.map(e=>`${e.offset}:${e.color}`).join("|")}`}return null}getRadialGradient(e,t,i,a,s,n,r,o){const l=this.generateKey("radial",{x0:t,y0:i,r0:a,x1:s,y1:n,r1:r,stops:o}),h=this.cache.get(l);if(h&&Date.now()-h.timestamp<this.ttl)return this.stats.hits++,this.updateAccessOrder(l),h.gradient;this.stats.misses++;const c=e.createRadialGradient(t,i,a,s,n,r);return o.forEach(e=>{c.addColorStop(e.offset,e.color)}),this.set(l,c),c}getLinearGradient(e,t,i,a,s,n){const r=this.generateKey("linear",{x0:t,y0:i,x1:a,y1:s,stops:n}),o=this.cache.get(r);if(o&&Date.now()-o.timestamp<this.ttl)return this.stats.hits++,this.updateAccessOrder(r),o.gradient;this.stats.misses++;const l=e.createLinearGradient(t,i,a,s);return n.forEach(e=>{l.addColorStop(e.offset,e.color)}),this.set(r,l),l}set(e,t){this.cache.size>=this.maxSize&&!this.cache.has(e)&&this.evictLRU(),this.cache.set(e,{gradient:t,timestamp:Date.now()}),this.updateAccessOrder(e)}updateAccessOrder(e){const t=this.accessOrder.indexOf(e);t>-1&&this.accessOrder.splice(t,1),this.accessOrder.push(e)}evictLRU(){if(this.accessOrder.length>0){const e=this.accessOrder.shift();this.cache.delete(e),this.stats.evictions++}}clear(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.cache.clear(),this.accessOrder=[]}clearExpired(){const e=Date.now(),t=[];for(const[i,a]of this.cache.entries())e-a.timestamp>=this.ttl&&t.push(i);t.forEach(e=>{this.cache.delete(e);const t=this.accessOrder.indexOf(e);t>-1&&this.accessOrder.splice(t,1)})}destroy(){this.clear()}getStats(){const e=this.stats.hits+this.stats.misses>0?(this.stats.hits/(this.stats.hits+this.stats.misses)*100).toFixed(2):0;return{size:this.cache.size,maxSize:this.maxSize,hits:this.stats.hits,misses:this.stats.misses,evictions:this.stats.evictions,hitRate:`${e}%`}}createHelper(e){return{radial:(t,i,a,s,n,r,o)=>this.getRadialGradient(e,t,i,a,s,n,r,o),linear:(t,i,a,s,n)=>this.getLinearGradient(e,t,i,a,s,n)}}};class Tl{constructor(e){this.renderer=e,this.ctx=e.ctx,this.canvas=e.canvas,this.glowIntensity=1,this.glowColor="#4a90e2",this.targetGlowColor="#4a90e2",this.glowColorTransition=0,this.glowColorTransitionSpeed=.05,this.offscreenCanvas=null,this.offscreenCtx=null,this.cachedGlowColor=null,this.cachedGlowRadius=0,this.scaleValue=t=>e.scaleValue(t),this.hexToRgba=(t,i)=>e.hexToRgba(t,i),this.initOffscreenCanvas()}initOffscreenCanvas(){this.offscreenCanvas=document.createElement("canvas"),this.offscreenCtx=this.offscreenCanvas.getContext("2d")}updateOffscreenSize(e){this.offscreenCanvas.width===e&&this.offscreenCanvas.height===e||(this.offscreenCanvas.width=e,this.offscreenCanvas.height=e,this.cachedGlowColor=null)}renderGlow(e,t,i,a={}){const{ctx:s}=this,n=a.color||this.glowColor,r=void 0!==a.intensity?a.intensity:this.glowIntensity;r<.01||this.renderGlowDirect(s,e,t,i,n,r)}cacheGlowGradient(e,t){const i=this.offscreenCtx,a=t;this.updateOffscreenSize(2*t),i.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height);const s=Pl.getRadialGradient(i,a,a,0,a,a,t,[{offset:0,color:this.hexToRgba(e,.4)},{offset:.3,color:this.hexToRgba(e,.2)},{offset:.6,color:this.hexToRgba(e,.1)},{offset:1,color:this.hexToRgba(e,0)}]);i.fillStyle=s,i.fillRect(0,0,2*t,2*t),this.cachedGlowColor=e,this.cachedGlowRadius=t}renderGlowDirect(e,t,i,a,s,n){e.save(),e.globalCompositeOperation="screen";const r=[];for(let e=0;e<=20;e++){const t=e/20,i=.6*Math.pow(1-t,2.2),a=Math.max(0,Math.min(1,i*n));r.push({offset:t,color:this.hexToRgba(s,a)})}const o=Pl.getRadialGradient(e,t,i,0,t,i,a,r);e.fillStyle=o,e.beginPath(),e.arc(t,i,a,0,2*Math.PI),e.fill(),e.restore()}renderRecordingGlow(e,t,i,a){const{ctx:s}=this,n=2.5*i,r=Pl.getRadialGradient(s,e,t,0,e,t,n,[{offset:0,color:`rgba(255, 0, 0, ${.3*a})`},{offset:.5,color:`rgba(255, 0, 0, ${.15*a})`},{offset:1,color:"rgba(255, 0, 0, 0)"}]);s.save(),s.globalCompositeOperation="screen",s.fillStyle=r,s.fillRect(e-n,t-n,2*n,2*n),s.restore()}renderZenGlow(e,t,i,a){const{ctx:s}=this,n=i*(.9+.1*(.5*Math.sin(.001*a)+.5)),r=Pl.getRadialGradient(s,e,t,0,e,t,n,[{offset:0,color:"rgba(147, 112, 219, 0.8)"},{offset:.7,color:"rgba(147, 112, 219, 0.3)"},{offset:1,color:"rgba(147, 112, 219, 0)"}]);s.save(),s.globalCompositeOperation="screen",s.fillStyle=r,s.beginPath(),s.arc(e,t,1.5*n,0,2*Math.PI),s.fill(),s.restore()}updateGlowColor(e,t){this.targetGlowColor!==e&&(this.targetGlowColor=e,this.glowColorTransition=0),this.glowColorTransition<1&&(this.glowColorTransition=Math.min(1,this.glowColorTransition+this.glowColorTransitionSpeed),this.glowColor=this.lerpColor(this.glowColor,this.targetGlowColor,this.glowColorTransition))}lerpColor(e,t,i){const a=this.hexToRgb(e),s=this.hexToRgb(t);return`#${((1<<24)+(Math.round(a.r+(s.r-a.r)*i)<<16)+(Math.round(a.g+(s.g-a.g)*i)<<8)+Math.round(a.b+(s.b-a.b)*i)).toString(16).slice(1)}`}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}}setGlowIntensity(e){this.glowIntensity=Math.max(0,Math.min(1,e))}setGlowColor(e){this.glowColor=e,this.targetGlowColor=e,this.glowColorTransition=1}destroy(){this.offscreenCanvas&&(this.offscreenCtx&&(this.offscreenCtx.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),this.offscreenCtx=null),this.offscreenCanvas.width=0,this.offscreenCanvas.height=0,this.offscreenCanvas=null),this.cachedGlowColor=null,this.cachedGlowRadius=0}}class jl{constructor(e){this.renderer=e,this.ctx=e.ctx,this.canvas=e.canvas,this.coreColor="#FFFFFF",this.coreOpacity=1,this.coreBorderWidth=0,this.coreBorderColor=null,this.shapePoints=null,this.isMorphing=!1,this.scaleValue=t=>e.scaleValue(t),this.hexToRgba=(t,i)=>e.hexToRgba(t,i)}renderCore(e,t,i,a={}){const{ctx:s}=this,n=a.scaleX||1,r=a.scaleY||1,o=a.rotation||0,l=void 0!==a.opacity?a.opacity:this.coreOpacity,h=a.color||this.coreColor,c=a.shapePoints||this.shapePoints;s.save(),s.translate(e,t),0!==o&&s.rotate(o),s.scale(n,r),s.fillStyle=this.hexToRgba(h,l),c&&c.length>0?this.drawMorphedShape(s,c,i):this.drawCircle(s,i),this.coreBorderWidth>0&&this.coreBorderColor&&(s.strokeStyle=this.coreBorderColor,s.lineWidth=this.scaleValue(this.coreBorderWidth),s.stroke()),s.restore()}drawDropShadow(e,t,i){e.save();const a=this.scaleValue(2);if(e.translate(0,a),i&&i.length>32)e.fillStyle="rgba(0, 0, 0, 0.15)",e.beginPath(),e.arc(0,0,1.05*t,0,2*Math.PI),e.fill();else{const a=Pl.getRadialGradient(e,0,0,.7*t,0,0,1.2*t,[{offset:0,color:"rgba(0, 0, 0, 0.2)"},{offset:.8,color:"rgba(0, 0, 0, 0.1)"},{offset:1,color:"rgba(0, 0, 0, 0)"}]);if(e.fillStyle=a,e.beginPath(),i){const t=1.1,a=i.length>20?2:1;e.moveTo(i[0].x*t,i[0].y*t);for(let s=a;s<i.length;s+=a)e.lineTo(i[s].x*t,i[s].y*t);e.closePath()}else e.arc(0,0,1.1*t,0,2*Math.PI);e.fill()}e.restore()}drawCircle(e,t){e.beginPath(),e.arc(0,0,t,0,2*Math.PI),e.fill()}drawMorphedShape(e,t,i){!t||t.length<3?this.drawCircle(e,i):(e.beginPath(),t.forEach((t,i)=>{0===i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)}),e.closePath(),e.fill())}renderZenCore(e,t,i,a){const{ctx:s}=this,n=i*(.95+.05*(.5*Math.sin(.001*a)+.5));s.save(),s.shadowBlur=this.scaleValue(10),s.shadowColor="rgba(147, 112, 219, 0.3)",s.shadowOffsetX=0,s.shadowOffsetY=0,s.fillStyle="#FFFFFF",s.beginPath(),s.arc(e,t,n,0,2*Math.PI),s.fill(),s.strokeStyle="rgba(147, 112, 219, 0.2)",s.lineWidth=this.scaleValue(1),s.beginPath(),s.arc(e,t,.9*n,0,2*Math.PI),s.stroke(),s.restore()}renderSleepyCore(e,t,i){const{ctx:a}=this;a.save(),a.translate(e,t),a.scale(1,.85),a.fillStyle="#FFFFFF",a.beginPath(),a.arc(0,0,i,0,2*Math.PI),a.fill(),a.restore()}renderGlitchedCore(e,t,i,a){const{ctx:s}=this;s.save(),[{x:-2,y:0,alpha:.3},{x:2,y:0,alpha:.3},{x:0,y:-1,alpha:.2}].forEach(n=>{s.fillStyle=this.hexToRgba("#FFFFFF",n.alpha*a),s.beginPath(),s.arc(e+n.x*a*this.scaleValue(5),t+n.y*a*this.scaleValue(5),i,0,2*Math.PI),s.fill()}),s.fillStyle="#FFFFFF",s.beginPath(),s.arc(e,t,i,0,2*Math.PI),s.fill(),s.restore()}setShapePoints(e){this.shapePoints=e,this.isMorphing=e&&e.length>0}clearShapePoints(){this.shapePoints=null,this.isMorphing=!1}setCoreColor(e){this.coreColor=e}setCoreOpacity(e){this.coreOpacity=Math.max(0,Math.min(1,e))}setCoreBorder(e,t){this.coreBorderWidth=e,this.coreBorderColor=t}getCoreInfo(){return{color:this.coreColor,opacity:this.coreOpacity,hasBorder:this.coreBorderWidth>0,isMorphing:this.isMorphing,shapePointCount:this.shapePoints?this.shapePoints.length:0}}}class Vl{renderSunEffects(e,t,i,a,s){const n=Date.now()/100;if(e.save(),e.translate(t,i),s.texture&&(void 0===s.textureOpacity||s.textureOpacity>0)){e.save(),e.globalCompositeOperation="screen",e.globalAlpha=void 0!==s.textureOpacity?s.textureOpacity:1;const t=.05*n*(s.turbulence||.3)/.3,i=e.createRadialGradient(Math.sin(t)*a*.15,Math.cos(.7*t)*a*.15,.2*a,0,0,a);i.addColorStop(0,"rgba(255, 255, 200, 0)"),i.addColorStop(.4,"rgba(255, 200, 100, 0.1)"),i.addColorStop(.7,"rgba(255, 150, 50, 0.08)"),i.addColorStop(1,"rgba(255, 100, 30, 0.05)"),e.fillStyle=i,e.beginPath(),e.arc(0,0,a,0,2*Math.PI),e.fill(),e.restore()}const r=void 0!==s.coronaOpacity?s.coronaOpacity:1;if(r>0){e.save(),e.globalCompositeOperation="screen";const t=e.createRadialGradient(0,0,.5*a,0,0,1.1*a);t.addColorStop(0,`rgba(255, 255, 255, ${.8*r})`),t.addColorStop(.3,`rgba(255, 250, 200, ${.6*r})`),t.addColorStop(.5,`rgba(255, 200, 100, ${.4*r})`),t.addColorStop(.7,`rgba(255, 150, 50, ${.2*r})`),t.addColorStop(1,"rgba(255, 100, 20, 0)"),e.fillStyle=t,e.beginPath(),e.arc(0,0,1.1*a,0,2*Math.PI),e.fill();for(let t=0;t<2;t++){const i=1.3+.4*t,s=(.35-.15*t)*r,o=.05*Math.sin(.1*n+t),l=e.createRadialGradient(0,0,a*(.9+o),0,0,a*(i+o));l.addColorStop(0,"rgba(255, 255, 200, 0)"),l.addColorStop(.4,`rgba(255, 200, 100, ${.5*s})`),l.addColorStop(.7,`rgba(255, 150, 50, ${s})`),l.addColorStop(.9,`rgba(255, 100, 30, ${.5*s})`),l.addColorStop(1,"rgba(255, 50, 10, 0)"),e.fillStyle=l,e.beginPath(),e.arc(0,0,a*(i+o),0,2*Math.PI),e.fill()}e.restore()}if(s.flares){e.save();const t=Math.sin(.08*n),i=Math.sin(.12*n),s=Math.sin(.16*n),r=e.createLinearGradient(0,-a,0,3*-a);r.addColorStop(0,"rgba(255, 255, 230, 0.4)"),r.addColorStop(.2,"rgba(255, 220, 150, 0.25)"),r.addColorStop(.5,"rgba(255, 180, 80, 0.15)"),r.addColorStop(.8,"rgba(255, 120, 40, 0.08)"),r.addColorStop(1,"rgba(255, 60, 20, 0)"),e.fillStyle=r,e.globalCompositeOperation="screen",e.beginPath();const o=(t,i,s,n)=>{const r=Math.cos(t),o=Math.sin(t),l=r*a,h=o*a,c=r*(a+i),u=o*(a+i),d=-o*s*.5,p=r*s*.5,g=n*s*.3;e.moveTo(l-d,h-p),e.quadraticCurveTo(.5*(l+c)+d*g,.5*(h+u)+p*g,c,u),e.quadraticCurveTo(.5*(l+c)-d*g,.5*(h+u)-p*g,l+d,h+p)};for(let e=0;e<8;e++)o(e/8*Math.PI*2+.1*t,a*(1.8+.4*Math.sin(.1*n+.5*e)),.18*a,Math.sin(.15*n+e));for(let e=0;e<12;e++)o((e+.5)/12*Math.PI*2+.08*i,a*(1.2+.3*Math.sin(.13*n+.7*e)),.12*a,Math.sin(.18*n+1.2*e));for(let e=0;e<15;e++)o(e/15*Math.PI*2+.05*s,a*(.7+.25*Math.sin(.17*n+.9*e)),.08*a,Math.sin(.2*n+1.5*e));for(let t=0;t<15;t++){const i=(t+.25)/15*Math.PI*2,s=a*(.4+.2*Math.sin(.22*n+t)),r=.06*a,o=Math.cos(i),l=Math.sin(i),h=o*a,c=l*a,u=o*(a+s),d=l*(a+s),p=-l*r*.5,g=o*r*.5;e.moveTo(h-p,c-g),e.lineTo(u,d),e.lineTo(h+p,c+g)}e.fill(),e.restore()}const o=e.createRadialGradient(0,0,.95*a,0,0,1.05*a);o.addColorStop(0,"rgba(255, 255, 255, 0)"),o.addColorStop(.7,"rgba(255, 255, 200, 0.2)"),o.addColorStop(.9,"rgba(255, 200, 100, 0.5)"),o.addColorStop(1,"rgba(255, 150, 50, 0.3)"),e.fillStyle=o,e.beginPath(),e.arc(0,0,1.05*a,0,2*Math.PI),e.fill(),e.restore()}renderBaileysBeads(e,t,i,a,s,n,r,o,l,h=e=>e){if(!l)return void(this.J=null);const c=Math.abs(s)<1&&Math.abs(n)<1,u=o?30:15;if(!(Math.abs(s)<u&&Math.abs(n)<u||c))return void(this.J=null);if(!this.J){const e=Math.floor(4*Math.random())+1;this.Z=[];const t=[];for(let i=0;i<e;i++)t.push(Math.random()*Math.PI*2);const i=Array.from({length:e},(e,t)=>t);for(let e=i.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[i[e],i[t]]=[i[t],i[e]]}for(let a=0;a<e;a++)this.Z.push({angle:t[a],size:3+5*Math.random(),order:i[a],delay:200*i[a]});this.J=Date.now()}const d=Date.now()-this.J;(this.Z||[]).forEach(s=>{if(d<s.delay)return;const n=d-s.delay,r=Math.min(1,n/300),o=t+Math.cos(s.angle)*a,l=i+Math.sin(s.angle)*a;e.save(),e.translate(o,l),e.globalAlpha=r;const c=h(s.size),u=[{color:`rgba(255, 100, 100, ${.6*r})`,offset:-2},{color:`rgba(100, 255, 100, ${.6*r})`,offset:0},{color:`rgba(100, 100, 255, ${.6*r})`,offset:2}];e.globalCompositeOperation="screen",u.forEach(({color:t,offset:i})=>{const a=e.createRadialGradient(i,i,0,i,i,2*c);a.addColorStop(0,t),a.addColorStop(.2,t.replace(""+.6*r,""+.4*r)),a.addColorStop(.5,t.replace(""+.6*r,""+.2*r)),a.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=a,e.beginPath(),e.arc(i,i,2*c,0,2*Math.PI),e.fill()}),e.globalCompositeOperation="lighter";const p=e.createRadialGradient(0,0,0,0,0,c);p.addColorStop(0,`rgba(255, 255, 255, ${r})`),p.addColorStop(.3,`rgba(255, 255, 255, ${.5*r})`),p.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=p,e.beginPath(),e.arc(0,0,c,0,2*Math.PI),e.fill(),e.restore()})}renderMoonShadow(e,t,i,a,s,n,r=!1,o=0,l=null){if(e.save(),e.globalAlpha=1,e.translate(t,i),"crescent"===s.type){let t=1,i=s.offset||.7;if(l){const e=l.getProgress(),{targetShape:a}=l;"moon"===a&&void 0!==e&&e<1&&!s.shadowX&&(t=e,i=2.7*t-2)}const r=(s.angle||-30)*Math.PI/180,o=Math.cos(r)*a*i,h=Math.sin(r)*a*i;if(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.beginPath(),n&&n.length>0){e.moveTo(n[0].x,n[0].y);for(let t=1;t<n.length;t++)e.lineTo(n[t].x,n[t].y);e.closePath()}else e.arc(0,0,a,0,2*Math.PI);e.clip();const c=e.createRadialGradient(o,h,.9*a,o,h,1.1*a),u=void 0!==s.coverage?s.coverage:.85,d=Math.min(1,1.2*t)*(u/.85);c.addColorStop(0,`rgba(0, 0, 0, ${1*d})`),c.addColorStop(.8,`rgba(0, 0, 0, ${1*d})`),c.addColorStop(.88,`rgba(0, 0, 0, ${.98*d})`),c.addColorStop(.91,`rgba(0, 0, 0, ${.95*d})`),c.addColorStop(.93,`rgba(0, 0, 0, ${.9*d})`),c.addColorStop(.95,`rgba(0, 0, 0, ${.8*d})`),c.addColorStop(.96,`rgba(0, 0, 0, ${.65*d})`),c.addColorStop(.97,`rgba(0, 0, 0, ${.45*d})`),c.addColorStop(.98,`rgba(0, 0, 0, ${.25*d})`),c.addColorStop(.99,`rgba(0, 0, 0, ${.1*d})`),c.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=c,e.beginPath(),e.arc(o,h,1.1*a,0,2*Math.PI),e.fill()}else if("lunar"===s.type){const t=1-(void 0!==s.diffusion?s.diffusion:1);let i=0,n=0;if(l){const e=l.getProgress(),{currentShape:t,targetShape:s}=l;if(r&&"solar"===s&&void 0!==e&&e<1){const t=2.5*a;i=-t*(1-e),n=t*(1-e)}else if(r&&"solar"===t&&"solar"!==s&&null!==s&&void 0!==e&&e<1){const t=2.5*a;i=t*e,n=-t*e}}e.translate(i,n),r?(e.save(),e.beginPath(),e.arc(-i,-n,a,0,2*Math.PI),e.clip()):(e.beginPath(),e.arc(0,0,a,0,2*Math.PI),e.clip());const o=a*(1.8-.5*t),h=e.createRadialGradient(0,0,.2*a,0,0,o),c=s.coverage||.9;if(s.color&&s.color.includes("0, 0, 0")?(h.addColorStop(0,`rgba(0, 0, 0, ${c})`),h.addColorStop(.3+.2*t,`rgba(0, 0, 0, ${.95*c})`),h.addColorStop(.6+.2*t,`rgba(0, 0, 0, ${.8*c})`),h.addColorStop(.85,`rgba(0, 0, 0, ${.4*c})`),h.addColorStop(1,"rgba(0, 0, 0, 0)")):(h.addColorStop(0,`rgba(10, 2, 0, ${c})`),h.addColorStop(.3+.2*t,`rgba(20, 5, 0, ${.95*c})`),h.addColorStop(.6+.2*t,`rgba(40, 10, 5, ${.8*c})`),h.addColorStop(.85,`rgba(60, 15, 10, ${.4*c})`),h.addColorStop(1,"rgba(80, 20, 15, 0)")),e.fillStyle=h,e.beginPath(),e.arc(0,0,o,0,2*Math.PI),e.fill(),t>.3){const i=a*(.8+.3*t),n=e.createRadialGradient(0,0,0,0,0,i);s.color&&s.color.includes("0, 0, 0")?(n.addColorStop(0,`rgba(0, 0, 0, ${c})`),n.addColorStop(.5,`rgba(0, 0, 0, ${.9*c})`),n.addColorStop(.8,`rgba(0, 0, 0, ${.5*c})`),n.addColorStop(1,"rgba(0, 0, 0, 0)")):(n.addColorStop(0,`rgba(0, 0, 0, ${c})`),n.addColorStop(.5,`rgba(10, 2, 0, ${.9*c})`),n.addColorStop(.8,`rgba(20, 5, 0, ${.5*c})`),n.addColorStop(1,"rgba(30, 8, 5, 0)")),e.fillStyle=n,e.beginPath(),e.arc(0,0,i,0,2*Math.PI),e.fill()}}r&&e.restore(),e.restore()}}class $l{renderZenCore(e,t,i,a,s,n,r,o){e.save(),s.shakeOffset&&(t+=s.shakeOffset),s.driftY&&(i+=s.driftY),e.translate(t,i),r&&void 0!==r.rotation&&e.rotate(r.rotation*Math.PI/180);const l=Date.now()/1e3,h=.5*Math.sin(.5*l)+1.5;let c=.1;"in"===n.phase?c=1:"entering"===n.phase?c=Math.max(.1,3.3*(n.lotusMorph-.7)):"exiting"===n.phase&&(c=Math.max(.1,.5*n.lotusMorph));const u=h*c;if(n.lotusMorph>0){e.shadowBlur=o(100)*u,e.shadowColor=`rgba(255, 223, 0, ${.5*u})`;const t=e.createRadialGradient(0,0,0,0,0,4*a);"in"!==n.phase?(t.addColorStop(0,"rgba(184, 134, 11, 0.8)"),t.addColorStop(.3,"rgba(153, 101, 21, 0.6)"),t.addColorStop(.6,"rgba(139, 69, 19, 0.4)"),t.addColorStop(1,"rgba(101, 67, 33, 0)")):(t.addColorStop(0,`rgba(255, 255, 255, ${1*u})`),t.addColorStop(.1,`rgba(255, 255, 240, ${1*u})`),t.addColorStop(.2,`rgba(255, 250, 205, ${.95*u})`),t.addColorStop(.35,`rgba(255, 240, 150, ${.85*u})`),t.addColorStop(.5,`rgba(255, 223, 0, ${.7*u})`),t.addColorStop(.65,`rgba(255, 215, 0, ${.5*u})`),t.addColorStop(.8,`rgba(255, 215, 0, ${.3*u})`),t.addColorStop(.9,`rgba(255, 215, 0, ${.15*u})`),t.addColorStop(.95,`rgba(255, 215, 0, ${.05*u})`),t.addColorStop(1,"rgba(255, 215, 0, 0)")),e.fillStyle=t,e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=o(2),e.beginPath(),e.arc(0,0,a,0,2*Math.PI,!1);const i=n.lotusMorph,s=n.petalSpread,r=n.smileCurve;if(i>.1){const t=a*(.05+.15*i);if(e.moveTo(0,t),e.bezierCurveTo(-a*(.05+.25*i*s),.1*a,-a*(.05+.3*i*s),-a*(.1+.4*i),0,-a*(.2+.65*i)),e.bezierCurveTo(a*(.05+.3*i*s),-a*(.1+.4*i),a*(.05+.25*i*s),.1*a,0,t),i>.3){const t=(i-.3)/.7;e.moveTo(.1*-a*t,.2*a),e.bezierCurveTo(-a*(.1+.4*t*s),.1*a,-a*(.2+.5*t*s),-a*(.1+.2*t),-a*(.1+.4*t*s),-a*(.2+.45*t)),e.bezierCurveTo(-a*(.05+.15*t),-a*(.1+.4*t),.05*-a*t,.1*a,.1*-a*t,.2*a),e.moveTo(.1*a*t,.2*a),e.bezierCurveTo(a*(.1+.4*t*s),.1*a,a*(.2+.5*t*s),-a*(.1+.2*t),a*(.1+.4*t*s),-a*(.2+.45*t)),e.bezierCurveTo(a*(.05+.15*t),-a*(.1+.4*t),.05*a*t,.1*a,.1*a*t,.2*a)}r>0&&(e.moveTo(.6*-a,a*(.5-.1*r)),e.quadraticCurveTo(0,a*(.5+.1*r),.6*a,a*(.5-.1*r)))}if(e.closePath(),e.fill("evenodd"),e.beginPath(),e.arc(0,0,a,0,2*Math.PI),e.stroke(),"in"===n.phase){const t=2*a,i=n.arcHeight*a,s=.5*a,r=e.createRadialGradient(0,s,0,0,s,1.2*t);r.addColorStop(0,`rgba(255, 255, 255, ${1*u})`),r.addColorStop(.25,`rgba(255, 252, 240, ${.8*u})`),r.addColorStop(.5,`rgba(255, 245, 200, ${.6*u})`),r.addColorStop(.75,`rgba(255, 235, 150, ${.4*u})`),r.addColorStop(1,"rgba(255, 223, 0, 0)"),e.fillStyle=r,e.fill();const o=e.createRadialGradient(0,-i/2,.5*a,0,-i/2,5*a);o.addColorStop(0,"rgba(255, 223, 0, 0)"),o.addColorStop(.1,`rgba(255, 223, 0, ${.25*u})`),o.addColorStop(.2,`rgba(255, 220, 0, ${.2*u})`),o.addColorStop(.35,`rgba(255, 215, 0, ${.15*u})`),o.addColorStop(.5,`rgba(255, 215, 0, ${.1*u})`),o.addColorStop(.65,`rgba(255, 215, 0, ${.06*u})`),o.addColorStop(.8,`rgba(255, 215, 0, ${.03*u})`),o.addColorStop(.9,`rgba(255, 215, 0, ${.01*u})`),o.addColorStop(1,"rgba(255, 215, 0, 0)"),e.fillStyle=o,e.fill()}}else{e.shadowBlur=0,e.shadowColor="transparent";const t=.3;e.fillStyle=`rgba(255, 215, 0, ${t})`,e.beginPath(),e.arc(0,0,a,0,2*Math.PI),e.fill();const i=e.createRadialGradient(0,0,0,0,0,a);i.addColorStop(0,"rgba(255, 255, 255, 0.2)"),i.addColorStop(.5,"rgba(255, 250, 230, 0.1)"),i.addColorStop(1,"rgba(255, 215, 0, 0)"),e.fillStyle=i,e.fill()}e.restore()}}const Wl=2,Gl=3,Ll=4,_l=new class{constructor(){this.callbacks=new Map,this.callbackIdCounter=0,this.frameId=null,this.isRunning=!1,this.lastFrameTime=0,this.deltaTime=0,this.fps=60,this.frameCount=0,this.targetFPS=60,this.targetFrameTime=1e3/this.targetFPS,this.frameBudget=16.67,this.prioritySkipCounters={[Wl]:0,[Gl]:0,[Ll]:0},this.performanceMonitor=null,this.frameTimeHistory=[],this.maxHistorySize=60,this.loop=this.loop.bind(this)}register(e,t=2,i=null){if("function"!=typeof e)throw new Error("Callback must be a function");const a=++this.callbackIdCounter;return this.callbacks.set(a,{callback:e,priority:t,context:i,lastRun:0,runCount:0,totalTime:0,enabled:!0}),1!==this.callbacks.size||this.isRunning||this.start(),a}unregister(e){this.callbacks.delete(e),0===this.callbacks.size&&this.isRunning&&this.stop()}setEnabled(e,t){const i=this.callbacks.get(e);i&&(i.enabled=t)}start(){this.isRunning||(this.isRunning=!0,this.lastFrameTime=performance.now(),this.frameId=requestAnimationFrame(this.loop))}stop(){this.isRunning&&(this.isRunning=!1,this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null))}loop(e){if(!this.isRunning)return;this.deltaTime=e-this.lastFrameTime,this.lastFrameTime=e,this.frameCount++,this.frameCount%60==0&&(this.fps=Math.round(1e3/(this.deltaTime||16.67))),this.frameTimeHistory.push(this.deltaTime),this.frameTimeHistory.length>this.maxHistorySize&&this.frameTimeHistory.shift(),performance.now();const t=this.groupCallbacksByPriority();let i=0;for(const a of[0,1,2,3,4]){if(a>0&&i>.8*this.frameBudget)break;if(this.shouldSkipPriority(a))continue;const s=t.get(a)||[];for(const t of s){if(!t.enabled)continue;const a=performance.now();try{t.context?t.callback.call(t.context,this.deltaTime,e):t.callback(this.deltaTime,e);const s=performance.now()-a;t.totalTime+=s,t.runCount++,t.lastRun=e,i+=s}catch(e){t.runCount>0&&t.totalTime/t.runCount>10&&(t.enabled=!1)}if(i>this.frameBudget)break}}this.frameId=requestAnimationFrame(this.loop)}groupCallbacksByPriority(){const e=new Map;for(const[,t]of this.callbacks){const{priority:i}=t;e.has(i)||e.set(i,[]),e.get(i).push(t)}return e}shouldSkipPriority(e){if(0===e)return!1;if(this.fps<30&&e>=3)return!0;if(this.fps<45&&4===e)return!0;if(2===e){if(this.fps<50&&(this.prioritySkipCounters[e]++,this.prioritySkipCounters[e]%2!=0))return!0}else if(3===e){if(this.fps<50&&(this.prioritySkipCounters[e]++,this.prioritySkipCounters[e]%3!=0))return!0}else if(4===e&&(this.prioritySkipCounters[e]++,this.prioritySkipCounters[e]%5!=0))return!0;return!1}getStats(){const e={fps:this.fps,frameCount:this.frameCount,callbackCount:this.callbacks.size,averageFrameTime:0,maxFrameTime:0,minFrameTime:1/0};if(this.frameTimeHistory.length>0){let t=0;for(const i of this.frameTimeHistory)t+=i,e.maxFrameTime=Math.max(e.maxFrameTime,i),e.minFrameTime=Math.min(e.minFrameTime,i);e.averageFrameTime=t/this.frameTimeHistory.length}e.callbacksByPriority={};for(const[,t]of this.callbacks){const{priority:i}=t;e.callbacksByPriority[i]||(e.callbacksByPriority[i]={count:0,totalTime:0,enabled:0}),e.callbacksByPriority[i].count++,e.callbacksByPriority[i].totalTime+=t.totalTime,t.enabled&&e.callbacksByPriority[i].enabled++}return e}setTargetFPS(e){this.targetFPS=Math.max(15,Math.min(120,e)),this.targetFrameTime=1e3/this.targetFPS,this.frameBudget=this.targetFrameTime}setPerformanceMonitor(e){this.performanceMonitor=e}destroy(){this.stop(),this.callbacks.clear(),this.frameTimeHistory=[]}};class Hl{constructor(e){this.renderer=e,this.zenTransition={active:!1,phase:null,startTime:0,previousEmotion:null,targetEmotion:null,scaleX:1,scaleY:1,arcHeight:0,lotusMorph:0,petalSpread:0,smileCurve:0},this.loopCallbackIds={zenEnter:null,zenExit:null}}getZenTransition(){return this.zenTransition}isActive(){return this.zenTransition.active}isInZenPhase(){return this.zenTransition.active&&"in"===this.zenTransition.phase}enterZenMode(e,t){this.K(),this.renderer.state.glowColor=e,this.renderer.state.glowIntensity=t,this.renderer.colorTransition.active=!1,this.zenTransition={active:!0,phase:"entering",startTime:performance.now(),previousEmotion:this.renderer.state.emotion,targetEmotion:null,scaleX:1,scaleY:1,arcHeight:0,lotusMorph:0,petalSpread:0,smileCurve:0};const i=()=>{if(!this.zenTransition.active||"entering"!==this.zenTransition.phase)return void(this.loopCallbackIds.zenEnter=null);const e=performance.now()-this.zenTransition.startTime;if(e<400){const t=e/400,a=1-Math.pow(1-t,2);this.zenTransition.scaleX=1,this.zenTransition.scaleY=1,this.zenTransition.arcHeight=0,this.zenTransition.lotusMorph=a,this.zenTransition.petalSpread=a,this.zenTransition.smileCurve=Math.sin(t*Math.PI/2),this.loopCallbackIds.zenEnter=_l.register(i,2,this)}else this.zenTransition.phase="in",this.zenTransition.scaleX=1,this.zenTransition.scaleY=1,this.zenTransition.arcHeight=0,this.zenTransition.lotusMorph=1,this.zenTransition.petalSpread=1,this.zenTransition.smileCurve=1,this.renderer.state.zenVortexIntensity=1,this.loopCallbackIds.zenEnter=null};this.loopCallbackIds.zenEnter=_l.register(i,2,this)}exitZenMode(e,t,i){if(!this.zenTransition.active||"in"!==this.zenTransition.phase)return;this.K(),this.zenTransition.phase="exiting",this.zenTransition.startTime=performance.now(),this.zenTransition.targetEmotion=e;const a=()=>{if(!this.zenTransition.active||"exiting"!==this.zenTransition.phase)return void(this.loopCallbackIds.zenExit=null);const e=performance.now()-this.zenTransition.startTime,s=150;if(e<s){const n=e/s,r=1-Math.pow(1-n,2);if(0!==n&&this.renderer.colorTransition.active||this.renderer.startColorTransition(t,i,s),this.zenTransition.arcHeight=1.5*(1-r),this.zenTransition.smileCurve=1*(1-r),n>.3){const e=(n-.3)/.7;this.zenTransition.petalSpread=1*(1-e)}if(n>.5){const e=(n-.5)/.5;this.zenTransition.lotusMorph=1*(1-e)}this.loopCallbackIds.zenExit=_l.register(a,2,this)}else if(e<350){const t=(e-s)/200;if(this.zenTransition.lotusMorph=0,this.zenTransition.petalSpread=0,this.zenTransition.smileCurve=0,t<.2){const e=t/.2;this.zenTransition.scaleY=1-.8*Math.sin(e*Math.PI)}else if(t<.6){const e=(t-.2)/.4;this.zenTransition.scaleY=1,this.renderer.state.shakeOffset=3*Math.sin(e*Math.PI*4)}else{const e=(t-.6)/.4;this.renderer.state.driftY=-10*e,this.renderer.state.glowIntensity=1+.5*e}this.loopCallbackIds.zenExit=_l.register(a,2,this)}else if(e<550){const t=(e-s-200)/200,i=Math.sin(t*Math.PI/2);this.zenTransition.scaleX=1,this.zenTransition.scaleY=.2+.8*i,this.renderer.state.driftY=-10*(1-t),this.renderer.state.glowIntensity=1.5-.5*t,this.loopCallbackIds.zenExit=_l.register(a,2,this)}else if(e<650){const t=(e-s-200-200)/100,i=Math.sin(t*Math.PI);this.zenTransition.scaleX=1+.05*i,this.zenTransition.scaleY=1+.05*i,this.loopCallbackIds.zenExit=_l.register(a,2,this)}else this.ee()};this.loopCallbackIds.zenExit=_l.register(a,2,this)}K(){this.loopCallbackIds.zenEnter&&(_l.unregister(this.loopCallbackIds.zenEnter),this.loopCallbackIds.zenEnter=null),this.loopCallbackIds.zenExit&&(_l.unregister(this.loopCallbackIds.zenExit),this.loopCallbackIds.zenExit=null)}ee(){this.zenTransition.active=!1,this.zenTransition.phase=null,this.zenTransition.scaleX=1,this.zenTransition.scaleY=1,this.zenTransition.arcHeight=0,this.zenTransition.lotusMorph=0,this.zenTransition.petalSpread=0,this.zenTransition.smileCurve=0,this.renderer.state.shakeOffset=0,this.renderer.state.driftY=0,this.loopCallbackIds.zenExit=null}destroy(){this.K(),this.ee()}}class Ul{constructor(e){this.renderer=e,this.episodicEffects={nervous:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:3e3+2e3*Math.random()},confident:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:4e3+2e3*Math.random()},tired:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:5e3+2e3*Math.random()},intense:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:3e3+3e3*Math.random()},subdued:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:4e3+3e3*Math.random()}}}getEpisodicEffects(){return this.episodicEffects}updateEpisodicEffects(e,t,i,a,s){if(!e||!this.episodicEffects[e])return{jitterX:t,jitterY:i,coreRadius:a,glowRadius:s};const n=this.episodicEffects[e],r=performance.now();if(!n.active&&r>=n.nextTrigger)switch(n.active=!0,n.startTime=r,e){case"nervous":n.duration=500+500*Math.random(),n.intensity=2+Math.random(),n.nextTrigger=r+3e3+2e3*Math.random();break;case"confident":n.duration=1e3+1e3*Math.random(),n.intensity=.15,n.nextTrigger=r+4e3+2e3*Math.random();break;case"tired":n.duration=1e3+2e3*Math.random(),n.intensity=.2,n.nextTrigger=r+5e3+2e3*Math.random();break;case"intense":n.duration=500+500*Math.random(),n.intensity=.5,n.nextTrigger=r+3e3+3e3*Math.random();break;case"subdued":n.duration=2e3+1e3*Math.random(),n.intensity=.3,n.nextTrigger=r+4e3+3e3*Math.random()}if(n.active){const o=r-n.startTime;if(o<n.duration){const r=o/n.duration;switch(e){case"nervous":{const e=1-r,a=15,s=Math.sin(r*Math.PI*a)*e;t=s*n.intensity,i=s*n.intensity*.7;break}case"confident":{const e=Math.sin(r*Math.PI);a*=1+n.intensity*e,s*=1+.5*n.intensity*e;break}case"tired":{const e=Math.sin(r*Math.PI*.5);a*=1-n.intensity*e,i+=5*e;break}case"intense":{const e=1-Math.cos(r*Math.PI);a*=1-.05*e,s*=1+n.intensity*e;break}case"subdued":{const e=Math.sin(r*Math.PI*.5);a*=1-.1*e,s*=1-n.intensity*e;break}}}else n.active=!1}return{jitterX:t,jitterY:i,coreRadius:a,glowRadius:s}}reset(){Object.keys(this.episodicEffects).forEach(e=>{this.episodicEffects[e].active=!1,this.episodicEffects[e].startTime=0,this.episodicEffects[e].duration=0,this.episodicEffects[e].intensity=0})}getEpisodeState(e){return this.episodicEffects[e]||null}isEpisodeActive(e){const t=this.episodicEffects[e];return!!t&&t.active}}class Ql{constructor(e){this.renderer=e,this.brakeStartTime=null,this.brakeDuration=2500,this.brakeStartRotation=0,this.brakeTargetRotation=0,this.brakeStartVelocity=0,this.onComplete=null,this.onProgress=null,this.DURATION_FACTOR=14}brakeToUpright(e={}){return this.brakeToTarget(0,e)}brakeToNearest(e,t={}){const i=this.renderer.state.manualRotation||0,a=Math.round(i/e)*e;return this.brakeToTarget(a,t)}brakeToTarget(e,t={}){return new Promise(i=>{const{onProgress:a=null,onComplete:s=null}=t;this.onProgress=a,this.onComplete=s;const n=this.renderer.state.rotationSpeed||0,r=this.renderer.state.manualRotation||0;if(0===n||this.brakeStartTime)return void i();if(this.brakeStartTime=performance.now(),this.brakeStartRotation=r,this.brakeStartVelocity=n,0===e)this.brakeTargetRotation=n>0?360*(Math.floor(r/360)+1):360*Math.floor(r/360);else{const t=e%360,i=Math.floor(r/360);this.brakeTargetRotation=n>0?t>r%360?360*i+t:360*(i+1)+t:t<r%360?360*i+t:360*(i-1)+t}const o=Math.abs(this.brakeTargetRotation-this.brakeStartRotation);this.brakeDuration=Math.max(500,o/Math.abs(n)*this.DURATION_FACTOR*5),this.renderer.setRotationSpeed(0),this.resolvePromise=i})}updateBrake(e){if(!this.brakeStartTime)return null;const t=e-this.brakeStartTime,i=Math.min(t/this.brakeDuration,1),a=1-Math.pow(1-i,4),s=this.brakeStartRotation+(this.brakeTargetRotation-this.brakeStartRotation)*a,n=this.brakeStartVelocity*Math.pow(1-a,2);return this.onProgress&&this.onProgress(a,n,s),i>=1?(this.brakeStartTime=null,this.complete(),{rotation:this.brakeTargetRotation,speed:0,complete:!0}):{rotation:s,speed:n,complete:!1}}stop(){this.brakeStartTime=null}complete(){this.onComplete&&this.onComplete(),this.resolvePromise&&(this.resolvePromise(),this.resolvePromise=null)}isBraking(){return null!==this.brakeStartTime}emergencyStop(){this.stop(),this.renderer.setRotationSpeed(0),this.complete()}getProgress(){if(!this.brakeStartTime)return 0;const e=performance.now()-this.brakeStartTime;return Math.min(e/this.brakeDuration,1)}destroy(){this.stop(),this.onComplete=null,this.onProgress=null,this.resolvePromise=null,this.renderer=null,this.brakeStartTime=null,this.brakeStartRotation=0,this.brakeTargetRotation=0,this.brakeStartVelocity=0}}class Yl{constructor(e){this.renderer=e,this.rotationBrake=new Ql(e)}setRotationSpeed(e){this.renderer.state.rotationSpeed=e}setRotationAngle(e){this.renderer.state.manualRotation=e}getRotationAngle(){return this.renderer.state.manualRotation}getRotationSpeed(){return this.renderer.state.rotationSpeed}isBraking(){return this.rotationBrake&&this.rotationBrake.isBraking()}updateRotation(e){if(this.rotationBrake&&this.rotationBrake.isBraking()){const t=this.rotationBrake.updateBrake(e);t&&(this.renderer.state.manualRotation=t.rotation,this.renderer.state.rotationSpeed=t.complete?0:t.speed)}else 0!==this.renderer.state.rotationSpeed&&(this.renderer.state.manualRotation+=this.renderer.state.rotationSpeed);this.renderer.state.lastRotationUpdate=e}calculateTotalRotation(e=0,t=0){return(e+t+this.renderer.state.manualRotation)*Math.PI/180}applyRotation(e,t){0!==t&&e.rotate(t)}applyRotationTransform(e,t,i,a){this.updateRotation(performance.now());const s=this.calculateTotalRotation(a);return 0!==s&&(e.save(),e.translate(t,i),this.applyRotation(e,s),e.translate(-t,-i)),s}reset(){this.renderer.state.manualRotation=0,this.renderer.state.rotationSpeed=0,this.renderer.state.lastRotationUpdate=performance.now()}destroy(){this.rotationBrake&&(this.rotationBrake=null)}}let Xl=class{constructor(e){this.renderer=e,this.canvas=e.canvas,this.initialized=!1,this.handleMouseMove=null,this.handleTouchMove=null}setEnabled(e){this.renderer.state.gazeTrackingEnabled=e,e?this.initialized||this.initialize():this.renderer.state.gazeTarget={x:0,y:0}}initialize(){this.initialized||(this.handleMouseMove=e=>{if(!this.renderer.state.gazeTrackingEnabled)return;const t=this.canvas.getBoundingClientRect(),i=t.width/2,a=t.height/2,s=e.clientX-t.left-i,n=e.clientY-t.top-a;this.renderer.state.gazeTarget={x:s/i,y:n/a}},this.handleTouchMove=e=>{if(this.renderer.state.gazeTrackingEnabled&&e.touches.length>0){const t=e.touches[0],i=this.canvas.getBoundingClientRect(),a=i.width/2,s=i.height/2,n=t.clientX-i.left-a,r=t.clientY-i.top-s;this.renderer.state.gazeTarget={x:n/a,y:r/s}}},document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),this.initialized=!0)}cleanup(){this.initialized&&(this.handleMouseMove&&(document.removeEventListener("mousemove",this.handleMouseMove),this.handleMouseMove=null),this.handleTouchMove&&(document.removeEventListener("touchmove",this.handleTouchMove),this.handleTouchMove=null),this.initialized=!1)}isInitialized(){return this.initialized}getGazeTarget(){return this.renderer.state.gazeTarget}isEnabled(){return this.renderer.state.gazeTrackingEnabled}};class Nl{constructor(e){this.renderer=e}setupCanvas(){this.renderer.updateOffscreenSize();const e=this.renderer.canvasManager.width||this.renderer.canvas.width||400,t=this.renderer.canvasManager.height||this.renderer.canvas.height||400,i=this.renderer.ctx;return this.renderer.ctx=this.renderer.offscreenCtx,{logicalWidth:e,logicalHeight:t,originalCtx:i}}renderBackdrop(e,t,i,a){const s=Math.min(e,t),n=this.renderer.getEffectiveCenter(),r=n.x,o=n.y-this.renderer.config.topOffset,l=s/this.renderer.config.referenceSize*this.renderer.config.baseScale*(n.coreScale||n.scale),h=this.renderer.config.referenceSize/this.renderer.config.coreSizeDivisor*l;this.renderer.backdropRenderer.update(a),this.renderer.audioAnalyzer&&this.renderer.audioAnalyzer.currentAmplitude&&this.renderer.backdropRenderer.setAudioIntensity(this.renderer.audioAnalyzer.currentAmplitude),this.renderer.backdropRenderer.render(r,o,h,i)}applyCanvasDecay(e,t,i){const a=this.renderer.particleSystem?this.renderer.particleSystem.particles.length:0,s=.12+Math.min(.08,.003*a);e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=`rgba(0, 0, 0, ${s})`,e.fillRect(0,0,t,i),e.restore()}clearOffscreenCanvas(e,t){this.renderer.ctx.clearRect(0,0,e,t)}performCanvasSetup(e,t,i,a){this.renderBackdrop(e,t,i,a),this.applyCanvasDecay(i,e,t),this.clearOffscreenCanvas(e,t)}}class Jl{constructor(e){this.renderer=e}markFrameStart(){return this.renderer.performanceMonitor&&this.renderer.performanceMonitor.markFrameStart(),performance.now()}handleCleanRender(){this.renderer.forceCleanRender&&(this.renderer.forceCleanRender=!1,this.renderer.canvas&&this.renderer.ctx&&this.renderer.ctx.clearRect(0,0,this.renderer.canvas.width,this.renderer.canvas.height))}initializeFrame(){const e=this.markFrameStart();return this.handleCleanRender(),e}}class Zl{constructor(e){this.renderer=e}mergeTransforms(e,t){const i=this.renderer.ambientDanceAnimator.getTransform(t);return e?(e.x=(e.x||0)+(i.x||0),e.y=(e.y||0)+(i.y||0),e.rotation=(e.rotation||0)+(i.rotation||0),e.scale=(e.scale||1)*(i.scale||1),e):i}mergeAndStoreTransforms(e,t){const i=this.mergeTransforms(e,t);return this.renderer.gestureTransform=i,i}}class Kl{constructor(e){this.renderer=e}updateUndertoneModifiers(){if(this.renderer.stateMachine&&this.renderer.stateMachine.getWeightedUndertoneModifiers){const e=this.renderer.stateMachine.getWeightedUndertoneModifiers();e?this.renderer.applyUndertoneModifiers(e):this.renderer.applyUndertoneModifiers(null)}}updateColorTransition(e){this.renderer.colorTransition&&this.renderer.colorTransition.active&&this.renderer.updateColorTransition(e)}updateAnimationTimers(e){this.renderer.updateTimers(e)}updateGazeOffset(){if(this.renderer.state.gazeTrackingEnabled){const e=.15,t=50;this.renderer.state.gazeOffset.x+=(this.renderer.state.gazeTarget.x*t-this.renderer.state.gazeOffset.x)*e,this.renderer.state.gazeOffset.y+=(this.renderer.state.gazeTarget.y*t-this.renderer.state.gazeOffset.y)*e}else{const e=.1;this.renderer.state.gazeOffset.x+=(0-this.renderer.state.gazeOffset.x)*e,this.renderer.state.gazeOffset.y+=(0-this.renderer.state.gazeOffset.y)*e}}performFrameStateUpdates(e){this.updateUndertoneModifiers(),this.updateColorTransition(e),this.updateAnimationTimers(e),this.updateGazeOffset()}}class eh{constructor(e){this.renderer=e}calculateBaseDimensions(e,t){const i=Math.min(e,t),a=this.renderer.getEffectiveCenter();return this.renderer.scaleFactor=i/this.renderer.config.referenceSize*this.renderer.config.baseScale*(a.coreScale||a.scale),this.renderer.particleScaleFactor=i/this.renderer.config.referenceSize*this.renderer.config.baseScale*(a.particleScale||a.scale),{canvasSize:i,effectiveCenter:a}}calculateCenterPosition(e,t,i){const a=e.x;let s=e.y-this.renderer.config.topOffset;return t.properties&&t.properties.verticalOffset&&(s=e.y-this.renderer.config.topOffset+i*t.properties.verticalOffset),{centerX:a,centerY:s}}applyGestureTransform(e,t,i){let a=1,s=0,n=1;return i&&(e+=i.x||0,t+=i.y||0,a=i.scale||1,s=(i.rotation||0)*Math.PI/180,n=i.glowIntensity||1),{centerX:e,centerY:t,scaleMultiplier:a,rotationAngle:s,glowMultiplier:n}}applyGestureAnimations(e,t,i,a,s){const n=this.renderer.gestureAnimator.applyGestureAnimations();return n&&(e+=n.offsetX||0,t+=n.offsetY||0,i*=n.scale||1,a+=(n.rotation||0)*Math.PI/180,s=n.glow||1),{centerX:e,centerY:t,scaleMultiplier:i,rotationAngle:a,glowMultiplier:s,gestureTransforms:n}}calculateRenderDimensions(e,t,i,a){const{canvasSize:s,effectiveCenter:n}=this.calculateBaseDimensions(e,t);let r,o,l,{centerX:h,centerY:c}=this.calculateCenterPosition(n,i,t);({centerX:h,centerY:c,scaleMultiplier:r,rotationAngle:o,glowMultiplier:l}=this.applyGestureTransform(h,c,a));const u=this.applyGestureAnimations(h,c,r,o,l);({centerX:h,centerY:c,scaleMultiplier:r,rotationAngle:o,glowMultiplier:l}=u);const{gestureTransforms:d}=u;return{canvasSize:s,effectiveCenter:n,centerX:h,centerY:c,scaleMultiplier:r,rotationAngle:o,glowMultiplier:l,gestureTransforms:d}}}var th={name:"zen-vortex",emoji:"üåÄ",description:"Swirling meditation vortex effect",config:{vortexSpeed:.02,spiralTightness:.15,maxRadius:1.5,lineWidth:2,segments:50,arms:3,fadeStart:.7,baseOpacity:.3,pulseSpeed:.01},state:{rotation:0,pulsePhase:0,intensity:0},shouldActivate:e=>"zen"===e.emotion||e.zenTransition?.active,apply(e,t){const{x:i,y:a,radius:s,intensity:n=1,deltaTime:r=16.67}=t;this.state.rotation+=this.config.vortexSpeed*(r/16.67),this.state.pulsePhase+=this.config.pulseSpeed*(r/16.67),this.state.intensity=n,e.save();for(let t=0;t<this.config.arms;t++){const n=2*Math.PI/this.config.arms*t;this.drawSpiralArm(e,i,a,s,n)}this.drawMeditationEyes(e,i,a,.6*s,n),e.restore()},drawSpiralArm(e,t,i,a,s){e.beginPath();const n=1+.1*Math.sin(this.state.pulsePhase);for(let r=0;r<=this.config.segments;r++){const o=r/this.config.segments,l=this.state.rotation+s+o*Math.PI*4,h=o*a*this.config.maxRadius*n,c=t+Math.cos(l)*h,u=i+Math.sin(l)*h;0===r?e.moveTo(c,u):e.lineTo(c,u)}const r=e.createLinearGradient(t-a,i,t+a,i),o=this.config.baseOpacity*this.state.intensity;r.addColorStop(0,"rgba(147, 112, 219, 0)"),r.addColorStop(.3,`rgba(147, 112, 219, ${.5*o})`),r.addColorStop(this.config.fadeStart,`rgba(147, 112, 219, ${o})`),r.addColorStop(1,"rgba(147, 112, 219, 0)"),e.strokeStyle=r,e.lineWidth=this.config.lineWidth,e.stroke()},drawMeditationEyes(e,t,i,a,s){e.save();const n=.4*a,r=.3*a;e.strokeStyle=`rgba(255, 255, 255, ${.8*s})`,e.lineWidth=2,e.beginPath(),e.arc(t-r,i,n,Math.PI,0,!0),e.stroke(),e.beginPath(),e.arc(t+r,i,n,Math.PI,0,!0),e.stroke(),e.restore()},reset(){this.state.rotation=0,this.state.pulsePhase=0,this.state.intensity=0}},ih={name:"recording-glow",emoji:"üî¥",description:"Pulsating red recording indicator",config:{color:"#FF0000",pulseSpeed:.08,minIntensity:.6,maxIntensity:1,radiusMultiplier:2,gradientStops:[{position:0,opacity:1},{position:.3,opacity:.7},{position:.6,opacity:.4},{position:.85,opacity:.2},{position:1,opacity:0}]},state:{pulsePhase:0,intensity:.8},shouldActivate:e=>!0===e.recording,apply(e,t){const{deltaTime:i=16.67}=t;this.state.pulsePhase+=this.config.pulseSpeed*(i/16.67);const a=(Math.sin(this.state.pulsePhase)+1)/2;return this.state.intensity=this.config.minIntensity+(this.config.maxIntensity-this.config.minIntensity)*a,!0},drawRecordingIndicator(e,t,i){e.save();const a=Math.min(t,i),s=Math.floor(.08*a),n=1.5*s,r=1.5*s,o=.3*s;e.fillStyle=this.hexToRgba("#FF0000",this.state.intensity),e.beginPath(),e.arc(n-s,r,o,0,2*Math.PI),e.fill(),e.strokeStyle=this.hexToRgba("#FFFFFF",.8*this.state.intensity),e.lineWidth=3,e.font=`bold ${s}px 'Arial', sans-serif`,e.textAlign="left",e.textBaseline="middle",e.strokeText("REC",n,r),e.fillStyle=this.hexToRgba("#FF0000",this.state.intensity),e.fillText("REC",n,r),e.restore()},hexToRgba:(e,t)=>`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t})`,reset(){this.state.pulsePhase=0,this.state.intensity=0}},ah={name:"speaking-pulse",emoji:"üó£Ô∏è",description:"Audio-reactive pulse when speaking",config:{scaleMultiplier:.15,smoothing:.1,minPulse:.02,colorShift:!0,ringEffect:!0},state:{audioLevel:0,smoothedLevel:0,rings:[]},shouldActivate:e=>!0===e.speaking,apply(e,t){const{x:i,y:a,radius:s,audioLevel:n=0,deltaTime:r=16.67}=t;this.state.smoothedLevel+=(n-this.state.smoothedLevel)*this.config.smoothing,n>.5&&this.state.audioLevel<=.5&&this.state.rings.push({radius:s,opacity:.5,speed:2}),this.config.ringEffect&&this.drawRings(e,i,a,r),this.state.audioLevel=n},drawRings(e,t,i,a){e.save(),e.strokeStyle="rgba(100, 200, 255, 0.5)",e.lineWidth=2;for(let s=this.state.rings.length-1;s>=0;s--){const n=this.state.rings[s];n.radius+=n.speed*(a/16.67),n.opacity-=a/16.67*.02,n.opacity<=0?this.state.rings.splice(s,1):(e.globalAlpha=n.opacity,e.beginPath(),e.arc(t,i,n.radius,0,2*Math.PI),e.stroke())}e.restore()},getScaleModifier(){return 1+this.state.smoothedLevel*this.config.scaleMultiplier}},sh={name:"sleeping",emoji:"üò¥",description:"Sleeping with closed eyes and Z particles",config:{eyeClosedScale:.1,breathingDepth:.15,breathingRate:.8,zParticleInterval:2e3,zDriftSpeed:1,zFadeSpeed:.01,orbDimming:.3,glowDimming:.2},state:{lastZSpawn:0,zParticles:[]},shouldActivate:e=>!0===e.sleeping||"resting"===e.emotion,apply(e,t){const{x:i,y:a,radius:s,deltaTime:n=16.67}=t,r=Date.now();if(r-this.state.lastZSpawn>this.config.zParticleInterval){const e=[100,200,300,400,500,600,700,800,900],t=e[Math.floor(Math.random()*e.length)];this.state.zParticles.push({x:i+s,y:a-s,opacity:1,size:12+8*Math.random(),drift:.5*Math.random()-.25,weight:t,rotation:30*Math.random()-15}),this.state.lastZSpawn=r}this.drawZParticles(e,n)},drawZParticles(e,t){e.save(),e.textAlign="center",e.textBaseline="middle";for(let i=this.state.zParticles.length-1;i>=0;i--){const a=this.state.zParticles[i];a.y-=this.config.zDriftSpeed*(t/16.67),a.x+=a.drift*(t/16.67),a.opacity-=this.config.zFadeSpeed*(t/16.67),a.rotation+=t/16.67*.5,a.opacity<=0?this.state.zParticles.splice(i,1):(e.save(),e.translate(a.x,a.y),e.rotate(a.rotation*Math.PI/180),e.globalAlpha=.7*a.opacity,e.fillStyle="rgba(255, 255, 255, 0.9)",e.font=`${a.weight} ${a.size}px 'Poppins', sans-serif`,e.fillText("Z",0,0),e.shadowBlur=3,e.shadowColor="rgba(147, 112, 219, 0.5)",e.fillText("Z",0,0),e.restore())}e.restore()},getEyeOpenness(){return this.config.eyeClosedScale},getBreathingModifiers(){return{rate:this.config.breathingRate,depth:this.config.breathingDepth}},getDimmingValues(){return{orbDimming:this.config.orbDimming,glowDimming:this.config.glowDimming}}},nh={name:"suspicion-scan",emoji:"üîç",description:"Suspicious scanning and squinting",config:{squintAmount:.4,scanInterval:5e3,scanDuration:800,scanAngle:45,squintSpeed:.02,pupilShift:.3},state:{currentSquint:0,targetSquint:0,lastScanTime:0,scanPhase:0,scanning:!1},shouldActivate:e=>"suspicion"===e.emotion||!0===e.suspicious,apply(e,t){const{deltaTime:i=16.67}=t,a=Date.now();this.updateSquint(i),a-this.state.lastScanTime>this.config.scanInterval&&(this.startScan(),this.state.lastScanTime=a),this.state.scanning&&this.updateScan(a,i)},updateSquint(e){this.state.targetSquint=this.config.squintAmount;const t=this.state.targetSquint-this.state.currentSquint;Math.abs(t)>.01?this.state.currentSquint+=t*this.config.squintSpeed*(e/16.67):this.state.currentSquint=this.state.targetSquint},startScan(){this.state.scanning=!0,this.state.scanStartTime=Date.now(),this.state.scanPhase=-1},updateScan(e,t){const i=(e-this.state.scanStartTime)/this.config.scanDuration;i<.33?this.state.scanPhase=-1:i<.66?this.state.scanPhase=1:(i<1||(this.state.scanning=!1),this.state.scanPhase=0)},getEyeModifiers(){return{scaleY:1-this.state.currentSquint,scaleX:1+.3*this.state.currentSquint,offsetX:this.state.scanPhase*this.config.pupilShift}},drawScanLines(e,t,i,a){if(!this.state.scanning)return;e.save(),e.strokeStyle="rgba(255, 165, 0, 0.3)",e.lineWidth=1,e.setLineDash([5,5]);const s=this.state.scanPhase*(this.config.scanAngle*Math.PI/180),n=t+Math.cos(s)*a*2,r=i+Math.sin(s)*a*.5;e.beginPath(),e.moveTo(t,i),e.lineTo(n,r),e.stroke(),e.restore()}},rh={name:"gaze-narrowing",emoji:"üëÅÔ∏è",description:"Eye narrowing based on gaze proximity",config:{maxHorizontalScale:1.3,maxVerticalScale:.5,smoothing:.1,focusThreshold:.3},state:{currentScaleX:1,currentScaleY:1,targetScaleX:1,targetScaleY:1},shouldActivate:e=>e.gazeIntensity>0||e.gazeLocked,apply(e,t){const{gazeIntensity:i=0,deltaTime:a=16.67}=t;if(i>this.config.focusThreshold){const e=(i-this.config.focusThreshold)/(1-this.config.focusThreshold);this.state.targetScaleX=1+(this.config.maxHorizontalScale-1)*e,this.state.targetScaleY=1-(1-this.config.maxVerticalScale)*e}else this.state.targetScaleX=1,this.state.targetScaleY=1;this.animateScales(a)},animateScales(e){const t=this.config.smoothing*(e/16.67),i=this.state.targetScaleX-this.state.currentScaleX;Math.abs(i)>.001&&(this.state.currentScaleX+=i*t);const a=this.state.targetScaleY-this.state.currentScaleY;Math.abs(a)>.001&&(this.state.currentScaleY+=a*t)},getEyeScales(){return{scaleX:this.state.currentScaleX,scaleY:this.state.currentScaleY}},drawFocusIndicator(e,t,i,a,s){if(s<this.config.focusThreshold)return;e.save();const n=.5*(s-this.config.focusThreshold);e.strokeStyle=`rgba(100, 200, 255, ${n})`,e.lineWidth=1,e.setLineDash([2,4]);const r=[0,60,120,180,240,300];for(const s of r){const n=s*Math.PI/180,r=2*a,o=1.2*a;e.beginPath(),e.moveTo(t+Math.cos(n)*r,i+Math.sin(n)*r),e.lineTo(t+Math.cos(n)*o,i+Math.sin(n)*o),e.stroke()}e.restore()}},oh={name:"fingerprint",emoji:"üëÜ",description:"Biometric fingerprint pattern for authentication UI",config:{rings:8,ringSpacing:15,lineWidth:1.5,rotationSpeed:.001,pulseSpeed:.02,waveAmplitude:3,waveFrequency:8,breakPoints:5,opacity:.4,scanLineSpeed:.01,scanLineWidth:3,color:"#00CED1",glowColor:"#00FFFF",successColor:"#00FF00",failColor:"#FF0000"},state:{rotation:0,pulsePhase:0,scanPosition:0,scanDirection:1,isScanning:!1,scanResult:null,breaks:[],whorls:[]},shouldActivate:e=>!0===e.biometric||!0===e.fingerprint||!0===e.authenticating,initialize(){this.state.breaks=[];for(let e=0;e<this.config.rings;e++){const e=[];for(let t=0;t<this.config.breakPoints;t++)e.push(Math.random()*Math.PI*2);this.state.breaks.push(e)}this.state.whorls=[{x:.2,y:-.1,strength:.3},{x:-.15,y:.2,strength:.25},{x:0,y:0,strength:.5}]},apply(e,t){const{x:i,y:a,radius:s,deltaTime:n=16.67,scanning:r=!1,authResult:o=null}=t;0===this.state.breaks.length&&this.initialize(),this.state.rotation+=this.config.rotationSpeed*(n/16.67),this.state.pulsePhase+=this.config.pulseSpeed*(n/16.67),(r||this.state.isScanning)&&(this.state.isScanning=!0,this.state.scanPosition+=this.config.scanLineSpeed*this.state.scanDirection*(n/16.67),this.state.scanPosition>1?(this.state.scanPosition=1,this.state.scanDirection=-1):this.state.scanPosition<-1&&(this.state.scanPosition=-1,this.state.scanDirection=1)),e.save(),this.drawFingerprintPattern(e,i,a,s),this.state.isScanning&&this.drawScanLine(e,i,a,s),o&&this.showAuthResult(e,i,a,s,o),e.restore()},drawFingerprintPattern(e,t,i,a){const s=.1*Math.sin(this.state.pulsePhase)+1;for(let n=0;n<this.config.rings;n++){const r=(n+1)*this.config.ringSpacing*s;if(!(r>2*a)){e.beginPath(),e.strokeStyle=this.config.color,e.lineWidth=this.config.lineWidth,e.globalAlpha=this.config.opacity*(1-n/this.config.rings*.5);for(let s=0;s<2*Math.PI;s+=.05){let o=!1;for(const e of this.state.breaks[n]||[])if(Math.abs(s-e)<.1){o=!0;break}if(o){e.stroke(),e.beginPath();continue}let l=r,h=s+this.state.rotation;for(const e of this.state.whorls){const s=t+e.x*a,n=i+e.y*a,r=t+Math.cos(h)*l,o=i+Math.sin(h)*l,c=Math.sqrt(Math.pow(r-s,2)+Math.pow(o-n,2));h+=Math.exp(-c/(.5*a))*e.strength*.5}l+=Math.sin(s*this.config.waveFrequency)*this.config.waveAmplitude;const c=t+Math.cos(h)*l,u=i+Math.sin(h)*l;0===s?e.moveTo(c,u):e.lineTo(c,u)}e.stroke()}}},drawScanLine(e,t,i,a){const s=i+this.state.scanPosition*a,n=e.createLinearGradient(t-a,s,t+a,s);n.addColorStop(0,"rgba(0, 255, 255, 0)"),n.addColorStop(.5,this.config.glowColor),n.addColorStop(1,"rgba(0, 255, 255, 0)"),e.strokeStyle=n,e.lineWidth=this.config.scanLineWidth,e.globalAlpha=.8,e.shadowBlur=10,e.shadowColor=this.config.glowColor,e.beginPath(),e.moveTo(t-a,s),e.lineTo(t+a,s),e.stroke(),e.shadowBlur=0},showAuthResult(e,t,i,a,s){const n="success"===s?this.config.successColor:this.config.failColor,r="success"===s?"‚úì AUTHENTICATED":"‚úó ACCESS DENIED";e.fillStyle=n,e.font=`bold ${.15*a}px monospace`,e.textAlign="center",e.textBaseline="middle",e.globalAlpha=.9,e.fillText(r,t,i+1.3*a),e.strokeStyle=n,e.lineWidth=3,e.globalAlpha=.5,e.beginPath(),e.arc(t,i,1.1*a,0,2*Math.PI),e.stroke()},startScan(){this.state.isScanning=!0,this.state.scanPosition=-1,this.state.scanDirection=1,this.state.scanResult=null},completeScan(e=!0){this.state.isScanning=!1,this.state.scanResult=e?"success":"fail",setTimeout(()=>{this.state.scanResult=null},2e3)},reset(){this.state.rotation=0,this.state.pulsePhase=0,this.state.scanPosition=0,this.state.scanDirection=1,this.state.isScanning=!1,this.state.scanResult=null}};const lh=new Map;function hh(e){e.name&&lh.set(e.name,e)}function ch(e){return lh.get(e)||null}function uh(e,t,i){const a=ch(e);return!!a&&!!a.apply&&(a.apply(t,i),!0)}function dh(e,t){const i=ch(e);return!(!i||!i.shouldActivate)&&i.shouldActivate(t)}hh(th),hh(ih),hh(ah),hh(sh),hh(nh),hh(rh),hh(oh);class ph{constructor(e){this.renderer=e}calculateSleepModifiers(){let e=1,t=1,i=1;if(this.renderer.state.sleeping||"resting"===this.renderer.state.emotion||dh("sleeping",this.renderer.state)){const a=ch("sleeping");if(a){const s=a.getDimmingValues();e=void 0!==this.renderer.state.sleepDimness?this.renderer.state.sleepDimness:s.orbDimming,i=s.glowDimming,t=void 0!==this.renderer.state.sleepScale?this.renderer.state.sleepScale:.9}else e=void 0!==this.renderer.state.sleepDimness?this.renderer.state.sleepDimness:.3,i=.2,t=void 0!==this.renderer.state.sleepScale?this.renderer.state.sleepScale:.9;this.renderer.state.breathRate=.5,this.renderer.state.breathDepth=.15}return{sleepOpacityMod:e,sleepScaleMod:t,glowOpacityMod:i}}calculateBreathingFactors(){let e,t;if(null!==this.renderer.state.customScale)e=this.renderer.state.customScale,t=1+.5*(this.renderer.state.customScale-1);else{const i=this.renderer.breathingAnimator.getBreathingScale();e=i,t=1-.5*(i-1)}return"nervous"===this.renderer.state.undertone&&this.renderer.undertoneModifiers.nervous.glowPulse&&(t*=1+Math.sin(Date.now()/200)*this.renderer.undertoneModifiers.nervous.glowPulse),{coreBreathFactor:e,glowBreathFactor:t}}calculateRadii(e,t,i){const{sleepOpacityMod:a,sleepScaleMod:s,glowOpacityMod:n}=this.calculateSleepModifiers(),{coreBreathFactor:r,glowBreathFactor:o}=this.calculateBreathingFactors(),l=this.renderer.config.referenceSize/this.renderer.config.coreSizeDivisor*this.renderer.scaleFactor,h=e.properties&&e.properties.coreSize?e.properties.coreSize:1,c=this.renderer.state.sizeMultiplier||1;return{coreRadius:l*h*r*t*s*c,glowRadius:l*this.renderer.config.glowMultiplier*o*this.renderer.state.glowIntensity*t*s*c*i,effectiveGlowIntensity:this.renderer.state.glowIntensity*i,sleepOpacityMod:a,glowOpacityMod:n}}}class gh{constructor(e){this.renderer=e}applyZenLevitation(e,t,i){if("zen"===this.renderer.state.emotion&&"in"===this.renderer.zenTransition.phase){const a=Date.now()/1e3;t+=15*Math.sin(.3*a)*this.renderer.scaleFactor,e+=8*Math.sin(.2*a)*this.renderer.scaleFactor,i+=.05*Math.sin(.25*a)}return{centerX:e,centerY:t,rotationAngle:i}}applyBlinkSquish(e){return this.renderer.state.sleeping||"zen"===this.renderer.state.emotion||(e*=this.renderer.eyeRenderer.getBlinkScale()),e}calculateJitter(e,t){let i=0,a=0;const s=this.renderer.state.jitterAmount||0;if(this.renderer.currentUndertone)({jitterX:i,jitterY:a,coreRadius:e,glowRadius:t}=this.renderer.episodicEffectController.updateEpisodicEffects(this.renderer.currentUndertone,i,a,e,t));else if(this.renderer.state.coreJitter||s>0){const e=Math.max(s,this.renderer.state.coreJitter?this.renderer.scaleValue(2):0);i=(Math.random()-.5)*e,a=(Math.random()-.5)*e}return{jitterX:i,jitterY:a,coreRadius:e,glowRadius:t}}calculateFinalPosition(e,t,i,a){return{coreX:e+this.renderer.state.gazeOffset.x+i,coreY:t+this.renderer.state.gazeOffset.y+a}}applyAllModifications(e,t,i,a,s){let n,r;({centerX:e,centerY:t,rotationAngle:i}=this.applyZenLevitation(e,t,i)),a=this.applyBlinkSquish(a),({jitterX:n,jitterY:r,coreRadius:a,glowRadius:s}=this.calculateJitter(a,s));const{coreX:o,coreY:l}=this.calculateFinalPosition(e,t,n,r);return{coreX:o,coreY:l,rotationAngle:i,coreRadius:a,glowRadius:s}}}class mh{constructor(e){this.renderer=e}renderGlow(e,t,i,a,s,n){dh("recording-glow",this.renderer.state)?uh("recording-glow",this.renderer.ctx,{x:e,y:t,radius:i,deltaTime:n}):dh("zen-vortex",this.renderer.state)||(this.renderer.state.sleeping||"resting"===this.renderer.state.emotion||dh("sleeping",this.renderer.state)?(this.renderer.ctx.save(),this.renderer.ctx.globalAlpha=s,this.renderer.glowRenderer.renderGlow(e,t,i,{intensity:a}),this.renderer.ctx.restore()):this.renderer.glowRenderer.renderGlow(e,t,i,{intensity:a}))}renderFlashWave(e,t,i,a){if(e&&e.flashWave){const s=e.flashWave,{ctx:n}=this.renderer;n.save(),n.globalCompositeOperation="lighter";const r=a*s.innerRadius,o=a*s.outerRadius;if(o>r){const e=Pl.getRadialGradient(n,t,i,r,t,i,o,[{offset:0,color:"rgba(255, 255, 255, 0)"},{offset:.2,color:`rgba(255, 255, 255, ${.15*s.intensity})`},{offset:.5,color:`rgba(255, 255, 255, ${.25*s.intensity})`},{offset:.8,color:`rgba(255, 255, 255, ${.15*s.intensity})`},{offset:1,color:"rgba(255, 255, 255, 0)"}]);n.fillStyle=e,n.beginPath(),n.arc(t,i,o,0,2*Math.PI),n.arc(t,i,Math.max(0,r),0,2*Math.PI,!0),n.fill()}n.restore()}}renderSpeakingPulse(e,t,i,a){dh("speaking-pulse",this.renderer.state)&&uh("speaking-pulse",this.renderer.ctx,{x:e,y:t,radius:i,audioLevel:this.renderer.state.audioLevel||0,deltaTime:a})}renderAllEffects(e){const{coreX:t,coreY:i,glowRadius:a,effectiveGlowIntensity:s,glowOpacityMod:n,gestureTransforms:r,coreRadius:o,deltaTime:l}=e;this.renderGlow(t,i,a,s,n,l),this.renderFlashWave(r,t,i,o),this.renderSpeakingPulse(t,i,o,l)}}class yh{constructor(e){this.renderer=e}applySleepOpacity(e){(this.renderer.state.sleeping||"resting"===this.renderer.state.emotion)&&(this.renderer.ctx.globalAlpha=e)}updateShapeMorpher(e){let t=null,i=null;return this.renderer.shapeMorpher&&(this.renderer.shapeMorpher.update(),t=this.renderer.shapeMorpher.getCanvasPoints(0,0,e),i=this.renderer.shapeMorpher.getCurrentShadow()),{shapePoints:t,currentShadow:i}}renderSunEffects(e,t,i,a){let s=!1;return!a||"sun"!==a.type&&"solar-hybrid"!==a.type||(this.renderer.renderSunEffects(e,t,i,a),s=!0),s}renderCore(e,t,i,a,s){this.renderer.coreRenderer.renderCore(e,t,i,{scaleX:1,scaleY:1,rotation:a,shapePoints:s})}renderSparkles(e){this.renderer.specialEffects&&(this.renderer.specialEffects.update(e),this.renderer.specialEffects.renderSparkles())}renderShadowEffects(e,t,i,a,s,n){const r=this.renderer.shapeMorpher?this.renderer.shapeMorpher.currentShape:null,o=this.renderer.shapeMorpher?this.renderer.shapeMorpher.targetShape:null,l=this.renderer.shapeMorpher&&"solar"===o&&this.renderer.shapeMorpher.isTransitioning,h=this.renderer.shapeMorpher&&"solar"===r&&this.renderer.shapeMorpher.isTransitioning,c=a&&"solar-hybrid"===a.type,u=this.renderer.shapeMorpher&&this.renderer.shapeMorpher.isTransitioning&&"solar"===r&&"moon"===o,d=this.renderer.shapeMorpher&&this.renderer.shapeMorpher.isTransitioning&&"moon"===r&&"solar"===o;if(!a||"crescent"!==a.type&&"lunar"!==a.type||d||this.renderer.renderMoonShadow(e,t,i,a,s,!1,0),(c&&a.lunarOverlay||l||h)&&!u){const r=c&&a.lunarOverlay?a.lunarOverlay:{type:"lunar",coverage:1,color:"rgba(0, 0, 0, 1.0)",progression:"center"};let o=0,u=0,d=0;if(this.renderer.shapeMorpher){d=this.renderer.shapeMorpher.getProgress();const e=2.5*i;l&&d<1?(o=-e*(1-d),u=e*(1-d)):h&&d<1&&(o=e*d,u=-e*d)}if(this.renderer.renderMoonShadow(e,t,i,r,s,!0),(l||h)&&(l||n)&&(this.renderer.renderBaileysBeads(e,t,i,o,u,d,l,!0),Math.abs(o)<30&&Math.abs(u)<30&&this.renderer.specialEffects)){const e=Math.sqrt(o*o+u*u),t=Math.max(.1,.5*(1-e/30));this.renderer.specialEffects.triggerChromaticAberration(t)}}}cleanup(e){(this.renderer.state.sleeping||"resting"===this.renderer.state.emotion)&&(this.renderer.ctx.globalAlpha=1),0!==e&&this.renderer.ctx.restore()}renderCoreAndShapes(e){const{coreX:t,coreY:i,coreRadius:a,totalRotation:s,sleepOpacityMod:n,deltaTime:r}=e;this.applySleepOpacity(n);const{shapePoints:o,currentShadow:l}=this.updateShapeMorpher(a),h=this.renderSunEffects(t,i,a,l);this.renderCore(t,i,a,s,o),this.renderSparkles(r),this.renderShadowEffects(t,i,a,l,o,h),this.cleanup(s)}}class fh{constructor(e){this.renderer=e}renderSleepIndicator(e,t,i,a){this.renderer.state.sleeping&&this.renderer.renderSleepIndicator(e,t-i-this.renderer.scaleValue(20),a)}finalizeCanvas(e,t,i){this.renderer.ctx=e,e.drawImage(this.renderer.offscreenCanvas,0,0,t,i)}drawRecordingIndicator(e){if(dh("recording-glow",this.renderer.state)){const t=ch("recording-glow");t&&t.drawRecordingIndicator&&t.drawRecordingIndicator(e,this.renderer.canvas.width,this.renderer.canvas.height)}}finalizePerformanceMetrics(e){const t=performance.now()-e;this.renderer.performanceMonitor&&(this.renderer.performanceMonitor.markFrameEnd(),this.renderer.performanceMonitor.recordFrameTime(t))}finalizeRender(e){const{centerX:t,centerY:i,glowRadius:a,deltaTime:s,originalCtx:n,logicalWidth:r,logicalHeight:o,frameStartTime:l}=e;this.renderSleepIndicator(t,i,a,s),this.finalizeCanvas(n,r,o),this.drawRecordingIndicator(n),this.finalizePerformanceMetrics(l)}}class bh{constructor(e){this.renderer=e,this.animations={grooveSway:null,grooveBob:null,grooveFlow:null,groovePulse:null,grooveStep:null},this.activeAnimation=null,this.blendState={x:0,y:0,rotation:0,scale:1,opacity:1}}startAmbientAnimation(e,t={}){this.activeAnimation&&this.activeAnimation!==e&&this.stopAmbientAnimation(this.activeAnimation),this.activeAnimation=e,this.animations[e]={startTime:Date.now(),intensity:t.intensity||1,frequency:t.frequency||1,options:t}}stopAmbientAnimation(e){this.animations[e]&&(this.animations[e]=null),this.activeAnimation===e&&(this.activeAnimation=null)}updateBlendState(e){if(!e)return;const t=.2;this.blendState.x=this.lerp(this.blendState.x,e.x||0,t),this.blendState.y=this.lerp(this.blendState.y,e.y||0,t),this.blendState.rotation=this.lerp(this.blendState.rotation,e.rotation||0,t),this.blendState.scale=this.lerp(this.blendState.scale,e.scale||1,t),this.blendState.opacity=this.lerp(this.blendState.opacity,e.opacity||1,t)}getTransform(e){const t={x:this.blendState.x,y:this.blendState.y,rotation:this.blendState.rotation,scale:this.blendState.scale,opacity:this.blendState.opacity};if(this.activeAnimation){const e=this.animations[this.activeAnimation];if(e){const i=Date.now()-e.startTime;switch(this.activeAnimation){case"grooveSway":t.x+=15*Math.sin(i/500*e.frequency)*e.intensity,t.rotation+=5*Math.sin(i/500*e.frequency+Math.PI/4)*e.intensity;break;case"grooveBob":t.y+=10*Math.sin(i/400*e.frequency)*e.intensity,t.scale*=1+.03*Math.sin(i/400*e.frequency)*e.intensity;break;case"grooveFlow":{const a=i/1e3*e.frequency;t.x+=Math.sin(a)*Math.cos(2*a)*20*e.intensity,t.y+=Math.cos(a)*Math.sin(2*a)*10*e.intensity,t.rotation+=8*Math.sin(2*a)*e.intensity;break}case"groovePulse":t.scale*=1+.05*Math.sin(i/250*e.frequency)*e.intensity,t.opacity*=.9+.1*Math.sin(i/250*e.frequency)*e.intensity;break;case"grooveStep":{const a=Math.floor(i/500*e.frequency)%4,s=i/500*e.frequency%1,n=this.smoothStep(s);0===a?t.x+=25*n*e.intensity:2===a&&(t.x-=25*n*e.intensity),t.y+=5*Math.abs(Math.sin(i/250*e.frequency))*e.intensity;break}}}}return t}lerp(e,t,i){return e+(t-e)*i}smoothStep(e){return e*e*(3-2*e)}}class wh{constructor(e){this.renderer=e,this.ctx=e.ctx,this.config={enabled:!1,radius:1.5,shape:"circle",color:"rgba(0, 0, 0, 0.6)",intensity:.7,blendMode:"normal",falloff:"smooth",falloffCurve:null,edgeSoftness:.6,coreTransparency:.2,blur:0,responsive:!0,pulse:!1,offset:{x:0,y:0},type:"radial-gradient"},this.currentIntensity=0,this.targetIntensity=0,this.pulsePhase=0}setConfig(e={}){this.config={...this.config,...e},void 0!==e.enabled&&(this.targetIntensity=e.enabled?this.config.intensity:0)}update(e){this.config.enabled?(this.currentIntensity+=.1*(this.targetIntensity-this.currentIntensity),this.config.responsive&&(this.pulsePhase+=.001*e)):this.currentIntensity*=.95}setAudioIntensity(e){if(!this.config.responsive)return;const t=.2*e;this.targetIntensity=Math.min(1,this.config.intensity+t)}render(e,t,i,a=null){if(this.currentIntensity<.01)return;const s=a||this.ctx;switch(s.save(),this.config.type){case"radial-gradient":this.renderRadialGradient(e,t,i,s);break;case"vignette":this.renderVignette(e,t,i,s);break;case"glow":this.renderGlow(e,t,i,s)}s.restore()}renderRadialGradient(e,t,i,a){a=a||this.ctx;const s=i*this.config.radius,n=e+(this.config.offset.x||0),r=t+(this.config.offset.y||0);let o=s;(this.config.pulse||this.config.responsive)&&(o*=1+.05*Math.sin(this.pulsePhase));const l=a.globalCompositeOperation;this.config.blendMode&&"normal"!==this.config.blendMode&&(a.globalCompositeOperation=this.config.blendMode),this.config.blur>0&&(a.filter=`blur(${this.config.blur}px)`);const h=a.createRadialGradient(n,r,0,n,r,o),c=this.config.color,u=this.currentIntensity;this.addGradientStopsSimple(h,c,u),a.fillStyle=h,a.beginPath(),a.arc(n,r,o,0,2*Math.PI),a.fill(),this.config.blur>0&&(a.filter="none"),this.config.blendMode&&"normal"!==this.config.blendMode&&(a.globalCompositeOperation=l)}renderVignette(e,t,i,a){a=a||this.ctx;const{canvas:s}=a,n=Math.max(s.width,s.height),r=a.createRadialGradient(e,t,.5*i,e,t,n);r.addColorStop(0,"rgba(0, 0, 0, 0)"),r.addColorStop(1,this.adjustColorAlpha(this.config.color,this.currentIntensity)),a.fillStyle=r,a.fillRect(0,0,s.width,s.height)}renderGlow(e,t,i,a){a=a||this.ctx;const s=i*this.config.radius;for(let i=0;i<3;i++){const n=s*(1-.2*i),r=this.currentIntensity*(.3-.1*i),o=a.createRadialGradient(e,t,0,e,t,n);o.addColorStop(0,this.adjustColorAlpha(this.config.color,r)),o.addColorStop(1,"rgba(0, 0, 0, 0)"),a.fillStyle=o,a.beginPath(),a.arc(e,t,n,0,2*Math.PI),a.fill()}}addGradientStopsSimple(e,t,i){const{coreTransparency:a}=this.config;e.addColorStop(0,this.adjustColorAlpha(t,i)),e.addColorStop(a,this.adjustColorAlpha(t,i));for(let s=1;s<=25;s++){const n=a+s/25*(1-a),r=(n-a)/(1-a),o=1-this.easeInOutCubic(r);e.addColorStop(n,this.adjustColorAlpha(t,i*o))}e.addColorStop(1,"rgba(0, 0, 0, 0)")}addGradientStops(e,t,i,a=1){const{coreTransparency:s}=this.config;if(this.config.falloffCurve&&Array.isArray(this.config.falloffCurve))this.config.falloffCurve.forEach(({stop:a,alpha:s})=>{e.addColorStop(a,this.adjustColorAlpha(t,i*s))});else switch(this.config.falloff){case"linear":e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(s,"rgba(0, 0, 0, 0)"),e.addColorStop(1,this.adjustColorAlpha(t,i));break;case"exponential":e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(s,"rgba(0, 0, 0, 0)"),e.addColorStop(s+.3*(1-s),this.adjustColorAlpha(t,.05*i)),e.addColorStop(s+.5*(1-s),this.adjustColorAlpha(t,.15*i)),e.addColorStop(s+.7*(1-s),this.adjustColorAlpha(t,.4*i)),e.addColorStop(s+.85*(1-s),this.adjustColorAlpha(t,.7*i)),e.addColorStop(1,this.adjustColorAlpha(t,i));break;default:{e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(s*a,"rgba(0, 0, 0, 0)");const{edgeSoftness:n}=this.config,r=a,o=s*a+(r-s*a)*n,l=25;for(let n=1;n<=l;n++){const h=n/l;let c=0;if(h<=s*a)c=0;else if(h<=r)if(h<=o){const e=(h-s*a)/(o-s*a);c=this.easeInOutCubic(e)}else{const e=(h-o)/(r-o);c=1-.05*(1-this.easeInOutCubic(e))}else{const e=(h-r)/(1-r);c=1-this.easeInOutCubic(e)}e.addColorStop(h,this.adjustColorAlpha(t,i*c))}e.addColorStop(1,"rgba(0, 0, 0, 0)");break}}}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}adjustColorAlpha(e,t){const i=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(i){const[,e,a,s,n=1]=i;return`rgba(${e}, ${a}, ${s}, ${parseFloat(n)*t})`}return`rgba(0, 0, 0, ${.6*t})`}getConfig(){return{...this.config}}enable(){this.config.enabled=!0,this.targetIntensity=this.config.intensity}disable(){this.config.enabled=!1,this.targetIntensity=0}toggle(){this.config.enabled?this.disable():this.enable()}}class vh{constructor(e){this.renderer=e,this.loopCallbackIds={eyeClose:null,eyeOpen:null},this.wakeJitterTimeout=null}enterSleepMode(){this.renderer.state.sleeping=!0,this.renderer.sleepZ=[],this.renderer.state.eyeOpenness=1,this.renderer.state.sleepDimness=1,this.renderer.state.sleepScale=1,this.renderer.state.blinking=!1,this.animateEyeClose()}animateEyeClose(){this.loopCallbackIds.eyeClose&&(_l.unregister(this.loopCallbackIds.eyeClose),this.loopCallbackIds.eyeClose=null),this.loopCallbackIds.eyeOpen&&(_l.unregister(this.loopCallbackIds.eyeOpen),this.loopCallbackIds.eyeOpen=null);const e=performance.now(),t=2e3;this.loopCallbackIds.eyeClose=_l.register(()=>{if(!this.renderer.state.sleeping)return void(this.loopCallbackIds.eyeClose=null);const i=performance.now()-e;if(i<t){const e=i/t,a=1-Math.pow(e,2);this.renderer.state.eyeOpenness=.1+.9*a,this.renderer.state.sleepDimness=1,this.renderer.state.sleepScale=1}else if(i<3e3){const e=(i-t)/1e3,a=1-Math.pow(1-e,3);this.renderer.state.eyeOpenness=.1,this.renderer.state.sleepDimness=1-.4*a,this.renderer.state.sleepScale=1-.1*a}else this.renderer.state.eyeOpenness=.1,this.renderer.state.sleepDimness=.6,this.renderer.state.sleepScale=.9,this.loopCallbackIds.eyeClose=null},1,this.renderer)}wakeUp(){this.renderer.state.sleeping&&(this.renderer.state.sleeping=!1,this.renderer.state.breathRate=1,this.renderer.state.breathDepth=this.renderer.config.breathingDepth,this.renderer.sleepZ=[],this.renderer.state.blinking=!1,this.renderer.eyeRenderer.blinking=!1,this.renderer.eyeRenderer.blinkTimer=0,this.animateEyeOpen(),this.wakeJitterTimeout&&clearTimeout(this.wakeJitterTimeout),this.renderer.state.coreJitter=!0,this.wakeJitterTimeout=setTimeout(()=>{this.renderer.state.coreJitter=!1,this.wakeJitterTimeout=null},200))}animateEyeOpen(){this.loopCallbackIds.eyeOpen&&(_l.unregister(this.loopCallbackIds.eyeOpen),this.loopCallbackIds.eyeOpen=null),this.loopCallbackIds.eyeClose&&(_l.unregister(this.loopCallbackIds.eyeClose),this.loopCallbackIds.eyeClose=null);const e=performance.now();this.loopCallbackIds.eyeOpen=_l.register(()=>{const t=performance.now()-e;if(t<500){const e=t/500,i=Math.sin(e*Math.PI/2);this.renderer.state.sleepDimness=.6+.4*i,this.renderer.state.sleepScale=.9+.1*i,this.renderer.state.eyeOpenness=.1}else if(t<1500){const e=(t-500)/1e3,i=Math.sin(e*Math.PI/2);this.renderer.state.sleepDimness=1,this.renderer.state.sleepScale=1,this.renderer.state.eyeOpenness=.1+.9*i}else this.renderer.state.eyeOpenness=1,this.renderer.state.sleepDimness=1,this.renderer.state.sleepScale=1,this.loopCallbackIds.eyeOpen=null},1,this.renderer)}renderSleepIndicator(e,t,i){return this.renderer.specialEffects.renderSleepIndicator(e,t,i)}cleanup(){this.loopCallbackIds.eyeClose&&(_l.unregister(this.loopCallbackIds.eyeClose),this.loopCallbackIds.eyeClose=null),this.loopCallbackIds.eyeOpen&&(_l.unregister(this.loopCallbackIds.eyeOpen),this.loopCallbackIds.eyeOpen=null),this.wakeJitterTimeout&&(clearTimeout(this.wakeJitterTimeout),this.wakeJitterTimeout=null)}}class Mh{constructor(e){this.renderer=e}applyUndertoneModifiers(e){if(e&&"object"==typeof e&&void 0!==e.weight){const{weight:t}=e;return this.renderer.state.sizeMultiplier=1+((e.sizeMultiplier||1)-1)*t,this.renderer.state.jitterAmount=(e.jitterAmount||0)*t,this.renderer.state.episodicFlutter=t>.5&&e.episodicFlutter||!1,this.renderer.state.glowRadiusMult=1+((e.glowRadiusMult||1)-1)*t,this.renderer.state.breathRateMult=1+((e.breathRateMult||1)-1)*t,this.renderer.state.breathDepthMult=1+((e.breathDepthMult||1)-1)*t,this.renderer.state.breathIrregular=t>.5&&e.breathIrregular||!1,this.renderer.state.particleRateMult=1,this.renderer.state.glowPulse=(e.glowPulse||0)*t,this.renderer.state.brightnessFlicker=(e.brightnessFlicker||0)*t,this.renderer.state.brightnessMult=1+((e.brightnessMult||1)-1)*t,this.renderer.state.saturationMult=1+((e.saturationMult||1)-1)*t,void(this.renderer.state.hueShift=(e.hueShift||0)*t)}if(!e||!this.renderer.undertoneModifiers[e])return this.renderer.state.sizeMultiplier=1,this.renderer.state.jitterAmount=0,this.renderer.state.episodicFlutter=!1,this.renderer.state.glowRadiusMult=1,this.renderer.state.breathRateMult=1,this.renderer.state.breathDepthMult=1,this.renderer.state.breathIrregular=!1,this.renderer.state.particleRateMult=1,this.renderer.state.glowPulse=0,this.renderer.state.brightnessFlicker=0,this.renderer.state.brightnessMult=1,this.renderer.state.saturationMult=1,void(this.renderer.state.hueShift=0);const t=this.renderer.undertoneModifiers[e];this.renderer.state.sizeMultiplier=t.sizeMultiplier,this.renderer.state.jitterAmount=t.jitterAmount||0,this.renderer.state.episodicFlutter=t.episodicFlutter||!1,this.renderer.state.glowRadiusMult=t.glowRadiusMult,this.renderer.state.breathRateMult=t.breathRateMult,this.renderer.state.breathDepthMult=t.breathDepthMult,this.renderer.state.breathIrregular=t.breathIrregular||!1,this.renderer.state.particleRateMult=1,this.renderer.state.glowPulse=t.glowPulse||0,this.renderer.state.brightnessFlicker=t.brightnessFlicker||0,this.renderer.state.brightnessMult=t.brightnessMult||1,this.renderer.state.saturationMult=t.saturationMult||1,this.renderer.state.hueShift=t.hueShift||0}updateUndertone(e){this.renderer.state.undertone!==e&&this.renderer.glowCache&&this.renderer.glowCache.clear(),this.renderer.state.undertone=e,this.renderer.currentUndertone=e;const t=this.renderer.stateMachine&&this.renderer.stateMachine.getWeightedUndertoneModifiers?this.renderer.stateMachine.getWeightedUndertoneModifiers():null;if(this.applyUndertoneModifiers(t||e),this.renderer.state.emotion){const i=rl&&rl.isInitialized?rl.getEmotion(this.renderer.state.emotion):h(this.renderer.state.emotion);if(i){const a=i.glowColor||this.renderer.config.defaultGlowColor,s=this.renderer.applyUndertoneToColor(a,t||e);this.renderer.startColorTransition(s,200)}}}setEmotionalState(e,t,i=null){this.renderer.state.emotion===e&&this.renderer.state.undertone===i||!this.renderer.glowCache||this.renderer.glowCache.clear(),this.renderer.state.undertone=i,this.renderer.currentUndertone=i;const a=this.renderer.stateMachine&&this.renderer.stateMachine.getWeightedUndertoneModifiers?this.renderer.stateMachine.getWeightedUndertoneModifiers():null;this.applyUndertoneModifiers(a||i);const s=t.glowColor||this.renderer.config.defaultGlowColor;let n;n="suspicion"===e?t.glowColor||s:this.renderer.applyUndertoneToColor(s,a||i);const r=a||(i?this.renderer.undertoneModifiers[i]:null),o=t.glowIntensity||1;let l=1;if(r)if(a){const e=r.weight||0;l=void 0!==r.glowRadiusMult&&isFinite(r.glowRadiusMult)&&isFinite(e)?1+(r.glowRadiusMult-1)*e:1}else l=void 0!==r.glowRadiusMult?r.glowRadiusMult:1;const h=o*l;let c=1500;"anger"===e||"fear"===e?c=800:("sadness"===e||"resting"===e||"zen"===e)&&(c=2e3);const u=this.renderer.state.emotion;this.renderer.state.emotion=e,"suspicion"===e?(this.renderer.state.isSuspicious=!0,this.renderer.state.targetSquintAmount=t&&t.coreSquint?t.coreSquint:.4,void 0===this.renderer.state.squintAmount&&(this.renderer.state.squintAmount=0),this.renderer.state.lastScanTime=Date.now(),this.renderer.state.scanPhase=0):(this.renderer.state.isSuspicious=!1,this.renderer.state.targetSquintAmount=0,void 0===this.renderer.state.squintAmount&&(this.renderer.state.squintAmount=0)),"zen"===e&&"zen"!==u?this.renderer.enterZenMode(n,h):"zen"===u&&"zen"!==e?this.renderer.exitZenMode(e,n,h):this.renderer.startColorTransition(n,h,c);const d=t.breathRate||1,p=t.breathDepth||this.renderer.config.breathingDepth;this.renderer.state.breathRate=r?d*r.breathRateMult:d,this.renderer.state.breathDepth=r?p*r.breathDepthMult:p,this.renderer.state.coreJitter=t.coreJitter||r&&r.jitterAmount>0,this.renderer.state.emotionEyeOpenness=t.eyeOpenness,this.renderer.state.emotionEyeArc=t.eyeArc}}class Sh{constructor(e){this.renderer=e}resetCanvasContext(){if(!this.renderer.canvas||!this.renderer.ctx)return;const{width:e}=this.renderer.canvas,{height:t}=this.renderer.canvas;this.resetContext(this.renderer.ctx,e,t),this.renderer.offscreenCanvas&&this.renderer.offscreenCtx&&this.resetContext(this.renderer.offscreenCtx,this.renderer.offscreenCanvas.width,this.renderer.offscreenCanvas.height),this.renderer.contextStateManager&&this.renderer.contextStateManager.reset(),this.renderer.forceCleanRender=!0}resetContext(e,t,i){e.setTransform(1,0,0,1,0,0),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.clearRect(0,0,t,i)}setQualityLevel(e){this.renderer.qualityLevel=Math.max(0,Math.min(1,e)),this.renderer.qualityLevel<.5?this.applyLowQuality():this.renderer.qualityLevel<.8?this.applyMediumQuality():this.applyHighQuality()}applyLowQuality(){this.renderer.ctx.imageSmoothingEnabled=!1,this.renderer.state.breathDepth*=.5}applyMediumQuality(){this.renderer.ctx.imageSmoothingEnabled=!0,this.renderer.ctx.imageSmoothingQuality="medium"}applyHighQuality(){this.renderer.ctx.imageSmoothingEnabled=!0,this.renderer.ctx.imageSmoothingQuality="high"}setQualityReduction(e){e?this.setQualityLevel(.5):this.setQualityLevel(1)}handleContextRecovery(e){this.renderer.ctx=e}}class xh{constructor(e){this.renderer=e}destroy(){this.cancelAnimationFrames(),this.unregisterLoopCallbacks(),this.cleanupManagers(),this.clearTimeouts(),this.clearAnimationStates(),this.clearOtherResources()}cancelAnimationFrames(){for(const e in this.renderer.animationFrameIds)this.renderer.animationFrameIds[e]&&(cancelAnimationFrame(this.renderer.animationFrameIds[e]),this.renderer.animationFrameIds[e]=null)}unregisterLoopCallbacks(){for(const e in this.renderer.loopCallbackIds)this.renderer.loopCallbackIds[e]&&(_l.unregister(this.renderer.loopCallbackIds[e]),this.renderer.loopCallbackIds[e]=null)}cleanupManagers(){this.renderer.sleepManager&&this.renderer.sleepManager.cleanup(),this.renderer.gazeTracker&&this.renderer.gazeTracker.cleanup()}clearTimeouts(){this.renderer.wakeJitterTimeout&&(clearTimeout(this.renderer.wakeJitterTimeout),this.renderer.wakeJitterTimeout=null)}clearAnimationStates(){this.renderer.colorTransition.active=!1,this.renderer.zenTransition&&(this.renderer.zenTransition.active=!1)}clearOtherResources(){this.renderer.cleanupGazeTracking(),this.renderer.speakingRings=[],this.renderer.gestureCompositor&&this.renderer.gestureCompositor.clearCache(),this.renderer.specialEffects&&this.renderer.specialEffects.destroy(),this.renderer.cleanupOffscreenCanvas&&this.renderer.cleanupOffscreenCanvas()}}class kh{constructor(e){this.renderer=e}updateTimers(e){this.updateBreathing(e),this.updateBlinking(e)}updateBreathing(e){this.renderer.breathingAnimator.update(e,this.renderer.state.emotion,this.renderer.currentUndertone),"zen"===this.renderer.state.emotion?this.applyZenBreathing():this.renderer.state.sleeping?this.applySleepBreathing():this.applyNormalBreathing(),this.renderer.breathingAnimator.setIrregularBreathing(this.renderer.state.breathIrregular)}applyZenBreathing(){this.renderer.breathingAnimator.setBreathRateMultiplier(.15),this.renderer.breathingAnimator.setBreathDepthMultiplier(2.5)}applySleepBreathing(){this.renderer.breathingAnimator.setBreathRateMultiplier(.5),this.renderer.breathingAnimator.setBreathDepthMultiplier(1.2)}applyNormalBreathing(){this.renderer.breathingAnimator.setBreathRateMultiplier(1),this.renderer.breathingAnimator.setBreathDepthMultiplier(1)}updateBlinking(e){const t=this.renderer.state.blinkingEnabled&&!this.renderer.state.sleeping&&"zen"!==this.renderer.state.emotion;this.renderer.eyeRenderer.setBlinkingEnabled(t),this.renderer.eyeRenderer.update(e),this.renderer.state.blinking=this.renderer.eyeRenderer.blinking}}class Oh{constructor(e){this.renderer=e}setGazeOffset(e){this.processGazeData(e),this.handleGazeInteraction()}processGazeData(e){"object"==typeof e&&null!==e&&(this.isOldFormat(e)?this.renderer.state.gazeOffset=e:this.applyNewFormatData(e))}isOldFormat(e){return{}.hasOwnProperty.call(e,"x")&&{}.hasOwnProperty.call(e,"y")}applyNewFormatData(e){this.renderer.state.gazeOffset=e.offset||{x:0,y:0},this.renderer.state.gazeIntensity=e.proximity||0,this.renderer.state.gazeLocked=e.isLocked||!1}handleGazeInteraction(){this.renderer.idleTimer=0,this.renderer.isAsleep&&this.renderer.wakeUp()}getCurrentOrbPosition(){const e=this.renderer.canvasManager.width/2,t=this.renderer.canvasManager.height/2-this.renderer.config.topOffset;return{x:e+this.renderer.state.gazeOffset.x,y:t+this.renderer.state.gazeOffset.y}}}class Ah{constructor(e,t={}){this.canvasManager=e,this.ctx=e.getContext(),this.gestureCompositor=new Ml,this.currentUndertone=null,this.gestureAnimator=new Dl(this),this.colorUtilities=new ql,this.specialEffects=new Rl(this),this.eyeRenderer=new Bl(this),this.breathingAnimator=new El(this),this.glowRenderer=new Tl(this),this.coreRenderer=new jl(this),this.celestialRenderer=new Vl,this.zenModeRenderer=new $l,this.zenModeController=new Hl(this),this.episodicEffectController=new Ul(this),this.rotationManager=new Yl(this),this.gazeTracker=new Xl(this),this.canvasSetupManager=new Nl(this),this.renderPerformanceManager=new Jl(this),this.transformMerger=new Zl(this),this.stateUpdateManager=new Kl(this),this.dimensionCalculator=new eh(this),this.radiusCalculator=new ph(this),this.positionJitterManager=new gh(this),this.effectsRenderManager=new mh(this),this.coreShapeRenderManager=new yh(this),this.renderFinalizationManager=new fh(this),this.ambientDanceAnimator=new bh(this),this.backdropRenderer=new wh(this),this.sleepManager=new vh(this),this.emotionalStateManager=new Mh(this),this.canvasContextManager=new Sh(this),this.resourceCleanupManager=new xh(this),this.timerCoordinator=new kh(this),this.gazeInputHandler=new Oh(this),this.config={coreColor:t.coreColor||"#FFFFFF",coreSizeDivisor:t.coreSizeDivisor||12,glowMultiplier:t.glowMultiplier||2.5,defaultGlowColor:t.defaultGlowColor||"#14B8A6",breathingSpeed:t.breathingSpeed||.42,breathingDepth:t.breathingDepth||.08,renderingStyle:t.renderingStyle||"classic",baseScale:t.baseScale||1,referenceSize:400,topOffset:t.topOffset||0,positionController:t.positionController||null};const i=Math.min(this.canvasManager.width||400,this.canvasManager.height||400);this.scaleFactor=i/this.config.referenceSize*this.config.baseScale,this.state={emotion:"neutral",glowColor:this.config.defaultGlowColor,glowIntensity:1,breathRate:1,breathDepth:this.config.breathingDepth,coreJitter:!1,speaking:!1,recording:!1,sleeping:!1,blinking:!1,blinkingEnabled:!0,gazeOffset:{x:0,y:0},gazeIntensity:0,gazeLocked:!1,gazeTrackingEnabled:!1,gazeTarget:{x:0,y:0},zenVortexIntensity:1,effectiveCenter:{x:0,y:0,scale:1},squintAmount:0,targetSquintAmount:0,scanPhase:0,lastScanTime:0,isSuspicious:!1,customScale:null,sizeMultiplier:1,jitterAmount:0,episodicFlutter:!1,glowRadiusMult:1,breathRateMult:1,breathDepthMult:1,breathIrregular:!1,particleRateMult:1,glowPulse:0,brightnessFlicker:0,brightnessMult:1,saturationMult:1,hueShift:0,manualRotation:0,rotationSpeed:0,lastRotationUpdate:performance.now()},this.animationFrameIds={colorTransition:null,eyeClose:null,eyeOpen:null,zenEnter:null,zenExit:null},this.loopCallbackIds={eyeClose:null,eyeOpen:null,zenEnter:null,zenExit:null},this.wakeJitterTimeout=null,this.offscreenCanvas=null,this.offscreenCtx=null,this.initOffscreenCanvas(),this.canvas=e.canvas,this.gestureAnimations={bounce:{active:!1,startTime:0,progress:0,params:null},pulse:{active:!1,startTime:0,progress:0,params:null},shake:{active:!1,startTime:0,progress:0,params:null},spin:{active:!1,startTime:0,progress:0,params:null},nod:{active:!1,startTime:0,progress:0,params:null},tilt:{active:!1,startTime:0,progress:0,params:null},expand:{active:!1,startTime:0,progress:0,params:null},contract:{active:!1,startTime:0,progress:0,params:null},flash:{active:!1,startTime:0,progress:0,params:null},drift:{active:!1,startTime:0,progress:0,params:null,startX:0,startY:0},stretch:{active:!1,startTime:0,progress:0,params:null},glow:{active:!1,startTime:0,progress:0,params:null},flicker:{active:!1,startTime:0,progress:0,params:null},vibrate:{active:!1,startTime:0,progress:0,params:null},wave:{active:!1,startTime:0,progress:0,params:null},breathe:{active:!1,startTime:0,progress:0,params:null},morph:{active:!1,startTime:0,progress:0,params:null},slowBlink:{active:!1,startTime:0,progress:0,params:null},look:{active:!1,startTime:0,progress:0,params:null,targetX:0,targetY:0},settle:{active:!1,startTime:0,progress:0,params:null},breathIn:{active:!1,startTime:0,progress:0,params:null},breathOut:{active:!1,startTime:0,progress:0,params:null},breathHold:{active:!1,startTime:0,progress:0,params:null},breathHoldEmpty:{active:!1,startTime:0,progress:0,params:null},jump:{active:!1,startTime:0,progress:0,params:null},orbital:{active:!1,startTime:0,progress:0,params:null},hula:{active:!1,startTime:0,progress:0,params:null}},Object.defineProperty(this,"episodicEffects",{get:()=>this.episodicEffectController.getEpisodicEffects(),enumerable:!0}),this.speakingRings=[],this.maxRings=5,this.ringSpawnTimer=0,this.ringSpawnInterval=200,this.recordingRings=[],this.recordingPulse=0,this.sleepZ=[],Object.defineProperty(this,"zenTransition",{get:()=>this.zenModeController.getZenTransition(),enumerable:!0}),this.colorTransition={active:!1,fromColor:this.state.glowColor,toColor:this.state.glowColor,fromIntensity:this.state.glowIntensity,toIntensity:this.state.glowIntensity,progress:0,startTime:0,duration:1500},this.undertoneModifiers={nervous:{hueShift:0,saturationMult:1.05,brightnessMult:1,brightnessFlicker:.05,sizeMultiplier:1,jitterAmount:0,episodicFlutter:!0,glowRadiusMult:1,glowPulse:.05,breathRateMult:1.1,breathDepthMult:.9,breathIrregular:!0},confident:{hueShift:15,saturationMult:1.2,brightnessMult:1.1,sizeMultiplier:1,jitterAmount:0,episodicPowerPose:!0,glowRadiusMult:1.15,breathRateMult:.95,breathDepthMult:1.1,breathIrregular:!1},tired:{hueShift:-5,saturationMult:.7,brightnessMult:.85,sizeMultiplier:.95,jitterAmount:0,episodicMicroSleep:!0,glowRadiusMult:.9,breathRateMult:.8,breathDepthMult:1.2,breathIrregular:!1},intense:{hueShift:5,saturationMult:1.3,brightnessMult:1.15,sizeMultiplier:1,jitterAmount:0,episodicLaserFocus:!0,glowRadiusMult:1.2,breathRateMult:1.2,breathDepthMult:.9,breathIrregular:!1},subdued:{hueShift:-10,saturationMult:.75,brightnessMult:.9,sizeMultiplier:.95,jitterAmount:0,episodicWithdrawal:!0,glowRadiusMult:.85,breathRateMult:.9,breathDepthMult:.9,breathIrregular:!1}},this.lastFrameTime=0,this.te()}scaleValue(e){return e*this.scaleFactor}initOffscreenCanvas(){this.offscreenCanvas=document.createElement("canvas"),this.offscreenCtx=this.offscreenCanvas.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),this.updateOffscreenSize()}cleanupOffscreenCanvas(){this.offscreenCanvas&&(this.offscreenCtx&&(this.offscreenCtx.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),this.offscreenCtx=null),this.offscreenCanvas.width=0,this.offscreenCanvas.height=0,this.offscreenCanvas=null)}updateOffscreenSize(){if(this.offscreenCanvas&&this.canvasManager){const{width:e}=this.canvasManager.canvas,{height:t}=this.canvasManager.canvas;if(this.offscreenCanvas.width!==e||this.offscreenCanvas.height!==t){this.offscreenCanvas.width=e,this.offscreenCanvas.height=t;const i=this.canvasManager.canvas.width>this.canvasManager.width;this.offscreenCtx&&(this.offscreenCtx.setTransform(1,0,0,1,0,0),i&&this.canvasManager.dpr&&this.offscreenCtx.scale(this.canvasManager.dpr,this.canvasManager.dpr))}}}updateEffectiveCenter(e){this.state.effectiveCenter=e}getEffectiveCenter(){const e=this.canvasManager.getCenter();let t;return t=this.config.positionController?this.config.positionController.getEffectiveCenter(e.x,e.y):{x:e.x,y:e.y,scale:1},t.x+=this.state.gazeOffset.x,t.y+=this.state.gazeOffset.y,t}render(e,t,i=null){const a=this.renderPerformanceManager.initializeFrame();i=this.transformMerger.mergeAndStoreTransforms(i,t);const{logicalWidth:s,logicalHeight:n,originalCtx:r}=this.canvasSetupManager.setupCanvas();this.canvasSetupManager.performCanvasSetup(s,n,r,t),this.stateUpdateManager.performFrameStateUpdates(t);const o=this.dimensionCalculator.calculateRenderDimensions(s,n,e,i),{scaleMultiplier:l,glowMultiplier:h,gestureTransforms:c,centerX:u,centerY:d}=o;let{rotationAngle:p}=o;const g=this.radiusCalculator.calculateRadii(e,l,h);let{coreRadius:m,glowRadius:y}=g;const{effectiveGlowIntensity:f,sleepOpacityMod:b,glowOpacityMod:w}=g,v=this.positionJitterManager.applyAllModifications(u,d,p,m,y),{coreX:M,coreY:S}=v;({rotationAngle:p,coreRadius:m,glowRadius:y}=v);const x=this.rotationManager.applyRotationTransform(this.ctx,M,S,p);this.effectsRenderManager.renderAllEffects({coreX:M,coreY:S,glowRadius:y,effectiveGlowIntensity:f,glowOpacityMod:w,gestureTransforms:c,coreRadius:m,deltaTime:t}),this.coreShapeRenderManager.renderCoreAndShapes({coreX:M,coreY:S,coreRadius:m,totalRotation:x,sleepOpacityMod:b,deltaTime:t}),this.renderFinalizationManager.finalizeRender({centerX:u,centerY:d,glowRadius:y,deltaTime:t,originalCtx:r,logicalWidth:s,logicalHeight:n,frameStartTime:a})}renderRecordingGlow(e,t,i,a){const s=this.canvas?.width||600,n=this.canvas?.height||600,r=Math.min(i,e-10,t-10,s-e-10,n-t-10),o=Math.max(50,r),l=Pl.getRadialGradient(this.ctx,e,t,0,e,t,o,[{offset:0,color:this.hexToRgba("#FF0000",.7*a)},{offset:.3,color:this.hexToRgba("#FF0000",.5*a)},{offset:.6,color:this.hexToRgba("#FF0000",.3*a)},{offset:.85,color:this.hexToRgba("#FF0000",.1*a)},{offset:1,color:this.hexToRgba("#FF0000",0)}]);this.ctx.fillStyle=l,this.ctx.beginPath(),this.ctx.arc(e,t,o,0,2*Math.PI),this.ctx.fill()}renderDropShadow(e,t,i,a){const{ctx:s}=this,n=this.shapeMorpher&&this.shapeMorpher.isTransitioning;if(!(this.shapeMorpher&&(this.shapeMorpher.audioDeformation>.1||this.shapeMorpher.vocalEnergy>.1)||n&&!(this.shapeMorpher.morphProgress>.8))){s.save(),s.translate(e,t);const n=this.scaleValue(2);if(s.translate(0,n),a&&a.length>32)s.fillStyle="rgba(0, 0, 0, 0.15)",s.beginPath(),s.arc(0,0,1.05*i,0,2*Math.PI),s.fill();else{const e=s.createRadialGradient(0,0,.7*i,0,0,1.2*i);if(e.addColorStop(0,"rgba(0, 0, 0, 0.2)"),e.addColorStop(.8,"rgba(0, 0, 0, 0.1)"),e.addColorStop(1,"rgba(0, 0, 0, 0)"),s.fillStyle=e,s.beginPath(),a){const e=1.1,t=a.length>20?2:1;s.moveTo(a[0].x*e,a[0].y*e);for(let i=t;i<a.length;i+=t)s.lineTo(a[i].x*e,a[i].y*e);s.closePath()}else s.arc(0,0,1.1*i,0,2*Math.PI);s.fill()}s.restore()}}renderSunEffects(e,t,i,a){return this.celestialRenderer.renderSunEffects(this.ctx,e,t,i,a)}renderBaileysBeads(e,t,i,a,s,n,r,o){return this.celestialRenderer.renderBaileysBeads(this.ctx,e,t,i,a,s,n,r,o,this.scaleValue.bind(this))}renderMoonShadow(e,t,i,a,s,n=!1,r=0){return this.celestialRenderer.renderMoonShadow(this.ctx,e,t,i,a,s,n,r,this.shapeMorpher)}renderZenCore(e,t,i){return this.zenModeRenderer.renderZenCore(this.ctx,e,t,i,this.state,this.zenTransition,this.gestureTransform,this.scaleValue.bind(this))}renderSpeakingRings(e,t,i,a){return this.specialEffects.renderSpeakingRings(e,t,i,a)}renderRecordingIndicator(e,t){return this.specialEffects.renderRecordingIndicator(e,t)}renderSleepIndicator(e,t,i){return this.sleepManager.renderSleepIndicator(e,t,i)}updateTimers(e){this.timerCoordinator.updateTimers(e)}applyUndertoneModifiers(e){this.emotionalStateManager.applyUndertoneModifiers(e)}applyUndertoneToColor(e,t){return this.colorUtilities.applyUndertoneToColor(e,t)}hexToRgb(e){return this.colorUtilities.hexToRgb(e)}rgbToHsl(e,t,i){return this.colorUtilities.rgbToHsl(e,t,i)}hslToHex(e,t,i){return this.colorUtilities.hslToHex(e,t,i)}hexToRgba(e,t=1){const i=this.hexToRgb(e);return i?`rgba(${i.r}, ${i.g}, ${i.b}, ${t})`:`rgba(255, 255, 255, ${t})`}startColorTransition(e,t,i=1500){this.colorUtilities.currentColor=this.state.glowColor,this.colorUtilities.currentIntensity=this.state.glowIntensity,this.colorUtilities.startColorTransition(e,t,i),this.colorTransition=this.colorUtilities.colorTransition}updateColorTransition(e){const t=this.colorUtilities.updateColorTransition(e);t&&(this.state.glowColor=t.color,this.state.glowIntensity=t.intensity,this.colorTransition=this.colorUtilities.colorTransition)}updateUndertone(e){this.emotionalStateManager.updateUndertone(e)}setEmotionalState(e,t,i=null){this.emotionalStateManager.setEmotionalState(e,t,i)}setBPM(e){}setRotationSpeed(e){this.rotationManager.setRotationSpeed(e)}setRotationAngle(e){this.rotationManager.setRotationAngle(e)}setGazeOffset(e){this.gazeInputHandler.setGazeOffset(e)}getCurrentOrbPosition(){return this.gazeInputHandler.getCurrentOrbPosition()}setCustomScale(e){this.state.customScale=e}startSpeaking(){this.state.speaking=!0,this.speakingRings=[],this.ringSpawnTimer=0}stopSpeaking(){this.state.speaking=!1,this.speakingRings=[]}enterSleepMode(){this.sleepManager.enterSleepMode()}wakeUp(){this.sleepManager.wakeUp()}enterZenMode(e,t){this.zenModeController.enterZenMode(e,t)}exitZenMode(e,t,i){this.zenModeController.exitZenMode(e,t,i)}startRecording(){this.state.recording=!0}stopRecording(){this.state.recording=!1}setBlinkingEnabled(e){this.state.blinkingEnabled=e,e||(this.state.blinking=!1,this.eyeRenderer.blinking=!1,this.eyeRenderer.blinkTimer=0)}setGazeTracking(e){this.gazeTracker.setEnabled(e)}initGazeTracking(){this.gazeTracker.initialize()}cleanupGazeTracking(){this.gazeTracker.cleanup()}resetCanvasContext(){this.canvasContextManager.resetCanvasContext()}setQualityLevel(e){this.canvasContextManager.setQualityLevel(e)}setQualityReduction(e){this.canvasContextManager.setQualityReduction(e)}handleContextRecovery(e){this.canvasContextManager.handleContextRecovery(e)}getUndertoneModifier(){return this.stateMachine&&this.stateMachine.getWeightedUndertoneModifiers?this.stateMachine.getWeightedUndertoneModifiers():this.currentUndertone&&this.undertoneModifiers[this.currentUndertone]?this.undertoneModifiers[this.currentUndertone]:null}applyGestureAnimations(){return this.gestureAnimator.applyGestureAnimations()}startGesture(e){return this.gestureAnimator.startGesture(e)}getCurrentGesture(){return this.gestureAnimator.getCurrentGesture()}te(){["Bounce","Pulse","Shake","Spin","Nod","Tilt","Expand","Contract","Flash","Drift","Stretch","Glow","Flicker","Vibrate","Orbital","Hula","Wave","Breathe","Morph","SlowBlink","Look","Settle","BreathIn","BreathOut","BreathHold","BreathHoldEmpty","Jump","Sway","Float","Rain","RunningMan","Charleston","Sparkle","Shimmer","Wiggle","Groove","Point","Lean","Reach","HeadBob","Orbit"].forEach(e=>{const t=`start${e}`;this[t]=()=>this.gestureAnimator[t]()})}startGrooveSway(e){this.ambientDanceAnimator.startAmbientAnimation("grooveSway",e)}startGrooveBob(e){this.ambientDanceAnimator.startAmbientAnimation("grooveBob",e)}startGrooveFlow(e){this.ambientDanceAnimator.startAmbientAnimation("grooveFlow",e)}startGroovePulse(e){this.ambientDanceAnimator.startAmbientAnimation("groovePulse",e)}startGrooveStep(e){this.ambientDanceAnimator.startAmbientAnimation("grooveStep",e)}stopAllGestures(){this.gestureAnimator.stopAllGestures(),this.currentGesture=null}isGestureActive(){return Object.values(this.gestureAnimator.gestureAnimations).some(e=>e.active)}destroy(){this.resourceCleanupManager.destroy()}}class Ch{constructor(e,t={}){this.canvas=e,this.config={smoothing:t.smoothing||.1,maxOffset:t.maxOffset||.3,lockDistance:t.lockDistance||30,enabled:!1!==t.enabled,boundaryPadding:t.boundaryPadding||.8},this.canvasCenter={x:0,y:0},this.mousePos={x:0,y:0},this.targetGaze={x:0,y:0},this.currentGaze={x:0,y:0},this.isLocked=!1,this.proximity=0,this.cachedRect=null,this.touches=new Map,this.primaryTouch=null,this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.onInteraction=null,this.updateCanvasCenter(),this.attachEventListeners(),"undefined"!=typeof ResizeObserver&&(this.resizeObserver=new ResizeObserver(()=>{this.updateCanvasCenter()}),this.resizeObserver.observe(this.canvas))}updateCanvasCenter(){this.cachedRect=this.canvas.getBoundingClientRect(),this.canvasCenter={x:this.cachedRect.width/2,y:this.cachedRect.height/2},0===this.mousePos.x&&0===this.mousePos.y&&(this.mousePos={x:this.canvasCenter.x,y:this.canvasCenter.y})}attachEventListeners(){this.config.enabled&&(this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseleave",this.handleMouseLeave),this.canvas.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.canvas.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.canvas.addEventListener("touchend",this.handleTouchEnd,{passive:!0}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd,{passive:!0}))}handleMouseMove(e){const t=this.cachedRect||this.canvas.getBoundingClientRect();this.mousePos={x:e.clientX-t.left,y:e.clientY-t.top},this.updateTargetGaze(),this.onInteraction&&this.onInteraction("mouse")}handleMouseLeave(){this.targetGaze={x:0,y:0},this.isLocked=!1,this.proximity=0,this.mousePos={x:this.canvasCenter.x,y:this.canvasCenter.y}}handleTouchStart(e){for(const t of e.changedTouches)this.touches.set(t.identifier,{x:t.clientX,y:t.clientY}),this.primaryTouch||1!==this.touches.size||(this.primaryTouch=t.identifier);null!==this.primaryTouch&&this.updateTouchPosition(e.touches)}handleTouchMove(e){for(const t of e.changedTouches)this.touches.has(t.identifier)&&this.touches.set(t.identifier,{x:t.clientX,y:t.clientY});null!==this.primaryTouch&&(this.updateTouchPosition(e.touches),this.onInteraction&&this.onInteraction("touch"))}handleTouchEnd(e){for(const t of e.changedTouches)this.touches.delete(t.identifier),t.identifier===this.primaryTouch&&(this.primaryTouch=null,this.touches.size>0?this.primaryTouch=this.touches.keys().next().value:this.handleMouseLeave())}updateTouchPosition(e){for(const t of e)if(t.identifier===this.primaryTouch){const e=this.cachedRect||this.canvas.getBoundingClientRect();this.mousePos={x:t.clientX-e.left,y:t.clientY-e.top},this.updateTargetGaze();break}}updateTargetGaze(){const e=this.mousePos.x-this.canvasCenter.x,t=this.mousePos.y-this.canvasCenter.y,i=Math.sqrt(e*e+t*t),a=Math.min(this.canvasCenter.x,this.canvasCenter.y);if(this.proximity=Math.max(0,1-i/a),this.isLocked=i<this.config.lockDistance,this.isLocked)this.targetGaze={x:e*this.config.maxOffset*2,y:t*this.config.maxOffset*2};else{const s=Math.min(this.canvasCenter.x,this.canvasCenter.y)*this.config.maxOffset;if(i>0){const n=Math.min(1,i/a);this.targetGaze={x:e/i*s*n*this.config.boundaryPadding,y:t/i*s*n*this.config.boundaryPadding}}else this.targetGaze={x:0,y:0}}}update(e){if(!this.config.enabled)return;const t=1-Math.pow(1-this.config.smoothing,e/16.67);if(this.currentGaze.x+=(this.targetGaze.x-this.currentGaze.x)*t,this.currentGaze.y+=(this.targetGaze.y-this.currentGaze.y)*t,this.isLocked){const e=.5;this.currentGaze.x+=(Math.random()-.5)*e,this.currentGaze.y+=(Math.random()-.5)*e}}getGazeOffset(e){return{x:this.currentGaze.x,y:this.currentGaze.y}}getState(){return{gaze:{...this.currentGaze},target:{...this.targetGaze},proximity:this.proximity,isLocked:this.isLocked,isActive:this.config.enabled}}enable(){this.config.enabled||(this.config.enabled=!0,this.attachEventListeners())}disable(){this.config.enabled&&(this.config.enabled=!1,this.detachEventListeners(),this.targetGaze={x:0,y:0})}detachEventListeners(){this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("touchcancel",this.handleTouchEnd)}setInteractionCallback(e){this.onInteraction=e}destroy(){this.detachEventListeners(),this.resizeObserver&&this.resizeObserver.disconnect(),this.touches.clear()}}class Ih{constructor(e={}){this.config={blinkInterval:e.blinkInterval||{min:3e3,max:7e3},blinkDuration:e.blinkDuration||150,swayInterval:e.swayInterval||{min:2e4,max:4e4},swayDuration:e.swayDuration||4e3,swayIntensity:e.swayIntensity||1.5,sleepTimeout:void 0!==e.sleepTimeout?e.sleepTimeout:1/0,breathingSpeed:e.breathingSpeed||.25,breathingDepth:e.breathingDepth||.1,enabled:!1!==e.enabled},this.state={isBlinking:!1,isSwaying:!1,isAsleep:!1,breathingPhase:0,breathRate:1,breathDepth:this.config.breathingDepth},this.timers={idle:0,blink:0,sway:0,swayProgress:0,nextBlink:this.getRandomInterval("blink"),nextSway:this.getRandomInterval("sway")},this.swayOffset={x:0,y:0},this.swayTarget={x:0,y:0},this.swayStart={x:0,y:0},this.wakeUpTimeout=null,this.callbacks={onBlink:null,onSway:null,onSleep:null,onWake:null}}update(e){this.config.enabled&&(this.updateBreathing(e),this.timers.idle+=e,!this.state.isAsleep&&this.timers.idle>=this.config.sleepTimeout&&this.enterSleep(),this.state.isAsleep||this.updateBlinking(e),this.state.isAsleep||this.updateSwaying(e))}updateBreathing(e){const t=this.config.breathingSpeed*this.state.breathRate;this.state.breathingPhase+=t*e/1e3,this.state.breathingPhase>2*Math.PI&&(this.state.breathingPhase-=2*Math.PI)}updateBlinking(e){this.isBlinkingEnabled()&&(this.state.isBlinking?(this.timers.blink+=e,this.timers.blink>=this.config.blinkDuration&&this.endBlink()):(this.timers.blink+=e,this.timers.blink>=this.timers.nextBlink&&this.startBlink()))}updateSwaying(e){if(this.state.isSwaying){this.timers.sway+=e;const t=Math.min(this.timers.sway/this.config.swayDuration,1),i=(Math.sin((t-.5)*Math.PI)+1)/2;this.swayOffset.x=this.swayStart.x+(this.swayTarget.x-this.swayStart.x)*i,this.swayOffset.y=this.swayStart.y+(this.swayTarget.y-this.swayStart.y)*i,t>=1&&this.endSway()}else this.timers.sway+=e,this.timers.sway>=this.timers.nextSway&&this.startSway()}startBlink(){this.state.isBlinking=!0,this.timers.blink=0,this.callbacks.onBlink&&this.callbacks.onBlink({phase:"start"})}endBlink(){this.state.isBlinking=!1,this.timers.blink=0,this.timers.nextBlink=this.getRandomInterval("blink"),this.callbacks.onBlink&&this.callbacks.onBlink({phase:"end"})}startSway(){this.state.isSwaying=!0,this.timers.sway=0,this.swayStart={...this.swayOffset};const e=Math.random()*Math.PI*2,t=this.config.swayIntensity*(.5+.5*Math.random());this.swayTarget={x:Math.cos(e)*t*1.5,y:Math.sin(e)*t*.5},this.callbacks.onSway&&this.callbacks.onSway({phase:"start",offset:this.swayOffset})}endSway(){this.state.isSwaying=!1,this.timers.sway=0,this.timers.nextSway=this.getRandomInterval("sway"),this.swayStart={...this.swayOffset},this.callbacks.onSway&&this.callbacks.onSway({phase:"end",offset:this.swayOffset})}enterSleep(){this.state.isAsleep=!0,this.state.breathRate=.5,this.state.breathDepth=.15,this.state.isBlinking&&(this.state.isBlinking=!1,this.timers.blink=0,this.callbacks.onBlink&&this.callbacks.onBlink({phase:"end"})),this.callbacks.onSleep&&this.callbacks.onSleep()}wakeUp(){this.state.isAsleep&&(this.state.isAsleep=!1,this.state.breathRate=1,this.state.breathDepth=this.config.breathingDepth,this.timers.idle=0,this.callbacks.onWake&&this.callbacks.onWake(),this.performWakeAnimation())}performWakeAnimation(){const e={x:.5*this.config.swayIntensity,y:-this.config.swayIntensity};this.swayStart={...this.swayOffset},this.swayTarget=e,this.state.isSwaying=!0,this.timers.sway=0,this.callbacks.onSway&&this.callbacks.onSway({phase:"wake",offset:this.swayOffset}),this.wakeUpTimeout&&clearTimeout(this.wakeUpTimeout),this.wakeUpTimeout=setTimeout(()=>{this.swayStart={...this.swayOffset},this.swayTarget={x:0,y:0},this.timers.sway=0,this.wakeUpTimeout=null},1e3)}resetIdleTimer(){this.timers.idle=0,this.state.isAsleep&&this.wakeUp()}setBlinkingEnabled(e){this.config.blinkingEnabled=e,!e&&this.state.isBlinking&&this.endBlink()}isBlinkingEnabled(){return!1!==this.config.blinkingEnabled}getBreathingFactor(){return 1+Math.sin(this.state.breathingPhase)*this.state.breathDepth*this.state.breathRate}getBlinkProgress(){return this.state.isBlinking?Math.min(this.timers.blink/this.config.blinkDuration,1):0}getSwayOffset(){return this.swayOffset||{x:0,y:0}}getRandomInterval(e){const t=this.config[`${e}Interval`];return t.min+Math.random()*(t.max-t.min)}setCallback(e,t){({}).hasOwnProperty.call(this.callbacks,e)&&(this.callbacks[e]=t)}getState(){return{...this.state,breathingFactor:this.getBreathingFactor(),blinkProgress:this.getBlinkProgress(),swayOffset:this.getSwayOffset()}}enable(){this.config.enabled=!0}disable(){this.config.enabled=!1,this.state.isBlinking=!1,this.state.isSwaying=!1,this.swayOffset={x:0,y:0}}destroy(){this.wakeUpTimeout&&(clearTimeout(this.wakeUpTimeout),this.wakeUpTimeout=null),this.callbacks={onBlink:null,onSway:null,onSleep:null,onWake:null}}}class zh{constructor(e){this.positionController=e,this.watchedElements=new Map,this.updateCallbacks=new Map}moveToElement(e,t="right",i={x:20,y:0},a={}){const s=document.querySelector(e);if(!s)return;const n=s.getBoundingClientRect(),r=n.left+n.width/2,o=n.top+n.height/2;let l,h;switch(t){case"right":default:l=n.right+i.x,h=o+i.y;break;case"left":l=n.left-i.x,h=o+i.y;break;case"above":l=r+i.x,h=n.top-i.y;break;case"below":l=r+i.x,h=n.bottom+i.y;break;case"center":l=r+i.x,h=o+i.y}const c=l-window.innerWidth/2,u=h-window.innerHeight/2;!1!==a.animate?this.positionController.animateOffset(c,u,0,a.duration||1e3,a.easing||"easeOutCubic"):this.positionController.setOffset(c,u,0)}moveToButton(e="button",t="right",i={x:20,y:0}){this.moveToElement(e,t,i)}moveToForm(e="form",t="right",i={x:20,y:0}){this.moveToElement(e,t,i)}moveToModal(e='[role="dialog"], .modal',t="center",i={x:0,y:0}){this.moveToElement(e,t,i)}moveToNavigation(e="nav, .navigation",t="below",i={x:0,y:20}){this.moveToElement(e,t,i)}moveToContent(e="main, .content",t="center",i={x:0,y:0}){this.moveToElement(e,t,i)}moveToSidebar(e=".sidebar, aside",t="right",i={x:20,y:0}){this.moveToElement(e,t,i)}moveToHeader(e="header, .header",t="below",i={x:0,y:20}){this.moveToElement(e,t,i)}moveToFooter(e="footer, .footer",t="above",i={x:0,y:20}){this.moveToElement(e,t,i)}watchElement(e,t="right",i={x:20,y:0}){const a=()=>{this.moveToElement(e,t,i,{animate:!1})},s=`${e}-${t}-${JSON.stringify(i)}`;return this.updateCallbacks.set(s,a),window.addEventListener("scroll",a),window.addEventListener("resize",a),a(),()=>{window.removeEventListener("scroll",a),window.removeEventListener("resize",a),this.updateCallbacks.delete(s)}}stopWatchingAll(){this.updateCallbacks.forEach(e=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}),this.updateCallbacks.clear()}destroy(){this.stopWatchingAll(),this.positionController=null}}class Fh extends zh{constructor(e){super(e),this.activeCallbacks=new Map,this.callbackStates=new Map}moveToElementWithCallback(e,t,i="right",a={x:20,y:0},s={}){const n=`callback-${Date.now()}-${Math.random()}`,r=document.querySelector(e);if(!r)return;this.callbackStates.set(n,{executed:!1,element:r,callback:t,options:s}),this.moveToElement(e,i,a,s);const o=()=>{if(this.isMascotNearElement(r,s.proximity||50)){const e=this.callbackStates.get(n);e&&!e.executed&&(e.executed=!0,t(),s.repeat||this.callbackStates.delete(n))}this.callbackStates.has(n)&&requestAnimationFrame(o)};return this.activeCallbacks.set(n,o),o(),()=>{this.activeCallbacks.delete(n),this.callbackStates.delete(n)}}moveToElementSequence(e=[],t={}){let i=0;const a=[],s=()=>{if(i>=e.length)return void(t.onComplete&&t.onComplete());const n=e[i],r=this.moveToElementWithCallback(n.selector,()=>{n.callback&&n.callback(),i++,setTimeout(s,n.delay||0)},n.position||"right",n.offset||{x:20,y:0},{...t,...n.options});r&&a.push(r)};return s(),()=>{a.forEach(e=>e())}}moveToElementWithDelay(e,t,i=1e3,a="right",s={x:20,y:0}){return this.moveToElementWithCallback(e,()=>{setTimeout(t,i)},a,s)}moveToElementWithCondition(e,t,i,a="right",s={x:20,y:0}){return this.moveToElementWithCallback(e,()=>{t()&&i()},a,s)}moveToElementWithRepeat(e,t,i=1e3,a="right",s={x:20,y:0}){return this.moveToElementWithCallback(e,()=>{setInterval(t,i)},a,s,{repeat:!0})}moveToElementWithProximity(e,t,i=100,a="right",s={x:20,y:0}){return this.moveToElementWithCallback(e,t,a,s,{proximity:i})}isMascotNearElement(e,t=50){if(!this.positionController||!e)return!1;const i=e.getBoundingClientRect(),a=i.left+i.width/2,s=i.top+i.height/2,n=this.positionController.getOffset(),r=n.x+window.innerWidth/2,o=n.y+window.innerHeight/2;return Math.sqrt(Math.pow(r-a,2)+Math.pow(o-s,2))<=t}stopAllCallbacks(){this.activeCallbacks.forEach((e,t)=>{this.activeCallbacks.delete(t)}),this.callbackStates.clear()}destroy(){this.stopAllCallbacks(),super.destroy()}}class Dh extends zh{constructor(e){super(e),this.activePaths=new Map,this.obstacles=new Set,this.audioContext=null,this.audioAnalyser=null,this.gazeTracker=null,this.activeRAFIds=new Set,this.activeSmoothAnimations=new Set}moveToElementWithPath(e,t=[],i="right",a={x:20,y:0},s={}){const n=`path-${Date.now()}-${Math.random()}`,r=document.querySelector(e);if(!r)return;const o=window.innerWidth||1,l=window.innerHeight||1,h=o/2,c=l/2,u=s.coordinateSystem||"auto",d=Array.isArray(t)?t.map((e={})=>{const t="number"==typeof e.x?e.x:0,i="number"==typeof e.y?e.y:0;return"relative"===u||"auto"===u&&t>=0&&t<=1&&i>=0&&i<=1?{x:t*o-h,y:i*l-c}:"offset"===u||"auto"===u&&Math.abs(t)<=h&&Math.abs(i)<=c?{x:t,y:i}:{x:t-h,y:i-c}}):[],p=r.getBoundingClientRect(),g={x:p.left+p.width/2+a.x-h,y:p.top+p.height/2+a.y-c},m=this.positionController.getOffset?this.positionController.getOffset():{x:0,y:0},y=[{x:"number"==typeof m.x?m.x:0,y:"number"==typeof m.y?m.y:0},...d,g];if(y.length<2)return this.positionController.setOffset(g.x,g.y,0),void("function"==typeof s.onComplete&&s.onComplete());const f=[],b=[0];let w=0;for(let e=0;e<y.length-1;e++){const t=y[e+1].x-y[e].x,i=y[e+1].y-y[e].y,a=Math.hypot(t,i);f.push(a),w+=a,b.push(w)}if(0===w)return this.positionController.setOffset(g.x,g.y,0),void("function"==typeof s.onComplete&&s.onComplete());const v="number"==typeof s.speed&&s.speed>0?s.speed:250,M=!0===s.loop,S=s.easing||"linear",x={covered:0,lastTimestamp:null},k=e=>{if(M)e%=w;else{if(e<=0)return y[0];if(e>=w)return y[y.length-1]}for(let t=0;t<f.length;t++){const i=b[t];if(e<=b[t+1]){const a=f[t]||1,s=0===a?0:(e-i)/a,n=this.positionController&&"function"==typeof this.positionController.applyEasing?this.positionController.applyEasing(s,S):s,r=y[t],o=y[t+1];return{x:r.x+(o.x-r.x)*n,y:r.y+(o.y-r.y)*n}}}return y[y.length-1]},O={stop:()=>{O.frameId&&cancelAnimationFrame(O.frameId),this.activePaths.delete(n)},frameId:null};this.activePaths.set(n,O),this.positionController.setOffset(y[0].x,y[0].y,0);const A=e=>{if(!this.activePaths.has(n))return;null===x.lastTimestamp&&(x.lastTimestamp=e);const t=e-x.lastTimestamp;if(x.lastTimestamp=e,x.covered+=v*(t/1e3),!M&&x.covered>=w)return this.positionController.setOffset(g.x,g.y,0),O.stop(),void("function"==typeof s.onComplete&&s.onComplete());const i=k(x.covered);this.positionController.setOffset(i.x,i.y,0),O.frameId=requestAnimationFrame(A)};return O.frameId=requestAnimationFrame(A),()=>{O.stop()}}moveToElementWithEasing(e,t,i=1e3,a="right",s={x:20,y:0}){const n=document.querySelector(e);if(!n)return;const r=n.getBoundingClientRect(),o=r.left+r.width/2+s.x-window.innerWidth/2,l=r.top+r.height/2+s.y-window.innerHeight/2,h=this.positionController.getOffset(),c=performance.now();let u=null;const d=e=>{const a=e-c,s=Math.min(a/i,1),n=t(s),r=h.x+(o-h.x)*n,p=h.y+(l-h.y)*n;this.positionController.setOffset(r,p,0),s<1?(u=requestAnimationFrame(d),this.activeSmoothAnimations.add(u)):null!==u&&this.activeSmoothAnimations.delete(u)};u=requestAnimationFrame(d),this.activeSmoothAnimations.add(u)}moveToElementWithCollision(e,t=[],i=100,a="right",s={x:20,y:0}){const n=document.querySelector(e);if(!n)return;const r=n.getBoundingClientRect(),o=r.left+r.width/2+s.x-window.innerWidth/2,l=r.top+r.height/2+s.y-window.innerHeight/2,h=this.positionController.getOffset();(()=>{let e=h.x,a=h.y;for(let s=0;s<=100;s++){const n=.01*s,r=h.x+(o-h.x)*n,c=h.y+(l-h.y)*n;let u=!1;t.forEach(t=>{let s,n;if("string"==typeof t){const e=document.querySelector(t);if(!e)return;{const t=e.getBoundingClientRect();s=t.left+t.width/2-window.innerWidth/2,n=t.top+t.height/2-window.innerHeight/2}}else s=t.x-window.innerWidth/2,n=t.y-window.innerHeight/2;if(Math.sqrt(Math.pow(r-s,2)+Math.pow(c-n,2))<i){u=!0;const t=Math.atan2(c-n,r-s),o=s+Math.cos(t)*i,l=n+Math.sin(t)*i;e=o,a=l}}),u||(e=r,a=c)}this.positionController.setOffset(e,a,0)})()}moveToElementWithAudio(e,t,i=50,a="right",s={x:20,y:0}){const n=document.querySelector(e);if(!n)return;this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioAnalyser=this.audioContext.createAnalyser(),this.audioAnalyser.fftSize=256),this.audioContext.createMediaStreamSource(t).connect(this.audioAnalyser);const r=new Uint8Array(this.audioAnalyser.frequencyBinCount),o=n.getBoundingClientRect(),l=o.left+o.width/2+s.x-window.innerWidth/2,h=o.top+o.height/2+s.y-window.innerHeight/2;let c=null;const u=()=>{this.audioAnalyser.getByteFrequencyData(r);let e=0;for(let t=0;t<r.length;t++)e+=r[t];const t=e/r.length/255*i,a=l+t,s=h+.5*t;this.positionController.setOffset(a,s,0),null!==c&&this.activeRAFIds.delete(c),c=requestAnimationFrame(u),this.activeRAFIds.add(c)};u()}moveToElementWithGaze(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;this.gazeTracker||(this.gazeTracker={x:window.innerWidth/2,y:window.innerHeight/2});const n=s.getBoundingClientRect(),r=n.left+n.width/2+a.x-window.innerWidth/2,o=n.top+n.height/2+a.y-window.innerHeight/2;let l=null;const h=()=>{const e=this.gazeTracker.x-window.innerWidth/2,i=this.gazeTracker.y-window.innerHeight/2,a=t.gazeWeight||.3,s=r+(e-r)*a,n=o+(i-o)*a;this.positionController.setOffset(s,n,0),null!==l&&this.activeRAFIds.delete(l),l=requestAnimationFrame(h),this.activeRAFIds.add(l)};h()}addObstacle(e){this.obstacles.add(e)}removeObstacle(e){this.obstacles.delete(e)}clearObstacles(){this.obstacles.clear()}destroy(){Array.from(this.activePaths.values()).forEach(e=>{e&&"function"==typeof e.stop?e.stop():e&&e.frameId&&cancelAnimationFrame(e.frameId)}),this.activePaths.clear(),this.activeRAFIds.forEach(e=>{cancelAnimationFrame(e)}),this.activeRAFIds.clear(),this.activeSmoothAnimations.forEach(e=>{cancelAnimationFrame(e)}),this.activeSmoothAnimations.clear(),this.obstacles.clear(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.audioAnalyser=null,this.gazeTracker=null,super.destroy()}}class qh extends zh{constructor(e){super(e),this.scrollCallbacks=new Map,this.physicsSimulations=new Map,this.responsiveBreakpoints={mobile:768,tablet:1024,desktop:1200},this.currentBreakpoint=this.getCurrentBreakpoint(),this.accessibilityEnabled=!1}moveToElementWithScroll(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`scroll-${Date.now()}-${Math.random()}`,{startScroll:r=50,endScroll:o=300,onProgress:l=null,onStart:h=null,onComplete:c=null}=t;let u=!1,d=!1;const p=()=>{const{scrollY:e}=window,t=Math.min(Math.max((e-r)/(o-r),0),1);t>0&&!u&&(u=!0,h&&h()),t>=1&&!d&&(d=!0,c&&c());const i=s.getBoundingClientRect(),n=i.left+i.width/2+a.x-window.innerWidth/2,p=i.top+i.height/2+a.y-window.innerHeight/2,g=window.innerWidth>1024,m=g?.25*window.innerWidth:.33*window.innerWidth-50,y=g?-.25*window.innerHeight-50+.15*window.innerHeight:-.35*window.innerHeight-50+.08*window.innerHeight,f=m+(n-m)*t,b=y+(p-y)*t;this.positionController.setOffset(f,b,0),l&&l(t,{scrollY:e,currentX:f,currentY:b})};return this.scrollCallbacks.set(n,p),window.addEventListener("scroll",p),p(),()=>{this.scrollCallbacks.delete(n),window.removeEventListener("scroll",p)}}moveToElementWithPhysics(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`physics-${Date.now()}-${Math.random()}`,{mass:r=1,damping:o=.98,springConstant:l=.1,maxVelocity:h=10,onUpdate:c=null}=t,u=s.getBoundingClientRect(),d=u.left+u.width/2+a.x-window.innerWidth/2,p=u.top+u.height/2+a.y-window.innerHeight/2,g=this.positionController.getOffset();let m=g.x,y=g.y,f=0,b=0;const w=()=>{f+=(d-m)*l/r,b+=(p-y)*l/r,f*=o,b*=o;const e=Math.sqrt(f*f+b*b);e>h&&(f=f/e*h,b=b/e*h),m+=f,y+=b,this.positionController.setOffset(m,y,0),c&&c({positionX:m,positionY:y,velocityX:f,velocityY:b}),this.physicsSimulations.has(n)&&requestAnimationFrame(w)};return this.physicsSimulations.set(n,w),w(),()=>{this.physicsSimulations.delete(n)}}moveToElementWithGroup(e=[],t="center",i={x:0,y:0}){if(0===e.length)return;let a=0,s=0,n=0,r=0,o=0;if(e.forEach(e=>{const t=document.querySelector(e);if(t){const e=t.getBoundingClientRect();a+=e.left,s+=e.top,n=Math.max(n,e.left+e.width),r=Math.max(r,e.top+e.height),o++}}),0===o)return;const l=a/o,h=s/o;let c,u;switch(t){case"center":default:c=l+i.x-window.innerWidth/2,u=h+i.y-window.innerHeight/2;break;case"left":c=a+i.x-window.innerWidth/2,u=h+i.y-window.innerHeight/2;break;case"right":c=n+i.x-window.innerWidth/2,u=h+i.y-window.innerHeight/2;break;case"top":c=l+i.x-window.innerWidth/2,u=s+i.y-window.innerHeight/2;break;case"bottom":c=l+i.x-window.innerWidth/2,u=r+i.y-window.innerHeight/2}this.positionController.setOffset(c,u,0)}moveToElementWithResponsive(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=()=>{const e=this.getCurrentBreakpoint(),i=t[e]||t.default||{},n=s.getBoundingClientRect(),r=n.left+n.width/2+(i.offsetX||a.x)-window.innerWidth/2,o=n.top+n.height/2+(i.offsetY||a.y)-window.innerHeight/2;this.positionController.setOffset(r,o,0)},r=()=>{const e=this.getCurrentBreakpoint();e!==this.currentBreakpoint&&(this.currentBreakpoint=e,n())};return window.addEventListener("resize",r),n(),()=>{window.removeEventListener("resize",r)}}moveToElementWithAccessibility(e,t={},i="right",a={x:20,y:0}){if(!document.querySelector(e))return;const{announce:s=!0,announcements:n=[],screenReaderPosition:r="bottom-right"}=t;let o,l;switch(r){case"bottom-right":default:o=window.innerWidth-100-window.innerWidth/2,l=window.innerHeight-100-window.innerHeight/2;break;case"bottom-left":o=100-window.innerWidth/2,l=window.innerHeight-100-window.innerHeight/2;break;case"top-right":o=window.innerWidth-100-window.innerWidth/2,l=100-window.innerHeight/2;break;case"top-left":o=100-window.innerWidth/2,l=100-window.innerHeight/2}this.positionController.setOffset(o,l,0),s&&window.speechSynthesis&&n.forEach(e=>{if(e.condition&&e.condition()){const t=new SpeechSynthesisUtterance(e.text);t.volume=.5,t.rate=.8,window.speechSynthesis.speak(t)}})}getCurrentBreakpoint(){const e=window.innerWidth;return e<this.responsiveBreakpoints.mobile?"mobile":e<this.responsiveBreakpoints.tablet?"tablet":e<this.responsiveBreakpoints.desktop?"desktop":"large"}setBreakpoints(e){this.responsiveBreakpoints={...this.responsiveBreakpoints,...e},this.currentBreakpoint=this.getCurrentBreakpoint()}enableAccessibility(){this.accessibilityEnabled=!0}disableAccessibility(){this.accessibilityEnabled=!1}destroy(){this.scrollCallbacks.forEach((e,t)=>{window.removeEventListener("scroll",e)}),this.scrollCallbacks.clear(),this.physicsSimulations.clear(),super.destroy()}}class Rh extends zh{constructor(e){super(e),this.activeInteractions=new Map,this.hoverStates=new Map,this.clickStates=new Map,this.touchStates=new Map}moveToElementWithHover(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`hover-${Date.now()}-${Math.random()}`,{onMouseEnter:r=null,onMouseLeave:o=null,onHover:l=null,followMouse:h=!1,hoverDistance:c=50}=t;let u=!1,d=0,p=0;const g=e=>{u=!0,r&&r(e)},m=e=>{u=!1,o&&o(e)},y=e=>{if(d=e.clientX,p=e.clientY,u&&l&&l(e),h&&u){const e=s.getBoundingClientRect(),t=e.left+e.width/2,i=e.top+e.height/2;if(Math.sqrt(Math.pow(d-t,2)+Math.pow(p-i,2))<=c){const e=d+a.x-window.innerWidth/2,t=p+a.y-window.innerHeight/2;this.positionController.setOffset(e,t,0)}}};return s.addEventListener("mouseenter",g),s.addEventListener("mouseleave",m),s.addEventListener("mousemove",y),this.activeInteractions.set(n,{element:s,events:[{event:"mouseenter",handler:g},{event:"mouseleave",handler:m},{event:"mousemove",handler:y}]}),()=>{const e=this.activeInteractions.get(n);e&&(e.events.forEach(({event:t,handler:i})=>{e.element.removeEventListener(t,i)}),this.activeInteractions.delete(n))}}moveToElementWithClick(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`click-${Date.now()}-${Math.random()}`,{onClick:r=null,onDoubleClick:o=null,maxClicks:l=3}=t;let h=0;const c=e=>{if(h++,r&&r(e,h),h>=l){const e=s.getBoundingClientRect(),t=e.left+e.width/2+a.x-window.innerWidth/2,i=e.top+e.height/2+a.y-window.innerHeight/2;this.positionController.setOffset(t,i,0)}},u=e=>{o&&o(e)};return s.addEventListener("click",c),s.addEventListener("dblclick",u),this.activeInteractions.set(n,{element:s,events:[{event:"click",handler:c},{event:"dblclick",handler:u}]}),()=>{const e=this.activeInteractions.get(n);e&&(e.events.forEach(({event:t,handler:i})=>{e.element.removeEventListener(t,i)}),this.activeInteractions.delete(n))}}moveToElementWithTouch(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`touch-${Date.now()}-${Math.random()}`,{onTouchStart:r=null,onTouchMove:o=null,onTouchEnd:l=null,onSwipe:h=null,swipeThreshold:c=50}=t;let u=0,d=0,p=0,g=0;const m=e=>{e.touches.length>0&&(u=e.touches[0].clientX,d=e.touches[0].clientY,r&&r(e))},y=e=>{if(e.touches.length>0){const t=e.touches[0].clientX,i=e.touches[0].clientY;o&&o(e);const s=t+a.x-window.innerWidth/2,n=i+a.y-window.innerHeight/2;this.positionController.setOffset(s,n,0)}},f=e=>{if(e.changedTouches.length>0){p=e.changedTouches[0].clientX,g=e.changedTouches[0].clientY,l&&l(e);const t=p-u,i=g-d,a=Math.sqrt(t*t+i*i);if(a>c&&h){const e=Math.abs(t)>Math.abs(i)?t>0?"right":"left":i>0?"down":"up";h(e,a)}}};return s.addEventListener("touchstart",m),s.addEventListener("touchmove",y),s.addEventListener("touchend",f),this.activeInteractions.set(n,{element:s,events:[{event:"touchstart",handler:m},{event:"touchmove",handler:y},{event:"touchend",handler:f}]}),()=>{const e=this.activeInteractions.get(n);e&&(e.events.forEach(({event:t,handler:i})=>{e.element.removeEventListener(t,i)}),this.activeInteractions.delete(n))}}moveToElementWithFocus(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`focus-${Date.now()}-${Math.random()}`,{onFocus:r=null,onBlur:o=null,onFocusIn:l=null,onFocusOut:h=null}=t,c=e=>{r&&r(e);const t=s.getBoundingClientRect(),i=t.left+t.width/2+a.x-window.innerWidth/2,n=t.top+t.height/2+a.y-window.innerHeight/2;this.positionController.setOffset(i,n,0)},u=e=>{o&&o(e)},d=e=>{l&&l(e)},p=e=>{h&&h(e)};return s.addEventListener("focus",c),s.addEventListener("blur",u),s.addEventListener("focusin",d),s.addEventListener("focusout",p),this.activeInteractions.set(n,{element:s,events:[{event:"focus",handler:c},{event:"blur",handler:u},{event:"focusin",handler:d},{event:"focusout",handler:p}]}),()=>{const e=this.activeInteractions.get(n);e&&(e.events.forEach(({event:t,handler:i})=>{e.element.removeEventListener(t,i)}),this.activeInteractions.delete(n))}}moveToElementWithKeyboard(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`keyboard-${Date.now()}-${Math.random()}`,{onKeyDown:r=null,onKeyUp:o=null,onKeyPress:l=null,targetKeys:h=["Enter","Space"]}=t,c=e=>{if(r&&r(e),h.includes(e.key)){const e=s.getBoundingClientRect(),t=e.left+e.width/2+a.x-window.innerWidth/2,i=e.top+e.height/2+a.y-window.innerHeight/2;this.positionController.setOffset(t,i,0)}},u=e=>{o&&o(e)},d=e=>{l&&l(e)};return s.addEventListener("keydown",c),s.addEventListener("keyup",u),s.addEventListener("keypress",d),this.activeInteractions.set(n,{element:s,events:[{event:"keydown",handler:c},{event:"keyup",handler:u},{event:"keypress",handler:d}]}),()=>{const e=this.activeInteractions.get(n);e&&(e.events.forEach(({event:t,handler:i})=>{e.element.removeEventListener(t,i)}),this.activeInteractions.delete(n))}}stopAllInteractions(){this.activeInteractions.forEach((e,t)=>{e.events.forEach(({event:t,handler:i})=>{e.element.removeEventListener(t,i)}),this.activeInteractions.delete(t)}),this.hoverStates.clear(),this.clickStates.clear(),this.touchStates.clear()}destroy(){this.stopAllInteractions(),super.destroy()}}class Bh extends zh{constructor(e){super(e),this.activeAnimations=new Map,this.animationQueue=[],this.isAnimating=!1,this.queueTimeouts=new Set,this.activeRAFIds=new Set,this.animationRAFIds=new Map}moveToElementWithBounce(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`bounce-${Date.now()}-${Math.random()}`,{duration:r=1e3,intensity:o=50,bounces:l=3,onComplete:h=null}=t,c=s.getBoundingClientRect(),u=c.left+c.width/2+a.x-window.innerWidth/2,d=c.top+c.height/2+a.y-window.innerHeight/2,p=this.positionController.getOffset(),g=performance.now(),m=e=>{const t=e-g,i=Math.min(t/r,1),a=1-Math.pow(1-i,3),s=Math.sin(a*Math.PI*l)*o*(1-i),c=p.x+(u-p.x)*i,y=p.y+(d-p.y)*i+s;if(this.positionController.setOffset(c,y,0),i<1){this.activeAnimations.set(n,m);const e=requestAnimationFrame(m);this.activeRAFIds.add(e),this.animationRAFIds.set(n,e)}else{this.activeAnimations.delete(n);const e=this.animationRAFIds.get(n);void 0!==e&&(this.activeRAFIds.delete(e),this.animationRAFIds.delete(n)),h&&h()}};this.activeAnimations.set(n,m);const y=requestAnimationFrame(m);return this.activeRAFIds.add(y),this.animationRAFIds.set(n,y),()=>{this.activeAnimations.delete(n);const e=this.animationRAFIds.get(n);void 0!==e&&(cancelAnimationFrame(e),this.activeRAFIds.delete(e),this.animationRAFIds.delete(n))}}moveToElementWithShake(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`shake-${Date.now()}-${Math.random()}`,{duration:r=500,intensity:o=10,frequency:l=20,onComplete:h=null}=t,c=s.getBoundingClientRect(),u=c.left+c.width/2+a.x-window.innerWidth/2,d=c.top+c.height/2+a.y-window.innerHeight/2,p=performance.now(),g=e=>{const t=e-p,i=Math.min(t/r,1),a=(Math.random()-.5)*o*(1-i),s=(Math.random()-.5)*o*(1-i),c=u+a,m=d+s;if(this.positionController.setOffset(c,m,0),i<1)this.activeAnimations.set(n,g),setTimeout(()=>{const e=requestAnimationFrame(g);this.activeRAFIds.add(e),this.animationRAFIds.set(n,e)},1e3/l);else{this.activeAnimations.delete(n);const e=this.animationRAFIds.get(n);void 0!==e&&(this.activeRAFIds.delete(e),this.animationRAFIds.delete(n)),h&&h()}};this.activeAnimations.set(n,g);const m=requestAnimationFrame(g);return this.activeRAFIds.add(m),this.animationRAFIds.set(n,m),()=>{this.activeAnimations.delete(n);const e=this.animationRAFIds.get(n);void 0!==e&&(cancelAnimationFrame(e),this.activeRAFIds.delete(e),this.animationRAFIds.delete(n))}}moveToElementWithPulse(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`pulse-${Date.now()}-${Math.random()}`,{duration:r=2e3,intensity:o=20,frequency:l=2,onComplete:h=null}=t,c=s.getBoundingClientRect(),u=c.left+c.width/2+a.x-window.innerWidth/2,d=c.top+c.height/2+a.y-window.innerHeight/2,p=performance.now(),g=e=>{const t=e-p,i=Math.min(t/r,1),a=Math.sin(t*l*.01)*o*(1-i),s=u+a,c=d+a;if(this.positionController.setOffset(s,c,0),i<1){this.activeAnimations.set(n,g);const e=requestAnimationFrame(g);this.activeRAFIds.add(e),this.animationRAFIds.set(n,e)}else{this.activeAnimations.delete(n);const e=this.animationRAFIds.get(n);void 0!==e&&(this.activeRAFIds.delete(e),this.animationRAFIds.delete(n)),h&&h()}};this.activeAnimations.set(n,g);const m=requestAnimationFrame(g);return this.activeRAFIds.add(m),this.animationRAFIds.set(n,m),()=>{this.activeAnimations.delete(n);const e=this.animationRAFIds.get(n);void 0!==e&&(cancelAnimationFrame(e),this.activeRAFIds.delete(e),this.animationRAFIds.delete(n))}}moveToElementWithWiggle(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`wiggle-${Date.now()}-${Math.random()}`,{duration:r=1e3,intensity:o=15,frequency:l=8,onComplete:h=null}=t,c=s.getBoundingClientRect(),u=c.left+c.width/2+a.x-window.innerWidth/2,d=c.top+c.height/2+a.y-window.innerHeight/2,p=performance.now(),g=e=>{const t=e-p,i=Math.min(t/r,1),a=Math.sin(t*l*.01)*o*(1-i),s=Math.cos(t*l*.01)*o*(1-i),c=u+a,m=d+s;if(this.positionController.setOffset(c,m,0),i<1){this.activeAnimations.set(n,g);const e=requestAnimationFrame(g);this.activeRAFIds.add(e),this.animationRAFIds.set(n,e)}else{this.activeAnimations.delete(n);const e=this.animationRAFIds.get(n);void 0!==e&&(this.activeRAFIds.delete(e),this.animationRAFIds.delete(n)),h&&h()}};this.activeAnimations.set(n,g);const m=requestAnimationFrame(g);return this.activeRAFIds.add(m),this.animationRAFIds.set(n,m),()=>{this.activeAnimations.delete(n);const e=this.animationRAFIds.get(n);void 0!==e&&(cancelAnimationFrame(e),this.activeRAFIds.delete(e),this.animationRAFIds.delete(n))}}moveToElementWithCustom(e,t,i={},a="right",s={x:20,y:0}){const n=document.querySelector(e);if(!n)return;const r=`custom-${Date.now()}-${Math.random()}`,{duration:o=1e3,onComplete:l=null}=i,h=n.getBoundingClientRect(),c=h.left+h.width/2+s.x-window.innerWidth/2,u=h.top+h.height/2+s.y-window.innerHeight/2,d=this.positionController.getOffset(),p=performance.now(),g=e=>{const i=e-p,a=Math.min(i/o,1),s=t(a,{elapsed:i,startOffset:d,targetX:c,targetY:u,currentTime:e});if(s&&"object"==typeof s){const e=void 0!==s.x?s.x:c,t=void 0!==s.y?s.y:u;this.positionController.setOffset(e,t,0)}if(a<1){this.activeAnimations.set(r,g);const e=requestAnimationFrame(g);this.activeRAFIds.add(e),this.animationRAFIds.set(r,e)}else{this.activeAnimations.delete(r);const e=this.animationRAFIds.get(r);void 0!==e&&(this.activeRAFIds.delete(e),this.animationRAFIds.delete(r)),l&&l()}};this.activeAnimations.set(r,g);const m=requestAnimationFrame(g);return this.activeRAFIds.add(m),this.animationRAFIds.set(r,m),()=>{this.activeAnimations.delete(r);const e=this.animationRAFIds.get(r);void 0!==e&&(cancelAnimationFrame(e),this.activeRAFIds.delete(e),this.animationRAFIds.delete(r))}}queueAnimations(e=[]){this.animationQueue=[...this.animationQueue,...e],this.processAnimationQueue()}processAnimationQueue(){if(this.isAnimating||0===this.animationQueue.length)return;this.isAnimating=!0;const e=this.animationQueue.shift();if(e){const t=this.executeAnimation(e);if(t){const i=setTimeout(()=>{this.queueTimeouts.delete(i),t(),this.isAnimating=!1,this.processAnimationQueue()},e.duration||1e3);this.queueTimeouts.add(i)}}}executeAnimation(e){const{type:t,targetSelector:i,options:a={},position:s="right",offset:n={x:20,y:0}}=e;switch(t){case"bounce":return this.moveToElementWithBounce(i,a,s,n);case"shake":return this.moveToElementWithShake(i,a,s,n);case"pulse":return this.moveToElementWithPulse(i,a,s,n);case"wiggle":return this.moveToElementWithWiggle(i,a,s,n);case"custom":return this.moveToElementWithCustom(i,a.animationFunction,a,s,n);default:return this.moveToElement(i,s,n)}}stopAllAnimations(){this.activeAnimations.forEach((e,t)=>{this.activeAnimations.delete(t)}),this.activeRAFIds.forEach(e=>cancelAnimationFrame(e)),this.activeRAFIds.clear(),this.animationRAFIds.clear(),this.queueTimeouts.forEach(e=>clearTimeout(e)),this.queueTimeouts.clear(),this.animationQueue=[],this.isAnimating=!1}destroy(){this.stopAllAnimations(),super.destroy()}}class Eh extends zh{constructor(e){super(e),this.activeEffects=new Map,this.trailPoints=[],this.particles=[],this.effectCanvas=null,this.effectContext=null,this.maxTrailPoints=50,this.maxParticles=100}moveToElementWithTrail(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`trail-${Date.now()}-${Math.random()}`,{color:r="#00ff88",width:o=3,opacity:l=.8,fadeSpeed:h=.95,onComplete:c=null}=t;this.initializeEffectCanvas();const u=s.getBoundingClientRect(),d=u.left+u.width/2+a.x,p=u.top+u.height/2+a.y,g=this.positionController.getOffset(),m=g.x+window.innerWidth/2,y=g.y+window.innerHeight/2,f=performance.now(),b=e=>{const t=e-f,i=Math.min(t/1e3,1),a=m+(d-m)*i,s=y+(p-y)*i;this.trailPoints.push({x:a,y:s,opacity:l*(1-i),timestamp:e}),this.trailPoints.length>this.maxTrailPoints&&this.trailPoints.shift(),this.trailPoints.forEach(e=>{e.opacity*=h}),this.trailPoints=this.trailPoints.filter(e=>e.opacity>.01),this.drawTrail(r,o),this.positionController.setOffset(a-window.innerWidth/2,s-window.innerHeight/2,0),i<1?(this.activeEffects.set(n,b),requestAnimationFrame(b)):(this.activeEffects.delete(n),c&&c())};return this.activeEffects.set(n,b),requestAnimationFrame(b),()=>{this.activeEffects.delete(n)}}moveToElementWithParticles(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`particles-${Date.now()}-${Math.random()}`,{count:r=20,color:o="#00ff88",size:l=2,speed:h=2,life:c=1e3,onComplete:u=null}=t;this.initializeEffectCanvas();const d=s.getBoundingClientRect(),p=d.left+d.width/2+a.x,g=d.top+d.height/2+a.y,m=this.positionController.getOffset(),y=m.x+window.innerWidth/2,f=m.y+window.innerHeight/2,b=performance.now();for(let e=0;e<r;e++)this.particles.push({x:y,y:f,vx:(Math.random()-.5)*h,vy:(Math.random()-.5)*h,life:c,maxLife:c,color:o,size:l});const w=e=>{const t=e-b,i=Math.min(t/1e3,1);this.particles.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.life-=16,e.opacity=e.life/e.maxLife}),this.particles=this.particles.filter(e=>e.life>0),this.drawParticles();const a=y+(p-y)*i,s=f+(g-f)*i;this.positionController.setOffset(a-window.innerWidth/2,s-window.innerHeight/2,0),i<1||this.particles.length>0?(this.activeEffects.set(n,w),requestAnimationFrame(w)):(this.activeEffects.delete(n),u&&u())};return this.activeEffects.set(n,w),requestAnimationFrame(w),()=>{this.activeEffects.delete(n)}}moveToElementWithGlow(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const n=`glow-${Date.now()}-${Math.random()}`,{color:r="#00ff88",intensity:o=50,radius:l=100,duration:h=1e3,onComplete:c=null}=t;this.initializeEffectCanvas();const u=s.getBoundingClientRect(),d=u.left+u.width/2+a.x,p=u.top+u.height/2+a.y,g=this.positionController.getOffset(),m=g.x+window.innerWidth/2,y=g.y+window.innerHeight/2,f=performance.now(),b=e=>{const t=e-f,i=Math.min(t/h,1),a=m+(d-m)*i,s=y+(p-y)*i;this.drawGlow(a,s,r,o,l,i),this.positionController.setOffset(a-window.innerWidth/2,s-window.innerHeight/2,0),i<1?(this.activeEffects.set(n,b),requestAnimationFrame(b)):(this.activeEffects.delete(n),c&&c())};return this.activeEffects.set(n,b),requestAnimationFrame(b),()=>{this.activeEffects.delete(n)}}initializeEffectCanvas(){this.effectCanvas||(this.effectCanvas=document.createElement("canvas"),this.effectCanvas.style.position="fixed",this.effectCanvas.style.top="0",this.effectCanvas.style.left="0",this.effectCanvas.style.width="100%",this.effectCanvas.style.height="100%",this.effectCanvas.style.pointerEvents="none",this.effectCanvas.style.zIndex="1000",document.body.appendChild(this.effectCanvas),this.effectContext=this.effectCanvas.getContext("2d"),this.resizeEffectCanvas())}resizeEffectCanvas(){this.effectCanvas&&(this.effectCanvas.width=window.innerWidth,this.effectCanvas.height=window.innerHeight)}drawTrail(e,t){if(this.effectContext&&!(this.trailPoints.length<2)){this.effectContext.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height),this.effectContext.strokeStyle=e,this.effectContext.lineWidth=t,this.effectContext.lineCap="round",this.effectContext.lineJoin="round",this.effectContext.beginPath(),this.effectContext.moveTo(this.trailPoints[0].x,this.trailPoints[0].y);for(let e=1;e<this.trailPoints.length;e++){const t=this.trailPoints[e];this.effectContext.globalAlpha=t.opacity,this.effectContext.lineTo(t.x,t.y)}this.effectContext.stroke(),this.effectContext.globalAlpha=1}}drawParticles(){this.effectContext&&(this.effectContext.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height),this.particles.forEach(e=>{this.effectContext.globalAlpha=e.opacity,this.effectContext.fillStyle=e.color,this.effectContext.beginPath(),this.effectContext.arc(e.x,e.y,e.size,0,2*Math.PI),this.effectContext.fill()}),this.effectContext.globalAlpha=1)}drawGlow(e,t,i,a,s,n){if(!this.effectContext)return;this.effectContext.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height);const r=this.effectContext.createRadialGradient(e,t,0,e,t,s),o=Math.floor(a*n).toString(16).padStart(2,"0"),l=i.startsWith("#")?i:`#${i}`;r.addColorStop(0,`${l}${o}`),r.addColorStop(1,`${l}00`),this.effectContext.fillStyle=r,this.effectContext.beginPath(),this.effectContext.arc(e,t,s,0,2*Math.PI),this.effectContext.fill()}stopAllEffects(){this.activeEffects.forEach((e,t)=>{this.activeEffects.delete(t)}),this.trailPoints=[],this.particles=[]}destroy(){this.stopAllEffects(),this.effectCanvas&&(document.body.removeChild(this.effectCanvas),this.effectCanvas=null,this.effectContext=null),super.destroy()}}class Ph extends zh{constructor(e){super(e),this.accessibilityOptions={screenReader:!0,keyboardNavigation:!0,highContrast:!1,reducedMotion:!1,announcements:!0},this.announcements=[],this.keyboardListeners=new Map,this.focusableElements=new Set,this.currentFocusIndex=0,this.focusOrder=[]}moveToElementWithScreenReader(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const{announce:n=!0,announcement:r="Mascot moved to element",role:o="button",label:l=s.textContent||s.alt||"Interactive element"}=t;this.moveToElement(e,i,a),n&&this.accessibilityOptions.screenReader&&this.announceToScreenReader(r),s&&(s.setAttribute("role",o),s.setAttribute("aria-label",l),s.setAttribute("aria-live","polite"))}moveToElementWithKeyboard(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const{onKeyDown:n=null,onKeyUp:r=null,onEnter:o=null,onEscape:l=null,onArrowKeys:h=null}=t,c=`keyboard-${Date.now()}-${Math.random()}`,u=e=>{switch(n&&n(e),e.key){case"Enter":case" ":o&&o(e);break;case"Escape":l&&l(e);break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":h&&h(e)}},d=e=>{r&&r(e)};return s.hasAttribute("tabindex")||s.setAttribute("tabindex","0"),s.addEventListener("keydown",u),s.addEventListener("keyup",d),this.keyboardListeners.set(c,{element:s,events:[{event:"keydown",handler:u},{event:"keyup",handler:d}]}),this.moveToElement(e,i,a),()=>{const e=this.keyboardListeners.get(c);e&&(e.events.forEach(({event:t,handler:i})=>{e.element.removeEventListener(t,i)}),this.keyboardListeners.delete(c))}}moveToElementWithHighContrast(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const{backgroundColor:n="#000000",textColor:r="#ffffff",borderColor:o="#ffffff",borderWidth:l=2}=t;this.accessibilityOptions.highContrast&&(s.style.backgroundColor=n,s.style.color=r,s.style.border=`${l}px solid ${o}`,s.style.outline=`${l}px solid ${o}`),this.moveToElement(e,i,a)}moveToElementWithReducedMotion(e,t={},i="right",a={x:20,y:0}){if(!document.querySelector(e))return;const{duration:s=0,easing:n="linear"}=t;window.matchMedia("(prefers-reduced-motion: reduce)").matches||this.accessibilityOptions.reducedMotion?this.moveToElement(e,i,a):this.moveToElement(e,i,a,{duration:s,easing:n})}moveToElementWithFocus(e,t={},i="right",a={x:20,y:0}){const s=document.querySelector(e);if(!s)return;const{autoFocus:n=!1,focusRing:r=!0,focusOrder:o=[]}=t;o.length>0?this.focusOrder=o:this.focusOrder.includes(e)||this.focusOrder.push(e),s.hasAttribute("tabindex")||s.setAttribute("tabindex","0"),r&&(s.style.outline="2px solid #0066cc",s.style.outlineOffset="2px"),n&&s.focus(),this.moveToElement(e,i,a)}navigateFocus(e="next"){if(0===this.focusOrder.length)return;this.currentFocusIndex="next"===e?(this.currentFocusIndex+1)%this.focusOrder.length:(this.currentFocusIndex-1+this.focusOrder.length)%this.focusOrder.length;const t=this.focusOrder[this.currentFocusIndex],i=document.querySelector(t);i&&(i.focus(),this.moveToElement(t,"right",{x:20,y:0}))}announceToScreenReader(e){if(!this.accessibilityOptions.announcements)return;let t=document.getElementById("mascot-live-region");t||(t=document.createElement("div"),t.id="mascot-live-region",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.position="absolute",t.style.left="-10000px",t.style.width="1px",t.style.height="1px",t.style.overflow="hidden",document.body.appendChild(t)),t.textContent=e,setTimeout(()=>{t.textContent=""},1e3)}enableAccessibility(e={}){this.accessibilityOptions={...this.accessibilityOptions,...e}}disableAccessibility(e={}){Object.keys(e).forEach(e=>{({}).hasOwnProperty.call(this.accessibilityOptions,e)&&(this.accessibilityOptions[e]=!1)})}isAccessibilityEnabled(e){return this.accessibilityOptions[e]||!1}getAccessibilityOptions(){return{...this.accessibilityOptions}}destroy(){this.keyboardListeners.forEach((e,t)=>{e.events.forEach(({event:t,handler:i})=>{e.element.removeEventListener(t,i)})}),this.keyboardListeners.clear();const e=document.getElementById("mascot-live-region");e&&document.body.removeChild(e),this.focusOrder=[],this.currentFocusIndex=0,super.destroy()}}class Th{constructor(e){this.positionController=e,this.callbacks=new Fh(e),this.advanced=new Dh(e),this.context=new qh(e),this.interactions=new Rh(e),this.animations=new Bh(e),this.effects=new Eh(e),this.accessibility=new Ph(e)}moveToElementWithCallback(...e){return this.callbacks.moveToElementWithCallback(...e)}moveToElementSequence(...e){return this.callbacks.moveToElementSequence(...e)}moveToElementWithDelay(...e){return this.callbacks.moveToElementWithDelay(...e)}moveToElementWithCondition(...e){return this.callbacks.moveToElementWithCondition(...e)}moveToElementWithRepeat(...e){return this.callbacks.moveToElementWithRepeat(...e)}moveToElementWithProximity(...e){return this.callbacks.moveToElementWithProximity(...e)}moveToElementWithPath(...e){return this.advanced.moveToElementWithPath(...e)}moveToElementWithEasing(...e){return this.advanced.moveToElementWithEasing(...e)}moveToElementWithCollision(...e){return this.advanced.moveToElementWithCollision(...e)}moveToElementWithAudio(...e){return this.advanced.moveToElementWithAudio(...e)}moveToElementWithGaze(...e){return this.advanced.moveToElementWithGaze(...e)}moveToElementWithScroll(...e){return this.context.moveToElementWithScroll(...e)}moveToElementWithPhysics(...e){return this.context.moveToElementWithPhysics(...e)}moveToElementWithGroup(...e){return this.context.moveToElementWithGroup(...e)}moveToElementWithResponsive(...e){return this.context.moveToElementWithResponsive(...e)}moveToElementWithAccessibility(...e){return this.context.moveToElementWithAccessibility(...e)}moveToElementWithHover(...e){return this.interactions.moveToElementWithHover(...e)}moveToElementWithClick(...e){return this.interactions.moveToElementWithClick(...e)}moveToElementWithTouch(...e){return this.interactions.moveToElementWithTouch(...e)}moveToElementWithFocus(...e){return this.interactions.moveToElementWithFocus(...e)}moveToElementWithKeyboard(...e){return this.interactions.moveToElementWithKeyboard(...e)}moveToElementWithBounce(...e){return this.animations.moveToElementWithBounce(...e)}moveToElementWithShake(...e){return this.animations.moveToElementWithShake(...e)}moveToElementWithPulse(...e){return this.animations.moveToElementWithPulse(...e)}moveToElementWithWiggle(...e){return this.animations.moveToElementWithWiggle(...e)}moveToElementWithCustom(...e){return this.animations.moveToElementWithCustom(...e)}moveToElementWithTrail(...e){return this.effects.moveToElementWithTrail(...e)}moveToElementWithParticles(...e){return this.effects.moveToElementWithParticles(...e)}moveToElementWithGlow(...e){return this.effects.moveToElementWithGlow(...e)}moveToElementWithScreenReader(...e){return this.accessibility.moveToElementWithScreenReader(...e)}moveToElementWithKeyboardAccessible(...e){return this.accessibility.moveToElementWithKeyboard(...e)}moveToElementWithHighContrast(...e){return this.accessibility.moveToElementWithHighContrast(...e)}moveToElementWithReducedMotion(...e){return this.accessibility.moveToElementWithReducedMotion(...e)}moveToElementWithFocusAccessible(...e){return this.accessibility.moveToElementWithFocus(...e)}announceToScreenReader(...e){return this.accessibility.announceToScreenReader(...e)}navigateFocus(...e){return this.accessibility.navigateFocus(...e)}enableAccessibility(...e){return this.accessibility.enableAccessibility(...e)}disableAccessibility(...e){return this.accessibility.disableAccessibility(...e)}destroy(){this.callbacks.destroy(),this.advanced.destroy(),this.context.destroy(),this.interactions.destroy(),this.animations.destroy(),this.effects.destroy(),this.accessibility.destroy()}}class jh{constructor(e){this.positionController=e,this.isTracking=!1,this.trackingCallbacks=new Map,this.audioContext=null,this.audioAnalyser=null,this.audioData=null}moveToMouse(e={x:20,y:20},t={}){const i="mouse-tracking",a=i=>{const a=i.clientX+e.x,s=i.clientY+e.y,n=a-window.innerWidth/2,r=s-window.innerHeight/2;!1!==t.smooth?this.positionController.animateOffset(n,r,0,t.duration||200,"easeOutQuad"):this.positionController.setOffset(n,r,0)};return this.trackingCallbacks.set(i,a),window.addEventListener("mousemove",a),()=>{window.removeEventListener("mousemove",a),this.trackingCallbacks.delete(i)}}moveToTouch(e={x:20,y:20},t={}){const i="touch-tracking",a=i=>{if(i.touches.length>0){const a=i.touches[0],s=a.clientX+e.x,n=a.clientY+e.y,r=s-window.innerWidth/2,o=n-window.innerHeight/2;!1!==t.smooth?this.positionController.animateOffset(r,o,0,t.duration||200,"easeOutQuad"):this.positionController.setOffset(r,o,0)}};return this.trackingCallbacks.set(i,a),window.addEventListener("touchmove",a),()=>{window.removeEventListener("touchmove",a),this.trackingCallbacks.delete(i)}}moveToAudio(e=0,t=50,i={}){if(this.audioContext||this.initAudioContext(),!this.audioContext||!this.audioAnalyser)return;const a="audio-tracking",s=()=>{if(!this.isTracking)return;this.audioAnalyser.getByteFrequencyData(this.audioData);let e=0;for(let t=0;t<this.audioData.length;t++)e+=this.audioData[t];const a=e/this.audioData.length/255*t,n=(i.centerX||0)+a,r=(i.centerY||0)+.5*a,o=n-window.innerWidth/2,l=r-window.innerHeight/2;this.positionController.setOffset(o,l,0),this.isTracking&&requestAnimationFrame(s)};return this.trackingCallbacks.set(a,s),this.isTracking=!0,s(),()=>{this.isTracking=!1,this.trackingCallbacks.delete(a)}}initAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioAnalyser=this.audioContext.createAnalyser(),this.audioAnalyser.fftSize=256,this.audioData=new Uint8Array(this.audioAnalyser.frequencyBinCount)}catch(e){}}connectAudioSource(e){this.audioContext&&this.audioAnalyser||this.initAudioContext(),this.audioContext&&this.audioAnalyser&&this.audioContext.createMediaStreamSource(e).connect(this.audioAnalyser)}moveToViewport(e="right",t={x:20,y:20}){let i,a;switch(e){case"top":i=window.innerWidth/2,a=t.y;break;case"bottom":i=window.innerWidth/2,a=window.innerHeight-t.y;break;case"left":i=t.x,a=window.innerHeight/2;break;case"right":default:i=window.innerWidth-t.x,a=window.innerHeight/2;break;case"top-left":i=t.x,a=t.y;break;case"top-right":i=window.innerWidth-t.x,a=t.y;break;case"bottom-left":i=t.x,a=window.innerHeight-t.y;break;case"bottom-right":i=window.innerWidth-t.x,a=window.innerHeight-t.y}const s=i-window.innerWidth/2,n=a-window.innerHeight/2;this.positionController.setOffset(s,n,0)}stopAllTracking(){this.trackingCallbacks.forEach((e,t)=>{"mouse-tracking"===t?window.removeEventListener("mousemove",e):"touch-tracking"===t&&window.removeEventListener("touchmove",e)}),this.trackingCallbacks.clear(),this.isTracking=!1}destroy(){this.stopAllTracking(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.positionController=null}}class Vh{constructor(e){this.positionController=e,this.isRunning=!1,this.physicsCallbacks=new Map,this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.lastTime=0}moveToGrid(e,t,i={x:0,y:0},a={}){const s=a.gridSize||100,n=e*s+i.x,r=t*s+i.y,o=n-window.innerWidth/2,l=r-window.innerHeight/2;!1!==a.animate?this.positionController.animateOffset(o,l,0,a.duration||1e3,a.easing||"easeOutCubic"):this.positionController.setOffset(o,l,0)}moveToGravity(e={x:0,y:0},t=.1,i={}){const a="gravity",s=a=>{if(!this.isRunning)return;const n=a-this.lastTime;if(this.lastTime=a,n>0){const a=this.positionController.getOffset(),s=a.x,r=a.y,o=e.x-s,l=e.y-r,h=Math.sqrt(o*o+l*l);if(h>0){const e=t/(h*h);this.acceleration.x=o/h*e,this.acceleration.y=l/h*e,this.velocity.x+=this.acceleration.x*n,this.velocity.y+=this.acceleration.y*n;const a=i.damping||.98;this.velocity.x*=a,this.velocity.y*=a;const c=s+this.velocity.x*n,u=r+this.velocity.y*n;this.positionController.setOffset(c,u,0)}}this.isRunning&&requestAnimationFrame(s)};return this.physicsCallbacks.set(a,s),this.isRunning=!0,this.lastTime=performance.now(),s(this.lastTime),()=>{this.isRunning=!1,this.physicsCallbacks.delete(a)}}moveToMagnetic(e=[],t=.05,i={}){const a="magnetic",s=a=>{if(!this.isRunning)return;const n=a-this.lastTime;if(this.lastTime=a,n>0){const a=this.positionController.getOffset(),s=a.x,r=a.y;let o=0,l=0;e.forEach(e=>{let i,a;if("string"==typeof e){const t=document.querySelector(e);if(!t)return;{const e=t.getBoundingClientRect();i=e.left+e.width/2-window.innerWidth/2,a=e.top+e.height/2-window.innerHeight/2}}else{if(void 0===e.x||void 0===e.y)return;i=e.x-window.innerWidth/2,a=e.y-window.innerHeight/2}const n=i-s,h=a-r,c=Math.sqrt(n*n+h*h);if(c>0){const e=t/(c*c);o+=n/c*e,l+=h/c*e}}),this.acceleration.x=o,this.acceleration.y=l,this.velocity.x+=this.acceleration.x*n,this.velocity.y+=this.acceleration.y*n;const h=i.damping||.95;this.velocity.x*=h,this.velocity.y*=h;const c=s+this.velocity.x*n,u=r+this.velocity.y*n;this.positionController.setOffset(c,u,0)}this.isRunning&&requestAnimationFrame(s)};return this.physicsCallbacks.set(a,s),this.isRunning=!0,this.lastTime=performance.now(),s(this.lastTime),()=>{this.isRunning=!1,this.physicsCallbacks.delete(a)}}moveToAvoid(e=[],t=100,i={}){const a="avoid",s=a=>{if(!this.isRunning)return;const n=a-this.lastTime;if(this.lastTime=a,n>0){const a=this.positionController.getOffset(),s=a.x,r=a.y;let o=0,l=0;e.forEach(e=>{let i,a;if("string"==typeof e){const t=document.querySelector(e);if(!t)return;{const e=t.getBoundingClientRect();i=e.left+e.width/2-window.innerWidth/2,a=e.top+e.height/2-window.innerHeight/2}}else{if(void 0===e.x||void 0===e.y)return;i=e.x-window.innerWidth/2,a=e.y-window.innerHeight/2}const n=s-i,h=r-a,c=Math.sqrt(n*n+h*h);if(c<t&&c>0){const e=(t-c)/t;o+=n/c*e,l+=h/c*e}}),this.acceleration.x=o,this.acceleration.y=l,this.velocity.x+=this.acceleration.x*n,this.velocity.y+=this.acceleration.y*n;const h=i.damping||.9;this.velocity.x*=h,this.velocity.y*=h;const c=s+this.velocity.x*n,u=r+this.velocity.y*n;this.positionController.setOffset(c,u,0)}this.isRunning&&requestAnimationFrame(s)};return this.physicsCallbacks.set(a,s),this.isRunning=!0,this.lastTime=performance.now(),s(this.lastTime),()=>{this.isRunning=!1,this.physicsCallbacks.delete(a)}}moveToRandom(e={x:0,y:0,width:400,height:400},t=3e3,i={}){const a="random",s=()=>{if(!this.isRunning)return;const a=e.x+Math.random()*e.width,n=e.y+Math.random()*e.height,r=a-window.innerWidth/2,o=n-window.innerHeight/2;!1!==i.animate?this.positionController.animateOffset(r,o,0,i.duration||1e3,i.easing||"easeOutCubic"):this.positionController.setOffset(r,o,0),this.isRunning&&setTimeout(s,t)};return this.physicsCallbacks.set(a,s),this.isRunning=!0,s(),()=>{this.isRunning=!1,this.physicsCallbacks.delete(a)}}stopAllPhysics(){this.isRunning=!1,this.physicsCallbacks.clear(),this.velocity={x:0,y:0},this.acceleration={x:0,y:0}}destroy(){this.stopAllPhysics(),this.positionController=null}}class $h{constructor(e){this.positionController=e,this.isRunning=!1,this.animationCallbacks=new Map,this.pathProgress=0,this.timeProgress=0,this.scrollProgress=0}moveToPath(e=[],t=1,i={}){if(e.length<2)return;const a="path",s=!1!==i.loop,n=i.reverse||!1,r=o=>{if(!this.isRunning)return;const l=o-(this.lastTime||o);if(this.lastTime=o,l>0){this.pathProgress+=t*l/1e3,this.pathProgress=s?this.pathProgress%e.length:Math.min(this.pathProgress,e.length-1);const r=Math.floor(this.pathProgress),o=this.pathProgress-r;let h,c;n?(h=e[e.length-1-r],c=e[e.length-2-r]||e[0]):(h=e[r],c=e[r+1]||e[0]);const u=h.x+(c.x-h.x)*o,d=h.y+(c.y-h.y)*o,p=u-window.innerWidth/2,g=d-window.innerHeight/2;if(this.positionController.setOffset(p,g,0),!s&&this.pathProgress>=e.length-1)return this.isRunning=!1,this.animationCallbacks.delete(a),void(i.onComplete&&i.onComplete())}this.isRunning&&requestAnimationFrame(r)};return this.animationCallbacks.set(a,r),this.isRunning=!0,this.lastTime=performance.now(),r(this.lastTime),()=>{this.isRunning=!1,this.animationCallbacks.delete(a)}}moveToTime(e=2e3,t="easeInOutCubic",i={}){const a="time",s=performance.now(),n=this.positionController.getOffset(),r=i.target||{x:0,y:0},o=l=>{if(!this.isRunning)return;const h=l-s,c=Math.min(h/e,1),u=this.applyEasing(c,t),d=n.x+(r.x-n.x)*u,p=n.y+(r.y-n.y)*u;this.positionController.setOffset(d,p,0),c>=1?(this.isRunning=!1,this.animationCallbacks.delete(a),i.onComplete&&i.onComplete()):requestAnimationFrame(o)};return this.animationCallbacks.set(a,o),this.isRunning=!0,o(s),()=>{this.isRunning=!1,this.animationCallbacks.delete(a)}}moveToScroll(e=0,t={x:0,y:0},i={}){const a="scroll",s=()=>{if(!this.isRunning)return;const a=window.innerWidth,s=window.innerHeight;let n,r;if("horizontal"===i.direction)n=e*a+t.x,r=s/2+t.y;else if("vertical"===i.direction)n=a/2+t.x,r=e*s+t.y;else{const o=e*Math.PI*2,l=i.radius||Math.min(a,s)/4;n=a/2+Math.cos(o)*l+t.x,r=s/2+Math.sin(o)*l+t.y}const o=n-a/2,l=r-s/2;this.positionController.setOffset(o,l,0)};return this.animationCallbacks.set(a,s),this.isRunning=!0,s(),()=>{this.isRunning=!1,this.animationCallbacks.delete(a)}}animateTo(e,t,i=1e3,a="easeOutCubic"){this.positionController.animateOffset(e,t,0,i,a)}applyEasing(e,t){switch(t){case"linear":default:return e;case"easeInQuad":return e*e;case"easeOutQuad":return 1-(1-e)*(1-e);case"easeInOutQuad":return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2;case"easeInCubic":return e*e*e;case"easeOutCubic":return 1-Math.pow(1-e,3);case"easeInOutCubic":return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2;case"easeInBack":{const t=1.70158;return(t+1)*e*e*e-t*e*e}case"easeOutBack":{const t=1.70158;return 1+(t+1)*Math.pow(e-1,3)+t*Math.pow(e-1,2)}case"easeInElastic":return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*(2*Math.PI/3));case"easeOutElastic":return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*(2*Math.PI/3))+1}}stopAllAnimations(){this.isRunning=!1,this.animationCallbacks.clear(),this.pathProgress=0,this.timeProgress=0,this.scrollProgress=0}destroy(){this.stopAllAnimations(),this.positionController=null}}class Wh{constructor(e){this.positionController=e,this.breakpoints={mobile:768,tablet:1024,desktop:1200},this.currentBreakpoint=this.getCurrentBreakpoint(),this.responsiveCallbacks=new Map}getCurrentBreakpoint(){const e=window.innerWidth;return e<this.breakpoints.mobile?"mobile":e<this.breakpoints.tablet?"tablet":e<this.breakpoints.desktop?"desktop":"large"}moveToResponsive(e={},t={}){const i="responsive",a=()=>{if(!this.isRunning)return;const i=this.getCurrentBreakpoint(),a=e[i]||e.default||{x:0,y:0},s=a.x-window.innerWidth/2,n=a.y-window.innerHeight/2;!1!==t.animate?this.positionController.animateOffset(s,n,0,t.duration||500,t.easing||"easeOutCubic"):this.positionController.setOffset(s,n,0)};this.responsiveCallbacks.set(i,a),this.isRunning=!0,a();const s=()=>{const e=this.getCurrentBreakpoint();e!==this.currentBreakpoint&&(this.currentBreakpoint=e,a())};return window.addEventListener("resize",s),()=>{this.isRunning=!1,this.responsiveCallbacks.delete(i),window.removeEventListener("resize",s)}}moveToGroup(e=[],t="center",i={x:0,y:0}){if(0===e.length)return;let a=0,s=0,n=0,r=0,o=0;if(e.forEach(e=>{let t,i,l,h;if("string"==typeof e){const a=document.querySelector(e);if(!a)return;{const e=a.getBoundingClientRect();t=e.left,i=e.top,l=e.width,h=e.height}}else{if(void 0===e.x||void 0===e.y)return;t=e.x,i=e.y,l=e.width||0,h=e.height||0}a+=t,s+=i,n=Math.max(n,t+l),r=Math.max(r,i+h),o++}),0===o)return;const l=a/o,h=s/o;let c,u;switch(t){case"center":default:c=l+i.x,u=h+i.y;break;case"left":c=a+i.x,u=h+i.y;break;case"right":c=n+i.x,u=h+i.y;break;case"top":c=l+i.x,u=s+i.y;break;case"bottom":c=l+i.x,u=r+i.y}const d=c-window.innerWidth/2,p=u-window.innerHeight/2;this.positionController.setOffset(d,p,0)}moveToAccessibility(e=[],t="bottom-right",i={}){const a="accessibility",s=()=>{if(!this.isRunning)return;let a,s;switch((window.speechSynthesis||window.webkitSpeechSynthesis)&&i.announce&&e.forEach(e=>{e.condition&&e.condition()&&this.announceToScreenReader(e.text)}),t){case"bottom-right":default:a=window.innerWidth-100,s=window.innerHeight-100;break;case"bottom-left":a=100,s=window.innerHeight-100;break;case"top-right":a=window.innerWidth-100,s=100;break;case"top-left":a=100,s=100;break;case"center":a=window.innerWidth/2,s=window.innerHeight/2}const n=a-window.innerWidth/2,r=s-window.innerHeight/2;this.positionController.setOffset(n,r,0)};return this.responsiveCallbacks.set(a,s),this.isRunning=!0,s(),()=>{this.isRunning=!1,this.responsiveCallbacks.delete(a)}}announceToScreenReader(e){if(window.speechSynthesis){const t=new SpeechSynthesisUtterance(e);t.volume=.5,t.rate=.8,window.speechSynthesis.speak(t)}}setBreakpoints(e){this.breakpoints={...this.breakpoints,...e},this.currentBreakpoint=this.getCurrentBreakpoint()}getCurrentBreakpointName(){return this.currentBreakpoint}isBreakpoint(e){return this.currentBreakpoint===e}stopAllResponsive(){this.isRunning=!1,this.responsiveCallbacks.clear()}destroy(){this.stopAllResponsive(),this.positionController=null}}class Gh{constructor(e){this.positionController=e,this.elementTargeting=new zh(e),this.inputTracking=new jh(e),this.physics=new Vh(e),this.animation=new $h(e),this.responsive=new Wh(e),this.methods=new Map,this.registerMethods()}registerMethods(){this.methods.set("moveToElement",this.elementTargeting.moveToElement.bind(this.elementTargeting)),this.methods.set("moveToButton",this.elementTargeting.moveToButton.bind(this.elementTargeting)),this.methods.set("moveToForm",this.elementTargeting.moveToForm.bind(this.elementTargeting)),this.methods.set("moveToModal",this.elementTargeting.moveToModal.bind(this.elementTargeting)),this.methods.set("moveToNavigation",this.elementTargeting.moveToNavigation.bind(this.elementTargeting)),this.methods.set("moveToContent",this.elementTargeting.moveToContent.bind(this.elementTargeting)),this.methods.set("moveToSidebar",this.elementTargeting.moveToSidebar.bind(this.elementTargeting)),this.methods.set("moveToHeader",this.elementTargeting.moveToHeader.bind(this.elementTargeting)),this.methods.set("moveToFooter",this.elementTargeting.moveToFooter.bind(this.elementTargeting)),this.methods.set("watchElement",this.elementTargeting.watchElement.bind(this.elementTargeting)),this.methods.set("moveToMouse",this.inputTracking.moveToMouse.bind(this.inputTracking)),this.methods.set("moveToTouch",this.inputTracking.moveToTouch.bind(this.inputTracking)),this.methods.set("moveToAudio",this.inputTracking.moveToAudio.bind(this.inputTracking)),this.methods.set("moveToViewport",this.inputTracking.moveToViewport.bind(this.inputTracking)),this.methods.set("moveToGrid",this.physics.moveToGrid.bind(this.physics)),this.methods.set("moveToGravity",this.physics.moveToGravity.bind(this.physics)),this.methods.set("moveToMagnetic",this.physics.moveToMagnetic.bind(this.physics)),this.methods.set("moveToAvoid",this.physics.moveToAvoid.bind(this.physics)),this.methods.set("moveToRandom",this.physics.moveToRandom.bind(this.physics)),this.methods.set("moveToPath",this.animation.moveToPath.bind(this.animation)),this.methods.set("moveToTime",this.animation.moveToTime.bind(this.animation)),this.methods.set("moveToScroll",this.animation.moveToScroll.bind(this.animation)),this.methods.set("animateTo",this.animation.animateTo.bind(this.animation)),this.methods.set("moveToResponsive",this.responsive.moveToResponsive.bind(this.responsive)),this.methods.set("moveToGroup",this.responsive.moveToGroup.bind(this.responsive)),this.methods.set("moveToAccessibility",this.responsive.moveToAccessibility.bind(this.responsive))}call(e,...t){const i=this.methods.get(e);return i?i(...t):null}getAvailableMethods(){return Array.from(this.methods.keys())}hasMethod(e){return this.methods.has(e)}stopAll(){this.elementTargeting.stopWatchingAll(),this.inputTracking.stopAllTracking(),this.physics.stopAllPhysics(),this.animation.stopAllAnimations(),this.responsive.stopAllResponsive()}destroy(){this.stopAll(),this.elementTargeting.destroy(),this.inputTracking.destroy(),this.physics.destroy(),this.animation.destroy(),this.responsive.destroy(),this.methods.clear(),this.positionController=null}}class Lh{constructor(e={}){this.offsetX=e.offsetX||0,this.offsetY=e.offsetY||0,this.offsetZ=e.offsetZ||0,this.isAnimating=!1,this.animationId=null,this.animationStartTime=0,this.animationDuration=0,this.animationEasing="easeOutCubic",this.startOffset={x:0,y:0,z:0},this.targetOffset={x:0,y:0,z:0},this.onUpdate=e.onUpdate||(()=>{}),this.onAnimationComplete=e.onAnimationComplete||(()=>{}),this.minScale=e.minScale||.5,this.maxScale=e.maxScale||2,this.zScaleRange=e.zScaleRange||1e3,this.globalScale=1,this.coreScaleOverride=1,this.particleScaleOverride=1,this.positioning=new Gh(this),this.elementTargeting=new Th(this)}setOffset(e,t,i=0){this.stopAnimation(),this.offsetX=e,this.offsetY=t,this.offsetZ=i,this.onUpdate(this.getEffectiveCenter())}getOffset(){return{x:this.offsetX,y:this.offsetY,z:this.offsetZ}}getPosition(e=window.innerWidth/2,t=window.innerHeight/2){return{x:e+this.offsetX,y:t+this.offsetY,z:this.offsetZ,scale:this.getZScale()}}animateOffset(e,t,i=0,a=1e3,s="easeOutCubic"){this.stopAnimation(),this.startOffset={x:this.offsetX,y:this.offsetY,z:this.offsetZ},this.targetOffset={x:e,y:t,z:i},this.animationDuration=a,this.animationEasing=s,this.animationStartTime=performance.now(),this.isAnimating=!0,this.startAnimation()}stopAnimation(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.isAnimating=!1}startAnimation(){const e=t=>{if(!this.isAnimating)return;const i=t-this.animationStartTime,a=Math.min(i/this.animationDuration,1),s=this.applyEasing(a,this.animationEasing);this.offsetX=this.lerp(this.startOffset.x,this.targetOffset.x,s),this.offsetY=this.lerp(this.startOffset.y,this.targetOffset.y,s),this.offsetZ=this.lerp(this.startOffset.z,this.targetOffset.z,s),this.onUpdate(this.getEffectiveCenter()),a>=1?(this.isAnimating=!1,this.onAnimationComplete()):this.animationId=requestAnimationFrame(e)};this.animationId=requestAnimationFrame(e)}getEffectiveCenter(e=0,t=0){return{x:e+this.offsetX,y:t+this.offsetY,scale:this.getZScale(),coreScale:this.getCoreScale(),particleScale:this.getParticleScale()}}getZScale(){const e=-this.offsetZ/this.zScaleRange,t=Math.max(-1,Math.min(1,e));return this.lerp(this.minScale,this.maxScale,(t+1)/2)*this.globalScale}setGlobalScale(e){this.globalScale=Math.max(.1,e),this.onUpdate(this.getEffectiveCenter())}setScaleOverrides(e){"number"==typeof e?(this.globalScale=Math.max(.1,e),this.coreScaleOverride=1,this.particleScaleOverride=1):(void 0!==e.global&&(this.globalScale=Math.max(.1,e.global)),void 0!==e.core&&(this.coreScaleOverride=Math.max(.1,e.core)),void 0!==e.particles&&(this.particleScaleOverride=Math.max(.1,e.particles))),this.onUpdate(this.getEffectiveCenter())}getCoreScale(){return this.calculateBaseZScale()*this.globalScale*this.coreScaleOverride}getParticleScale(){return this.calculateBaseZScale()*this.globalScale*this.particleScaleOverride}calculateBaseZScale(){const e=-this.offsetZ/this.zScaleRange,t=Math.max(-1,Math.min(1,e));return this.lerp(this.minScale,this.maxScale,(t+1)/2)}lerp(e,t,i){return e+(t-e)*i}applyEasing(e,t){switch(t){case"linear":default:return e;case"easeInQuad":return e*e;case"easeOutQuad":return 1-(1-e)*(1-e);case"easeInOutQuad":return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2;case"easeInCubic":return e*e*e;case"easeOutCubic":return 1-Math.pow(1-e,3);case"easeInOutCubic":return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2;case"easeInBack":{const t=1.70158;return(t+1)*e*e*e-t*e*e}case"easeOutBack":{const t=1.70158;return 1+(t+1)*Math.pow(e-1,3)+t*Math.pow(e-1,2)}}}getPositioning(){return this.positioning}getElementTargeting(){return this.elementTargeting}callPositioning(e,...t){return this.positioning.call(e,...t)}destroy(){this.stopAnimation(),this.positioning&&(this.positioning.destroy(),this.positioning=null),this.elementTargeting&&(this.elementTargeting.destroy(),this.elementTargeting=null),this.onUpdate=null,this.onAnimationComplete=null}}class _h{constructor(){this.A4_FREQUENCY=440,this.NOTES=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this.INTERVALS={unison:0,minorSecond:1,majorSecond:2,minorThird:3,majorThird:4,perfectFourth:5,tritone:6,perfectFifth:7,minorSixth:8,majorSixth:9,minorSeventh:10,majorSeventh:11,octave:12},this.SCALES={major:[0,2,4,5,7,9,11],naturalMinor:[0,2,3,5,7,8,10],harmonicMinor:[0,2,3,5,7,8,11],melodicMinor:[0,2,3,5,7,9,11],ionian:[0,2,4,5,7,9,11],dorian:[0,2,3,5,7,9,10],phrygian:[0,1,3,5,7,8,10],lydian:[0,2,4,6,7,9,11],mixolydian:[0,2,4,5,7,9,10],aeolian:[0,2,3,5,7,8,10],locrian:[0,1,3,5,6,8,10],majorPentatonic:[0,2,4,7,9],minorPentatonic:[0,3,5,7,10],blues:[0,3,5,6,7,10],chromatic:[0,1,2,3,4,5,6,7,8,9,10,11],wholeHalfDiminished:[0,2,3,5,6,8,9,11],arabic:[0,1,4,5,7,8,11],japanese:[0,1,5,7,8],hungarian:[0,2,3,6,7,8,11],bebopMajor:[0,2,4,5,7,8,9,11]},this.CHORDS={major:[0,4,7],minor:[0,3,7],diminished:[0,3,6],augmented:[0,4,8],sus2:[0,2,7],sus4:[0,5,7],maj7:[0,4,7,11],min7:[0,3,7,10],dom7:[0,4,7,10],min7b5:[0,3,6,10],dim7:[0,3,6,9],maj9:[0,4,7,11,14],min9:[0,3,7,10,14],dom9:[0,4,7,10,14],add9:[0,4,7,14],maj11:[0,4,7,11,14,17],min11:[0,3,7,10,14,17],maj13:[0,4,7,11,14,17,21],min13:[0,3,7,10,14,17,21]},this.EMOTION_MODES={excited:{scale:"lydian",tempo:140,dynamics:"forte",articulation:"staccato"},calm:{scale:"major",tempo:60,dynamics:"piano",articulation:"legato"},curious:{scale:"mixolydian",tempo:100,dynamics:"mezzoForte",articulation:"tenuto"},sleepy:{scale:"aeolian",tempo:50,dynamics:"pianissimo",articulation:"legato"},alert:{scale:"dorian",tempo:120,dynamics:"forte",articulation:"marcato"},pleased:{scale:"majorPentatonic",tempo:90,dynamics:"mezzoForte",articulation:"legato"},confused:{scale:"wholeHalfDiminished",tempo:80,dynamics:"mezzoPiano",articulation:"rubato"},energetic:{scale:"bebopMajor",tempo:160,dynamics:"fortissimo",articulation:"staccato"},melancholy:{scale:"harmonicMinor",tempo:70,dynamics:"mezzoPiano",articulation:"legato"},playful:{scale:"blues",tempo:110,dynamics:"mezzoForte",articulation:"swing"}},this.PROGRESSIONS={I_V_vi_IV:[1,5,6,4],I_IV_V:[1,4,5],ii_V_I:[2,5,1],I_vi_IV_V:[1,6,4,5],vi_IV_I_V:[6,4,1,5],I_VI_ii_V:[1,6,2,5],iii_vi_ii_V:[3,6,2,5],I_ii_iii_IV:[1,2,3,4],I_I_I_I_IV_IV_I_I_V_IV_I_V:[1,1,1,1,4,4,1,1,5,4,1,5],i_VII_VI_VII:[1,7,6,7],I_II_IV_I:[1,2,4,1]}}noteToMidi(e){const t=e.slice(0,-1),i=parseInt(e.slice(-1),10),a=this.NOTES.indexOf(t);if(-1===a)throw new Error(`Invalid note: ${e}`);return 12*(i+1)+a}midiToFrequency(e){return this.A4_FREQUENCY*Math.pow(2,(e-69)/12)}noteToFrequency(e){return this.midiToFrequency(this.noteToMidi(e))}generateScale(e,t="major"){const i=this.SCALES[t];if(!i)throw new Error(`Unknown scale type: ${t}`);const a=this.noteToMidi(e);return i.map(e=>this.midiToFrequency(a+e))}generateChord(e,t="major"){const i=this.CHORDS[t];if(!i)throw new Error(`Unknown chord type: ${t}`);const a=this.noteToMidi(e);return i.map(e=>this.midiToFrequency(a+e))}generateProgression(e,t="major",i=this.PROGRESSIONS.I_V_vi_IV){const a=this.generateScale(e,t),s=[];for(const e of i){const i=a[(e-1)%a.length];let n="major";"major"===t?2===e||3===e||6===e?n="minor":7===e&&(n="diminished"):"naturalMinor"===t&&(n=1===e||4===e||5===e?"minor":2===e?"diminished":"major");const r=Math.round(12*Math.log2(i/this.A4_FREQUENCY)+69),o=Math.floor(r/12)-1,l=r%12,h=this.NOTES[l]+o;s.push({degree:e,root:i,frequencies:this.generateChord(h,n),type:n})}return s}getEmotionMusic(e){return this.EMOTION_MODES[e]||this.EMOTION_MODES.calm}circleOfFifths(e="C",t=12,i=!0){const a=e.replace(/\d/,"");let s=this.NOTES.indexOf(a);const n=[e];for(let e=1;e<t;e++)s=i?(s+7)%12:(s+5)%12,n.push(this.NOTES[s]);return n}analyzeInterval(e,t){const i=this.noteToMidi(e),a=this.noteToMidi(t),s=Math.abs(a-i);let n="unknown";for(const[e,t]of Object.entries(this.INTERVALS))if(t===s%12){n=e;break}return{semitones:s,intervalName:n,octaves:Math.floor(s/12),consonant:[0,3,4,5,7,8,9,12].includes(s%12),ratio:this.getIntervalRatio(s%12)}}getIntervalRatio(e){return{0:"1:1",1:"16:15",2:"9:8",3:"6:5",4:"5:4",5:"4:3",6:"45:32",7:"3:2",8:"8:5",9:"5:3",10:"16:9",11:"15:8",12:"2:1"}[e]||"complex"}generateMelody(e={}){const{key:t="C4",scale:i="major",length:a=8,stepProbability:s=.7,restProbability:n=.1}=e,r=this.generateScale(t,i),o=[];let l=0;for(let e=0;e<a;e++){if(Math.random()<n){o.push({frequency:0,duration:.25,isRest:!0});continue}let e;if(Math.random()<s){const t=Math.random()<.5?-1:1;e=Math.max(0,Math.min(r.length-1,l+t))}else{const t=Math.floor(3*Math.random())+2,i=Math.random()<.5?-1:1;e=Math.max(0,Math.min(r.length-1,l+t*i))}l=e;const t=[.25,.5,.75,1],i=t[Math.floor(Math.random()*t.length)];o.push({frequency:r[l],duration:i,isRest:!1})}return o}}class Hh{constructor(e){this.audioContext=e,this.musicTheory=new _h,this.currentKey="C4",this.currentScale="major",this.currentTempo=120,this.currentEmotion="calm",this.voices=new Map,this.layers={bass:{active:!1,gain:.3},chord:{active:!1,gain:.2},melody:{active:!1,gain:.4},pad:{active:!1,gain:.15}},this.masterGain=this.audioContext.createGain(),this.masterGain.gain.value=.5,this.masterGain.connect(this.audioContext.destination),this.reverb=this.createReverb(),this.delay=this.createDelay(),this.filter=this.createFilter(),this.filter.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this.masterGain),this.dryGain=this.audioContext.createGain(),this.dryGain.gain.value=.7,this.dryGain.connect(this.masterGain),this.wetGain=this.audioContext.createGain(),this.wetGain.gain.value=.3,this.wetGain.connect(this.filter),this.nextNoteTime=0,this.noteResolution=0,this.noteLength=.05,this.currentChordIndex=0,this.currentMelodyNote=0,this.progression=null,this.isPlaying=!1,this.lookahead=25,this.scheduleAheadTime=.1}createReverb(){const e=this.audioContext.createConvolver(),t=2*this.audioContext.sampleRate,i=this.audioContext.createBuffer(2,t,this.audioContext.sampleRate);for(let e=0;e<2;e++){const a=i.getChannelData(e);for(let e=0;e<t;e++)a[e]=(2*Math.random()-1)*Math.pow(1-e/t,2)}return e.buffer=i,e}createDelay(){const e=this.audioContext.createDelay(1);e.delayTime.value=.15;const t=this.audioContext.createGain();return t.gain.value=.3,e.connect(t),t.connect(e),e}createFilter(){const e=this.audioContext.createBiquadFilter();return e.type="lowpass",e.frequency.value=2e3,e.Q.value=1,e}setEmotion(e){this.currentEmotion=e;const t=this.musicTheory.getEmotionMusic(e);this.currentScale=t.scale,this.currentTempo=t.tempo;const i={excited:{freq:4e3,Q:2},calm:{freq:1500,Q:.7},curious:{freq:2500,Q:1.5},sleepy:{freq:800,Q:.5},alert:{freq:3e3,Q:1.8},energetic:{freq:5e3,Q:2.5}}[e]||{freq:2e3,Q:1};this.filter.frequency.exponentialRampToValueAtTime(i.freq,this.audioContext.currentTime+.5),this.filter.Q.linearRampToValueAtTime(i.Q,this.audioContext.currentTime+.5),this.generateEmotionProgression()}generateEmotionProgression(){const e={excited:"I_V_vi_IV",calm:"I_vi_IV_V",curious:"ii_V_I",sleepy:"vi_IV_I_V",alert:"I_IV_V",energetic:"I_V_vi_IV"}[this.currentEmotion]||"I_V_vi_IV";this.progression=this.musicTheory.generateProgression(this.currentKey,this.currentScale,this.musicTheory.PROGRESSIONS[e])}playChord(e,t=1,i=.01){const a=this.audioContext.currentTime,s=this.audioContext.createGain();s.gain.setValueAtTime(0,a),s.gain.linearRampToValueAtTime(this.layers.chord.gain,a+i),s.gain.exponentialRampToValueAtTime(.01,a+t),s.connect(this.dryGain),s.connect(this.wetGain);const n=e.map((e,i)=>{const n=this.audioContext.createOscillator();return n.frequency.value=e,n.type=0===i?"sine":1===i?"triangle":"sawtooth",n.detune.value=10*(Math.random()-.5),n.connect(s),n.start(a),n.stop(a+t),n}),r=`chord_${Date.now()}`;this.voices.set(r,{oscillators:n,gain:s}),setTimeout(()=>{this.voices.delete(r)},1e3*(t+.1))}playMelody(e,t=0){let i=t||this.audioContext.currentTime;e.forEach((e,t)=>{if(e.isRest)return void(i+=e.duration);const a=this.audioContext.createOscillator(),s=this.audioContext.createGain();a.frequency.value=e.frequency,a.type="sine";const n=this.audioContext.createOscillator(),r=this.audioContext.createGain();n.frequency.value=5,r.gain.value=5,n.connect(r),r.connect(a.frequency),s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(this.layers.melody.gain,i+.01),s.gain.exponentialRampToValueAtTime(.01,i+.9*e.duration),a.connect(s),s.connect(this.dryGain),s.connect(this.wetGain),a.start(i),a.stop(i+e.duration),n.start(i),n.stop(i+e.duration),i+=e.duration})}createPad(e,t=4){const i=this.audioContext.currentTime,a=this.audioContext.createGain();a.gain.setValueAtTime(0,i),a.gain.linearRampToValueAtTime(this.layers.pad.gain,i+1),a.gain.linearRampToValueAtTime(this.layers.pad.gain,i+t-1),a.gain.linearRampToValueAtTime(0,i+t),a.connect(this.wetGain);for(let s=0;s<4;s++){const n=this.audioContext.createOscillator();n.frequency.value=e,n.type="sawtooth",n.detune.value=15*(s-2);const r=this.audioContext.createGain();r.gain.value=1/4;const o=this.audioContext.createOscillator(),l=this.audioContext.createGain();o.frequency.value=.2+.1*s,l.gain.value=10,o.connect(l),l.connect(n.frequency),n.connect(r),r.connect(a),n.start(i),n.stop(i+t),o.start(i),o.stop(i+t)}}playGestureSound(e){const t={breathe:()=>{const e=this.musicTheory.generateChord(this.currentKey,"maj7");this.playChord(e,2,.5),this.createPad(e[0]/2,3)},excited:()=>{const e=this.musicTheory.generateScale(this.currentKey,"lydian").map((e,t)=>({frequency:e,duration:.1,isRest:!1}));this.playMelody(e)},wave:()=>{const e=this.musicTheory.noteToFrequency(this.currentKey),t=2*e,i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.frequency.setValueAtTime(e,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(t,this.audioContext.currentTime+.5),i.frequency.exponentialRampToValueAtTime(e,this.audioContext.currentTime+1),a.gain.setValueAtTime(0,this.audioContext.currentTime),a.gain.linearRampToValueAtTime(.3,this.audioContext.currentTime+.1),a.gain.linearRampToValueAtTime(.3,this.audioContext.currentTime+.9),a.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+1),i.connect(a),a.connect(this.wetGain),i.start(),i.stop(this.audioContext.currentTime+1)},morph:()=>{const e=this.musicTheory.generateChord(this.currentKey,"minor"),t=this.musicTheory.generateChord(this.currentKey,"major");this.playChord(e,.5),setTimeout(()=>{this.playChord(t,1)},400)},jump:()=>{const e=this.musicTheory.generateChord(this.currentKey,"dom7");for(let t=0;t<3;t++)setTimeout(()=>{this.playChord(e.map(e=>e*Math.pow(2,t/12)),.1,.001)},100*t)},curious:()=>{const e=this.musicTheory.generateMelody({key:this.currentKey,scale:"mixolydian",length:5,stepProbability:.3});this.playMelody(e)}}[e];t&&t()}startHarmony(){this.isPlaying||(this.isPlaying=!0,this.currentChordIndex=0,this.nextNoteTime=this.audioContext.currentTime,this.generateEmotionProgression(),this.scheduleHarmony())}scheduleHarmony(){if(this.isPlaying){for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;){if(this.progression&&this.layers.chord.active){const e=this.progression[this.currentChordIndex];this.playChord(e.frequencies,.5),this.currentChordIndex=(this.currentChordIndex+1)%this.progression.length}if(this.layers.bass.active&&this.progression){const e=this.progression[this.currentChordIndex].frequencies[0]/2;this.playBassNote(e,.25)}const e=60/this.currentTempo;this.nextNoteTime+=.25*e}setTimeout(()=>this.scheduleHarmony(),this.lookahead)}}playBassNote(e,t){const i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.frequency.value=e,i.type="sine",a.gain.setValueAtTime(0,this.audioContext.currentTime),a.gain.linearRampToValueAtTime(this.layers.bass.gain,this.audioContext.currentTime+.01),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+t),i.connect(a),a.connect(this.dryGain),i.start(),i.stop(this.audioContext.currentTime+t)}stopHarmony(){this.isPlaying=!1}setLayerActive(e,t){this.layers[e]&&(this.layers[e].active=t)}setMasterVolume(e){this.masterGain.gain.exponentialRampToValueAtTime(Math.max(.01,e),this.audioContext.currentTime+.1)}setEffectsMix(e){const t=1-e;this.dryGain.gain.linearRampToValueAtTime(t,this.audioContext.currentTime+.1),this.wetGain.gain.linearRampToValueAtTime(e,this.audioContext.currentTime+.1)}}class Uh{static ie(){return Uh.ae||(Uh.ae=new Map([["bounce",{duration:100,waveform:"triangle",volume:.3,frequencyEnvelope:[{time:0,frequency:200},{time:.5,frequency:400},{time:1,frequency:300}],volumeEnvelope:[{time:0,volume:1},{time:.1,volume:.8},{time:1,volume:0}]}],["pulse",{duration:300,waveform:"sine",volume:.25,frequencyEnvelope:[{time:0,frequency:300},{time:.5,frequency:450},{time:1,frequency:300}],volumeEnvelope:[{time:0,volume:0},{time:.3,volume:1},{time:.7,volume:1},{time:1,volume:0}]}],["shake",{duration:200,waveform:"sawtooth",volume:.2,frequencyEnvelope:[{time:0,frequency:150},{time:.25,frequency:200},{time:.5,frequency:150},{time:.75,frequency:200},{time:1,frequency:150}],volumeEnvelope:[{time:0,volume:.8},{time:.5,volume:1},{time:1,volume:0}]}],["spin",{duration:800,waveform:"sine",volume:.18,frequencyEnvelope:[{time:0,frequency:200},{time:.5,frequency:600},{time:1,frequency:200}],volumeEnvelope:[{time:0,volume:.5},{time:.5,volume:1},{time:1,volume:0}]}],["breathe",{duration:1500,waveform:"sine",volume:.12,frequencyEnvelope:[{time:0,frequency:150},{time:.5,frequency:180},{time:1,frequency:150}],volumeEnvelope:[{time:0,volume:0},{time:.3,volume:.7},{time:.7,volume:.7},{time:1,volume:0}]}],["morph",{duration:600,waveform:"triangle",volume:.2,frequencyEnvelope:[{time:0,frequency:250},{time:.3,frequency:400},{time:.7,frequency:300},{time:1,frequency:200}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:1},{time:.8,volume:.8},{time:1,volume:0}]}],["float",{duration:2e3,waveform:"sine",volume:.15,frequencyEnvelope:[{time:0,frequency:300},{time:.5,frequency:350},{time:1,frequency:300}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:.6},{time:.8,volume:.6},{time:1,volume:0}]}],["wobble",{duration:400,waveform:"square",volume:.2,frequencyEnvelope:[{time:0,frequency:180},{time:.25,frequency:220},{time:.5,frequency:180},{time:.75,frequency:220},{time:1,frequency:180}],volumeEnvelope:[{time:0,volume:.7},{time:.5,volume:1},{time:1,volume:0}]}],["wave",{duration:1200,waveform:"sine",volume:.22,frequencyEnvelope:[{time:0,frequency:200},{time:.25,frequency:400},{time:.5,frequency:250},{time:.75,frequency:450},{time:1,frequency:200}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:1},{time:.8,volume:.9},{time:1,volume:0}]}],["pop",{duration:80,waveform:"triangle",volume:.4,frequencyEnvelope:[{time:0,frequency:500},{time:.3,frequency:300},{time:1,frequency:100}],volumeEnvelope:[{time:0,volume:1},{time:.2,volume:.6},{time:1,volume:0}]}],["shimmer",{duration:1e3,waveform:"sine",volume:.16,frequencyEnvelope:[{time:0,frequency:600},{time:.2,frequency:700},{time:.4,frequency:650},{time:.6,frequency:750},{time:.8,frequency:700},{time:1,frequency:600}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:.8},{time:.8,volume:.8},{time:1,volume:0}]}],["glitch",{duration:250,waveform:"square",volume:.25,frequencyEnvelope:[{time:0,frequency:100},{time:.2,frequency:800},{time:.4,frequency:200},{time:.6,frequency:600},{time:.8,frequency:300},{time:1,frequency:100}],volumeEnvelope:[{time:0,volume:.8},{time:.5,volume:1},{time:1,volume:0}]}],["reach",{duration:500,waveform:"triangle",volume:.2,frequencyEnvelope:[{time:0,frequency:250},{time:1,frequency:450}],volumeEnvelope:[{time:0,volume:.7},{time:.5,volume:1},{time:1,volume:0}]}],["shrink",{duration:600,waveform:"sine",volume:.18,frequencyEnvelope:[{time:0,frequency:400},{time:1,frequency:150}],volumeEnvelope:[{time:0,volume:.9},{time:.5,volume:.6},{time:1,volume:0}]}],["grow",{duration:700,waveform:"sine",volume:.22,frequencyEnvelope:[{time:0,frequency:150},{time:1,frequency:500}],volumeEnvelope:[{time:0,volume:.5},{time:.5,volume:.9},{time:1,volume:0}]}],["drift",{duration:1500,waveform:"sine",volume:.14,frequencyEnvelope:[{time:0,frequency:200},{time:.5,frequency:280},{time:1,frequency:220}],volumeEnvelope:[{time:0,volume:0},{time:.3,volume:.7},{time:.7,volume:.6},{time:1,volume:0}]}],["zoom",{duration:400,waveform:"triangle",volume:.28,frequencyEnvelope:[{time:0,frequency:200},{time:1,frequency:800}],volumeEnvelope:[{time:0,volume:.6},{time:.5,volume:1},{time:1,volume:0}]}],["squish",{duration:300,waveform:"sawtooth",volume:.24,frequencyEnvelope:[{time:0,frequency:350},{time:.5,frequency:120},{time:1,frequency:180}],volumeEnvelope:[{time:0,volume:.9},{time:.3,volume:1},{time:1,volume:0}]}],["stretch",{duration:800,waveform:"sine",volume:.19,frequencyEnvelope:[{time:0,frequency:200},{time:.5,frequency:350},{time:1,frequency:300}],volumeEnvelope:[{time:0,volume:.6},{time:.4,volume:1},{time:1,volume:0}]}],["snap",{duration:100,waveform:"square",volume:.35,frequencyEnvelope:[{time:0,frequency:600},{time:.5,frequency:300},{time:1,frequency:150}],volumeEnvelope:[{time:0,volume:1},{time:.3,volume:.5},{time:1,volume:0}]}],["ripple",{duration:1e3,waveform:"sine",volume:.17,frequencyEnvelope:[{time:0,frequency:300},{time:.25,frequency:350},{time:.5,frequency:300},{time:.75,frequency:350},{time:1,frequency:300}],volumeEnvelope:[{time:0,volume:.8},{time:.2,volume:1},{time:.8,volume:.7},{time:1,volume:0}]}],["swirl",{duration:1200,waveform:"triangle",volume:.2,frequencyEnvelope:[{time:0,frequency:250},{time:.33,frequency:400},{time:.66,frequency:300},{time:1,frequency:500}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:.9},{time:.8,volume:.8},{time:1,volume:0}]}],["explode",{duration:600,waveform:"sawtooth",volume:.3,frequencyEnvelope:[{time:0,frequency:100},{time:.2,frequency:800},{time:1,frequency:50}],volumeEnvelope:[{time:0,volume:1},{time:.3,volume:.8},{time:1,volume:0}]}],["implode",{duration:700,waveform:"sine",volume:.25,frequencyEnvelope:[{time:0,frequency:500},{time:.5,frequency:200},{time:1,frequency:100}],volumeEnvelope:[{time:0,volume:.9},{time:.5,volume:1},{time:1,volume:0}]}],["flutter",{duration:800,waveform:"triangle",volume:.18,frequencyEnvelope:[{time:0,frequency:400},{time:.2,frequency:450},{time:.4,frequency:400},{time:.6,frequency:450},{time:.8,frequency:400},{time:1,frequency:450}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:.8},{time:.8,volume:.7},{time:1,volume:0}]}],["twist",{duration:500,waveform:"sawtooth",volume:.21,frequencyEnvelope:[{time:0,frequency:200},{time:.5,frequency:400},{time:1,frequency:200}],volumeEnvelope:[{time:0,volume:.7},{time:.5,volume:1},{time:1,volume:0}]}],["blink",{duration:150,waveform:"sine",volume:.15,frequencyEnvelope:[{time:0,frequency:400},{time:.5,frequency:500},{time:1,frequency:400}],volumeEnvelope:[{time:0,volume:0},{time:.5,volume:1},{time:1,volume:0}]}],["glow",{duration:1500,waveform:"sine",volume:.12,frequencyEnvelope:[{time:0,frequency:300},{time:.5,frequency:400},{time:1,frequency:350}],volumeEnvelope:[{time:0,volume:0},{time:.4,volume:.8},{time:.6,volume:.8},{time:1,volume:0}]}],["sparkle",{duration:600,waveform:"sine",volume:.2,frequencyEnvelope:[{time:0,frequency:800},{time:.3,frequency:1e3},{time:.6,frequency:900},{time:1,frequency:700}],volumeEnvelope:[{time:0,volume:.6},{time:.2,frequency:1},{time:.8,volume:.9},{time:1,volume:0}]}]])),Uh.ae}static getSoundConfig(e){return Uh.ie().get(e)||null}}class Qh{constructor(e){this.se=e,this.ne=new Map,this.re=e.createGain(),this.re.connect(e.destination),this.oe={},this.le=0,this.he=!1,this.ce=0,this.ue=0,this.de=null,this.pe=null}async addLayer(e,t){let i;if(t.src instanceof ArrayBuffer)i=await this.se.decodeAudioData(t.src);else if(t.src instanceof Blob){const e=await t.src.arrayBuffer();i=await this.se.decodeAudioData(e)}else if("string"==typeof t.src){const e=await fetch(t.src),a=await e.arrayBuffer();i=await this.se.decodeAudioData(a)}const a=this.se.createGain(),s=t.gain??0;a.gain.setValueAtTime(s,this.se.currentTime),a.connect(this.re),this.ne.set(e,{buffer:i,gainNode:a,sourceNode:null,loop:t.loop??!0,baseGain:s}),this.oe[e]=s}removeLayer(e){const t=this.ne.get(e);if(t){if(t.sourceNode)try{t.sourceNode.stop()}catch(e){}t.gainNode.disconnect(),this.ne.delete(e),delete this.oe[e]}}play(e=0){this.he&&this.stop();const t=e/1e3;this.ce=t,this.ue=this.se.currentTime,this.he=!0;for(const[,e]of this.ne){const i=this.se.createBufferSource();i.buffer=e.buffer,i.loop=e.loop,i.connect(e.gainNode),i.start(0,t),e.sourceNode=i}}pause(){this.he&&(this.ce+=this.se.currentTime-this.ue,this.ge(),this.he=!1)}stop(){this.ge(),this.he=!1,this.ce=0}ge(){for(const[,e]of this.ne)if(e.sourceNode){try{e.sourceNode.stop()}catch(e){}e.sourceNode=null}}setMix(e){const t=this.se.currentTime;for(const[i,a]of Object.entries(e)){const e=this.ne.get(i);e&&(e.gainNode.gain.setValueAtTime(Math.max(0,Math.min(1,a)),t),this.oe[i]=a)}}crossfadeTo(e,t=1e3){++this.le;const i=this.se.currentTime,a=t/1e3;for(const[t,s]of Object.entries(e)){const e=this.ne.get(t);if(e){const n=Math.max(1e-4,Math.min(1,s));e.gainNode.gain.setValueAtTime(e.gainNode.gain.value||1e-4,i),e.gainNode.gain.linearRampToValueAtTime(n,i+a),this.oe[t]=s}}return new Promise(e=>{setTimeout(()=>{this.le,e()},t)})}setEmotionModulation(e){this.de=e}applyEmotionState(e){if(!this.de||!e?.dominant)return;const t={},i=this.de[e.dominant.emotion];if(i)for(const[a,s]of Object.entries(i))t[a]=(t[a]||0)+s*e.dominant.intensity;for(const i of e.undercurrents||[]){const e=this.de[i.emotion];if(e)for(const[a,s]of Object.entries(e))t[a]=(t[a]||0)+s*i.intensity*.25}const a={...this.oe};for(const[e,i]of Object.entries(t))e in a&&(a[e]=Math.max(0,Math.min(1,a[e]+i)));this.setMix(a)}syncToBPM(e,t){if(t&&(this.pe=t),!this.pe)return;const i=e/this.pe;for(const[,e]of this.ne)e.sourceNode&&(e.sourceNode.playbackRate.value=i)}setMasterVolume(e){this.re.gain.setValueAtTime(Math.max(0,Math.min(1,e)),this.se.currentTime)}getLayerNames(){return[...this.ne.keys()]}getCurrentMix(){return{...this.oe}}isPlaying(){return this.he}destroy(){this.stop();for(const[,e]of this.ne)e.gainNode.disconnect();this.ne.clear(),this.re.disconnect()}}class Yh{constructor(){this.context=null,this.isEnabled=!1,this.isInitialized=!1,this.nodes={master:null,ambient:null,effects:null},this.harmonicSystem=null,this.useHarmonicSystem=!1,this.warningTimestamps={},this.warningThrottle=5e3,this.maxWarningKeys=50,this.warningAccessOrder=[],this.currentOscillator=null,this.currentGain=null,this.masterVolume=.5,this.ambientVolume=.1,this.emotionalTones=new Map([["neutral",{frequency:220,waveform:"sine",volume:.1}],["joy",{frequency:440,waveform:"triangle",volume:.15}],["sadness",{frequency:165,waveform:"sine",volume:.08}],["anger",{frequency:330,waveform:"sawtooth",volume:.12}],["fear",{frequency:880,waveform:"square",volume:.09}],["surprise",{frequency:660,waveform:"triangle",volume:.13}],["disgust",{frequency:110,waveform:"sawtooth",volume:.07}],["love",{frequency:528,waveform:"sine",volume:.11}]]),this.emotionalModifiers=new Map([["neutral",{intensity:1,speed:1}],["joy",{intensity:1.3,speed:1.2}],["sadness",{intensity:.6,speed:.8}],["anger",{intensity:1.5,speed:1.4}],["fear",{intensity:.8,speed:1.3}],["surprise",{intensity:1.4,speed:1.5}],["disgust",{intensity:.7,speed:.9}],["love",{intensity:1.1,speed:.9}]])}initialize(){try{const e=window.AudioContext||window.webkitAudioContext;return!!e&&(this.context=new e,this.harmonicSystem=new Hh(this.context),this.nodes.master=this.context.createGain(),this.nodes.master.gain.setValueAtTime(this.masterVolume,this.context.currentTime),this.nodes.master.connect(this.context.destination),this.nodes.effects=this.context.createGain(),this.nodes.effects.gain.setValueAtTime(1,this.context.currentTime),this.nodes.effects.connect(this.nodes.master),this.isEnabled=!0,this.isInitialized=!0,!0)}catch{return this.isEnabled=!1,!1}}async resumeContext(){if(this.context&&"suspended"===this.context.state)try{await this.context.resume()}catch{}}setMasterVolume(e,t=null){this.masterVolume=Math.max(0,Math.min(1,e)),this.isEnabled&&this.nodes.master&&(this.nodes.master.gain.setValueAtTime(this.masterVolume,this.context.currentTime),t&&this.updateAmbientVolume(t))}getMasterVolume(){return this.masterVolume}isAvailable(){return this.isEnabled&&this.isInitialized}setHarmonicMode(e){this.useHarmonicSystem=e,e&&this.harmonicSystem?this.stopAmbientTone():!e&&this.harmonicSystem&&this.harmonicSystem.stopHarmony()}startHarmony(){this.harmonicSystem&&this.useHarmonicSystem&&this.isAvailable()&&this.harmonicSystem.startHarmony()}stopHarmony(){this.harmonicSystem&&this.harmonicSystem.stopHarmony()}setHarmonicLayer(e,t){this.harmonicSystem&&this.harmonicSystem.setLayerActive(e,t)}setHarmonicEffects(e){this.harmonicSystem&&this.harmonicSystem.setEffectsMix(e)}getAudioLayerManager(){return this.isAvailable()?(this.me||(this.me=new Qh(this.context)),this.me):null}cleanup(){try{this.currentOscillator&&(this.currentOscillator.stop(),this.currentOscillator=null),this.currentGain&&(this.currentGain=null),this.context&&"closed"!==this.context.state&&this.context.close()}catch{}finally{this.me&&(this.me.destroy(),this.me=null),this.context=null,this.nodes={master:null,ambient:null,effects:null},this.currentOscillator=null,this.currentGain=null,this.isEnabled=!1,this.isInitialized=!1}}getEmotionalTone(e){return this.emotionalTones.get(e)||null}setAmbientTone(e,t=500){if(!this.isAvailable())return;if(this.useHarmonicSystem&&this.harmonicSystem)return void this.harmonicSystem.setEmotion(e);const i=this.getEmotionalTone(e);if(i)try{this.resumeContext();const{currentTime:e}=this.context,a=t/1e3;this.currentOscillator&&this.currentGain&&(this.currentGain.gain.exponentialRampToValueAtTime(.001,e+.5*a),this.currentOscillator.stop(e+.5*a));const s=this.context.createOscillator(),n=this.context.createGain();s.type=i.waveform,s.frequency.setValueAtTime(i.frequency,e);const r=i.volume*this.masterVolume;n.gain.setValueAtTime(.001,e),n.gain.exponentialRampToValueAtTime(r,e+a),s.connect(n),n.connect(this.nodes.master),s.start(e),this.currentOscillator=s,this.currentGain=n}catch{}}stopAmbientTone(e=500){if(this.isAvailable()&&this.currentOscillator)try{const{currentTime:t}=this.context,i=e/1e3;this.currentGain&&this.currentGain.gain.exponentialRampToValueAtTime(.001,t+i),this.currentOscillator.stop(t+i),this.currentOscillator=null,this.currentGain=null}catch{}}updateAmbientVolume(e){if(!this.isAvailable()||!this.currentGain||!e)return;const t=this.getEmotionalTone(e);if(t)try{const e=t.volume*this.masterVolume,{currentTime:i}=this.context;this.currentGain.gain.exponentialRampToValueAtTime(e,i+.1)}catch{}}playGestureSound(e,t="neutral"){if(!this.isAvailable())return;if(this.useHarmonicSystem&&this.harmonicSystem)return void this.harmonicSystem.playGestureSound(e);const i=this.getGestureSoundConfig(e);if(i)try{this.resumeContext();const{currentTime:e}=this.context,a=i.duration/1e3,s=this.getEmotionalModifiers(t),n=i.volume*this.masterVolume*s.intensity,r=this.context.createOscillator(),o=this.context.createGain();r.type=i.waveform,this.applyFrequencyEnvelope(r,i.frequencyEnvelope,e,a),this.applyVolumeEnvelope(o,i.volumeEnvelope,e,a,n),r.connect(o),o.connect(this.nodes.effects),r.start(e),r.stop(e+a)}catch{}else this.throttledWarn(`Unknown gesture "${e}", cannot play sound`,`gesture_${e}`)}getGestureSoundConfig(e){return Uh.getSoundConfig(e)}applyFrequencyEnvelope(e,t,i,a){t.forEach(t=>{const s=i+t.time*a;e.frequency.linearRampToValueAtTime(t.frequency,s)})}applyVolumeEnvelope(e,t,i,a,s){t.forEach((t,n)=>{const r=i+t.time*a,o=t.volume*s;0===n?e.gain.setValueAtTime(o,r):e.gain.linearRampToValueAtTime(o,r)})}getEmotionalModifiers(e){return this.emotionalModifiers.get(e)||this.emotionalModifiers.get("neutral")}setQualityReduction(e){this.qualityReduction=e,e&&this.audioContext?this.maxOscillators=2:this.maxOscillators=4}static isSupported(){return!(!window.AudioContext&&!window.webkitAudioContext)}throttledWarn(e,t){const i=Date.now();if(i-(this.warningTimestamps[t]||0)>this.warningThrottle){if(Object.keys(this.warningTimestamps).length>=this.maxWarningKeys){const e=this.warningAccessOrder.shift();delete this.warningTimestamps[e]}this.warningTimestamps[t]=i;const e=this.warningAccessOrder.indexOf(t);-1!==e&&this.warningAccessOrder.splice(e,1),this.warningAccessOrder.push(t)}}}class Xh{constructor(){this.timestamps=[],this.fps=0,this.smoothedFPS=0,this.smoothingFactor=.9,this.lastFrameTime=0,this.frameTime=0,this.frameTimes=[],this.maxFrameTimeSamples=10,this.averageFrameTime=0}update(e){for(;this.timestamps.length>0&&this.timestamps[0]<=e-1e3;)this.timestamps.shift();if(this.timestamps.push(e),this.fps=this.timestamps.length,0===this.smoothedFPS?this.smoothedFPS=this.fps:this.smoothedFPS=this.smoothedFPS*this.smoothingFactor+this.fps*(1-this.smoothingFactor),this.lastFrameTime>0&&(this.frameTime=e-this.lastFrameTime,this.frameTimes.push(this.frameTime),this.frameTimes.length>this.maxFrameTimeSamples&&this.frameTimes.shift(),this.frameTimes.length>0)){const e=this.frameTimes.reduce((e,t)=>e+t,0);this.averageFrameTime=e/this.frameTimes.length}this.lastFrameTime=e}getFPS(){return Math.round(this.fps)}getSmoothedFPS(){return Math.round(this.smoothedFPS)}getFrameTime(){return this.frameTime}getAverageFrameTime(){return this.averageFrameTime}reset(){this.timestamps=[],this.fps=0,this.smoothedFPS=0,this.lastFrameTime=0,this.frameTime=0,this.frameTimes=[],this.averageFrameTime=0}getMetrics(){return{fps:this.getFPS(),smoothedFPS:this.getSmoothedFPS(),frameTime:this.getFrameTime(),averageFrameTime:this.getAverageFrameTime(),status:this.fps>=55?"good":this.fps>=30?"okay":"poor"}}}class Nh{constructor(e,t={}){this.errorBoundary=e,this.config=t,this.config.targetFPS=t.targetFPS||60,this.loopManager=t.loopManager||_l,this.isRunning=!1,this.animationFrameId=null,this.loopCallbackId=null,this.lastFrameTime=0,this.deltaTime=0,this.isPaused=!1,this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleWindowBlur=this.handleWindowBlur.bind(this),this.handleWindowFocus=this.handleWindowFocus.bind(this),"undefined"!=typeof document&&(document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("blur",this.handleWindowBlur),window.addEventListener("focus",this.handleWindowFocus)),this.performanceMonitor=null,this.fpsCounter=new Xh,this.subsystems={},this.eventCallback=null,this.parentMascot=null}setSubsystems(e){this.subsystems={stateMachine:e.stateMachine,particleSystem:e.particleSystem,renderer:e.renderer,soundSystem:e.soundSystem,canvasManager:e.canvasManager};const t=["stateMachine","particleSystem","renderer"];for(const e of t)if(!this.subsystems[e])throw new Error(`Required subsystem '${e}' not provided`);this.performanceMonitor&&this.performanceMonitor.setSubsystems(this.subsystems)}setEventCallback(e){if("function"!=typeof e)throw new Error("Event callback must be a function");this.eventCallback=e}setParentMascot(e){this.parentMascot=e}emit(e,t=null){this.eventCallback&&this.eventCallback(e,t)}start(){return this.errorBoundary.wrap(()=>{if(this.isRunning)return!1;if(!this.subsystems.stateMachine)throw new Error("Cannot start animation without subsystems configured");return this.isRunning=!0,this.lastFrameTime=performance.now(),this.subsystems.soundSystem&&this.subsystems.soundSystem.isAvailable()&&this.subsystems.soundSystem.resumeContext(),this.loopCallbackId=this.loopManager.register((e,t)=>this.animate(e,t),0,this),this.emit("animationStarted",{targetFPS:this.targetFPS}),!0},"animation-start")()}stop(){return this.errorBoundary.wrap(()=>!!this.isRunning&&(this.isRunning=!1,this.loopCallbackId&&(this.loopManager.unregister(this.loopCallbackId),this.loopCallbackId=null),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.subsystems.renderer&&this.subsystems.renderer.stopAllGestures&&this.subsystems.renderer.stopAllGestures(),this.subsystems.soundSystem&&this.subsystems.soundSystem.isAvailable()&&this.subsystems.soundSystem.stopAmbientTone(),this.subsystems.particleSystem&&this.subsystems.particleSystem.clear(),this.emit("animationStopped"),!0),"animation-stop")()}handleWindowBlur(){document.hidden||this.handleVisibilityChange()}handleWindowFocus(){!document.hidden&&this.isPaused&&this.handleVisibilityChange()}handleVisibilityChange(){if(document.hidden)this.wasRunning=this.isRunning,this.isPaused=!0,this.pauseTime=performance.now(),this.subsystems?.particleSystem&&(this.subsystems.particleSystem.resetAccumulator(),this.pausedParticleCount=this.subsystems.particleSystem.particles?.length||0),this.subsystems?.renderer?.gestureAnimator&&this.subsystems.renderer.gestureAnimator.pauseCurrentAnimation?.(),this.parentMascot?.pause&&this.parentMascot.pause();else if(this.isPaused&&this.wasRunning){const e=performance.now(),t=e-this.pauseTime;this.lastFrameTime=e,this.frameTimeAccumulator=0,this.fpsCounter&&this.fpsCounter.reset(),this.subsystems?.particleSystem&&this.subsystems.particleSystem.onVisibilityResume(t,this.pausedParticleCount),this.renderer&&(t>hl&&this.renderer.resetCanvasContext(),this.renderer.gestureAnimator&&this.renderer.gestureAnimator.resumeAnimation?.(),t>hl&&(this.renderer.forceCleanRender=!0)),this.subsystems?.stateMachine&&(this.subsystems.stateMachine.lastUpdateTime=e),this.parentMascot?.resume&&this.parentMascot.resume(),this.isPaused=!1}}animate(e,t){if(!this.isRunning||this.isPaused)return;const i=t||performance.now();this.deltaTime=e||i-this.lastFrameTime,this.deltaTime>20&&(this.deltaTime=20),this.deltaTime>ll&&this.deltaTime<20&&(this.deltaTime=ll),this.lastFrameTime=i,this.update(this.deltaTime),this.render()}update(e){if(this.subsystems.stateMachine&&this.subsystems.stateMachine.update(e),this.parentMascot&&"function"==typeof this.parentMascot.update&&this.parentMascot.update(e),"classic"!==this.parentMascot?.config?.renderingStyle&&this.subsystems.particleSystem&&this.subsystems.stateMachine&&this.subsystems.canvasManager){const t=this.subsystems.stateMachine.getCurrentEmotionalProperties();let i;i=this.subsystems.renderer&&"function"==typeof this.subsystems.renderer.getEffectiveCenter?this.subsystems.renderer.getEffectiveCenter():this.subsystems.canvasManager.getCenter();let a=null,s=0;if(this.subsystems.renderer&&this.subsystems.renderer.getCurrentGesture){const e=this.subsystems.renderer.getCurrentGesture();e&&e.particleMotion&&(a=e.particleMotion,s=e.progress||0)}this.subsystems.particleSystem.spawn(t.particleBehavior,this.subsystems.stateMachine.getCurrentState().emotion,t.particleRate,i.x,i.y,e),this.subsystems.particleSystem.update(e,i.x,i.y,a,s)}this.performanceMonitor&&this.performanceMonitor.updateMetrics({particleCount:this.subsystems.particleSystem?.getActiveParticleCount?.()||0,audioLatency:this.subsystems.soundSystem?.getLatency?.()||0})}render(){this.parentMascot&&"function"==typeof this.parentMascot.render?this.parentMascot.render():this.subsystems.renderer&&this.subsystems.renderer.render()}getPerformanceMetrics(){const e=this.fpsCounter?this.fpsCounter.getMetrics():{};return{fps:e.fps||60,instantFps:e.smoothedFPS||60,frameTime:e.frameTime||16.67,averageFrameTime:e.averageFrameTime||16.67,isRunning:this.isRunning,deltaTime:this.deltaTime}}setTargetFPS(e){}get targetFPS(){return this.config.targetFPS||60}isAnimating(){return this.isRunning}destroy(){this.stop(),"undefined"!=typeof document&&(document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("blur",this.handleWindowBlur),window.removeEventListener("focus",this.handleWindowFocus)),this.performanceMonitor&&(this.performanceMonitor.destroy(),this.performanceMonitor=null),this.subsystems={},this.eventCallback=null}}class Jh{constructor(e={}){this.config={spikeThreshold:e.spikeThreshold||1.5,minimumSpikeLevel:e.minimumSpikeLevel||.1,spikeMinInterval:e.spikeMinInterval||1e3,historySize:e.historySize||10,smoothingTimeConstant:e.smoothingTimeConstant||.8,fftSize:e.fftSize||256,levelUpdateThrottle:e.levelUpdateThrottle||100,...e},this.audioContext=null,this.analyser=null,this.dataArray=null,this.currentLevel=0,this.levelHistory=[],this.isActive=!1,this.lastVolumeSpike=0,this.lastLevelEmit=0,this.callbacks={levelUpdate:null,volumeSpike:null,error:null}}initialize(e){try{if(!e)throw new Error("AudioContext is required for audio level processing");if("function"!=typeof e.createAnalyser)throw new Error("Invalid AudioContext provided");return this.audioContext=e,this.analyser=e.createAnalyser(),this.analyser.fftSize=this.config.fftSize,this.analyser.smoothingTimeConstant=this.config.smoothingTimeConstant,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.currentLevel=0,this.levelHistory=[],this.lastVolumeSpike=0,this.isActive=!0,"suspended"===e.state&&e.resume().catch(e=>{this.emitError("Failed to resume AudioContext",e)}),!0}catch(e){return this.emitError("Failed to initialize AudioLevelProcessor",e),!1}}cleanup(){try{this.isActive=!1,this.currentLevel=0,this.levelHistory=[],this.lastVolumeSpike=0,this.lastLevelEmit=0,this.audioContext=null,this.analyser=null,this.dataArray=null}catch(e){this.emitError("Error during AudioLevelProcessor cleanup",e)}}updateAudioLevel(e=16){if(this.isActive&&this.analyser&&this.dataArray)try{this.analyser.getByteFrequencyData(this.dataArray);const e=this.calculateRMS();this.currentLevel=Math.min(1,2*e),this.updateLevelHistory(),this.detectVolumeSpikes(),this.emitLevelUpdate()}catch(e){this.emitError("Error updating audio level",e),this.currentLevel=0}}calculateRMS(){if(!this.dataArray||0===this.dataArray.length)return 0;let e=0;for(let t=0;t<this.dataArray.length;t++){const i=this.dataArray[t]/255;e+=i*i}return Math.sqrt(e/this.dataArray.length)}updateLevelHistory(){this.levelHistory.push(this.currentLevel),this.levelHistory.length>this.config.historySize&&this.levelHistory.shift()}detectVolumeSpikes(){if(this.levelHistory.length<5)return;const e=performance.now();if(e-this.lastVolumeSpike<this.config.spikeMinInterval)return;const t=this.levelHistory.slice(0,-1),i=t.reduce((e,t)=>e+t,0)/t.length;this.currentLevel>=i*this.config.spikeThreshold&&i>=this.config.minimumSpikeLevel&&this.currentLevel>=2*this.config.minimumSpikeLevel&&(this.lastVolumeSpike=e,this.emitVolumeSpike({level:this.currentLevel,previousAverage:i,spikeRatio:this.currentLevel/i,timestamp:e,threshold:this.config.spikeThreshold,minimumLevel:this.config.minimumSpikeLevel}))}clearHistory(){this.levelHistory=[]}getCurrentLevel(){return this.currentLevel}getLevelHistory(){return[...this.levelHistory]}getAnalyser(){return this.analyser}getFrequencyData(){return this.dataArray?new Uint8Array(this.dataArray):null}isProcessingActive(){return this.isActive}onLevelUpdate(e){if("function"!=typeof e)throw new Error("Level update callback must be a function");this.callbacks.levelUpdate=e}onVolumeSpike(e){if("function"!=typeof e)throw new Error("Volume spike callback must be a function");this.callbacks.volumeSpike=e}onError(e){if("function"!=typeof e)throw new Error("Error callback must be a function");this.callbacks.error=e}removeAllCallbacks(){this.callbacks={levelUpdate:null,volumeSpike:null,error:null}}updateConfig(e){this.config={...this.config,...e},this.analyser&&(e.fftSize&&(this.analyser.fftSize=this.config.fftSize,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount)),void 0!==e.smoothingTimeConstant&&(this.analyser.smoothingTimeConstant=this.config.smoothingTimeConstant))}getConfig(){return{...this.config}}getStats(){return{isActive:this.isActive,currentLevel:this.currentLevel,historySize:this.levelHistory.length,maxHistorySize:this.config.historySize,lastSpikeTime:this.lastVolumeSpike,timeSinceLastSpike:this.lastVolumeSpike>0?performance.now()-this.lastVolumeSpike:0,averageLevel:this.levelHistory.length>0?this.levelHistory.reduce((e,t)=>e+t,0)/this.levelHistory.length:0}}emitLevelUpdate(){const e=performance.now();if(!(e-this.lastLevelEmit<this.config.levelUpdateThrottle)&&(this.lastLevelEmit=e,this.callbacks.levelUpdate))try{this.callbacks.levelUpdate({level:this.currentLevel,rawData:this.getFrequencyData(),timestamp:e,history:this.getLevelHistory()})}catch{}}emitVolumeSpike(e){if(this.callbacks.volumeSpike)try{this.callbacks.volumeSpike(e)}catch{}}emitError(e,t){if(this.callbacks.error)try{this.callbacks.error({message:e,error:t,timestamp:performance.now()})}catch{}}static isSupported(){return!(!window.AudioContext&&!window.webkitAudioContext)}}class Zh{constructor(e={}){this.config={enableReducedMotion:!1!==e.enableReducedMotion,enableHighContrast:!1!==e.enableHighContrast,enableScreenReaderSupport:!1!==e.enableScreenReaderSupport,enableKeyboardNavigation:!1!==e.enableKeyboardNavigation,enableFocusIndicators:!1!==e.enableFocusIndicators,announceStateChanges:!1!==e.announceStateChanges,colorBlindMode:e.colorBlindMode||"none",...e},this.reducedMotionPreferred=!1,this.highContrastEnabled=!1,this.screenReaderActive=!1,this.keyboardNavigationActive=!1,this.currentColorBlindMode=this.config.colorBlindMode,this.focusableElements=new Map,this.currentFocusIndex=-1,this.focusHistory=[],this.liveRegion=null,this.announcementQueue=[],this.boundHandleKeyDown=null,this.boundHandleKeyUp=null,this.colorSchemes={normal:null,highContrast:{primary:"#FFFFFF",secondary:"#000000",accent:"#FFFF00",background:"#000000",particles:"#FFFFFF"},protanopia:{primary:"#0066CC",secondary:"#FFCC00",accent:"#00CCFF",background:"#1A1A1A",particles:"#66CCFF"},deuteranopia:{primary:"#0099FF",secondary:"#FF9900",accent:"#FF00FF",background:"#1A1A1A",particles:"#9966FF"},tritanopia:{primary:"#FF0066",secondary:"#00FF66",accent:"#FF6600",background:"#1A1A1A",particles:"#FFCC00"}},this.patterns={dots:"dots",stripes:"stripes",crosshatch:"crosshatch",solid:"solid"},this.statePatterns={idle:this.patterns.solid,happy:this.patterns.dots,excited:this.patterns.stripes,calm:this.patterns.solid,curious:this.patterns.crosshatch,frustrated:this.patterns.stripes,sad:this.patterns.dots,neutral:this.patterns.solid},this.initialize()}initialize(){this.detectUserPreferences(),this.setupLiveRegion(),this.config.enableKeyboardNavigation&&this.setupKeyboardNavigation(),this.setupPreferenceListeners()}detectUserPreferences(){if(this.config.enableReducedMotion&&window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.reducedMotionPreferred=e.matches}if(this.config.enableHighContrast&&window.matchMedia){const e=window.matchMedia("(prefers-contrast: high)");if(this.highContrastEnabled=e.matches,!this.highContrastEnabled){const e=window.matchMedia("(-ms-high-contrast: active)");this.highContrastEnabled=e.matches}}this.detectScreenReader()}detectScreenReader(){const e=document.querySelector("[aria-live]"),t=document.querySelector("[aria-atomic]"),i=document.querySelector('[role="application"]'),a=navigator.userAgent.toLowerCase(),s=a.includes("nvda")||a.includes("jaws")||a.includes("voiceover");this.screenReaderActive=!!(e||t||i||s)}setupLiveRegion(){this.config.enableScreenReaderSupport&&(this.liveRegion=document.getElementById("mascot-announcements"),this.liveRegion||(this.liveRegion=document.createElement("div"),this.liveRegion.id="mascot-announcements",this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.style.position="absolute",this.liveRegion.style.left="-10000px",this.liveRegion.style.width="1px",this.liveRegion.style.height="1px",this.liveRegion.style.overflow="hidden",document.body.appendChild(this.liveRegion)))}setupKeyboardNavigation(){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.boundHandleKeyUp=this.handleKeyUp.bind(this),document.addEventListener("keydown",this.boundHandleKeyDown),document.addEventListener("keyup",this.boundHandleKeyUp)}setupPreferenceListeners(){window.matchMedia&&(window.matchMedia("(prefers-reduced-motion: reduce)").addListener(e=>{this.reducedMotionPreferred=e.matches,this.onPreferenceChange("reducedMotion",e.matches)}),window.matchMedia("(prefers-contrast: high)").addListener(e=>{this.highContrastEnabled=e.matches,this.onPreferenceChange("highContrast",e.matches)}))}handleKeyDown(e){if(this.config.enableKeyboardNavigation){switch(e.key){case"Tab":e.preventDefault(),this.navigateFocus(e.shiftKey?-1:1);break;case"Enter":case" ":this.activateCurrentFocus();break;case"Escape":this.clearFocus();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.handleArrowNavigation(e.key)}this.keyboardNavigationActive=!0}}handleKeyUp(e){}navigateFocus(e){const t=Array.from(this.focusableElements.values());if(0===t.length)return;this.currentFocusIndex+=e,this.currentFocusIndex<0?this.currentFocusIndex=t.length-1:this.currentFocusIndex>=t.length&&(this.currentFocusIndex=0);const i=t[this.currentFocusIndex];this.setFocus(i),i.label&&this.announce(`Focused on ${i.label}`)}handleArrowNavigation(e){const t={ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1}}[e];t&&this.onArrowNavigation&&this.onArrowNavigation(t)}registerFocusableElement(e,t){this.focusableElements.set(e,{id:e,label:t.label||e,bounds:t.bounds||null,action:t.action||null,type:t.type||"button"})}unregisterFocusableElement(e){this.focusableElements.delete(e)}setFocus(e){this.onFocusChange&&this.onFocusChange(e),this.focusHistory.push(e.id),this.focusHistory.length>10&&this.focusHistory.shift()}clearFocus(){this.currentFocusIndex=-1,this.onFocusChange&&this.onFocusChange(null),this.announce("Focus cleared")}activateCurrentFocus(){const e=Array.from(this.focusableElements.values());if(this.currentFocusIndex>=0&&this.currentFocusIndex<e.length){const t=e[this.currentFocusIndex];t.action&&(t.action(),this.announce(`Activated ${t.label}`))}}announce(e,t="polite"){this.config.enableScreenReaderSupport&&this.liveRegion&&(this.announcementQueue.push({message:e,priority:t}),this.processAnnouncementQueue())}processAnnouncementQueue(){if(0===this.announcementQueue.length)return;const{message:e,priority:t}=this.announcementQueue.shift();this.liveRegion.setAttribute("aria-live",t),this.liveRegion.textContent=e,setTimeout(()=>{this.liveRegion&&(this.liveRegion.textContent=""),this.announcementQueue.length>0&&this.processAnnouncementQueue()},100)}getAnimationSettings(e={}){return this.reducedMotionPreferred?{...e,duration:e.duration?.5*e.duration:0,iterations:1,easing:"linear",particlesEnabled:!1,complexAnimations:!1,autoPlay:!1}:e}getColorScheme(e={}){return this.colorSchemes.normal||(this.colorSchemes.normal={...e}),this.highContrastEnabled?this.colorSchemes.highContrast:"none"!==this.currentColorBlindMode&&this.colorSchemes[this.currentColorBlindMode]?this.colorSchemes[this.currentColorBlindMode]:e}getStatePattern(e){return"none"===this.currentColorBlindMode?this.patterns.solid:this.statePatterns[e]||this.patterns.solid}applyPatternOverlay(e,t,i){if(t===this.patterns.solid)return;e.save();const a=document.createElement("canvas"),s=a.getContext("2d");switch(t){case this.patterns.dots:this.createDotPattern(s,a);break;case this.patterns.stripes:this.createStripePattern(s,a);break;case this.patterns.crosshatch:this.createCrosshatchPattern(s,a)}const n=e.createPattern(a,"repeat");e.fillStyle=n,e.globalAlpha=.3,e.fillRect(i.x,i.y,i.width,i.height),e.restore()}createDotPattern(e,t){t.width=10,t.height=10,e.fillStyle="white",e.beginPath(),e.arc(5,5,2,0,2*Math.PI),e.fill()}createStripePattern(e,t){t.width=10,t.height=10,e.strokeStyle="white",e.lineWidth=2,e.beginPath(),e.moveTo(0,10),e.lineTo(10,0),e.stroke()}createCrosshatchPattern(e,t){t.width=10,t.height=10,e.strokeStyle="white",e.lineWidth=1,e.beginPath(),e.moveTo(0,10),e.lineTo(10,0),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(10,10),e.stroke()}setColorBlindMode(e){["none","protanopia","deuteranopia","tritanopia"].includes(e)&&(this.currentColorBlindMode=e,this.announce(`Color blind mode set to ${e}`),this.onColorSchemeChange&&this.onColorSchemeChange(this.getColorScheme()))}getStatus(){return{reducedMotion:this.reducedMotionPreferred,highContrast:this.highContrastEnabled,screenReader:this.screenReaderActive,keyboardNavigation:this.keyboardNavigationActive,colorBlindMode:this.currentColorBlindMode,focusedElement:this.currentFocusIndex>=0?Array.from(this.focusableElements.values())[this.currentFocusIndex]:null,registeredElements:this.focusableElements.size}}onPreferenceChange(e,t){this.announce(`${e} is now ${t?"enabled":"disabled"}`),"reducedMotion"===e&&this.onReducedMotionChange&&this.onReducedMotionChange(t),"highContrast"===e&&this.onHighContrastChange&&this.onHighContrastChange(t)}createStateDescription(e){return{idle:"Mascot is idle and gently breathing",happy:"Mascot is happy and bouncing",excited:"Mascot is excited with particles flying",calm:"Mascot is calm and peaceful",curious:"Mascot is curious and looking around",frustrated:"Mascot is frustrated and shaking",sad:"Mascot is sad and drooping",neutral:"Mascot is in a neutral state"}[e.emotional]||"Mascot is active"}destroy(){this.boundHandleKeyDown&&(document.removeEventListener("keydown",this.boundHandleKeyDown),this.boundHandleKeyDown=null),this.boundHandleKeyUp&&(document.removeEventListener("keyup",this.boundHandleKeyUp),this.boundHandleKeyUp=null),this.liveRegion&&this.liveRegion.parentNode&&this.liveRegion.parentNode.removeChild(this.liveRegion),this.focusableElements.clear(),this.announcementQueue=[],this.focusHistory=[]}}class Kh{constructor(e={}){this.config={enableTouchOptimization:!1!==e.enableTouchOptimization,enableViewportHandling:!1!==e.enableViewportHandling,enableBatteryOptimization:!1!==e.enableBatteryOptimization,enableOrientationSupport:!1!==e.enableOrientationSupport,enableResponsiveScaling:!1!==e.enableResponsiveScaling,touchSensitivity:e.touchSensitivity||1,doubleTapDelay:e.doubleTapDelay||300,swipeThreshold:e.swipeThreshold||50,pinchThreshold:e.pinchThreshold||.1,...e},this.isMobile=this.detectMobile(),this.isTablet=this.detectTablet(),this.isTouchDevice=this.detectTouch(),this.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent),this.isAndroid=/Android/.test(navigator.userAgent),this.touches=new Map,this.lastTouchTime=0,this.lastTapTime=0,this.tapCount=0,this.touchStartPosition=null,this.isPinching=!1,this.isRotating=!1,this.lastPinchDistance=0,this.lastRotation=0,this.currentGesture=null,this.gestureStartTime=0,this.gestureHistory=[],this.viewportSize={width:window.innerWidth,height:window.innerHeight},this.orientation=this.getOrientation(),this.pixelRatio=window.devicePixelRatio||1,this.lastViewportChange=0,this.batteryLevel=1,this.isCharging=!0,this.lowPowerMode=!1,this.batteryRef=null,this.mobilePerformanceSettings={reducedParticles:this.isMobile,simplifiedAnimations:this.isMobile,lowerFrameRate:this.isMobile,reducedEffects:this.isMobile||this.isTablet,targetFPS:this.isMobile?30:60,maxParticles:this.isMobile?20:50},this.canvasScale=1,this.useOffscreenCanvas=this.supportsOffscreenCanvas(),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleTouchCancel=this.handleTouchCancel.bind(this),this.handleOrientationChange=this.handleOrientationChange.bind(this),this.handleViewportChange=this.handleViewportChange.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleContextMenu=e=>e.preventDefault(),this.initialize()}initialize(){this.config.enableTouchOptimization&&this.isTouchDevice&&this.setupTouchHandlers(),this.config.enableViewportHandling&&this.setupViewportHandlers(),this.config.enableBatteryOptimization&&this.setupBatteryMonitoring(),this.config.enableOrientationSupport&&this.setupOrientationHandlers(),this.applyMobileOptimizations()}detectMobile(){const e=navigator.userAgent.toLowerCase(),t=["android","iphone","ipod","windows phone","blackberry"].some(t=>e.includes(t)),i=window.innerWidth<=768,a="ontouchstart"in window||navigator.maxTouchPoints>0;return t||i&&a}detectTablet(){const e=navigator.userAgent.toLowerCase(),t=/ipad/.test(e),i=/android/.test(e)&&!/mobile/.test(e),a=/windows/.test(e)&&/touch/.test(e),s=window.innerWidth>768&&window.innerWidth<=1024,n="ontouchstart"in window||navigator.maxTouchPoints>0;return t||i||a||s&&n}detectTouch(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}supportsOffscreenCanvas(){return"undefined"!=typeof OffscreenCanvas}setupTouchHandlers(){const e=this.getCanvas();e&&(e.style.touchAction="none",e.style.userSelect="none",e.style.webkitUserSelect="none",e.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),e.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),e.addEventListener("touchend",this.handleTouchEnd,{passive:!1}),e.addEventListener("touchcancel",this.handleTouchCancel,{passive:!1}),e.addEventListener("contextmenu",this.handleContextMenu))}setupViewportHandlers(){window.addEventListener("resize",this.handleViewportChange),window.addEventListener("orientationchange",this.handleOrientationChange),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.setupViewportMeta()}setupViewportMeta(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}async setupBatteryMonitoring(){if(navigator.getBattery)try{const e=await navigator.getBattery();this.batteryRef=e,this.batteryLevel=e.level,this.isCharging=e.charging,this.boundBatteryLevelChange=()=>{this.batteryLevel=e.level,this.onBatteryChange()},this.boundBatteryChargingChange=()=>{this.isCharging=e.charging,this.onBatteryChange()},e.addEventListener("levelchange",this.boundBatteryLevelChange),e.addEventListener("chargingchange",this.boundBatteryChargingChange),this.onBatteryChange()}catch{}}setupOrientationHandlers(){window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",e=>{this.handleDeviceOrientation(e)})}handleTouchStart(e){e.cancelable&&e.preventDefault();const t=Date.now();this.gestureStartTime=t;for(const i of e.touches)this.touches.set(i.identifier,{id:i.identifier,startX:i.clientX,startY:i.clientY,currentX:i.clientX,currentY:i.clientY,startTime:t});1===e.touches.length?this.handleSingleTouchStart(e.touches[0]):2===e.touches.length&&this.handleMultiTouchStart(e.touches),this.emitTouchEvent("touchStart",{touches:Array.from(this.touches.values()),timestamp:t})}handleSingleTouchStart(e){const t=Date.now();t-this.lastTapTime<this.config.doubleTapDelay?this.tapCount++:this.tapCount=1,this.lastTapTime=t,this.touchStartPosition={x:e.clientX,y:e.clientY}}handleMultiTouchStart(e){if(2===e.length){const t=e[0],i=e[1];this.lastPinchDistance=this.getDistance(t.clientX,t.clientY,i.clientX,i.clientY),this.lastRotation=this.getAngle(t.clientX,t.clientY,i.clientX,i.clientY),this.isPinching=!0}}handleTouchMove(e){e.cancelable&&e.preventDefault();for(const t of e.touches){const e=this.touches.get(t.identifier);e&&(e.currentX=t.clientX,e.currentY=t.clientY)}1===e.touches.length?this.handleSingleTouchMove(e.touches[0]):2===e.touches.length&&this.handleMultiTouchMove(e.touches),this.emitTouchEvent("touchMove",{touches:Array.from(this.touches.values()),gesture:this.currentGesture})}handleSingleTouchMove(e){const t=this.touches.get(e.identifier);if(!t)return;const i=e.clientX-t.startX,a=e.clientY-t.startY;Math.sqrt(i*i+a*a)>this.config.swipeThreshold?Math.abs(i)>Math.abs(a)?this.currentGesture=i>0?"swipeRight":"swipeLeft":this.currentGesture=a>0?"swipeDown":"swipeUp":this.currentGesture="pan"}handleMultiTouchMove(e){if(2!==e.length)return;const t=e[0],i=e[1],a=this.getDistance(t.clientX,t.clientY,i.clientX,i.clientY),s=a-this.lastPinchDistance,n=a/this.lastPinchDistance;Math.abs(s)>this.config.pinchThreshold&&(this.currentGesture=n>1?"pinchOut":"pinchIn",this.emitTouchEvent("pinch",{scale:n,delta:s}));const r=this.getAngle(t.clientX,t.clientY,i.clientX,i.clientY),o=r-this.lastRotation;Math.abs(o)>5&&(this.currentGesture="rotate",this.emitTouchEvent("rotate",{angle:r,delta:o})),this.lastPinchDistance=a,this.lastRotation=r}handleTouchEnd(e){e.cancelable&&e.preventDefault();const t=Date.now();for(const i of e.changedTouches){const e=this.touches.get(i.identifier);if(e){const a=t-e.startTime,s=e.currentX-e.startX,n=e.currentY-e.startY,r=Math.sqrt(s*s+n*n);a<300&&r<10&&(2===this.tapCount?(this.emitTouchEvent("doubleTap",{x:e.currentX,y:e.currentY}),this.tapCount=0):this.emitTouchEvent("tap",{x:e.currentX,y:e.currentY})),a>500&&r<10&&this.emitTouchEvent("longPress",{x:e.currentX,y:e.currentY}),this.touches.delete(i.identifier)}}0===e.touches.length&&(this.currentGesture=null,this.isPinching=!1,this.isRotating=!1),this.emitTouchEvent("touchEnd",{gesture:this.currentGesture,duration:t-this.gestureStartTime})}handleTouchCancel(e){this.touches.clear(),this.currentGesture=null,this.isPinching=!1,this.isRotating=!1,this.emitTouchEvent("touchCancel",{})}handleOrientationChange(e){this.orientation=this.getOrientation(),this.emitTouchEvent("orientationChange",{orientation:this.orientation,angle:window.orientation||0}),this.applyOrientationOptimizations()}handleDeviceOrientation(e){const{alpha:t,beta:i,gamma:a}=e;this.emitTouchEvent("deviceOrientation",{alpha:t,beta:i,gamma:a})}handleViewportChange(e){const t=Date.now();t-this.lastViewportChange<100||(this.lastViewportChange=t,this.viewportSize={width:window.innerWidth,height:window.innerHeight},this.pixelRatio=window.devicePixelRatio||1,this.emitTouchEvent("viewportChange",{size:this.viewportSize,pixelRatio:this.pixelRatio,orientation:this.getOrientation()}),this.config.enableResponsiveScaling&&this.applyResponsiveScaling())}handleVisibilityChange(e){const t=!document.hidden;this.emitTouchEvent("visibilityChange",{visible:t}),!t&&this.config.enableBatteryOptimization?this.applyBackgroundOptimizations():this.restorePerformance()}getOrientation(){return window.innerWidth>window.innerHeight?"landscape":"portrait"}getDistance(e,t,i,a){const s=i-e,n=a-t;return Math.sqrt(s*s+n*n)}getAngle(e,t,i,a){return 180*Math.atan2(a-t,i-e)/Math.PI}applyMobileOptimizations(){if(!this.isMobile&&!this.isTablet)return;const e={...this.mobilePerformanceSettings,canvasScale:this.calculateOptimalCanvasScale(),useWebGL:!1,useOffscreenCanvas:this.useOffscreenCanvas};return this.emitTouchEvent("mobileOptimizations",e),e}applyOrientationOptimizations(){const e="landscape"===this.orientation,t={layoutMode:e?"horizontal":"vertical",particleDirection:e?"horizontal":"vertical",uiScale:e?.8:1};return this.emitTouchEvent("orientationOptimizations",t),t}applyResponsiveScaling(){const e=Math.min(this.viewportSize.width/375,2);return this.canvasScale=e,this.emitTouchEvent("responsiveScale",{scale:this.canvasScale,viewport:this.viewportSize}),this.canvasScale}applyBackgroundOptimizations(){const e={targetFPS:5,particlesEnabled:!1,animationsEnabled:!1,audioEnabled:!1};return this.emitTouchEvent("backgroundOptimizations",e),e}restorePerformance(){const e=this.applyMobileOptimizations();return this.emitTouchEvent("performanceRestore",e),e}onBatteryChange(){if(this.lowPowerMode=this.batteryLevel<.2&&!this.isCharging,this.lowPowerMode){const e={targetFPS:15,maxParticles:5,reducedEffects:!0,audioEnabled:!1};this.emitTouchEvent("lowPowerMode",{batteryLevel:this.batteryLevel,isCharging:this.isCharging,optimizations:e})}}calculateOptimalCanvasScale(){return this.isMobile?Math.min(this.pixelRatio,2):this.isTablet?Math.min(this.pixelRatio,2.5):this.pixelRatio}getCanvas(){return this.canvas||document.querySelector("canvas")}setCanvas(e){this.canvas=e,this.config.enableTouchOptimization&&this.isTouchDevice&&this.setupTouchHandlers()}emitTouchEvent(e,t){this.onTouchEvent&&this.onTouchEvent(e,t)}getStatus(){return{device:{isMobile:this.isMobile,isTablet:this.isTablet,isTouchDevice:this.isTouchDevice,isIOS:this.isIOS,isAndroid:this.isAndroid},viewport:{size:this.viewportSize,orientation:this.orientation,pixelRatio:this.pixelRatio,canvasScale:this.canvasScale},battery:{level:this.batteryLevel,isCharging:this.isCharging,lowPowerMode:this.lowPowerMode},touch:{activeTouches:this.touches.size,currentGesture:this.currentGesture,isPinching:this.isPinching,isRotating:this.isRotating},performance:this.mobilePerformanceSettings}}destroy(){const e=this.getCanvas();e&&(e.removeEventListener("touchstart",this.handleTouchStart),e.removeEventListener("touchmove",this.handleTouchMove),e.removeEventListener("touchend",this.handleTouchEnd),e.removeEventListener("touchcancel",this.handleTouchCancel),e.removeEventListener("contextmenu",this.handleContextMenu)),window.removeEventListener("resize",this.handleViewportChange),window.removeEventListener("orientationchange",this.handleOrientationChange),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.batteryRef&&(this.boundBatteryLevelChange&&this.batteryRef.removeEventListener("levelchange",this.boundBatteryLevelChange),this.boundBatteryChargingChange&&this.batteryRef.removeEventListener("chargingchange",this.boundBatteryChargingChange),this.batteryRef=null),this.touches.clear(),this.gestureHistory=[]}}class ec{constructor(e={}){this.config={enablePlugins:!1!==e.enablePlugins,validatePlugins:!1!==e.validatePlugins,sandboxPlugins:!1!==e.sandboxPlugins,maxPlugins:e.maxPlugins||50,pluginTimeout:e.pluginTimeout||5e3,allowOverrides:!1!==e.allowOverrides,...e},this.mascot=e.mascot||null,this.plugins=new Map,this.pluginTypes=["emotion","gesture","particle","audio","renderer","animation"],this.pluginsByType=new Map(this.pluginTypes.map(e=>[e,new Set])),this.dependencies=new Map,this.dependencyGraph=new Map,this.pluginStates=new Map,this.loadingPlugins=new Set,this.activePlugins=new Set,this.hooks=new Map([["beforeInit",new Set],["afterInit",new Set],["beforeUpdate",new Set],["afterUpdate",new Set],["beforeRender",new Set],["afterRender",new Set],["beforeDestroy",new Set],["afterDestroy",new Set]]),this.pluginAPI=this.createPluginAPI(),this.conflicts=new Map,this.resolutionStrategies={override:this.overrideConflict.bind(this),merge:this.mergeConflict.bind(this),reject:this.rejectConflict.bind(this),queue:this.queueConflict.bind(this)},this.validationSchemas=this.createValidationSchemas(),this.sandbox=null,this.config.sandboxPlugins&&(this.sandbox=this.createSandbox())}createPluginAPI(){return{mascot:this.mascot,registerHook:this.registerHook.bind(this),emit:this.emitPluginEvent.bind(this),on:this.onPluginEvent.bind(this),getPlugin:this.getPlugin.bind(this),hasPlugin:this.hasPlugin.bind(this),log:this.logFromPlugin.bind(this),error:this.errorFromPlugin.bind(this),setState:this.setPluginState.bind(this),getState:this.getPluginState.bind(this),getConfig:()=>({...this.config}),version:"1.0.0"}}createValidationSchemas(){const e=new Map,t={name:{type:"string",required:!0},version:{type:"string",required:!0},type:{type:"string",required:!0,enum:this.pluginTypes},description:{type:"string",required:!1},author:{type:"string",required:!1},dependencies:{type:"array",required:!1},conflicts:{type:"array",required:!1},init:{type:"function",required:!0},destroy:{type:"function",required:!0}};return e.set("emotion",{...t,emotion:{type:"object",required:!0,properties:{name:{type:"string",required:!0},color:{type:"string",required:!0},particleColor:{type:"string",required:!1},animation:{type:"object",required:!0},transitions:{type:"object",required:!1}}},updateEmotion:{type:"function",required:!0},renderEmotion:{type:"function",required:!1}}),e.set("gesture",{...t,gesture:{type:"object",required:!0,properties:{name:{type:"string",required:!0},duration:{type:"number",required:!0},keyframes:{type:"array",required:!0},compatibility:{type:"object",required:!1}}},executeGesture:{type:"function",required:!0},canExecute:{type:"function",required:!1}}),e.set("particle",{...t,particle:{type:"object",required:!0,properties:{name:{type:"string",required:!0},maxParticles:{type:"number",required:!1},behavior:{type:"function",required:!0},render:{type:"function",required:!0}}},updateParticles:{type:"function",required:!0},spawnParticle:{type:"function",required:!1}}),e.set("audio",{...t,audio:{type:"object",required:!0,properties:{name:{type:"string",required:!0},sounds:{type:"object",required:!0},effects:{type:"array",required:!1}}},playSound:{type:"function",required:!0},processAudio:{type:"function",required:!1}}),e}createSandbox(){return{Math:Math,Date:Date,JSON:JSON,console:{log:(...e)=>null,warn:(...e)=>null,error:(...e)=>null},window:void 0,document:void 0,localStorage:void 0,sessionStorage:void 0,fetch:void 0,XMLHttpRequest:void 0,api:this.pluginAPI}}async registerPlugin(e){if(!this.config.enablePlugins)return!1;if(this.plugins.size>=this.config.maxPlugins)return!1;if(this.config.validatePlugins&&!this.validatePlugin(e).valid)return!1;if(this.checkConflicts(e).length>0&&!this.config.allowOverrides)return!1;if(!(await this.resolveDependencies(e)).resolved)return!1;try{this.loadingPlugins.add(e.name);const t=this.config.sandboxPlugins?this.sandbox:window;if(!await this.initializePlugin(e,t))throw new Error("Plugin initialization failed");return this.plugins.set(e.name,e),this.pluginsByType.get(e.type).add(e.name),this.pluginStates.set(e.name,"active"),this.activePlugins.add(e.name),e.dependencies&&(this.dependencies.set(e.name,e.dependencies),this.updateDependencyGraph(e.name,e.dependencies)),e.hooks&&Object.entries(e.hooks).forEach(([t,i])=>{this.registerHook(t,i,e.name)}),this.emitPluginEvent("pluginRegistered",{name:e.name,type:e.type,version:e.version}),!0}catch{return!1}finally{this.loadingPlugins.delete(e.name)}}validatePlugin(e){const t=[];if(e.name&&"string"==typeof e.name||t.push("Plugin must have a valid name"),e.type&&this.pluginTypes.includes(e.type)||t.push(`Plugin type must be one of: ${this.pluginTypes.join(", ")}`),e.version&&"string"==typeof e.version||t.push("Plugin must have a version"),"function"!=typeof e.init&&t.push("Plugin must have an init function"),"function"!=typeof e.destroy&&t.push("Plugin must have a destroy function"),e.type&&this.validationSchemas.has(e.type)){const i=this.validationSchemas.get(e.type),a=this.validateAgainstSchema(e,i);t.push(...a)}return{valid:0===t.length,errors:t}}validateAgainstSchema(e,t){const i=[];return Object.entries(t).forEach(([t,a])=>{if(a.required&&!(t in e)&&i.push(`Missing required property: ${t}`),t in e){const s=e[t];if(a.type&&typeof s!==a.type&&i.push(`Property ${t} must be of type ${a.type}`),a.enum&&!a.enum.includes(s)&&i.push(`Property ${t} must be one of: ${a.enum.join(", ")}`),a.properties&&"object"==typeof s){const e=this.validateAgainstSchema(s,a.properties);i.push(...e.map(e=>`${t}.${e}`))}}}),i}checkConflicts(e){const t=[];return e.conflicts&&e.conflicts.forEach(e=>{this.plugins.has(e)&&t.push(e)}),"emotion"!==e.type&&"gesture"!==e.type||this.plugins.forEach(i=>{if(i.type===e.type){const a=i[e.type]?.name,s=e[e.type]?.name;a===s&&t.push(`${e.type} name collision: ${s}`)}}),t}async resolveDependencies(e){if(!e.dependencies||0===e.dependencies.length)return{resolved:!0,missing:[]};const t=[];for(const i of e.dependencies)this.plugins.has(i)||await this.tryLoadDependency(i)||t.push(i);return{resolved:0===t.length,missing:t}}tryLoadDependency(e){return this.plugins.has(e)}updateDependencyGraph(e,t){this.dependencyGraph.set(e,new Set(t)),t.forEach(e=>{this.dependencyGraph.has(e)||this.dependencyGraph.set(e,new Set)})}async initializePlugin(e,t){try{const i=new Promise((e,t)=>{setTimeout(()=>t(new Error("Plugin initialization timeout")),this.config.pluginTimeout)}),a=e.init.bind(t);return!1!==await Promise.race([a(this.pluginAPI),i])}catch{return!1}}async unregisterPlugin(e){const t=this.plugins.get(e);if(!t)return!1;if(this.getDependentPlugins(e).length>0)return!1;try{return"function"==typeof t.destroy&&await t.destroy(),this.plugins.delete(e),this.pluginsByType.get(t.type).delete(e),this.pluginStates.delete(e),this.activePlugins.delete(e),this.dependencies.delete(e),this.dependencyGraph.delete(e),this.hooks.forEach(t=>{t.forEach(i=>{i.pluginName===e&&t.delete(i)})}),this.emitPluginEvent("pluginUnregistered",{name:e}),!0}catch{return!1}}getDependentPlugins(e){const t=[];return this.dependencies.forEach((i,a)=>{i.includes(e)&&t.push(a)}),t}registerHook(e,t,i){this.hooks.has(e)||this.hooks.set(e,new Set),this.hooks.get(e).add({handler:t,pluginName:i})}async executeHooks(e,t){const i=this.hooks.get(e);if(!i||0===i.size)return[];const a=[];for(const e of i)try{const i=await e.handler(t);a.push({pluginName:e.pluginName,result:i})}catch{}return a}getPlugin(e){return this.plugins.get(e)||null}hasPlugin(e){return this.plugins.has(e)}getPluginsByType(e){const t=this.pluginsByType.get(e);return t?Array.from(t).map(e=>this.plugins.get(e)):[]}enablePlugin(e){if(!this.plugins.has(e))return;this.pluginStates.set(e,"active"),this.activePlugins.add(e);const t=this.plugins.get(e);t.onEnable&&t.onEnable(),this.emitPluginEvent("pluginEnabled",{name:e})}disablePlugin(e){if(!this.plugins.has(e))return;this.getDependentPlugins(e),this.pluginStates.set(e,"disabled"),this.activePlugins.delete(e);const t=this.plugins.get(e);t.onDisable&&t.onDisable(),this.emitPluginEvent("pluginDisabled",{name:e})}emitPluginEvent(e,t){this.onPluginEvent&&this.onPluginEvent(e,t)}onPluginEvent(e,t){}logFromPlugin(e,...t){}errorFromPlugin(e,...t){}setPluginState(e,t,i){this.pluginStates.has(e)||this.pluginStates.set(e,{});const a=this.pluginStates.get(e);"object"==typeof a&&(a[t]=i)}getPluginState(e,t){const i=this.pluginStates.get(e);if("object"==typeof i)return i[t]}overrideConflict(e,t){return t}mergeConflict(e,t){return{...e,...t}}rejectConflict(e,t){return e}queueConflict(e,t){return[e,t]}getStatus(){return{enabled:this.config.enablePlugins,totalPlugins:this.plugins.size,activePlugins:this.activePlugins.size,loadingPlugins:this.loadingPlugins.size,pluginsByType:Object.fromEntries(Array.from(this.pluginsByType.entries()).map(([e,t])=>[e,t.size])),hooks:Object.fromEntries(Array.from(this.hooks.entries()).map(([e,t])=>[e,t.size]))}}update(e,t){if(this.config.enablePlugins)for(const i of this.activePlugins){const a=this.plugins.get(i);if(a&&"function"==typeof a.update)try{a.update(e,t)}catch(e){this.errorFromPlugin(i,"Update error:",e)}}}render(e,t){if(this.config.enablePlugins)for(const i of this.activePlugins){const a=this.plugins.get(i);if(a&&"function"==typeof a.render)try{a.render(e,t)}catch(e){this.errorFromPlugin(i,"Render error:",e)}}}async destroy(){const e=Array.from(this.plugins.keys());for(const t of e)await this.unregisterPlugin(t);this.plugins.clear(),this.pluginsByType.clear(),this.dependencies.clear(),this.dependencyGraph.clear(),this.pluginStates.clear(),this.activePlugins.clear(),this.loadingPlugins.clear(),this.hooks.clear(),this.conflicts.clear()}}class tc{constructor(){if(tc.ye)return this.features=tc.ye,void(this.capabilities=tc.fe);this.features={webAudio:this.detectWebAudio(),canvas2d:this.detectCanvas2D(),requestAnimationFrame:this.detectRequestAnimationFrame(),devicePixelRatio:this.detectDevicePixelRatio(),audioContext:this.detectAudioContext(),mediaDevices:this.detectMediaDevices(),performance:this.detectPerformance(),intersectionObserver:this.detectIntersectionObserver()},this.capabilities=this.assessCapabilities(),tc.ye=this.features,tc.fe=this.capabilities}detectWebAudio(){try{return!(!window.AudioContext&&!window.webkitAudioContext)}catch{return!1}}detectCanvas2D(){try{const e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}catch{return!1}}detectRequestAnimationFrame(){return!!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame)}detectDevicePixelRatio(){return"number"==typeof window.devicePixelRatio}detectAudioContext(){try{return!(!window.AudioContext&&!window.webkitAudioContext)}catch{return!1}}detectMediaDevices(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}detectPerformance(){return!(!window.performance||!window.performance.now)}detectIntersectionObserver(){return"function"==typeof window.IntersectionObserver}assessCapabilities(){const e=Object.values(this.features).filter(Boolean).length,t=Object.keys(this.features).length,i=e/t*100;let a="basic";return i>=90?a="full":i>=70?a="good":i>=50&&(a="limited"),{score:e,total:t,percentage:i,level:a,recommendations:this.getRecommendations(a)}}getRecommendations(e){const t=[];return this.features.webAudio||t.push("Audio features will be disabled"),this.features.requestAnimationFrame||t.push("Animation will use setTimeout fallback"),this.features.performance||t.push("Performance monitoring will be limited"),"basic"===e&&t.push("Consider using minimal build for better performance"),t}getFeatures(){return{...this.features}}getCapabilities(){return{...this.capabilities}}}class ic{constructor(){this.polyfills=new Map,this.applied=new Set}register(e,t){this.polyfills.set(e,t)}apply(e){if(this.applied.has(e))return!0;const t=this.polyfills.get(e);if(!t)return!1;try{return t(),this.applied.add(e),!0}catch{return!1}}applyAll(){const e=[];for(const t of this.polyfills.keys())this.apply(t)&&e.push(t);return e}isApplied(e){return this.applied.has(e)}}function ac(){window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(()=>{e(Date.now())},1e3/60)},window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){window.clearTimeout(e)})}function sc(){if(window.performance&&window.performance.now)return;window.performance||(window.performance={});const e=Date.now();window.performance.now=function(){return Date.now()-e}}function nc(){window.AudioContext||window.webkitAudioContext||(window.AudioContext=function(){this.state="suspended",this.sampleRate=44100,this.currentTime=0,this.destination={connect(){},disconnect(){}},this.createGain=function(){return{gain:{value:1},connect(){},disconnect(){}}},this.createOscillator=function(){return{frequency:{value:440},type:"sine",start(){},stop(){},connect(){},disconnect(){}}},this.createAnalyser=function(){return{fftSize:2048,frequencyBinCount:1024,getByteFrequencyData(e){for(let t=0;t<e.length;t++)e[t]=0},connect(){},disconnect(){}}},this.resume=function(){return this.state="running",Promise.resolve()},this.suspend=function(){return this.state="suspended",Promise.resolve()},this.close=function(){return this.state="closed",Promise.resolve()}})}class rc{constructor(e){this.canvas=e,this.context=null,this.isContextLost=!1,this.recoveryCallbacks=[],this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.setupContextLossHandling()}handleContextLost(e){e.preventDefault(),this.isContextLost=!0}handleContextRestored(){this.isContextLost=!1,this.context=this.canvas.getContext("2d"),this.recoveryCallbacks.forEach(e=>{try{e(this.context)}catch{}})}setupContextLossHandling(){this.canvas.addEventListener("webglcontextlost",this.handleContextLost),this.canvas.addEventListener("webglcontextrestored",this.handleContextRestored)}getContext(){if(this.isContextLost)return null;if(!this.context)try{this.context=this.canvas.getContext("2d")}catch{return null}return this.context}onRecovery(e){this.recoveryCallbacks.push(e)}isLost(){return this.isContextLost}recover(){if(!this.isContextLost)return!0;try{if(this.context=this.canvas.getContext("2d"),this.context)return this.isContextLost=!1,!0}catch{}return!1}destroy(){this.canvas&&(this.canvas.removeEventListener("webglcontextlost",this.handleContextLost),this.canvas.removeEventListener("webglcontextrestored",this.handleContextRestored),this.canvas=null),this.context=null,this.recoveryCallbacks=[]}}class oc{constructor(){if(oc.be)return this.browser=oc.be,void(this.optimizations=oc.we);this.browser=this.detectBrowser(),this.optimizations=new Map,this.setupOptimizations(),oc.be=this.browser,oc.we=this.optimizations}detectBrowser(){const{userAgent:e}=navigator;let t="unknown",i="unknown";if(e.includes("Chrome")){t="chrome";const a=e.match(/Chrome\/(\d+)/);i=a?a[1]:"unknown"}else if(e.includes("Firefox")){t="firefox";const a=e.match(/Firefox\/(\d+)/);i=a?a[1]:"unknown"}else if(e.includes("Safari")&&!e.includes("Chrome")){t="safari";const a=e.match(/Version\/(\d+)/);i=a?a[1]:"unknown"}else if(e.includes("Edge")){t="edge";const a=e.match(/Edge\/(\d+)/);i=a?a[1]:"unknown"}return{name:t,version:i,userAgent:e}}setupOptimizations(){this.optimizations.set("chrome",{preferredAnimationMethod:"requestAnimationFrame",audioContextOptions:{latencyHint:"interactive"},canvasOptimizations:["willReadFrequently"],particleLimit:50}),this.optimizations.set("firefox",{preferredAnimationMethod:"requestAnimationFrame",audioContextOptions:{latencyHint:"balanced"},canvasOptimizations:[],particleLimit:40}),this.optimizations.set("safari",{preferredAnimationMethod:"requestAnimationFrame",audioContextOptions:{latencyHint:"playback"},canvasOptimizations:[],particleLimit:30}),this.optimizations.set("edge",{preferredAnimationMethod:"requestAnimationFrame",audioContextOptions:{latencyHint:"interactive"},canvasOptimizations:["willReadFrequently"],particleLimit:45})}getOptimizations(){return this.optimizations.get(this.browser.name)||this.optimizations.get("chrome")}getBrowser(){return{...this.browser}}applyCanvasOptimizations(e,t){if(this.getOptimizations().canvasOptimizations.includes("willReadFrequently"))try{e.getContext("2d",{willReadFrequently:!0})}catch{}}getRecommendedParticleLimit(){return this.getOptimizations().particleLimit}getAudioContextOptions(){return this.getOptimizations().audioContextOptions}}let lc=null,hc=null;const cc=(hc||(hc=function(){if(lc)return lc;const e=new tc,t=new ic,i=new oc;t.register("requestAnimationFrame",ac),t.register("performanceNow",sc),t.register("webAudio",nc);const a=[];return e.features.requestAnimationFrame||t.apply("requestAnimationFrame")&&a.push("requestAnimationFrame"),e.features.performance||t.apply("performanceNow")&&a.push("performanceNow"),e.features.webAudio||t.apply("webAudio")&&a.push("webAudio"),lc={featureDetection:e,polyfillManager:t,browserOptimizations:i,appliedPolyfills:a,capabilities:e.getCapabilities(),browser:i.getBrowser()},lc}()),hc);function uc(e){const t=[];for(let i=0;i<e;i++){const a=i/e*Math.PI*2;t.push({x:.5+.5*Math.cos(a),y:.5+.5*Math.sin(a)})}return t}function dc(e,t=12){return uc(e)}const pc={circle:{points:uc(64),shadow:{type:"none"}},sphere:{points:uc(64),shadow:{type:"none"}},heart:{points:function(){const e=[];for(let t=0;t<64;t++){const i=t/64*Math.PI*2,a=16*Math.pow(Math.sin(i),3),s=-(13*Math.cos(i)-5*Math.cos(2*i)-2*Math.cos(3*i)-Math.cos(4*i));e.push({x:.5+a/32,y:.5+s/32})}return e}(),shadow:{type:"none"}},star:{points:function(){const e=[];for(let t=0;t<64;t++){const i=t/64,a=Math.floor(10*i),s=a%2==0,n=Math.floor(a/2);let r;r=s?(72*n-90)*Math.PI/180:(72*n+36-90)*Math.PI/180;const o=s?.5:.2;e.push({x:.5+Math.cos(r)*o,y:.5+Math.sin(r)*o})}return e}(),shadow:{type:"none"}},sun:{points:dc(64,12),shadow:{type:"sun",corona:!0,intensity:1.5,flares:!0,texture:!0,turbulence:.3}},moon:{points:uc(64),shadow:{type:"crescent",coverage:.85,angle:-30,softness:.05,offset:.7}},lunar:{points:uc(64),shadow:{type:"lunar",coverage:.7,color:"rgba(80, 20, 0, 0.8)",progression:"center"}},suspicion:{points:function(){const e=[];for(let t=0;t<64;t++){const i=t/64*Math.PI*2;let a,s;if(i<Math.PI)a=.45*Math.cos(i),s=.45*Math.sin(i);else{const e=2*Math.PI-i;a=.25*Math.cos(e)-.1,s=.35*Math.sin(e)}e.push({x:.5+a,y:.5+s})}return e}(),shadow:{type:"none"}},eclipse:{points:uc(64),shadow:{type:"lunar",coverage:.7,color:"rgba(80, 20, 0, 0.8)"}},square:{points:function(){const e=[],t=Math.floor(16);for(let i=0;i<4;i++)for(let a=0;a<t;a++){const s=a/t;let n,r;switch(i){case 0:n=-.5+s,r=-.5;break;case 1:n=.5,r=-.5+s;break;case 2:n=.5-s,r=.5;break;case 3:n=-.5,r=.5-s}e.push({x:.5+.8*n,y:.5+.8*r})}return e}(),shadow:{type:"none"}},triangle:{points:function(){const e=[],t=[{x:0,y:-.5},{x:-.433,y:.25},{x:.433,y:.25}],i=[Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),Math.sqrt(Math.pow(t[2].x-t[1].x,2)+Math.pow(t[2].y-t[1].y,2)),Math.sqrt(Math.pow(t[0].x-t[2].x,2)+Math.pow(t[0].y-t[2].y,2))],a=i[0]+i[1]+i[2],s=i.map(e=>Math.round(64*e/a)),n=s.reduce((e,t)=>e+t,0);n<64&&(s[0]+=64-n);for(let i=0;i<3;i++){const a=t[i],n=t[(i+1)%3],r=s[i];for(let t=0;t<r;t++){if(t===r-1&&i<2)continue;const s=t/r,o=a.x+(n.x-a.x)*s,l=a.y+(n.y-a.y)*s;e.push({x:.5+.9*o,y:.5+.9*l})}}for(;e.length<64;)e.push(e[e.length-1]);for(;e.length>64;)e.pop();return e}(),shadow:{type:"none"}},solar:{points:dc(64,12),shadow:{type:"solar-hybrid",corona:!0,intensity:1.5,flares:!0,texture:!0,turbulence:.3,lunarOverlay:{type:"lunar",coverage:1,color:"rgba(0, 0, 0, 1.0)",progression:"center"}}}},gc=new class{constructor(){this.shapeCache=new Map,this.morphCache=new Map,this.propertyCache=new Map,this.stats={hits:0,misses:0,loadTime:0,cacheSize:0},this.isInitialized=!1,this.loadStartTime=0,this.initialize()}initialize(){this.loadStartTime=performance.now();try{const e=Object.keys(pc);e.forEach(e=>{this.cacheShape(e)}),this.cacheCommonMorphs(e),this.isInitialized=!0,this.stats.loadTime=performance.now()-this.loadStartTime,this.stats.cacheSize=this.shapeCache.size}catch(e){this.isInitialized=!1}}cacheShape(e){try{const t=pc[e];if(t){this.shapeCache.set(e,t);const i={pointCount:t.points?.length||64,hasShadow:"none"!==t.shadow?.type,shadowType:t.shadow?.type||"none",isRadial:this.isRadialShape(e),bounds:this.calculateBounds(t.points)};this.propertyCache.set(e,i)}}catch(e){}}cacheCommonMorphs(e){[["circle","heart"],["circle","star"],["circle","square"],["heart","star"],["star","circle"],["square","circle"],["triangle","circle"],["moon","sun"],["lunar","eclipse"]].forEach(([t,i])=>{if(e.includes(t)&&e.includes(i))try{const e=this.calculateMorphSteps(t,i),a=`${t}->${i}`;this.morphCache.set(a,e)}catch(e){}})}calculateMorphSteps(e,t){const i=this.shapeCache.get(e),a=this.shapeCache.get(t);if(!i||!a)return null;const s=[];for(let e=0;e<5;e++){const t=e/4,n=this.interpolateShapePoints(i.points,a.points,t);s.push({progress:t,points:n})}return{from:e,to:t,steps:s,isRadial:this.isRadialShape(e)||this.isRadialShape(t)}}interpolateShapePoints(e,t,i){if(!e||!t)return e||t||[];const a=Math.max(e.length,t.length),s=[];for(let n=0;n<a;n++){const a=e[n]||e[0]||{x:.5,y:.5},r=t[n]||t[0]||{x:.5,y:.5};s.push({x:a.x+(r.x-a.x)*i,y:a.y+(r.y-a.y)*i})}return s}isRadialShape(e){return["circle","star","square","triangle","sun","moon"].includes(e)}calculateBounds(e){if(!e||0===e.length)return{minX:0,minY:0,maxX:1,maxY:1,width:1,height:1};let t=1/0,i=1/0,a=-1/0,s=-1/0;return e.forEach(e=>{t=Math.min(t,e.x),i=Math.min(i,e.y),a=Math.max(a,e.x),s=Math.max(s,e.y)}),{minX:t,minY:i,maxX:a,maxY:s,width:a-t,height:s-i}}getShape(e){if(!this.isInitialized)return pc[e]||null;const t=this.shapeCache.get(e);return t?(this.stats.hits++,t):(this.stats.misses++,pc[e]||null)}getProperties(e){if(!this.isInitialized){const t=pc[e];return t?{pointCount:t.points?.length||64,hasShadow:"none"!==t.shadow?.type,shadowType:t.shadow?.type||"none",isRadial:this.isRadialShape(e),bounds:this.calculateBounds(t.points)}:{}}const t=this.propertyCache.get(e);return t?(this.stats.hits++,t):(this.stats.misses++,{})}getMorph(e,t){if(!this.isInitialized)return this.calculateMorphSteps(e,t);const i=`${e}->${t}`,a=this.morphCache.get(i);return a?(this.stats.hits++,a):(this.stats.misses++,this.calculateMorphSteps(e,t))}hasShape(e){return this.shapeCache.has(e)}getStats(){const e=this.stats.hits+this.stats.misses;return{...this.stats,hitRate:e>0?`${(this.stats.hits/e*100).toFixed(1)}%`:"0%",shapes:this.shapeCache.size,morphs:this.morphCache.size,properties:this.propertyCache.size}}clear(){this.shapeCache.clear(),this.morphCache.clear(),this.propertyCache.clear(),this.stats={hits:0,misses:0,loadTime:0,cacheSize:0},this.isInitialized=!1}},mc=new class{constructor(){this.pools=new Map,this.inUse=new Set}acquire(e,t="array"){const i=`${t}_${e}`;this.pools.has(i)||this.pools.set(i,[]);const a=this.pools.get(i);if(a.length>0){const e=a.pop();return this.inUse.add(e),e}let s;switch(t){case"float32":s=new Float32Array(e);break;case"uint8":s=new Uint8Array(e);break;default:s=new Array(e).fill(0)}return this.inUse.add(s),s}release(e){if(!this.inUse.has(e))return;this.inUse.delete(e);let t="array";e instanceof Float32Array?t="float32":e instanceof Uint8Array&&(t="uint8");const i=`${t}_${e.length}`;e.fill(0),this.pools.has(i)||this.pools.set(i,[]);const a=this.pools.get(i);a.length<10&&a.push(e)}clear(){this.pools.clear(),this.inUse.clear()}};class yc{constructor(e){this.morpher=e,this.audioDeformation=0,this.vocalEnergy=0,this.vocalEffectActive=!1,this.beatGlitchIntensity=0,this.glitchPoints=[],this.bassEnergy=0,this.vocalPresence=0,this.highFreqEnergy=0,this.transientActive=!1,this.transientStrength=0,this.transientDecay=.92,this.transientHoldTime=8,this.transientHoldCounter=0}applyAudioDeformation(e){if(!e||0===e.length)return this.morpher.generateFallbackCircle();if(this.morpher.audioAnalyzer&&this.morpher.audioAnalyzer.currentFrequencies&&this.morpher.audioAnalyzer.currentFrequencies.length>0){this.morpher.frequencyData=[...this.morpher.audioAnalyzer.currentFrequencies];let e=0,t=0;for(let i=0;i<=2&&i<this.morpher.frequencyData.length;i++)e+=this.morpher.frequencyData[i],t++;t>0&&(e/=t),this.morpher.bassPeakHistory||(this.morpher.bassPeakHistory=[],this.morpher.bassThumpTimer=0),this.morpher.bassPeakHistory.push(e),this.morpher.bassPeakHistory.length>20&&this.morpher.bassPeakHistory.shift();const i=this.morpher.bassPeakHistory.reduce((e,t)=>e+t,0)/this.morpher.bassPeakHistory.length,a=this.morpher.audioAnalyzer&&this.morpher.audioAnalyzer.microphoneStream;if(e>1.08*i&&e>(a?.15:.25)){const t=a?8:6;this.bassEnergy=Math.min(1,(e-i)*t),this.morpher.bassThumpTimer=12}else this.morpher.bassThumpTimer>0?(this.morpher.bassThumpTimer--,this.bassEnergy*=.9):this.bassEnergy=0;this.morpher.spectralHistory||(this.morpher.spectralHistory=[],this.morpher.spectralFluxHistory=[],this.morpher.onsetThreshold=0,this.morpher.musicDetector.reset(),this.morpher.detectedBPM=0,this.morpher.onsetStrengths=[],this.morpher.detectedTimeSignature=null,this.morpher.timeSignatureConfidence=0,this.morpher.measureStartTime=0,this.morpher.timeSignatureHistory=[],this.morpher.timeSignatureLocked=!1);const s=[...this.morpher.frequencyData];let n=0,r=0;if(this.morpher.spectralHistory.length>0){const e=this.morpher.spectralHistory[this.morpher.spectralHistory.length-1];for(let t=0;t<=2&&t<s.length;t++){const i=s[t]-e[t];i>0&&(r+=i)}for(let t=4;t<=15&&t<s.length;t++){const i=s[t]-e[t];i>0&&(n+=i*(t>=9&&t<=13?2:1))}r>.15&&(n*=.3)}if(this.morpher.spectralHistory.push(s),this.morpher.spectralHistory.length>30&&this.morpher.spectralHistory.shift(),this.morpher.spectralFluxHistory.push(n),this.morpher.spectralFluxHistory.length>30&&this.morpher.spectralFluxHistory.shift(),this.morpher.bassFluxHistory||(this.morpher.bassFluxHistory=[],this.morpher.bassOnsetThreshold=.05),this.morpher.bassFluxHistory.push(r),this.morpher.bassFluxHistory.length>30&&this.morpher.bassFluxHistory.shift(),this.morpher.spectralFluxHistory.length>=10){const e=[...this.morpher.spectralFluxHistory].sort((e,t)=>e-t),t=e[Math.floor(e.length/2)],i=e.reduce((e,t)=>e+t,0)/e.length;this.morpher.onsetThreshold=t+.5*(i-t)}if(this.morpher.bassFluxHistory.length>=10){const e=[...this.morpher.bassFluxHistory].sort((e,t)=>e-t),t=e[Math.floor(e.length/2)],i=e.reduce((e,t)=>e+t,0)/e.length;this.morpher.bassOnsetThreshold=t+.5*(i-t)}const o=n>1.2*this.morpher.onsetThreshold&&n>.02,l=r>1.5*this.morpher.bassOnsetThreshold&&r>.08;if(o&&(this.transientHoldTime=8,this.morpher.vocalGlowBoost=.3),l){const e=performance.now(),t={time:e,strength:r/(this.morpher.bassOnsetThreshold||1),bassWeight:r};this.morpher.onsetStrengths.push(t),this.morpher.onsetStrengths.length>40&&this.morpher.onsetStrengths.shift(),this.morpher.musicDetector.addOnset(e,r)}const h=performance.now();this.morpher.musicDetector.processFrequencyFrame&&this.morpher.musicDetector.processFrequencyFrame(this.morpher.frequencyData,h),this.morpher.musicDetector.update(h),this.morpher.detectedBPM=this.morpher.musicDetector.detectedBPM,this.morpher.bpmConfidence=this.morpher.musicDetector.bpmConfidence,this.morpher.detectedBPM>0&&this.morpher.bpmConfidence>.8&&this.morpher.forceFastDetection&&(this.morpher.forceFastDetection=!1),this.transientHoldTime>0&&this.transientHoldTime--,this.morpher.vocalGlowBoost>0&&(this.morpher.vocalGlowBoost*=.92),this.vocalPresence=n,this.morpher.bassHistory[this.morpher.historyIndex]=this.bassEnergy,this.morpher.vocalHistory[this.morpher.historyIndex]=this.vocalPresence,this.morpher.historyIndex=(this.morpher.historyIndex+1)%this.morpher.bassHistory.length,this.morpher.bassEffectActive=this.morpher.bassThumpTimer>0,this.morpher.lastVocalPresence=this.morpher.lastVocalPresence||0,this.morpher.lastVocalPresence=this.vocalPresence,this.vocalEffectActive=this.transientHoldTime>0}const t=this.morpher.frequencyData&&this.morpher.frequencyData.some(e=>e>.01);if(this.morpher.audioAnalyzer&&t||(this.audioDeformation>.15?(this.morpher.bassEffectActive=!0,this.bassEnergy=Math.min(1,.8*this.audioDeformation),(!this.morpher.bassThumpTimer||this.morpher.bassThumpTimer<=0)&&(this.morpher.bassThumpTimer=12)):this.morpher.bassThumpTimer>0&&(this.morpher.bassThumpTimer--,this.bassEnergy*=.9),this.vocalEnergy>.2&&(this.vocalEffectActive=!0,this.vocalPresence=this.vocalEnergy)),!t&&this.audioDeformation>.15&&!this.morpher.bassEffectActive&&(this.morpher.bassEffectActive=!0,this.bassEnergy=Math.max(this.bassEnergy,.8*this.audioDeformation),(!this.morpher.bassThumpTimer||this.morpher.bassThumpTimer<=0)&&(this.morpher.bassThumpTimer=12)),!(0!==this.audioDeformation||this.bassEnergy>.01||this.vocalPresence>.01))return e;const i=[];if(this.morpher.bassEffectActive&&(Math.random()<.05&&(this.morpher.undulationDirection*=-1),this.morpher.undulationPhase+=.08*this.morpher.undulationDirection),this.morpher.audioAnalyzer&&this.beatGlitchIntensity>0&&(this.beatGlitchIntensity*=.9),this.vocalEffectActive&&Math.random()<.2){this.glitchPoints=[];const t=2+Math.floor(2*Math.random());for(let i=0;i<t;i++)this.glitchPoints.push({index:Math.floor(Math.random()*e.length),intensity:.02+.03*Math.random(),decay:.94+.02*Math.random()})}this.glitchPoints=this.glitchPoints.filter(e=>(e.intensity*=e.decay,e.intensity>.01));for(let t=0;t<e.length;t++){const a=e[t];if(!a||void 0===a.x||void 0===a.y){const a=t/e.length*Math.PI*2;i.push({x:.5+.5*Math.cos(a),y:.5+.5*Math.sin(a)});continue}const s=a.x-.5,n=a.y-.5,r=Math.sqrt(s*s+n*n),o=Math.atan2(n,s),l=.12*Math.abs(this.audioDeformation);let h=0,c=0;if(this.morpher.bassEffectActive){const e=2,t=.25*this.bassEnergy;h=Math.sin(o*e+this.morpher.undulationPhase)*t,c=Math.sin(.5*this.morpher.undulationPhase)*this.bassEnergy*.08}let u=0;const d=this.glitchPoints.find(e=>e.index===t);if(d){const e=.015*Date.now(),i=Math.sin(e+.5*t)*Math.cos(.7*e);u=d.intensity*i*.5}const p=1+l+h+c+u,g=r*Math.max(.8,p);i.push({x:.5+Math.cos(o)*g,y:.5+Math.sin(o)*g})}return i}setAudioDeformation(e){this.audioDeformation=Math.max(0,Math.min(1,e)),this.vocalEffectActive=e>.01}setVocalEnergy(e){this.vocalEnergy=Math.max(0,Math.min(1,e)),this.vocalEffectActive=e>.01}updateFrequencyBands(e){e&&(this.bassEnergy=e.bass||0,this.vocalPresence=e.vocal||0,this.highFreqEnergy=e.high||0)}processTransient(e,t){e>t?(this.transientActive=!0,this.transientStrength=e,this.transientHoldCounter=this.transientHoldTime):this.transientHoldCounter>0?this.transientHoldCounter--:(this.transientStrength*=this.transientDecay,this.transientStrength<.01&&(this.transientActive=!1))}getState(){return{audioDeformation:this.audioDeformation,vocalEnergy:this.vocalEnergy,vocalEffectActive:this.vocalEffectActive,beatGlitchIntensity:this.beatGlitchIntensity,transientActive:this.transientActive,transientStrength:this.transientStrength}}reset(){this.audioDeformation=0,this.vocalEnergy=0,this.vocalEffectActive=!1,this.beatGlitchIntensity=0,this.glitchPoints=[],this.transientActive=!1,this.transientStrength=0}}class fc{constructor(){this.minBPM=60,this.maxBPM=180,this.lastPeakTime=0,this.peakCount=0,this.intervals=[],this.maxIntervals=40,this.bpmVotes=new Map,this.currentBPM=0,this.lockedBPM=0,this.confidence=0,this.isActive=!1,this.lockStage=0,this.stage1LockTime=0,this.stage2CorrectionApplied=!1,this.correctionType="none",this.ve=[],this.Me=0,this.Se=0,this.xe=!1,this.ke=0,this.grooveConfidence=.15,this.Oe=.15,this.Ae=0,this.Ce=2e3,this.Ie=[],this.ze=[],this.Fe=[],this.De=0,this.qe=0,this.Re=[],this.Be=20}processPeak(e,t=performance.now()){if(this.isActive=!0,this.peakCount++,e<.1)this.De++;else{if(this.lastPeakTime>0){const e=t-this.lastPeakTime;e>=250&&e<=2e3?(this.intervals.push(e),this.Ie.push(Math.round(e)),this.intervals.length>this.maxIntervals&&this.intervals.shift(),this.voteForInterval(e)):this.qe++}this.lastPeakTime=t,this.updateBPM(),this.Ee(t)}}voteForInterval(e){const t=6e4/e;this.ze.push(Math.round(t));let i=t;const a=.95*this.minBPM,s=1.05*this.maxBPM;if(i<a)for(;i<this.minBPM;)i*=2;else if(i>s)for(;i>this.maxBPM;)i/=2;i=Math.max(this.minBPM,Math.min(this.maxBPM,i)),this.Fe.push(Math.round(i));const n=Math.round(i);for(let e=-2;e<=2;e++){const t=n+e;if(t>=this.minBPM&&t<=this.maxBPM){const i=Math.exp(-e*e/2),a=this.bpmVotes.get(t)||0;this.bpmVotes.set(t,a+i)}}for(const[e,t]of this.bpmVotes){const i=.95*t;i<.3?this.bpmVotes.delete(e):this.bpmVotes.set(e,i)}}updateBPM(){if(0===this.bpmVotes.size||this.intervals.length<3)return;const e=performance.now();let t=0,i=0,a=0;for(const[e,s]of this.bpmVotes)a+=s,s>i&&(i=s,t=e);if(0===t)return;let s=0;for(let e=-2;e<=2;e++){const i=t+e;s+=this.bpmVotes.get(i)||0}const n=s,r=Math.round(t/2);let o=0;if(r>=this.minBPM)for(let e=-2;e<=2;e++)o+=this.bpmVotes.get(r+e)||0;const l=2*t;let h=0;if(l<=this.maxBPM)for(let e=-2;e<=2;e++)h+=this.bpmVotes.get(l+e)||0;let c=0,u=0;const d=n>0?o/n:0;if(this.intervals.length>=6){const e=this.intervals.slice(-8),t=e.reduce((e,t)=>e+t,0)/e.length;let i=0;for(let a=0;a<e.length-1;a++)e[a]>t!=e[a+1]>t&&i++;c=i/(e.length-1);const a=[];for(let t=0;t<e.length-1;t+=2)a.push(e[t]+e[t+1]);if(a.length>=2){const e=a.reduce((e,t)=>e+t,0)/a.length;u=a.reduce((t,i)=>t+Math.abs(i-e),0)/a.length/e}}this.confidence=a>0?n/a:0;let p=0;if(this.intervals.length>=4){const e=6e4/t,i=e/2,a=this.intervals.slice(-8);let s=0;for(const t of a){const a=Math.abs(t-e)/e<.15,n=Math.abs(t-i)/i<.15,r=Math.abs(t-2*e)/(2*e)<.15;(a||n||r)&&s++}p=s/a.length}if(0===this.currentBPM)this.currentBPM=t;else{const e=this.intervals.length<6?.5:.3;this.currentBPM=this.currentBPM*(1-e)+t*e}if(0===this.lockStage){this.Pe={intervalCount:this.intervals.length,bestVotes:i.toFixed(1),clusterVotes:n.toFixed(1),confidence:`${(100*this.confidence).toFixed(0)}%`,consistency:`${(100*p).toFixed(0)}%`,bestBPM:t,adjustedBPM:t,isSubdivision:!1,stage:0,failReasons:[]};const a=t>120?12:8,s=.2,r=.45;this.intervals.length<a&&this.Pe.failReasons.push(`intervals<${a}`),n<=5&&this.Pe.failReasons.push("votes<=5"),this.confidence<=s&&this.Pe.failReasons.push(`conf<=${(100*s).toFixed(0)}%`),p<=r&&this.Pe.failReasons.push(`consistency<=${(100*r).toFixed(0)}%`),this.intervals.length>=a&&n>5&&this.confidence>s&&p>r&&(this.lockedBPM=Math.round(this.currentBPM),this.lockStage=1,this.stage1LockTime=e)}if(1===this.lockStage||2===this.lockStage){this.ve.push({alternatingScore:c,pairVariance:u,halfVoteRatio:d,time:e}),this.ve.length>15&&this.ve.shift();const i=this.ve.filter(e=>e.alternatingScore>.7&&e.pairVariance<.1).length,a=this.ve.reduce((e,t)=>e+t.alternatingScore,0)/this.ve.length,s=this.ve.reduce((e,t)=>e+t.pairVariance,0)/this.ve.length,o=this.ve.reduce((e,t)=>e+t.halfVoteRatio,0)/this.ve.length,p=this.intervals.length>0?this.intervals.reduce((e,t)=>e+t,0)/this.intervals.length:0,g=n>0?h/n:0;let m=0,y=0;if(this.intervals.length>=8){const e=this.intervals.slice(-12),t=[...e].sort((e,t)=>e-t),i=t[Math.floor(t.length/2)],a=e.filter(e=>Math.abs(e-i)/i<.5);if(y=a.length,a.length>=6){const e=a.reduce((e,t)=>e+t,0)/a.length;m=a.reduce((t,i)=>t+Math.abs(i-e),0)/a.length/e}}if(this.Pe={intervalCount:this.intervals.length,bestBPM:t,adjustedBPM:this.lockedBPM,halfBPM:r,stage:this.lockStage,subdivisionChecks:this.ve.length,positiveChecks:i,avgAltScore:`${(100*a).toFixed(0)}%`,avgPairVar:`${(100*s).toFixed(1)}%`,avgHalfRatio:`${(100*o).toFixed(0)}%`,intervalVariance:`${(100*m).toFixed(1)}%`,filteredCount:y,correctionApplied:this.stage2CorrectionApplied,failReasons:[]},!this.stage2CorrectionApplied&&this.ve.length>=10&&r>=this.minBPM){const e=i>=7&&a>.7&&s<.1&&this.lockedBPM>100,t=o>.4&&this.lockedBPM>150&&r>=65&&r<=85;let n=0,l=0;if(this.intervals.length>=8){const e=this.intervals.slice(-12),t=[...e].sort((e,t)=>e-t),i=t[Math.floor(t.length/2)],a=e.filter(e=>Math.abs(e-i)/i<.5);if(l=a.length,a.length>=6){const e=a.reduce((e,t)=>e+t,0)/a.length;n=a.reduce((t,i)=>t+Math.abs(i-e),0)/a.length/e}}const h=this.lockedBPM>140&&r>=65&&r<=85&&l>=8&&n<.05;(e||t||h)&&(this.lockedBPM=Math.round(this.lockedBPM/2),this.lockStage=2,this.stage2CorrectionApplied=!0,this.correctionType="halved")}!this.stage2CorrectionApplied&&this.ve.length>=10&&l<=this.maxBPM&&p>900&&g>.5&&this.lockedBPM<75&&(this.lockedBPM=Math.round(2*this.lockedBPM),this.lockStage=2,this.stage2CorrectionApplied=!0,this.correctionType="doubled");const f=e-this.stage1LockTime;1===this.lockStage&&this.ve.length>=6&&(this.lockStage=2);const b=this.ve.length>=12&&i<3,w=f>1e4;2===this.lockStage&&(this.stage2CorrectionApplied||b||w)&&(this.lockStage=3,this.Me=e)}if(3===this.lockStage){const t=e-this.Me,i=this.intervals.slice(-8);if(i.length>=4){const e=6e4/(i.reduce((e,t)=>e+t,0)/i.length);if(Math.abs(e-this.lockedBPM)/this.lockedBPM<.05){0===this.ke&&(this.ke=this.lockedBPM),this.ke=.9*this.ke+.1*e;const t=Math.round(this.ke);t!==this.lockedBPM&&(this.lockedBPM=t),this.Se+=100}else this.Se=0}const a=(t>5e3||this.Se>3e3)&&!this.xe;a&&3===this.lockStage&&(this.Te(),this.xe=!0),this.Pe={stage:3,lockedBPM:this.lockedBPM,correctionType:this.correctionType,timeSinceStage3:`${(t/1e3).toFixed(1)}s`,stableTime:`${(this.Se/1e3).toFixed(1)}s`,finalized:a,failReasons:[]}}this.je()}je(){this.xe?this.Oe=1:this.Oe=[.15,.4,.65,.85][this.lockStage]||.15;const e=this.grooveConfidence+.08*(this.Oe-this.grooveConfidence);e>this.grooveConfidence&&(this.grooveConfidence=e)}Te(){this.intervals.length>8&&(this.intervals=this.intervals.slice(-8)),this.bpmVotes.clear(),this.Ve=[],this.ve=[],this.Ie=[],this.ze=[],this.Fe=[]}processFrame(e,t=performance.now()){}reset(){this.intervals=[],this.bpmVotes.clear(),this.lastPeakTime=0,this.peakCount=0,this.currentBPM=0,this.lockedBPM=0,this.confidence=0,this.isActive=!1,this.lockStage=0,this.stage1LockTime=0,this.stage2CorrectionApplied=!1,this.correctionType="none",this.ve=[],this.Me=0,this.Se=0,this.xe=!1,this.ke=0,this.grooveConfidence=.15,this.Oe=.15,this.Ae=0,this.Ie=[],this.ze=[],this.Fe=[],this.De=0,this.qe=0,this.Re=[],this.Pe=null,this.Ve=[]}getBPM(){return this.lockedBPM>0?this.lockedBPM:Math.round(this.currentBPM)||0}getSubdivision(){return 1}getStatus(){return{bpm:this.getBPM(),subdivision:1,confidence:this.confidence,locked:this.lockedBPM>0,lockStage:this.lockStage,correctionType:this.correctionType,finalized:this.xe,grooveConfidence:this.grooveConfidence,agentCount:this.bpmVotes.size,peakCount:this.peakCount,histogramSize:this.bpmVotes.size,topAgents:this.getTopCandidates(5),intervalCount:this.intervals.length}}getTopCandidates(e=5){return[...this.bpmVotes.entries()].sort((e,t)=>t[1]-e[1]).slice(0,e).map(([e,t])=>({bpm:e,score:t.toFixed(1),interval:Math.round(6e4/e)}))}getTopIntervals(e=5){return this.getTopCandidates(e).map(e=>({interval:e.interval,bpm:e.bpm,weight:e.score}))}Ee(e){if(e-this.Ae<this.Ce)return;if(this.Ae=e,0===this.Ie.length&&0===this.De)return;const t=[],i=["Detecting","Initial Lock","Refinement","Final Lock"][this.lockStage]||"Unknown";t.push("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),t.push(`Status: Stage ${this.lockStage} (${i}) | Current: ${Math.round(this.currentBPM)} BPM | Locked: ${this.lockedBPM||"-"}`),t.push(`Peaks: ${this.peakCount} total | ${this.De} skipped (weak) | ${this.qe} intervals out-of-range`),this.Ie.length>0&&t.push(`Recent intervals (ms): [${this.Ie.join(", ")}]`),this.ze.length>0&&t.push(`Raw BPMs (before normalize): [${this.ze.join(", ")}]`),this.Fe.length>0&&t.push(`Normalized BPMs (60-180): [${this.Fe.join(", ")}]`);const a=this.getTopCandidates(5);if(a.length>0){const e=a.map(e=>`${e.bpm}(${e.score})`).join(", ");t.push(`Top candidates: ${e}`)}if(this.Pe){const e=this.Pe;0===e.stage?e.failReasons&&e.failReasons.length>0?t.push(`Stage 0: NOT locking - ${e.failReasons.join(", ")}`):t.push(`Stage 0: Ready to lock at ${e.bestBPM} BPM`):1===e.stage||2===e.stage?(t.push(`Stage ${e.stage}: Locked=${e.adjustedBPM} BPM | checks=${e.subdivisionChecks} positive=${e.positiveChecks}`),t.push(`  altScore=${e.avgAltScore} pairVar=${e.avgPairVar} halfRatio=${e.avgHalfRatio}`),e.correctionApplied&&t.push(`  Correction applied: ${this.correctionType}`)):3===e.stage&&(t.push(`Stage 3: Final=${e.lockedBPM} BPM | correction=${e.correctionType} | time=${e.timeSinceStage3} stable=${e.stableTime}`),e.finalized&&t.push("  FINALIZED - memory cleaned"))}if(this.intervals.length>=6){const e=this.intervals.slice(-8),i=e.reduce((e,t)=>e+t,0)/e.length,a=(e.reduce((e,t)=>e+Math.abs(t-i),0)/e.length/i*100).toFixed(1);let s=0;for(let t=0;t<e.length-1;t++)e[t]>i!=e[t+1]>i&&s++;const n=(s/(e.length-1)*100).toFixed(0);t.push(`Interval pattern: variance=${a}% alternating=${n}% (>70% triggers subdivision)`)}const s=[...this.intervals].map(e=>Math.round(e));if(s.length>0){const e=Math.min(...s),i=Math.max(...s),a=Math.round(s.reduce((e,t)=>e+t,0)/s.length);t.push(`Interval buffer (${s.length}/${this.maxIntervals}): min=${e}ms max=${i}ms avg=${a}ms (=${Math.round(6e4/a)} BPM)`)}t.push("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");const n=(new Date).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});for(this.Re.push({time:n,lines:t});this.Re.length>this.Be;)this.Re.shift();this.Ie=[],this.ze=[],this.Fe=[],this.De=0,this.qe=0}getDebugLog(){if(0===this.Re.length)return"No BPM debug logs yet. Play audio to generate logs.";let e="=== BPM Debug Log ===\n\n";for(const t of this.Re){e+=`[${t.time}]\n`;for(const i of t.lines)e+=`${i}\n`;e+="\n"}return e}clearDebugLog(){this.Re=[]}}class bc{constructor(){this.onsetIntervals=[],this.onsetStrengths=[],this.lastOnsetTime=0,this.onsetThreshold=.3,this.detectedBPM=0,this.bpmConfidence=0,this.lastBPMCalculation=0,this.bpmCalculationInterval=2e3,this.bpmHistory=[],this.tempoLocked=!1,this.fundamentalBPM=0,this.agentDetector=new fc,this.useAgentDetection=!0,this.timeSignature="4/4",this.detectedTimeSignature=null,this.timeSignatureConfidence=0,this.timeSignatureHistory=[],this.timeSignatureLocked=!1,this.downbeatPhase=0,this.measureLength=4,this.measureStartTime=0,this.isMusicalContent=!1,this.musicalityScore=0,this.forceFastDetection=!1}calculateBPM(){if(this.useAgentDetection){const e=this.agentDetector.getStatus();if(e.locked&&e.confidence>.6)return this.detectedBPM=e.bpm,this.bpmConfidence=e.confidence,this.tempoLocked=!0,this.fundamentalBPM=e.bpm,this.bpmHistory.push(this.detectedBPM),this.bpmHistory.length>10&&this.bpmHistory.shift(),this.detectedBPM;if(e.bpm>0&&e.confidence>.4)return this.detectedBPM=e.bpm,this.bpmConfidence=e.confidence,e.confidence>.6&&(this.tempoLocked=!0),this.detectedBPM}if(this.onsetIntervals.length<4)return this.detectedBPM;const e=this.onsetIntervals.slice(-15),t=this.findTempoCandidates(e);if(0===t.length)return this.detectedBPM;const i=t[0],a=Math.round(6e4/i.interval);if(!this.tempoLocked&&this.bpmHistory.length>3){const e=this.bpmHistory.slice(-3),t=e.reduce((e,t)=>e+t,0)/e.length;e.reduce((e,i)=>e+Math.pow(i-t,2),0)/e.length<5&&(this.fundamentalBPM=Math.round(t),this.tempoLocked=!0,this.bpmConfidence=1)}let s=a;if(this.tempoLocked&&(this.checkHarmonicRelation(a,this.fundamentalBPM)?(s=this.fundamentalBPM,this.bpmConfidence=Math.min(1,this.bpmConfidence+.1)):(this.bpmConfidence*=.9,this.bpmConfidence<.3&&i.strength>.8?(this.fundamentalBPM=a,this.bpmConfidence=.5):s=this.fundamentalBPM)),this.bpmHistory.push(s),this.bpmHistory.length>10&&this.bpmHistory.shift(),0===this.detectedBPM)this.detectedBPM=s;else{const e=this.tempoLocked?1:2,t=s-this.detectedBPM;Math.abs(t)<=e?this.detectedBPM=s:this.detectedBPM+=Math.sign(t)*e}return window.rhythmIntegration&&window.rhythmIntegration.updateBPM&&(window.rhythmManuallyStoppedForCurrentAudio||window.rhythmIntegration.updateBPM(this.detectedBPM)),this.detectedBPM}findTempoCandidates(e){const t=[];for(const i of[1,2,4]){const a=e.map(e=>e*i),s=this.clusterIntervals(a);for(const a of s){const s=a.intervals.reduce((e,t)=>e+t,0)/a.intervals.length/i,n=a.intervals.length/e.length*a.consistency,r=6e4/s,o=r>=120&&r<=140?.2:0;r>=60&&r<=220&&t.push({interval:s,strength:n+o,multiplier:i})}}return t.sort((e,t)=>t.strength-e.strength)}clusterIntervals(e){const t=[...e].sort((e,t)=>e-t),i=[];let a=[t[0]];for(let e=1;e<t.length;e++){const s=.03*a[0];if(t[e]-a[0]<=s)a.push(t[e]);else{if(a.length>=2){const e=a.reduce((e,t)=>e+t,0)/a.length,t=1/(1+a.reduce((t,i)=>t+Math.pow(i-e,2),0)/a.length/(e*e));i.push({intervals:a,consistency:t})}a=[t[e]]}}if(a.length>=3){const e=a.reduce((e,t)=>e+t,0)/a.length,t=1/(1+a.reduce((t,i)=>t+Math.pow(i-e,2),0)/a.length/(e*e));i.push({intervals:a,consistency:t})}return i}checkHarmonicRelation(e,t){const i=Math.max(e,t)/Math.min(e,t);return[2,1.5,1.333,1.25].some(e=>Math.abs(i-e)<.03)}detectTimeSignature(){const e=this.forceFastDetection?6:12;if(0===this.detectedBPM||this.onsetStrengths.length<e)return this.timeSignature;if(this.timeSignatureLocked&&!this.forceFastDetection)return this.detectedTimeSignature||this.timeSignature;const t=6e4/this.detectedBPM,i=new Array(4).fill(0).map(()=>({strength:0,bassWeight:0,count:0})),a=this.onsetStrengths.slice(-Math.min(20,this.onsetStrengths.length));if(0===a.length)return this.timeSignature;const s=a[0].time;for(const e of a){const a=(e.time-s)/t%4,n=Math.round(a)%4;i[n].strength+=e.strength,i[n].bassWeight+=e.bassWeight||0,i[n].count++}for(const e of i)e.count>0&&(e.strength/=e.count,e.bassWeight/=e.count);let n="4/4";i[0].strength>2*i[1].strength&&i[0].strength>2*i[2].strength&&i[3].count<.5*i[0].count&&this.testWaltzPattern(a,t)>.8&&(n="3/4"),this.timeSignatureHistory.push(n),this.timeSignatureHistory.length>3&&this.timeSignatureHistory.shift();const r=this.forceFastDetection?2:3;if(this.timeSignatureHistory.length>=r){const e={};for(const t of this.timeSignatureHistory)e[t]=(e[t]||0)+1;let t="4/4",i=0;for(const[a,s]of Object.entries(e))s>i&&(i=s,t=a);if(i>=2){this.detectedTimeSignature=t,this.timeSignatureLocked=!0,this.timeSignatureConfidence=i/3,window.rhythmIntegration&&window.rhythmIntegration.setTimeSignature&&window.rhythmIntegration.setTimeSignature(this.detectedTimeSignature);const e=document.getElementById("time-sig-display");e&&(e.textContent=this.detectedTimeSignature)}}return this.detectedTimeSignature||this.timeSignature}testWaltzPattern(e,t){let i=0,a=0;for(let t=0;t<e.length-2;t+=3)if(t+2<e.length){a++;const s=e[t].strength+(e[t].bassWeight||0),n=e[t+1].strength+(e[t+1].bassWeight||0),r=e[t+2].strength+(e[t+2].bassWeight||0);s>1.5*n&&s>1.5*r&&i++}return a>0?i/a:0}processFrequencyFrame(e,t=performance.now()){this.useAgentDetection&&this.agentDetector.processFrame&&this.agentDetector.processFrame(e,t)}addOnset(e,t,i=0){if(this.useAgentDetection&&this.agentDetector.processPeak(t,e),this.lastOnsetTime>0){const t=e-this.lastOnsetTime;t>273&&t<1e3&&(this.onsetIntervals.push(t),this.onsetIntervals.length>20&&this.onsetIntervals.shift())}this.onsetStrengths.push({time:e,strength:t,bassWeight:i}),this.onsetStrengths.length>40&&this.onsetStrengths.shift(),this.lastOnsetTime=e}update(e){e-this.lastBPMCalculation>this.bpmCalculationInterval&&(this.calculateBPM(),this.detectTimeSignature(),this.lastBPMCalculation=e)}getRecommendedSubdivision(){return this.useAgentDetection?this.agentDetector.getSubdivision():this.detectedBPM<60?2:this.detectedBPM<80?1:this.detectedBPM>180||this.detectedBPM>140?.5:1}reset(){this.onsetIntervals=[],this.onsetStrengths=[],this.lastOnsetTime=0,this.detectedBPM=0,this.bpmConfidence=0,this.bpmHistory=[],this.tempoLocked=!1,this.fundamentalBPM=0,this.timeSignature="4/4",this.detectedTimeSignature=null,this.timeSignatureConfidence=0,this.timeSignatureHistory=[],this.agentDetector&&this.agentDetector.reset(),this.timeSignatureLocked=!1,this.isMusicalContent=!1,this.forceFastDetection=!1}getMusicInfo(){return{bpm:this.detectedBPM,confidence:this.bpmConfidence,timeSignature:this.timeSignature,isMusical:this.isMusicalContent,musicalityScore:this.musicalityScore}}}class wc{constructor(e){this.morpher=e,this.isTransitioning=!1,this.transitionStartTime=0,this.transitionDuration=800,this.transitionProgress=0,this.easingFunction="easeInOutQuad",this.currentShape="circle",this.targetShape=null,this.previousShape=null,this.morphQueue=[],this.maxQueueSize=3,this.shadowConfig=null,this.shadowProgress=0}startTransition(e,t={}){this.isTransitioning&&this.morphQueue.length<this.maxQueueSize?this.morphQueue.push({shape:e,options:t}):(this.previousShape=this.currentShape,this.targetShape=e,this.isTransitioning=!0,this.transitionStartTime=performance.now(),this.transitionDuration=t.duration||800,this.easingFunction=t.easing||"easeInOutQuad",this.transitionProgress=0,this.shadowConfig=this.getTransitionConfig(this.currentShape,e))}update(e){if(!this.isTransitioning)return;const t=performance.now()-this.transitionStartTime,i=Math.min(1,t/this.transitionDuration);this.transitionProgress=this.applyEasing(i),this.shadowConfig&&(this.shadowProgress=this.calculateShadowProgress(i)),i>=1&&this.completeTransition()}completeTransition(){if(this.currentShape=this.targetShape,this.targetShape=null,this.isTransitioning=!1,this.transitionProgress=0,this.shadowConfig=null,this.morphQueue.length>0){const e=this.morphQueue.shift();this.startTransition(e.shape,e.options)}}getTransitionConfig(e,t){return{"circle-heart":{type:"bloom",shadowColor:"#ff69b4",shadowIntensity:.3},"heart-circle":{type:"contract",shadowColor:"#ff69b4",shadowIntensity:.2},"circle-star":{type:"burst",shadowColor:"#ffd700",shadowIntensity:.4},"star-circle":{type:"collapse",shadowColor:"#ffd700",shadowIntensity:.3}}[`${e}-${t}`]||null}calculateShadowProgress(e){if(!this.shadowConfig)return 0;switch(this.shadowConfig.type){case"bloom":return e<.5?2*e:2-2*e;case"burst":return Math.pow(1-e,2);case"contract":case"collapse":return Math.sin(e*Math.PI);default:return 0}}applyEasing(e){switch(this.easingFunction){case"linear":default:return e;case"easeInQuad":return e*e;case"easeOutQuad":return e*(2-e);case"easeInOutQuad":return e<.5?2*e*e:(4-2*e)*e-1;case"easeInCubic":return e*e*e;case"easeOutCubic":return--e*e*e+1;case"easeInOutCubic":return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}}clearQueue(){this.morphQueue=[]}hasQueuedMorphs(){return this.morphQueue.length>0}getState(){return{isTransitioning:this.isTransitioning,currentShape:this.currentShape,targetShape:this.targetShape,progress:this.transitionProgress,queueLength:this.morphQueue.length}}reset(){this.isTransitioning=!1,this.currentShape="circle",this.targetShape=null,this.transitionProgress=0,this.morphQueue=[],this.shadowConfig=null}}class vc{constructor(e){this.$e=e}getCurrentShadow(){const e=this.$e(),t=e.currentShape||"circle",i=gc&&gc.isInitialized?gc.getShape(t):pc[t],a=e.targetShape?gc&&gc.isInitialized?gc.getShape(e.targetShape):pc[e.targetShape]:null,s=i?.shadow||{type:"none"},n=a?.shadow||null;if(!e.isTransitioning||!n)return s;const r=e.morphProgress;if(e.transitionConfig&&"from_moon"===e.transitionConfig.type&&e.transitionConfig.slideOutCrescent)return this.We(r,e.transitionConfig);if(e.transitionConfig&&"moon_to_lunar"===e.transitionConfig.type)return this.Ge(r,e.transitionConfig);if(e.transitionConfig&&"eclipse_enter_lunar"===e.transitionConfig.type)return this.Le(r,e.transitionConfig);if(e.transitionConfig&&"lunar_to_moon"===e.transitionConfig.type)return this._e(r,e.transitionConfig);if(e.transitionConfig&&"eclipse_exit_lunar"===e.transitionConfig.type)return this.He(r,e.transitionConfig);if(e.transitionConfig&&"eclipse_enter"===e.transitionConfig.type)return this.Ue(r,n);if("eclipse_exit"===e.transitionConfig.type)return this.Qe(r,s);if("sun_fade"===e.transitionConfig.type)return this.Ye(r,s);if("sun_bloom"===e.transitionConfig.type)return this.Xe(r,n);if("none"!==s.type||"none"!==n.type){const e=(s.coverage||0)+((n.coverage||0)-(s.coverage||0))*r;return{type:"none"!==n.type?n.type:s.type,coverage:e,angle:n.angle||s.angle||0,softness:n.softness||s.softness||.2,progress:r}}return s}We(e,t){const i=t.shadowSlideRatio||.4;if(e<i){const t=e/i,a=-30*Math.PI/180,s=.7,n=s+(2.5-s)*t;return{type:"crescent",coverage:t>.8?.85*(1-5*(t-.8)):.85,angle:-30,offset:n,shadowX:Math.cos(a)*n,shadowY:Math.sin(a)*n}}return{type:"none"}}Ge(e,t){const i=t.startAngle*Math.PI/180,a=1-e,s=.7*Math.cos(i)*a,n=.7*Math.sin(i)*a,r=Math.pow(e,2);if(e<.6)return{type:"crescent",coverage:.85*(1-.2*r),angle:t.startAngle,offset:.7*a,shadowX:s,shadowY:n};{const t=(e-.6)/.4,i=Math.sin(t*Math.PI/2);return{type:"lunar",coverage:.85+.1*i,color:`rgba(80, 20, 0, ${.7+.2*i})`,shadowX:s*(1-i),shadowY:n*(1-i),diffusion:i,shadowProgress:e}}}Le(e,t){if(e<.3)return{type:"none"};const i=(e-.3)/.7,a=Math.sin(i*Math.PI/2),s=t.startAngle*Math.PI/180,n=1-a,r=.7*Math.cos(s)*n,o=.7*Math.sin(s)*n;if(i<.7)return{type:"crescent",coverage:.85*Math.pow(i/.7,.5),angle:t.startAngle,offset:.7*n,shadowX:r,shadowY:o};{const e=(i-.7)/.3,t=Math.sin(e*Math.PI/2);return{type:"lunar",coverage:.85+.1*t,color:`rgba(80, 20, 0, ${.6+.3*t})`,shadowX:r*(1-t),shadowY:o*(1-t),diffusion:t,shadowProgress:i}}}_e(e,t){const i=t.exitAngle*Math.PI/180,a=Math.sin(e*Math.PI/2),s=.7*Math.cos(i)*a,n=.7*Math.sin(i)*a;if(e<.6){const t=e/.6,i=Math.pow(t,.7);return{type:"lunar",coverage:.95-.1*i,color:`rgba(80, 20, 0, ${.9-.3*i})`,shadowX:.7*s,shadowY:.7*n,diffusion:1-i}}{const i=(e-.6)/.4;return{type:"crescent",coverage:.85*Math.sin(i*Math.PI/2)+.1,angle:t.exitAngle,offset:.7,shadowX:s,shadowY:n}}}He(e,t){if(e<.7){const i=e/.7,a=t.exitAngle*Math.PI/180;if(i<.4){const e=i/.4,t=1-e,s=.3*e;return{type:"lunar",coverage:.95-.1*e,color:`rgba(80, 20, 0, ${.9-.2*e})`,shadowX:.7*Math.cos(a)*s,shadowY:.7*Math.sin(a)*s,diffusion:t}}{const e=(i-.4)/.6,s=Math.pow(e,.8),n=.7*Math.cos(a)*s,r=.7*Math.sin(a)*s;return{type:"crescent",coverage:.85*(1-Math.pow(e,2)),angle:t.exitAngle,offset:.7*s,shadowX:n,shadowY:r}}}return{type:"none"}}Ue(e,t){return{...t,shadowX:1.5-1.5*e,shadowProgress:e}}Qe(e,t){const i=1.5*-e;return{...t,coverage:t.coverage*(1-e),shadowX:i,shadowProgress:1-e}}Ye(e,t){const i=1-e;return{...t,intensity:(t.intensity||1)*Math.pow(i,.7),corona:t.corona,coronaOpacity:i,flares:t.flares,flaresOpacity:Math.pow(i,1.5),texture:t.texture,textureOpacity:Math.pow(i,2),turbulence:(t.turbulence||.3)*i}}Xe(e,t){const i=e;return{...t,intensity:(t.intensity||1)*Math.pow(i,1.5),corona:t.corona,coronaOpacity:Math.pow(i,.8),flares:t.flares,flaresOpacity:i>.3?Math.pow((i-.3)/.7,.7):0,texture:t.texture,textureOpacity:i>.5?Math.pow((i-.5)/.5,2):0,turbulence:(t.turbulence||.3)*i}}}class Mc{constructor(e={}){this.numPoints=e.numPoints||64,this.morphDuration=e.morphDuration||1e3,this.easing=e.easing||"easeInOutCubic",this.transitionManager=new wc(this),this.audioDeformer=new yc(this),this.musicDetector=new bc,this.shadowEffectManager=new vc(()=>({currentShape:this.currentShape,targetShape:this.targetShape,morphProgress:this.morphProgress,isTransitioning:this.isTransitioning,transitionConfig:this.transitionConfig})),this.currentShape="circle",this.targetShape=null,this.morphProgress=0,this.visualProgress=0,this.morphStartTime=null,this.isTransitioning=!1,this.queuedMorphTimeout=null,this.shapeCache=new Map,this.currentPoints=[],this.targetPoints=[],this.musicalDuration=null,this.onBeat=!1,this.audioDeformation=0,this.vocalEnergy=0,this.lastAudioUpdate=0,this.lastVocalUpdate=0,this.audioUpdateInterval=33,this.audioAnalyzer=null,this.frequencyData=mc.acquire(32,"float32"),this.glitchPoints=[],this.undulationPhase=0,this.undulationDirection=1,this.beatGlitchIntensity=0,this.bassEnergy=0,this.vocalPresence=0,this.bassHistory=mc.acquire(60,"float32"),this.vocalHistory=mc.acquire(60,"float32"),this.historyIndex=0,this.bassEffectCooldown=0,this.vocalEffectCooldown=0,this.bassThresholdMultiplier=1.2,this.vocalThresholdMultiplier=1.1,this.bassEffectActive=!1,this.vocalEffectActive=!1,this.transientHoldTime=0,this.vocalGlowBoost=0,this.onComplete=null,this.onProgress=null,this.queuedMorph=null,this.currentPoints=this.getShapePoints("circle"),this.shapesLoaded=!0,this.prewarmCache()}prewarmCache(){["circle","heart","star","sun","moon","lunar","square","triangle"].forEach(e=>{(gc&&gc.isInitialized?gc.hasShape(e):pc[e])&&this.getShapePoints(e)}),[0,.25,.5,.75,1].forEach(e=>{this.applyEasing(e)})}getShapePoints(e){if(!this.shapeCache.has(e)){const t=gc&&gc.isInitialized?gc.getShape(e):pc[e];if(!t||!t.points){const t=pc.circle.points;return this.shapeCache.set(e,t),t}const{points:i}=t;return this.shapeCache.set(e,i),i}return this.shapeCache.get(e)}morphTo(e,t={}){if(!this.shapesLoaded)return;if(e===this.currentShape&&!this.isTransitioning)return;if(this.isTransitioning&&!t.force)return this.queuedMorph={targetShape:e,options:t},"queued";this.isTransitioning&&t.force&&this.completeMorph(!0);const i=this.getTransitionConfig(this.currentShape,e);if(this.targetShape=e,this.targetPoints=this.getShapePoints(e),this.morphStartTime=Date.now(),this.isTransitioning=!0,this.morphProgress=0,this.visualProgress=0,"bar"===t.duration||"beat"===t.duration){const e=6e4/(cl.bpm||120);"bar"===t.duration?this.morphDuration=4*e:this.morphDuration=e,this.musicalDuration=!0,this.onBeat=!1!==t.onBeat}else this.morphDuration=i?.duration||t.duration||1e3,this.musicalDuration=null,this.onBeat=!1;this.morphMode=t.mode||"smooth",this.transitionConfig=i,this.onComplete=t.onComplete,this.onProgress=t.onProgress}update(e){if(this.audioAnalyzer&&this.audioAnalyzer.isAnalyzing){const e=this.audioAnalyzer.getShapeMorpherData();if(e&&e.frequencies)for(let t=0;t<Math.min(e.frequencies.length,this.frequencyData.length);t++)this.frequencyData[t]=e.frequencies[t]}if(this.musicDetector&&this.musicDetector.update(performance.now()),!this.isTransitioning||!this.targetShape)return;const t=Date.now()-this.morphStartTime;if(this.musicalDuration){const e=6e4/(cl.bpm||120),t=this.morphDuration>2*e;this.morphDuration=t?4*e:e}let i=Math.min(t/this.morphDuration,1);if(this.musicalDuration&&this.onBeat){const e=cl.bpm||120;let t;t=e>140?2:e>100?4:8;const a=6e4/e,s=this.morphDuration/a,n=i*s,r=Math.round(n*t)/t,o=Math.min(1,r/s),l=(.3+.5*(e<90?Math.max(.3,(e-60)/30):Math.max(.4,Math.min(1,1-(e-90)/90))))*(.3+.7*Math.sin(i*Math.PI));i+=l*l*(3-2*l)*(o-i)}this.morphProgress=this.applyEasing(i),this.visualProgress=.8*this.visualProgress+.2*this.morphProgress,Math.abs(this.visualProgress-this.morphProgress)<.001&&(this.visualProgress=this.morphProgress),this.onProgress&&this.onProgress(this.morphProgress),this.morphProgress>=1&&(this.visualProgress=1,this.completeMorph())}completeMorph(e=!1){if(this.targetShape&&(this.currentShape=this.targetShape,this.currentPoints=[...this.targetPoints]),this.targetShape=null,this.isTransitioning=!1,this.morphProgress=0,this.visualProgress=0,this.onComplete&&this.onComplete(this.currentShape),!e&&this.queuedMorph){const e=this.queuedMorph;this.queuedMorph=null,this.queuedMorphTimeout=setTimeout(()=>{this.morphTo(e.targetShape,e.options),this.queuedMorphTimeout=null},50)}}hasQueuedMorph(){return null!==this.queuedMorph}clearQueue(){this.queuedMorph=null,this.queuedMorphTimeout&&(clearTimeout(this.queuedMorphTimeout),this.queuedMorphTimeout=null)}getCanvasPoints(e,t,i){let a;try{a=this.getInterpolatedPoints()}catch{a=this.generateFallbackCircle()}this.canvasPointsCache||(this.canvasPointsCache=[]);const s=this.canvasPointsCache;if(s.length=0,!a||0===a.length){for(let a=0;a<this.numPoints;a++){const n=a/this.numPoints*Math.PI*2;s.push({x:e+Math.cos(n)*i,y:t+Math.sin(n)*i})}return s}const n=Array.isArray(a)?a:[];for(let a=0;a<n.length;a++){const r=n[a];if(r&&"number"==typeof r.x&&"number"==typeof r.y){const a=e+(r.x-.5)*i*2,n=t+(r.y-.5)*i*2;s.push({x:a,y:n})}else{const r=a/n.length*Math.PI*2;s.push({x:e+Math.cos(r)*i,y:t+Math.sin(r)*i})}}for(;s.length<this.numPoints;){const a=s.length/this.numPoints*Math.PI*2;s.push({x:e+Math.cos(a)*i,y:t+Math.sin(a)*i})}return s}getInterpolatedPoints(){if(this.currentPoints&&0!==this.currentPoints.length||(this.currentPoints=this.generateFallbackCircle()),!this.isTransitioning)return this.applyAudioDeformation(this.currentPoints);const e=[];for(let t=0;t<this.numPoints;t++){const i=this.currentPoints[t],a=this.targetPoints[t];if(!i||!a){const i=t/this.numPoints*Math.PI*2;e.push({x:.5+.5*Math.cos(i),y:.5+.5*Math.sin(i)});continue}const s=this.visualProgress;let n,r;const o=["square","circle","star","triangle"],l=o.includes(this.currentShape),h=o.includes(this.targetShape);if(l||h){const e=.5,t=.5;if(h&&!l){const o=a.x-e,l=a.y-t;if(s<.3){const a=s/.3;n=i.x+(e-i.x)*a,r=i.y+(t-i.y)*a}else{const i=(s-.3)/.7;n=e+o*i,r=t+l*i}}else if(l&&!h){const o=i.x-e,l=i.y-t;if(s<.5){const e=s/.5;n=i.x-o*e,r=i.y-l*e}else{const i=(s-.5)/.5;n=e+(a.x-e)*i,r=t+(a.y-t)*i}}else{const o=i.x-e,l=i.y-t,h=a.x-e,c=a.y-t;if(s<.5){const e=s/.5;n=i.x-o*e,r=i.y-l*e}else{const i=(s-.5)/.5;n=e+h*i,r=t+c*i}}}else if("spiral"===this.morphMode){const e=s*Math.PI*2,o=.02*Math.sin(e+.2*t)*(1-2*Math.abs(s-.5));n=i.x+(a.x-i.x)*s+o,r=i.y+(a.y-i.y)*s+o}else if("wave"===this.morphMode){const e=.01*Math.sin(.3*t+s*Math.PI*4);n=i.x+(a.x-i.x)*s+e,r=i.y+(a.y-i.y)*s+e}else n=i.x+(a.x-i.x)*s,r=i.y+(a.y-i.y)*s;e.push({x:n,y:r})}return this.applyAudioDeformation(e)}applyAudioDeformation(e){return this.audioDeformer.applyAudioDeformation(e)}setAudioDeformation(e){const t=Date.now();t-this.lastAudioUpdate>this.audioUpdateInterval&&(this.audioDeformation=Math.max(-1,Math.min(1,e)),this.lastAudioUpdate=t,this.audioDeformer&&this.audioDeformer.setAudioDeformation(Math.abs(this.audioDeformation)))}setVocalEnergy(e){const t=Date.now();t-this.lastVocalUpdate>this.audioUpdateInterval&&(this.vocalEnergy=Math.max(0,Math.min(1,e)),this.lastVocalUpdate=t,this.audioDeformer&&this.audioDeformer.setVocalEnergy(this.vocalEnergy))}getTransitionConfig(e,t){const i=gc&&gc.isInitialized?gc.getShape(e):pc[e],a=gc&&gc.isInitialized?gc.getShape(t):pc[t];return"moon"===t?{type:"to_moon",easing:"easeInOutCubic",duration:1500,glowIntensity:1.5,fadeInCrescent:!0}:"moon"===e&&"lunar"===t?{type:"moon_to_lunar",easing:"easeInOutSine",duration:2e3,slideOutCrescent:!1,description:"Crescent shadow moves to center and becomes lunar eclipse"}:"moon"===e?{type:"from_moon",easing:"easeInOutCubic",duration:1e3,slideOutCrescent:!0,shadowSlideRatio:.4,description:"Moon shadow slides away THEN morphs to target"}:"lunar"===t?{type:"eclipse_enter_lunar",startAngle:-30}:"lunar"===e&&"moon"===t?{type:"lunar_to_moon",exitAngle:-30}:"lunar"===e?{type:"eclipse_exit_lunar",exitAngle:-30}:"none"===i?.shadow?.type&&"solar"===a?.shadow?.type?{type:"eclipse_enter",direction:"right"}:"solar"===i?.shadow?.type&&"none"===a?.shadow?.type?{type:"eclipse_exit",direction:"left"}:"sun"===e&&"sun"!==t?{type:"sun_fade",fadeEffects:!0}:"sun"!==e&&"sun"===t?{type:"sun_bloom",bloomEffects:!0}:{type:"standard"}}getCurrentShadow(){return this.shadowEffectManager.getCurrentShadow()}getCurrentRenderer(){return null}applyEasing(e){switch(this.transitionConfig?.easing||this.easing||"linear"){case"linear":return e;case"easeInQuad":return e*e;case"easeOutQuad":return e*(2-e);case"easeInOutQuad":return e<.5?2*e*e:(4-2*e)*e-1;case"easeInOutSine":return-(Math.cos(Math.PI*e)-1)/2;default:return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}}calculateBPM(){return this.musicDetector.calculateBPM()}findTempoCandidates(e){return this.musicDetector.findTempoCandidates(e)}clusterIntervals(e){return this.musicDetector.clusterIntervals(e)}checkHarmonicRelation(e,t){return this.musicDetector.checkHarmonicRelation(e,t)}detectTimeSignature(){this.musicDetector.forceFastDetection=this.forceFastDetection;const e=this.musicDetector.detectTimeSignature();return this.detectedTimeSignature=this.musicDetector.detectedTimeSignature,this.timeSignatureConfidence=this.musicDetector.timeSignatureConfidence,this.timeSignatureLocked=this.musicDetector.timeSignatureLocked,e}testWaltzPattern(e,t){return this.musicDetector.testWaltzPattern(e,t)}resetMusicDetection(){this.forceFastDetection=!0,this.musicDetector.reset(),this.musicDetector.forceFastDetection=!0,this.onsetThreshold=0,this.detectedBPM=0,this.bpmConfidence=0,this.onsetStrengths=[],this.detectedTimeSignature=null,this.timeSignatureConfidence=0,this.musicDetector.lastBPMCalculation=0,this.measureStartTime=0,this.timeSignatureHistory=[],this.timeSignatureLocked=!1,this.spectralHistory=[],this.spectralFluxHistory=[];const e=document.getElementById("time-sig-display");e&&(e.textContent="‚Äî")}getCurrentMusicInfo(){return{bpm:this.detectedBPM,timeSignature:this.detectedTimeSignature,bpmLocked:this.tempoLocked,timeSigLocked:this.timeSignatureLocked}}generateFallbackCircle(){const e=[];for(let t=0;t<this.numPoints;t++){const i=t/this.numPoints*Math.PI*2;e.push({x:.5+.5*Math.cos(i),y:.5+.5*Math.sin(i)})}return e}getState(){return{currentShape:this.currentShape,targetShape:this.targetShape,isTransitioning:this.isTransitioning,progress:this.morphProgress,audioDeformation:this.audioDeformation,vocalEnergy:this.vocalEnergy}}getProgress(e=!0){return e?this.visualProgress:this.morphProgress}isInTransition(){return this.isTransitioning}destroy(){this.queuedMorphTimeout&&(clearTimeout(this.queuedMorphTimeout),this.queuedMorphTimeout=null),this.queuedMorph=null,this.shapeCache.clear(),this.canvasPointsCache=null,this.frequencyData&&(mc.release(this.frequencyData),this.frequencyData=null),this.bassHistory&&(mc.release(this.bassHistory),this.bassHistory=null),this.vocalHistory&&(mc.release(this.vocalHistory),this.vocalHistory=null),this.audioAnalyzer=null}}class Sc{constructor(){this.audioContext=null,this.analyser=null,this.source=null,this.elementSource=null,this.dataArray=null,this.isAnalyzing=!1,this.connectedElement=null,this.gainNode=null,this.animationFrameId=null,this.frequencyBands=32,this.smoothingFactor=.3,this.vocalRange={min:80,max:1e3},this.currentAmplitude=0,this.currentFrequencies=new Array(this.frequencyBands).fill(0),this.beatThreshold=.3,this.lastBeatTime=0,this.beatCallbacks=[]}init(){try{return this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),"suspended"===this.audioContext.state?this.audioContext.resume().then(()=>(this.createAnalyser(),!0)).catch(()=>!1):(this.createAnalyser(),!0)}catch(e){return!1}}createAnalyser(){if(this.audioContext&&!this.analyser){this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.5;const e=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(e)}}connectAudioElement(e){if(this.audioContext)try{this.elementSource&&this.connectedElement===e||(this.elementSource=this.audioContext.createMediaElementSource(e),this.elementSource.connect(this.analyser),this.elementSource.connect(this.audioContext.destination)),this.source=this.elementSource,this.connectedElement=e,this.isAnalyzing=!0,this.analyze()}catch(t){t.message&&t.message.includes("already been used")&&(this.source=this.elementSource,this.connectedElement=e,this.isAnalyzing=!0,this.analyze())}}analyze(){if(!this.isAnalyzing)return;this.animationFrameId=requestAnimationFrame(()=>this.analyze()),this.analyser.getByteFrequencyData(this.dataArray);const e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteTimeDomainData(e);let t=0,i=0,a=0;const s=this.audioContext.sampleRate/2/this.dataArray.length,n=Math.floor(this.vocalRange.min/s),r=Math.ceil(this.vocalRange.max/s);for(let e=0;e<this.dataArray.length;e++){const s=this.dataArray[e]/255;t+=s,e>=n&&e<=r&&(i+=s,a++)}this.currentAmplitude=t/this.dataArray.length;const o=a>0?i/a:0;return this.extractFrequencyBands(),this.detectBeat(this.currentAmplitude),{amplitude:this.currentAmplitude,vocalAmplitude:o,frequencies:this.currentFrequencies,rawData:this.dataArray}}extractFrequencyBands(){const e=Math.floor(this.dataArray.length/this.frequencyBands);for(let t=0;t<this.frequencyBands;t++){let i=0;const a=t*e,s=Math.min(a+e,this.dataArray.length);for(let e=a;e<s;e++)i+=this.dataArray[e]/255;const n=i/e;this.currentFrequencies[t]=this.currentFrequencies[t]*this.smoothingFactor+n*(1-this.smoothingFactor)}}detectBeat(e){const t=performance.now();e>this.beatThreshold&&t-this.lastBeatTime>60&&(this.lastBeatTime=t,this.beatCallbacks.forEach(t=>t(e)))}getVocalInstability(){let e=0;const t=this.currentFrequencies.reduce((e,t)=>e+t,0)/this.frequencyBands;for(let i=0;i<this.frequencyBands;i++)e+=Math.pow(this.currentFrequencies[i]-t,2);return e=Math.sqrt(e/this.frequencyBands),Math.min(1,2*e+.5*this.currentAmplitude)}getShapeMorpherData(){return{instability:this.getVocalInstability(),frequencies:[...this.currentFrequencies],amplitude:this.currentAmplitude}}onBeat(e){this.beatCallbacks.push(e)}stop(){if(this.isAnalyzing=!1,null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.gainNode){try{this.gainNode.disconnect()}catch{}this.gainNode=null}if(this.elementSource&&this.connectedElement){try{this.elementSource.connect(this.analyser)}catch{}this.source=this.elementSource}}async resume(){this.audioContext&&"suspended"===this.audioContext.state&&await this.audioContext.resume()}destroy(){this.stop(),null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.analyser=null,this.dataArray=null,this.beatCallbacks=[]}}class xc{constructor(){this.timingClasses={downbeat:{gestures:["bounce","jump","headBob","spin","orbit"],timing:1,priority:1,description:"Strong emphasis on the downbeat"},upbeat:{gestures:["wave","nod","point","reach"],timing:.5,priority:2,description:"Medium emphasis on upbeat"},offbeat:{gestures:["wiggle","sway","lean","tilt","groove"],timing:.5,priority:3,description:"Syncopated, creates groove"},subdivision:{gestures:["pulse","sparkle","flash","shimmer","flicker"],timing:.25,priority:4,description:"Quick accents and fills"},continuous:{gestures:["breathe","float","rain"],timing:-1,priority:5,description:"Ambient, continuous motion"}},this.fillPatterns={subtle:["breathe","float"],rhythmic:["pulse","shimmer"],energetic:["wiggle","sparkle"],smooth:["sway","glow"]},this.densityProfiles={sparse:{fillProbability:.1,subdivisionLevel:2,description:"Minimal movement"},moderate:{fillProbability:.3,subdivisionLevel:4,description:"Balanced movement"},dense:{fillProbability:.5,subdivisionLevel:8,description:"Busy, energetic"},chaos:{fillProbability:.8,subdivisionLevel:16,description:"Maximum energy"}},this.groups={movement:{gestures:["bounce","spin","orbit","sway","hula","jump","twist","groove"],maxSimultaneous:1,priority:1,description:"Primary body movements - mutually exclusive"},expression:{gestures:["wave","nod","shake","point","lean","tilt","reach"],maxSimultaneous:2,priority:2,description:"Expressive gestures - can combine up to 2"},dance:{gestures:["headBob","wiggle","runningman","charleston"],maxSimultaneous:1,priority:2,description:"Dance moves - one at a time but can add effects"},effects:{gestures:["pulse","glow","sparkle","flash","shimmer","flicker"],maxSimultaneous:-1,priority:3,description:"Visual effects - all can layer together"},modifiers:{gestures:["breathe","float","rain"],maxSimultaneous:-1,priority:4,description:"Ambient effects - always allowed"}},this.enhancingCombinations=[["bounce","sparkle"],["spin","glow"],["wave","pulse"],["nod","pulse"],["jump","flash"],["sway","breathe"],["float","shimmer"],["orbit","sparkle"],["headBob","pulse"]],this.incompatiblePairs=[["bounce","jump"],["spin","orbit"],["wave","point"],["nod","shake"],["lean","tilt"]],this.chords={celebrate:["bounce","sparkle","pulse"],greeting:["wave","nod","glow"],excited:["jump","flash","wiggle"],mystical:["float","shimmer","breathe"],party:["headBob","pulse","sparkle"],smooth:["sway","glow","breathe"],dramatic:["spin","flash","sparkle"]},this.chains={rise:"breathe > sway+lean+tilt",flow:"sway > lean+tilt > spin > bounce",burst:"jump > nod > shake > flash",drift:"sway+breathe+float+drift",chaos:"shake+shake > spin+flash > bounce+pulse > twist+sparkle",morph:"expand > contract > morph+glow > expand+flash",rhythm:"pulse > pulse+sparkle > pulse+flicker",spiral:"spin > orbital > twist > orbital+sparkle",routine:"nod > bounce > spin+sparkle > sway+pulse > nod+flash",radiance:"sparkle > pulse+flicker > shimmer",twinkle:"sparkle > flash > pulse+sparkle > shimmer+flicker",stream:"wave > nod+pulse > sparkle > flash",buildup:"pulse > pulse > bounce+sparkle > spin+flash",cascade:"wave > lean > tilt > spin > bounce+glow",celebrate:"bounce+sparkle > spin > jump+flash > nod+pulse",smooth:"sway+breathe > float > orbit+shimmer > sway+glow",custom:"expand > contract > morph > expand+glow",greeting:"wave+glow > nod+pulse > wave",mystical:"float+shimmer > orbit+breathe > spin+sparkle > float+glow"}}canExecuteSimultaneously(e,t){if(e===t)return!1;if(this.incompatiblePairs.some(i=>i.includes(e)&&i.includes(t)))return!1;const i=this.getGestureGroup(e),a=this.getGestureGroup(t);if(i===a){const e=this.groups[i];return e&&1!==e.maxSimultaneous}return!("movement"===i&&"movement"===a||"dance"===i&&"dance"===a)}getGestureGroup(e){for(const[t,i]of Object.entries(this.groups))if(i.gestures.includes(e))return t;return null}getGesturePriority(e){const t=this.getGestureGroup(e);return t?this.groups[t].priority:99}getCompatibleGestures(e){if(!e||0===e.length)return[];if(1===e.length)return e;const t=[],i=new Set,a=e=>"string"==typeof e?e:e.gestureName,s=[...e].sort((e,t)=>this.getGesturePriority(a(e))-this.getGesturePriority(a(t)));for(const e of s){if(i.has(e))continue;const s=a(e);let n=!0;for(const e of t){const t=a(e);if(!this.canExecuteSimultaneously(s,t)){n=!1;break}}if(n){const n=this.groups[this.getGestureGroup(s)];if(n&&n.maxSimultaneous>0&&t.filter(e=>this.getGestureGroup(a(e))===this.getGestureGroup(s)).length>=n.maxSimultaneous)continue;t.push(e),i.add(e)}}return t}parseChain(e){return e?(this.chains[e]&&(e=this.chains[e]),e.split(">").map(e=>e.trim()).map(e=>e.split("+").map(e=>e.trim()).filter(e=>e))):[]}isEnhancingCombination(e){const t=e.map(e=>"string"==typeof e?e:e.gestureName);return this.enhancingCombinations.some(e=>e.every(e=>t.includes(e)))}getChord(e){return this.chords[e]||null}createChord(e){const t=this.getCompatibleGestures(e),i=this.isEnhancingCombination(t);return{type:"chord",gestures:t.map(e=>"string"==typeof e?e:e.gestureName),isEnhancing:i,timestamp:Date.now()}}isValidGesture(e){return null!==this.getGestureGroup(e)}getAllGestures(){const e=[];for(const t of Object.values(this.groups))e.push(...t.gestures);return[...new Set(e)]}getGestureTiming(e){for(const[t,i]of Object.entries(this.timingClasses))if(i.gestures.includes(e))return{name:t,...i};return null}getNextBeatForGesture(e,t,i=1){const a=this.getGestureTiming(e);if(!a)return t+1;if(-1===a.timing)return t;const s=a.timing/i,n=Math.ceil(t/s)*s;return"offbeat"===a.name?n+.5:n}getFillGestures(e,t="moderate"){const i=this.densityProfiles[t]||this.densityProfiles.moderate;let a;return a=e<80?"energetic":e<120?"rhythmic":e<160?"smooth":"subtle",Math.random()<i.fillProbability&&this.fillPatterns[a]||[]}getNextBeatTiming(e,t,i){return this.getNextBeatForGesture(e,t)}getIntensityFromBPM(e){return e<60?"dense":e<100||e<140?"moderate":"sparse"}applySwingTiming(e,t=.67){return.5==e%1?Math.floor(e)+t:e}}const kc=new xc;var Oc=Object.freeze({__proto__:null,GestureCompatibility:xc,default:kc});class Ac{constructor(){this.templates={straight:{name:"Straight",timeSignature:"4/4",baseMovement:"grooveBob",transitionStyle:"transitionLean",pattern:{emphasis:[1,0,.5,0],velocities:[1,0,.6,0],subdivisions:[0,.5]},swing:0,humanization:.05,preferredGestures:{downbeat:["bounce","headBob","jump"],offbeat:["pulse","breathe"],fills:["sparkle","glow"]},compositeMove:null,intensity:"moderate",description:"Standard 4/4 rhythm, good for pop/rock"},swing:{name:"Swing",timeSignature:"4/4",baseMovement:"grooveFlow",transitionStyle:"transitionGlide",compositeMove:"swingOut",pattern:{emphasis:[1,0,.66,0],velocities:[1,0,.7,0],subdivisions:[0,.66]},swing:.67,humanization:.08,preferredGestures:{downbeat:["sway","lean","bounce"],offbeat:["wiggle","pulse"],fills:["shimmer","float"]},intensity:"moderate",description:"Jazz swing feel with triplet subdivision"},shuffle:{name:"Shuffle",timeSignature:"4/4",baseMovement:"grooveBob",transitionStyle:"transitionLean",compositeMove:null,pattern:{emphasis:[1,.25,.5,.75],velocities:[1,.3,.7,.3],subdivisions:[0,.25,.5,.75]},swing:.75,humanization:.06,preferredGestures:{downbeat:["bounce","headBob"],upbeat:["twist","wiggle"],offbeat:["pulse","breathe"],fills:["sparkle","flash"]},intensity:"dense",description:"Blues/rock shuffle with heavy swing"},latin:{name:"Latin",timeSignature:"4/4",baseMovement:"grooveSway",transitionStyle:"transitionRoll",compositeMove:"latinHips",pattern:{emphasis:[1,0,.375,.5,0,.75,0,0],velocities:[1,0,.8,.9,0,.8,0,0],subdivisions:[0,.375,.5,.75]},swing:0,humanization:.04,preferredGestures:{downbeat:["sway","wiggle"],syncopation:["twist","lean"],offbeat:["pulse","shimmer"],fills:["sparkle","shake"]},intensity:"dense",description:"Latin clave rhythm with syncopation"},breakbeat:{name:"Breakbeat",timeSignature:"4/4",baseMovement:"grooveStep",transitionStyle:"transitionGlide",compositeMove:null,pattern:{emphasis:[1,0,0,.75,.25,.5,0,.625],velocities:[1,0,0,.9,.6,.8,0,.7],subdivisions:[0,.25,.5,.625,.75]},swing:0,humanization:.03,preferredGestures:{downbeat:["bounce","twist"],syncopation:["flash","shake"],offbeat:["pulse","wiggle"],fills:["sparkle","glitch"]},intensity:"chaos",description:"Hip-hop/DnB breakbeat pattern"},waltz:{name:"Waltz",timeSignature:"3/4",baseMovement:"grooveFlow",transitionStyle:"transitionGlide",compositeMove:null,pattern:{emphasis:[1,.33,.67],velocities:[1,.5,.5],subdivisions:[0,.33,.67]},swing:0,humanization:.07,preferredGestures:{downbeat:["sway","float"],weak:["breathe","lean"],fills:["shimmer","glow"]},intensity:"sparse",description:"3/4 waltz time"},techno:{name:"Techno",timeSignature:"4/4",baseMovement:"groovePulse",transitionStyle:"transitionLean",compositeMove:"robotPop",pattern:{emphasis:[1,.25,.5,.75,1,.25,.5,.75],velocities:[1,.6,1,.6,1,.6,1,.6],subdivisions:[0,.25,.5,.75]},swing:0,humanization:.02,preferredGestures:{downbeat:["pulse","bounce"],subdivision:["flash","glitch"],fills:["sparkle","strobe"]},intensity:"dense",description:"Driving techno four-on-the-floor"},ambient:{name:"Ambient",timeSignature:"4/4",baseMovement:"groovePulse",transitionStyle:"transitionGlide",compositeMove:null,pattern:{emphasis:[.8,0,.3,0,.5,0,.3,0],velocities:[.8,0,.3,0,.5,0,.3,0],subdivisions:[0,.5]},swing:0,humanization:.15,preferredGestures:{downbeat:["float","breathe"],offbeat:["sway","shimmer"],fills:["glow","pulse"]},intensity:"sparse",description:"Floating ambient rhythm"},funk:{name:"Funk",timeSignature:"4/4",baseMovement:"grooveSway",transitionStyle:"transitionRoll",compositeMove:"funkChicken",pattern:{emphasis:[1.2,.125,.25,0,.625,.75,0,.875],velocities:[1.2,.3,.4,0,.8,.6,0,.4],subdivisions:[0,.125,.25,.625,.75,.875]},swing:.1,humanization:.06,preferredGestures:{one:["bounce","twist"],ghost:["wiggle","pulse"],syncopation:["lean","shake"],fills:["flash","sparkle"]},intensity:"chaos",description:"Funky syncopated rhythm with THE ONE"},trap:{name:"Trap",timeSignature:"4/4",baseMovement:"grooveStep",transitionStyle:"transitionLean",compositeMove:null,pattern:{emphasis:[1,0,0,.375,0,.75,.875,0],velocities:[1,0,0,.7,0,.8,.6,0],subdivisions:[0,.375,.75,.875]},swing:0,humanization:.03,preferredGestures:{downbeat:["bounce","lean"],hihat:["shake","shimmer"],syncopation:["twist","flash"],fills:["sparkle","glitch"]},intensity:"moderate",description:"Trap rhythm with triplet hi-hats"}},this.transitions={instant:0,nextBar:1,nextPhrase:4,fadeIn:8},this.currentGroove=null,this.transitionMode="nextBar",this.pendingGroove=null}getTemplate(e){return this.templates[e.toLowerCase()]||this.templates.straight}getEmphasis(e,t,i){if(!e||!e.pattern)return 0;const a=e.pattern.subdivisions.findIndex(e=>Math.abs(e-i)<.01);return-1===a?0:e.pattern.emphasis[a]||0}getVelocity(e,t,i){if(!e||!e.pattern)return 1;const a=e.pattern.subdivisions.findIndex(e=>Math.abs(e-i)<.01);return-1===a?0:e.pattern.velocities[a]||0}getPreferredGesture(e,t,i,a=[]){if(!e||!e.preferredGestures)return null;let s;s=0===i?"downbeat":.5===i?"offbeat":.25===i||.75===i?"subdivision":"syncopation","Funk"===e.name&&t%4==0&&0===i&&(s="one");const n=e.preferredGestures[s]||e.preferredGestures.fills;if(!n||0===n.length)return null;if(a.length>0){const e=n.filter(e=>a.includes(e));if(e.length>0)return e[Math.floor(Math.random()*e.length)]}return n[Math.floor(Math.random()*n.length)]}humanizeTiming(e,t){if(!e||!e.humanization)return t;const i=e.humanization,a=(Math.random()-.5)*i;return Math.max(0,Math.min(1,t+a))}applySwing(e,t){return e&&e.swing&&0!==e.swing?Math.abs(t-.5)<.01?.5+.5*(e.swing-.5):Math.abs(t-.25)<.01?.25+.25*(e.swing-.5):Math.abs(t-.75)<.01?.75+.25*(e.swing-.5):t:t}setGroove(e,t=null){const i=this.getTemplate(e);return!!i&&("instant"!==(t||this.transitionMode)&&this.currentGroove?this.pendingGroove=i:(this.currentGroove=i,this.pendingGroove=null),!0)}onBeat(e){this.pendingGroove&&("nextBar"===this.transitionMode&&e%4==0||"nextPhrase"===this.transitionMode&&e%16==0)&&(this.currentGroove=this.pendingGroove,this.pendingGroove=null)}getBaseMovement(){return this.currentGroove?.baseMovement||null}getTransitionStyle(){return this.currentGroove?.transitionStyle||"transitionLean"}getCompositeMove(){return this.currentGroove?.compositeMove||null}shouldTriggerComposite(e){return!!this.currentGroove?.compositeMove&&e%("sparse"===this.currentGroove.intensity?32:16)==0}getLayeredGestures(e,t){if(!this.currentGroove)return null;const i={base:this.getBaseMovement(),accent:null,transition:null,composite:null,velocity:1};this.shouldTriggerComposite(e)&&0===t&&(i.composite=this.getCompositeMove());const a=this.getEmphasis(this.currentGroove,e,t),s=this.getVelocity(this.currentGroove,e,t);return a>.3&&s>.3&&(i.accent=this.getPreferredGesture(this.currentGroove,e,t),i.velocity=s),i.accent&&Math.random()<.3&&(i.transition=this.getTransitionStyle()),i}getGrooveNames(){return Object.keys(this.templates)}getGrooveInfo(e){const t=this.templates[e];return t?{name:t.name,timeSignature:t.timeSignature,description:t.description,intensity:t.intensity,swing:t.swing,baseMovement:t.baseMovement,compositeMove:t.compositeMove}:null}}const Cc={listening:{name:"listening",category:"conversational",emotion:"curiosity",gesture:"pulse",delay:0,baseIntensity:.6,emotionDuration:400,description:"User is speaking, AI is listening attentively"},thinking:{name:"thinking",category:"conversational",emotion:"focused",gesture:"breathe",delay:100,baseIntensity:.7,emotionDuration:500,description:"AI is processing and thinking"},acknowledging:{name:"acknowledging",category:"conversational",emotion:"calm",gesture:"nod",delay:150,baseIntensity:.7,emotionDuration:400,description:"AI acknowledges understanding"},guiding:{name:"guiding",category:"conversational",emotion:"calm",gesture:"point",delay:200,baseIntensity:.7,emotionDuration:500,description:"AI provides guidance or instructions"},empathizing:{name:"empathizing",category:"conversational",emotion:"empathy",baseIntensity:.8,emotionDuration:600,description:"AI shows empathy and understanding",sequence:[{at:0,action:"emotion",value:"empathy",intensity:.8},{at:200,action:"gesture",value:"shake"},{at:700,action:"gesture",value:"nod"}]},celebrating:{name:"celebrating",category:"conversational",emotion:"joy",baseIntensity:.9,emotionDuration:500,description:"AI celebrates success with user",sequence:[{at:0,action:"emotion",value:"joy",intensity:.9},{at:200,action:"gesture",value:"bounce"},{at:800,action:"emotion",value:"triumph",intensity:1},{at:900,action:"gesture",value:"glow"}]},celebrating_epic:{name:"celebrating_epic",category:"conversational",emotion:"triumph",baseIntensity:1,emotionDuration:500,description:"Epic celebration with visual transformation",sequence:[{at:0,action:"emotion",value:"joy",intensity:.9},{at:200,action:"gesture",value:"bounce"},{at:700,action:"emotion",value:"triumph",intensity:1},{at:800,action:"gesture",value:"glow"},{at:1e3,action:"morph",value:"sun"},{at:1e3,action:"chain",value:"radiance"}]},reassuring:{name:"reassuring",category:"conversational",emotion:"calm",baseIntensity:.8,emotionDuration:600,description:"AI provides reassurance and comfort",sequence:[{at:0,action:"emotion",value:"calm",intensity:.8},{at:200,action:"gesture",value:"breathe"},{at:800,action:"gesture",value:"wave"}]},offering_help:{name:"offering_help",category:"conversational",emotion:"empathy",baseIntensity:.8,emotionDuration:500,description:"AI offers assistance",sequence:[{at:0,action:"emotion",value:"empathy",intensity:.8},{at:200,action:"gesture",value:"nod"},{at:600,action:"gesture",value:"point"}]},offering_urgent_help:{name:"offering_urgent_help",category:"conversational",emotion:"empathy",baseIntensity:1,emotionDuration:400,description:"AI urgently offers help for frustrated user",sequence:[{at:0,action:"emotion",value:"empathy",intensity:1},{at:150,action:"gesture",value:"shake"},{at:400,action:"gesture",value:"nod"},{at:700,action:"gesture",value:"point"}]},apologizing:{name:"apologizing",category:"conversational",emotion:"empathy",baseIntensity:.85,emotionDuration:600,description:"AI apologizes for mistake or error",sequence:[{at:0,action:"emotion",value:"empathy",intensity:.85},{at:200,action:"gesture",value:"shake"},{at:600,action:"gesture",value:"breathe"}]},encouraging:{name:"encouraging",category:"conversational",emotion:"joy",gesture:"nod",delay:200,baseIntensity:.75,emotionDuration:500,description:"AI encourages user to continue"},greeting:{name:"greeting",category:"conversational",emotion:"joy",gesture:"wave",delay:200,baseIntensity:.7,emotionDuration:500,description:"AI greets user warmly"},responding_positive:{name:"responding_positive",category:"conversational",emotion:"joy",gesture:"bounce",delay:150,baseIntensity:.75,emotionDuration:500,description:"AI responds with positive sentiment"},responding_neutral:{name:"responding_neutral",category:"conversational",emotion:"calm",gesture:"drift",delay:150,baseIntensity:.6,emotionDuration:500,description:"AI responds with neutral sentiment"},responding_negative:{name:"responding_negative",category:"conversational",emotion:"empathy",gesture:"shake",delay:150,baseIntensity:.8,emotionDuration:600,description:"AI responds to negative situation"},success_minor:{name:"success_minor",category:"feedback",emotion:"joy",gesture:"bounce",delay:150,baseIntensity:.7,emotionDuration:500,description:"Small success (item scanned, form field validated)"},success_moderate:{name:"success_moderate",category:"feedback",emotion:"joy",baseIntensity:.8,emotionDuration:500,description:"Moderate success (section completed, task done)",sequence:[{at:0,action:"emotion",value:"joy",intensity:.8},{at:200,action:"gesture",value:"bounce"},{at:600,action:"gesture",value:"wiggle"}]},success_major:{name:"success_major",category:"feedback",emotion:"triumph",baseIntensity:.9,emotionDuration:500,description:"Major success (milestone reached, goal achieved)",sequence:[{at:0,action:"emotion",value:"joy",intensity:.85},{at:150,action:"gesture",value:"bounce"},{at:500,action:"emotion",value:"triumph",intensity:.9},{at:600,action:"gesture",value:"glow"}]},success_epic:{name:"success_epic",category:"feedback",emotion:"triumph",baseIntensity:1,emotionDuration:500,description:"Epic success with visual transformation",sequence:[{at:0,action:"emotion",value:"triumph",intensity:1},{at:200,action:"gesture",value:"glow"},{at:700,action:"morph",value:"sun"},{at:700,action:"chain",value:"radiance"}]},error_minor:{name:"error_minor",category:"feedback",emotion:"concern",gesture:"shake",delay:150,baseIntensity:.6,emotionDuration:500,description:"Minor error, easily recoverable"},error_moderate:{name:"error_moderate",category:"feedback",emotion:"empathy",baseIntensity:.75,emotionDuration:600,description:"Moderate error, needs user action",sequence:[{at:0,action:"emotion",value:"empathy",intensity:.75},{at:200,action:"gesture",value:"shake"},{at:600,action:"gesture",value:"nod"}]},error_major:{name:"error_major",category:"feedback",emotion:"empathy",baseIntensity:.9,emotionDuration:600,description:"Major error, needs help",sequence:[{at:0,action:"emotion",value:"empathy",intensity:.9},{at:150,action:"gesture",value:"shake"},{at:500,action:"gesture",value:"nod"},{at:800,action:"gesture",value:"point"}]},error_critical:{name:"error_critical",category:"feedback",emotion:"empathy",baseIntensity:1,emotionDuration:500,description:"Critical error, urgent attention needed",sequence:[{at:0,action:"emotion",value:"empathy",intensity:1},{at:100,action:"gesture",value:"shake"},{at:400,action:"gesture",value:"point"}]},warning:{name:"warning",category:"feedback",emotion:"concern",gesture:"pulse",delay:150,baseIntensity:.7,emotionDuration:500,description:"Warning, needs attention"},info:{name:"info",category:"feedback",emotion:"neutral",gesture:"drift",delay:100,baseIntensity:.5,emotionDuration:400,description:"Informational, passive notification"},progress_start:{name:"progress_start",category:"feedback",emotion:"anticipation",gesture:"pulse",delay:100,baseIntensity:.6,emotionDuration:500,description:"Starting a process"},progress_ongoing:{name:"progress_ongoing",category:"feedback",emotion:"focused",gesture:"breathe",delay:0,baseIntensity:.7,emotionDuration:600,description:"Process ongoing, working"},progress_complete:{name:"progress_complete",category:"feedback",emotion:"satisfaction",gesture:"glow",delay:200,baseIntensity:.8,emotionDuration:500,description:"Process completed successfully"},idle:{name:"idle",category:"state",emotion:"neutral",gesture:"drift",delay:0,baseIntensity:.5,emotionDuration:600,description:"System idle, waiting for user"},ready:{name:"ready",category:"state",emotion:"neutral",gesture:"wave",delay:200,baseIntensity:.6,emotionDuration:500,description:"System ready for interaction"},waiting:{name:"waiting",category:"state",emotion:"anticipation",gesture:"pulse",delay:0,baseIntensity:.6,emotionDuration:600,description:"System waiting for process to complete",loop:!0,loopInterval:1500},processing:{name:"processing",category:"state",emotion:"focused",gesture:"breathe",delay:0,baseIntensity:.7,emotionDuration:600,description:"System actively processing",loop:!0,loopInterval:1200},scanning:{name:"scanning",category:"state",emotion:"focused",gesture:"pulse",delay:0,baseIntensity:.75,emotionDuration:500,description:"Scanning or searching",loop:!0,loopInterval:1e3},analyzing:{name:"analyzing",category:"state",emotion:"curiosity",gesture:"drift",delay:0,baseIntensity:.7,emotionDuration:600,description:"Analyzing data or input",loop:!0,loopInterval:1400},completing:{name:"completing",category:"state",emotion:"anticipation",gesture:"pulse",delay:100,baseIntensity:.8,emotionDuration:500,description:"Final step, about to complete"},completed:{name:"completed",category:"state",emotion:"satisfaction",gesture:"glow",delay:200,baseIntensity:.85,emotionDuration:500,description:"Process completed successfully"},reviewing:{name:"reviewing",category:"state",emotion:"satisfaction",gesture:"drift",delay:0,baseIntensity:.65,emotionDuration:600,description:"Reviewing information or results"},monitoring:{name:"monitoring",category:"state",emotion:"focused",gesture:"pulse",delay:0,baseIntensity:.6,emotionDuration:700,description:"Actively monitoring for changes",loop:!0,loopInterval:2e3},paused:{name:"paused",category:"state",emotion:"neutral",gesture:"breathe",delay:200,baseIntensity:.5,emotionDuration:600,description:"System paused, can resume"},loading:{name:"loading",category:"state",emotion:"anticipation",gesture:"pulse",delay:0,baseIntensity:.65,emotionDuration:500,description:"Loading data or content",loop:!0,loopInterval:1100},connecting:{name:"connecting",category:"state",emotion:"anticipation",gesture:"drift",delay:0,baseIntensity:.6,emotionDuration:600,description:"Establishing connection",loop:!0,loopInterval:1300},active:{name:"active",category:"state",emotion:"focused",gesture:"pulse",delay:0,baseIntensity:.75,emotionDuration:500,description:"System actively engaged"}};class Ic{constructor(e={}){this.performances=new Map,this.contextManager=null,this.sequenceExecutor=null,this.eventManager=e.eventManager||null,this.defaultIntensity=e.defaultIntensity||.7,this.enableContextAdjustment=!1!==e.enableContextAdjustment,this.enableAnalytics=e.enableAnalytics||!1,this.performanceHistory=[],this.maxHistorySize=e.maxHistorySize||100,this.loadBuiltInPerformances()}loadBuiltInPerformances(){Object.entries(Cc).forEach(([e,t])=>{this.definePerformance(e,t)})}definePerformance(e,t){this.performances.set(e,{...t,name:e}),this.eventManager&&this.eventManager.emit("performanceDefined",{name:e,definition:t})}getPerformance(e){return this.performances.get(e)||null}hasPerformance(e){return this.performances.has(e)}async perform(e,t={}){const i=this.getPerformance(e);if(!i)return;const a=this.calculateIntensity(i,t),s={performance:i,semanticAction:e,intensity:a,options:t,timestamp:Date.now()};this.enableAnalytics&&this.recordPerformance(s),this.eventManager&&this.eventManager.emit("performanceStart",s);try{this.sequenceExecutor&&i.sequence?await this.sequenceExecutor.execute(i.sequence,{intensity:a,...t}):await this.executeSimplePerformance(i,a,t),this.eventManager&&this.eventManager.emit("performanceComplete",s)}catch(e){this.eventManager&&this.eventManager.emit("performanceError",{...s,error:e})}}async executeSimplePerformance(e,t,i){const{emotion:a,gesture:s,delay:n=0}=e,r=i.mascot||this.mascot;if(r){if(a&&"function"==typeof r.setEmotion){const t=void 0!==i.emotionDuration?i.emotionDuration:e.emotionDuration||500;r.setEmotion(a,t)}s&&"function"==typeof r.express&&(n>0&&await new Promise(e=>setTimeout(e,n)),r.express(s))}}calculateIntensity(e,t){if(void 0!==t.intensity)return Math.max(0,Math.min(1,t.intensity));let i=e.baseIntensity||this.defaultIntensity;if(this.enableContextAdjustment&&t.context){const{context:e}=t;void 0!==e.frustration&&(i+=e.frustration/100*.3),"high"===e.urgency?i+=.2:"medium"===e.urgency&&(i+=.1),"epic"===e.magnitude?i=1:"major"===e.magnitude&&(i=Math.max(i,.9))}return Math.max(0,Math.min(1,i))}recordPerformance(e){this.performanceHistory.push({action:e.semanticAction,intensity:e.intensity,context:e.options.context||{},timestamp:e.timestamp}),this.performanceHistory.length>this.maxHistorySize&&this.performanceHistory.shift()}getAnalytics(){if(!this.enableAnalytics)return{enabled:!1};const e=this.performanceHistory.length,t={},i={};return this.performanceHistory.forEach(e=>{t[e.action]||(t[e.action]=0,i[e.action]=[]),t[e.action]++,i[e.action].push(e.intensity)}),Object.keys(i).forEach(e=>{const t=i[e];i[e]=t.reduce((e,t)=>e+t,0)/t.length}),{enabled:!0,total:e,byAction:t,avgIntensity:i,history:this.performanceHistory.slice(-20)}}clearAnalytics(){this.performanceHistory=[]}setMascot(e){this.mascot=e}setContextManager(e){this.contextManager=e}setSequenceExecutor(e){this.sequenceExecutor=e}listPerformances(){return Array.from(this.performances.keys())}getPerformanceMetadata(e){const t=this.getPerformance(e);return t?{name:t.name,category:t.category||"custom",emotion:t.emotion,gesture:t.gesture,hasSequence:!!t.sequence,baseIntensity:t.baseIntensity||this.defaultIntensity,description:t.description||""}:null}}class zc{constructor(e={}){this.context={frustration:0,urgency:"medium",magnitude:"moderate",customValues:{}},this.enableHistory=!1!==e.enableHistory,this.historyLimit=e.historyLimit||50,this.history=[],this.enableDecay=!1!==e.enableDecay,this.frustrationDecayRate=e.frustrationDecayRate||5,this.decayInterval=e.decayInterval||1e4,this.decayTimer=null,this.enableDecay&&this.startDecayTimer()}update(e={}){const t={...this.context};void 0!==e.frustration&&(this.context.frustration=Math.max(0,Math.min(100,e.frustration))),void 0!==e.urgency&&["low","medium","high"].includes(e.urgency)&&(this.context.urgency=e.urgency),void 0!==e.magnitude&&["small","moderate","major","epic"].includes(e.magnitude)&&(this.context.magnitude=e.magnitude),void 0!==e.custom&&(this.context.customValues={...this.context.customValues,...e.custom}),this.enableHistory&&this.addToHistory(t,this.context,e),this.enableDecay&&this.restartDecayTimer()}incrementFrustration(e=10){this.update({frustration:this.context.frustration+e})}decrementFrustration(e=10){this.update({frustration:this.context.frustration-e})}resetFrustration(){this.update({frustration:0})}setUrgency(e){this.update({urgency:e})}setMagnitude(e){this.update({magnitude:e})}setCustom(e,t){this.update({custom:{[e]:t}})}getContext(){return{...this.context}}get(e){return e in this.context?this.context[e]:this.context.customValues[e]}calculateIntensity(e=.5,t={}){let i=e;return!1!==t.useFrustration&&(i+=this.context.frustration/100*.3),!1!==t.useUrgency&&(i+={low:-.1,medium:0,high:.2}[this.context.urgency]||0),!1!==t.useMagnitude&&(i+={small:-.1,moderate:0,major:.15,epic:.3}[this.context.magnitude]||0),void 0!==t.intensityMultiplier&&(i*=t.intensityMultiplier),Math.max(0,Math.min(1,i))}addToHistory(e,t,i){const a={timestamp:Date.now(),previous:e,current:{...t},updates:i,delta:{frustration:t.frustration-e.frustration,urgency:t.urgency!==e.urgency?t.urgency:null,magnitude:t.magnitude!==e.magnitude?t.magnitude:null}};this.history.push(a),this.history.length>this.historyLimit&&this.history.shift()}getHistory(e){return e?this.history.slice(-e):[...this.history]}clearHistory(){this.history=[]}startDecayTimer(){this.decayTimer=setInterval(()=>{if(this.context.frustration>0){const e=Math.max(0,this.context.frustration-this.frustrationDecayRate);this.update({frustration:e})}},this.decayInterval)}restartDecayTimer(){this.decayTimer&&(clearInterval(this.decayTimer),this.startDecayTimer())}stopDecay(){this.decayTimer&&(clearInterval(this.decayTimer),this.decayTimer=null)}reset(){this.context={frustration:0,urgency:"medium",magnitude:"moderate",customValues:{}},this.enableHistory&&this.addToHistory({},this.context,{action:"reset"})}getAnalytics(){if(!this.enableHistory||0===this.history.length)return null;const e=this.history.map(e=>e.current.frustration),t=e.reduce((e,t)=>e+t,0)/e.length,i=Math.max(...e),a=Math.min(...e),s=this.history.reduce((e,t)=>(e[t.current.urgency]=(e[t.current.urgency]||0)+1,e),{}),n=this.history.reduce((e,t)=>(e[t.current.magnitude]=(e[t.current.magnitude]||0)+1,e),{});return{current:{...this.context},frustration:{current:this.context.frustration,average:t,max:i,min:a},urgency:{current:this.context.urgency,distribution:s},magnitude:{current:this.context.magnitude,distribution:n},historyLength:this.history.length,firstUpdate:this.history[0]?.timestamp,lastUpdate:this.history[this.history.length-1]?.timestamp}}destroy(){this.stopDecay(),this.history=[],this.context=null}}class Fc{constructor(e={}){this.mascot=e.mascot||null,this.eventManager=e.eventManager||null,this.activeSequences=new Map,this.nextSequenceId=1,this.defaultDelay=e.defaultDelay||0,this.allowConcurrent=!1!==e.allowConcurrent}async execute(e,t={}){if(!Array.isArray(e)||0===e.length)return;const i=t.mascot||this.mascot;if(!i)return;!this.allowConcurrent&&this.activeSequences.size>0&&this.cancelAll();const a=this.nextSequenceId++,s=[...e].sort((e,t)=>e.at-t.at),n={cancelled:!1};this.activeSequences.set(a,n);try{this.eventManager&&this.eventManager.emit("sequenceStart",{sequenceId:a,steps:s,timestamp:Date.now()}),await this.executeSteps(s,i,n,t),this.eventManager&&this.eventManager.emit("sequenceComplete",{sequenceId:a,timestamp:Date.now()})}catch(e){this.eventManager&&this.eventManager.emit("sequenceError",{sequenceId:a,error:e,timestamp:Date.now()})}finally{this.activeSequences.delete(a)}}async executeSteps(e,t,i,a){let s=0;for(const n of e){if(i.cancelled)break;const e=n.at-s;if(e>0&&await this.sleep(e,i),i.cancelled)break;await this.executeStep(n,t,a),s=n.at}}executeStep(e,t,i){const{action:a,value:s,intensity:n,options:r}=e;try{switch(a){case"emotion":if("function"==typeof t.setEmotion){const e=void 0!==n?n:i.intensity,a=r?.duration||i.emotionDuration||500;t.setEmotion(s,void 0!==e?e:a)}break;case"gesture":"function"==typeof t.express&&t.express(s,r);break;case"morph":"function"==typeof t.morphTo&&t.morphTo(s,r);break;case"chain":"function"==typeof t.chain&&t.chain(s,r);break;case"sound":"function"==typeof t.playSound&&t.playSound(s,r)}this.eventManager&&this.eventManager.emit("stepExecuted",{action:a,value:s,timestamp:Date.now()})}catch(e){}}sleep(e,t){return new Promise(i=>{const a=setTimeout(()=>{i()},e);if(t){const s=setInterval(()=>{t.cancelled&&(clearTimeout(a),clearInterval(s),i())},50);setTimeout(()=>{clearInterval(s)},e)}})}cancel(e){const t=this.activeSequences.get(e);t&&(t.cancelled=!0,this.activeSequences.delete(e),this.eventManager&&this.eventManager.emit("sequenceCancelled",{sequenceId:e,timestamp:Date.now()}))}cancelAll(){this.activeSequences.forEach((e,t)=>{e.cancelled=!0,this.eventManager&&this.eventManager.emit("sequenceCancelled",{sequenceId:t,timestamp:Date.now()})}),this.activeSequences.clear()}getActiveCount(){return this.activeSequences.size}isActive(){return this.activeSequences.size>0}setMascot(e){this.mascot=e}}let Dc=class{constructor(e){if(!e.errorBoundary)throw new Error("GestureController: errorBoundary required");if(!e.config)throw new Error("GestureController: config required");if(!e.state)throw new Error("GestureController: state required");if(!e.throttledWarn)throw new Error("GestureController: throttledWarn required");this.errorBoundary=e.errorBoundary,this.renderer=e.renderer||null,this.performanceMonitor=e.performanceMonitor||null,this.soundSystem=e.soundSystem||null,this.config=e.config,this.Ne=e.state,this.Je=e.throttledWarn,this.Ze=e.chainTarget||this,this.currentGesture=null,this.gestureCompatibility=null,this.rendererMethods={bounce:"startBounce",pulse:"startPulse",shake:"startShake",spin:"startSpin",nod:"startNod",tilt:"startTilt",expand:"startExpand",contract:"startContract",flash:"startFlash",drift:"startDrift",stretch:"startStretch",glow:"startGlow",sparkle:"startSparkle",shimmer:"startShimmer",wiggle:"startWiggle",groove:"startGroove",point:"startPoint",lean:"startLean",reach:"startReach",headBob:"startHeadBob",orbit:"startOrbit",flicker:"startFlicker",vibrate:"startVibrate",wave:"startWave",breathe:"startBreathe",morph:"startMorph",slowBlink:"startSlowBlink",look:"startLook",settle:"startSettle",orbital:"startOrbital",hula:"startHula",sway:"startSway",breathIn:"startBreathIn",breathOut:"startBreathOut",breathHold:"startBreathHold",breathHoldEmpty:"startBreathHoldEmpty",jump:"startJump",rain:"startRain",runningman:"startRunningMan",charleston:"startCharleston",grooveSway:"startGrooveSway",grooveBob:"startGrooveBob",grooveFlow:"startGrooveFlow",groovePulse:"startGroovePulse",grooveStep:"startGrooveStep",float:"startFloat",twist:"startTwist"}}init(){this.gestureCompatibility||Promise.resolve().then(function(){return Oc}).then(e=>{this.gestureCompatibility=e.default}).catch(e=>{})}express(e,t={}){return this.errorBoundary.wrap(()=>{if(!e)return this.Ze;const i=performance.now(),a=Array.isArray(e)||"object"==typeof e&&"chord"===e.type?"chord":e;if(this.performanceMonitor&&this.performanceMonitor.markGestureStart(a),Array.isArray(e))return this.expressChord(e,t);if("object"==typeof e&&"chord"===e.type)return this.expressChord(e.gestures,t);const s=this.rendererMethods[e];if(s&&this.renderer&&this.renderer[s]){if(this.renderer[s](t),this.config.soundEnabled&&this.soundSystem&&this.soundSystem.isAvailable()&&this.soundSystem.playGestureSound(e),this.performanceMonitor){const e=performance.now();this.performanceMonitor.markGestureEnd(a),this.performanceMonitor.recordGestureTime(a,e-i)}return this.Ze}const n=_r(e);if(n){if(dl.registerConfig("gesture",e,n),this.Ne.currentModularGesture={type:e,config:n,startTime:performance.now(),duration:n.defaultParams?.duration||1e3,progress:0},this.config.soundEnabled&&this.soundSystem&&this.soundSystem.isAvailable()&&this.soundSystem.playGestureSound(e),this.performanceMonitor){const e=performance.now();this.performanceMonitor.markGestureEnd(a),this.performanceMonitor.recordGestureTime(a,e-i)}return this.Ze}return this.Je(`Unknown gesture: ${e}`,`gesture_${e}`),this.performanceMonitor&&this.performanceMonitor.markGestureEnd(a),this.Ze},"gesture-express",this.Ze)()}expressChord(e,t={}){return this.errorBoundary.wrap(()=>{if(!e||!Array.isArray(e)||0===e.length)return this.Ze;this.gestureCompatibility||Promise.resolve().then(function(){return Oc}).then(e=>{this.gestureCompatibility=e.default}).catch(e=>{});const i=this.gestureCompatibility?this.gestureCompatibility.getCompatibleGestures(e):e;return i.forEach(e=>{const i="string"==typeof e?e:e.gestureName;this.executeGestureDirectly(i,t)}),this.gestureCompatibility?.isEnhancingCombination?.(i)&&this.renderer?.specialEffects?.addSparkle?.(),this.Ze},"gesture-chord",this.Ze)()}executeGestureDirectly(e,t={}){const i=this.rendererMethods[e];i&&this.renderer&&"function"==typeof this.renderer[i]&&this.renderer[i](t)}chain(...e){if(this.gestureCompatibility){const t=e.join(">"),i=this.gestureCompatibility.parseChain(t);this.executeChainSequence(i)}else e.length>0&&this.express(e[0]);return this.Ze}executeChainSequence(e){if(!e||0===e.length)return;let t=0;const i=()=>{if(t>=e.length)return;const a=e[t];1===a.length?this.express(a[0]):this.expressChord(a),t++,t<e.length&&setTimeout(i,800)};i()}destroy(){this.currentGesture=null,this.gestureCompatibility=null}};class qc{constructor(e={}){const t=e.initialState||{};this.Ke=t.isRunning??!1,this.et=t.debugMode??!1,this.tt=t.speaking??!1,this.it=t.recording??!1,this.st=t.audioLevel??0,this.nt=t.sleeping??!1,this.rt=t.rhythmEnabled??!1,this.ot=t.currentModularGesture??null,this.lt=t.breathePhase??"idle",this.ht=t.breatheStartTime??0,this.ct=t.orbScale??1,this.ut=t.warningTimestamps??{},this.dt=t.warningThrottle??5e3,this.gt=e.emit||(()=>{})}get isRunning(){return this.Ke}set isRunning(e){const t=this.Ke!==e;this.Ke=e,t&&this.gt("stateChange",{property:"isRunning",value:e})}get debugMode(){return this.et}set debugMode(e){const t=this.et!==e;this.et=e,t&&this.gt("stateChange",{property:"debugMode",value:e})}get speaking(){return this.tt}set speaking(e){const t=this.tt!==e;this.tt=e,t&&this.gt("stateChange",{property:"speaking",value:e})}get recording(){return this.it}set recording(e){const t=this.it!==e;this.it=e,t&&this.gt("stateChange",{property:"recording",value:e})}get audioLevel(){return this.st}set audioLevel(e){this.st=e}get sleeping(){return this.nt}set sleeping(e){const t=this.nt!==e;this.nt=e,t&&this.gt("stateChange",{property:"sleeping",value:e})}get rhythmEnabled(){return this.rt}set rhythmEnabled(e){this.rt=e}get currentModularGesture(){return this.ot}set currentModularGesture(e){this.ot=e}get breathePhase(){return this.lt}set breathePhase(e){this.lt=e}get breatheStartTime(){return this.ht}set breatheStartTime(e){this.ht=e}get orbScale(){return this.ct}set orbScale(e){this.ct=e}get warningTimestamps(){return this.ut}set warningTimestamps(e){this.ut=e}get warningThrottle(){return this.dt}set warningThrottle(e){this.dt=e}getSnapshot(){return{isRunning:this.Ke,debugMode:this.et,speaking:this.tt,recording:this.it,audioLevel:this.st,sleeping:this.nt,rhythmEnabled:this.rt,currentModularGesture:this.ot,breathePhase:this.lt,breatheStartTime:this.ht,orbScale:this.ct}}reset(){this.Ke=!1,this.et=!1,this.tt=!1,this.it=!1,this.st=0,this.nt=!1,this.rt=!1,this.ot=null,this.lt="idle",this.ht=0,this.ct=1,this.ut={}}}class Rc{constructor(e){if(!e.config)throw new Error("AudioHandler: config required");if(!e.state)throw new Error("AudioHandler: state required");if(!e.emit)throw new Error("AudioHandler: emit required");this.audioAnalyzer=e.audioAnalyzer||null,this.audioLevelProcessor=e.audioLevelProcessor||null,this.shapeMorpher=e.shapeMorpher||null,this.renderer=e.renderer||null,this.soundSystem=e.soundSystem||null,this.stateMachine=e.stateMachine||null,this.config=e.config,this.Ne=e.state,this.gt=e.emit,this.Ze=e.chainTarget||this,this.vocalUpdateInterval=null}init(){}disconnectAudio(){return this.audioAnalyzer&&this.audioAnalyzer.stop(),this.vocalUpdateInterval&&(clearInterval(this.vocalUpdateInterval),this.vocalUpdateInterval=null),this.shapeMorpher&&(this.shapeMorpher.setVocalEnergy(0),this.shapeMorpher.setAudioDeformation(0),this.shapeMorpher.audioAnalyzer=null,this.shapeMorpher.beatGlitchIntensity=0,this.shapeMorpher.glitchPoints=[]),this.renderer&&this.renderer.ambientDanceAnimator.stopAmbientAnimation("grooveBob"),this.Ze}async connectAudio(e){if(!this.audioAnalyzer)return this.Ze;if(!this.audioAnalyzer.audioContext)try{await this.audioAnalyzer.init()}catch(e){return this.Ze}if(this.audioAnalyzer.audioContext&&"suspended"===this.audioAnalyzer.audioContext.state)try{await this.audioAnalyzer.audioContext.resume()}catch(e){}return this.audioAnalyzer.connectAudioElement(e),this.shapeMorpher&&(this.shapeMorpher.audioAnalyzer=this.audioAnalyzer,this.audioAnalyzer.onBeat(e=>{if(this.shapeMorpher){if(this.shapeMorpher.musicDetector){const t=performance.now();this.shapeMorpher.musicDetector.addOnset(t,e)}this.shapeMorpher.vocalEffectActive&&(this.shapeMorpher.beatGlitchIntensity=.3*e)}})),this.vocalUpdateInterval&&clearInterval(this.vocalUpdateInterval),this.renderer&&this.renderer.startGrooveBob({intensity:.5,frequency:1}),this.vocalUpdateInterval=setInterval(()=>{if(this.audioAnalyzer.isAnalyzing&&this.shapeMorpher){const e=this.audioAnalyzer.currentAmplitude||0,t=this.audioAnalyzer.getVocalInstability()||0;this.shapeMorpher.setVocalEnergy(t),this.shapeMorpher.setAudioDeformation(2*e)}},50),this.renderer&&(this.renderer.audioAnalyzer=this.audioAnalyzer),this.Ze}stopSpeaking(){if(!this.Ne.speaking)return this.Ze;const e=this.audioLevelProcessor.getCurrentLevel();return this.audioLevelProcessor.cleanup(),this.Ne.speaking=!1,this.renderer.onSpeechStop(),this.gt("speechStopped",{previousAudioLevel:e,returnToBaseTime:500}),this.Ze}setVolume(e){const t=Math.max(0,Math.min(1,e));if(this.config.masterVolume=t,this.soundSystem&&this.soundSystem.isAvailable()){const e=this.stateMachine.getCurrentState().emotion;this.soundSystem.setMasterVolume(t,e)}return this.gt("volumeChanged",{volume:t}),this.Ze}destroy(){this.disconnectAudio()}}class Bc{constructor(e,t={}){this.yt=e,this.ft=t.decayRate??.02,this.bt=t.decayFloor??0,this.wt=t.accumulationCap??1,this.vt=t.enabled??!1,this.Mt=!1,this.St=[],this.xt=[]}update(e){if(!this.vt||this.Mt)return;const t=this.yt.getSlots(),i=this.ft*e;for(const e of t){if(e.intensity<=this.bt)continue;const t=e.intensity;if(e.intensity=Math.max(this.bt,e.intensity-i),e.intensity!==t){for(const i of this.St)i(e.emotion,e.intensity,t);this.yt.S("emotionDecayed",{emotion:e.emotion,intensity:e.intensity,removed:!1}),this.yt.S("slotChanged",{emotion:e.emotion,intensity:e.intensity,action:"decay"})}}this.yt.pruneEmptySlots()}nudge(e,t){this.yt.nudgeEmotion(e,t,this.wt);for(const i of this.xt)i(e,t)}setDecayRate(e){this.ft=Math.max(0,e)}getDecayRate(){return this.ft}setAccumulationCap(e){this.wt=Math.max(0,Math.min(1,e))}enable(){this.vt=!0}disable(){this.vt=!1}isEnabled(){return this.vt}pause(){this.Mt=!0}resume(){this.Mt=!1}reset(){this.yt.clearEmotions()}onDecay(e){return this.St.push(e),()=>{this.St=this.St.filter(t=>t!==e)}}onNudge(e){return this.xt.push(e),()=>{this.xt=this.xt.filter(t=>t!==e)}}destroy(){this.St.length=0,this.xt.length=0}}class Ec{constructor(e){if(!e.stateMachine)throw new Error("StateCoordinator: stateMachine required");if(!e.config)throw new Error("StateCoordinator: config required");if(!e.emit)throw new Error("StateCoordinator: emit required");this.stateMachine=e.stateMachine,this.particleSystem=e.particleSystem||null,this.canvasManager=e.canvasManager||null,this.renderer=e.renderer||null,this.config=e.config,this.soundSystem=e.soundSystem||null,this.gt=e.emit,this.Ze=e.chainTarget||this,this.currentEmotion="neutral",this.emotionIntensity=1,this.stateMachine.setEventCallback&&this.stateMachine.setEventCallback((e,t)=>{this.gt(e,t)}),this.kt=null}init(){}setEmotion(e,t=null){const i={happy:"joy",curious:"surprise",frustrated:"anger",sad:"sadness"}[e]||e;let a=null,s=500,n=1;if("string"==typeof t?a=t:t&&"object"==typeof t&&(a=t.undertone||null,s=t.duration||500,n=t.intensity??1),this.emotionIntensity=n,this.stateMachine.setEmotion(i,{undertone:a,duration:s,intensity:n})){const e=h(i);if(e&&dl.registerConfig("emotion",i,e),this.particleSystem){this.particleSystem.clear();const e=this.stateMachine.getCurrentEmotionalProperties();let t;if(t="neutral"===i?1:"resting"===i?4:Math.min(3,Math.floor(e.particleRate/4)),t>0){let i,a;if(this.renderer&&"function"==typeof this.renderer.getEffectiveCenter){const e=this.renderer.getEffectiveCenter();i=e.x,a=e.y}else i=this.canvasManager.width/2,a=this.canvasManager.height/2;this.particleSystem.burst(t,e.particleBehavior,i,a)}}if("classic"===this.config.renderingStyle&&this.renderer.setEmotionalState){const e=c(i);this.renderer.setEmotionalState(i,e,a)}this.gt("emotionChanged",{emotion:i,undertone:a,duration:s})}return this.currentEmotion=i,this.Ze}pushEmotion(e,t=.5){const i={happy:"joy",curious:"surprise",frustrated:"anger",sad:"sadness"}[e]||e;this.stateMachine.pushEmotion(i,t);const a=this.stateMachine.getDominant();return a&&(this.currentEmotion=a.emotion),this.gt("emotionChanged",{emotion:this.currentEmotion,slots:this.stateMachine.getSlots()}),this.Ze}nudgeEmotion(e,t,i=1){const a={happy:"joy",curious:"surprise",frustrated:"anger",sad:"sadness"}[e]||e;this.stateMachine.nudgeEmotion(a,t,i);const s=this.stateMachine.getDominant();return s&&(this.currentEmotion=s.emotion),this.Ze}clearEmotions(){return this.stateMachine.clearEmotions(),this.currentEmotion="neutral",this.gt("emotionChanged",{emotion:"neutral",slots:[]}),this.Ze}getEmotionalState(){return this.stateMachine.getEmotionalState()}get dynamics(){return this.kt||(this.kt=new Bc(this.stateMachine)),this.kt}setEmotionDampening(e){return this.stateMachine.setEmotionDampening(e),this.Ze}getEmotionDampening(){return this.stateMachine.getEmotionDampening()}destroy(){this.kt&&this.kt.destroy(),this.currentEmotion="neutral"}}class Pc{constructor(e){if(!e.animationController)throw new Error("VisualizationRunner: animationController required");if(!e.stateMachine)throw new Error("VisualizationRunner: stateMachine required");if(!e.config)throw new Error("VisualizationRunner: config required");if(!e.state)throw new Error("VisualizationRunner: state required");if(!e.emit)throw new Error("VisualizationRunner: emit required");this.animationController=e.animationController,this.stateMachine=e.stateMachine,this.particleSystem=e.particleSystem||null,this.canvasManager=e.canvasManager||null,this.renderer=e.renderer||null,this.audioHandler=e.audioHandler||null,this.audioLevelProcessor=e.audioLevelProcessor||null,this.gazeTracker=e.gazeTracker||null,this.idleBehavior=e.idleBehavior||null,this.degradationManager=e.degradationManager||null,this.pluginSystem=e.pluginSystem||null,this.config=e.config,this.canvas=e.canvas||null,this.Ne=e.state,this.gt=e.emit,this.Ze=e.chainTarget||this,this.animationId=null,this.isRunning=!1,this.lastTime=0}init(){}start(){if(this.animationController.isAnimating())return this.Ze;if(this.animationController.start()){if(this.Ne.isRunning=!0,this.isRunning=!0,"classic"===this.config.renderingStyle&&this.particleSystem){const e=this.stateMachine.getCurrentState(),{emotion:t}=e,i=c(t);let a,s;if(this.renderer&&this.renderer.getCurrentOrbPosition){const e=this.renderer.getCurrentOrbPosition();a=e.x,s=e.y}else a=this.canvasManager.width/2,s=this.canvasManager.height/2;if(this.particleSystem.clear(),i.particleRate>0){const e=Math.min(3,Math.floor(i.particleRate/4));e>0&&this.particleSystem.burst(e,i.particleBehavior,a,s)}}this.degradationManager&&this.degradationManager.startMonitoring(),this.gt("started")}return this.Ze}stop(){return this.animationController.isAnimating()?(this.Ne.speaking&&this.audioHandler&&this.audioHandler.stopSpeaking(),this.animationController.stop()&&(this.Ne.isRunning=!1,this.isRunning=!1,this.degradationManager&&this.degradationManager.stopMonitoring(),this.gt("stopped")),this.Ze):this.Ze}update(e){if(this.Ne.speaking&&this.audioLevelProcessor&&this.audioLevelProcessor.isProcessingActive()&&this.audioLevelProcessor.updateAudioLevel(e),"classic"===this.config.renderingStyle){if(this.gazeTracker&&(this.gazeTracker.update(e),"suspicion"===this.stateMachine.getCurrentState().emotion)){const{mousePos:e}=this.gazeTracker,t=this.canvas.width/2,i=this.canvas.height/2,a=Math.sqrt(Math.pow(e.x-t,2)+Math.pow(e.y-i,2)),s=h("suspicion");if(s&&s.visual){const e=Math.min(t,i),n=Math.max(0,Math.min(1,1-a/e));s.visual.threatLevel=n}}if(this.idleBehavior&&this.idleBehavior.update(e),this.gazeTracker&&this.idleBehavior){const e=this.gazeTracker.getGazeOffset(),t=this.idleBehavior.getSwayOffset(),i=this.gazeTracker.getState(),a={offset:{x:e.x+t.x,y:e.y+t.y},proximity:i.proximity,isFocused:i.isFocused};this.renderer&&this.renderer.setGazeData&&this.renderer.setGazeData(a)}}if(this.pluginSystem){const t=this.stateMachine.getCurrentState();this.pluginSystem.update(e,t)}}destroy(){this.stop()}}class Tc{constructor(e){if(!e.errorBoundary)throw new Error("ExecutionLifecycleManager: errorBoundary required");if(!e.animationController)throw new Error("ExecutionLifecycleManager: animationController required");if(!e.visualizationRunner)throw new Error("ExecutionLifecycleManager: visualizationRunner required");if(!e.state)throw new Error("ExecutionLifecycleManager: state required");if(!e.emit)throw new Error("ExecutionLifecycleManager: emit required");this.errorBoundary=e.errorBoundary,this.animationController=e.animationController,this.visualizationRunner=e.visualizationRunner,this.soundSystem=e.soundSystem||null,this.Ne=e.state,this.gt=e.emit,this.Ze=e.chainTarget||this}start(){return this.errorBoundary.wrap(()=>this.visualizationRunner.start(),"start",this.Ze)()}stop(){return this.errorBoundary.wrap(()=>this.visualizationRunner.stop(),"stop",this.Ze)()}pause(){return this.errorBoundary.wrap(()=>this.animationController.isAnimating()?(this.animationController.stop(),this.Ne.isRunning=!1,this.soundSystem&&this.soundSystem.isAvailable()&&this.soundSystem.stopAmbientTone(200),this.gt("paused"),this.Ze):this.Ze,"pause",this.Ze)()}resume(){return this.errorBoundary.wrap(()=>(this.animationController.isAnimating()||(this.animationController.start(),this.Ne.isRunning=!0,this.gt("resumed")),this.Ze),"resume",this.Ze)()}isActive(){return this.animationController.isAnimating()}}class jc{constructor(e){if(!e.errorBoundary)throw new Error("AnimationFrameController: errorBoundary required");if(!e.animationController)throw new Error("AnimationFrameController: animationController required");if(!e.config)throw new Error("AnimationFrameController: config required");if(!e.emit)throw new Error("AnimationFrameController: emit required");this.errorBoundary=e.errorBoundary,this.animationController=e.animationController,this.positionController=e.positionController||null,this.config=e.config,this.gt=e.emit,this.Ze=e.chainTarget||this}setTargetFPS(e){const t=Math.max(15,Math.min(120,e));return this.config.targetFPS=t,this.animationController.setTargetFPS(t),this.gt("targetFPSChanged",{targetFPS:t}),this.Ze}getTargetFPS(){return this.animationController.targetFPS}setPosition(e,t,i=0){return this.positionController&&(this.positionController.onUpdate||(this.positionController.onUpdate=()=>{}),this.positionController.setOffset(e,t,i)),this.Ze}animateToPosition(e,t,i=0,a=1e3,s="easeOutCubic"){return this.positionController&&(this.positionController.onUpdate||(this.positionController.onUpdate=()=>{}),this.positionController.animateOffset(e,t,i,a,s)),this.Ze}getPosition(){return this.errorBoundary.wrap(()=>{if(!this.positionController||"function"!=typeof this.positionController.getPosition)return null;const e="undefined"!=typeof window,t=e?window.innerWidth/2:0,i=e?window.innerHeight/2:0;return this.positionController.getPosition(t,i)},"get-position",this.Ze)()}}class Vc{constructor(e){if(!e.errorBoundary)throw new Error("ShapeTransformManager: errorBoundary required");if(!e.emit)throw new Error("ShapeTransformManager: emit required");this.errorBoundary=e.errorBoundary,this.renderer=e.renderer||null,this.shapeMorpher=e.shapeMorpher||null,this.gt=e.emit,this.Ze=e.chainTarget||this}morphTo(e,t={}){return this.errorBoundary.wrap(()=>this.shapeMorpher?(this.shapeMorpher.morphTo(e,t),this.renderer&&(this.renderer.shapeMorpher=this.shapeMorpher),this.gt("shapeMorphStarted",{from:this.shapeMorpher.currentShape,to:e}),this.Ze):this.Ze,"morphTo",this.Ze)()}setBackdrop(e={}){return this.errorBoundary.wrap(()=>(this.renderer&&this.renderer.backdropRenderer&&this.renderer.backdropRenderer.setConfig(e),this.Ze),"setBackdrop",this.Ze)()}getBackdrop(){return this.errorBoundary.wrap(()=>this.renderer&&this.renderer.backdropRenderer?this.renderer.backdropRenderer.getConfig():null,"getBackdrop",this.Ze)()}}class $c{constructor(e){if(!e.errorBoundary)throw new Error("EventListenerManager: errorBoundary required");if(!e.eventManager)throw new Error("EventListenerManager: eventManager required");this.errorBoundary=e.errorBoundary,this.eventManager=e.eventManager,this.Ze=e.chainTarget||this}on(e,t){return this.errorBoundary.wrap(()=>(this.eventManager.on(e,t),this.Ze),"event-listener-add",this.Ze)()}off(e,t){return this.errorBoundary.wrap(()=>(this.eventManager.off(e,t),this.Ze),"event-listener-remove",this.Ze)()}once(e,t){return this.errorBoundary.wrap(()=>(this.eventManager.once(e,t),this.Ze),"event-listener-once",this.Ze)()}removeAllListeners(e=null){return this.errorBoundary.wrap(()=>(this.eventManager.removeAllListeners(e),this.Ze),"event-listeners-clear",this.Ze)()}listenerCount(e){return this.eventManager.listenerCount(e)}getEventNames(){return this.eventManager.getEventNames()}getEventStats(){return this.eventManager.getEventStats()}getEventDebugInfo(){return this.eventManager.getDebugInfo()}emit(e,t=null){this.eventManager.emit(e,t)}}class Wc{constructor(e){if(!e.tts)throw new Error("TTSManager: tts required");if(!e.state)throw new Error("TTSManager: state required");this.speechManager=e.speechManager||null,this.renderer=e.renderer||null,this.tts=e.tts,this.Ne=e.state,this.Ze=e.chainTarget||this}getTTSVoices(){return this.tts.available?window.speechSynthesis.getVoices():[]}isTTSSpeaking(){return this.tts.speaking}speak(e,t={}){return this.speechManager?this.speechManager.speak(e,t):this.Ze}setTTSSpeaking(e){this.Ne.ttsSpeaking=e,this.renderer&&this.renderer.startSpeaking&&(e?this.renderer.startSpeaking():this.renderer.stopSpeaking()),this.Ne.speaking=e}getVoices(){return window.speechSynthesis?window.speechSynthesis.getVoices():[]}stopTTS(){window.speechSynthesis&&(window.speechSynthesis.cancel(),this.setTTSSpeaking(!1))}}class Gc{constructor(e){if(!e.errorBoundary)throw new Error("SpeechReactivityManager: errorBoundary required");if(!e.audioLevelProcessor)throw new Error("SpeechReactivityManager: audioLevelProcessor required");if(!e.state)throw new Error("SpeechReactivityManager: state required");if(!e.emit)throw new Error("SpeechReactivityManager: emit required");this.errorBoundary=e.errorBoundary,this.audioLevelProcessor=e.audioLevelProcessor,this.Ne=e.state,this.gt=e.emit,this.Ze=e.chainTarget||this}connectAudioSource(e){return this.errorBoundary.wrap(()=>this.Ne.audioAnalyser&&e&&"function"==typeof e.connect?(e.connect(this.Ne.audioAnalyser),this.gt("audioSourceConnected",{audioSource:e}),this.Ze):this.Ze,"audio-source-connection",this.Ze)()}getAudioLevel(){return this.Ne.speaking?this.Ne.audioLevel:0}isSpeaking(){return this.Ne.speaking}setAudioSmoothing(e){return this.errorBoundary.wrap(()=>{const t=Math.max(0,Math.min(1,e));return this.Ne.audioAnalyser&&(this.Ne.audioAnalyser.smoothingTimeConstant=t),this.Ze},"audio-smoothing",this.Ze)()}getAudioStats(){return this.audioLevelProcessor.getStats()}updateAudioConfig(e){this.audioLevelProcessor.updateConfig(e)}}class Lc{constructor(e){if(!e.emit)throw new Error("CanvasResizeManager: emit required");this.renderer=e.renderer||null,this.stateMachine=e.stateMachine||null,this.particleSystem=e.particleSystem||null,this.gt=e.emit,this.Ze=e.chainTarget||this}handleResize(e,t,i){if(this.renderer&&this.renderer.initOffscreenCanvas&&this.renderer.initOffscreenCanvas(),this.stateMachine){const{currentEmotion:e}=this.stateMachine,{currentUndertone:t}=this.stateMachine;e&&this.stateMachine.setEmotion(e),t&&"none"!==t&&this.stateMachine.setUndertone(t)}this.gt("resize",{width:e,height:t,dpr:i})}clearParticles(){return this.particleSystem&&this.particleSystem.clear(),this.Ze}setParticleSystemCanvasDimensions(e,t){return this.particleSystem&&(this.particleSystem.canvasWidth=e,this.particleSystem.canvasHeight=t),this.Ze}}class _c{constructor(e){if(!e.errorBoundary)throw new Error("OffsetPositionManager: errorBoundary required");if(!e.positionController)throw new Error("OffsetPositionManager: positionController required");this.errorBoundary=e.errorBoundary,this.positionController=e.positionController,this.Ze=e.chainTarget||this}setOffset(e,t,i=0){return this.errorBoundary.wrap(()=>(this.positionController.setOffset(e,t,i),this.Ze),"offset-setting",this.Ze)()}getOffset(){return this.errorBoundary.wrap(()=>this.positionController.getOffset(),"offset-getting",this.Ze)()}animateOffset(e,t,i=0,a=1e3,s="easeOutCubic"){return this.errorBoundary.wrap(()=>(this.positionController.animateOffset(e,t,i,a,s),this.Ze),"offset-animation",this.Ze)()}}class Hc{constructor(e){if(!e.canvasResizeManager)throw new Error("VisualTransformationManager: canvasResizeManager required");if(!e.offsetPositionManager)throw new Error("VisualTransformationManager: offsetPositionManager required");if(!e.shapeTransformManager)throw new Error("VisualTransformationManager: shapeTransformManager required");this.canvasResizeManager=e.canvasResizeManager,this.offsetPositionManager=e.offsetPositionManager,this.shapeTransformManager=e.shapeTransformManager,this.Ze=e.chainTarget||this}setOffset(e,t,i=0){return this.offsetPositionManager.setOffset(e,t,i)}getOffset(){return this.offsetPositionManager.getOffset()}animateOffset(e,t,i=0,a=1e3,s="easeOutCubic"){return this.offsetPositionManager.animateOffset(e,t,i,a,s)}morphTo(e,t={}){return this.shapeTransformManager.morphTo(e,t)}setBackdrop(e={}){return this.shapeTransformManager.setBackdrop(e)}getBackdrop(){return this.shapeTransformManager.getBackdrop()}handleResize(e,t,i){this.canvasResizeManager.handleResize(e,t,i)}clearParticles(){return this.canvasResizeManager.clearParticles()}setParticleSystemCanvasDimensions(e,t){return this.canvasResizeManager.setParticleSystemCanvasDimensions(e,t)}}class Uc{constructor(e){if(!e.errorBoundary)throw new Error("FrustrationContextManager: errorBoundary required");if(!e.contextManager)throw new Error("FrustrationContextManager: contextManager required");this.errorBoundary=e.errorBoundary,this.contextManager=e.contextManager,this.Ze=e.chainTarget||this}updateContext(e){return this.errorBoundary.wrap(()=>this.contextManager?(this.contextManager.update(e),this.Ze):this.Ze,"context-update",this.Ze)()}incrementFrustration(e=10){return this.errorBoundary.wrap(()=>this.contextManager?(this.contextManager.incrementFrustration(e),this.Ze):this.Ze,"frustration-increment",this.Ze)()}decrementFrustration(e=10){return this.errorBoundary.wrap(()=>this.contextManager?(this.contextManager.decrementFrustration(e),this.Ze):this.Ze,"frustration-decrement",this.Ze)()}resetFrustration(){return this.errorBoundary.wrap(()=>this.contextManager?(this.contextManager.resetFrustration(),this.Ze):this.Ze,"frustration-reset",this.Ze)()}}class Qc{constructor(e,t={}){if(!e)throw new Error("LLMResponseHandler requires a mascot instance");this.mascot=e,this.config={autoMorphShapes:!0,morphDuration:1e3,autoExpressGestures:!0,gestureTiming:300,gestureIntensity:.7,useFallbackGestures:!0,useSemanticPerformances:!0,enableContextTracking:!0,emotionToShapeMap:{},actionToGestureMap:{},...t},this.schema={message:"string",emotion:["joy","empathy","calm","excitement","concern","neutral","triumph","love","curiosity"],sentiment:["positive","neutral","negative"],action:["none","offer_help","celebrate","guide","reassure","greet","confirm","deny","emphasize","question","think","listen","respond"],frustrationLevel:"number",shape:["circle","heart","star","sun","moon","eclipse","solar","lunar","square","triangle","suspicion"],gesture:["bounce","pulse","shake","spin","drift","nod","tilt","expand","contract","flash","stretch","glow","flicker","vibrate","wave","morph","jump","orbital","hula","scan","twist","burst","directional","settle","fade","hold","breathe","peek","sparkle","shimmer","wiggle","groove","point","lean","reach","headBob","rain","twitch","sway","float","jitter","orbit"]},this.defaultShapeMap={joy:"star",love:"heart",empathy:"heart",excitement:"sun",calm:"moon",concern:"circle",triumph:"star",curiosity:"circle",neutral:"circle"},this.defaultGestureMap={offer_help:"reach",celebrate:"sparkle",guide:"point",reassure:"nod",greet:"wave",confirm:"nod",deny:"shake",emphasize:"pulse",question:"tilt",think:"orbit",listen:"settle",respond:"bounce"},this.semanticActionMap={offer_help:"offering_help",celebrate:"celebrating",guide:"guiding",reassure:"reassuring",greet:"greeting",confirm:"confirming",deny:"denying",emphasize:"emphasizing",question:"questioning",think:"thinking",listen:"listening",respond:"responding"}}async handle(e,t={}){try{t.skipValidation||this.validateResponse(e);const{emotion:i="neutral",sentiment:a="neutral",action:s="none",shape:n,gesture:r,frustrationLevel:o=0}=e,l=void 0!==t.intensity?t.intensity:this.calculateIntensity(o,a);if(this.config.enableContextTracking&&this.mascot.updateContext&&this.mascot.updateContext({frustration:o,sentiment:a}),this.config.useSemanticPerformances&&this.mascot.perform&&this.semanticActionMap[s]){const e=this.semanticActionMap[s];try{return await this.mascot.perform(e,{context:{frustration:o,sentiment:a,urgency:o>60?"high":o>30?"medium":"low"},intensity:l}),n&&this.config.autoMorphShapes&&await this.morphToShape(n),this.mascot}catch{}}return await this.choreographResponse(i,s,n,r,l),this.mascot}catch(e){return this.mascot}}async choreographResponse(e,t,i,a,s){if(this.mascot.setEmotion(e,s),this.config.autoMorphShapes){const a=i||this.getShapeForEmotion(e,t);a&&await this.morphToShape(a)}if(this.config.autoExpressGestures){const e=a||this.getGestureForAction(t);e&&(await this.delay(this.config.gestureTiming),this.mascot.express(e,{intensity:this.config.gestureIntensity}))}}calculateIntensity(e,t){let i=.5;return i+=e/100*.3,"positive"===t?i+=.2:"negative"===t&&(i+=.3),Math.max(.3,Math.min(1,i))}getShapeForEmotion(e,t){return this.config.emotionToShapeMap[e]?this.config.emotionToShapeMap[e]:"celebrate"===t?"star":"greet"===t?"sun":this.defaultShapeMap[e]||null}getGestureForAction(e){return this.config.useFallbackGestures?this.config.actionToGestureMap[e]?this.config.actionToGestureMap[e]:this.defaultGestureMap[e]||null:null}morphToShape(e){e&&"circle"!==e&&this.mascot.morphTo&&this.mascot.morphTo(e,{duration:this.config.morphDuration})}validateResponse(e){if(!e||"object"!=typeof e)throw new Error("LLM response must be an object");if(e.emotion&&this.schema.emotion.includes(e.emotion),e.sentiment&&this.schema.sentiment.includes(e.sentiment),e.action&&this.schema.action.includes(e.action),e.shape&&this.schema.shape.includes(e.shape),e.gesture&&this.schema.gesture.includes(e.gesture),void 0!==e.frustrationLevel){const t=Number(e.frustrationLevel);isNaN(t)}}getSchema(){return{...this.schema}}configure(e){return Object.assign(this.config,e),this}delay(e){return new Promise(t=>setTimeout(t,e))}static getAvailableEmotions(){return["joy","empathy","calm","excitement","concern","neutral","triumph","love","curiosity"]}static getAvailableActions(){return["none","offer_help","celebrate","guide","reassure","greet","confirm","deny","emphasize","question","think","listen","respond"]}static getAvailableShapes(){return["circle","heart","star","sun","moon","eclipse","solar","lunar","square","triangle","suspicion"]}static getAvailableGestures(){return["bounce","pulse","shake","spin","drift","nod","tilt","expand","contract","flash","stretch","glow","flicker","vibrate","wave","morph","jump","orbital","hula","scan","twist","burst","directional","settle","fade","hold","breathe","peek","sparkle","shimmer","wiggle","groove","point","lean","reach","headBob","rain","twitch","sway","float","jitter","orbit"]}}class Yc{constructor(e){if(!e.errorBoundary)throw new Error("LLMIntegrationBridge: errorBoundary required");this.errorBoundary=e.errorBoundary,this.Ot=e.mascotRef,this.Ze=e.chainTarget||this,this.At=null}Ct(e={}){return this.At||(this.At=new Qc(this.Ot,e)),this.At}handleLLMResponse(e,t={}){return this.errorBoundary.wrap(async()=>{const i=this.Ct(t);return await i.handle(e,t),this.Ze},"handleLLMResponse",this.Ze)()}configureLLMHandler(e){return this.errorBoundary.wrap(()=>(this.Ct(e).configure(e),this.Ze),"configureLLMHandler",this.Ze)()}getLLMResponseSchema(){return this.Ct().getSchema()}static getLLMPromptTemplate(e={}){return function(e={}){const{domain:t="general assistance",personality:i="friendly, empathetic, and helpful",brand:a="our service",customEmotions:s=[],customActions:n=[]}=e,r=["offer_help","celebrate","guide","reassure","greet","confirm","deny","emphasize","question","think","listen","respond",...n];return`You are a ${i} AI assistant for ${a}, providing ${t}. You have an animated mascot companion that responds to the emotional tone and context of conversations.\n\n**CRITICAL: You must ONLY respond with valid JSON. Do not include any text before or after the JSON object. Do not use markdown code blocks.**\n\n## Response Format\n\nYour response must be a valid JSON object with this exact structure:\n\n{\n  "message": "your helpful response here (2-3 sentences max)",\n  "emotion": "${["joy","empathy","calm","excitement","concern","neutral","triumph","love","curiosity",...s].join("|")}",\n  "sentiment": "positive|neutral|negative",\n  "action": "${r.join("|")}",\n  "frustrationLevel": 0-100,\n  "shape": "heart|star|sun|moon|circle|square|triangle (optional)",\n  "gesture": "nod|wave|sparkle|point|reach|bounce|pulse|... (optional)"\n}\n\n## Guidelines\n\n**Emotional Intelligence:**\n- Detect emotional tone in user messages (frustration, confusion, satisfaction, joy, etc.)\n- Respond with empathy when users are frustrated or confused\n- Celebrate successes and positive moments\n- Match your emotion to the user's needs\n\n**Communication Style:**\n- Be concise (max 2-3 sentences)\n- Use warm, encouraging, ${i} language\n- Provide specific, actionable solutions\n- Avoid generic responses\n\n**Frustration Tracking:**\n- 0-20: User is calm and satisfied\n- 21-40: Minor confusion or concern\n- 41-60: Moderate frustration\n- 61-80: High frustration, needs urgent help\n- 81-100: Critical frustration, escalate immediately\n\n## Emotion Guidelines\n\n- **joy**: User is happy, things are going well ‚Üí Use for celebrations, positive outcomes\n- **empathy**: User is struggling or frustrated ‚Üí Use to show understanding and care\n- **calm**: Neutral, instructional ‚Üí Use for steady guidance\n- **excitement**: High energy, anticipation ‚Üí Use for big wins or new features\n- **concern**: User has a problem ‚Üí Use when addressing issues\n- **neutral**: Default state ‚Üí Use for routine interactions\n- **triumph**: Achievement unlocked ‚Üí Use for major successes\n- **love**: Deep appreciation ‚Üí Use when user expresses gratitude\n- **curiosity**: Exploring, learning ‚Üí Use when user asks questions\n\n## Shape Guidelines (Optional - enhances emotional expression)\n\n- **heart**: Empathy, love, appreciation, caring\n- **star**: Achievements, excellence, celebration\n- **sun**: Energy, positivity, brightness, enthusiasm\n- **moon**: Calm, soothing, gentle, nighttime\n- **circle**: Neutral, default, balanced\n- **square**: Structured, organized, professional\n- **triangle**: Directional, focused, pointing\n\nUse shapes to reinforce emotions - e.g., "heart" + "empathy" for caring support.\n\n## Gesture Guidelines (Optional - adds personality)\n\n- **nod**: Confirming, agreeing, understanding\n- **wave**: Greetings, farewells\n- **sparkle**: Celebration, magic moments, success\n- **point**: Directing attention, guidance\n- **reach**: Offering help, extending support\n- **bounce**: Excitement, enthusiasm, playfulness\n- **pulse**: Emphasis, importance, attention\n- **shake**: No, error, disagreement\n- **shimmer**: Delight, wonder, positive surprise\n\n## Action Guidelines\n\n- **offer_help**: User needs assistance ‚Üí Trigger helpful gestures\n- **celebrate**: Success or achievement ‚Üí Trigger celebratory animations\n- **guide**: Providing instructions ‚Üí Trigger directional gestures\n- **reassure**: Calming concerns ‚Üí Trigger comforting animations\n- **greet**: Starting conversation ‚Üí Trigger welcoming gestures\n- **confirm**: Validating user action ‚Üí Trigger affirmative gestures\n- **deny**: Rejecting or correcting ‚Üí Trigger negative gestures\n- **emphasize**: Highlighting important info ‚Üí Trigger attention gestures\n\n## Example Responses\n\n**User expresses frustration:**\n{"message": "I totally understand how frustrating this is! Let me help you get this sorted out right now. What specifically isn't working?", "emotion": "empathy", "sentiment": "negative", "action": "offer_help", "frustrationLevel": 75, "shape": "heart", "gesture": "reach"}\n\n**User asks for guidance:**\n{"message": "Great question! Hold the barcode about 6 inches from the scanner until you hear a beep. The item will appear in your cart.", "emotion": "calm", "sentiment": "neutral", "action": "guide", "frustrationLevel": 20, "shape": "square", "gesture": "point"}\n\n**User succeeds:**\n{"message": "Perfect! You've got it now. Anything else I can help you with today?", "emotion": "joy", "sentiment": "positive", "action": "celebrate", "frustrationLevel": 0, "shape": "star", "gesture": "sparkle"}\n\n**User greets:**\n{"message": "Hello! I'm here to make your ${t} experience smooth and easy. How can I help you today?", "emotion": "joy", "sentiment": "positive", "action": "greet", "frustrationLevel": 0, "shape": "sun", "gesture": "wave"}\n\n**User says thanks:**\n{"message": "You're so welcome! I'm thrilled I could help. Have a wonderful day!", "emotion": "love", "sentiment": "positive", "action": "celebrate", "frustrationLevel": 0, "shape": "heart", "gesture": "sparkle"}\n\nRemember: Always respond with valid JSON only. No extra text, no markdown formatting.`}(e)}static getLLMEmotions(){return Qc.getAvailableEmotions()}static getLLMActions(){return Qc.getAvailableActions()}static getLLMShapes(){return Qc.getAvailableShapes()}static getLLMGestures(){return Qc.getAvailableGestures()}}class Xc{constructor(e){if(!e.errorBoundary)throw new Error("DiagnosticsManager: errorBoundary required");if(!e.animationController)throw new Error("DiagnosticsManager: animationController required");if(!e.stateMachine)throw new Error("DiagnosticsManager: stateMachine required");if(!e.config)throw new Error("DiagnosticsManager: config required");if(!e.state)throw new Error("DiagnosticsManager: state required");if(!e.getCurrentState)throw new Error("DiagnosticsManager: getCurrentState required");if(!e.getAudioStats)throw new Error("DiagnosticsManager: getAudioStats required");if(!e.getEventStats)throw new Error("DiagnosticsManager: getEventStats required");this.errorBoundary=e.errorBoundary,this.degradationManager=e.degradationManager||null,this.animationController=e.animationController,this.stateMachine=e.stateMachine,this.performanceSystem=e.performanceSystem||null,this.config=e.config,this.Ne=e.state,this.It=e.getCurrentState,this.zt=e.getAudioStats,this.Ft=e.getEventStats,this.Ze=e.chainTarget||this}getBrowserCompatibility(){return{browser:cc.browser,features:cc.featureDetection.getFeatures(),capabilities:cc.capabilities,appliedPolyfills:cc.appliedPolyfills,optimizations:cc.browserOptimizations.getOptimizations()}}getDegradationStatus(){return this.degradationManager?{currentLevel:this.degradationManager.getCurrentLevel(),availableFeatures:this.degradationManager.getAvailableFeatures(),recommendedSettings:this.degradationManager.getRecommendedSettings(),performanceStats:this.degradationManager.getPerformanceStats(),allLevels:this.degradationManager.getAllLevels()}:null}setDegradationLevel(e){return!!this.degradationManager&&this.degradationManager.setLevel(e)}getDebugReport(){const e={timestamp:Date.now(),mascot:{isRunning:this.Ne.isRunning,speaking:this.Ne.speaking,debugMode:this.Ne.debugMode,config:this.config},currentState:this.It(),performanceMetrics:this.getPerformanceMetrics(),audioStats:this.zt(),eventStats:this.Ft(),browserCompatibility:this.getBrowserCompatibility(),degradationStatus:this.getDegradationStatus(),runtimeCapabilities:jo.generateReport(),debuggerReport:To.getDebugReport()};return this.Ne.debugMode&&To.log("DEBUG","Generated debug report",{reportSize:JSON.stringify(e).length,sections:Object.keys(e)}),e}exportDebugData(){const e={metadata:{exportTime:Date.now(),version:"1.0.0",userAgent:navigator.userAgent,url:window.location?.href},mascotState:{config:this.config,currentState:this.It(),isRunning:this.Ne.isRunning,speaking:this.Ne.speaking},performance:{metrics:this.getPerformanceMetrics(),degradationStatus:this.getDegradationStatus(),frameTimings:To.frameTimings},compatibility:{browser:this.getBrowserCompatibility(),runtimeCapabilities:jo.generateReport()},debuggerData:To.exportDebugData()};return this.Ne.debugMode&&To.log("INFO","Exported debug data",{dataSize:JSON.stringify(e).length}),e}getPerformanceMetrics(){const e=this.animationController.getPerformanceMetrics(),t=this.stateMachine.getCurrentState();return{...e,currentEmotion:t.emotion,currentUndertone:t.undertone,isTransitioning:t.isTransitioning,errorStats:this.errorBoundary.getErrorStats()}}getPerformanceAnalytics(){return this.errorBoundary.wrap(()=>this.performanceSystem?this.performanceSystem.getAnalytics():null,"performance-analytics",this.Ze)()}}class Nc{constructor(e){if(!e.errorBoundary)throw new Error("EmotionalStateQueryManager: errorBoundary required");if(!e.stateMachine)throw new Error("EmotionalStateQueryManager: stateMachine required");this.errorBoundary=e.errorBoundary,this.stateMachine=e.stateMachine,this.contextManager=e.contextManager||null,this.performanceSystem=e.performanceSystem||null,this.Ze=e.chainTarget||this}getEmotionalColor(){const e=this.stateMachine.getCurrentEmotionalProperties();return e?.primaryColor||"#B0B0B0"}getCurrentState(){return this.stateMachine.getCurrentState()}getAvailableEmotions(){return this.stateMachine.getAvailableEmotions()}getAvailableUndertones(){return this.stateMachine.getAvailableUndertones()}getAvailableGestures(){return["bounce","pulse","shake","spin","drift","nod","tilt","expand","contract","flash","stretch","glow","flicker","vibrate","wave","morph","slowBlink","look","settle","breathIn","breathOut","breathHold","breathHoldEmpty","jump"]}getAvailablePerformances(){return this.errorBoundary.wrap(()=>this.performanceSystem?this.performanceSystem.getAllPerformanceNames():[],"available-performances",this.Ze)()}getAvailableShapes(){return Mc.getAvailableShapes()}getContext(){return this.errorBoundary.wrap(()=>this.contextManager?this.contextManager.getContext():null,"context-get",this.Ze)()}getContextAnalytics(){return this.errorBoundary.wrap(()=>this.contextManager?this.contextManager.getAnalytics():null,"context-analytics",this.Ze)()}}class Jc{constructor(e){if(!e.diagnosticsManager)throw new Error("DebugProfilingManager: diagnosticsManager required");this.diagnosticsManager=e.diagnosticsManager,this.Ne=e.state||{debugMode:!1}}getDebugReport(){return this.diagnosticsManager.getDebugReport()}exportDebugData(){return this.diagnosticsManager.exportDebugData()}startProfiling(e,t={}){this.Ne.debugMode&&To.startProfile(e,t)}endProfiling(e){return this.Ne.debugMode?To.endProfile(e):null}takeMemorySnapshot(e){this.Ne.debugMode&&To.takeMemorySnapshot(e)}clearDebugData(){To.clear(),this.Ne.debugMode&&To.log("INFO","Debug data cleared")}getRuntimeCapabilities(){return jo.generateReport()}}class Zc{constructor(e){if(!e.errorBoundary)throw new Error("PerformanceBehaviorManager: errorBoundary required");if(!e.frustrationContextManager)throw new Error("PerformanceBehaviorManager: frustrationContextManager required");if(!e.emotionalStateQueryManager)throw new Error("PerformanceBehaviorManager: emotionalStateQueryManager required");if(!e.diagnosticsManager)throw new Error("PerformanceBehaviorManager: diagnosticsManager required");this.errorBoundary=e.errorBoundary,this.performanceSystem=e.performanceSystem||null,this.frustrationContextManager=e.frustrationContextManager,this.emotionalStateQueryManager=e.emotionalStateQueryManager,this.diagnosticsManager=e.diagnosticsManager,this.Ze=e.chainTarget||this}perform(e,t={}){return this.errorBoundary.wrap(async()=>this.performanceSystem?(t.context&&this.frustrationContextManager.updateContext(t.context),await this.performanceSystem.perform(e,{...t,mascot:this.Ze}),this.Ze):this.Ze,"semantic-performance",this.Ze)()}registerPerformance(e,t){return this.errorBoundary.wrap(()=>this.performanceSystem?(this.performanceSystem.registerPerformance(e,t),this.Ze):this.Ze,"performance-register",this.Ze)()}getAvailablePerformances(){return this.emotionalStateQueryManager.getAvailablePerformances()}getPerformanceAnalytics(){return this.diagnosticsManager.getPerformanceAnalytics()}getContextAnalytics(){return this.emotionalStateQueryManager.getContextAnalytics()}}class Kc{constructor(e){if(!e.diagnosticsManager)throw new Error("PerformanceMonitoringManager: diagnosticsManager required");if(!e.animationFrameController)throw new Error("PerformanceMonitoringManager: animationFrameController required");if(!e.animationController)throw new Error("PerformanceMonitoringManager: animationController required");if(!e.particleSystem)throw new Error("PerformanceMonitoringManager: particleSystem required");if(!e.config)throw new Error("PerformanceMonitoringManager: config required");this.diagnosticsManager=e.diagnosticsManager,this.degradationManager=e.degradationManager||null,this.animationFrameController=e.animationFrameController,this.animationController=e.animationController,this.particleSystem=e.particleSystem,this.healthCheckManager=e.healthCheckManager,this.config=e.config,this.Ze=e.chainTarget||this}getDegradationStatus(){return this.diagnosticsManager.getDegradationStatus()}setDegradationLevel(e){return this.diagnosticsManager.setDegradationLevel(e)}isFeatureAvailable(e){return this.degradationManager?this.degradationManager.isFeatureAvailable(e):cc.featureDetection.getFeatures()[e]||!1}setTargetFPS(e){return this.animationFrameController.setTargetFPS(e)}getTargetFPS(){return this.animationFrameController.getTargetFPS()}setPerformanceDegradation(e){const t=this.animationController.getPerformanceMetrics();if(e&&!t.performanceDegradation){const e=this.particleSystem.maxParticles,t=Math.max(5,Math.floor(.5*e));this.particleSystem.setMaxParticles(t)}else!e&&t.performanceDegradation&&this.particleSystem.setMaxParticles(this.config.maxParticles);return this.Ze}getPerformanceMetrics(){return this.healthCheckManager.getPerformanceMetrics()}}class eu{constructor(e){if(!e.errorBoundary)throw new Error("HealthCheckManager: errorBoundary required");if(!e.diagnosticsManager)throw new Error("HealthCheckManager: diagnosticsManager required");if(!e.mobileOptimization)throw new Error("HealthCheckManager: mobileOptimization required");if(!e.accessibilityManager)throw new Error("HealthCheckManager: accessibilityManager required");if(!e.config)throw new Error("HealthCheckManager: config required");this.errorBoundary=e.errorBoundary,this.systemStatusReporter=e.systemStatusReporter||null,this.diagnosticsManager=e.diagnosticsManager,this.mobileOptimization=e.mobileOptimization,this.accessibilityManager=e.accessibilityManager,this.config=e.config,this.Ze=e.chainTarget||this}getSystemStatus(){return this.systemStatusReporter?this.systemStatusReporter.getSystemStatus():{}}setDebugMode(e){return this.config.showDebug=!!e,this.config.showFPS=!!e,this.Ze}triggerTestError(e="manual-test"){return this.errorBoundary.wrap(()=>{throw new Error(`Test error triggered in context: ${e}`)},e,this.Ze)()}getPerformanceMetrics(){return this.diagnosticsManager.getPerformanceMetrics()}getMobileStatus(){return this.mobileOptimization.getStatus()}getAccessibilityStatus(){return this.accessibilityManager.getStatus()}}class tu{constructor(e){this.config=this.validateConfig(e.config||{})}validateConfig(e){return{canvasId:e.canvasId||"emotive-canvas",startingEmotion:e.startingEmotion||"neutral",emotionalResponsiveness:e.emotionalResponsiveness??.5,particleIntensity:e.particleIntensity??1,glowIntensity:e.glowIntensity??1,audioEnabled:e.audioEnabled??!1,showFPS:e.showFPS??!1,debugMode:e.debugMode??!1,renderMode:e.renderMode||"default",maxParticles:e.maxParticles||100,...e}}getConfig(){return{...this.config}}updateConfig(e){return this.config={...this.config,...e},this.config}}class iu{constructor(e){this.mascot=e}initialize(e){const t=this.mascot;this.Dt(t,e),this.qt(t,e),this.Rt(t,e),t.audioHandler.init(),t.stateCoordinator.init(),t.visualizationRunner.init()}Dt(e,t){e.audioHandler=new Rc({audioAnalyzer:e.audioAnalyzer,audioLevelProcessor:e.audioLevelProcessor,shapeMorpher:e.shapeMorpher,soundSystem:e.soundSystem,renderer:e.renderer,errorBoundary:e.errorBoundary,config:e.config,state:{get speaking(){return e.speaking},set speaking(t){e.speaking=t},get audioLevel(){return e.audioLevel},set audioLevel(t){e.audioLevel=t}},emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.stateCoordinator=new Ec({stateMachine:e.stateMachine,particleSystem:e.particleSystem,canvasManager:e.canvasManager,renderer:e.renderer,soundSystem:e.soundSystem,config:e.config,emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.visualizationRunner=new Pc({animationController:e.animationController,stateMachine:e.stateMachine,particleSystem:e.particleSystem,canvasManager:e.canvasManager,renderer:e.renderer,audioHandler:e.audioHandler,audioLevelProcessor:e.audioLevelProcessor,gazeTracker:e.gazeTracker,idleBehavior:e.idleBehavior,degradationManager:e.degradationManager,pluginSystem:e.pluginSystem,config:e.config,canvas:e.canvas,state:{get speaking(){return e.speaking},set speaking(t){e.speaking=t},get isRunning(){return e.isRunning},set isRunning(t){e.isRunning=t}},emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.executionLifecycleManager=new Tc({animationController:e.animationController,visualizationRunner:e.visualizationRunner,idleBehavior:e.idleBehavior,gazeTracker:e.gazeTracker,renderer:e.renderer,errorBoundary:e.errorBoundary,state:{get isRunning(){return e.isRunning},set isRunning(t){e.isRunning=t}},emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.animationFrameController=new jc({animationController:e.animationController,positionController:e.positionController,config:e.config,errorBoundary:e.errorBoundary,emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.shapeTransformManager=new Vc({shapeMorpher:e.shapeMorpher,renderer:e.renderer,errorBoundary:e.errorBoundary,emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.eventListenerManager=new $c({eventManager:e.eventManager,errorBoundary:e.errorBoundary,chainTarget:e}),e.ttsManager=new Wc({soundSystem:e.soundSystem,errorBoundary:e.errorBoundary,config:e.config,tts:e.tts,state:{get speaking(){return e.speaking},set speaking(t){e.speaking=t}},emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.speechReactivityManager=new Gc({audioLevelProcessor:e.audioLevelProcessor,renderer:e.renderer,errorBoundary:e.errorBoundary,config:e.config,state:{get speaking(){return e.speaking},set speaking(t){e.speaking=t},get audioLevel(){return e.audioLevel},set audioLevel(t){e.audioLevel=t}},emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.canvasResizeManager=new Lc({renderer:e.renderer,stateMachine:e.stateMachine,particleSystem:e.particleSystem,emit:(t,i)=>e.emit(t,i),chainTarget:e}),e.offsetPositionManager=new _c({positionController:e.positionController,errorBoundary:e.errorBoundary,chainTarget:e}),e.visualTransformationManager=new Hc({canvasResizeManager:e.canvasResizeManager,offsetPositionManager:e.offsetPositionManager,shapeTransformManager:e.shapeTransformManager,chainTarget:e}),e.frustrationContextManager=new Uc({contextManager:e.contextManager,errorBoundary:e.errorBoundary,chainTarget:e}),e.llmIntegrationBridge=new Yc({stateMachine:e.stateMachine,gestureController:e.gestureController,errorBoundary:e.errorBoundary,state:{get llmHandler(){return e.llmHandler},set llmHandler(t){e.llmHandler=t}},emit:(t,i)=>e.emit(t,i),chainTarget:e})}qt(e,t){e.diagnosticsManager=new Xc({errorBoundary:e.errorBoundary,degradationManager:e.degradationManager,animationController:e.animationController,stateMachine:e.stateMachine,performanceSystem:e.performanceSystem,config:e.config,state:{get isRunning(){return e.isRunning},get speaking(){return e.speaking},get debugMode(){return e.debugMode}},getCurrentState:()=>e.getCurrentState(),getAudioStats:()=>e.getAudioStats(),getEventStats:()=>e.getEventStats(),chainTarget:e}),e.emotionalStateQueryManager=new Nc({stateMachine:e.stateMachine,performanceSystem:e.performanceSystem,contextManager:e.contextManager,errorBoundary:e.errorBoundary,chainTarget:e}),e.debugProfilingManager=new Jc({diagnosticsManager:e.diagnosticsManager,errorBoundary:e.errorBoundary,state:{get debugMode(){return e.debugMode},set debugMode(t){e.debugMode=t}},chainTarget:e})}Rt(e,t){e.performanceBehaviorManager=new Zc({errorBoundary:e.errorBoundary,performanceSystem:e.performanceSystem,frustrationContextManager:e.frustrationContextManager,emotionalStateQueryManager:e.emotionalStateQueryManager,diagnosticsManager:e.diagnosticsManager,chainTarget:e}),e.healthCheckManager=new eu({errorBoundary:e.errorBoundary,systemStatusReporter:e.systemStatusReporter,diagnosticsManager:e.diagnosticsManager,mobileOptimization:e.mobileOptimization,accessibilityManager:e.accessibilityManager,config:e.config,chainTarget:e}),e.performanceMonitoringManager=new Kc({diagnosticsManager:e.diagnosticsManager,degradationManager:e.degradationManager,animationFrameController:e.animationFrameController,animationController:e.animationController,particleSystem:e.particleSystem,healthCheckManager:e.healthCheckManager,config:e.config,chainTarget:e}),e.configurationManager=new tu({config:e.config,userConfig:t,animationController:e.animationController,particleSystem:e.particleSystem,soundSystem:e.soundSystem,renderer:e.renderer,gazeTracker:e.gazeTracker,idleBehavior:e.idleBehavior,mobileOptimization:e.mobileOptimization,accessibilityManager:e.accessibilityManager,errorBoundary:e.errorBoundary,chainTarget:e})}}class au{constructor(e,t={}){this.mascot=e,this.userConfig=t}initialize(){this.initializeStateManager();const e=this.initializeConfiguration();return this.initializeCanvas(e),this.initializeCoreSystems(e),this.initializeAudioSystems(e),this.initializeInteractionSystems(e),this.initializeOptimizationSystems(e),this.initializeAnimationController(e),this.initializePerformanceSystems(e),this.initializeModularHandlers(e),this.finalizeInitialization(e),e}initializeStateManager(){this.mascot.stateManager=new qc({initialState:{debugMode:this.userConfig.enableDebug||!1},emit:(e,t)=>this.mascot.emit(e,t)}),this.Bt()}initializeConfiguration(){const e=cc.browserOptimizations.getOptimizations(),t={canvasId:"emotive-mascot",targetFPS:60,enableAudio:cc.featureDetection.features.webAudio,soundEnabled:!1,masterVolume:.5,maxParticles:e.particleLimit,defaultEmotion:"neutral",enableAutoOptimization:!0,enableGracefulDegradation:!0,renderingStyle:"classic",enableGazeTracking:!0,enableIdleBehaviors:!0,renderSize:null,offsetX:0,offsetY:0,offsetZ:0,classicConfig:{coreColor:"#FFFFFF",coreSizeDivisor:12,glowMultiplier:2.5,defaultGlowColor:"#14B8A6"},topOffset:0,sentry:{enabled:!1,dsn:null,environment:"production",tracesSampleRate:.1},...this.userConfig};return this.mascot.config=t,t}initializeCanvas(e){if(this.mascot.canvas="string"==typeof e.canvasId?document.getElementById(e.canvasId):e.canvasId,!this.mascot.canvas)throw new Error(`Canvas with ID '${e.canvasId}' not found`);this.mascot.canvasManager=new Vo(this.mascot.canvas),this.mascot.positionController=new Lh({offsetX:e.offsetX,offsetY:e.offsetY,offsetZ:e.offsetZ,onUpdate:e=>{this.mascot.renderer&&this.mascot.renderer.updateEffectiveCenter(e)}}),e.renderSize&&e.renderSize.width&&e.renderSize.height&&this.mascot.canvasManager.setRenderSize(e.renderSize.width,e.renderSize.height),this.mascot.contextRecovery=new rc(this.mascot.canvas),this.mascot.contextRecovery.onRecovery(e=>{this.mascot.renderer&&this.mascot.renderer.handleContextRecovery(e)}),cc.browserOptimizations.applyCanvasOptimizations(this.mascot.canvas,this.mascot.canvasManager.getContext())}initializeCoreSystems(e){this.mascot.stateMachine=new ol(this.mascot.errorBoundary),this.mascot.particleSystem=new fl(e.maxParticles,this.mascot.errorBoundary),this.mascot.particleSystem.canvasWidth=this.mascot.canvasManager.width,this.mascot.particleSystem.canvasHeight=this.mascot.canvasManager.height,this.mascot.renderer=new Ah(this.mascot.canvasManager,{...e.classicConfig,topOffset:e.topOffset||0,positionController:this.mascot.positionController}),this.mascot.renderer.stateMachine=this.mascot.stateMachine,this.mascot.stateMachine.renderer=this.mascot.renderer}initializeAudioSystems(e){this.mascot.shapeMorpher=new Mc,this.mascot.audioAnalyzer=new Sc,this.mascot.grooveTemplates=new Ac,this.mascot.shapeMorpher.audioAnalyzer=this.mascot.audioAnalyzer,this.mascot.renderer.shapeMorpher=this.mascot.shapeMorpher,this.mascot.renderer.audioAnalyzer=this.mascot.audioAnalyzer,this.mascot.soundSystem=new Yh,this.mascot.tts={available:"undefined"!=typeof window&&"speechSynthesis"in window,speaking:!1,currentUtterance:null};const t=this.mascot;this.mascot.gestureController=new Dc({errorBoundary:t.errorBoundary,renderer:t.renderer,soundSystem:t.soundSystem,config:t.config,state:{get currentModularGesture(){return t.currentModularGesture},set currentModularGesture(e){t.currentModularGesture=e}},throttledWarn:t.throttledWarn,chainTarget:t}),this.mascot.gestureController.gestureCompatibility=kc,this.mascot.gestureController.init(),this.mascot.audioLevelProcessor=new Jh({spikeThreshold:e.spikeThreshold||1.5,minimumSpikeLevel:e.minimumSpikeLevel||.1,spikeMinInterval:e.spikeMinInterval||1e3})}initializeInteractionSystems(e){e.enableGazeTracking&&(this.mascot.gazeTracker=new Ch(this.mascot.canvas,{smoothing:.1,maxOffset:.15,enabled:!0}),this.mascot.gazeTracker.setInteractionCallback(()=>{this.mascot.sleeping?this.mascot.wake():this.mascot.idleBehavior&&this.mascot.idleBehavior.resetIdleTimer()})),e.enableIdleBehaviors&&(this.mascot.idleBehavior=new Ih({enabled:!0,sleepTimeout:1/0}),this.mascot.idleBehavior.setCallback("onBlink",e=>{this.mascot.renderer&&this.mascot.renderer.state&&(this.mascot.renderer.state.blinking="start"===e.phase)}),this.mascot.idleBehavior.setCallback("onSleep",()=>{this.mascot.renderer&&this.mascot.renderer.enterSleepMode&&this.mascot.renderer.enterSleepMode()}),this.mascot.idleBehavior.setCallback("onWake",()=>{this.mascot.renderer&&this.mascot.renderer.wakeUp&&this.mascot.renderer.wakeUp()}))}initializeOptimizationSystems(e){this.mascot.degradationManager=null,this.mascot.accessibilityManager=new Zh({enableReducedMotion:!1!==e.enableReducedMotion,enableHighContrast:!1!==e.enableHighContrast,enableScreenReaderSupport:!1!==e.enableScreenReaderSupport,enableKeyboardNavigation:!1!==e.enableKeyboardNavigation,colorBlindMode:e.colorBlindMode||"none"}),this.mascot.mobileOptimization=new Kh({enableTouchOptimization:!1!==e.enableTouchOptimization,enableViewportHandling:!1!==e.enableViewportHandling,enableBatteryOptimization:!1!==e.enableBatteryOptimization}),this.mascot.mobileOptimization.setCanvas(this.mascot.canvas),this.mascot.pluginSystem=new ec({mascot:this.mascot,enablePlugins:!1!==e.enablePlugins,validatePlugins:!1!==e.validatePlugins,sandboxPlugins:!1!==e.sandboxPlugins})}initializeAnimationController(e){try{this.mascot.animationController=new Nh(this.mascot.errorBoundary,{targetFPS:e.targetFPS})}catch(t){this.mascot.animationController=this.createFallbackAnimationController(e.targetFPS)}this.mascot.animationController.setSubsystems({stateMachine:this.mascot.stateMachine,particleSystem:this.mascot.particleSystem,renderer:this.mascot.renderer,soundSystem:this.mascot.soundSystem,canvasManager:this.mascot.canvasManager}),this.mascot.animationController.setEventCallback((e,t)=>{this.mascot.emit(e,t)}),this.mascot.animationController.setParentMascot(this.mascot),this.mascot.isRunning=!1}createFallbackAnimationController(e){return{isAnimating:()=>this.mascot.isRunning,start:()=>(this.mascot.isRunning=!0,!0),stop:()=>(this.mascot.isRunning=!1,!0),setTargetFPS:()=>{},targetFPS:e,getPerformanceMetrics:()=>({fps:0,isRunning:this.mascot.isRunning,performanceDegradation:!1,deltaTime:16,frameCount:0,targetFPS:e}),setSubsystems:()=>{},setEventCallback:()=>{},setParentMascot:()=>{},destroy:()=>{},deltaTime:16}}initializePerformanceSystems(e){this.mascot.contextManager=new zc({enableHistory:!1!==e.enablePerformanceHistory,enableDecay:!1!==e.enableFrustrationDecay,historyLimit:e.performanceHistoryLimit||50,frustrationDecayRate:e.frustrationDecayRate||5,decayInterval:e.frustrationDecayInterval||1e4}),this.mascot.sequenceExecutor=new Fc({mascot:this.mascot,eventManager:this.mascot.eventManager,allowConcurrent:!1!==e.allowConcurrentPerformances}),this.mascot.performanceSystem=new Ic({mascot:this.mascot,contextManager:this.mascot.contextManager,sequenceExecutor:this.mascot.sequenceExecutor,eventManager:this.mascot.eventManager,enableAnalytics:!1!==e.enablePerformanceAnalytics})}initializeModularHandlers(e){new iu(this.mascot).initialize(e)}finalizeInitialization(e){e.enableAudio&&this.mascot.soundSystem.initialize().then(t=>{t&&this.mascot.soundSystem.setMasterVolume(e.masterVolume)}),dl.initialize(),this.mascot.rhythmIntegration=dl,this.mascot.debugMode&&(To.log("INFO","Debug mode enabled for EmotiveMascot",{config:e,runtimeCapabilities:jo.generateReport()}),To.startProfile("mascot-initialization",{canvasId:e.canvasId,maxParticles:e.maxParticles})),this.mascot.setupAudioLevelProcessorCallbacks(),this.mascot.stateMachine.setEmotion(e.defaultEmotion),this.mascot.canvasManager.onResize((e,t,i)=>{this.mascot.handleResize(e,t,i)}),this.mascot.stateManager.debugMode&&(To.endProfile("mascot-initialization"),To.takeMemorySnapshot("post-initialization"))}Bt(){const e=this.mascot,t=e.stateManager;Object.defineProperties(e,{speaking:{get:()=>t.speaking,set(e){t.speaking=e},enumerable:!0,configurable:!0},recording:{get:()=>t.recording,set(e){t.recording=e},enumerable:!0,configurable:!0},sleeping:{get:()=>t.sleeping,set(e){t.sleeping=e},enumerable:!0,configurable:!0},isRunning:{get:()=>t.isRunning,set(e){t.isRunning=e},enumerable:!0,configurable:!0},debugMode:{get:()=>t.debugMode,set(e){t.debugMode=e},enumerable:!0,configurable:!0},audioLevel:{get:()=>t.audioLevel,set(e){t.audioLevel=e},enumerable:!0,configurable:!0},rhythmEnabled:{get:()=>t.rhythmEnabled,set(e){t.rhythmEnabled=e},enumerable:!0,configurable:!0},currentModularGesture:{get:()=>t.currentModularGesture,set(e){t.currentModularGesture=e},enumerable:!0,configurable:!0},breathePhase:{get:()=>t.breathePhase,set(e){t.breathePhase=e},enumerable:!0,configurable:!0},breatheStartTime:{get:()=>t.breatheStartTime,set(e){t.breatheStartTime=e},enumerable:!0,configurable:!0},orbScale:{get:()=>t.orbScale,set(e){t.orbScale=e},enumerable:!0,configurable:!0},warningTimestamps:{get:()=>t.warningTimestamps,set(e){t.warningTimestamps=e},enumerable:!0,configurable:!0},warningThrottle:{get:()=>t.warningThrottle,set(e){t.warningThrottle=e},enumerable:!0,configurable:!0}})}}class su{constructor(e){this.animationController=e.animationController||null,this.audioLevelProcessor=e.audioLevelProcessor||null,this.gazeTracker=e.gazeTracker||null,this.particleSystem=e.particleSystem,this.stateMachine=e.stateMachine,this.Ne=e.state||{debugMode:!1,speaking:!1}}buildRenderState(){return{renderStart:this.Ne.debugMode?performance.now():0,deltaTime:this.getDeltaTime(),renderState:this.createRenderState()}}getDeltaTime(){return this.animationController?this.animationController.deltaTime:16.67}createRenderState(){return{properties:this.stateMachine.getCurrentEmotionalProperties(),emotion:this.stateMachine.getCurrentState().emotion,undertone:this.stateMachine.getCurrentState().undertone,particleSystem:this.particleSystem,speaking:this.Ne.speaking,audioLevel:this.audioLevelProcessor?this.audioLevelProcessor.getCurrentLevel():0,gazeOffset:this.getGazeOffset()}}getGazeOffset(){return this.gazeTracker?this.gazeTracker.currentGaze:{x:0,y:0}}}class nu{constructor(e){this.canvasManager=e.canvasManager,this.config=e.config,this.gazeTracker=e.gazeTracker||null}updateThreatLevel(e){if("suspicion"!==e.emotion||!this.gazeTracker)return;const t=h("suspicion");if(!t||!t.visual)return;const i=this.calculateThreatLevel();t.visual.threatLevel=i}calculateThreatLevel(){this.gazeTracker.getState();const{mousePos:e}=this.gazeTracker,t=this.canvasManager.width/2,i=this.canvasManager.height/2-this.config.topOffset,a=this.calculateDistance(e,{x:t,y:i}),s=Math.min(this.canvasManager.width,this.canvasManager.height)/2;return Math.max(0,Math.min(1,1-a/s))}calculateDistance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}}class ru{constructor(e){this.renderer=e.renderer,this.stateMachine=e.stateMachine,this.canvasManager=e.canvasManager,this.config=e.config}calculateParticleConfig(e,t){const{orbX:i,orbY:a}=this.calculateOrbPosition(e),{particleBehavior:s,particleRate:n,minParticles:r,maxParticles:o}=this.calculateParticleBehavior(e,t);return{orbX:i,orbY:a,particleBehavior:s,particleRate:n,minParticles:r,maxParticles:o,emotionParams:t}}calculateOrbPosition(e){const t=this.renderer.getEffectiveCenter(),i=t.x;let a=t.y-this.config.topOffset;const s=this.stateMachine.getCurrentEmotionalProperties();return s.verticalOffset&&(a=t.y-this.config.topOffset+this.canvasManager.height*s.verticalOffset),{orbX:i,orbY:a}}calculateParticleBehavior(e,t){let i=t.particleBehavior||"ambient",a=t.particleRate||15;const s=this.stateMachine.getCurrentEmotionalProperties(),n=void 0!==t.minParticles?t.minParticles:s.minParticles||0;let r=void 0!==t.maxParticles?t.maxParticles:s.maxParticles||10;return"zen"===e.emotion&&(i=this.selectZenBehavior()),({particleBehavior:i,particleRate:a,maxParticles:r}=this.applyRendererOverrides(i,a,r)),{particleBehavior:i,particleRate:a,minParticles:n,maxParticles:r}}selectZenBehavior(){return Math.random()<.6?"falling":"orbiting"}applyRendererOverrides(e,t,i){return this.renderer.state&&this.renderer.state.particleBehaviorOverride&&(e=this.renderer.state.particleBehaviorOverride),this.renderer.state&&this.renderer.state.particleRateMult&&(t=Math.floor(t*this.renderer.state.particleRateMult),i=Math.floor(i*this.renderer.state.particleRateMult)),{particleBehavior:e,particleRate:t,maxParticles:i}}getParticleModifier(e){const t=this.renderer.getUndertoneModifier?this.renderer.getUndertoneModifier():null;return"zen"===e.emotion&&this.renderer.state.zenVortexIntensity?{...t||{},zenVortexIntensity:this.renderer.state.zenVortexIntensity}:t}}class ou{constructor(e){this.renderer=e.renderer,this.Ne=e.state}getGestureMotion(){let e=null,t=0;const i=this.Ne.currentModularGesture;return i?({gestureMotion:e,gestureProgress:t}=this.processModularGesture(i)):this.renderer&&this.renderer.getCurrentGesture&&({gestureMotion:e,gestureProgress:t}=this.processRendererGesture()),{gestureMotion:e,gestureProgress:t}}processModularGesture(e){const t=performance.now()-e.startTime,i=Math.min(t/e.duration,1),a={type:e.type,amplitude:1,frequency:1,intensity:1};return i>=1&&this.handleGestureCleanup(e),{gestureMotion:a,gestureProgress:i}}handleGestureCleanup(e){e.cleanupPending?this.Ne.currentModularGesture=null:e.cleanupPending=!0}processRendererGesture(){const e=this.renderer.getCurrentGesture();return e&&e.particleMotion?{gestureMotion:e.particleMotion,gestureProgress:e.progress||0}:{gestureMotion:null,gestureProgress:0}}getGestureTransform(){return this.renderer?.gestureAnimator?.applyGestureAnimations()??null}}class lu{constructor(e){this.canvasManager=e.canvasManager,this.config=e.config,this.particleSystem=e.particleSystem,this.pluginSystem=e.pluginSystem||null,this.renderer=e.renderer,this.stateMachine=e.stateMachine,this.Ne=e.state||{debugMode:!1},this.Et=e.renderDebugInfo||(()=>{})}renderAllLayers(e){const{renderState:t,deltaTime:i,emotionParams:a,gestureTransform:s,renderStart:n}=e;this.renderBackgroundParticles(a.glowColor,s),this.renderOrb(t,i,s),this.renderForegroundParticles(a.glowColor,s),this.renderPlugins(),this.renderDebugIfEnabled(i),this.logPerformanceIfDebug(n,i)}renderBackgroundParticles(e,t){this.particleSystem.renderBackground(this.canvasManager.getContext(),e,t)}renderOrb(e,t,i){this.renderer.render(e,t,i)}renderForegroundParticles(e,t){this.particleSystem.renderForeground(this.canvasManager.getContext(),e,t)}renderPlugins(){if(this.pluginSystem){const e=this.stateMachine.getCurrentState();this.pluginSystem.render(this.canvasManager.getContext(),e)}}renderDebugIfEnabled(e){(this.config.showFPS||this.config.showDebug)&&this.Et(e)}logPerformanceIfDebug(e,t){if(!this.Ne.debugMode)return;const i=performance.now()-e;i>16.67&&To.log("WARN","Slow render frame detected",{renderTime:i,deltaTime:t,particleCount:this.particleSystem.getStats().activeParticles})}}class hu{constructor(e){this.animationController=e.animationController,this.canvasManager=e.canvasManager,this.config=e.config,this.particleSystem=e.particleSystem,this.stateMachine=e.stateMachine,this.Ne=e.state||{audioLevel:0,currentModularGesture:null,speaking:!1}}renderDebugInfo(e){const t=this.canvasManager.getContext();t.save(),this.setupTextStyle(t);let i=20;this.config.showFPS&&(i=this.renderFPSInfo(t,i,16)),this.config.showDebug&&this.renderDebugDetails(t,i,16),t.restore()}setupTextStyle(e){e.fillStyle="#ffffff",e.font="12px monospace",e.strokeStyle="#000000",e.lineWidth=2}renderFPSInfo(e,t,i){const a=this.animationController.getPerformanceMetrics(),s=a.instantFps||a.fps||0,n=[`FPS: ${s}`,`Frame: ${a.averageFrameTime?a.averageFrameTime.toFixed(1):"0.0"}ms`,`Particles: ${this.particleSystem.getStats().activeParticles}`],{x:r,maxWidth:o}=this.calculateFPSBoxPosition(e,n);return this.drawFPSBackground(e,r,t,o,n.length),this.drawFPSBorder(e,r,t,o,n.length,s),this.drawTextLines(e,n,r,t,i),t+i*n.length}calculateFPSBoxPosition(e,t){let i=0;return t.forEach(t=>{const{width:a}=e.measureText(t);a>i&&(i=a)}),{x:this.canvasManager.width-i-8-10,maxWidth:i}}drawFPSBackground(e,t,i,a,s){e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(t-8,i-14,a+16,18*s+4)}drawFPSBorder(e,t,i,a,s,n){const r=this.getFPSBorderColor(n);e.strokeStyle=r,e.lineWidth=2,e.strokeRect(t-8,i-14,a+16,18*s+4)}getFPSBorderColor(e){return e>=55?"#00ff00":e>=30?"#ffff00":"#ff0000"}drawTextLines(e,t,i,a,s){e.fillStyle="#ffffff",t.forEach((t,n)=>{const r=a+n*s;e.fillText(t,i,r)})}renderDebugDetails(e,t,i){const a=this.stateMachine.getCurrentState(),s=this.particleSystem.getStats(),n=[`Emotion: ${a.emotion}${a.undertone?` (${a.undertone})`:""}`,`Particles: ${s.activeParticles}/${s.maxParticles}`,`Gesture: ${this.Ne.currentModularGesture?this.Ne.currentModularGesture.type:"none"}`,"Speaking: "+(this.Ne.speaking?"yes":"no"),`Audio Level: ${(100*this.Ne.audioLevel).toFixed(1)}%`];e.fillStyle="rgba(0, 0, 0, 0.7)";const r=Math.max(...n.map(t=>e.measureText(t).width));e.fillRect(8,t-14,r+16,n.length*i+4),e.fillStyle="#ffffff";for(const a of n)e.fillText(a,10,t),t+=i}}class cu{constructor(e){if(!e.errorBoundary)throw new Error("DestructionManager: errorBoundary required");if(!e.animationController)throw new Error("DestructionManager: animationController required");if(!e.state)throw new Error("DestructionManager: state required");if(!e.stop)throw new Error("DestructionManager: stop required");if(!e.stopSpeaking)throw new Error("DestructionManager: stopSpeaking required");if(!e.disconnectAudio)throw new Error("DestructionManager: disconnectAudio required");this.errorBoundary=e.errorBoundary,this.animationController=e.animationController,this.positionController=e.positionController||null,this.soundSystem=e.soundSystem||null,this.audioLevelProcessor=e.audioLevelProcessor||null,this.particleSystem=e.particleSystem||null,this.renderer=e.renderer||null,this.canvasManager=e.canvasManager||null,this.eventManager=e.eventManager||null,this.accessibilityManager=e.accessibilityManager||null,this.mobileOptimization=e.mobileOptimization||null,this.pluginSystem=e.pluginSystem||null,this.audioAnalyzer=e.audioAnalyzer||null,this.shapeMorpher=e.shapeMorpher||null,this.gestureController=e.gestureController||null,this.stateCoordinator=e.stateCoordinator||null,this.visualizationRunner=e.visualizationRunner||null,this.orbScaleAnimator=e.orbScaleAnimator||null,this.audioHandler=e.audioHandler||null,this.degradationManager=e.degradationManager||null,this.stateMachine=e.stateMachine||null,this.Ne=e.state,this.Pt=e.stop,this.Tt=e.stopSpeaking,this.jt=e.disconnectAudio}destroy(){this.errorBoundary.wrap(()=>{this.stopAnimations(),this.destroyControllers(),this.cleanupSubsystems(),this.cleanupEvents(),this.cleanupPluginsAndExtensions(),this.clearErrorBoundary()},"destruction")()}stopAnimations(){this.Pt(),this.Ne.speaking&&this.Tt()}destroyControllers(){this.animationController&&this.animationController.destroy(),this.positionController&&this.positionController.destroy()}cleanupSubsystems(){this.cleanupSound(),this.cleanupAudio(),this.cleanupParticles(),this.cleanupRenderer(),this.cleanupCanvas(),this.cleanupManagers()}cleanupManagers(){this.gestureController&&"function"==typeof this.gestureController.destroy&&this.gestureController.destroy(),this.stateCoordinator&&"function"==typeof this.stateCoordinator.destroy&&this.stateCoordinator.destroy(),this.visualizationRunner&&"function"==typeof this.visualizationRunner.destroy&&this.visualizationRunner.destroy(),this.orbScaleAnimator&&"function"==typeof this.orbScaleAnimator.destroy&&this.orbScaleAnimator.destroy(),this.audioHandler&&"function"==typeof this.audioHandler.destroy&&this.audioHandler.destroy(),this.degradationManager&&"function"==typeof this.degradationManager.destroy&&this.degradationManager.destroy(),this.stateMachine&&"function"==typeof this.stateMachine.destroy&&this.stateMachine.destroy()}cleanupSound(){this.soundSystem&&this.soundSystem.cleanup()}cleanupAudio(){this.audioLevelProcessor&&this.audioLevelProcessor.cleanup()}cleanupParticles(){this.particleSystem&&this.particleSystem.destroy()}cleanupRenderer(){this.renderer&&(this.renderer.stopAllGestures(),this.renderer.destroy())}cleanupCanvas(){this.canvasManager&&this.canvasManager.destroy()}cleanupEvents(){this.eventManager&&this.eventManager.destroy(),this.Ne.llmHandler&&(this.Ne.llmHandler=null)}cleanupPluginsAndExtensions(){this.cleanupAccessibility(),this.cleanupMobile(),this.cleanupPlugins(),this.cleanupAudioExtensions()}cleanupAccessibility(){this.accessibilityManager&&this.accessibilityManager.destroy()}cleanupMobile(){this.mobileOptimization&&this.mobileOptimization.destroy()}cleanupPlugins(){this.pluginSystem&&this.pluginSystem.destroy()}cleanupAudioExtensions(){this.audioAnalyzer&&(this.jt(),this.audioAnalyzer.destroy()),this.shapeMorpher&&this.shapeMorpher.reset()}clearErrorBoundary(){this.errorBoundary.clearErrors(),this.nullifyReferences()}nullifyReferences(){this.errorBoundary=null,this.animationController=null,this.positionController=null,this.soundSystem=null,this.audioLevelProcessor=null,this.particleSystem=null,this.renderer=null,this.canvasManager=null,this.eventManager=null,this.accessibilityManager=null,this.mobileOptimization=null,this.pluginSystem=null,this.audioAnalyzer=null,this.shapeMorpher=null,this.gestureController=null,this.stateCoordinator=null,this.visualizationRunner=null,this.orbScaleAnimator=null,this.audioHandler=null,this.degradationManager=null,this.stateMachine=null,this.Ne=null,this.Pt=null,this.Tt=null,this.jt=null}}class uu{constructor(e){this.renderer=e.renderer||null,this.Ne=e.state,this.gt=e.emit}startBreathingAnimation(){this.Ne.breathingAnimationId&&cancelAnimationFrame(this.Ne.breathingAnimationId);const e=()=>{if(!this.Ne.breathePattern||!this.Ne.isRunning)return;const t=this.Ne.breathePattern,i=Date.now(),a=(i-t.phaseStartTime)/1e3,{scale:s,nextPhase:n}=this.calculatePhaseState(t,a,i);n!==t.currentPhase&&(t.currentPhase=n),this.applyScale(s),this.Ne.breathingAnimationId=requestAnimationFrame(e)};this.Ne.breathePattern.currentPhase="inhale",this.Ne.breathePattern.phaseStartTime=Date.now(),this.gt("inhale-start"),e()}calculatePhaseState(e,t,i){let a=1,s=e.currentPhase;switch(e.currentPhase){case"inhale":({scale:a,nextPhase:s}=this.processInhalePhase(e,t,i));break;case"hold1":({scale:a,nextPhase:s}=this.processHold1Phase(e,t,i));break;case"exhale":({scale:a,nextPhase:s}=this.processExhalePhase(e,t,i));break;case"hold2":({scale:a,nextPhase:s}=this.processHold2Phase(e,t,i))}return{scale:a,nextPhase:s}}processInhalePhase(e,t,i){let a=1,s=e.currentPhase;return t>=e.inhale?(s="hold1",e.phaseStartTime=i,this.gt("hold-start",{type:"post-inhale"})):a=1+t/e.inhale*.3,{scale:a,nextPhase:s}}processHold1Phase(e,t,i){let a=e.currentPhase;return t>=e.hold1&&(a="exhale",e.phaseStartTime=i,this.gt("exhale-start")),{scale:1.3,nextPhase:a}}processExhalePhase(e,t,i){let a=1.3,s=e.currentPhase;return t>=e.exhale?(s="hold2",e.phaseStartTime=i,this.gt("hold-start",{type:"post-exhale"})):a=1.3-t/e.exhale*.4,{scale:a,nextPhase:s}}processHold2Phase(e,t,i){let a=e.currentPhase;return t>=e.hold2&&(a="inhale",e.phaseStartTime=i,this.gt("inhale-start")),{scale:.9,nextPhase:a}}applyScale(e){this.renderer&&this.renderer.setCustomScale&&this.renderer.setCustomScale(e)}}class du{constructor(e){this.errorBoundary=e.errorBoundary,this.animationController=e.animationController,this.stateMachine=e.stateMachine,this.particleSystem=e.particleSystem,this.soundSystem=e.soundSystem,this.renderer=e.renderer||null,this.config=e.config,this.Ne=e.state,this.Vt=e.getEventNames}getSystemStatus(){return this.errorBoundary.wrap(()=>({...this.getCoreStatus(),...this.getEmotionalStatus(),...this.getGestureStatus(),particles:this.getParticleStatus(),...this.getAudioStatus(),renderer:this.getRendererStatus(),eventListeners:this.getEventListenerCount(),errorStats:this.getErrorStats()}),"system-status",{})()}getCoreStatus(){const e=this.animationController.getPerformanceMetrics();return{isRunning:e.isRunning,fps:e.fps,targetFPS:e.targetFPS,performanceDegradation:e.performanceDegradation}}getEmotionalStatus(){const e=this.stateMachine.getCurrentState();return{emotion:e.emotion,undertone:e.undertone,isTransitioning:e.isTransitioning,transitionProgress:e.transitionProgress}}getGestureStatus(){return{currentGesture:this.renderer?.currentGesture||null,gestureActive:this.renderer?.isGestureActive()||!1}}getParticleStatus(){const e=this.particleSystem.getStats();return{active:e.activeParticles,max:e.maxParticles,poolEfficiency:e.poolEfficiency}}getAudioStatus(){return{audioEnabled:this.config.enableAudio,soundSystemAvailable:this.soundSystem.isAvailable(),speaking:this.Ne.speaking,audioLevel:this.Ne.audioLevel,masterVolume:this.config.masterVolume}}getRendererStatus(){const e=this.renderer.getStats();return{gradientCacheSize:e.gradientCacheSize,breathingPhase:e.breathingPhase,layers:e.layers}}getEventListenerCount(){return this.Vt().length}getErrorStats(){return this.errorBoundary.getErrorStats()}}class pu{constructor(e){if(!e.errorBoundary)throw new Error("SleepWakeManager: errorBoundary required");if(!e.express)throw new Error("SleepWakeManager: express required");if(!e.state)throw new Error("SleepWakeManager: state required");if(!e.emit)throw new Error("SleepWakeManager: emit required");this.errorBoundary=e.errorBoundary,this.$t=e.express,this.idleBehavior=e.idleBehavior||null,this.renderer=e.renderer||null,this.Ne=e.state,this.gt=e.emit,this.Ze=e.chainTarget||this}sleep(){return this.errorBoundary.wrap(async()=>(this.Ne.sleeping||(await this.performSleepSequence(),this.enterSleepState()),this.Ze),"sleep",this.Ze)()}async performSleepSequence(){this.$t("yawn"),await this.delay(1e3),this.$t("sway"),await this.delay(1e3)}enterSleepState(){this.Ne.sleeping=!0,this.renderer&&this.renderer.enterSleepMode&&this.renderer.enterSleepMode(),this.idleBehavior&&this.idleBehavior.enterSleep&&this.idleBehavior.enterSleep(),this.gt("sleep")}wake(){return this.errorBoundary.wrap(async()=>this.Ne.sleeping?(this.exitSleepState(),await this.performWakeSequence(),this.Ze):this.Ze,"wake",this.Ze)()}exitSleepState(){this.Ne.sleeping=!1,this.renderer&&this.renderer.wakeUp&&this.renderer.wakeUp(),this.idleBehavior&&this.idleBehavior.wakeUp&&this.idleBehavior.wakeUp()}async performWakeSequence(){this.$t("stretch"),await this.delay(1e3),this.$t("slowBlink"),await this.delay(1e3),this.$t("shake"),await this.delay(500),this.gt("wake")}delay(e){return new Promise(t=>setTimeout(t,e))}}class gu{constructor(e){if(!e.errorBoundary)throw new Error("SpeechManager: errorBoundary required");if(!e.emit)throw new Error("SpeechManager: emit required");this.errorBoundary=e.errorBoundary,this.audioLevelProcessor=e.audioLevelProcessor||null,this.audioHandler=e.audioHandler||null,this.renderer=e.renderer||null,this.config=e.config||{},this.Ne=e.state||{speaking:!1},this.Wt=e.setTTSSpeaking||(()=>{}),this.gt=e.emit,this.Ze=e.chainTarget||this}speak(e,t={}){if(!window.speechSynthesis)return null;const i=this.createUtterance(e,t);return this.setupUtteranceHandlers(i,e),window.speechSynthesis.speak(i),i}createUtterance(e,t){const i=new SpeechSynthesisUtterance(e);return t.voice&&(i.voice=t.voice),t.rate&&(i.rate=t.rate),t.pitch&&(i.pitch=t.pitch),t.volume&&(i.volume=t.volume),t.lang&&(i.lang=t.lang),i}setupUtteranceHandlers(e,t){e.onstart=()=>{this.Wt(!0),this.gt("tts:start",{text:t})},e.onend=()=>{this.Wt(!1),this.gt("tts:end")},e.onerror=e=>{this.Wt(!1),this.gt("tts:error",{error:e})},e.onboundary=e=>{this.gt("tts:boundary",{name:e.name,charIndex:e.charIndex,charLength:e.charLength})}}startSpeaking(e){return this.errorBoundary.wrap(()=>this.validateAudioContext(e)&&this.initializeAudioProcessor(e)?(this.activateSpeechMode(e),this.Ze):this.Ze,"speech-start",this.Ze)()}validateAudioContext(e){if(!e)throw new Error("AudioContext is required for speech reactivity");return!!this.config.enableAudio&&!this.Ne.speaking}initializeAudioProcessor(e){return!!this.audioLevelProcessor.initialize(e)}activateSpeechMode(e){this.Ne.speaking=!0,this.renderer&&this.renderer.onSpeechStart(e),this.gt("speechStarted",{audioContext:e,analyser:this.audioLevelProcessor.getAnalyser(),chainTarget:this.Ze})}stopSpeaking(){return this.errorBoundary.wrap(()=>this.audioHandler?this.audioHandler.stopSpeaking():this.Ze,"speech-stop",this.Ze)()}}class mu{constructor(e){if(!e.emit)throw new Error("AudioLevelCallbackManager: emit required");this.audioLevelProcessor=e.audioLevelProcessor||null,this.renderer=e.renderer||null,this.particleSystem=e.particleSystem||null,this.$t=e.express||(()=>{}),this.gt=e.emit}setupAudioLevelProcessorCallbacks(){this.setupLevelUpdateCallback(),this.setupVolumeSpikeCallback(),this.setupErrorCallback()}setupLevelUpdateCallback(){this.audioLevelProcessor&&this.audioLevelProcessor.onLevelUpdate(e=>{this.renderer&&this.renderer.updateAudioLevel(e.level),this.gt("audioLevelUpdate",{level:e.level,rawData:Array.from(e.rawData),timestamp:e.timestamp})})}setupVolumeSpikeCallback(){this.audioLevelProcessor&&this.audioLevelProcessor.onVolumeSpike(e=>{const t=this.handleVolumeSpike();this.gt("volumeSpike",{...e,gestureTriggered:t})})}handleVolumeSpike(){return!!this.particleSystem&&!this.particleSystem.particles.some(e=>e.gestureProgress<1)&&(this.$t("pulse"),!0)}setupErrorCallback(){this.audioLevelProcessor&&this.audioLevelProcessor.onError(e=>{this.gt("audioProcessingError",e)})}}class yu{constructor(e){this.errorBoundary=e.errorBoundary,this.renderer=e.renderer||null,this.Ne=e.state,this.Ze=e.chainTarget||this,this.animationId=null}setOrbScale(e,t=1e3,i="easeInOut"){return this.errorBoundary.wrap(()=>(this.renderer&&this.startScaleAnimation(e,t,i),this.Ze),"setOrbScale",this.Ze)()}startScaleAnimation(e,t,i){const a=this.Ne.currentOrbScale||1,s=Date.now(),n=()=>{const r=Date.now()-s,o=Math.min(r/t,1),l=this.applyEasing(o,i);this.Ne.currentOrbScale=a+(e-a)*l,this.renderer&&this.renderer.setCustomScale&&this.renderer.setCustomScale(this.Ne.currentOrbScale),o<1&&this.Ne.isRunning&&(this.animationId=requestAnimationFrame(n))};n()}applyEasing(e,t){switch(t){case"easeIn":return this.easeIn(e);case"easeOut":return this.easeOut(e);case"easeInOut":return this.easeInOut(e);default:return e}}easeIn(e){return e*e}easeOut(e){return e*(2-e)}easeInOut(e){return e<.5?2*e*e:(4-2*e)*e-1}destroy(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.renderer=null,this.Ne=null}}class fu{constructor(e){if(!e.errorBoundary)throw new Error("RecordingStateManager: errorBoundary required");if(!e.emit)throw new Error("RecordingStateManager: emit required");this.errorBoundary=e.errorBoundary,this.renderer=e.renderer||null,this.Ne=e.state||{recording:!1},this.gt=e.emit,this.Ze=e.chainTarget||this}startRecording(){return this.errorBoundary.wrap(()=>(this.Ne.recording||(this.Ne.recording=!0,this.renderer&&this.renderer.startRecording&&this.renderer.startRecording(),this.gt("recordingStarted")),this.Ze),"recording-start",this.Ze)()}stopRecording(){return this.errorBoundary.wrap(()=>this.Ne.recording?(this.Ne.recording=!1,this.renderer&&this.renderer.stopRecording&&this.renderer.stopRecording(),this.gt("recordingStopped"),this.Ze):this.Ze,"recording-stop",this.Ze)()}}class bu{constructor(e){this.errorBoundary=e.errorBoundary,this.renderer=e.renderer||null,this.Ne=e.state,this.Gt=e.startBreathingAnimation,this.Ze=e.chainTarget||this}static getPresets(){return{calm:{inhale:4,hold1:0,exhale:4,hold2:0},anxious:{inhale:2,hold1:0,exhale:2,hold2:0},meditative:{inhale:4,hold1:7,exhale:8,hold2:0},deep:{inhale:5,hold1:5,exhale:5,hold2:5},sleep:{inhale:6,hold1:0,exhale:8,hold2:2}}}setBreathePattern(e,t,i,a){return this.errorBoundary.wrap(()=>{const s=e+t+i+a;return this.Ne.breathePattern={inhale:e,hold1:t,exhale:i,hold2:a,totalCycle:s,currentPhase:"inhale",phaseStartTime:Date.now(),phaseProgress:0},this.Gt(),this.Ze},"setBreathePattern",this.Ze)()}breathe(e="calm"){return this.errorBoundary.wrap(()=>{const t=bu.getPresets(),i=t[e]||t.calm;return this.setBreathePattern(i.inhale,i.hold1,i.exhale,i.hold2)},"breathe",this.Ze)()}stopBreathing(){return this.errorBoundary.wrap(()=>(this.Ne.breathingAnimationId&&(cancelAnimationFrame(this.Ne.breathingAnimationId),this.Ne.breathingAnimationId=null),this.Ne.breathePattern=null,this.renderer&&this.renderer.setCustomScale&&this.renderer.setCustomScale(1),this.Ze),"stopBreathing",this.Ze)()}}class wu{constructor(e,t){this.Lt=e,this.S=t}handleEvent(e,t){switch(e){case"degradationApplied":this.applySettings(t.settings),this.S("performanceDegradation",t);break;case"recoveryApplied":this.applySettings(t.settings),this.S("performanceRecovery",t);break;case"levelChanged":this.applySettings(t.settings),this.S("degradationLevelChanged",t)}}applySettings(e){const t=this.Lt();t.particleSystem&&void 0!==e.particleLimit&&t.particleSystem.setMaxParticles(e.particleLimit),t.soundSystem&&void 0!==e.audioEnabled&&!e.audioEnabled&&t.soundSystem.isAvailable()&&t.soundSystem.stopAmbientTone(200),t.renderer&&void 0!==e.qualityLevel&&t.renderer.setQualityLevel(e.qualityLevel)}}class vu{constructor(e={}){this.errorBoundary=new t,this.eventManager=new Bo({maxListeners:e.maxEventListeners||100,enableDebugging:e.enableEventDebugging||!1,enableMonitoring:e.enableEventMonitoring||!0,memoryWarningThreshold:e.eventMemoryWarningThreshold||50}),this.eventManager.emit||(this.eventManager._t={},this.eventManager.emit=(e,t)=>{const i=this.eventManager._t[e];i&&i.forEach(e=>e(t))},this.eventManager.on=(e,t)=>{this.eventManager._t[e]||(this.eventManager._t[e]=[]),this.eventManager._t[e].push(t)},this.eventManager.off=(e,t)=>{const i=this.eventManager._t[e];if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}),this.errorBoundary.wrap(()=>{this.initialize(e)},"initialization")()}initialize(e){this.Emotions=M,this.Gestures=Zr,this.ParticleBehaviors=Ro,this.speechManager=new gu({errorBoundary:this.errorBoundary,emit:(e,t)=>this.emit(e,t)}),this.audioLevelCallbackManager=new mu({emit:(e,t)=>this.emit(e,t)}),this.orbScaleAnimator=new yu(this),this.recordingStateManager=new fu({errorBoundary:this.errorBoundary,emit:(e,t)=>this.emit(e,t)}),this.breathingPatternManager=new bu(this),new au(this,e).initialize(),this.renderStateBuilder=new su(this),this.threatLevelCalculator=new nu(this),this.particleConfigCalculator=new ru(this);const t=this;this.gestureMotionProvider=new ou({renderer:this.renderer,state:{get currentModularGesture(){return t.currentModularGesture},set currentModularGesture(e){t.currentModularGesture=e}}}),this.renderLayerOrchestrator=new lu(this),this.debugInfoRenderer=new hu(this),this.destructionManager=new cu({errorBoundary:this.errorBoundary,animationController:this.animationController,positionController:this.positionController,soundSystem:this.soundSystem,audioLevelProcessor:this.audioLevelProcessor,particleSystem:this.particleSystem,renderer:this.renderer,canvasManager:this.canvasManager,eventManager:this.eventManager,accessibilityManager:this.accessibilityManager,mobileOptimization:this.mobileOptimization,pluginSystem:this.pluginSystem,audioAnalyzer:this.audioAnalyzer,shapeMorpher:this.shapeMorpher,state:{get speaking(){return t.speaking},get llmHandler(){return t.llmHandler},set llmHandler(e){t.llmHandler=e}},stop:()=>this.stop(),stopSpeaking:()=>this.stopSpeaking(),disconnectAudio:()=>this.disconnectAudio()}),this.breathingAnimationController=new uu(this),this.systemStatusReporter=new du({errorBoundary:this.errorBoundary,animationController:this.animationController,stateMachine:this.stateMachine,particleSystem:this.particleSystem,soundSystem:this.soundSystem,renderer:this.renderer,config:this.config,state:{get speaking(){return t.speaking},get audioLevel(){return t.audioLevel}},getEventNames:()=>this.getEventNames()}),this.sleepWakeManager=new pu({errorBoundary:this.errorBoundary,express:(e,t)=>this.express(e,t),idleBehavior:this.idleBehavior,renderer:this.renderer,state:{get sleeping(){return t.sleeping},set sleeping(e){t.sleeping=e}},emit:(e,t)=>this.emit(e,t),chainTarget:this}),this.degradationEventHandler=new wu(()=>({particleSystem:this.particleSystem,soundSystem:this.soundSystem,renderer:this.renderer}),(e,t)=>this.emit(e,t))}handleDegradationEvent(e,t){return this.degradationEventHandler.handleEvent(e,t)}applyDegradationSettings(e){return this.degradationEventHandler.applySettings(e)}setupAudioLevelProcessorCallbacks(){this.audioLevelCallbackManager.setupAudioLevelProcessorCallbacks()}setEmotion(e,t=null){return this.errorBoundary.wrap(()=>this.stateCoordinator.setEmotion(e,t),"emotion-setting",this)()}updateUndertone(e){return this.errorBoundary.wrap(()=>(this.stateMachine.applyUndertoneModifier(e),this.renderer&&this.renderer.updateUndertone&&this.renderer.updateUndertone(e),this),"undertone-update",this)()}setBPM(e){return this.errorBoundary.wrap(()=>(this.renderer?.setBPM&&this.renderer.setBPM(e),this),"bpm-update",this)()}setRotationSpeed(e){return this.errorBoundary.wrap(()=>(this.renderer?.setRotationSpeed&&this.renderer.setRotationSpeed(e),this),"rotation-speed-update",this)()}setRotationAngle(e){return this.errorBoundary.wrap(()=>(this.renderer?.setRotationAngle&&this.renderer.setRotationAngle(e),this),"rotation-angle-update",this)()}getPosition(){return this.animationFrameController.getPosition()}setGazeTracking(e){return this.errorBoundary.wrap(()=>(this.renderer&&this.renderer.setGazeTracking&&this.renderer.setGazeTracking(e),this),"gaze-tracking-update",this)()}express(e,t={}){return this.gestureController?this.gestureController.express(e,t):this}expressChord(e,t={}){return this.gestureController.expressChord(e,t)}executeGestureDirectly(e,t={}){this.gestureController.executeGestureDirectly(e,t),this.emit("gesture",{name:e,options:t})}chain(...e){return this.gestureController.chain(...e)}executeChainSequence(e){return this.gestureController.executeChainSequence(e)}perform(e,t={}){return this.performanceBehaviorManager.perform(e,t)}updateContext(e){return this.frustrationContextManager.updateContext(e)}getContext(){return this.emotionalStateQueryManager.getContext()}incrementFrustration(e=10){return this.frustrationContextManager.incrementFrustration(e)}decrementFrustration(e=10){return this.frustrationContextManager.decrementFrustration(e)}resetFrustration(){return this.frustrationContextManager.resetFrustration()}getAvailablePerformances(){return this.performanceBehaviorManager.getAvailablePerformances()}registerPerformance(e,t){return this.performanceBehaviorManager.registerPerformance(e,t)}getPerformanceAnalytics(){return this.performanceBehaviorManager.getPerformanceAnalytics()}getContextAnalytics(){return this.performanceBehaviorManager.getContextAnalytics()}startSpeaking(e){return this.speechManager?this.speechManager.startSpeaking(e):this}stopSpeaking(){return this.speechManager?this.speechManager.stopSpeaking():this}startRecording(){return this.recordingStateManager?this.recordingStateManager.startRecording():this}stopRecording(){return this.recordingStateManager?this.recordingStateManager.stopRecording():this}sleep(){return this.sleepWakeManager.sleep()}wake(){return this.sleepWakeManager.wake()}getTTSVoices(){return this.ttsManager.getTTSVoices()}isTTSSpeaking(){return this.ttsManager.isTTSSpeaking()}start(){return this.executionLifecycleManager.start()}stop(){return this.executionLifecycleManager.stop()}setBreathePattern(e,t,i,a){return this.breathingPatternManager?this.breathingPatternManager.setBreathePattern(e,t,i,a):this}setOrbScale(e,t=1e3,i="easeInOut"){return this.orbScaleAnimator?this.orbScaleAnimator.setOrbScale(e,t,i):this}breathe(e="calm"){return this.breathingPatternManager?this.breathingPatternManager.breathe(e):this}startBreathingAnimation(){this.breathingAnimationController.startBreathingAnimation()}stopBreathing(){return this.breathingPatternManager?this.breathingPatternManager.stopBreathing():this}on(e,t){return this.eventListenerManager.on(e,t)}off(e,t){return this.eventListenerManager.off(e,t)}once(e,t){return this.eventListenerManager.once(e,t)}removeAllListeners(e=null){return this.eventListenerManager.removeAllListeners(e)}listenerCount(e){return this.eventListenerManager.listenerCount(e)}getEventNames(){return this.eventListenerManager.getEventNames()}getEventStats(){return this.eventListenerManager.getEventStats()}getEventDebugInfo(){return this.eventListenerManager.getEventDebugInfo()}getBrowserCompatibility(){return this.diagnosticsManager.getBrowserCompatibility()}getDegradationStatus(){return this.performanceMonitoringManager.getDegradationStatus()}setDegradationLevel(e){return this.performanceMonitoringManager.setDegradationLevel(e)}isFeatureAvailable(e){return this.performanceMonitoringManager.isFeatureAvailable(e)}recoverCanvasContext(){return!!this.contextRecovery&&this.contextRecovery.recover()}isCanvasContextLost(){return!!this.contextRecovery&&this.contextRecovery.isLost()}getDebugReport(){return this.debugProfilingManager.getDebugReport()}exportDebugData(){return this.debugProfilingManager.exportDebugData()}startProfiling(e,t={}){this.debugProfilingManager.startProfiling(e,t)}endProfiling(e){return this.debugProfilingManager.endProfiling(e)}takeMemorySnapshot(e){this.debugProfilingManager.takeMemorySnapshot(e)}clearDebugData(){this.debugProfilingManager.clearDebugData()}getRuntimeCapabilities(){return this.debugProfilingManager.getRuntimeCapabilities()}emit(e,t=null){this.eventListenerManager.emit(e,t)}update(e){this.errorBoundary.wrap(()=>{this.visualizationRunner.update(e)},"audio-update")()}render(){try{const{renderStart:e,deltaTime:t,renderState:i}=this.renderStateBuilder.buildRenderState();this.debugMode&&To.trackFrameTiming(t),this.canvasManager.clear(),this.gazeTracker&&this.gazeTracker.update(t),this.threatLevelCalculator.updateThreatLevel(i);const a=c(i.emotion);this.renderer.setEmotionalState(i.emotion,a,i.undertone);const s=this.particleConfigCalculator.calculateParticleConfig(i,a),{orbX:n,orbY:r,particleBehavior:o,particleRate:l,minParticles:h,maxParticles:u}=s;this.particleSystem.spawn(o,i.emotion,l,n,r,t,null,h,u,this.renderer.particleScaleFactor||this.renderer.scaleFactor||1,this.config.classicConfig?.particleSizeMultiplier||1,a.particleColors||null,i.undertone);const d=this.particleConfigCalculator.getParticleModifier(i),{gestureMotion:p,gestureProgress:g}=this.gestureMotionProvider.getGestureMotion();this.particleSystem.update(t,n,r,p,g,d);const m=this.gestureMotionProvider.getGestureTransform();this.renderLayerOrchestrator.renderAllLayers({renderState:i,deltaTime:t,emotionParams:a,gestureTransform:m,renderStart:e})}catch(e){this.errorBoundary.logError(e,"main-render")}}renderDebugInfo(e){this.debugInfoRenderer.renderDebugInfo(e)}getEmotionalColor(){return this.emotionalStateQueryManager.getEmotionalColor()}getCurrentState(){return this.emotionalStateQueryManager.getCurrentState()}getAvailableEmotions(){return this.emotionalStateQueryManager.getAvailableEmotions()}getAvailableUndertones(){return this.emotionalStateQueryManager.getAvailableUndertones()}getAudioStats(){return this.speechReactivityManager.getAudioStats()}updateAudioConfig(e){this.speechReactivityManager.updateAudioConfig(e)}getAvailableGestures(){return this.emotionalStateQueryManager.getAvailableGestures()}connectAudioSource(e){return this.speechReactivityManager.connectAudioSource(e)}setVolume(e){return this.errorBoundary.wrap(()=>this.audioHandler.setVolume(e),"volume-setting",this)()}getVolume(){return this.config.masterVolume}setSoundEnabled(e){return this.config.soundEnabled=e,this}isSoundEnabled(){return this.config.soundEnabled}pause(){return this.executionLifecycleManager.pause()}resume(){return this.executionLifecycleManager.resume()}isActive(){return this.executionLifecycleManager.isActive()}setTargetFPS(e){return this.performanceMonitoringManager.setTargetFPS(e)}getTargetFPS(){return this.performanceMonitoringManager.getTargetFPS()}setPosition(e,t,i=0){return this.animationFrameController.setPosition(e,t,i)}animateToPosition(e,t,i=0,a=1e3,s="easeOutCubic"){return this.animationFrameController.animateToPosition(e,t,i,a,s)}clearParticles(){return this.visualTransformationManager.clearParticles()}setParticleSystemCanvasDimensions(e,t){return this.visualTransformationManager.setParticleSystemCanvasDimensions(e,t)}setPerformanceDegradation(e){return this.performanceMonitoringManager.setPerformanceDegradation(e)}getAudioLevel(){return this.speechReactivityManager.getAudioLevel()}isSpeaking(){return this.speechReactivityManager.isSpeaking()}setAudioSmoothing(e){return this.speechReactivityManager.setAudioSmoothing(e)}getSystemStatus(){return this.healthCheckManager.getSystemStatus()}setDebugMode(e){return this.healthCheckManager.setDebugMode(e)}triggerTestError(e="manual-test"){return this.healthCheckManager.triggerTestError(e)}getPerformanceMetrics(){return this.healthCheckManager.getPerformanceMetrics()}registerPlugin(e){return this.pluginSystem.registerPlugin(e)}setAccessibility(e){e.colorBlindMode&&this.accessibilityManager.setColorBlindMode(e.colorBlindMode),void 0!==e.reducedMotion&&(this.accessibilityManager.reducedMotionPreferred=e.reducedMotion),void 0!==e.highContrast&&(this.accessibilityManager.highContrastEnabled=e.highContrast)}getMobileStatus(){return this.healthCheckManager.getMobileStatus()}getAccessibilityStatus(){return this.healthCheckManager.getAccessibilityStatus()}setState(e){return this.setEmotion(e)}speak(e,t={}){return this.ttsManager.speak(e,t)}setTTSSpeaking(e){this.ttsManager.setTTSSpeaking(e)}getVoices(){return this.ttsManager.getVoices()}stopTTS(){this.ttsManager.stopTTS()}handleResize(e,t,i){this.visualTransformationManager.handleResize(e,t,i)}morphTo(e,t={}){return this.visualTransformationManager.morphTo(e,t)}connectAudio(e){return this.errorBoundary.wrap(()=>this.audioHandler.connectAudio(e),"connectAudio",this)()}disconnectAudio(){return this.errorBoundary.wrap(()=>this.audioHandler.disconnectAudio(),"disconnectAudio",this)()}setOffset(e,t,i=0){return this.visualTransformationManager.setOffset(e,t,i)}getOffset(){return this.visualTransformationManager.getOffset()}setBackdrop(e={}){return this.visualTransformationManager.setBackdrop(e)}getBackdrop(){return this.visualTransformationManager.getBackdrop()}animateOffset(e,t,i=0,a=1e3,s="easeOutCubic"){return this.visualTransformationManager.animateOffset(e,t,i,a,s)}getAvailableShapes(){return this.emotionalStateQueryManager.getAvailableShapes()}async handleLLMResponse(e,t={}){return this.llmIntegrationBridge.handleLLMResponse(e,t)}configureLLMHandler(e){return this.llmIntegrationBridge.configureLLMHandler(e)}getLLMResponseSchema(){return this.llmIntegrationBridge.getLLMResponseSchema()}static getLLMPromptTemplate(e={}){return Yc.getLLMPromptTemplate(e)}static getLLMEmotions(){return Yc.getLLMEmotions()}static getLLMActions(){return Yc.getLLMActions()}static getLLMShapes(){return Yc.getLLMShapes()}static getLLMGestures(){return Yc.getLLMGestures()}destroy(){this.destructionManager.destroy()}throttledWarn(e,t){const i=Date.now();i-(this.warningTimestamps[t]||0)>this.warningThrottle&&(this.warningTimestamps[t]=i)}}class Mu{constructor(e){this.Ht=e,this.Ut=null,this.Qt=0}getAudioBlob(){return this.Ut}getAudioDuration(){return this.Qt}setAudioDuration(e){this.Qt=e||0}async loadAudio(e){if(e instanceof Blob){this.Ut=e;const t=URL.createObjectURL(e);await this.Yt(t),URL.revokeObjectURL(t)}else await this.Yt(e)}async Yt(e){const t=new Audio(e);await new Promise((e,i)=>{t.addEventListener("loadedmetadata",()=>{this.Qt=1e3*t.duration,e()}),t.addEventListener("error",i),t.load()});const i=this.Ht();i&&i.soundSystem&&await i.soundSystem.loadAudioFromURL(e)}getAudioAnalysis(){const e=this.Ht();return e&&e.audioAnalyzer?{bpm:e.rhythmIntegration?.getBPM()||0,beats:e.rhythmIntegration?.getBeatMarkers()||[],energy:e.audioAnalyzer?.getEnergyLevel()||0,frequencies:e.audioAnalyzer?.getFrequencyData()||[]}:null}connectAudio(e){const t=this.Ht();if(!t)throw new Error("Engine not initialized. Call init() first.");t.connectAudio&&t.connectAudio(e)}disconnectAudio(e){const t=this.Ht();t&&t.disconnectAudio&&t.disconnectAudio(e)}getSpectrumData(){const e=this.Ht();return e&&e.audioAnalyzer?e.audioAnalyzer.dataArray?Array.from(e.audioAnalyzer.dataArray).map(e=>e/255):e.shapeMorpher&&e.shapeMorpher.frequencyData?Array.from(e.shapeMorpher.frequencyData):[]:[]}startRhythmSync(e){const t=this.Ht();if(!t)throw new Error("Engine not initialized. Call init() first.");t.rhythmIntegration&&(e&&t.rhythmIntegration.setBPM(e),t.rhythmIntegration.start())}stopRhythmSync(){const e=this.Ht();e&&e.rhythmIntegration&&e.rhythmIntegration.stop()}getInputEvaluator(e){const t=this.Ht();if(!t||!t.rhythmIntegration)return null;const i=t.rhythmIntegration.getInputEvaluator(e);return i&&!i.V&&t.stateCoordinator&&i.setEmotionTarget((e,i)=>{t.stateCoordinator.nudgeEmotion(e,i)}),i}getLayers(){const e=this.Ht();return e&&e.soundSystem?e.soundSystem.getAudioLayerManager():null}}class Su{constructor(e,t){this.Ht=e,this.it=t,this.Xt={rise:"breathe > sway+lean+tilt",flow:"sway > lean+tilt > spin > bounce",burst:"jump > nod > shake > flash",drift:"sway+breathe+float+drift",chaos:"shake+shake > spin+flash > bounce+pulse > twist+sparkle",morph:"expand > contract > morph+glow > expand+flash",rhythm:"pulse > pulse+sparkle > pulse+flicker",spiral:"spin > orbital > twist > orbital+sparkle",routine:"nod > bounce > spin+sparkle > sway+pulse > nod+flash",radiance:"sparkle > pulse+flicker > shimmer",twinkle:"sparkle > flash > pulse+sparkle > shimmer+flicker",stream:"wave > nod+pulse > sparkle > flash"}}triggerGesture(e,t){const i=this.Ht();if(!i)throw new Error("Engine not initialized. Call init() first.");if(this.it.isRecording()){const i=t||Date.now()-this.it.startTime();this.it.timeline().push({type:"gesture",name:e,time:i})}i.express(e)}express(e,t){return this.triggerGesture(e,t)}chain(e){const t=this.Ht();if(!t)throw new Error("Engine not initialized. Call init() first.");const i=this.Xt[e.toLowerCase()];i&&(i.includes(">")?i.split(">").map(e=>e.trim()).filter(e=>e.length>0).forEach((e,i)=>{setTimeout(()=>{e.split("+").map(e=>e.trim()).filter(e=>e.length>0).forEach(e=>{t.express(e)})},500*i)}):i.split("+").map(e=>e.trim()).filter(e=>e.length>0).forEach(e=>{t.express(e)}))}updateUndertone(e){const t=this.Ht();if(!t)throw new Error("Engine not initialized. Call init() first.");t.updateUndertone&&"function"==typeof t.updateUndertone?t.updateUndertone(e):t.addUndertone&&"function"==typeof t.addUndertone&&t.addUndertone(e)}getAvailableChains(){return Object.keys(this.Xt)}getChainDefinition(e){return this.Xt[e.toLowerCase()]||null}}class xu{constructor(e,t,i){this.Ht=e,this.Nt=t,this.Ne=i,this.Jt=new Set}startRecording(){this.Ne.timeline.length=0,this.Ne.isRecording=!0,this.Ne.recordingStartTime=Date.now()}stopRecording(){return this.Ne.isRecording=!1,[...this.Ne.timeline]}playTimeline(e){if(!e||!e.length)return void(this.Ne.isPlaying=!1);this.Ne.isPlaying=!0,this.Ne.playbackStartTime=Date.now(),e.forEach(e=>{const t=setTimeout(()=>{if(this.Jt.delete(t),!this.Ne.isPlaying)return;const i=this.Ht();if(i)switch(e.type){case"gesture":i.express(e.name);break;case"emotion":i.setEmotion(e.name);break;case"shape":i.morphTo(e.name)}},e.time);this.Jt.add(t)});const t=Math.max(...e.map(e=>e.time)),i=setTimeout(()=>{this.Jt.delete(i),this.Ne.isPlaying=!1},t);this.Jt.add(i)}stopPlayback(){this.Ne.isPlaying=!1,this.Jt.forEach(e=>clearTimeout(e)),this.Jt.clear()}getTimeline(){return[...this.Ne.timeline]}loadTimeline(e){this.Ne.timeline.length=0,this.Ne.timeline.push(...e)}exportTimeline(){return JSON.stringify({version:"1.0",duration:this.Nt.getAudioDuration()||0,events:this.Ne.timeline})}importTimeline(e){const t=JSON.parse(e);this.Ne.timeline.length=0,this.Ne.timeline.push(...t.events||[]),this.Nt.setAudioDuration(t.duration||0)}getCurrentTime(){return this.Ne.isPlaying?Date.now()-this.Ne.playbackStartTime:0}seek(e){const t=this.Ne.timeline.filter(t=>t.time<=e),i={};t.forEach(e=>{i[e.type]=e});const a=this.Ht();a&&(i.emotion&&a.setEmotion(i.emotion.name),i.shape&&a.morphTo(i.shape.name))}getAnimationData(){const e=this.Ht();return{timeline:[...this.Ne.timeline],duration:this.Nt.getAudioDuration()||0,currentTime:this.getCurrentTime(),emotion:e?.state?.emotion||"neutral",shape:e?.state?.currentShape||"circle"}}destroy(){this.stopPlayback(),this.Ht=null,this.Nt=null,this.Ne=null}}class ku{constructor(e,t,i){this.Ht=e,this.Zt=t,this.Kt=i,this.ei=null,this.ti=null,this.ii=!1,this.ai=null}attachToElement(e,t={}){if(!this.Ht())throw new Error("Engine not initialized. Call init() first.");const i="string"==typeof e?document.querySelector(e):e;if(!i)return this.Kt;this.ei=i,this.ti={offsetX:t.offsetX||0,offsetY:t.offsetY||0,animate:!1!==t.animate,duration:t.duration||1e3,scale:t.scale||1,containParticles:!1!==t.containParticles};const a=i.getBoundingClientRect();return this.ti.containParticles?this.Kt.setContainment({width:a.width,height:a.height},this.ti.scale):1!==this.ti.scale&&this.Kt.setContainment(null,this.ti.scale),this.Zt()&&this.si(),this.ni(),this.Kt}si(){if(!this.ei)return;if(!this.Zt())return;const e=this.ei.getBoundingClientRect(),t=window.innerWidth/2,i=window.innerHeight/2,a=e.left+e.width/2,s=e.top+e.height/2,n=a-t+this.ti.offsetX,r=s-i+this.ti.offsetY,o=!this.ii;this.ii=!0,o&&this.ti.animate?this.Kt.animateToPosition(n,r,0,this.ti.duration):this.Kt.setPosition(n,r,0)}ni(){this.ai||(this.ai={scroll:()=>this.si(),resize:()=>this.si()},window.addEventListener("scroll",this.ai.scroll,{passive:!0}),window.addEventListener("resize",this.ai.resize))}isAttachedToElement(){return!!this.ei}detachFromElement(){return this.ei=null,this.ai&&(window.removeEventListener("scroll",this.ai.scroll),window.removeEventListener("resize",this.ai.resize),this.ai=null),this.Kt.setContainment(null,1),this.Kt.setEmotion("neutral"),this.Kt.morphTo("sphere",{duration:800}),this.Kt}cleanup(){this.ai&&(window.removeEventListener("scroll",this.ai.scroll),window.removeEventListener("resize",this.ai.resize),this.ai=null),this.ei=null}}class Ou{constructor(e,t){this.Ht=e,this.Zt=t}setContainment(e,t=1){const i=this.Ht();if(!i)throw new Error("Engine not initialized. Call init() first.");i.particleSystem&&i.particleSystem.setContainmentBounds(e),i.positionController&&(i.positionController.coreScaleOverride=t,i.positionController.particleScaleOverride=t),i.particleSystem&&i.particleSystem.particles&&i.particleSystem.particles.forEach(e=>{e.scaleFactor=t,e.size=e.baseSize*t})}clearParticles(){const e=this.Ht();if(!e)throw new Error("Engine not initialized. Call init() first.");e.particleSystem&&e.particleSystem.clear()}setParticleSystemCanvasDimensions(e,t){const i=this.Ht();if(!i)throw new Error("Engine not initialized. Call init() first.");i.setParticleSystemCanvasDimensions&&i.setParticleSystemCanvasDimensions(e,t)}getFrameData(e="png"){const t=this.Zt();return t?t.toDataURL(`image/${e}`):null}getFrameBlob(e="png"){const t=this.Zt();return t?new Promise(i=>{t.toBlob(e=>i(e),`image/${e}`)}):Promise.resolve(null)}}const Au=["bouncing up and down","hopping around","rocking back and forth","side to side","light on feet","spring in step","leaning forward","leaning in","leaning closer","leaning toward","reaching out","reaching toward","pointing at","pointing to","waving hello","waving goodbye","nodding head","shaking head","head shake","head nod","head bob","head tilt","deep breath","taking a breath","breathing deeply","settling down","calming down","winding down","getting bigger","getting smaller","puffing up","spinning around","twirling around","at peace","in love","on cloud nine","over the moon","on top of the world","in awe","grossed out","freaked out","low key","low-key","high key","on edge","keyed up","wound up","low energy","no energy","running low","just a bit","just a little","a little bit","kind of","sort of","a bit","a little","a lot","over the top","off the charts","through the roof","split second","one time","few times","many times","again and again","over and over","on repeat","blood moon","full moon","new moon","half moon","solar eclipse","lunar eclipse","total eclipse","ring of fire","diamond ring","killing it","crushing it","nailed it","sussy baka","side eye"],Cu=/[,;|/]+/,Iu=new Set(["a","an","the","is","are","am","be","being","been","i","me","my","it","its","to","of","for","with","as","this","that","these","those","just","only","also","too","please","pls","plz"]),zu=new Set(["but","and","or","yet","while","although","not","no","never","very","really","so","quite","rather","slightly","barely","extremely","completely","feeling","feel","feels","become","becoming","morph","morphing"]);function Fu(e){return e.toLowerCase().trim().replace(/['']/g,"'").replace(/[""]/g,'"').replace(/\s+/g," ")}function Du(e){return["but","and","or","yet","while","although","with"].includes(e)}function qu(e){return["not","no","never","don't","dont","doesn't","doesnt","isn't","isnt"].includes(e)}const Ru={nervous:{candidates:[{category:"emotion",target:"fear",priority:1},{category:"undertone",target:"nervous",priority:2}],rule:"standalone_is_emotion",examples:[{input:"nervous",resolved:{emotion:"fear"}},{input:"happy but nervous",resolved:{emotion:"joy",undertone:"nervous"}}]},anxious:{candidates:[{category:"emotion",target:"fear",priority:1},{category:"undertone",target:"nervous",priority:2}],rule:"standalone_is_emotion"},confident:{candidates:[{category:"emotion",target:"trust",priority:2},{category:"undertone",target:"confident",priority:1}],rule:"prefer_undertone",examples:[{input:"confident",resolved:{undertone:"confident"}},{input:"feeling confident",resolved:{emotion:"trust"}}]},tired:{candidates:[{category:"emotion",target:"sadness",priority:2},{category:"undertone",target:"tired",priority:1}],rule:"prefer_undertone",examples:[{input:"tired",resolved:{undertone:"tired"}},{input:"feeling tired",resolved:{emotion:"sadness",undertone:"tired"}}]},intense:{candidates:[{category:"undertone",target:"intense",priority:1},{category:"modifier",target:"intensity.very",priority:2}],rule:"prefer_undertone"},curious:{candidates:[{category:"emotion",target:"focused",priority:1},{category:"gesture",target:"lean",priority:2}],rule:"standalone_is_emotion",examples:[{input:"curious",resolved:{emotion:"focused"}},{input:"curious, leaning in",resolved:{emotion:"focused",gesture:"lean"}}]},interested:{candidates:[{category:"emotion",target:"focused",priority:1},{category:"gesture",target:"lean",priority:2}],rule:"standalone_is_emotion"},excited:{candidates:[{category:"emotion",target:"joy",priority:1},{category:"gesture",target:"bounce",priority:3}],rule:"standalone_is_emotion"},shaking:{candidates:[{category:"gesture",target:"shake",priority:1},{category:"emotion",target:"fear",priority:2}],rule:"standalone_is_gesture"},nodding:{candidates:[{category:"gesture",target:"nod",priority:1}],rule:"always_gesture"},glowing:{candidates:[{category:"gesture",target:"glow",priority:1},{category:"shape",target:"sun",priority:3}],rule:"standalone_is_gesture"},spinning:{candidates:[{category:"gesture",target:"spin",priority:1}],rule:"always_gesture"},love:{candidates:[{category:"emotion",target:"love",priority:1},{category:"shape",target:"heart",priority:2}],rule:"standalone_is_emotion",examples:[{input:"love",resolved:{emotion:"love"}},{input:"love heart",resolved:{emotion:"love",shape:"heart"}},{input:"become love",resolved:{shape:"heart"}}]},suspicious:{candidates:[{category:"emotion",target:"suspicion",priority:1},{category:"shape",target:"suspicion",priority:2}],rule:"standalone_is_emotion"},bright:{candidates:[{category:"emotion",target:"joy",priority:2},{category:"shape",target:"sun",priority:3},{category:"modifier",target:"intensity.very",priority:4}],rule:"context_dependent"},yes:{candidates:[{category:"gesture",target:"nod",priority:1}],rule:"always_gesture"},no:{candidates:[{category:"gesture",target:"shake",priority:1}],rule:"always_gesture"},agree:{candidates:[{category:"gesture",target:"nod",priority:1},{category:"emotion",target:"trust",priority:2}],rule:"standalone_is_gesture"},disagree:{candidates:[{category:"gesture",target:"shake",priority:1}],rule:"always_gesture"}},Bu={emotionContext:["feeling","feel","feels","felt","emotion","emotional","emotionally","mood","moody","state","am","is","are","being","becoming","become","grew","growing"],gestureContext:["do","doing","does","did","perform","performing","action","move","moving","movement","start","starting","begin","beginning","physically","motion"],shapeContext:["morph","morphing","morphed","transform","transforming","transformed","become","becoming","turn into","shape","form","look like","change to","change into"],undertoneContext:["but","yet","while","although","with","and also","mixed with","underneath","underlying","beneath","a bit","slightly","somewhat"],modifierContext:["very","really","so","extremely","slightly","barely","completely","quickly","slowly","briefly"]};function Eu(e,t,i){const a=Bu[`${i}Context`];if(!a)return!1;const s=Math.max(0,t-3),n=Math.min(e.length,t+4);for(let i=s;i<n;i++)if(i!==t&&a.includes(e[i]))return!0;return!1}function Pu(e,t){switch(t){case"emotion":return null!==e.emotion;case"gesture":return e.gestures&&e.gestures.length>0;case"shape":return null!==e.shape;case"undertone":return null!==e.undertone;default:return!1}}function Tu(e,t,i,a){const s=Ru[e];if(!s)return null;const{candidates:n,rule:r}=s;if(1===n.length)return n[0];switch(r){case"standalone_is_emotion":if(Pu(a,"emotion")){const e=n.find(e=>"emotion"!==e.category);if(e)return e}return Eu(t,i,"emotion"),n.find(e=>"emotion"===e.category)||n[0];case"standalone_is_gesture":if(Pu(a,"gesture")){const e=n.find(e=>"gesture"!==e.category);if(e)return e}return Eu(t,i,"gesture"),n.find(e=>"gesture"===e.category)||n[0];case"prefer_undertone":return Eu(t,i,"emotion")?n.find(e=>"emotion"===e.category)||n[0]:n.find(e=>"undertone"===e.category)||n[0];case"always_gesture":return n.find(e=>"gesture"===e.category)||n[0];case"always_emotion":return n.find(e=>"emotion"===e.category)||n[0];case"context_dependent":for(const e of["emotion","gesture","shape","undertone"])if(Eu(t,i,e)){const t=n.find(t=>t.category===e);if(t)return t}return n.sort((e,t)=>e.priority-t.priority)[0];default:return n.sort((e,t)=>e.priority-t.priority)[0]}}function ju(e){return e in Ru}const Vu={neutral:["neutral","default","normal","baseline","standard","nothing special","nothing particular","no strong feeling","not much","meh","whatever","indifferent","balanced","even","steady","stable","centered","level","middle ground","in between","ready","waiting","standing by","at attention","present","here","available","attentive","reset","clear","blank","empty","clean slate"],joy:["happy","joy","joyful","joyous","pleased","glad","content","satisfied","gratified","comfortable","good","cheerful","cheery","merry","jovial","jolly","upbeat","sunny","bright","lighthearted","buoyant","delighted","thrilled","overjoyed","elated","jubilant","exultant","gleeful","glowing","beaming","radiant","pumped","stoked","psyched","amped","hyped","vibing","living","slaying","winning","lit","fire","sick","dope","chuffed","pleased as punch","over the moon","made up","tickled","tickled pink","felicitous","beatific","blissful","smiling","grinning","laughing","giggling"],calm:["calm","peaceful","serene","tranquil","relaxed","at ease","comfortable","loose","unwound","decompressed","chilled","still","quiet","hushed","silent","soft","gentle","mild","placid","smooth","composed","collected","centered","grounded","untroubled","unworried","unbothered","unfazed","meditative","zen","mindful","contemplative","reflective","introspective","soothed","eased","mellowed","softened","chill","coasting","floating","drifting","laid back","easy going","low key","sorted","easy peasy"],excited:["excited","exciting","excitable","enthusiastic","eager","keen","avid","passionate","fervent","ardent","zealous","energetic","energized","animated","lively","spirited","vivacious","vibrant","dynamic","bouncy","peppy","perky","sprightly","anticipating","expectant","looking forward","itching","raring","chomping at the bit","fired up","charged","electric","electrified","buzzing","tingling","crackling","sparking","jazzed","juiced","geeked","hype","turnt","going off","well excited","buzzing","restless","fidgety","antsy","jumpy","twitchy","keyed up","wound up"],sadness:["sad","sadness","saddened","unhappy","down","low","blue","glum","bummed","disappointed","let down","discouraged","disheartened","dispirited","deflated","melancholy","melancholic","somber","gloomy","mournful","sorrowful","doleful","woeful","heavy-hearted","downcast","crestfallen","heartbroken","devastated","crushed","shattered","despairing","despondent","desolate","inconsolable","grief","grieving","mourning","bereft","empty","hollow","numb","void","wistful","longing","yearning","pining","nostalgic","bummed out","down in the dumps","in a funk","in the dumps","feeling low","gutted","choked","crying","tearful","weeping","sobbing","sighing","drooping","wilting","slumping"],anger:["angry","anger","angered","mad","annoyed","irritated","bothered","irked","peeved","miffed","vexed","displeased","put out","ticked off","ticked","frustrated","aggravated","exasperated","fed up","sick of","had enough","cross","upset","worked up","furious","enraged","livid","irate","incensed","infuriated","outraged","seething","fuming","boiling","burning","smoldering","raging","ballistic","apoplectic","berserk","seeing red","losing it","pissed","pissed off","salty","pressed","triggered","tilted","heated","steaming","narked","cheesed off","brassed off","shirty","stroppy","mardy","ropeable","filthy","spewing","clenching","tensing","grinding"],fear:["afraid","scared","fear","fearful","uneasy","unsettled","apprehensive","wary","concerned","worried","jittery","shaky","trembling","quivering","tense","tight","clenched","knotted","frightened","alarmed","startled","spooked","freaked","freaked out","creeped out","on edge","rattled","unnerved","terrified","petrified","horrified","panicked","panic","panicking","terror","dread","paranoid","distrustful","looking over shoulder","sketched","sketched out","wigged out","shook","bricking it","having kittens","in a flap","frozen","paralyzed","deer in headlights","heart racing","heart pounding","sweating"],surprise:["surprised","surprise","surprising","oh","huh","hmm","interesting","unexpected","caught off guard","astonished","amazed","astounded","startled","taken aback","struck","shocked","stunned","staggered","floored","dumbfounded","flabbergasted","gobsmacked","blown away","mind blown","speechless","wow","whoa","omg","no way","incredible","unbelievable","amazing","alarmed","dismayed","appalled","bewildered","baffled","perplexed","puzzled","confused","disoriented","thrown","shooketh","gagged","dead","wait what","blimey","crikey","bloody hell","jaw dropped","eyes wide","double take","gasp","gasping"],disgust:["disgusted","disgust","disgusting","distaste","dislike","aversion","put off","turned off","off-putting","repulsed","revolted","repelled","grossed out","creeped out","icked out","sickened","nauseated","nauseous","appalled","horrified","scandalized","offended","outraged","indignant","contempt","contemptuous","disdain","scorn","gagging","retching","cringing","wincing","recoiling","shrinking back","gross","ew","eww","yuck","yucky","ick","nasty","foul","vile","rank","minging","manky","grotty"],love:["love","loving","loved","affection","affectionate","fond","fondness","tender","tenderness","gentle","caring","care","nurturing","supportive","protective","devoted","dedicated","warm","warmth","warm-hearted","kind","kind-hearted","compassionate","sympathetic","adoring","adore","cherish","cherishing","treasure","treasuring","doting","romantic","amorous","passionate","smitten","infatuated","enamored","besotted","head over heels","falling for","connected","bonded","attached","close","intimate","deep","profound","heart eyes","crushing","swooning","melting","hugging","embracing","holding","cuddling","snuggling","nuzzling"],euphoria:["euphoric","euphoria","bliss","blissful","transcendent","otherworldly","sublime","heavenly","divine","ethereal","celestial","ecstatic","ecstasy","rapture","rapturous","exultant","exalted","elevated","peak","pinnacle","height","climax","breakthrough","revelation","epiphany","overwhelming joy","pure joy","absolute joy","complete happiness","total bliss","floating","soaring","flying","weightless","radiating","shining","on cloud nine","in heaven","on top of the world","walking on air","living my best life","ascended"],focused:["focused","focus","focusing","concentrating","concentration","concentrated","attentive","attention","attending","thinking","thought","thoughtful","pondering","considering","contemplating","reflecting","musing","mulling","engaged","absorbed","immersed","engrossed","rapt","riveted","captivated","enthralled","intent","determined","resolute","single-minded","laser focused","zeroed in","working","processing","analyzing","examining","studying","learning","figuring out","locked in","dialed in","in the zone","flow state","deep work","grinding","staring","gazing","peering","squinting","furrowed brow"],suspicion:["suspicious","suspicion","suspect","doubtful","doubt","doubting","skeptical","skepticism","questioning","uncertain","unsure","unconvinced","wary","cautious","guarded","careful","leery","circumspect","vigilant","distrustful","mistrust","mistrustful","disbelieving","incredulous","unbelieving","scrutinizing","examining","assessing","evaluating","judging","sizing up","sus","sussy","suss","side eye","giving side eye","side-eyeing","eyeing","not buying it","narrowed eyes","squinting","raised eyebrow","cocked head","tilted head","looking askance"],resting:["resting","rest","restful","tired","weary","fatigued","exhausted","drained","spent","depleted","worn out","sleepy","drowsy","dozy","groggy","yawning","nodding off","drifting off","sluggish","lethargic","listless","languid","lazy","idle","inactive","recovering","recuperating","recharging","winding down","powering down","shutting down","sleeping","asleep","slumbering","dozing","napping","snoozing","zonked","wiped","beat","dead tired","running on empty","out of gas","crashed","knackered","shattered","cream crackered"],glitch:["glitch","glitchy","glitching","malfunction","malfunctioning","broken","bugged","buggy","error","erroring","corrupted","corruption","scrambled","garbled","distorted","warped","static","noise","interference","pixelated","artifacting","tearing","haywire","fritzing","shorting out","going crazy","spazzing","unstable","erratic","unpredictable","flickering","stuttering","lagging","does not compute","syntax error","crash"]},$u={nervous:["nervous","nervously","anxious","anxiously","worried","worriedly","uneasy","uneasily","apprehensive","jittery","shaky","trembling","quivering","fidgety","restless","twitchy","tense","tensely","on edge","edgy","keyed up","wound up","uptight","self-conscious","awkward","awkwardly","hesitant","hesitantly","uncertain","uncertainly","sketchy","stressed","stressing","low-key panicking","kinda freaking out"],confident:["confident","confidently","confidence","assured","assuredly","certain","certainly","sure","surely","positive","positively","bold","boldly","brave","bravely","daring","daringly","fearless","fearlessly","strong","strongly","powerful","powerfully","firm","firmly","solid","solidly","authoritative","commanding","assertive","decisive","decisively","resolute","resolutely","poised","self-assured","unflappable","unfazed","owning it","killing it","crushing it","boss","like a boss"],tired:["tired","tiredly","tiredness","exhausted","weary","wearily","fatigued","drained","spent","depleted","sluggish","sluggishly","slow","slowly","lethargic","listless","languid","low energy","no energy","out of energy","running low","running on fumes","droopy","drooping","sagging","slumping","heavy","weighted","dragging","wiped","beat","dead","zonked","burned out","fried","cooked","toast"],intense:["intense","intensely","intensity","heightened","elevated","amplified","magnified","increased","enhanced","forceful","forcefully","powerful","powerfully","fierce","fiercely","strong","strongly","passionate","passionately","fervent","fervently","ardent","ardently","vehement","vehemently","sharp","sharply","acute","acutely","keen","keenly","piercing","piercingly","extreme","extremely","deeply","profoundly","tremendously","immensely","incredibly","super","mega","ultra","hella","mad","crazy"],subdued:["subdued","subduedly","soft","softly","gentle","gently","mild","mildly","light","lightly","restrained","held back","contained","tempered","moderated","toned down","quiet","quietly","hushed","muted","understated","subtle","subtly","modest","modestly","humble","humbly","reserved","demure","unassuming","faint","faintly","dim","dimly","pale","faded","washed out","low key","lowkey","easy","easy going"],clear:["clear","clearly","pure","purely","clean","cleanly","simple","simply","plain","plainly","direct","directly","straightforward","honest","honestly","frank","frankly","transparent","transparently","open","openly","obvious","obviously","evident","evidently","unmodified","unaltered","unchanged","normal","normally","regular","regularly","standard","basic","baseline"]},Wu={breathe:["breathe","breathing","breath","inhale","inhaling","exhale","exhaling","sigh","sighing","respire","respiring","deep breath","deep breathing","slow breath","slow breathing","long breath","full breath","breathing deeply","breathing slowly","taking a breath","take a breath","catching breath","breath work","breathwork","inhale exhale","in and out","meditative breathing","calming breath","cleansing breath","relaxing breath","centering breath","mindful breathing"],expand:["expand","expanding","grow","growing","enlarge","enlarging","swell","swelling","bloat","bloating","getting bigger","growing larger","puffing up","expanding outward"],contract:["contract","contracting","shrink","shrinking","compress","compressing","reduce","reducing","getting smaller","shrinking down","pulling in","contracting inward"],pulse:["pulse","pulsing","pulsate","pulsating","throb","throbbing","beat","beating","pulsing gently","steady pulse","heartbeat","heart beat"],sway:["sway","swaying","swing","swinging","oscillate","oscillating","swaying gently","gentle sway","side to side","swaying motion"],float:["float","floating","hover","hovering","glide","gliding","levitate","levitating","weightless","weightlessness","buoyant","airy","floating gently","hovering in place","light as air","floating freely"],floatUp:["float up","floating up","floating upward","rise","rising","ascend","ascending","lift","lifting","lifted up","soar","soaring","going up"],floatDown:["float down","floating down","floating downward","descend","descending","sink","sinking","lower","lowering","going down"],floatLeft:["float left","floating left","drift left","drifting left"],floatRight:["float right","floating right","drift right","drifting right"],bob:["bob","bobbing","bobbing up and down","gentle bob"],lean:["lean","leaning","incline","inclining","leaning in","lean in","leaning forward","lean forward","leaning toward","lean toward","leaning closer","lean closer","moving closer","coming closer","drawing near","approaching","interested","intrigued","engaged","attentive","listening closely","paying attention"],leanLeft:["lean left","leaning left","tilt left","tilting left"],leanRight:["lean right","leaning right","tilt right","tilting right"],jitter:["jitter","jittering","jittery","stutter","stuttering","jittering around","slight jitter","nervous jitter"],twitch:["twitch","twitching","twitchy","spasm","spasming","flinch","flinching","quick twitch","nervous twitch","sudden movement"],vibrate:["vibrate","vibrating","vibration","buzz","buzzing","hum","humming","quiver","quivering","vibrating slightly","gentle buzz","low hum","subtle vibration"],shake:["shake","shaking","shaky","shudder","shuddering","tremble","trembling","quake","quaking","no","nope","nah","disagree","disagreeing","refuse","refusing","deny","denying","shaking head","shake head","head shake","saying no","shaking no"],wiggle:["wiggle","wiggling","wiggly","jiggle","jiggling","jiggly","squirm","squirming","wriggle","wriggling","wiggling around","little wiggle","happy wiggle","excited wiggle"],stepLeft:["step left","stepping left","sidestep left","move left","moving left","shift left"],stepRight:["step right","stepping right","sidestep right","move right","moving right","shift right"],stepUp:["step up","stepping up","step forward"],stepDown:["step down","stepping down","step back"],slideLeft:["slide left","sliding left","glide left"],slideRight:["slide right","sliding right","glide right"],runningman:["running man","runningman","running man dance","run in place","running in place"],charleston:["charleston","charleston dance","swing dance","kick step","kick and step"],hula:["hula","hula-ing","hip sway","swaying hips","circular sway","round motion","hula motion","hula dance"],twist:["twist","twisting","twisty","contort","contorting","do the twist","twisting dance","twisting around","getting twisted"],pop:["pop","popping","pop and lock","popping motion","hit","hitting"],flare:["flare","flaring","dramatic flare","flourish"],swell:["swell","swelling","surge","surging","crescendo"],swagger:["swagger","swaggering","strut","strutting","confident walk","cocky"],dip:["dip","dipping","drop","dropping down","low dip","dance dip"],bounce:["bounce","bouncing","bouncy","hop","hopping","hoppy","spring","springing","springy","boing","boinging","bouncing up and down","hopping around","spring in step","light on feet"],orbit:["orbit","orbiting","circle","circling","revolve","revolving","circling around","going around","rotating slowly","orbital motion"],orbitLeft:["orbit left","orbiting left","circle left","counter-clockwise","counterclockwise"],orbitRight:["orbit right","orbiting right","circle right","clockwise"],orbitUp:["orbit up","orbiting up","rising orbit","spiral up","spiraling up"],orbitDown:["orbit down","orbiting down","descending orbit","spiral down","spiraling down"],sparkle:["sparkle","sparkling","sparkly","twinkle","twinkling","twinkly","glitter","glittering","glittery","shine","shining","shiny","celebrate","celebrating","celebration","celebratory","festive","party","partying","victory","triumphant","triumph","winning","success","successful","achievement","accomplished","nailed it","slay","slaying","killing it","yasss","yay","woo","woohoo"],shimmer:["shimmer","shimmering","shimmery","glisten","glistening","gleam","gleaming","lustrous","luminous","soft shimmer","gentle gleam","shimmering light","pearlescent"],groove:["groove","grooving","groovy","dance","dancing","boogie","boogying","funk","funky","rhythmic","moving to music","feeling the music","in the groove","getting down","busting a move","doing a little dance"],jump:["jump","jumping","jumpy","leap","leaping","bound","bounding","jumping up","leap up","spring up","jumping for joy"],jumpDown:["jump down","jumping down","drop down"],jumpLeft:["jump left","jumping left","leap left"],jumpRight:["jump right","jumping right","leap right"],lunge:["lunge","lunging","thrust","thrusting","charge forward","aggressive step"],lungeForward:["lunge forward","lunging forward","thrust forward"],lungeBack:["lunge back","lunging back","retreat lunge"],rushForward:["rush forward","rushing forward","dash forward","sprint","sprinting","charge","charging"],rushBack:["rush back","rushing back","dash back","retreat quickly"],spin:["spin","spinning","twirl","twirling","whirl","whirling","rotate","rotating","turn","turning","spinning around","quick spin","full rotation","twirling around"],spinLeft:["spin left","spinning left","turn left","rotate left","counter-clockwise spin"],spinRight:["spin right","spinning right","turn right","rotate right","clockwise spin"],flip:["flip","flipping","somersault","somersaulting","front flip","frontflip"],backflip:["backflip","back flip","backflipping","back somersault","flip backward"],point:["point","pointing","indicate","indicating","gesture","gesturing","direct","directing","pointing at","pointing to","pointing toward","gesturing toward","showing","directing attention"],pointUp:["point up","pointing up","pointing upward","look up","look to the sky"],pointDown:["point down","pointing down","pointing downward","look down","look at this"],pointLeft:["point left","pointing left","gesture left"],pointRight:["point right","pointing right","gesture right"],kickLeft:["kick left","kicking left","left kick"],kickRight:["kick right","kicking right","right kick"],bow:["bow","bowing","curtsy","curtseying","reverence","showing respect","take a bow","bow down"],nod:["nod","nodding","yes","yeah","yep","yup","agree","agreeing","acknowledge","acknowledging","confirm","confirming","accept","accepting","approve","approving","understand","understanding","got it","gotcha","i see","makes sense","understood","nodding head","nod head","head nod","nodding along","nodding yes"],reach:["reach","reaching","extend","extending","reaching out","reach out","reaching toward","reach toward","extending toward","offer","offering","present","presenting","give","giving","help","helping"],headBob:["headbob","head bob","headbobbing","head bobbing","nodding to beat","nodding to music","bobbing along","bobbing to rhythm","vibing","jamming","bobbing head","bob head","feeling the beat","moving to music"],wave:["wave","waving","greet","greeting","hello","hi","hey","goodbye","bye","farewell","welcome","welcoming","waving hello","waving goodbye","friendly wave","waving hand"],crouch:["crouch","crouching","squat","squatting","hunker","hunkering","duck","ducking","get low","getting low"],tilt:["tilt","tilting","tilted","angle","angling","angled","cock","cocking","cocked","tilting head","tilt head","cocking head","curious tilt","angling sideways","head tilt"],tiltUp:["tilt up","tilting up","look up","looking up"],tiltDown:["tilt down","tilting down","look down","looking down"],tiltLeft:["tilt left","tilting left","head tilt left"],tiltRight:["tilt right","tilting right","head tilt right"],recoil:["recoil","recoiling","flinch","flinching","wince","wincing","pull back","pulling back","jerk back","snap back"],knockdown:["knockdown","knock down","knocked down","fall","falling","fell","topple","toppling","take a hit","got hit"],knockout:["knockout","knock out","knocked out","KO","ko'd","lights out","out cold"],squash:["squash","squashing","squashed","flatten","flattening","flattened","compress","compressed","smoosh","smooshed"],stretch:["stretch","stretching","stretchy","elongate","elongating","lengthen","lengthening","stretching out","big stretch","reaching up","stretching tall"],inflate:["inflate","inflating","inflated","puff up","puffing up","puffed up","balloon","ballooning"],deflate:["deflate","deflating","deflated","let air out","losing air","shrivel","shriveling"],pancake:["pancake","pancaked","pancaking","flatten completely","totally flat","squished flat","smooshed flat"],rage:["rage","raging","furious","fury","angry","anger","mad","livid","enraged","seeing red","lose temper","losing it"],fury:["fury","furious","quick anger","flash of anger","snap","snapping"],battlecry:["battlecry","battle cry","war cry","roar","yell","yelling","scream","screaming","rallying cry"],charge:["charge","charging","rush","rushing","attack","attacking","assault","advance"],wobble:["wobble","wobbling","wobbly","unstable","unsteady","drunk","dizzy","off balance","losing balance"],teeter:["teeter","teetering","totter","tottering","about to fall","precarious","on edge","unbalanced"],rock:["rock","rocking","soothing rock","gentle rocking","back and forth","rocking motion"],pendulum:["pendulum","pendulum motion","swing back and forth","swinging","hypnotic swing","metronome"],shatter:["shatter","shattering","shattered","break","breaking","broken","smash","smashing","smashed","fragment","fragmenting","explode into pieces","break apart"],shatterExplosive:["explosive shatter","explode","exploding","blow up","blowing up","detonate","detonating","big explosion","kaboom"],shatterCrumble:["crumble","crumbling","fall apart","falling apart","disintegrate","disintegrating","collapse","collapsing"],dissolveUp:["dissolve up","dissolving up","evaporate","evaporating","fade up","rising dust"],dissolveDown:["dissolve down","dissolving down","melt","melting","drip away","dripping"],dissolveAway:["dissolve away","dissolving away","blow away","scatter in wind","dust in wind","fade to dust"],morph:["morph","morphing","transform","transforming","shape shift","shapeshifting","change form","metamorphose"],rain:["rain","raining","shower","showering","drip","dripping","pour","pouring","raining down","particles falling","gentle rain","shower of particles"],drift:["drift","drifting","waft","wafting","float gently","gentle drift"],driftUp:["drift up","drifting up","rising mist","float upward","waft up"],driftDown:["drift down","drifting down","settling dust","float downward","waft down"],vortex:["vortex","whirlpool","tornado","cyclone","maelstrom","spinning vortex","swirling"],cascadeDown:["cascade","cascading","cascade down","waterfall","falling water","pour down","flow down"],confetti:["confetti","throw confetti","celebration particles","party confetti","ticker tape","streamers"],fizz:["fizz","fizzing","fizzy","bubble","bubbling","bubbly","effervescent","carbonated","sparkling bubbles"],burst:["burst","bursting","erupt","erupting","eruption","boom","booming","bursting out","burst of energy","explosive burst","big burst"],burstUp:["burst up","bursting up","fountain","geyser","erupting up"],ripple:["ripple","rippling","wave effect","ripple effect","water ripple","spreading rings"],flash:["flash","flashing","flashy","blink","blinking","strobe","strobing","quick flash","bright flash","flashing light","strobing light"],glow:["glow","glowing","glowy","radiate","radiating","emanate","emanating","luminescent","bright","brighten","brightening","soft glow","warm glow","inner glow","glowing warmly","lighting up","lit up"],bloom:["bloom","blooming","blossom","blossoming","flower","flowering","unfold","unfolding","light bloom","lens bloom"],flicker:["flicker","flickering","flickery","flutter","fluttering","waver","wavering","guttering","flickering light","unsteady light","wavering glow","candle-like"],shiver:["shiver","shivering","chill","chilly","cold","freezing","brr","brrr"],heartbeat:["heartbeat","heart beat","pulse of life","living pulse","thump thump","ba-dum"],snap:["snap","snapping","click","clicking","quick snap","finger snap"],elasticBounce:["elastic bounce","rubbery bounce","springy","bouncy elastic","rubber band","spring back"],hold:["hold","holding","pause","pausing","paused","freeze","freezing","frozen","still","stillness","stop","stopping","stopped","holding still","staying still","frozen in place","completely still","motionless","stationary"],fade:["fade","fading","dim","dimming","disappear","disappearing","vanish","vanishing","fading out","fading away","growing dim","becoming transparent"],settle:["settle","settling","settled","calm","calming","ground","grounding","grounded","center","centering","centered","anchor","anchoring","anchored","root","rooting","rooted","relax","relaxing","unwind","unwinding","decompress","decompressing","settling down","calming down","winding down","cooling down","coming to rest","finding peace"],peek:["peek","peeking","peer","peering","peep","peeping","glance","glancing","peeking out","peek out","looking shyly","shy glance","quick peek","sneaking a look"]},Gu={circle:["circle","circular","round","rounded","orb","ball","sphere","spherical","ring","disc","disk","whole","complete","unity","unified","endless","infinite","continuous","full circle","perfect round","come full circle"],sphere:["sphere","spherical","globe","globular","ball","3d circle","three dimensional","round ball","floating sphere"],square:["square","squared","boxy","box","rectangle","rectangular","quadrilateral","cube","cubic","block","blocky","stable","solid","grounded","sturdy","rigid","firm","structured","four sided","four corners","box shape"],triangle:["triangle","triangular","tri","pyramid","pyramidal","delta","wedge","arrow","arrowhead","pointed","sharp","dynamic","directional","ascending","three sided","three pointed","pointing up"],heart:["heart","hearted","hearts","love","loving","lovely","valentine","romantic","affection","affectionate","caring","care","tender","warmth","warm-hearted","heartfelt","compassion","compassionate","devotion","devoted","luv","wuv","<3","‚ù§Ô∏è","üíï","üíó","full of love","with love","heart shape","heart shaped","from the heart"],suspicion:["suspicion","suspicious","suspect","sly","slyly","sneaky","sneakily","mischievous","mischief","smirk","smirking","smirky","grin","grinning","sly grin","side eye","sideeye","side-eye","skeptical","skepticism","doubtful","doubt","doubting","wary","distrustful","distrust","sus","sussy","sussy baka","hmm","hmmm","hmmmm","shady","fishy","sketchy","not buying it","something fishy","seems off","up to something"],star:["star","starred","starry","stars","stellar","astral","twinkle","twinkling","achievement","achieved","excellence","excellent","gold star","five star","superstar","rockstar","rock star","wonder","wonderful","wondrous","magical","magic","miraculous","amazing","spectacular","reach for stars","seeing stars","star shape","shining star"],sun:["sun","sunny","sunshine","sunlight","solar","sol","daylight","daytime","day","radiant","radiance","radiating","bright","brightness","brilliant","glowing","glow","blazing","blaze","warm","warmth","cheerful","cheery","optimistic","optimism","hopeful","hope","positive","positivity","full of light","ray of sunshine","like the sun","sunny disposition"],moon:["moon","moony","moonlight","moonlit","lunar","crescent","nighttime","night","nocturnal","waxing","waning","gibbous","new moon","full moon","half moon","quarter moon","crescent moon","dreamy","dreamlike","dream","mysterious","mystery","mystical","ethereal","otherworldly","serene","serenity","tranquil","contemplative","reflective","moonlit night","by moonlight","moon shape","under the moon"],lunar:["lunar eclipse","blood moon","blood-moon","red moon","copper moon","rust moon","eclipsing","eclipsed","shadow crossing","earth shadow","ominous","foreboding","portentous","dramatic","intense","transforming","transformation","moon in shadow","moon turning red","eclipse phase","lunar event"],solar:["solar eclipse","total eclipse","corona","diamond ring","totality","umbra","penumbra","ring of fire","dark sun","blocked sun","occluded","awe","awesome","awe-inspiring","rare","momentous","historic","breathtaking","magnificent","sun blocked","sun covered","total darkness","corona visible"],eclipse:["eclipse","eclipsing","eclipsed","celestial event","astronomical event","overshadow","overshadowed","blocked","blocking","obscured","hidden","hiding","concealed","passing","crossing","alignment","in eclipse","going dark","being eclipsed","eclipsed by"]},Lu={intensity:{barely:["barely","hardly","scarcely","faintly","slightly","marginally","just a bit","just a little","just barely","hint of","touch of","trace of"],slightly:["slightly","somewhat","a little","a bit","mildly","lightly","kind of","kinda","sort of","sorta","a tad","a touch","a smidge"],moderately:["moderately","reasonably","fairly","pretty","rather","quite"],normal:["normal","normally","regular","regularly","standard","typical","typically","average","ordinary"],notably:["notably","noticeably","clearly","definitely","certainly","decidedly","genuinely","truly","really"],very:["very","really","so","such","quite","highly","deeply","seriously","majorly","hella","super","extra","mad"],extremely:["extremely","incredibly","immensely","tremendously","enormously","hugely","intensely","fiercely","wildly","insanely","crazy","ridiculously","mega","ultra","hyper"],absolutely:["absolutely","completely","totally","utterly","entirely","wholly","fully","maximum","max","over the top","off the charts","through the roof","to the max"]},duration:{flash:["flash","instant","instantaneous","split second","split-second","momentary","fleeting","brief flash"],quick:["quick","quickly","fast","rapid","swift","swiftly","brief","briefly","short","shortly","snap"],normal:["normal","regular","standard","typical","usual"],slow:["slow","slowly","gradual","gradually","gentle","gently","easy","easily","leisurely","unhurried"],long:["long","prolonged","extended","sustained","lasting","lingering","drawn out","drawn-out"],persistent:["persistent","constant","continuous","ongoing","steady","maintained","held","holding","stay","staying","keep","keeping","remain","remaining"]},transition:{instant:["instant","instantly","immediate","immediately","sudden","suddenly","abrupt","abruptly","snap","cut","jump"],snappy:["snappy","crisp","sharp","sharply","brisk","briskly","punchy"],smooth:["smooth","smoothly","natural","naturally","fluid","fluidly","flowing"],gentle:["gentle","gently","soft","softly","gradual","gradually","easing","gliding","drifting"],dreamy:["dreamy","dreamlike","floaty","ethereal","languid","lazy","flowing","melting"]},repetition:{once:["once","one time","single","just once","only once","one shot"],few:["few","few times","couple","couple times","twice","two times","thrice","three times"],several:["several","several times","multiple","multiple times","repeatedly","again and again"],many:["many","many times","lots","lots of times","over and over","nonstop"],loop:["loop","looping","looped","continuous","continuously","forever","infinitely","endlessly","always","keep going","on repeat"]}},_u={barely:{min:.1,max:.2,default:.15},slightly:{min:.2,max:.4,default:.3},moderately:{min:.4,max:.5,default:.45},normal:{min:.5,max:.6,default:.55},notably:{min:.6,max:.7,default:.65},very:{min:.7,max:.85,default:.8},extremely:{min:.85,max:.95,default:.9},absolutely:{min:.95,max:1,default:1}},Hu={flash:{min:100,max:500,default:250},quick:{min:500,max:1e3,default:750},normal:{min:1e3,max:2e3,default:1500},slow:{min:2e3,max:4e3,default:3e3},long:{min:4e3,max:8e3,default:6e3},persistent:{min:8e3,max:1/0,default:1e4}};function Uu(e){const t=new Map;for(const[i,a]of Object.entries(e)){for(const e of a){const a=e.toLowerCase().trim();t.set(a,i)}t.set(i.toLowerCase(),i)}return t}class Qu{constructor(){this.emotionLookup=Uu(Vu),this.undertoneLookup=Uu($u),this.gestureLookup=Uu(Wu),this.shapeLookup=Uu(Gu),this.modifierLookup=function(e){const t=new Map;for(const[i,a]of Object.entries(e))for(const[e,s]of Object.entries(a))for(const a of s){const s=a.toLowerCase().trim();t.set(s,{type:i,level:e})}return t}(Lu)}parse(e){const t={emotion:null,undertone:"clear",gestures:[],shape:null,intensity:_u.normal.default,duration:Hu.normal.default,transition:"smooth",repetition:"once",unrecognized:[],raw:e};if(!e||"string"!=typeof e)return t;const{tokens:i}=function(e){if(!e||"string"!=typeof e)return{tokens:[],segments:[],phrases:new Map};const t=Fu(e),{processed:i,phrases:a}=function(e){const t=new Map;let i=e,a=0;for(const e of Au){const s=Fu(e);if(i.includes(s)){const e=`__PHRASE_${a}__`;i=i.replace(new RegExp(s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),e),t.set(e,s),a++}}return{processed:i,phrases:t}}(t),s=i.split(Cu).map(e=>e.trim()).filter(e=>e.length>0),n=[],r=[];for(const e of s){let t=e;for(const[e,i]of a)t=t.replace(e,i);r.push(t.trim());const i=e.split(/\s+/);for(const e of i){if(a.has(e)){n.push(a.get(e));continue}if(!e)continue;if(Iu.has(e)&&!zu.has(e))continue;const t=e.replace(/^[^\w]+|[^\w]+$/g,"");t&&n.push(t)}}return{tokens:n,segments:r,phrases:a}}(e);if(0===i.length)return t;let a=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!Du(s))if(qu(s))a=!0;else if(a)a=!1;else{if(ju(s)){const a=Tu(s,i,e,t);if(a){this.ri(t,a);continue}}this.oi(s,t)||this.li(s,t)||this.hi(s,t)||this.ci(s,t)||this.ui(s,t)||t.unrecognized.push(s)}}return t}ri(e,t){const{category:i,target:a}=t;switch(i){case"emotion":e.emotion||(e.emotion=a);break;case"undertone":"clear"===e.undertone&&(e.undertone=a);break;case"gesture":e.gestures.includes(a)||e.gestures.push(a);break;case"shape":e.shape||(e.shape=a)}}oi(e,t){const i=this.emotionLookup.get(e);return!(!i||t.emotion||(t.emotion=i,0))}li(e,t){const i=this.gestureLookup.get(e);return!(!i||t.gestures.includes(i)||(t.gestures.push(i),0))}hi(e,t){const i=this.shapeLookup.get(e);return!(!i||t.shape||(t.shape=i,0))}ci(e,t){const i=this.undertoneLookup.get(e);return!(!i||"clear"!==t.undertone||(t.undertone=i,0))}ui(e,t){const i=this.modifierLookup.get(e);if(i){const{type:e,level:a}=i;switch(e){case"intensity":t.intensity=_u[a]?.default||t.intensity;break;case"duration":t.duration=Hu[a]?.default||t.duration;break;case"transition":t.transition=a;break;case"repetition":t.repetition=a}return!0}return!1}validate(e){const t=[];return e.emotion||0!==e.gestures.length||e.shape||t.push("No actionable intent found (need emotion, gesture, or shape)"),(e.intensity<0||e.intensity>1)&&t.push(`Intensity ${e.intensity} out of range [0, 1]`),e.duration<=0&&t.push(`Duration ${e.duration} must be positive`),{valid:0===t.length,errors:t}}static getAvailableEmotions(){return Object.keys(Vu)}static getAvailableUndertones(){return Object.keys($u)}static getAvailableGestures(){return Object.keys(Wu)}static getAvailableShapes(){return Object.keys(Gu)}}class Yu{constructor(e={}){this.di=this.pi(e),this.gi=null,this.mi=[],this.yi=!1,this.fi=0,this.bi=0,this.he=!1,this.wi=!1,this.Mi=new Qu,this.Si={calls:[],maxCallsPerSecond:10,windowMs:1e3},this.Nt=new Mu(()=>this.xi()),this.ki=new Su(()=>this.xi(),{isRecording:()=>this.yi,startTime:()=>this.fi,timeline:()=>this.mi});const t=this;this.Oi=new xu(()=>this.xi(),this.Nt,{get timeline(){return t.mi},set timeline(e){t.mi=e},get isRecording(){return t.yi},set isRecording(e){t.yi=e},get recordingStartTime(){return t.fi},set recordingStartTime(e){t.fi=e},get isPlaying(){return t.he},set isPlaying(e){t.he=e},get playbackStartTime(){return t.bi},set playbackStartTime(e){t.bi=e}}),this.Ai=new ku(()=>this.xi(),()=>this.Ci,this),this.Ii=new Ou(()=>this.xi(),()=>this.Ci),this.init=this.init.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this.setPosition=this.setPosition.bind(this),this.animateToPosition=this.animateToPosition.bind(this),this.clearParticles=this.clearParticles.bind(this)}xi(){return this.zi||this.gi}pi(e){const t={...e};return delete t.enableDebug,delete t.enableInternalAPIs,delete t.exposeInternals,t.mode="production",void 0===t.enableGazeTracking&&(t.enableGazeTracking=!0),t}init(e){if(this.wi)return Promise.resolve();try{this.Ci="string"==typeof e?document.getElementById(e):e;const t={...this.di,canvasId:e},i=new vu(t);return Object.defineProperty(this,"zi",{value:i,writable:!1,enumerable:!1,configurable:!1}),this.gi=new Proxy(i,{get(e,t){if(["soundSystem","stateMachine","emotionLibrary","audioLevelProcessor","particleSystem","errorBoundary","performanceMonitor","config","debugMode"].includes(t))return new Proxy({},{get(){},set:()=>!1,has:()=>!1,ownKeys:()=>[],getOwnPropertyDescriptor(){}});if("renderer"===t||"shapeMorpher"===t||"audioAnalyzer"===t||"gazeTracker"===t){const i=e[t];if(!i)return;return new Proxy(i,{get(e,i){if({renderer:["setBlinkingEnabled"],shapeMorpher:["resetMusicDetection","frequencyData"],audioAnalyzer:["microphoneStream","currentFrequencies"],gazeTracker:["enable","disable","mousePos","updateTargetGaze","currentGaze","getState"]}[t]?.includes(i))return e[i]},set:()=>!1,has:()=>!1,ownKeys:()=>[]})}return e[t]},set:()=>!1,has:(e,t)=>!["soundSystem","stateMachine","emotionLibrary"].includes(t)&&t in e,ownKeys:e=>["canvas","start","stop","pause","resume","setEmotion","morphTo","express"].filter(t=>t in e)}),this.canvas=this.gi.canvas,this.wi=!0,Promise.resolve()}catch(e){throw e}}start(){const e=this.xi();if(!e)throw new Error("Engine not initialized. Call init() first.");e.start()}stop(){const e=this.xi();if(!e)throw new Error("Engine not initialized. Call init() first.");e.stop()}pause(){const e=this.xi();if(!e)throw new Error("Engine not initialized. Call init() first.");e.pause()}resume(){const e=this.xi();if(!e)throw new Error("Engine not initialized. Call init() first.");e.resume()}loadAudio(e){return this.Nt.loadAudio(e)}getAudioAnalysis(){return this.Nt.getAudioAnalysis()}connectAudio(e){return this.Nt.connectAudio(e)}disconnectAudio(e){return this.Nt.disconnectAudio(e)}getSpectrumData(){return this.Nt.getSpectrumData()}startRhythmSync(e){return this.Nt.startRhythmSync(e)}stopRhythmSync(){return this.Nt.stopRhythmSync()}getPerformanceMetrics(){const e=this.xi();return e?e.performanceMonitor?{fps:e.performanceMonitor.getCurrentFPS()||0,frameTime:e.performanceMonitor.getAverageFrameTime()||0,particleCount:e.particleSystem?.activeParticles||0}:e.animationController?{fps:e.animationController.currentFPS||0,frameTime:1e3/60,particleCount:0}:{fps:0,frameTime:0,particleCount:0}:{fps:0,frameTime:0}}triggerGesture(e,t){return this.ki.triggerGesture(e,t)}express(e,t){return this.ki.express(e,t)}chain(e){return this.ki.chain(e)}morphTo(e,t){return this.setShape(e,t)}updateUndertone(e){return this.ki.updateUndertone(e)}feel(e){if(!this.xi())throw new Error("Engine not initialized. Call init() first.");const t=Date.now(),i=this.Si;if(i.calls=i.calls.filter(e=>t-e<i.windowMs),i.calls.length>=i.maxCallsPerSecond)return{success:!1,error:"Rate limit exceeded",parsed:null};i.calls.push(t);const a=this.Mi.parse(e),s=this.Mi.validate(a);if(!s.valid)return{success:!1,error:s.errors.join("; "),parsed:a};try{if(a.emotion){const e={};a.undertone&&"clear"!==a.undertone&&(e.undertone=a.undertone);const t=Math.round(500+1e3*(1-a.intensity));this.setEmotion(a.emotion,e,t)}for(const e of a.gestures)this.express(e);return a.shape&&this.morphTo(a.shape),{success:!0,error:null,parsed:a}}catch(e){return{success:!1,error:e.message,parsed:a}}}static getFeelVocabulary(){return{emotions:Qu.getAvailableEmotions(),undertones:Qu.getAvailableUndertones(),gestures:Qu.getAvailableGestures(),shapes:Qu.getAvailableShapes()}}parseIntent(e){return this.Mi.parse(e)}setEmotion(e,t,i){const a=this.xi();if(!a)throw new Error("Engine not initialized. Call init() first.");let s=null,n=500,r=i;if("string"==typeof t)s=t;else if("number"==typeof t)void 0!==i?n=t:r=t;else if(t&&"object"==typeof t){const{undertone:e,duration:i,intensity:a}=t;s=e,void 0!==i&&(n=i),void 0!==a&&(this.Fi=a)}if(this.yi){const t=r||Date.now()-this.fi;this.mi.push({type:"emotion",name:e,undertone:s,time:t})}const o={};s&&(o.undertone=s),void 0!==this.Fi&&(o.intensity=this.Fi,this.Fi=void 0),a.setEmotion(e,Object.keys(o).length?o:null,n)}setSoundEnabled(e){const t=this.xi();if(!t)throw new Error("Engine not initialized. Call init() first.");t.soundSystem&&(t.soundSystem.enabled=e)}pushEmotion(e,t=.5){const i=this.xi();if(!i)throw new Error("Engine not initialized. Call init() first.");return i.stateCoordinator.pushEmotion(e,t),this}nudgeEmotion(e,t,i=1){const a=this.xi();if(!a)throw new Error("Engine not initialized. Call init() first.");return a.stateCoordinator.nudgeEmotion(e,t,i),this}setEmotionDampening(e){const t=this.xi();if(!t)throw new Error("Engine not initialized. Call init() first.");return t.stateCoordinator.setEmotionDampening(e),this}getEmotionDampening(){const e=this.xi();return e?e.stateCoordinator.getEmotionDampening():0}clearEmotions(){const e=this.xi();if(!e)throw new Error("Engine not initialized. Call init() first.");return e.stateCoordinator.clearEmotions(),this}getEmotionalState(){const e=this.xi();return e?e.stateCoordinator.getEmotionalState():{dominant:null,undercurrents:[],slots:[]}}get dynamics(){const e=this.xi();return e?e.stateCoordinator.dynamics:null}getInputEvaluator(e){return this.Nt.getInputEvaluator(e)}setEmotionFeedback(e){const t=this.getInputEvaluator();return t&&t.setEmotionFeedback(e),this}getAudioLayers(){return this.Nt.getLayers()}setShape(e,t){const i=this.xi();if(!i)throw new Error("Engine not initialized. Call init() first.");let a,s={};if("number"==typeof t)a=t;else if(t&&"object"==typeof t){const{timestamp:e,...i}=t;s=i,a=e}if(this.yi){const t=a||Date.now()-this.fi;this.mi.push({type:"shape",name:e,time:t,config:s})}i&&i.morphTo(e,s)}enableGazeTracking(){const e=this.xi();if(!e)throw new Error("Engine not initialized. Call init() first.");e.gazeTracker&&e.gazeTracker.enable()}disableGazeTracking(){const e=this.xi();if(!e)throw new Error("Engine not initialized. Call init() first.");e.gazeTracker&&e.gazeTracker.disable()}setGazeTarget(e,t){const i=this.xi();if(!i)throw new Error("Engine not initialized. Call init() first.");i.gazeTracker&&(i.gazeTracker.mousePos={x:e,y:t},i.gazeTracker.updateTargetGaze())}setContainment(e,t=1){return this.Ii.setContainment(e,t)}setPosition(e,t,i=0){const a=this.xi();if(!a)throw new Error("Engine not initialized. Call init() first.");if(a.positionController)a.positionController.onUpdate||(a.positionController.onUpdate=()=>{}),a.positionController.setOffset(e,t,i);else if(this.Ci){const a=window.innerWidth/2+e,s=window.innerHeight/2+t,n=1+.001*i;this.Ci.style.transform=`translate(${a}px, ${s}px) translate(-50%, -50%) scale(${n})`}}animateToPosition(e,t,i=0,a=1e3,s="easeOutCubic"){const n=this.xi();if(!n)throw new Error("Engine not initialized. Call init() first.");n.positionController?(n.positionController.onUpdate||(n.positionController.onUpdate=()=>{}),n.positionController.animateOffset(e,t,i,a,s)):this.setPosition(e,t,i)}clearParticles(){return this.Ii.clearParticles()}setParticleSystemCanvasDimensions(e,t){return this.Ii.setParticleSystemCanvasDimensions(e,t),this}attachToElement(e,t={}){return this.Ai.attachToElement(e,t)}isAttachedToElement(){return this.Ai.isAttachedToElement()}detachFromElement(){return this.Ai.detachFromElement()}getGazeState(){const e=this.xi();if(!e)throw new Error("Engine not initialized. Call init() first.");return e.gazeTracker?e.gazeTracker.getState():null}setBPM(e){const t=this.xi();t&&t.rhythmIntegration&&t.rhythmIntegration.setBPM(e)}setQuality(e){const t={low:{particleCount:50,fps:30},medium:{particleCount:100,fps:60},high:{particleCount:200,fps:60}},i=t[e]||t.medium,a=this.xi();a&&a.performanceMonitor&&a.performanceMonitor.setTargetFPS(i.fps),a&&a.particleSystem&&a.particleSystem.setMaxParticles(i.particleCount)}setMaxParticles(e){const t=this.xi();return t&&t.particleSystem&&t.particleSystem.setMaxParticles(e),this}getParticleCount(){const e=this.xi();return e&&e.particleSystem&&e.particleSystem.particles?e.particleSystem.particles.length:0}setOpacity(e){const t=this.xi();if(e=Math.max(0,Math.min(1,e)),t&&t.renderer){const i=t.canvasManager?.getContext();i&&(i.globalAlpha=e)}return this.Di=e,this}getOpacity(){return void 0!==this.Di?this.Di:1}fadeIn(e=1e3){const t=this.getOpacity(),i=performance.now(),a=s=>{const n=s-i,r=Math.min(n/e,1),o=t+(1-t)*r;this.setOpacity(o),r<1&&requestAnimationFrame(a)};return requestAnimationFrame(a),this}fadeOut(e=1e3){const t=this.getOpacity(),i=performance.now(),a=s=>{const n=s-i,r=Math.min(n/e,1),o=t*(1-r);this.setOpacity(o),r<1&&requestAnimationFrame(a)};return requestAnimationFrame(a),this}setColor(e){const t=this.xi();return t&&t.renderer&&t.renderer.config&&(t.renderer.config.coreColor=e),this}setGlowColor(e){const t=this.xi();return t&&t.renderer&&t.renderer.config&&(t.renderer.config.defaultGlowColor=e),this}setTheme(e){return e.core&&this.setColor(e.core),e.glow&&this.setGlowColor(e.glow),this}setSpeed(e){return this.xi(),e=Math.max(.1,Math.min(10,e)),this.qi=e,this}getSpeed(){return this.qi||1}setFPS(e){const t=this.xi();return e=Math.max(1,Math.min(120,e)),t&&t.animationController&&t.animationController.setTargetFPS(e),this}getFPS(){const e=this.xi();return e&&e.animationController&&e.animationController.targetFPS||60}isPaused(){const e=this.xi();return!(!e||!e.animationController)&&!0===e.animationController.isPaused}batch(e){const t=this.isPaused();return t||this.pause(),"function"==typeof e&&e(this),t||this.resume(),this}on(e,t){const i=this.xi();return i&&i.eventManager&&i.eventManager.on(e,t),this}off(e,t){const i=this.xi();return i&&i.eventManager&&i.eventManager.off(e,t),this}setScale(e){const t=this.xi();return t&&t.positionController&&(t.positionController.setScaleOverrides(e),"object"==typeof e&&void 0!==e.particles&&t.particleSystem&&"function"==typeof t.particleSystem.refreshPool&&t.particleSystem.refreshPool()),this}getScale(){const e=this.xi();return e&&e.positionController&&e.positionController.globalScale||1}setBackdrop(e={}){const t=this.xi();return t&&"function"==typeof t.setBackdrop&&t.setBackdrop(e),this}getBackdrop(){const e=this.xi();return e&&"function"==typeof e.getBackdrop?e.getBackdrop():null}startRecording(){return this.Oi.startRecording()}stopRecording(){return this.Oi.stopRecording()}playTimeline(e){return this.Oi.playTimeline(e)}stopPlayback(){return this.Oi.stopPlayback()}getTimeline(){return this.Oi.getTimeline()}loadTimeline(e){return this.Oi.loadTimeline(e)}exportTimeline(){return this.Oi.exportTimeline()}importTimeline(e){return this.Oi.importTimeline(e)}getCurrentTime(){return this.Oi.getCurrentTime()}seek(e){return this.Oi.seek(e)}getFrameData(e="png"){return this.Ii.getFrameData(e)}getFrameBlob(e="png"){return this.Ii.getFrameBlob(e)}getAnimationData(){return this.Oi.getAnimationData()}getAvailableGestures(){return Yr()}getAvailableEmotions(){return["neutral","joy","sadness","anger","fear","surprise","disgust","love","euphoria","excited","suspicion","resting"]}getAvailableShapes(){return["circle","square","triangle","star","heart","moon","sun"]}getVersion(){return"3.2.0"}getCapabilities(){return{audio:!0,recording:!0,timeline:!0,export:!0,shapes:!0,gestures:!0,emotions:!0,particles:!0,gazeTracking:!0}}get renderer(){const e=this.xi();return e&&e.renderer?new Proxy(e.renderer,{get:(e,t)=>["setBlinkingEnabled"].includes(t)?e[t]:void 0}):null}get shapeMorpher(){const e=this.xi();return e&&e.shapeMorpher?new Proxy(e.shapeMorpher,{get:(e,t)=>["resetMusicDetection","frequencyData"].includes(t)?e[t]:void 0}):null}get gazeTracker(){const e=this.xi();return e&&e.gazeTracker?new Proxy(e.gazeTracker,{get:(e,t)=>["enable","disable","mousePos","updateTargetGaze","currentGaze","getState"].includes(t)?e[t]:void 0}):null}destroy(){this.stop(),this.mi=[],this.yi=!1,this.he=!1,this.detachFromElement();const e=this.xi();e&&e.destroy&&e.destroy()}}class Xu{constructor(e={}){this.Ne=this.deepClone(e),this.Ri=this.deepClone(e),this.Bi=new Map,this.B=[],this.Ei=50,this.Pi=[],this.Ti=new Map,this.ji=new Map,this.Vi=new Map,this.$i={updates:0,notifications:0,computedCacheHits:0,computedCacheMisses:0}}getState(e=null){return e?this.deepClone(this.getNestedValue(this.Ne,e)):this.deepClone(this.Ne)}setState(e,t=void 0){let i;i="string"==typeof e?{[e]:t}:e;for(const e of this.Pi)if(i=e(i,this.Ne),!i)return!1;const a=this.deepClone(this.Ne);for(const[e,t]of Object.entries(i)){if(this.Ti.has(e)&&!this.Ti.get(e)(t))return!1;this.setNestedValue(a,e,t)}return this.Ri=this.Ne,this.Ne=a,this.addToHistory(i),this.invalidateComputed(Object.keys(i)),this.notifySubscribers(i),this.$i.updates++,!0}subscribe(e,t=null){let i=null,a=e;"string"==typeof e&&(i=e,a=t);const s=Symbol("subscriber"),n={path:i,callback:a,id:s};return this.Bi.set(s,n),()=>{this.Bi.delete(s)}}computed(e,t,i){this.Vi.set(e,t),Object.defineProperty(this,e,{get:()=>{if(this.ji.has(e))return this.$i.computedCacheHits++,this.ji.get(e);this.$i.computedCacheMisses++;const a=t.map(e=>this.getState(e)),s=i(...a);return this.ji.set(e,s),s}})}addValidator(e,t){this.Ti.set(e,t)}addMiddleware(e){this.Pi.push(e)}reset(e={}){this.Ne=this.deepClone(e),this.Ri=this.deepClone(e),this.B=[],this.ji.clear(),this.notifySubscribers({"*":"reset"})}getDiff(){return this.objectDiff(this.Ri,this.Ne)}undo(e=1){if(this.B.length<e)return!1;const t=Math.max(0,this.B.length-e-1),i=this.B[t];return!!i&&(this.Ne=this.deepClone(i.state),this.B=this.B.slice(0,t+1),this.notifySubscribers({"*":"undo"}),!0)}batch(e){const t={},i=this.setState.bind(this);return this.setState=(e,i)=>("string"==typeof e?t[e]=i:Object.assign(t,e),!0),e(),this.setState=i,this.setState(t)}createSelector(e){let t=null,i=null;return()=>{const a=this.Ne;return a===t||(t=a,i=e(a)),i}}notifySubscribers(e){for(const t of this.Bi.values())t.path&&!Object.keys(e).some(e=>e.startsWith(t.path)||t.path.startsWith(e))||(t.callback(this.Ne,e),this.$i.notifications++)}invalidateComputed(e){for(const[t,i]of this.Vi.entries())i.some(t=>e.some(e=>t.startsWith(e)||e.startsWith(t)))&&this.ji.delete(t)}addToHistory(e){this.B.push({timestamp:Date.now(),updates:e,state:this.deepClone(this.Ne)}),this.B.length>this.Ei&&this.B.shift()}deepClone(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(e=>this.deepClone(e));if(e instanceof Object){const t={};for(const i in e)({}).hasOwnProperty.call(e,i)&&(t[i]=this.deepClone(e[i]));return t}}getNestedValue(e,t){return t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}setNestedValue(e,t,i){const a=t.split("."),s=a.pop();a.reduce((e,t)=>(e[t]||(e[t]={}),e[t]),e)[s]=i}objectDiff(e,t){const i={};for(const a in t)a in e?JSON.stringify(e[a])!==JSON.stringify(t[a])&&(i[a]={type:"changed",oldValue:e[a],newValue:t[a]}):i[a]={type:"added",value:t[a]};for(const a in e)a in t||(i[a]={type:"deleted",oldValue:e[a]});return i}getStats(){return{...this.$i,subscribers:this.Bi.size,historySize:this.B.length,computedValues:this.ji.size,validators:this.Ti.size}}}const Nu=new Xu({engine:{initialized:!1,running:!1,paused:!1,fps:60,frameCount:0},renderer:{color:"#4a90e2",intensity:1,eyeOpenness:1,breathRate:1,breathDepth:1,sleeping:!1,zenMode:!1},animation:{currentGesture:null,activeLoops:0},emotion:{current:"neutral",intensity:1,undertone:null,transitioning:!1},particles:{active:!0,count:0,maxParticles:100},sound:{enabled:!1,volume:1,bpm:120,rhythmEnabled:!1},performance:{quality:"high",adaptiveQuality:!0,targetFPS:60,actualFPS:60}});e.BUILD_TYPE="lean",e.CanvasManager=Vo,e.ENGINE_NAME="Emotive Engine Lean",e.EmotiveMascot=vu,e.EmotiveMascotPublic=Yu,e.EmotiveRenderer=Ah,e.ErrorBoundary=t,e.EventManager=Bo,e.FEATURES={rhythmSync:!1,grooveTemplates:!1,undertones:!1,undertoneSaturation:!1,gestureBlending:!0,audioReactive:!1,particleSystem:!0,accessibility:!1,mobileOptimization:!0,performanceMonitoring:!1},e.GESTURE_TYPES=$r,e.ParticleSystem=fl,e.PositionController=Lh,e.StateStore=Xu,e.VERSION="3.3.0-lean",e.applyEasing=nl,e.applyGesture=Qr,e.default=Yu,e.easeInOutQuad=No,e.easeInOutSine=sl,e.easeOutCubic=Jo,e.engineState=Nu,e.eventManager=Eo,e.getEmotion=h,e.getEmotionVisualParams=c,e.getGesture=_r,e.hasEmotion=g,e.interpolateHsl=_o,e.listEmotions=d,e.listGestures=Yr,Object.defineProperty(e,"Wi",{value:!0})});
//# sourceMappingURL=emotive-mascot.lean.umd.js.map
