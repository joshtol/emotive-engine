!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.EmotiveEngine=e():t.EmotiveEngine=e()}(this,()=>(()=>{var t={172:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.t=!0,t.exports.default=t.exports},209:(t,e,i)=>{"use strict";i.r(e),i.d(e,{GESTURE_REGISTRY:()=>Rt,GESTURE_TYPES:()=>It,applyGesture:()=>_t,default:()=>Lt,getGesture:()=>zt,isBlendingGesture:()=>Dt,isOverrideGesture:()=>qt,listGestures:()=>Gt,pluginAdapter:()=>a});var n=new Map;const a={registerPluginGesture:function(t,e){return!(!e.apply&&!e.type)&&(e.name||(e.name=t),e.type||(e.type="blending"),n.set(t,e),"undefined"!=typeof window&&window.DEBUG_GESTURES,!0)},unregisterPluginGesture:function(t){return!!n.has(t)&&(n.delete(t),"undefined"!=typeof window&&window.DEBUG_GESTURES,!0)},getPluginGesture:function(t){return n.get(t)||null},getAllPluginGestures:function(){return Array.from(n.keys())},clearPluginGestures:function(){n.clear()},createLegacyAdapter:function(t){return{name:t.name||"unknown",type:t.type||"blending",emoji:t.emoji||"🔌",description:t.description||"Plugin gesture",config:t.config||{},apply:function(e,i,n,a,r,s){t.animate?t.animate(e,i,n,a,r,s):t.apply&&t.apply(e,i,n,a,r,s)},cleanup:t.cleanup||function(t){t.gestureData&&t.gestureData[this.name]&&delete t.gestureData[this.name]}}}};var r=i(467);function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const h={name:"bounce",emoji:"⬆️",type:"blending",description:"Vertical oscillation with smooth easing",config:{duration:800,musicalDuration:{musical:!0,beats:2},amplitude:30,frequency:2,axis:"vertical",damping:!0,easing:"sine",strength:.6,particleMotion:{type:"bounce",axis:"vertical",strength:.6,frequency:2}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:3,blendable:!0,crossfadePoint:"anyBeat",amplitudeSync:{onBeat:1.8,offBeat:.6,curve:"bounce"},frequencySync:{mode:"tempo",multiplier:1},durationSync:{mode:"beats",beats:4},accentResponse:{enabled:!0,multiplier:1.5},patternOverrides:{waltz:{frequencySync:{multiplier:.75},durationSync:{beats:3}},swing:{amplitudeSync:{onBeat:2,offBeat:.4,curve:"ease"}},dubstep:{amplitudeSync:{onBeat:1.5,dropBeat:3,curve:"pulse"}},breakbeat:{frequencySync:{multiplier:1.5},amplitudeSync:{onBeat:2.2,offBeat:.3}}}},initialize:function(t,e){t.gestureData||(t.gestureData={}),t.gestureData.bounce={startY:t.y,startX:t.x,startVx:t.vx,startVy:t.vy,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.bounce)&&void 0!==s&&s.initialized||this.initialize(t,i);var h=o(o({},this.config),i),u=h.strength||this.config.strength||1,c=this.easeInOutCubic(e),l=h.frequency,f=i.phase||0,v=h.amplitude*u*t.scaleFactor;i.rhythmModulation&&(v*=i.rhythmModulation.amplitudeMultiplier||1,v*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(l*=i.rhythmModulation.frequencyMultiplier));var d=Math.sin((c+f)*Math.PI*2*l);h.damping&&e>.7&&(v*=1-.8*((e-.7)/.3));if("vertical"===h.axis?(t.vy+=d*v*.01*n,e>.9&&(t.vx*=.98)):"horizontal"===h.axis&&(t.vx+=d*v*.01*n,e>.9&&(t.vy*=.98)),e>.9){var p=1-10*(e-.9);t.vx=t.vx*(.95+.05*p),t.vy=t.vy*(.95+.05*p)}},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.bounce&&delete t.gestureData.bounce},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}};function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const l={name:"pulse",emoji:"💗",type:"blending",description:"Radial expansion and contraction from center",config:{duration:600,amplitude:30,frequency:1,holdPeak:.1,easing:"sine",scaleAmount:.2,glowAmount:.3,strength:.15,direction:"outward",particleMotion:{type:"pulse",strength:.15,direction:"outward",frequency:1}},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:1.6,offBeat:.8,curve:"pulse"},frequencySync:{mode:"locked",subdivision:"quarter"},durationSync:{mode:"beats",beats:1},accentResponse:{enabled:!0,multiplier:2},patternOverrides:{waltz:{amplitudeSync:{onBeat:2,offBeat:.5},durationSync:{beats:3}},swing:{amplitudeSync:{onBeat:1.8,offBeat:.6,curve:"ease"},frequencySync:{subdivision:"swing"}},dubstep:{amplitudeSync:{onBeat:1.2,dropBeat:4,curve:"pulse"}},breakbeat:{frequencySync:{mode:"random",range:[.5,2]},amplitudeSync:{onBeat:2.5,offBeat:.3}}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n,s=Math.sqrt(a*a+r*r),o=Math.atan2(r,a);t.gestureData.pulse={baseDistance:s,angle:o,startX:t.x,startY:t.y,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.pulse)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o=t.gestureData.pulse,h=c(c({},this.config),i),u=i.strength||1,l=this.easeInOutSine(e),f=h.frequency,v=h.amplitude;i.rhythmModulation&&(v*=i.rhythmModulation.amplitudeMultiplier||1,v*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(f*=i.rhythmModulation.frequencyMultiplier));var d=l*f*2%2,p=(h.holdPeak>0&&d>1-h.holdPeak&&d<1+h.holdPeak?1:Math.sin(l*Math.PI*2*f))*v*u*t.scaleFactor,y=o.baseDistance+p,m=a+Math.cos(o.angle)*y,g=r+Math.sin(o.angle)*y,b=.15*n;if(t.vx+=(m-t.x)*b*.1,t.vy+=(g-t.y)*b*.1,e>.9){var M=1-10*(e-.9);t.vx*=.9+.1*M,t.vy*=.9+.1*M}},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.pulse&&delete t.gestureData.pulse},easeInOutSine:function(t){return-(Math.cos(Math.PI*t)-1)/2}};function f(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function v(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?f(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const d={name:"shake",emoji:"🫨",type:"blending",description:"Random jitter movement for vibration effects",config:{duration:400,amplitude:15,frequency:15,decay:.9,smoothing:.1,axes:"both",easing:"linear",strength:3,particleMotion:{type:"shake",strength:3,frequency:15,decay:!1}},rhythm:{enabled:!0,syncMode:"subdivision",amplitudeSync:{subdivision:"sixteenth",onBeat:2.5,offBeat:.7,curve:"pulse"},frequencySync:{mode:"tempo",baseFrequency:15,scaling:"linear"},durationSync:{mode:"beats",beats:2},patternOverrides:{breakbeat:{amplitudeSync:{onBeat:3,offBeat:.2},frequencySync:{mode:"random",range:[8,20]}},dubstep:{amplitudeSync:{subdivision:"eighth",onBeat:4,dropBeat:6,curve:"pulse"}},swing:{amplitudeSync:{onBeat:1.8,offBeat:1,curve:"ease"}}}},initialize:function(t,e){t.gestureData||(t.gestureData={}),t.gestureData.shake={originalX:t.x,originalY:t.y,randomAngle:Math.random()*Math.PI*2,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.shake)&&void 0!==s&&s.initialized||this.initialize(t,i);var o=t.gestureData.shake,h=v(v({},this.config),i),u=h.strength||this.config.strength||1,c=h.amplitude,l=h.frequency;i.rhythmModulation&&(c*=i.rhythmModulation.amplitudeMultiplier||1,c*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(l*=i.rhythmModulation.frequencyMultiplier));var f=h.decay?1-e:1,d=Math.sin(e*Math.PI*l)*c*f*u*t.scaleFactor,p=d*Math.cos(o.randomAngle),y=d*Math.sin(o.randomAngle);t.x=o.originalX+p,t.y=o.originalY+y},pseudoRandom:function(t){var e=1e4*Math.sin(t);return e-Math.floor(e)},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.shake&&(t.x=t.gestureData.shake.originalX,t.y=t.gestureData.shake.originalY,delete t.gestureData.shake)}};function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const m={name:"nod",emoji:"🙂",type:"blending",description:"Vertical nodding motion",config:{duration:500,amplitude:15,frequency:2,easing:"sine",strength:.4,particleMotion:{type:"bounce",axis:"vertical",strength:.4,frequency:2,phase:0}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!1,priority:5,blendable:!1,minDuration:"halfBar",frequencySync:{mode:"subdivision",subdivision:"half",multiplier:1},amplitudeSync:{onBeat:1.4,offBeat:.8,curve:"ease"},durationSync:{mode:"beats",beats:2},patternOverrides:{waltz:{frequencySync:{subdivision:"quarter"},amplitudeSync:{onBeat:1.6,curve:"ease"}},swing:{amplitudeSync:{onBeat:1.5,offBeat:.9}},dubstep:{amplitudeSync:{onBeat:1.2,dropBeat:3,curve:"pulse"}}}},initialize:function(t,e){t.gestureData||(t.gestureData={}),t.gestureData.nod={startY:t.y,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.nod)&&void 0!==s&&s.initialized||this.initialize(t,i);var o=y(y({},this.config),i),h=o.strength||this.config.strength||1,u=o.frequency,c=o.amplitude;i.rhythmModulation&&(c*=i.rhythmModulation.amplitudeMultiplier||1,c*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(u*=i.rhythmModulation.frequencyMultiplier));var l=Math.sin(e*Math.PI*2*u);c=c*h*t.scaleFactor,t.vy+=l*c*.01*n,e>.9&&(t.vy*=.95)},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.nod&&delete t.gestureData.nod}};function g(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function b(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?g(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const M={name:"vibrate",emoji:"📳",type:"blending",description:"High frequency vibration",config:{duration:500,frequency:20,amplitude:8,easing:"linear",strength:2,particleMotion:{type:"shake",strength:2,frequency:20,amplitude:8}},rhythm:{enabled:!0,syncMode:"subdivision",frequencySync:{subdivision:"thirty-second",baseFrequency:20,tempoScaling:!0},amplitudeSync:{onBeat:1.5,offBeat:.8,curve:"pulse"},durationSync:{mode:"beats",beats:1},patternOverrides:{dubstep:{frequencySync:{subdivision:"sixteenth"},amplitudeSync:{onBeat:2,dropBeat:3}},breakbeat:{frequencySync:{mode:"random",range:[15,30]}}}},initialize:function(t,e){t.gestureData||(t.gestureData={}),t.gestureData.vibrate={timer:0,seed:1e3*Math.random(),initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.vibrate)&&void 0!==s&&s.initialized||this.initialize(t,i);var o=t.gestureData.vibrate,h=b(b({},this.config),i),u=h.strength||this.config.strength||1,c=h.amplitude,l=h.frequency;i.rhythmModulation&&(c*=i.rhythmModulation.amplitudeMultiplier||1,c*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(l*=i.rhythmModulation.frequencyMultiplier)),o.timer+=n*l;var f=(Math.random()-.5)*c*u,v=(Math.random()-.5)*c*u;if(t.vx+=.5*f*n,t.vy+=.5*v*n,t.vx*=.9,t.vy*=.9,e>.8){var d=1-5*(e-.8);t.vx*=d,t.vy*=d}},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.vibrate&&delete t.gestureData.vibrate}};const k={name:"orbit",emoji:"🪐",description:"3D orbital motion around center",type:"override",config:{speed:1,rotations:1,zRotations:1,smoothness:.15,verticalOscillation:0,centripetal:!1},rhythm:{enabled:!0,syncMode:"bar",speedSync:{mode:"tempo",baseSpeed:1,scaling:"linear"},rotationSync:{mode:"bars",rotationsPerBar:1,zSync:!0},radiusSync:{subdivision:"quarter",pulsAmount:.1,curve:"ease"},patternOverrides:{waltz:{rotationSync:{rotationsPerBar:.75},radiusSync:{pulsAmount:.15}},swing:{speedSync:{mode:"swing",ratio:.67},verticalOscillation:.2},dubstep:{radiusSync:{subdivision:"eighth",pulsAmount:.3,dropMultiplier:2}},breakbeat:{speedSync:{mode:"random",range:[.5,2]},centripetal:!0}}},apply:function(t,e,i,n,a,r,s){if(!e.initialized){e.originalX=t.x,e.originalY=t.y,e.originalZ=t.z||0,e.originalVx=t.vx||0,e.originalVy=t.vy||0;var o=t.x-r,h=t.y-s;e.radius=Math.sqrt(o*o+h*h),e.radius<50&&(e.radius=50+100*Math.random()),e.initialAngle=Math.atan2(h,o),e.orbitSpeed=i.speed*(.8+.4*Math.random()),e.orbitTilt=.3*Math.random(),e.initialized=!0}var u=i.rotations,c=.05;i.rhythmModulation&&(i.rhythmModulation.speedMultiplier&&(e.orbitSpeed*=i.rhythmModulation.speedMultiplier),i.rhythmModulation.rotationMultiplier&&(u*=i.rhythmModulation.rotationMultiplier),i.rhythmModulation.radiusPulse&&(c=i.rhythmModulation.radiusPulse));var l=1,f=1;n<.15?f=l=(l=n/.15)*l*(3-2*l):n>.85&&(f=l=(l=(1-n)/.15)*l*(3-2*l));var v=e.initialAngle+n*Math.PI*2*u*l,d=1+Math.sin(n*Math.PI*4)*c*l,p=e.radius*a*d*l,y=r+Math.cos(v)*p,m=s+Math.sin(v)*p,g=v*i.zRotations;if(t.z=.8*Math.sin(g)*l+e.originalZ*(1-l),n<.15){var b=.3*l;t.x=e.originalX+(y-e.originalX)*b,t.y=e.originalY+(m-e.originalY)*b;var M=-Math.sin(v)*p*e.orbitSpeed,k=Math.cos(v)*p*e.orbitSpeed;t.vx=e.originalVx+(M-e.originalVx)*f,t.vy=e.originalVy+(k-e.originalVy)*f}else if(n>.85){t.x=y+(e.originalX-y)*(1-l),t.y=m+(e.originalY-m)*(1-l);var w=-Math.sin(v)*p*e.orbitSpeed,S=Math.cos(v)*p*e.orbitSpeed;t.vx=w*f+e.originalVx*(1-f),t.vy=S*f+e.originalVy*(1-f)}else{if(i.verticalOscillation>0){var O=Math.sin(2*v)*i.verticalOscillation*a;t.y=m+O,t.x=y}else{var j=i.smoothness||.1;t.x+=(y-t.x)*j,t.y+=(m-t.y)*j}t.vx=-Math.sin(v)*p*e.orbitSpeed,t.vy=Math.cos(v)*p*e.orbitSpeed}if(i.centripetal){var F=1+.3*(1-Math.abs(t.z)),A=e.initialAngle+n*Math.PI*2*i.rotations*F;t.x=r+Math.cos(A)*p,t.y=s+Math.sin(A)*p}},emotions:["zen","love","excited","surprise"],features:{uses3D:!0,smooth:!0,looping:!0,dramatic:!0}},w={name:"twitch",emoji:"⚡",type:"blending",description:"Nervous, paranoid twitching",config:{intensity:8,frequency:.08,duration:100,recovery:200,maxOffset:15,sharpness:.9},rhythm:{enabled:!0,syncMode:"subdivision",probabilitySync:{subdivision:"sixteenth",onBeat:.3,offBeat:.05,accentBoost:2},intensitySync:{onBeat:2,offBeat:.8,curve:"pulse"},patternOverrides:{breakbeat:{probabilitySync:{onBeat:.5,offBeat:.1},intensitySync:{onBeat:3,offBeat:.5}},dubstep:{intensitySync:{onBeat:1.5,dropBeat:5,curve:"pulse"}}}},apply:function(t,e,i,n,a,r){t.gestureData||(t.gestureData={}),t.gestureData.twitch||(t.gestureData.twitch={twitchOffset:{x:0,y:0},targetOffset:{x:0,y:0},isTwitching:!1,twitchTimer:0,cooldownTimer:0,lastTwitch:0});var s=t.gestureData.twitch,o=this.config,h=i.intensity||o.intensity;o.frequency;i.rhythmModulation&&(h*=i.rhythmModulation.amplitudeMultiplier||1,h*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.probabilityMultiplier&&i.rhythmModulation.probabilityMultiplier);var u=Date.now();if(!s.isTwitching&&s.cooldownTimer<=0&&Math.random()<(i.frequency||o.frequency)){s.isTwitching=!0,s.twitchTimer=o.duration,s.cooldownTimer=o.recovery;var c=Math.random()*Math.PI*2,l=.5*o.maxOffset+Math.random()*(.5*o.maxOffset);s.targetOffset={x:Math.cos(c)*l*h/8,y:Math.sin(c)*l*h/8},s.lastTwitch=u}if(s.cooldownTimer>0&&(s.cooldownTimer-=16*n),s.isTwitching)if(s.twitchTimer-=16*n,s.twitchTimer>0){var f=o.sharpness;s.twitchOffset.x+=(s.targetOffset.x-s.twitchOffset.x)*f,s.twitchOffset.y+=(s.targetOffset.y-s.twitchOffset.y)*f}else s.isTwitching=!1;else s.twitchOffset.x*=.85,s.twitchOffset.y*=.85;t.vx+=s.twitchOffset.x*n*.5,t.vy+=s.twitchOffset.y*n*.5,Math.random()<.1&&(t.vx+=(Math.random()-.5)*h*.3,t.vy+=(Math.random()-.5)*h*.3)},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.twitch&&delete t.gestureData.twitch}};function S(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function O(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?S(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const j={name:"sway",type:"blending",emoji:"🌊",description:"Gentle side-to-side swaying motion",config:{duration:2e3,amplitude:20,frequency:1,strength:.5},rhythm:{enabled:!0,syncMode:"bar",amplitudeSync:{onBeat:1.2,offBeat:.9,curve:"ease"},durationSync:{mode:"bars",bars:1},patternOverrides:{waltz:{durationSync:{bars:1},amplitudeSync:{onBeat:1.5,curve:"ease"}},swing:{amplitudeSync:{onBeat:1.3,offBeat:.7,curve:"bounce"}}}},apply:function(t,e,i,n,a,r){var s=O(O({},this.config),i),o=s.amplitude||this.config.amplitude,h=s.frequency||this.config.frequency,u=s.strength||this.config.strength,c=Math.sin(e*Math.PI*2*h)*o;t.vx+=.01*c*n*u,t.vy+=.5*Math.cos(e*Math.PI*4)*n*u},cleanup:function(t){}};function F(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function A(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?F(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const x={name:"float",type:"blending",emoji:"🎈",description:"Gentle floating upward motion",config:{duration:2e3,amplitude:80,wobbleAmount:20,strength:1},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:1.5,offBeat:.8,curve:"bounce"},wobbleSync:{subdivision:"eighth",intensity:.7},durationSync:{mode:"bars",bars:2},accentResponse:{enabled:!0,multiplier:1.3},patternOverrides:{waltz:{wobbleSync:{subdivision:"quarter",intensity:.9}},dubstep:{amplitudeSync:{onBeat:2,curve:"pulse"}}}},apply:function(t,e,i,n,a,r){t.gestureData||(t.gestureData={}),t.gestureData.float||(t.gestureData.float={originalSize:t.size,originalOpacity:t.opacity||1});var s=A(A({},this.config),i),o=s.amplitude||this.config.amplitude,h=s.wobbleAmount||this.config.wobbleAmount,u=s.strength||this.config.strength;i.rhythmModulation&&(o*=i.rhythmModulation.amplitudeMultiplier||1,o*=i.rhythmModulation.accentMultiplier||1,h*=i.rhythmModulation.wobbleMultiplier||1);var c=Math.sin(e*Math.PI*4)*h;t.vy-=.01*o*n*u*(1-.5*e),t.vx+=.01*c*n*u,t.size=t.baseSize*(1+.1*e),t.opacity=1-.3*e},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.float?(t.opacity=t.gestureData.float.originalOpacity,t.size=t.gestureData.float.originalSize,delete t.gestureData.float):(t.opacity=1,t.size=t.baseSize),t.vx*=.5,t.vy*=.5}};function B(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function C(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?B(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):B(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const P={name:"jitter",type:"blending",emoji:"🫨",description:"Nervous jittery movement",config:{duration:1e3,intensity:15,frequency:30,strength:1},rhythm:{enabled:!0,syncMode:"beat",amplitudeSync:{onBeat:2,offBeat:.5,curve:"pulse"},patternOverrides:{breakbeat:{amplitudeSync:{onBeat:3,offBeat:.3}},dubstep:{amplitudeSync:{onBeat:5,offBeat:.1,curve:"pulse"}}}},apply:function(t,e,i,n,a,r){t.gestureData||(t.gestureData={}),t.gestureData.jitter||(t.gestureData.jitter={originalSize:t.size});var s=C(C({},this.config),i),o=s.intensity||this.config.intensity,h=s.strength||this.config.strength;i.rhythmModulation&&(o*=i.rhythmModulation.amplitudeMultiplier||1,o*=i.rhythmModulation.accentMultiplier||1);var u=(Math.random()-.5)*o*h,c=(Math.random()-.5)*o*h,l=1-.5*e;t.vx+=.1*u*n*l,t.vy+=.1*c*n*l,t.size=t.baseSize*(1+.1*(Math.random()-.5))},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.jitter?(t.size=t.gestureData.jitter.originalSize,delete t.gestureData.jitter):t.size=t.baseSize,t.vx*=.7,t.vy*=.7}};function E(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function T(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?E(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):E(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const R={name:"spin",emoji:"🌀",type:"override",description:"Orbital rotation around center point",config:{duration:600,musicalDuration:{musical:!0,beats:1},rotations:1,direction:"random",radiusMultiplier:1,spiralOut:!1,accelerate:!0,maintainDistance:!0,scaleAmount:.1,easing:"linear",strength:.7,particleMotion:{type:"spin",strength:.7,rotations:1,radius:1}},rhythm:{enabled:!0,syncMode:"bar",rotationSync:{mode:"bars",rotationsPerBar:1,accelerateOnBeat:!0},radiusSync:{subdivision:"quarter",expandOnBeat:1.2,contractOffBeat:.9,curve:"bounce"},durationSync:{mode:"beats",beats:4},patternOverrides:{waltz:{rotationSync:{rotationsPerBar:.75},radiusSync:{curve:"ease"}},swing:{rotationSync:{accelerateOnBeat:!1},direction:"alternating"},dubstep:{radiusSync:{subdivision:"eighth",expandOnBeat:1.5,dropMultiplier:2},spiralOut:!0},breakbeat:{rotationSync:{mode:"random",range:[.5,2]},direction:"random"}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n,s=e.direction||this.config.direction;"random"===s&&(s=Math.random()<.5?"clockwise":"counter-clockwise"),t.gestureData.spin={startAngle:Math.atan2(r,a),startRadius:Math.sqrt(a*a+r*r)||30,originalX:t.x,originalY:t.y,originalVx:t.vx,originalVy:t.vy,direction:s,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.spin)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o=t.gestureData.spin,h=T(T({},this.config),i),u=i.strength||1,c=h.rotations,l=h.radiusMultiplier;i.rhythmModulation&&(i.rhythmModulation.rotationMultiplier&&(c*=i.rhythmModulation.rotationMultiplier),i.rhythmModulation.radiusMultiplier&&(l*=i.rhythmModulation.radiusMultiplier));var f=e;h.accelerate&&(f=e<.5?.5*this.easeInQuad(2*e):.5+.5*this.easeOutQuad(2*(e-.5)));var v=c*Math.PI*2*u,d="counter-clockwise"===o.direction?-1:1,p=o.startAngle+v*f*d,y=o.startRadius;(h.spiralOut&&(y*=1+.5*e),1!==l)&&(y*=1+(l-1)*Math.sin(e*Math.PI));var m=a+Math.cos(p)*y,g=r+Math.sin(p)*y;if(t.x+=.25*(m-t.x),t.y+=.25*(g-t.y),t.vx=.5*(m-t.x),t.vy=.5*(g-t.y),e>.9){var b=10*(1-e);t.vx=t.vx*b+o.originalVx*(1-b),t.vy=t.vy*b+o.originalVy*(1-b)}},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.spin){var i=t.gestureData.spin;t.vx=i.originalVx,t.vy=i.originalVy,delete t.gestureData.spin}},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)}};function I(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function z(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?I(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):I(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const D={name:"jump",emoji:"🦘",type:"override",description:"Squash, leap, and land with classic animation principles",config:{duration:800,jumpHeight:60,squashAmount:.8,stretchAmount:1.2,anticipation:.2,hangTime:.1,landingImpact:!0,driftOutward:!0,easing:"quad",particleMotion:{type:"jump",strength:.9,jumpHeight:60,squash:.8,stretch:1.2}},rhythm:{enabled:!0,syncMode:"beat",phaseSync:{anticipation:"eighth",jump:"beat",landing:"sixteenth"},heightSync:{onBeat:1.5,offBeat:.8,accent:2,curve:"exponential"},deformationSync:{squashOnBeat:.6,stretchOnBeat:1.4,timing:"anticipatory"},hangTimeSync:{mode:"tempo",baseDuration:.1,scaling:"inverse"},dynamics:{forte:{jumpHeight:80,stretch:1.3},piano:{jumpHeight:30,stretch:1.1}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={}),t.gestureData.jump={startX:t.x,startY:t.y,startSize:t.size,originalVx:t.vx,originalVy:t.vy,driftDirection:.1*(t.x-i),initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.jump)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o=t.gestureData.jump,h=z(z({},this.config),i),u=i.strength||1,c=h.jumpHeight*u*t.scaleFactor,l=h.squashAmount,f=h.stretchAmount,v=h.anticipation,d=1-.5*h.anticipation;if(e<v){var p=e/v,y=this.easeOutQuad(p);t.size=o.startSize*(1-(1-l)*y),t.y=o.startY+5*y*t.scaleFactor,t.vx=0,t.vy=0}else if(e<d){var m=(e-v)/(d-v),g=Math.sin(m*Math.PI);if(h.hangTime>0&&m>.4&&m<.6){var b=(m-.4)/.2;g=.95+.05*this.easeInOutCubic(b)}if(t.y=o.startY-g*c,h.driftOutward&&(t.x=o.startX+g*o.driftDirection),m<.5){var M=2*m;t.size=o.startSize*(l+(f-l)*M)}else{var k=2*(m-.5);t.size=o.startSize*(f-(f-1)*k*.8)}t.vx=.5*o.driftDirection,t.vy=-Math.cos(m*Math.PI)*c*.1}else{var w=(e-d)/(1-d),S=this.easeOutBounce(w);if(t.y=o.startY,h.landingImpact)if(w<.3){var O=w/.3;t.size=o.startSize*(1-(1-.8*l)*(1-O))}else{var j=(w-.3)/.7;t.size=o.startSize*(.8*l+(1-.8*l)*j)}else t.size=o.startSize*(l+(1-l)*S);t.vx=o.originalVx*S,t.vy=o.originalVy*S}},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.jump){var i=t.gestureData.jump;t.size=i.startSize,t.vx=i.originalVx,t.vy=i.originalVy,delete t.gestureData.jump}},easeOutQuad:function(t){return t*(2-t)},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeOutBounce:function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}};function q(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function _(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?q(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):q(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const G={name:"morph",emoji:"✨",type:"override",description:"Form geometric patterns and shapes",config:{musicalDuration:{musical:!0,beats:2,minBeats:1,maxBeats:8},phases:[{name:"gather",beats:.25},{name:"form",beats:.75},{name:"hold",beats:.5},{name:"dissolve",beats:.5}],morphType:"fluid",pattern:"star",points:5,innerRadius:.4,size:80,amplitude:20,rotation:0,smooth:!0,randomizeOrder:!1,easing:"sine",strength:1.2,particleMotion:{type:"morph",pattern:"star",strength:1.2,smooth:!0,points:5}},rhythm:{enabled:!0,syncMode:"phrase",patternSync:{verse:"circle",chorus:"star",bridge:"heart",drop:"explosion"},timingSync:{formationBeat:1,holdBeats:2,dissolveBeat:4,curve:"anticipatory"},sizeSync:{onBeat:1.2,offBeat:.95,subdivision:"quarter",curve:"elastic"},rotationSync:{mode:"continuous",degreesPerBar:90,direction:"clockwise"},dynamics:{forte:{points:8,size:100},piano:{points:3,size:60}}},initialize:function(t,e,i,n,a){t.gestureData||(t.gestureData={});var r,s,o=_(_({},this.config),e),h=t.x,u=t.y,c=Math.atan2(t.y-n,t.x-i),l=Math.random()<.5?1:-1,f=o.size*t.scaleFactor,v=(o.rotation||0)*Math.PI/180*l;switch(o.pattern){case"star":r=i,s=n,this.calculateStarPosition(t,c,f,o.points,o.innerRadius,v,i,n);break;case"heart":this.calculateHeartPosition(t,c,f,v,i,n);break;case"square":this.calculateSquarePosition(t,c,f,v,i,n);break;case"triangle":this.calculateTrianglePosition(t,c,f,v,i,n);break;default:var d=f;r=i+Math.cos(c+v)*d,s=n+Math.sin(c+v)*d}t.gestureData.morph={startX:h,startY:u,targetX:t.gestureData.morphTargetX||r,targetY:t.gestureData.morphTargetY||s,originalVx:t.vx,originalVy:t.vy,rotationDirection:l,initialized:!0}},calculateStarPosition:function(t,e,i,n,a,r,s,o){var h,u,c=2*Math.PI/n,l=(Math.round(e/c),Math.round(e/c)%n);Math.random()>.5?(h=i,u=l*c+r):(h=i*a,u=l*c+.5*c+r),t.gestureData.morphTargetX=s+Math.cos(u)*h,t.gestureData.morphTargetY=o+Math.sin(u)*h},calculateHeartPosition:function(t,e,i,n,a,r){var s=(e+Math.PI)/(2*Math.PI),o=.05*i,h=16*Math.pow(Math.sin(s*Math.PI*2),3),u=-(13*Math.cos(s*Math.PI*2)-5*Math.cos(2*s*Math.PI*2)-2*Math.cos(3*s*Math.PI*2)-Math.cos(4*s*Math.PI*2)),c=Math.cos(n),l=Math.sin(n),f=h*c-u*l,v=h*l+u*c;t.gestureData.morphTargetX=a+f*o,t.gestureData.morphTargetY=r+v*o},calculateSquarePosition:function(t,e,i,n,a,r){var s,o,h=((e+n)%(2*Math.PI)+2*Math.PI)%(2*Math.PI),u=i;h<Math.PI/4||h>=7*Math.PI/4?(s=u,o=u*Math.tan(h)):h<3*Math.PI/4?(s=u/Math.tan(h),o=u):h<5*Math.PI/4?(s=-u,o=-u*Math.tan(h)):(s=-u/Math.tan(h),o=-u);var c=Math.cos(n),l=Math.sin(n),f=s*c-o*l,v=s*l+o*c;t.gestureData.morphTargetX=a+f,t.gestureData.morphTargetY=r+v},calculateTrianglePosition:function(t,e,i,n,a,r){var s=[{x:0,y:-i},{x:.866*-i,y:.5*i},{x:.866*i,y:.5*i}],o=Math.floor((e+Math.PI)/(2*Math.PI)*3)%3,h=(o+1)%3,u=Math.random(),c=s[o].x+(s[h].x-s[o].x)*u,l=s[o].y+(s[h].y-s[o].y)*u,f=Math.cos(n),v=Math.sin(n),d=c*f-l*v,p=c*v+l*f;t.gestureData.morphTargetX=a+d,t.gestureData.morphTargetY=r+p},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.morph)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o=t.gestureData.morph,h=_(_({},this.config),i),u=e;if(h.holdTime>0){var c=.5-h.holdTime/2,l=.5+h.holdTime/2;u=e<c?e/c*.5:e<l?.5:.5+(e-l)/(1-l)*.5}var f,v;this.easeInOutCubic(u);if(u<=.5){var d=2*u;f=o.startX+(o.targetX-o.startX)*this.easeOutQuad(d),v=o.startY+(o.targetY-o.startY)*this.easeOutQuad(d)}else{var p=2*(u-.5);f=o.targetX+(o.startX-o.targetX)*this.easeInQuad(p),v=o.targetY+(o.startY-o.targetY)*this.easeInQuad(p)}if(h.smooth){t.x+=.2*(f-t.x),t.y+=.2*(v-t.y)}else t.x=f,t.y=v;if(t.vx=.5*(f-t.x),t.vy=.5*(v-t.y),e>.9){var y=10*(1-e);t.vx=t.vx*y+o.originalVx*(1-y),t.vy=t.vy*y+o.originalVy*(1-y)}},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.morph){var i=t.gestureData.morph;t.vx=i.originalVx,t.vy=i.originalVy,delete t.gestureData.morph,delete t.gestureData.morphTargetX,delete t.gestureData.morphTargetY}},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeOutQuad:function(t){return t*(2-t)},easeInQuad:function(t){return t*t}};function L(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function V(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?L(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):L(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const H={name:"stretch",emoji:"↔️",type:"override",description:"Scale particles along X and Y axes",config:{duration:2e3,scaleX:1.3,scaleY:.9,alternate:!1,elastic:!0,overshoot:.1,frequency:1,easing:"sine",strength:1,particleMotion:{type:"stretch",scaleX:1.8,scaleY:.6,strength:1},centerBased:!0,preserveArea:!1},rhythm:{enabled:!0,syncMode:"beat",scaleSync:{onBeat:{x:1.5,y:.7},offBeat:{x:.8,y:1.3},subdivision:"eighth",curve:"elastic"},alternateSync:{pattern:"XYXY",beatsPerChange:1,overlap:.1},overshootSync:{normal:.1,accent:.3,downbeat:.2,curve:"spring"},preservationSync:{verse:!0,chorus:!1,bridge:!0},dynamics:{forte:{scaleX:2,scaleY:.5,overshoot:.4},piano:{scaleX:1.1,scaleY:.95,overshoot:.05}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n;t.gestureData.stretch={offsetX:a,offsetY:r,startX:t.x,startY:t.y,originalVx:t.vx,originalVy:t.vy,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.stretch)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o,h,u=t.gestureData.stretch,c=V(V({},this.config),i),l=i.strength||1,f=c.scaleX,v=c.scaleY;if(c.preserveArea&&1!==f&&1!==v){var d=f*v,p=Math.sqrt(1/d);f*=p,v*=p}if(c.alternate)if(e<.5){var y=2*e;v=1+(1/(f=1+(f-1)*this.getElasticProgress(y,c))-1)*(c.preserveArea?1:0)}else{var m=2*(e-.5);f+=(1-f)*this.getElasticProgress(m,c),v=1+(v-1)*this.getElasticProgress(m,c)}else{var g=this.getElasticProgress(e,c);f=1+(f-1)*g*l,v=1+(v-1)*g*l}if(c.centerBased?(o=a+u.offsetX*f,h=r+u.offsetY*v):(o=u.startX*f,h=u.startY*v),t.x=o,t.y=h,t.vx=u.offsetX*(f-1)*l*.1,t.vy=u.offsetY*(v-1)*l*.1,e>.9){var b=10*(1-e);t.vx=t.vx*b+u.originalVx*(1-b),t.vy=t.vy*b+u.originalVy*(1-b)}},getElasticProgress:function(t,e){if(!e.elastic)return this.easeInOutCubic(t);if(0===t)return 0;if(1===t)return 1;var i=e.overshoot||.1;if(t<.5){var n=2*t;return.5*this.easeInElastic(n,i)}var a=2*(t-.5);return.5+.5*this.easeOutElastic(a,i)},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.stretch){var i=t.gestureData.stretch;t.vx=i.originalVx,t.vy=i.originalVy,delete t.gestureData.stretch}},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeInElastic:function(t,e){if(0===t)return 0;if(1===t)return 1;return-Math.pow(2,10*(t-1))*Math.sin((t-1-.075)*(2*Math.PI)/.3)*(1+e)},easeOutElastic:function(t,e){if(0===t)return 0;if(1===t)return 1;return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)*(1+e)+1}};function X(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?X(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):X(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const U={name:"tilt",emoji:"🤔",type:"override",description:"Gather particles then tilt as unified group",config:{duration:500,gatherPhase:.2,tiltAngle:45,swayAmount:80,liftAmount:60,frequency:3,homeRadius:20,easing:"sine",strength:2.5,particleMotion:{type:"tilt",strength:2.5,frequency:3,swayAmount:80,liftAmount:60},smoothness:.25},rhythm:{enabled:!0,syncMode:"swing",angleSync:{onBeat:45,offBeat:-30,swing:15,subdivision:"triplet",curve:"ease-in-out"},gatherSync:{beatsBefore:.5,releaseAfter:.25,intensity:"dynamic"},swaySync:{verse:60,chorus:100,bridge:80,syncopated:!0},liftSync:{upOnTilt:!0,heightOnAccent:80,normalHeight:40,curve:"bounce"},dynamics:{forte:{tiltAngle:60,swayAmount:120,frequency:4},piano:{tiltAngle:20,swayAmount:40,frequency:2}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n,s=Math.atan2(r,a),o=Math.sqrt(a*a+r*r),h=Math.random(),u=(Y(Y({},this.config),e).homeRadius+20*Math.random())*t.scaleFactor;t.gestureData.tilt={startX:t.x,startY:t.y,originalVx:t.vx,originalVy:t.vy,angle:s,distance:o,homeRadius:u,homeX:i+Math.cos(s)*u,homeY:n+Math.sin(s)*u,role:h,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.tilt)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o,h,u=t.gestureData.tilt,c=Y(Y({},this.config),i),l=i.strength||1;if(e<c.gatherPhase){var f=e/c.gatherPhase,v=this.easeInOutCubic(f);o=u.startX+(u.homeX-u.startX)*v,h=u.startY+(u.homeY-u.startY)*v;t.x+=.6*(o-t.x),t.y+=.6*(h-t.y)}else{var d=(e-c.gatherPhase)/(1-c.gatherPhase)*Math.PI*c.frequency,p=Math.sin(d),y=c.tiltAngle*Math.PI/180*l,m=u.angle+p*y,g=Math.abs(p)*c.liftAmount*t.scaleFactor,b=u.homeRadius+g;o=a+Math.cos(m)*b,h=r+Math.sin(m)*b-.3*g;var M=c.smoothness+.1*u.role;t.x+=(o-t.x)*M,t.y+=(h-t.y)*M;var k=-Math.sin(m),w=Math.cos(m);t.vx=k*p*2,t.vy=w*p*2}if(e<c.gatherPhase&&(t.vx=.25*(o-t.x),t.vy=.25*(h-t.y)),e>.9){var S=10*(1-e),O=u.startX+(t.x-u.startX)*S,j=u.startY+(t.y-u.startY)*S;t.x=O,t.y=j,t.vx=t.vx*S+u.originalVx*(1-S),t.vy=t.vy*S+u.originalVy*(1-S)}},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.tilt){var i=t.gestureData.tilt;t.vx=i.originalVx,t.vy=i.originalVy,delete t.gestureData.tilt}},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}},N={name:"orbital",emoji:"🪐",type:"override",description:"Orbital motion around center",config:{speed:.02,maintainRadius:!0,elliptical:!1,use3D:!0,zPhaseOffset:0,verticalOscillation:0,duration:3e3,particleMotion:{type:"orbital",strength:1}},rhythm:{enabled:!0,syncMode:"harmonic",speedSync:{tonic:.02,fifth:.03,octave:.04,third:.025,curve:"smooth"},radiusSync:{bass:150,mid:100,treble:50,scaling:"logarithmic"},depthSync:{major:{z:1,phase:0},minor:{z:-1,phase:Math.PI},diminished:{z:.5,phase:Math.PI/2},augmented:{z:.8,phase:-Math.PI/2}},phaseSync:{mode:"harmonic",intervals:[1,1.5,2],drift:.05},dynamics:{forte:{speed:.04,maintainRadius:!1},piano:{speed:.01,maintainRadius:!0}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n,s=Math.sqrt(a*a+r*r),o=Math.random()<.5?1:-1,h=Math.max(s,100+180*Math.random());t.gestureData.orbital={radius:h,targetRadius:h,angle:s<5?Math.random()*Math.PI*2:Math.atan2(r,a),originalVx:t.vx,originalVy:t.vy,originalZ:t.z||0,zPhase:Math.random()*Math.PI*2,direction:o}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&s.orbital||this.initialize(t,i,a,r);var o=t.gestureData.orbital,h=(i.speed||this.config.speed)*(i.strength||1);o.angle+=h*n*o.direction;var u=o.radius;if(i.maintainRadius||(u=o.radius*(1+.1*Math.sin(e*Math.PI*2))),t.x=a+Math.cos(o.angle)*u,t.y=r+Math.sin(o.angle)*u,!1!==i.use3D){var c=o.angle+o.zPhase+(i.zPhaseOffset||0);if(t.z=.8*Math.sin(c),i.verticalOscillation){var l=Math.cos(c)*i.verticalOscillation*u*.1;t.y+=l}}if(t.vx=-Math.sin(o.angle)*u*h,t.vy=Math.cos(o.angle)*u*h,e>.9){var f=10*(1-e);t.vx=t.vx*f+o.originalVx*(1-f),t.vy=t.vy*f+o.originalVy*(1-f)}},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.orbital){var i=t.gestureData.orbital;t.vx=i.originalVx,t.vy=i.originalVy,t.z=i.originalZ,delete t.gestureData.orbital}}},W={name:"hula",emoji:"🌀",type:"override",description:"Hula-hoop motion with vertical waves",config:{speed:.015,maintainRadius:!1,elliptical:!0,use3D:!0,zPhaseOffset:Math.PI/4,verticalOscillation:.3,wobbleAmount:.15,duration:2500,particleMotion:{type:"hula",strength:1,verticalOscillation:.3}},rhythm:{enabled:!0,syncMode:"bar",speedSync:{mode:"tempo",baseSpeed:.015,scaling:"proportional"},wobbleSync:{onBeat:.25,offBeat:.1,curve:"sine"},verticalSync:{subdivision:"quarter",amplitude:.4,phase:"sequential"},dynamics:{forte:{wobbleAmount:.3,speed:1.2},piano:{wobbleAmount:.05,speed:.8}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n,s=Math.sqrt(a*a+r*r),o=Math.random()<.5?1:-1,h=Math.max(s,100+180*Math.random());t.gestureData.hula={radius:h,angle:s<5?Math.random()*Math.PI*2:Math.atan2(r,a),originalVx:t.vx,originalVy:t.vy,originalZ:t.z||0,zPhase:Math.random()*Math.PI*2,wobblePhase:Math.random()*Math.PI*2,direction:o}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&s.hula||this.initialize(t,i,a,r);var o=t.gestureData.hula,h=(i.speed||this.config.speed)*(i.strength||1),u=1;e<.1?(u=e/.1,u=Math.sin(u*Math.PI*.5)):e>.9&&(u=(1-e)/.1,u=Math.sin(u*Math.PI*.5)),o.angle+=h*n*o.direction*u;var c=Math.sin(2*o.angle+o.wobblePhase)*(i.wobbleAmount||this.config.wobbleAmount)*u,l=o.radius*(1+c)*u,f=o.radius*(.7+c)*u,v=a+Math.cos(o.angle)*l,d=r+Math.sin(o.angle)*f;if(e<.1){var p=t.x-a,y=t.y-r;Math.sqrt(p*p+y*y)<50?(t.x=a+Math.cos(o.angle)*l,t.y=r+Math.sin(o.angle)*f):(t.x=t.x+(v-t.x)*u*.5,t.y=t.y+(d-t.y)*u*.5)}else t.x=v,t.y=d;var m=o.angle+o.zPhase+(i.zPhaseOffset||this.config.zPhaseOffset);t.z=.9*Math.sin(m)*u;var g=i.verticalOscillation||this.config.verticalOscillation,b=Math.cos(2*m)*g*o.radius*.2*u;t.y+=b;var M=t.z*o.radius*.1;t.y-=M;var k=-Math.sin(o.angle)*l*h,w=Math.cos(o.angle)*f*h;e<.1?(t.vx=o.originalVx+(k-o.originalVx)*u,t.vy=o.originalVy+(w-o.originalVy)*u):e>.9?(t.vx=k*u+o.originalVx*(1-u),t.vy=w*u+o.originalVy*(1-u),t.z=t.z*u+o.originalZ*(1-u)):(t.vx=k,t.vy=w)},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.hula){var i=t.gestureData.hula;t.vx=i.originalVx,t.vy=i.originalVy,t.z=i.originalZ,delete t.gestureData.hula}}},Q={name:"scan",emoji:"🔍",type:"override",description:"Searchlight scanning motion",config:{scanSpeed:.008,scanWidth:120,pauseDuration:300,scanHeight:40,layers:3,duration:3e3},rhythm:{enabled:!0,syncMode:"measure",sweepSync:{beatsPerSweep:4,pauseOnDownbeat:!0,reverseOnBar:!0,curve:"linear"},layerSync:{quiet:1,moderate:2,loud:3,stagger:"sequential"},pauseSync:{onBeat:500,offBeat:100,accent:800,subdivision:"quarter"},widthSync:{verse:80,chorus:140,bridge:100,transition:"smooth"},dynamics:{forte:{scanSpeed:.012,layers:4},piano:{scanSpeed:.004,layers:1}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=Math.floor(Math.random()*this.config.layers);t.gestureData.scan={layer:a,phase:Math.random()*Math.PI*2,direction:Math.random()<.5?1:-1,pauseTimer:0,isPaused:!1,originalX:t.x,originalY:t.y,originalVx:t.vx,originalVy:t.vy,scanOffset:20*(Math.random()-.5),verticalOffset:30*a-30,initialized:!0,startTime:Date.now()}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&s.scan||this.initialize(t,i,a,r);var o=t.gestureData.scan,h=i.scanSpeed||this.config.scanSpeed,u=i.scanWidth||this.config.scanWidth,c=i.pauseDuration||this.config.pauseDuration;if(o.isPaused)o.pauseTimer-=16*n,o.pauseTimer<=0&&(o.isPaused=!1,o.direction*=-1);else{o.phase+=h*o.direction*n;var l=Math.sin(o.phase);Math.abs(l)>.95&&(o.isPaused=!0,o.pauseTimer=c)}var f=Math.sin(o.phase)*u,v=Math.cos(.5*o.phase)*(this.config.scanHeight/2),d=1;e<.15?(d=e/.15,d*=d):e>.85&&(d=(1-e)/.15,d*=d);var p=a+f+o.scanOffset,y=r+v+o.verticalOffset;t.x=o.originalX+(p-o.originalX)*d,t.y=o.originalY+(y-o.originalY)*d,o.isPaused?(t.vx*=.85,t.vy*=.85):(t.vx=-Math.cos(o.phase)*u*h*60,t.vy=-Math.sin(.5*o.phase)*this.config.scanHeight*h*30),Math.random()<.02&&(t.vx+=2*(Math.random()-.5),t.vy+=2*(Math.random()-.5))},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.scan){var i=t.gestureData.scan;t.vx=i.originalVx,t.vy=i.originalVy,delete t.gestureData.scan}}};function J(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Z(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?J(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):J(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const $={name:"twist",emoji:"🌀",type:"override",description:"Twisting dance motion with alternating rotation",config:{duration:1200,rotationAngle:45,contractionFactor:.8,twistFrequency:2,easing:"smooth",strength:.8,particleMotion:{type:"twist",rotationAngle:45,contractionFactor:.8,twistFrequency:2}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",interruptible:!0,priority:4,blendable:!1,crossfadePoint:"anyBeat",amplitudeSync:{onBeat:1.5,offBeat:.7,curve:"elastic"},patternOverrides:{funk:{rotationAngle:60,contractionFactor:.7},disco:{twistFrequency:3,rotationAngle:50},latin:{rotationAngle:35,contractionFactor:.85,twistFrequency:2.5}}},initialize:function(t,e){t.gestureData||(t.gestureData={}),t.gestureData.twist={startX:t.x,startY:t.y,startAngle:Math.atan2(t.y-e.centerY,t.x-e.centerX),startDistance:Math.sqrt(Math.pow(t.x-e.centerX,2)+Math.pow(t.y-e.centerY,2)),initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.twist)&&void 0!==s&&s.initialized||this.initialize(t,Z(Z({},i),{},{centerX:a,centerY:r}));var o=Z(Z({},this.config),i),h=t.gestureData.twist,u=o.strength||this.config.strength||1,c=e*o.twistFrequency*Math.PI*2,l=Math.sin(c)*u,f=o.rotationAngle,v=o.contractionFactor;i.rhythmModulation&&(f*=i.rhythmModulation.amplitudeMultiplier||1,v=1-(1-v)*(i.rhythmModulation.amplitudeMultiplier||1));var d=f*Math.PI/180*l,p=1-(1-v)*Math.abs(l),y=h.startAngle+d,m=h.startDistance*p,g=a+Math.cos(y)*m,b=r+Math.sin(y)*m,M=.15*u;t.x+=(g-t.x)*M,t.y+=(b-t.y)*M,t.vx=.05*(g-t.x),t.vy=.05*(b-t.y);var k=5*Math.sin(e*Math.PI*4)*u;if(t.y+=.1*k,e>.9){var w=1-10*(e-.9);t.vx*=w,t.vy*=w}},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.twist&&delete t.gestureData.twist}};function K(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function tt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?K(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):K(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const et={name:"wave",emoji:"🌊",type:"override",description:"Infinity pattern flow with phasing",config:{musicalDuration:{musical:!0,bars:1,minBeats:4,maxBeats:16},phases:[{name:"gather",beats:.5},{name:"rise",beats:.5},{name:"waveLeft",beats:1},{name:"waveRight",beats:1},{name:"settle",beats:1}],amplitude:40,frequency:1,phaseShift:.3,liftHeight:20,fadeInOut:!0,smoothness:.1,easing:"sine",strength:1,particleMotion:{type:"wave",strength:1,amplitude:50}},rhythm:{enabled:!0,syncMode:"wave",amplitudeSync:{onWave:65,onStatic:25,curve:"flowing"},frequencySync:{mode:"phrase",slow:.7,fast:1.8,curve:"melodic"},durationSync:{mode:"bars",adaptToPhrase:!0,sustain:!0},phaseSync:{enabled:!0,multiplier:.5,type:"ensemble"},melodicResponse:{enabled:!0,multiplier:1.4,type:"amplitude"},patternOverrides:{ambient:{amplitudeSync:{onWave:80,onStatic:40,curve:"hypnotic"},frequencySync:{slow:.5,fast:1.2},durationSync:{minBeats:16,maxBeats:64}},ocean:{amplitudeSync:{onWave:90,onStatic:20,curve:"natural"},phaseSync:{multiplier:.8},melodicResponse:{multiplier:1.8}},electronic:{amplitudeSync:{onWave:70,onStatic:30,curve:"digital"},frequencySync:{slow:.8,fast:2.5,curve:"precise"}},orchestral:{amplitudeSync:{onWave:75,onStatic:35},phaseSync:{multiplier:.7},melodicResponse:{multiplier:2}}},dynamics:{forte:{amplitudeSync:{onWave:{multiplier:1.8},onStatic:{multiplier:1.4}},frequencySync:{multiplier:1.3},melodicResponse:{multiplier:2.2}},piano:{amplitudeSync:{onWave:{multiplier:.6},onStatic:{multiplier:.4}},frequencySync:{multiplier:.7},melodicResponse:{multiplier:1.1}}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n,s=Math.atan2(r,a),o=Math.sqrt(a*a+r*r),h=Math.random()<.5?1:-1;t.gestureData.wave={startX:t.x,startY:t.y,originalVx:t.vx,originalVy:t.vy,baseOpacity:t.opacity||t.life||1,angle:s,radius:o,offset:Math.random()*Math.PI*2,role:Math.random(),direction:h,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.wave)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o,h=t.gestureData.wave,u=tt(tt({},this.config),i),c=i.strength||1,l=this.easeInOutSine(e),f=h.role*u.phaseShift,v=Math.max(0,l-f),d=v*Math.PI*2*u.frequency*h.direction+h.offset,p=.5+h.radius/100*.5,y=u.amplitude*p*c*t.scaleFactor,m=a+Math.sin(d)*y,g=r+Math.sin(2*d)*y*.3+-Math.abs(Math.sin(l*Math.PI))*u.liftHeight*t.scaleFactor,b=u.smoothness+.12*h.role;(t.x+=(m-t.x)*b,t.y+=(g-t.y)*b,t.vx=.3*(m-t.x),t.vy=.3*(g-t.y),u.fadeInOut)&&(o=v<.1?v/.1:v>.9?(1-v)/.1:.5+.5*Math.sin(v*Math.PI),t.opacity=h.baseOpacity*(.3+.7*o),void 0!==t.life&&(t.life=t.opacity));if(e>=.95){var M=20*(1-e);t.vx=t.vx*M+h.originalVx*(1-M),t.vy=t.vy*M+h.originalVy*(1-M),u.fadeInOut&&(t.opacity=h.baseOpacity*M,void 0!==t.life&&(t.life=t.opacity))}},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.wave){var i=t.gestureData.wave;t.vx=i.originalVx,t.vy=i.originalVy,t.opacity=i.baseOpacity,void 0!==t.life&&(t.life=i.baseOpacity),delete t.gestureData.wave}},easeInOutSine:function(t){return-(Math.cos(Math.PI*t)-1)/2}};function it(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function nt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?it(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):it(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const at={name:"drift",emoji:"☁️",type:"override",description:"Controlled floating with fade effects",config:{duration:800,distance:50,angle:45,returnToOrigin:!0,fadeOut:!1,holdTime:.2,turbulence:.1,angleSpread:45,smoothness:.08,easing:"ease",strength:1,particleMotion:{type:"drift",strength:1,distance:60}},rhythm:{enabled:!0,syncMode:"ambient",distanceSync:{quiet:30,loud:80,crescendo:"expand",diminuendo:"contract"},angleSync:{major:45,minor:225,modulation:"smooth",cadence:"return"},holdSync:{shortPhrase:.1,longPhrase:.4,fermata:"sustain"},accentResponse:{enabled:!0,multiplier:1.3,type:"distance"},patternOverrides:{ambient:{distanceSync:{quiet:40,loud:100},holdSync:{shortPhrase:.3,longPhrase:.6}},classical:{angleSync:{major:30,minor:210},distanceSync:{quiet:25,loud:60}},jazz:{angleSync:{major:60,minor:240,swing:!0,syncopated:!0}},new_age:{distanceSync:{quiet:35,loud:70},holdSync:{shortPhrase:.4,longPhrase:.8},angleSync:{modulation:"gradual"}}},dynamics:{forte:{distanceSync:{quiet:{multiplier:1.5},loud:{multiplier:1.8}},holdSync:{multiplier:1.2},accentResponse:{multiplier:1.6}},piano:{distanceSync:{quiet:{multiplier:.6},loud:{multiplier:.8}},holdSync:{multiplier:.8},accentResponse:{multiplier:1.1}}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n,s=Math.atan2(r,a),o=nt(nt({},this.config),e).angleSpread*Math.PI/180,h=(Math.random()-.5)*o;s+=h;var u=30+30*Math.random();t.gestureData.drift={startX:t.x,startY:t.y,originalVx:t.vx,originalVy:t.vy,baseOpacity:t.opacity||t.life||1,driftAngle:s,angleOffset:h,homeRadius:u*t.scaleFactor,homeX:i+Math.cos(s)*u,homeY:n+Math.sin(s)*u,role:Math.random(),turbulencePhase:Math.random()*Math.PI*2,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.drift)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o,h,u,c=t.gestureData.drift,l=nt(nt({},this.config),i),f=i.strength||1,v=this.easeInOutCubic(e),d=Math.max(0,v-.1*c.role);if(l.returnToOrigin)if(d<.4){var p=d/.4,y=this.easeOutQuad(p);o=c.startX+(c.homeX-c.startX)*y,h=c.startY+(c.homeY-c.startY)*y}else if(d<.6+l.holdTime){var m=(d-.4)/(.2+l.holdTime);u=c.homeRadius+Math.sin(m*Math.PI*.5)*l.distance*f*t.scaleFactor}else{var g=(d-.6-l.holdTime)/(.4-l.holdTime);u=c.homeRadius+Math.cos(g*Math.PI*.5)*l.distance*f*t.scaleFactor}else{var b=d;u=c.homeRadius+b*l.distance*f*t.scaleFactor}if(void 0!==u){c.turbulencePhase+=l.turbulence*n;var M=Math.sin(c.turbulencePhase)*l.turbulence*10,k=Math.cos(1.3*c.turbulencePhase)*l.turbulence*10,w=c.driftAngle+c.angleOffset;o=a+Math.cos(w)*u+M,h=r+Math.sin(w)*u+k}var S,O=l.smoothness+.08*c.role;(t.x+=(o-t.x)*O,t.y+=(h-t.y)*O,t.vx=.25*(o-t.x),t.vy=.25*(h-t.y),l.fadeOut)&&(S=e<.25?.3+e/.25*.7:e<.75?.7+.3*Math.sin((e-.25)*Math.PI/.5):4*(1-e),t.opacity=c.baseOpacity*S,void 0!==t.life&&(t.life=t.opacity));e>=.99&&(t.vx=.1*c.originalVx,t.vy=.1*c.originalVy,l.fadeOut&&(t.opacity=c.baseOpacity,void 0!==t.life&&(t.life=c.baseOpacity)))},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.drift){var i=t.gestureData.drift;t.vx=i.originalVx,t.vy=i.originalVy,t.opacity=i.baseOpacity,void 0!==t.life&&(t.life=i.baseOpacity),delete t.gestureData.drift}},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeOutQuad:function(t){return t*(2-t)}};function rt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function st(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?rt(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):rt(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const ot={name:"flicker",emoji:"⚡",type:"blending",description:"Rapid opacity changes with motion jitter",config:{duration:800,flickerRate:15,frequency:6,minOpacity:.3,maxOpacity:1,jitterAmount:2,colorShift:!1,strobe:!1,pulseMode:!1,groupFlicker:.3,easing:"linear",strength:.7,particleMotion:{type:"flicker",strength:.7,frequency:6}},rhythm:{enabled:!0,syncMode:"subdivision",rateSync:{subdivision:"sixteenth",onBeat:30,offBeat:10,triplet:20,curve:"step"},opacitySync:{pattern:"HLMH",subdivision:"eighth",onAccent:.1,regular:.5},jitterSync:{onBeat:5,offBeat:1,accent:10,curve:"random"},strobeSync:{verse:!1,chorus:!0,drop:"intense",pattern:"XOXO"},dynamics:{forte:{flickerRate:25,jitterAmount:5,minOpacity:.1},piano:{flickerRate:8,jitterAmount:1,minOpacity:.5}}},initialize:function(t,e){t.gestureData||(t.gestureData={});var i=st(st({},this.config),e),n=Math.random()<i.groupFlicker;t.gestureData.flicker={baseOpacity:t.opacity||t.life||1,baseColor:t.color,baseX:t.x,baseY:t.y,flickerTimer:0,lastFlicker:0,flickerState:!0,isGrouped:n,groupId:n?Math.floor(3*Math.random()):-1,phase:Math.random()*Math.PI*2,colorHue:0,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.flicker)&&void 0!==s&&s.initialized||this.initialize(t,i);var o,h=t.gestureData.flicker,u=st(st({},this.config),i),c=i.strength||1;if(h.flickerTimer+=n*u.flickerRate,u.strobe)o=(h.flickerTimer+h.phase)%1<.5?1:u.minOpacity;else if(u.pulseMode){var l=h.flickerTimer+h.phase;o=u.minOpacity+(u.maxOpacity-u.minOpacity)*(.5*Math.sin(l)+.5)}else{if(h.flickerTimer-h.lastFlicker>1)if(h.lastFlicker=h.flickerTimer,h.isGrouped){var f=Math.floor(h.flickerTimer)%3;h.flickerState=f===h.groupId}else h.flickerState=Math.random()>.3;var v=h.flickerState?u.maxOpacity:u.minOpacity+.3*Math.random(),d=t.opacity/h.baseOpacity;o=d+.3*(v-d)}var p=h.baseOpacity*(1+(o-1)*c);if(t.opacity=Math.max(0,Math.min(1,p)),void 0!==t.life&&(t.life=t.opacity),u.jitterAmount>0&&o>u.minOpacity){var y=u.jitterAmount*c*t.scaleFactor,m=(Math.random()-.5)*y*o,g=(Math.random()-.5)*y*o;t.vx+=.1*m*n,t.vy+=.1*g*n}if(u.colorShift&&t.color){h.colorHue+=.01*n;var b=30*Math.sin(h.colorHue);t.color=this.shiftHue(h.baseColor,b*c)}var M=1;e<.1?M=e/.1:e>.9&&(M=(1-e)/.1),t.opacity*=M,void 0!==t.life&&(t.life=t.opacity),e>.8&&(t.vx*=.95,t.vy*=.95)},shiftHue:function(t,e){if(!t||!t.startsWith("#"))return t;var i=t.slice(1),n=parseInt(i.substr(0,2),16)/255,a=parseInt(i.substr(2,2),16)/255,r=parseInt(i.substr(4,2),16)/255,s=e*Math.PI/180,o=Math.cos(s),h=Math.sin(s),u=n*h+a*o,c=r,l=function(t){return Math.max(0,Math.min(255,Math.round(255*t))).toString(16).padStart(2,"0")};return"#"+l(n*o-a*h)+l(u)+l(c)},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.flicker){var i=t.gestureData.flicker;t.opacity=i.baseOpacity,t.color=i.baseColor,void 0!==t.life&&(t.life=i.baseOpacity),delete t.gestureData.flicker}}},ht={name:"burst",emoji:"💥",type:"blending",description:"Explosive outward burst from center",config:{decay:.5,strength:2},rhythm:{enabled:!0,syncMode:"beat",strengthSync:{onBeat:3.5,offBeat:1,curve:"explosion"},decaySync:{mode:"tempo",fast:.8,slow:.3,curve:"exponential"},durationSync:{mode:"beats",beats:.5,sustain:!1},accentResponse:{enabled:!0,multiplier:2.5,type:"strength"},patternOverrides:{rock:{strengthSync:{onBeat:4,offBeat:1.5},decaySync:{fast:.6,slow:.4}},electronic:{strengthSync:{onBeat:3.8,offBeat:.8,curve:"sharp"},decaySync:{fast:.9,slow:.7}},jazz:{strengthSync:{onBeat:2.8,offBeat:1.8,swing:!0},decaySync:{fast:.5,slow:.2}},orchestral:{strengthSync:{onBeat:3.2,offBeat:.5},accentResponse:{multiplier:3}}},dynamics:{forte:{strengthSync:{onBeat:{multiplier:2},offBeat:{multiplier:1.5}},decaySync:{multiplier:.7},accentResponse:{multiplier:3.5}},piano:{strengthSync:{onBeat:{multiplier:.6},offBeat:{multiplier:.3}},decaySync:{multiplier:1.3},accentResponse:{multiplier:1.8}}}},apply:function(t,e,i,n,a,r){var s=i.decay||this.config.decay,o=(i.strength||this.config.strength)*(1-e*s),h=t.x-a,u=t.y-r,c=Math.sqrt(h*h+u*u);c>1&&(t.vx+=h/c*o*2*n,t.vy+=u/c*o*2*n)}},ut={name:"directional",emoji:"➡️",type:"blending",description:"Move particles in a specific direction",config:{angle:0,returnToOrigin:!1,strength:1},rhythm:{enabled:!0,syncMode:"flow",angleSync:{verse:0,chorus:90,bridge:180,outro:270,transition:"smooth"},strengthSync:{onBeat:1.8,offBeat:.6,curve:"wave"},returnSync:{enabled:!0,onSectionChange:!0,duration:"transition",strength:1.2},accentResponse:{enabled:!0,multiplier:2,type:"strength"},patternOverrides:{march:{angleSync:{verse:0,chorus:0},strengthSync:{onBeat:2.5,offBeat:1}},waltz:{angleSync:{verse:45,chorus:135,bridge:225,outro:315,transition:"circular"}},swing:{strengthSync:{onBeat:1.6,offBeat:1.4,swing:!0}},electronic:{angleSync:{transition:"instant"},strengthSync:{onBeat:2.2,offBeat:.4,curve:"sharp"}}},dynamics:{forte:{strengthSync:{onBeat:{multiplier:1.6},offBeat:{multiplier:1.2}},angleSync:{transition:"sharp"},accentResponse:{multiplier:2.5}},piano:{strengthSync:{onBeat:{multiplier:.7},offBeat:{multiplier:.8}},angleSync:{transition:"gradual"},accentResponse:{multiplier:1.4}}}},initialize:function(t){t.gestureData||(t.gestureData={}),t.gestureData.directional={initialX:t.x,initialY:t.y}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&s.directional||this.initialize(t);var o=(i.angle||this.config.angle)*Math.PI/180,h=i.strength||this.config.strength;if(t.vx+=Math.cos(o)*h*.3*n,t.vy+=Math.sin(o)*h*.3*n,i.returnToOrigin&&e>.5){var u=2*(e-.5),c=t.gestureData.directional,l=c.initialX-t.x,f=c.initialY-t.y;t.vx+=l*u*.02*n,t.vy+=f*u*.02*n}}},ct={name:"settle",emoji:"🍃",type:"blending",description:"Gradually settle particles to rest",config:{damping:.02,threshold:.01},rhythm:{enabled:!0,syncMode:"resolution",dampingSync:{onResolution:.035,onTension:.015,curve:"gradual"},thresholdSync:{mode:"dynamics",forte:.02,piano:.005,curve:"exponential"},durationSync:{mode:"phrase",minBeats:2,maxBeats:12,sustain:!0},cadenceResponse:{enabled:!0,multiplier:1.6,type:"damping"},patternOverrides:{ambient:{dampingSync:{onResolution:.025,onTension:.008,curve:"atmospheric"},durationSync:{minBeats:8,maxBeats:32}},jazz:{dampingSync:{onResolution:.04,onTension:.02},cadenceResponse:{multiplier:1.8}},classical:{dampingSync:{onResolution:.045,onTension:.012,curve:"expressive"},cadenceResponse:{multiplier:2}},minimalist:{dampingSync:{onResolution:.02,onTension:.005},durationSync:{minBeats:16,maxBeats:64}}},dynamics:{forte:{dampingSync:{onResolution:{multiplier:1.4},onTension:{multiplier:.8}},thresholdSync:{multiplier:2},cadenceResponse:{multiplier:2.2}},piano:{dampingSync:{onResolution:{multiplier:.7},onTension:{multiplier:1.2}},thresholdSync:{multiplier:.5},cadenceResponse:{multiplier:1.3}}}},apply:function(t,e,i,n,a,r){var s=i.damping||this.config.damping,o=i.threshold||this.config.threshold;t.vx*=Math.max(0,1-s*n*60),t.vy*=Math.max(0,1-s*n*60),Math.abs(t.vx)<o&&(t.vx=0),Math.abs(t.vy)<o&&(t.vy=0)}};function lt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function ft(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?lt(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):lt(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const vt={name:"fade",emoji:"👻",type:"blending",description:"Fade particle opacity",config:{fadeIn:!1,fadeOut:!0,minOpacity:0,maxOpacity:1},rhythm:{enabled:!0,syncMode:"dynamic",opacitySync:{onBeat:.9,offBeat:.3,subdivision:"eighth",curve:"exponential"},fadePhaseSync:{verse:{fadeIn:!0,fadeOut:!1},chorus:{fadeIn:!1,fadeOut:!1},bridge:{fadeIn:!0,fadeOut:!0},outro:{fadeIn:!1,fadeOut:!0}},pulseSync:{enabled:!0,frequency:"quarter",intensity:.2,onAccent:.4},dynamics:{forte:{minOpacity:.5,maxOpacity:1},piano:{minOpacity:0,maxOpacity:.4}}},initialize:function(t){t.gestureData||(t.gestureData={}),t.gestureData.fade={baseOpacity:t.opacity||t.life||1}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&s.fade||this.initialize(t);var o,h=t.gestureData.fade,u=ft(ft({},this.config),i);o=u.fadeIn&&!u.fadeOut?u.minOpacity+(u.maxOpacity-u.minOpacity)*e:u.fadeOut&&!u.fadeIn?u.maxOpacity-(u.maxOpacity-u.minOpacity)*e:e<.5?u.minOpacity+(u.maxOpacity-u.minOpacity)*(2*e):u.maxOpacity-(u.maxOpacity-u.minOpacity)*(2*(e-.5)),t.opacity=h.baseOpacity*o,void 0!==t.life&&(t.life=t.opacity)},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.fade&&(t.opacity=t.gestureData.fade.baseOpacity,void 0!==t.life&&(t.life=t.opacity),delete t.gestureData.fade)}};function dt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function pt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):dt(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const yt={name:"breathe",emoji:"🫁",type:"blending",description:"Breathing rhythm with inhale and exhale",config:{musicalDuration:{musical:!0,bars:1,minBeats:2,maxBeats:16},phases:[{name:"inhale",beats:1.5},{name:"hold_in",beats:.5},{name:"exhale",beats:1.5},{name:"hold_out",beats:.5}],inhaleRadius:1.5,exhaleRadius:.3,breathRate:.3,spiralStrength:.002,scaleAmount:.25,glowAmount:.4,frequency:1,easing:"sine",strength:.8,particleMotion:{type:"breathe",strength:.8,inhaleRadius:1.5,exhaleRadius:.3}},rhythm:{enabled:!0,syncMode:"phrase",breathRateSync:{mode:"tempo",bpm:"auto",subdivision:"whole",curve:"sine"},radiusSync:{inhale:{onUpbeat:1.8,onDownbeat:1.4,curve:"ease-in"},exhale:{onUpbeat:.2,onDownbeat:.4,curve:"ease-out"}},durationSync:{mode:"phrases",phrases:2,hold:"fermata"},accentResponse:{enabled:!0,multiplier:1.5,type:"expansion"},patternOverrides:{ballad:{breathRateSync:{subdivision:"double-whole"},radiusSync:{inhale:{onUpbeat:2.2,onDownbeat:1.8},exhale:{onUpbeat:.1,onDownbeat:.2}}},uptempo:{breathRateSync:{subdivision:"half"},radiusSync:{inhale:{onUpbeat:1.4,onDownbeat:1.2},exhale:{onUpbeat:.3,onDownbeat:.4}}},ambient:{breathRateSync:{subdivision:"whole",curve:"ease"},radiusSync:{inhale:{onUpbeat:1.6,onDownbeat:1.6},exhale:{onUpbeat:.2,onDownbeat:.2}}}},dynamics:{forte:{radiusSync:{inhale:{multiplier:1.8},exhale:{multiplier:.5}},spiralStrength:.004,scaleAmount:.4},piano:{radiusSync:{inhale:{multiplier:1.2},exhale:{multiplier:.8}},spiralStrength:.001,scaleAmount:.1}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n;t.gestureData.breathe={startX:t.x,startY:t.y,angle:Math.atan2(r,a),baseRadius:Math.sqrt(a*a+r*r),phaseOffset:.2*Math.random()-.1}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&s.breathe||this.initialize(t,i,a,r);t.gestureData.breathe;var o=pt(pt({},this.config),i),h=(Math.sin(e*Math.PI*2*o.breathRate)+1)/2,u=100*(t.scaleFactor||1),c=o.inhaleRadius*u,l=o.exhaleRadius*u,f=l+(c-l)*h,v=t.x-a,d=t.y-r,p=Math.sqrt(v*v+d*d),y=f-p,m=.05*(i.strength||.8)*n;if(p>0){var g=v/p*y*m,b=d/p*y*m;t.vx+=g,t.vy+=b;var M=o.spiralStrength*n*(i.strength||1),k=-d/p,w=v/p;t.vx+=k*M*h,t.vy+=w*M*h}t.vx*=.98,t.vy*=.98},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.breathe&&delete t.gestureData.breathe}};function mt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function gt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):mt(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const bt={name:"expand",emoji:"💫",type:"blending",description:"Radial expansion from center",config:{duration:600,scaleAmount:3,scaleTarget:3,glowAmount:.5,easing:"back",strength:3,particleMotion:{type:"pulse",strength:3,direction:"outward",persist:!0}},rhythm:{enabled:!0,syncMode:"crescendo",strengthSync:{pianissimo:1.5,fortissimo:5,crescendo:"build",sforzando:"burst"},scaleTargetSync:{verse:2,chorus:4.5,climax:6,curve:"exponential"},durationSync:{mode:"phrases",build:1.2,release:.8,sustain:"hold"},accentResponse:{enabled:!0,multiplier:2.8,type:"strength"},patternOverrides:{orchestral:{strengthSync:{pianissimo:2,fortissimo:6.5,crescendo:"dramatic"},scaleTargetSync:{climax:8}},rock:{strengthSync:{pianissimo:1.8,fortissimo:5.5,curve:"power"},accentResponse:{multiplier:3.2}},ambient:{strengthSync:{pianissimo:1.2,fortissimo:3.5,crescendo:"organic"},durationSync:{build:1.8,release:1.2}},electronic:{strengthSync:{pianissimo:1.6,fortissimo:4.8,curve:"digital"},scaleTargetSync:{curve:"linear"}}},dynamics:{forte:{strengthSync:{pianissimo:{multiplier:1.4},fortissimo:{multiplier:1.8}},scaleTargetSync:{multiplier:1.6},accentResponse:{multiplier:3.5}},piano:{strengthSync:{pianissimo:{multiplier:.8},fortissimo:{multiplier:1.2}},scaleTargetSync:{multiplier:.7},accentResponse:{multiplier:2}}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n;t.gestureData.expand={startX:t.x,startY:t.y,angle:Math.atan2(r,a),baseRadius:Math.sqrt(a*a+r*r),initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.expand)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o=t.gestureData.expand,h=gt(gt({},this.config),i),u=h.strength||1,c=1+(h.scaleTarget-1)*e*u,l=o.baseRadius*c,f=a+Math.cos(o.angle)*l,v=r+Math.sin(o.angle)*l,d=f-t.x,p=v-t.y;t.vx+=.8*d*n,t.vy+=.8*p*n,t.vx*=.95,t.vy*=.95},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.expand&&delete t.gestureData.expand}};function Mt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function kt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Mt(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const wt={name:"contract",emoji:"🌀",type:"blending",description:"Radial contraction toward center",config:{duration:600,scaleAmount:.2,scaleTarget:.2,glowAmount:-.2,easing:"cubic",strength:2.5,particleMotion:{type:"pulse",strength:2.5,direction:"inward",persist:!0}},rhythm:{enabled:!0,syncMode:"tension",strengthSync:{onTension:4,onRelease:1.5,curve:"magnetic"},scaleTargetSync:{forte:.1,piano:.4,crescendo:"gradual",diminuendo:"ease"},durationSync:{mode:"phrases",shortPhrase:.8,longPhrase:1.5,hold:"sustain"},accentResponse:{enabled:!0,multiplier:2.2,type:"strength"},patternOverrides:{classical:{strengthSync:{onTension:3.5,onRelease:1.8},scaleTargetSync:{forte:.15,piano:.35}},metal:{strengthSync:{onTension:5,onRelease:2,curve:"sharp"},scaleTargetSync:{forte:.05,piano:.25}},ambient:{strengthSync:{onTension:2.8,onRelease:1.2,curve:"ease"},durationSync:{shortPhrase:1.2,longPhrase:2}},trap:{strengthSync:{onTension:4.5,onRelease:1,dropBeat:6},scaleTargetSync:{forte:.08,piano:.3}}},dynamics:{forte:{strengthSync:{onTension:{multiplier:1.8},onRelease:{multiplier:1.4}},scaleTargetSync:{multiplier:.6},accentResponse:{multiplier:2.8}},piano:{strengthSync:{onTension:{multiplier:.7},onRelease:{multiplier:.8}},scaleTargetSync:{multiplier:1.4},accentResponse:{multiplier:1.6}}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={});var a=t.x-i,r=t.y-n;t.gestureData.contract={startX:t.x,startY:t.y,angle:Math.atan2(r,a),baseRadius:Math.sqrt(a*a+r*r),initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.contract)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);var o=t.gestureData.contract,h=kt(kt({},this.config),i),u=h.strength||1,c=1-(1-h.scaleTarget)*e*u,l=o.baseRadius*c,f=a+Math.cos(o.angle)*l,v=r+Math.sin(o.angle)*l,d=f-t.x,p=v-t.y;t.vx+=.5*d*n,t.vy+=.5*p*n,t.vx*=.95,t.vy*=.95},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.contract&&delete t.gestureData.contract}};function St(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Ot(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?St(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):St(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const jt={name:"flash",emoji:"⚡",type:"blending",description:"Bright flash burst effect",config:{duration:400,glowAmount:2.5,glowPeak:3,scalePeak:1.1,easing:"cubic",strength:1,particleMotion:{type:"burst",strength:1,decay:.3}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"immediate",interruptible:!0,priority:8,blendable:!0,intensitySync:{onBeat:3.5,offBeat:1,accent:5,subdivision:"quarter",curve:"exponential"},durationSync:{mode:"tempo",baseDuration:400,scaling:"inverse"},scaleSync:{onBeat:1.2,offBeat:1,accent:1.4,curve:"elastic"},strobeSync:{enabled:!1,pattern:"XXOX",subdivision:"sixteenth"},dynamics:{forte:{glowPeak:4,scalePeak:1.3,duration:300},piano:{glowPeak:2,scalePeak:1.05,duration:500}}},initialize:function(t,e){t.gestureData||(t.gestureData={}),t.gestureData.flash={originalOpacity:t.opacity,originalSize:t.size,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.flash)&&void 0!==s&&s.initialized||this.initialize(t,i);var o,h=t.gestureData.flash,u=Ot(Ot({},this.config),i),c=u.strength||1;if(o=e<.3?e/.3*u.glowPeak:u.glowPeak*(1-(e-.3)/.7),t.opacity=Math.min(1,h.originalOpacity*(1+o*c)),t.size=h.originalSize*(1+(u.scalePeak-1)*o*c*.1),e<.2){var l=(1-e/.2)*c,f=Math.atan2(t.y-r,t.x-a);t.vx+=Math.cos(f)*l*2*n,t.vy+=Math.sin(f)*l*2*n}t.vx*=1-.1*u.particleMotion.decay,t.vy*=1-.1*u.particleMotion.decay},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.flash&&(t.opacity=t.gestureData.flash.originalOpacity,t.size=t.gestureData.flash.originalSize,delete t.gestureData.flash)}};function Ft(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function At(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ft(Object(i),!0).forEach(function(e){(0,r.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ft(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const xt={name:"glow",emoji:"✨",type:"blending",description:"Pure luminous glow without movement",config:{duration:1500,amplitude:0,frequency:1,holdPeak:.3,easing:"sine",scaleAmount:.1,glowAmount:.8,strength:0,direction:"none",particleMotion:{type:"glow",strength:0,direction:"none",frequency:1}},rhythm:{enabled:!0,syncMode:"phrase",amplitudeSync:{onBeat:2,offBeat:1.2,curve:"smooth"},frequencySync:{mode:"phrase",subdivision:"bar"},durationSync:{mode:"bars",bars:2},accentResponse:{enabled:!0,multiplier:2.5},patternOverrides:{ambient:{amplitudeSync:{onBeat:2.5,offBeat:1.8},durationSync:{bars:4}},electronic:{amplitudeSync:{onBeat:3,offBeat:.5,curve:"sharp"},frequencySync:{subdivision:"quarter"}}}},initialize:function(t,e,i,n){t.gestureData||(t.gestureData={}),t.gestureData.glow={startOpacity:t.opacity,startGlow:t.glowSizeMultiplier||0,initialized:!0}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&null!==(s=s.glow)&&void 0!==s&&s.initialized||this.initialize(t,i,a,r);t.gestureData.glow;var o,h=At(At({},this.config),i),u=this.easeInOutSine(e),c=h.frequency,l=h.glowAmount;i.rhythmModulation&&(l*=i.rhythmModulation.amplitudeMultiplier||1,l*=i.rhythmModulation.accentMultiplier||1,i.rhythmModulation.frequencyMultiplier&&(c*=i.rhythmModulation.frequencyMultiplier));var f=u*c*2%2;o=h.holdPeak>0&&f>1-h.holdPeak&&f<1+h.holdPeak?1:Math.sin(u*Math.PI*2*c);var v=1;e>.9&&(v=.5+.5*(1-10*(e-.9)));t.glowIntensity=1+o*l*v},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.glow&&(t.glowIntensity=1,delete t.gestureData.glow)},easeInOutSine:function(t){return-(Math.cos(Math.PI*t)-1)/2}},Bt={name:"peek",emoji:"👀",type:"effect",description:"Quick peek and hide motion",config:{peekDistance:40,peekSpeed:.15,holdDuration:200,hideSpeed:.25,stagger:!0,duration:1500},rhythm:{enabled:!0,syncMode:"accent",distanceSync:{onAccent:60,offAccent:25,curve:"quick"},speedSync:{mode:"tempo",fast:.25,slow:.1,hideMultiplier:1.8},durationSync:{mode:"subdivision",beats:.25,staggerBeats:.125,sustain:!1},syncopationResponse:{enabled:!0,multiplier:1.8,type:"distance"},patternOverrides:{funk:{distanceSync:{onAccent:70,offAccent:35,curve:"funky"},syncopationResponse:{multiplier:2.2}},latin:{speedSync:{fast:.3,slow:.12},durationSync:{beats:.5,staggerBeats:.25}},breakbeat:{distanceSync:{onAccent:55,offAccent:40},syncopationResponse:{multiplier:2.5}},classical:{distanceSync:{onAccent:45,offAccent:20,curve:"elegant"},speedSync:{fast:.18,slow:.08}}},dynamics:{forte:{distanceSync:{onAccent:{multiplier:1.6},offAccent:{multiplier:1.3}},speedSync:{multiplier:1.4},syncopationResponse:{multiplier:2.8}},piano:{distanceSync:{onAccent:{multiplier:.6},offAccent:{multiplier:.4}},speedSync:{multiplier:.7},syncopationResponse:{multiplier:1.2}}}},apply:function(t,e,i,n,a,r){if(t.gestureData||(t.gestureData={}),!t.gestureData.peek){var s=t.x-a,o=t.y-r,h=Math.atan2(o,s),u=Math.sqrt(s*s+o*o);t.gestureData.peek={originalX:t.x,originalY:t.y,peekAngle:h,originalDistance:u,staggerDelay:this.config.stagger?.3*Math.random():0,phase:"waiting",phaseTimer:0,peekOffset:{x:0,y:0}}}var c=t.gestureData.peek,l=this.config,f=Math.max(0,Math.min(1,(e-c.staggerDelay)/(1-c.staggerDelay)));0===f?c.phase="waiting":f<.3?c.phase="peeking":f<.6?c.phase="holding":f<1&&(c.phase="hiding");var v=0;switch(c.phase){case"peeking":var d=f/.3;v=this.easeOutCubic(d)*l.peekDistance;break;case"holding":v=l.peekDistance,Math.random()<.1&&(c.peekOffset.x+=2*(Math.random()-.5),c.peekOffset.y+=2*(Math.random()-.5));break;case"hiding":var p=(f-.6)/.4;v=(1-this.easeInCubic(p))*l.peekDistance}if("waiting"!==c.phase){var y=Math.cos(c.peekAngle)*v,m=Math.sin(c.peekAngle)*v;c.peekOffset.x+=(y-c.peekOffset.x)*l.peekSpeed,c.peekOffset.y+=(m-c.peekOffset.y)*l.peekSpeed,t.x=c.originalX+c.peekOffset.x,t.y=c.originalY+c.peekOffset.y}void 0!==t.alpha&&("peeking"===c.phase||"holding"===c.phase?t.alpha=.7+.3*Math.random():t.alpha=1)},easeOutCubic:function(t){return 1-Math.pow(1-t,3)},easeInCubic:function(t){return t*t*t},cleanup:function(t){var e;null!==(e=t.gestureData)&&void 0!==e&&e.peek&&(t.x=t.gestureData.peek.originalX,t.y=t.gestureData.peek.originalY,void 0!==t.alpha&&(t.alpha=1),delete t.gestureData.peek)}};var Ct=function(t){return{name:t,emoji:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"✨",type:"blending",description:"".concat(t," animation"),config:{duration:1e3,musicalDuration:{musical:!0,beats:2}},rhythm:{enabled:!0,syncMode:"beat",timingSync:"nextBeat",durationSync:{mode:"beats",beats:2},interruptible:!0,priority:3,blendable:!0,crossfadePoint:"anyBeat",maxQueue:3},apply:function(t,e,i){return!1},blend:function(t,e,i){return!1}}},Pt=[h,l,d,m,M,k,w,j,x,P,Ct("sparkle","✨"),{name:"shimmer",emoji:"🌟",type:"particle",description:"Shimmer effect with sparkling particles",config:{duration:2e3,musicalDuration:{musical:!0,bars:1},particleMotion:"radiant"},rhythm:{enabled:!0,syncType:"beat",durationSync:{mode:"bars",bars:1},intensity:.8},override:function(t,e,i){return t.shimmerEffect=!0,t.shimmerProgress=e,!0},blend:function(t,e,i){return!1}},Ct("wiggle","〰️"),Ct("groove","🎵"),Ct("point","👉"),Ct("lean","↗️"),Ct("reach","🤚"),Ct("headBob","🎧"),{name:"rain",emoji:"🌧️",type:"particle",description:"Rain effect with falling particles",config:{duration:3e3,musicalDuration:{musical:!0,bars:2},particleMotion:"falling"},rhythm:{enabled:!0,syncType:"off-beat",durationSync:{mode:"bars",bars:2},intensity:.8},apply:function(t,e,i){return t.rainEffect=!0,t.rainProgress=e,!0},blend:function(t,e,i){return!1}}],Et=[R,D,G,H,U,N,W,Q,$],Tt=[et,at,ot,ht,ut,ct,vt,{name:"hold",emoji:"⏸️",type:"override",description:"Hold particles in current position",config:{holdStrength:.95,allowDrift:!1},rhythm:{enabled:!0,syncMode:"rest",holdSync:{onRest:.98,onSound:.8,curve:"immediate"},durationSync:{mode:"rests",minBeats:.5,maxBeats:8,sustain:!0},pauseResponse:{enabled:!0,multiplier:1.5,type:"strength"},patternOverrides:{classical:{holdSync:{onRest:.99,onSound:.75,curve:"dramatic"},pauseResponse:{multiplier:2}},minimal:{holdSync:{onRest:.95,onSound:.85},durationSync:{minBeats:2,maxBeats:16}},jazz:{holdSync:{onRest:.9,onSound:.7},allowDrift:!0},electronic:{holdSync:{onRest:.99,onSound:.6,curve:"digital"},pauseResponse:{multiplier:1.2}}},dynamics:{forte:{holdSync:{onRest:{multiplier:1.02},onSound:{multiplier:.9}},pauseResponse:{multiplier:2.2}},piano:{holdSync:{onRest:{multiplier:.97},onSound:{multiplier:.85}},pauseResponse:{multiplier:1.3}}}},initialize:function(t){t.gestureData||(t.gestureData={}),t.gestureData.hold={holdX:t.x,holdY:t.y,originalVx:t.vx,originalVy:t.vy}},apply:function(t,e,i,n,a,r){var s;null!==(s=t.gestureData)&&void 0!==s&&s.hold||this.initialize(t);var o=t.gestureData.hold,h=i.holdStrength||this.config.holdStrength;if(i.allowDrift?(t.vx*=h,t.vy*=h):(t.x+=(o.holdX-t.x)*(1-h),t.y+=(o.holdY-t.y)*(1-h),t.vx=0,t.vy=0),e>.9){var u=10*(e-.9);t.vx=t.vx*(1-u)+o.originalVx*u,t.vy=t.vy*(1-u)+o.originalVy*u}},cleanup:function(t){var e;if(null!==(e=t.gestureData)&&void 0!==e&&e.hold){var i=t.gestureData.hold;t.vx=i.originalVx,t.vy=i.originalVy,delete t.gestureData.hold}}},yt,bt,wt,jt,xt,Bt,{name:"runningman",emoji:"🏃",type:"effect",description:"Hip-hop running man shuffle",config:{duration:2e3,slideDistance:30,stepHeight:15,speed:1.2,strength:.8,particleMotion:{type:"runningman",strength:.7}},rhythm:{enabled:!0,syncToBeat:!0,beatMultiplier:1,accentBeats:[1,3]},apply:function(t,e,i,n,a,r){return!1},blend:function(t,e,i){return!1}},{name:"charleston",emoji:"🕺",type:"effect",description:"Hip-hop Charleston shuffle with crisscross",config:{duration:2500,kickDistance:35,swivelRange:40,bounceHeight:12,strength:.9,particleMotion:{type:"charleston",strength:.8}},rhythm:{enabled:!0,syncToBeat:!0,beatMultiplier:2,accentBeats:[1,2.5,3,4.5]},apply:function(t,e,i,n,a,r){return!1},blend:function(t,e,i){return!1}}],Rt={};[].concat(Pt,Et,Tt).forEach(function(t){Rt[t.name]=t});var It={blending:Pt.map(function(t){return t.name}),override:Et.map(function(t){return t.name}),effect:Tt.map(function(t){return t.name})};function zt(t){if(Rt[t])return Rt[t];var e=a.getPluginGesture(t);return e||null}function Dt(t){var e=zt(t);return!!e&&"blending"===e.type}function qt(t){var e=zt(t);return!!e&&"override"===e.type}function _t(t,e,i,n,a,r,s){var o=zt(e);return!!o&&(o.apply&&o.apply(t,i,n,a,r,s),i>=1&&o.cleanup&&o.cleanup(t),!0)}function Gt(){var t=[];return Object.values(Rt).forEach(function(e){t.push({name:e.name,emoji:e.emoji||"🎭",type:e.type,description:e.description||"No description",source:"core"})}),a.getAllPluginGestures().forEach(function(e){var i=a.getPluginGesture(e);t.push({name:i.name,emoji:i.emoji||"🔌",type:i.type,description:i.description||"Plugin gesture",source:"plugin"})}),t}"undefined"!=typeof window&&window.DEBUG_GESTURES&&(window.Gestures={registry:Rt,types:It,list:Gt,get:zt,isBlending:Dt,isOverride:qt});const Lt={GESTURE_REGISTRY:Rt,GESTURE_TYPES:It,getGesture:zt,isBlendingGesture:Dt,isOverrideGesture:qt,applyGesture:_t,listGestures:Gt,pluginAdapter:a}},284:(t,e,i)=>{"use strict";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}i.d(e,{A:()=>n})},373:t=>{t.exports=function(t){var e=Object(t),i=[];for(var n in e)i.unshift(n);return function t(){for(;i.length;)if((n=i.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.t=!0,t.exports.default=t.exports},467:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var n=i(816);function a(t,e,i){return(e=(0,n.A)(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},546:t=>{function e(i,n,a,r){var s=Object.defineProperty;try{s({},"",{})}catch(i){s=0}t.exports=e=function(t,i,n,a){function r(i,n){e(t,i,function(t){return this.i(i,n,t)})}i?s?s(t,i,{value:n,enumerable:!a,configurable:!a,writable:!a}):t[i]=n:(r("next",0),r("throw",1),r("return",2))},t.exports.t=!0,t.exports.default=t.exports,e(i,n,a,r)}t.exports=e,t.exports.t=!0,t.exports.default=t.exports},579:(t,e,i)=>{var n=i(738).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],i=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.t=!0,t.exports.default=t.exports},633:(t,e,i)=>{var n=i(172),a=i(993),r=i(869),s=i(887),o=i(791),h=i(373),u=i(579);function c(){"use strict";var e=a(),i=e.m(c),l=(Object.getPrototypeOf?Object.getPrototypeOf(i):i.__proto__).constructor;function f(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))}var v={throw:1,return:2,break:3,continue:3};function d(t){var e,i;return function(n){e||(e={stop:function(){return i(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return i(n.a,v[t],e)},delegateYield:function(t,a,r){return e.resultName=a,i(n.d,u(t),r)},finish:function(t){return i(n.f,t)}},i=function(t,i,a){n.p=e.prev,n.n=e.next;try{return t(i,a)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=c=function(){return{wrap:function(t,i,n,a){return e.w(d(t),i,n,a&&a.reverse())},isGeneratorFunction:f,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:o,async:function(t,e,i,n,a){return(f(e)?s:r)(d(t),e,i,n,a)},keys:h,values:u}},t.exports.t=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.t=!0,t.exports.default=t.exports},738:t=>{function e(i){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.t=!0,t.exports.default=t.exports,e(i)}t.exports=e,t.exports.t=!0,t.exports.default=t.exports},756:(t,e,i)=>{var n=i(633)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},791:(t,e,i)=>{var n=i(172),a=i(546);t.exports=function t(e,i){function r(t,a,s,o){try{var h=e[t](a),u=h.value;return u instanceof n?i.resolve(u.v).then(function(t){r("next",t,s,o)},function(t){r("throw",t,s,o)}):i.resolve(u).then(function(t){h.value=t,s(h)},function(t){return r("throw",t,s,o)})}catch(t){o(t)}}var s;this.next||(a(t.prototype),a(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),a(this,"_invoke",function(t,e,n){function a(){return new i(function(e,i){r(t,n,e,i)})}return s=s?s.then(a,a):a()},!0)},t.exports.t=!0,t.exports.default=t.exports},816:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var n=i(284);function a(t){var e=function(t,e){if("object"!=(0,n.A)(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!=(0,n.A)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==(0,n.A)(e)?e:e+""}},869:(t,e,i)=>{var n=i(887);t.exports=function(t,e,i,a,r){var s=n(t,e,i,a,r);return s.next().then(function(t){return t.done?t.value:s.next()})},t.exports.t=!0,t.exports.default=t.exports},887:(t,e,i)=>{var n=i(993),a=i(791);t.exports=function(t,e,i,r,s){return new a(n().w(t,e,i,r),s||Promise)},t.exports.t=!0,t.exports.default=t.exports},993:(t,e,i)=>{var n=i(546);function a(){var e,i,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function h(t,a,r,s){var o=a&&a.prototype instanceof c?a:c,h=Object.create(o.prototype);return n(h,"_invoke",function(t,n,a){var r,s,o,h=0,c=a||[],l=!1,f={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,i){return r=t,s=0,o=e,f.n=i,u}};function v(t,n){for(s=t,o=n,i=0;!l&&h&&!a&&i<c.length;i++){var a,r=c[i],v=f.p,d=r[2];t>3?(a=d===n)&&(o=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=v&&((a=t<2&&v<r[1])?(s=0,f.v=n,f.n=r[1]):v<d&&(a=t<3||r[0]>n||n>d)&&(r[4]=t,r[5]=n,f.n=d,s=0))}if(a||t>1)return u;throw l=!0,n}return function(a,c,d){if(h>1)throw TypeError("Generator is already running");for(l&&1===c&&v(c,d),s=c,o=d;(i=s<2?e:o)||!l;){r||(s?s<3?(s>1&&(f.n=-1),v(s,o)):f.n=o:f.v=o);try{if(h=2,r){if(s||(a="next"),i=r[a]){if(!(i=i.call(r,o)))throw TypeError("iterator result is not an object");if(!i.done)return i;o=i.value,s<2&&(s=0)}else 1===s&&(i=r.return)&&i.call(r),s<2&&(o=TypeError("The iterator does not provide a '"+a+"' method"),s=1);r=e}else if((i=(l=f.n<0)?o:t.call(n,f))!==u)break}catch(t){r=e,s=1,o=t}finally{h=1}}return{value:i,done:l}}}(t,r,s),!0),h}var u={};function c(){}function l(){}function f(){}i=Object.getPrototypeOf;var v=[][s]?i(i([][s]())):(n(i={},s,function(){return this}),i),d=f.prototype=c.prototype=Object.create(v);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,n(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=f,n(d,"constructor",f),n(f,"constructor",l),l.displayName="GeneratorFunction",n(f,o,"GeneratorFunction"),n(d),n(d,o,"Generator"),n(d,s,function(){return this}),n(d,"toString",function(){return"[object Generator]"}),(t.exports=a=function(){return{w:h,m:p}},t.exports.t=!0,t.exports.default=t.exports)()}t.exports=a,t.exports.t=!0,t.exports.default=t.exports}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"t",{value:!0})};var n={};return(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function e(e,i){if(e){if("string"==typeof e)return t(e,i);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,i):void 0}}function a(i){return function(e){if(Array.isArray(e))return t(e)}(i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||e(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}i.d(n,{default:()=>Ki});var r=i(284);function s(t,e,i,n,a,r,s){try{var o=t[r](s),h=o.value}catch(t){return void i(t)}o.done?e(h):Promise.resolve(h).then(n,a)}function o(t){return function(){var e=this,i=arguments;return new Promise(function(n,a){var r=t.apply(e,i);function o(t){s(r,n,a,o,h,"next",t)}function h(t){s(r,n,a,o,h,"throw",t)}o(void 0)})}}var h=i(467);function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var c=i(816);function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(0,c.A)(n.key),n)}}function f(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var v=i(756);const d=function(){return f(function t(e){u(this,t),this.canvas=e,this.ctx=e.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),this.dpr=window.devicePixelRatio||1,this.width=0,this.height=0,this.centerX=0,this.centerY=0,this.resizeCallbacks=[],this.handleResize=this.handleResize.bind(this),window.addEventListener("resize",this.handleResize),this.resize()},[{key:"resize",value:function(){var t=this;if(this.canvas.hasAttribute("width")&&this.canvas.hasAttribute("height")){var e=parseInt(this.canvas.getAttribute("width"),10),i=parseInt(this.canvas.getAttribute("height"),10);this.width=e,this.height=i,this.canvas.width=e,this.canvas.height=i}else{var n=this.canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.canvas.width=this.width*this.dpr,this.canvas.height=this.height*this.dpr,this.ctx.scale(this.dpr,this.dpr)}this.centerX=this.width/2,this.centerY=this.height/2,this.resizeCallbacks.forEach(function(e){try{e(t.width,t.height,t.dpr)}catch(t){}})}},{key:"onResize",value:function(t){"function"==typeof t&&this.resizeCallbacks.push(t)}},{key:"handleResize",value:function(){var t=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){t.resize()},100)}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"getCenter",value:function(){return{x:this.centerX,y:this.centerY}}},{key:"setTransform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.ctx.save(),this.ctx.translate(t,e),this.ctx.rotate(n),this.ctx.scale(i,i)}},{key:"restoreTransform",value:function(){this.ctx.restore()}},{key:"getContext",value:function(){return this.ctx}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"destroy",value:function(){window.removeEventListener("resize",this.handleResize),clearTimeout(this.resizeTimeout)}}])}();const p=function(){return f(function t(){u(this,t),this.errors=[],this.maxErrors=10,this.errorCounts=new Map,this.defaults={emotion:"neutral",gesture:null,audioLevel:0,particleCount:0,glowIntensity:.7,coreSize:1,breathRate:1,color:"#B0B0B0"}},[{key:"wrap",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(){try{return t.apply(void 0,arguments)}catch(t){return i.logError(t,e),null!==n?n:i.getDefault(e)}}}},{key:"logError",value:function(t,e){var i={timestamp:(new Date).toISOString(),context:e,message:t.message,stack:t.stack};this.errors.push(i);var n=this.errorCounts.get(e)||0;this.errorCounts.set(e,n+1),this.errors.length>this.maxErrors&&this.errors.shift()}},{key:"getDefault",value:function(t){var e={"emotion-transition":this.defaults.emotion,"gesture-execution":this.defaults.gesture,"audio-processing":this.defaults.audioLevel,"particle-system":this.defaults.particleCount,rendering:{glowIntensity:this.defaults.glowIntensity,coreSize:this.defaults.coreSize,color:this.defaults.color},"canvas-operations":null,"state-management":this.defaults.emotion};return e.hasOwnProperty(t)?e[t]:null}},{key:"validateInput",value:function(t,e,i){try{switch(e){case"emotion":return["neutral","joy","sadness","anger","fear","surprise","disgust","love","euphoria"].includes(t)?t:i;case"undertone":return null===t||["nervous","confident","tired","intense","subdued"].includes(t)?t:null;case"gesture":return["bounce","pulse","shake","spin","nod","tilt","expand","contract","flash","drift"].includes(t)?t:i;case"number":return"number"!=typeof t||isNaN(t)?i:t;case"string":return"string"==typeof t?t:i;case"boolean":return"boolean"==typeof t?t:i;default:return null!=t?t:i}}catch(t){return this.logError(t,"input-validation"),i}}},{key:"hasExceededThreshold",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return(this.errorCounts.get(t)||0)>=e}},{key:"getErrorStats",value:function(){return{totalErrors:this.errors.length,errorsByContext:Object.fromEntries(this.errorCounts),recentErrors:this.errors.slice(-5)}}},{key:"clearErrors",value:function(){this.errors=[],this.errorCounts.clear()}},{key:"attemptRecovery",value:(t=o(v.mark(function t(e,i){var n,a,r,s=arguments;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=s.length>2&&void 0!==s[2]?s[2]:3,a=0;case 1:if(!(a<n)){t.next=7;break}return t.prev=2,t.next=3,i();case 3:return t.abrupt("return",t.sent);case 4:if(t.prev=4,r=t.catch(2),a++,this.logError(r,"recovery-".concat(e,"-attempt-").concat(a)),!(a>=n)){t.next=5;break}throw new Error("Recovery failed for ".concat(e," after ").concat(n," attempts"));case 5:return t.next=6,new Promise(function(t){return setTimeout(t,100*Math.pow(2,a))});case 6:t.next=1;break;case 7:case"end":return t.stop()}},t,this,[[2,4]])})),function(e,i){return t.apply(this,arguments)})}]);var t}();function y(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,a,r,s,o=[],h=!0,u=!1;try{if(r=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;h=!1}else for(;!(h=(n=r.call(i)).done)&&(o.push(n.value),o.length!==e);h=!0);}catch(t){u=!0,a=t}finally{try{if(!h&&null!=i.return&&(s=i.return(),Object(s)!==s))return}finally{if(u)throw a}}return o}}(t,i)||e(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function b(t){return 3===(t=t.replace("#","")).length&&(t=t.split("").map(function(t){return t+t}).join("")),{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16)}}function M(t,e,i){var n=function(t){var e=Math.round(Math.max(0,Math.min(255,t))).toString(16);return 1===e.length?"0"+e:e};return"#".concat(n(t)).concat(n(e)).concat(n(i))}function k(t,e,i){t/=255,e/=255,i/=255;var n,a,r=Math.max(t,e,i),s=Math.min(t,e,i),o=(r+s)/2;if(r===s)n=a=0;else{var h=r-s;switch(a=o>.5?h/(2-r-s):h/(r+s),r){case t:n=(e-i)/h+(e<i?6:0);break;case e:n=(i-t)/h+2;break;case i:n=(t-e)/h+4}n/=6}return{h:360*n,s:100*a,l:100*o}}function w(t,e,i){t/=360,i/=100;var n,a,r,s=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t};if(0===(e/=100))n=a=r=i;else{var o=i<.5?i*(1+e):i+e-i*e,h=2*i-o;n=s(h,o,t+1/3),a=s(h,o,t),r=s(h,o,t-1/3)}return{r:Math.round(255*n),g:Math.round(255*a),b:Math.round(255*r)}}function S(t,e,i){var n=b(t),a=b(e),r=k(n.r,n.g,n.b),s=k(a.r,a.g,a.b),o=r.h,h=s.h,u=h-o;u>180?h-=360:u<-180&&(h+=360);var c=w(((o+(h-o)*i)%360+360)%360,r.s+(s.s-r.s)*i,r.l+(s.l-r.l)*i);return M(c.r,c.g,c.b)}var O={intense:1.6,confident:1.3,nervous:1.15,clear:1,tired:.8,subdued:.5};function j(t,e){if(!e||"clear"===e)return t;var i=O[e.toLowerCase()];return i&&1!==i?function(t,e){var i=b(t),n=k(i.r,i.g,i.b);n.s=Math.max(0,Math.min(100,n.s*e));var a=w(n.h,n.s,n.l);return M(a.r,a.g,a.b)}(t,i):t}Object.fromEntries(Object.entries({neutral:"#B0B0B0",joy:"#FFD700",sadness:"#4169E1",anger:"#DC143C",fear:"#8B008B",surprise:"#FF8C00",disgust:"#9ACD32",love:"#FF69B4"}).map(function(t){var e=y(t,2),i=e[0],n=b(e[1]);return[i,"".concat(n.r,", ").concat(n.g,", ").concat(n.b)]}));function F(t){return t}function A(t){return t*(2-t)}function x(t){return t*t}function B(t){return t<.5?2*t*t:(4-2*t)*t-1}function C(t){return 1-Math.pow(1-t,3)}function P(t){return t*t*t}function E(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}function T(t){var e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}function R(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}function I(t){var e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2}function z(t){return Math.sin(t*Math.PI/2)}function D(t){return-(Math.cos(Math.PI*t)-1)/2}function q(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"linear";return e+(i-e)*("string"==typeof n?{linear:F,easeOutQuad:A,easeInQuad:x,easeInOutQuad:B,easeOutCubic:C,easeInCubic:P,easeInOutCubic:E,easeOutElastic:T,easeOutBounce:R,easeInOutBack:I,easeOutSine:z,easeInOutSine:D}[n]||F:n)(Math.max(0,Math.min(1,t)))}var _=new Map;const G={registerPluginEmotion:function(t,e){return!!e.color&&(e.name||(e.name=t),e.visual||(e.visual={primaryColor:e.color,particleCount:e.particleCount||15,particleSize:e.particleSize||{min:2,max:6}}),e.modifiers||(e.modifiers={speed:1,amplitude:1,intensity:1}),_.set(t,e),"undefined"!=typeof window&&window.DEBUG_EMOTIONS,!0)},unregisterPluginEmotion:function(t){return!!_.has(t)&&(_.delete(t),"undefined"!=typeof window&&window.DEBUG_EMOTIONS,!0)},getPluginEmotion:function(t){return _.get(t)||null},getAllPluginEmotions:function(){return Array.from(_.keys())},clearPluginEmotions:function(){_.clear()},createLegacyAdapter:function(t){return{name:t.name||"unknown",emoji:t.emoji||"🔌",color:t.primaryColor||t.color||"#7B68EE",energy:t.energy||"medium",visual:{primaryColor:t.primaryColor||t.color||"#7B68EE",secondaryColor:t.secondaryColor,particleCount:t.particleCount||t.particleRate||15,particleSize:t.particleSize||{min:2,max:6},glowIntensity:t.glowIntensity||.5,trailLength:t.trailLength||5,pulseRate:t.pulseRate||t.breathRate||1},particles:{behavior:t.particleBehavior||"ambient",density:t.particleDensity||"medium",speed:t.particleSpeed||"normal"},modifiers:{speed:t.speedMultiplier||1,amplitude:t.amplitudeMultiplier||1,intensity:t.intensityMultiplier||1,smoothness:t.smoothnessMultiplier||1},gestures:t.gestures||[],transitions:t.transitions||{}}}},L={name:"suspicion",emoji:"🤨",description:"Paranoid watchfulness with surveillance scanning",visual:{glowColor:"#6B46C1",glowIntensity:.85,particleRate:18,minParticles:6,maxParticles:12,particleBehavior:"surveillance",particleSpeed:.2,breathRate:.6,breathDepth:.04,coreJitter:.02,particleColors:[{color:"#6B46C1",weight:30},{color:"#4A5568",weight:25},{color:"#8B4789",weight:20},{color:"#9F7AEA",weight:15},{color:"#2D3748",weight:10}],threatLevel:0,getGlowIntensity:function(){return.3+.7*this.threatLevel},getParticleSpeed:function(){return.2+.8*this.threatLevel},getGlowColor:function(){var t=107,e=70,i=193,n=220,a=38,r=127,s=this.threatLevel||0,o=Math.round(t+(n-t)*s),h=Math.round(e+(a-e)*s),u=Math.round(i+(r-i)*s),c=function(t){return t.toString(16).padStart(2,"0")};return"#".concat(c(o)).concat(c(h)).concat(c(u))}},modifiers:{speed:.4,amplitude:.6,intensity:1.2,smoothness:.3,regularity:.2,focus:1.5,addWobble:!0},typicalGestures:["scan","twitch","peek","tilt","hold"],transitions:{duration:500,easing:"linear",priority:4},special:{coreSquint:.6,scanInterval:2e3,scanDuration:1200,scanAngle:60,twitchChance:.02,peekInterval:4e3,maxThreatDistance:300,alertThreshold:.7}},V={name:"glitch",emoji:"⚡",description:"Digital distortion with erratic particle stutters",visual:{primaryColor:"#00FF41",glowColor:"#00FF41",glowIntensity:2,particleRate:30,minParticles:12,maxParticles:20,particleBehavior:"glitchy",particleSpeed:1.5,breathRate:.3,breathDepth:.08,coreJitter:.04,coreSize:1.1,eyeOpenness:1,particleColors:[{color:"#00FF41",weight:30},{color:"#FF00FF",weight:25},{color:"#00FFFF",weight:20},{color:"#FFFF00",weight:10},{color:"#FF0080",weight:10},{color:"#FFFFFF",weight:5}],glitchIntensity:.8,flickerChance:.05,rgbShift:!0,digitalNoise:!0,getGlowIntensity:function(){return Math.random()<this.flickerChance?.2+2.5*Math.random():this.glowIntensity},getGlowColor:function(){if(Math.random()<.02){var t=["#FF00FF","#00FFFF","#FFFF00","#00FF41"];return t[Math.floor(Math.random()*t.length)]}return this.glowColor}},modifiers:{speed:2,amplitude:.8,intensity:1.8,smoothness:.1,regularity:.1,focus:.5,addGlitch:!0,addStutter:!0},typicalGestures:["twitch","jitter","breathe","pulse","shake","flicker"],transitions:{duration:100,easing:"linear",priority:7,glitchIn:!0},special:{stutterInterval:50,stutterDuration:20,rgbOffset:3,scanlineEffect:!0,datamoshChance:.01,corruptionZones:3,digitalTearHeight:10}},H={name:"calm",emoji:"😌",description:"Serene, peaceful state with gentle movements",visual:{glowColor:"#66D9CC",glowIntensity:.6,particleRate:.5,minParticles:2,maxParticles:4,particleBehavior:"calm",breathRate:.4,breathDepth:.12,coreJitter:!1,particleColors:[{color:"#66D9CC",weight:35},{color:"#99E6D9",weight:25},{color:"#40BFB3",weight:20},{color:"#B3F2E6",weight:15},{color:"#339980",weight:5}]},modifiers:{speed:.5,amplitude:.3,intensity:.4,smoothness:2,regularity:1.5,addWeight:!1,floatHeight:.2,swayAmount:.15,duration:1.5},typicalGestures:["breathe","float","drift","idle"],transitions:{duration:800,easing:"easeInOutSine",priority:1},audio:{ambientSound:"soft_waves",transitionSound:null,gestureSound:null,volumeModifier:.5},particleSpawn:{pattern:"center_drift",frequency:"slow",burstOnEntry:!1,fadeOnExit:!0,spawnRadius:.3,driftSpeed:.2},coreAppearance:{pupilSize:.9,irisPattern:"soft",blinkRate:"slow",lookDirection:"soft_center",eyeOpenness:.85},movement:{floatPattern:"sine_slow",floatPeriod:6e3,floatAmplitude:8,swayPattern:"gentle",swayPeriod:8e3,swayAmplitude:5,microMovements:!1},getCoreParams:function(t){var e=t.time||Date.now(),i=.5*Math.sin(6e-4*e)+.5;return{scaleX:1-.02*i,scaleY:1-.02*i,eyeOpenness:.85,eyeExpression:"serene",pupilOffset:{x:2*Math.sin(3e-4*e),y:1*Math.cos(4e-4*e)},glowPulse:.95+.05*i}},updateParticle:function(t,e){t.x+=.1*Math.sin(.001*t.life),t.y-=.02*e,t.opacity=.3*Math.sin(.002*t.life)+.2,t.size=t.baseSize*(1+.2*Math.sin(.001*t.life))},renderCore:function(t,e,i,n){return!1}};var X=new Map,Y={happy:"joy",peaceful:"calm",curious:"surprise",frustrated:"anger",sad:"sadness"};function U(t){var e=Y[t]||t,i=X.get(e);if(i)return i;var n=G.getPluginEmotion(e);return n||null}function N(t){var e=U(t);if(!e)return U("neutral").visual;if(!e.visual)return{};var i=e.visual,n={};for(var a in i)"function"!=typeof i[a]&&(n[a]=i[a]);return"function"==typeof i.getGlowIntensity&&(n.glowIntensity=i.getGlowIntensity.call(i)),"function"==typeof i.getParticleSpeed&&(n.particleSpeed=i.getParticleSpeed.call(i)),"function"==typeof i.getParticleRate&&(n.particleRate=i.getParticleRate.call(i)),"function"==typeof i.getGlowColor&&(n.glowColor=i.getGlowColor.call(i)),n}function W(t){var e=U(t);return e?e.modifiers:U("neutral").modifiers}function Q(){var t=Array.from(X.keys()),e=G.getAllPluginEmotions();return[].concat(t,a(e))}function J(t){var e=Y[t]||t;return X.has(e)||null!==G.getPluginEmotion(e)}[{name:"neutral",emoji:"😐",description:"Calm, balanced emotional state",visual:{glowColor:"#32ACE2",glowIntensity:1,particleRate:2,minParticles:8,maxParticles:10,particleBehavior:"ambient",breathRate:1,breathDepth:.08,coreJitter:!1,particleColors:[{color:"#32ACE2",weight:30},{color:"#5A92A8",weight:20},{color:"#00B4FF",weight:20},{color:"#7CC8F2",weight:15},{color:"#1A5A74",weight:15}]},modifiers:{speed:1,amplitude:1,intensity:1,smoothness:1,regularity:1},typicalGestures:["breathe","float","idle","blink"],transitions:{duration:500,easing:"easeInOut",priority:0},audio:{ambientSound:null,transitionSound:null,gestureSound:null},particleSpawn:{pattern:"random",frequency:"steady",burstOnEntry:!1,fadeOnExit:!0},coreAppearance:{pupilSize:1,irisPattern:"default",blinkRate:"normal",lookDirection:"center"},getCoreParams:function(t){return{scaleX:1,scaleY:1,eyeOpenness:1,eyeExpression:"neutral",pupilOffset:{x:0,y:0}}},renderCore:function(t,e,i,n){return!1}},{name:"joy",emoji:"😊",description:"Playful happiness and celebration",visual:{glowColor:"#FFD54F",glowIntensity:1.4,particleRate:40,minParticles:0,maxParticles:40,particleBehavior:"popcorn",breathRate:1.5,breathDepth:.1,coreJitter:!1,particleColors:[{color:"#FFD54F",weight:30},{color:"#C4B888",weight:20},{color:"#FFFF00",weight:20},{color:"#FFE082",weight:15},{color:"#B39C2F",weight:15}]},modifiers:{speed:1.8,amplitude:1.9,intensity:1.1,smoothness:1,regularity:.9,addBounce:!0},typicalGestures:["bounce","spin","wave","expand","shake","float"],transitions:{duration:400,easing:"easeOutBack",priority:5,burstOnEntry:!0},audio:{ambientSound:"cheerful_hum",transitionSound:"pop",gestureSound:"giggle"},particleSpawn:{pattern:"fountain",frequency:"burst",burstOnEntry:!0,fadeOnExit:!1,specialEffect:"sparkle"},coreAppearance:{pupilSize:1.2,irisPattern:"radiant",blinkRate:"frequent",lookDirection:"up",specialEffect:"twinkle"},rhythm:{enabled:!0,particleEmission:{syncMode:"beat",burstSize:8,offBeatRate:.6,popcornSync:!0},breathSync:{mode:"beats",beatsPerBreath:4,intensity:1.2},glowSync:{intensityRange:[1.2,1.8],syncTo:"beat",attack:.05,decay:.4},patternBehaviors:{waltz:{particleEmission:{burstSize:5},breathSync:{beatsPerBreath:3}},swing:{particleEmission:{syncMode:"swing",burstSize:6},glowSync:{curve:"bounce"}},dubstep:{particleEmission:{burstSize:15,dropMultiplier:3}},breakbeat:{particleEmission:{syncMode:"random",burstRange:[3,12]}}}},getCoreParams:function(t){return{scaleX:1,scaleY:1,eyeOpenness:1,eyeExpression:"happy",pupilOffset:{x:0,y:-.1},sparkle:!0}}},{name:"sadness",emoji:"😢",description:"Deep melancholic sorrow",visual:{glowColor:"#4090CE",glowIntensity:.7,particleRate:25,minParticles:0,maxParticles:25,particleBehavior:"falling",breathRate:.6,breathDepth:.12,coreJitter:!1,particleColors:[{color:"#4090CE",weight:30},{color:"#6B97B8",weight:20},{color:"#00A0FF",weight:20},{color:"#70B8E8",weight:15},{color:"#2A5A86",weight:15}]},modifiers:{speed:.7,amplitude:.6,intensity:.8,smoothness:1.3,regularity:1.1,addGravity:!0},typicalGestures:["droop","sway","contract","drift","sink"],transitions:{duration:800,easing:"easeInOut",priority:3}},{name:"anger",emoji:"😠",description:"Intense rage and aggression",visual:{glowColor:"#FF5252",glowIntensity:1.4,particleRate:15,minParticles:3,maxParticles:8,particleBehavior:"aggressive",breathRate:2.2,breathDepth:.15,coreJitter:!0,particleColors:[{color:"#FF5252",weight:30},{color:"#C47777",weight:20},{color:"#FF0000",weight:20},{color:"#FF7B7B",weight:15},{color:"#B73636",weight:15}]},modifiers:{speed:1.5,amplitude:1.4,intensity:1.3,smoothness:.3,regularity:.7,addShake:!0},typicalGestures:["shake","vibrate","expand","pulse","flicker","strike"],transitions:{duration:300,easing:"easeOutExpo",priority:8,shakeOnEntry:!0},audio:{ambientSound:"rumble",transitionSound:"explosion",gestureSound:"growl"},particleSpawn:{pattern:"explosive",frequency:"chaotic",burstOnEntry:!0,fadeOnExit:!1,specialEffect:"flames"},coreAppearance:{pupilSize:.7,irisPattern:"sharp",blinkRate:"rare",lookDirection:"forward",specialEffect:"flames",pulseRate:"rapid"},special:{screenShake:!0,particleTrails:"fire",glowPulse:!0,temperatureEffect:"hot"}},{name:"fear",emoji:"😨",description:"Anxious state with fleeing particles",visual:{glowColor:"#7B68EE",glowIntensity:.8,particleRate:12,minParticles:4,maxParticles:16,particleBehavior:"scattering",breathRate:2.5,breathDepth:.06,coreJitter:!0,particleColors:[{color:"#7B68EE",weight:30},{color:"#9A91C4",weight:20},{color:"#6A4FFF",weight:20},{color:"#A296F3",weight:15},{color:"#5445A0",weight:15}]},modifiers:{speed:1.4,amplitude:.8,intensity:1.2,smoothness:.5,regularity:.5,addJitter:!0},typicalGestures:["shake","vibrate","contract","flicker","retreat"],transitions:{duration:400,easing:"easeOut",priority:7}},{name:"surprise",emoji:"😲",description:"Sudden shock with explosive particles",visual:{glowColor:"#FFAB40",glowIntensity:1.5,particleRate:30,minParticles:0,maxParticles:15,particleBehavior:"burst",breathRate:.3,breathDepth:.18,coreJitter:!1,particleColors:[{color:"#FFAB40",weight:30},{color:"#C4A373",weight:20},{color:"#FF9800",weight:20},{color:"#FFC773",weight:15},{color:"#B3772D",weight:15}]},modifiers:{speed:1.6,amplitude:1.5,intensity:1.4,smoothness:.7,regularity:.8,addPop:!0},typicalGestures:["expand","bounce","flash","pulse","pop"],transitions:{duration:200,easing:"easeOutBack",priority:6}},{name:"disgust",emoji:"🤢",description:"Revulsion with repelling particles",visual:{glowColor:"#84CFC5",glowIntensity:.9,particleRate:12,minParticles:5,maxParticles:12,particleBehavior:"repelling",breathRate:.7,breathDepth:.04,coreJitter:!1,particleColors:[{color:"#84CFC5",weight:30},{color:"#9BB8B3",weight:20},{color:"#00FFD9",weight:20},{color:"#A8E6DD",weight:15},{color:"#4A8A80",weight:15}]},modifiers:{speed:.9,amplitude:.7,intensity:.9,smoothness:.8,regularity:1,addRecoil:!0},typicalGestures:["contract","shake","recoil","wobble"],transitions:{duration:600,easing:"easeIn",priority:4}},{name:"love",emoji:"💕",description:"Warm affection with orbiting particles",visual:{glowColor:"#FF69B4",glowIntensity:1.6,particleRate:25,minParticles:10,maxParticles:18,particleBehavior:"orbiting",breathRate:.75,breathDepth:.15,coreJitter:!1,particleColors:[{color:"#FF69B4",weight:25},{color:"#FFB6C1",weight:20},{color:"#FF1493",weight:15},{color:"#FFC0CB",weight:15},{color:"#FFE4E1",weight:10},{color:"#FFCCCB",weight:10},{color:"#C71585",weight:5}]},modifiers:{speed:.9,amplitude:1.1,intensity:1.2,smoothness:1.4,regularity:1.2,addWarmth:!0},typicalGestures:["pulse","sway","orbit","glow","breathe","float"],transitions:{duration:700,easing:"easeInOut",priority:5},rhythm:{enabled:!0,particleEmission:{syncMode:"beat",burstSize:3,offBeatRate:.7},orbitalSync:{speedMultiplier:{onBeat:1.2,offBeat:.9,curve:"ease"},radiusSync:{enabled:!0,subdivision:"quarter",amount:.15}},glowSync:{intensityRange:[1.4,2],syncTo:"beat",attack:.1,decay:.6},breathSync:{mode:"bars",barsPerBreath:2,intensity:1},patternBehaviors:{waltz:{orbitalSync:{radiusSync:{subdivision:"bar",amount:.25}},particleEmission:{syncMode:"bar",burstSize:5}},swing:{orbitalSync:{speedMultiplier:{onBeat:1.5,curve:"bounce"}}}},intensityMapping:{low:{particleRate:.6,glowIntensity:.8},medium:{particleRate:1,glowIntensity:1},high:{particleRate:1.4,glowIntensity:1.3}}}},L,{name:"excited",emoji:"🤩",description:"High energy with rapid particles",visual:{glowColor:"#FF1493",glowIntensity:1.3,particleRate:25,minParticles:8,maxParticles:30,particleBehavior:"burst",breathRate:2,breathDepth:.14,coreJitter:!0,particleColors:[{color:"#FF1493",weight:30},{color:"#C47FA8",weight:20},{color:"#FF00FF",weight:20},{color:"#FF69B4",weight:15},{color:"#B3006B",weight:15}]},modifiers:{speed:1.4,amplitude:1.3,intensity:1.3,smoothness:.8,regularity:.7,addVibration:!0},typicalGestures:["bounce","spin","vibrate","expand","shake","pulse"],transitions:{duration:300,easing:"easeOutElastic",priority:6},rhythm:{enabled:!0,particleEmission:{syncMode:"beat",burstSize:5,offBeatRate:.5},jitterSync:{subdivision:"sixteenth",intensity:.8,onBeat:1.5},glowSync:{intensityRange:[1,1.8],syncTo:"eighth",attack:.05,decay:.2},patternBehaviors:{dubstep:{particleEmission:{syncMode:"beat",burstSize:10,dropMultiplier:2}},breakbeat:{jitterSync:{subdivision:"random",intensity:1}}}}},{name:"resting",emoji:"😴",description:"Deep relaxation with slow drift",visual:{glowColor:"#9370DB",glowIntensity:.8,particleRate:10,minParticles:3,maxParticles:5,particleBehavior:"resting",breathRate:.8,breathDepth:.12,coreJitter:!1,particleColors:[{color:"#9370DB",weight:30},{color:"#A591C4",weight:20},{color:"#B366FF",weight:20},{color:"#B8A1E6",weight:15},{color:"#674D9B",weight:15}]},modifiers:{speed:.5,amplitude:.4,intensity:.5,smoothness:1.4,regularity:.9,addWeight:!0},typicalGestures:["breathe","drift","sway","float"],transitions:{duration:1e3,easing:"easeInOut",priority:2}},{name:"euphoria",emoji:"🌟",description:"Radiant hope and new beginnings",visual:{glowColor:"#FFD700",glowIntensity:1.8,particleRate:3,minParticles:15,maxParticles:30,particleBehavior:"radiant",breathRate:1.3,breathDepth:.25,coreJitter:!1,particleColors:[{color:"#FFD700",weight:30},{color:"#C4B888",weight:20},{color:"#FFFF00",weight:20},{color:"#FFE57F",weight:15},{color:"#B39A00",weight:15}]},modifiers:{speed:1.4,amplitude:1.5,intensity:1.6,smoothness:1.3,regularity:.8,addWarmth:!0,addLift:!0},typicalGestures:["expand","radiate","pulse","glow","float","bloom"],transitions:{duration:600,easing:"easeOutExpo",priority:8}},{name:"focused",emoji:"🎯",description:"Intense concentration with directed flow",visual:{glowColor:"#00CED1",glowIntensity:1.2,particleRate:10,minParticles:5,maxParticles:12,particleBehavior:"directed",breathRate:1.2,breathDepth:.08,coreJitter:!0,particleColors:[{color:"#00CED1",weight:30},{color:"#4A9FA0",weight:20},{color:"#00FFFF",weight:20},{color:"#5FE5E7",weight:15},{color:"#006B6D",weight:15}],eyeOpenness:.7,microAdjustments:!0},modifiers:{speed:1,amplitude:.9,intensity:1.1,smoothness:1.1,regularity:1.2,addPrecision:!0},typicalGestures:["track","lock","scan","pulse","vibrate"],transitions:{duration:400,easing:"easeIn",priority:5},getCoreParams:function(t){return{scaleX:1.1,scaleY:.7,eyeOpenness:.7,eyeExpression:"focused",pupilOffset:{x:0,y:0},microAdjustments:!0}}},V,H].forEach(function(t){t&&t.name&&X.set(t.name,t)}),"undefined"!=typeof window&&window.DEBUG_EMOTIONS&&(window.Emotions={registry:X,aliases:Y,list:Q,get:U,has:J});function Z(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function $(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Z(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const K=function(){return f(function t(e){u(this,t),this.errorBoundary=e,this.state={emotion:"neutral",undertone:null,gesture:null,gestureQueue:[],speaking:!1,audioLevel:0},this.transitions={emotional:{current:"neutral",target:null,progress:0,duration:500,startTime:0,isActive:!1},undertone:{current:null,target:null,progress:0,duration:300,startTime:0,isActive:!1,currentWeight:0,targetWeight:0}},this.interpolationCache={lastUpdate:0,cacheInterval:100,cachedProperties:null,cachedRenderState:null},this.initializeEmotionalStates(),this.initializeUndertoneModifiers()},[{key:"initializeEmotionalStates",value:function(){this.emotionalStates={neutral:{primaryColor:"#B0B0B0",glowIntensity:.7,particleRate:1,minParticles:3,maxParticles:4,particleBehavior:"ambient",coreSize:1,breathRate:1,breathDepth:.1},joy:{primaryColor:"#FFD700",glowIntensity:1.2,particleRate:2,minParticles:3,maxParticles:8,particleBehavior:"popcorn",coreSize:1.1,breathRate:1.3,breathDepth:.15},sadness:{primaryColor:"#4169E1",glowIntensity:.6,particleRate:2,minParticles:1,maxParticles:3,particleBehavior:"falling",coreSize:.9,breathRate:.7,breathDepth:.08},anger:{primaryColor:"#DC143C",glowIntensity:1.3,particleRate:1,minParticles:3,maxParticles:8,particleBehavior:"aggressive",coreSize:1.2,breathRate:1.5,breathDepth:.2},fear:{primaryColor:"#8B008B",glowIntensity:.8,particleRate:1,minParticles:2,maxParticles:6,particleBehavior:"scattering",coreSize:.8,breathRate:1.8,breathDepth:.12},surprise:{primaryColor:"#FF8C00",glowIntensity:1.4,particleRate:1,minParticles:3,maxParticles:10,particleBehavior:"burst",coreSize:1.3,breathRate:2,breathDepth:.25},disgust:{primaryColor:"#9ACD32",glowIntensity:.9,particleRate:2,minParticles:2,maxParticles:4,particleBehavior:"repelling",coreSize:.95,breathRate:.8,breathDepth:.06},love:{primaryColor:"#FF69B4",glowIntensity:1.1,particleRate:1,minParticles:2,maxParticles:5,particleBehavior:"orbiting",coreSize:1.05,breathRate:.9,breathDepth:.18},excited:{primaryColor:"#FF00FF",glowIntensity:1.2,particleRate:360,minParticles:480,maxParticles:900,particleBehavior:"fizzy",coreSize:.85,breathRate:1.5,breathDepth:.08,eyeOpenness:1},resting:{primaryColor:"#7C3AED",glowIntensity:.8,particleRate:2,minParticles:3,maxParticles:5,particleBehavior:"resting",coreSize:1,breathRate:.8,breathDepth:.12},euphoria:{primaryColor:"#FFD700",glowIntensity:1.8,particleRate:3,minParticles:15,maxParticles:30,particleBehavior:"radiant",coreSize:1.15,breathRate:1.3,breathDepth:.25},focused:{primaryColor:"#00CED1",glowIntensity:1.2,particleRate:.5,minParticles:2,maxParticles:5,particleBehavior:"directed",coreSize:1.05,breathRate:1.2,breathDepth:.08,eyeOpenness:.7,microAdjustments:!0},suspicion:{primaryColor:"#708090",glowIntensity:.9,particleRate:20,minParticles:8,maxParticles:15,particleBehavior:"burst",coreSize:1,breathRate:.8,breathDepth:.05,eyeOpenness:.5,eyeArc:-.2}}}},{key:"initializeUndertoneModifiers",value:function(){this.undertoneModifiers={nervous:{jitterAmount:.3,breathRateMultiplier:1.2,glowIntensityMultiplier:.9,particleRateMultiplier:1.1},confident:{coreSizeMultiplier:1.1,glowIntensityMultiplier:1.2,breathRateMultiplier:.9,particleRateMultiplier:1},tired:{breathRateMultiplier:.7,particleRateMultiplier:.5,glowIntensityMultiplier:.8,coreSizeMultiplier:.95},intense:{amplificationFactor:1.3},subdued:{dampeningFactor:.7}}}},{key:"setEmotion",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;return this.errorBoundary.wrap(function(){if(e.interpolationCache.cachedProperties=null,e.interpolationCache.cachedRenderState=null,!J(t)&&!e.emotionalStates.hasOwnProperty(t)){var r=[].concat(a(Object.keys(e.emotionalStates)),a(Q())),s=a(new Set(r));throw new Error("Invalid emotion: ".concat(t,". Valid emotions: ").concat(s.join(", ")))}if(null!==i&&!e.undertoneModifiers.hasOwnProperty(i))throw new Error("Invalid undertone: ".concat(i,". Valid undertones: ").concat(Object.keys(e.undertoneModifiers).join(", ")));return e.state.emotion===t&&e.state.undertone===i||(e.state.emotion!==t&&(n>0?(e.transitions.emotional={current:e.state.emotion,target:t,progress:0,duration:Math.max(100,n),startTime:performance.now(),isActive:!0},void 0!==e.u&&(e.u=0)):e.transitions.emotional={current:t,target:null,progress:1,duration:0,startTime:performance.now(),isActive:!1},e.state.emotion=t),e.state.undertone!==i&&(e.transitions.undertone={current:e.state.undertone,target:i,progress:0,duration:300,startTime:performance.now(),isActive:!0,currentWeight:e.state.undertone?1:0,targetWeight:i?1:0},e.state.undertone=i)),!0},"emotion-setting",!1)()}},{key:"applyUndertone",value:function(t,e){if(!e||!this.undertoneModifiers.hasOwnProperty(e))return $({},t);var i=this.undertoneModifiers[e],n=$({},t);if(void 0!==i.glowIntensityMultiplier&&(n.glowIntensity*=i.glowIntensityMultiplier),void 0!==i.breathRateMultiplier&&(n.breathRate*=i.breathRateMultiplier),void 0!==i.particleRateMultiplier&&(n.particleRate=Math.round(n.particleRate*i.particleRateMultiplier)),void 0!==i.coreSizeMultiplier&&(n.coreSize*=i.coreSizeMultiplier),void 0!==i.amplificationFactor){var a=i.amplificationFactor;n.glowIntensity*=a,n.breathRate*=a,n.particleRate=Math.round(n.particleRate*a),n.coreSize*=a}if(void 0!==i.dampeningFactor){var r=i.dampeningFactor;n.glowIntensity*=r,n.breathRate*=r,n.particleRate=Math.round(n.particleRate*r),n.coreSize*=r}return void 0!==i.jitterAmount&&(n.jitterAmount=i.jitterAmount),n}},{key:"update",value:function(t){var e=this;this.errorBoundary.wrap(function(){e.transitions.emotional.isActive&&e.updateEmotionalTransition(t),e.transitions.undertone.isActive&&e.updateUndertoneTransition(t)},"state-machine-update")()}},{key:"updateUndertoneTransition",value:function(t){var e=this.transitions.undertone,i=performance.now()-e.startTime,n=Math.min(i/e.duration,1),a=E(n);e.current&&e.target?(e.currentWeight=1-a,e.targetWeight=a):e.current&&!e.target?(e.currentWeight=1-a,e.targetWeight=0):!e.current&&e.target&&(e.currentWeight=0,e.targetWeight=a),e.progress=n,n>=1&&(e.isActive=!1,e.current=e.target,e.currentWeight=e.target?1:0,e.targetWeight=0)}},{key:"updateEmotionalTransition",value:function(t){var e,i=this.transitions.emotional;void 0!==this.u?(this.u+=t,e=this.u):e=performance.now()-i.startTime,i.progress=Math.min(1,e/i.duration),i.progress>=1&&(i.isActive=!1,i.current=i.target,i.target=null,i.progress=1)}},{key:"getCurrentEmotionalProperties",value:function(){var t=this;return this.errorBoundary.wrap(function(){var e=performance.now();if(t.interpolationCache.cachedProperties&&e-t.interpolationCache.lastUpdate<t.interpolationCache.cacheInterval)return t.interpolationCache.cachedProperties;var i,n=t.transitions.emotional;n.isActive&&n.target?i=t.interpolateEmotionalProperties(n.current,n.target,n.progress):i=$({},t.emotionalStates[t.state.emotion]||t.emotionalStates.neutral);return i=t.applyUndertone(i,t.state.undertone),t.interpolationCache.cachedProperties=i,t.interpolationCache.lastUpdate=e,i},"emotional-properties",function(){return t.emotionalStates.neutral})()}},{key:"interpolateEmotionalProperties",value:function(t,e,i){var n=this.emotionalStates[t]||this.emotionalStates.neutral,a=this.emotionalStates[e]||this.emotionalStates.neutral,r=q(i,0,1,"easeOutCubic");return{primaryColor:S(n.primaryColor,a.primaryColor,r),glowIntensity:n.glowIntensity+(a.glowIntensity-n.glowIntensity)*r,particleRate:Math.round(n.particleRate+(a.particleRate-n.particleRate)*r),coreSize:n.coreSize+(a.coreSize-n.coreSize)*r,breathRate:n.breathRate+(a.breathRate-n.breathRate)*r,breathDepth:n.breathDepth+(a.breathDepth-n.breathDepth)*r,particleBehavior:r>.5?a.particleBehavior:n.particleBehavior}}},{key:"getCurrentState",value:function(){return{emotion:this.state.emotion,undertone:this.state.undertone,isTransitioning:this.transitions.emotional.isActive,transitionProgress:this.transitions.emotional.progress,properties:this.getCurrentEmotionalProperties()}}},{key:"applyUndertoneModifier",value:function(t){var e=this;return this.errorBoundary.wrap(function(){if(null!==t&&!e.undertoneModifiers.hasOwnProperty(t))throw new Error("Invalid undertone: ".concat(t,". Valid undertones: ").concat(Object.keys(e.undertoneModifiers).join(", ")));return e.state.undertone=t,!0},"undertone-application",!1)()}},{key:"clearUndertone",value:function(){this.state.undertone=null}},{key:"getUndertoneModifier",value:function(t){var e=this;return this.errorBoundary.wrap(function(){if(e.renderer&&e.renderer.undertoneModifiers&&e.renderer.undertoneModifiers[t])return $({},e.renderer.undertoneModifiers[t]);if(!t||!e.undertoneModifiers.hasOwnProperty(t))return null;var i=$({},e.undertoneModifiers[t]);return i.glowRadiusMult||(i.glowRadiusMult=1),i},"undertone-retrieval",null)()}},{key:"getWeightedUndertoneModifiers",value:function(){var t=this.transitions.undertone;if(!t.isActive){if(this.state.undertone){var e=this.getUndertoneModifier(this.state.undertone);if(e)return $($({},e),{},{weight:1,type:this.state.undertone})}return null}if(t.target){var i=this.getUndertoneModifier(t.target);if(i)return $($({},i),{},{weight:t.targetWeight,type:t.target})}if(t.current&&t.currentWeight>0){var n=this.getUndertoneModifier(t.current);if(n)return $($({},n),{},{weight:t.currentWeight,type:t.current})}return null}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.setEmotion("neutral",null,t)}},{key:"isValidEmotion",value:function(t){return this.emotionalStates.hasOwnProperty(t)}},{key:"isValidUndertone",value:function(t){return null===t||this.undertoneModifiers.hasOwnProperty(t)}},{key:"getAvailableEmotions",value:function(){return Object.keys(this.emotionalStates)}},{key:"getAvailableUndertones",value:function(){return Object.keys(this.undertoneModifiers)}},{key:"isTransitioning",value:function(){return this.transitions.emotional.isActive}},{key:"getTransitionProgress",value:function(){return this.transitions.emotional.isActive?this.transitions.emotional.progress:1}},{key:"completeTransition",value:function(){this.transitions.emotional.isActive&&(this.transitions.emotional.progress=1,this.transitions.emotional.isActive=!1,this.transitions.emotional.current=this.transitions.emotional.target,this.transitions.emotional.target=null)}},{key:"interpolateProperty",value:function(t,e,i){return t+(e-t)*q(i,0,1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"easeOutCubic")}},{key:"enableSimulatedTime",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.u=0:delete this.u}}])}();function tt(t){throw new TypeError('"'+t+'" is read-only')}function et(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return it(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?it(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function nt(t){if(!t||0===t.length)return"#FFFFFF";var e,i=0,n=0,a=[],s=et(t);try{for(s.s();!(e=s.n()).done;){var o=e.value;"string"==typeof o?(a.push({color:o,weight:null}),n++):o&&"object"===(0,r.A)(o)&&o.color&&(a.push({color:o.color,weight:o.weight||null}),o.weight?i+=o.weight:n++)}}catch(t){s.e(t)}finally{s.f()}for(var h=Math.max(0,100-i),u=n>0?h/n:0,c=[],l=0,f=0,v=a;f<v.length;f++){var d=v[f];l+=null!==d.weight?d.weight:u,c.push({color:d.color,threshold:l})}for(var p=Math.random()*l,y=0,m=c;y<m.length;y++){var g=m[y];if(p<=g.threshold)return g.color}return a[a.length-1].color}const at={name:"ambient",emoji:"☁️",description:"Gentle upward drift like smoke",initialize:function(t){t.vx=0,t.vy=-.04-.02*Math.random(),t.lifeDecay=.002,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={upwardSpeed:5e-4,waviness:0,friction:.998}},update:function(t,e,i,n){var a=t.behaviorData;t.vy*=Math.pow(a.friction,e),t.vy-=a.upwardSpeed*e,t.vx=0}};var rt={GRAVITY:.098,AIR_RESISTANCE:.99,BOUNCE_DAMPENING:.5,MIN_VELOCITY:.01,MAX_VELOCITY:10,BOUNDARY_MARGIN:20,TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,QUARTER_PI:Math.PI/4};const st={name:"orbiting",emoji:"💕",description:"Romantic firefly dance around the orb",initialize:function(t){t.lifeDecay=.001+.002*Math.random(),t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.isSparkle="#FFE4E1"===t.color||"#FFCCCB"===t.color||"#FFC0CB"===t.color;var e=40*(t.scaleFactor||1)*(1.3+.9*Math.random());t.blinkPhase=Math.random()*rt.TWO_PI,t.blinkSpeed=.3+1.2*Math.random(),t.blinkIntensity=.6+.4*Math.random(),t.fadePhase=Math.random()*rt.TWO_PI,t.fadeSpeed=.1+.3*Math.random(),t.minOpacity=.2+.2*Math.random(),t.maxOpacity=.8+.2*Math.random(),t.isSparkle&&(t.blinkSpeed*=2,t.blinkIntensity=1,t.minOpacity=0,t.maxOpacity=1),t.behaviorData={angle:Math.random()*rt.TWO_PI,radius:e,baseRadius:e,angularVelocity:8e-4+.0017*Math.random(),swayAmount:3+7*Math.random(),swaySpeed:.2+.5*Math.random(),floatOffset:Math.random()*rt.TWO_PI,floatSpeed:.3+.7*Math.random(),floatAmount:2+6*Math.random(),twinklePhase:Math.random()*rt.TWO_PI,twinkleSpeed:2+3*Math.random()}},update:function(t,e,i,n){var a=t.behaviorData;a.angle+=a.angularVelocity*e;var r=Math.sin(a.angle*a.swaySpeed)*a.swayAmount,s=6*Math.sin(1.5*a.angle),o=(a.radius||a.baseRadius)+s+.2*r,h=i+Math.cos(a.angle)*o,u=n+Math.sin(a.angle)*o;a.floatOffset+=a.floatSpeed*e*.001;var c=Math.sin(a.floatOffset)*a.floatAmount;t.vx=.1*(h-t.x),t.vy=.1*(u+c-t.y),t.fadePhase+=t.fadeSpeed*e*.001;var l,f=.5*Math.sin(t.fadePhase)+.5,v=t.minOpacity+(t.maxOpacity-t.minOpacity)*f;t.blinkPhase+=t.blinkSpeed*e*.002,t.isSparkle?(a.twinklePhase+=a.twinkleSpeed*e*.001,l=.7*Math.pow(Math.sin(a.twinklePhase),16)+.2*Math.sin(5*t.blinkPhase)+.1):l=.4*Math.sin(t.blinkPhase)+.3*Math.sin(3*t.blinkPhase)+.2*Math.sin(7*t.blinkPhase)+.1*Math.sin(11*t.blinkPhase);var d=.5*(l+1),p=.2+d*t.blinkIntensity*.8;t.opacity=t.baseOpacity*v*p,t.isSparkle?t.size=t.baseSize*(.5+1*d):t.size=t.baseSize*(.8+.3*d),t.isSparkle&&(t.tempColor=d>.85?"#FFFFFF":t.color)}};const ot={name:"rising",emoji:"🎈",description:"Buoyant upward movement like balloons",initialize:function(t){t.vx=.02*(Math.random()-.5),t.vy=-.05-.03*Math.random(),t.lifeDecay=.002,t.baseOpacity=.7+.3*Math.random(),t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={buoyancy:.001,driftAmount:.005}},update:function(t,e,i,n){var a=t.behaviorData;t.vy-=a.buoyancy*e,t.vx+=(Math.random()-.5)*a.driftAmount*e,t.vx*=Math.pow(.995,e),t.vy*=Math.pow(.998,e)}};const ht={name:"falling",emoji:"💧",description:"Heavy downward drift like tears",initialize:function(t){t.vx=.03*(Math.random()-.5),t.vy=.05+.05*Math.random(),t.lifeDecay=.002,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={gravity:.002,drag:.995}},update:function(t,e,i,n){var a=t.behaviorData;t.vy+=a.gravity*e,t.vx*=Math.pow(a.drag,e),t.vy*=Math.pow(a.drag,e),t.vy>2&&(t.vy=2)}};var ut={particle:{MIN_SIZE:4,MAX_SIZE:10,GLOW_CHANCE:.33,CELL_SHADE_CHANCE:.33,BASE_OPACITY:1},sparkle:{BLINK_SPEED_MIN:.3,BLINK_SPEED_MAX:1.5,INTENSITY_MIN:.6,INTENSITY_MAX:1,SIZE_PULSE:.3},popcorn:{POP_DELAY_MIN:100,POP_DELAY_MAX:2e3,POP_FORCE_MIN:3,POP_FORCE_MAX:8,BOUNCE_HEIGHT:.7},emotions:{ANGER_SHAKE:2,FEAR_JITTER:1.5,LOVE_SWAY:1.2,JOY_BOUNCE:1.8,SADNESS_WEIGHT:.6}};const ct={name:"popcorn",emoji:"🍿",description:"Spontaneous popping with gravity and bounces",initialize:function(t){if(t.vx=.1*(Math.random()-.5),t.vy=.1*(Math.random()-.5),t.lifeDecay=.008+.012*Math.random(),t.emotionColors&&t.emotionColors.length>0)t.color=nt(t.emotionColors);else{t.color=nt(["#FFFFFF","#FFFACD","#FFF8DC","#FFFFE0","#FAFAD2"])}t.size=Math.random()<.3?(8+4*Math.random())*t.scaleFactor*t.particleSizeMultiplier:(2+4*Math.random())*t.scaleFactor*t.particleSizeMultiplier,t.baseSize=t.size,t.hasGlow=Math.random()<.2,t.glowSizeMultiplier=t.hasGlow?1.2:0,t.behaviorData={popDelay:Math.random()*ut.popcorn.POP_DELAY_MAX,hasPopped:!1,popStrength:ut.popcorn.POP_FORCE_MIN+Math.random()*(ut.popcorn.POP_FORCE_MAX-ut.popcorn.POP_FORCE_MIN),gravity:.098,bounceDamping:ut.popcorn.BOUNCE_HEIGHT,bounceCount:0,maxBounces:2+Math.floor(2*Math.random()),spinRate:10*(Math.random()-.5),lifetime:0}},update:function(t,e,i,n){var a=t.behaviorData;if(a.lifetime+=16.67*e,!a.hasPopped&&a.lifetime>a.popDelay){a.hasPopped=!0;var r=Math.random()*Math.PI*2;t.vx=Math.cos(r)*a.popStrength*1.5,t.vy=Math.sin(r)*a.popStrength-.3,t.size=1.25*t.baseSize}if(a.hasPopped){t.vy+=a.gravity*e;var s=n+100*t.scaleFactor;t.y>s&&a.bounceCount<a.maxBounces&&(t.y=s,t.vy=-Math.abs(t.vy)*a.bounceDamping,t.vx*=.9,a.bounceCount++,t.size=t.baseSize*(1.5-.1*a.bounceCount)),a.bounceCount>=a.maxBounces&&(t.lifeDecay=.03+.02*Math.random(),t.size*=.95),Math.sqrt(t.vx*t.vx+t.vy*t.vy)<.5&&(t.lifeDecay*=1.5)}}};const lt={name:"burst",emoji:"💥",description:"Explosive expansion from center",initialize:function(t){var e="suspicion"===t.emotion,i="surprise"===t.emotion,n=Math.random()*rt.TWO_PI,a=e?1+.8*Math.random():i?7+5*Math.random():3.5+2.5*Math.random();t.vx=Math.cos(n)*a,t.vy=Math.sin(n)*a,t.lifeDecay=e?.01:i?.006+.008*Math.random():.015,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),e&&(t.size=(6+4*Math.random())*(t.scaleFactor||1)*(t.particleSizeMultiplier||1),t.baseSize=t.size,t.opacity=1,t.baseOpacity=t.opacity),t.behaviorData={isSuspicion:e,isSurprise:i,age:0,fadeStart:e?.3:.2}},update:function(t,e,i,n){var a=t.behaviorData;if(a.isSurprise)if(a.age+=.016*e,a.age<.15){t.vx*=Math.pow(.98,e),t.vy*=Math.pow(.98,e)}else if(a.age<.25){t.vx*=Math.pow(.85,e),t.vy*=Math.pow(.85,e)}else{t.vx*=Math.pow(.99,e),t.vy*=Math.pow(.99,e),t.vx+=.01*(Math.random()-.5)*e,t.vy+=.01*(Math.random()-.5)*e}else{var r=a.isSuspicion?.99:.95;t.vx*=Math.pow(r,e),t.vy*=Math.pow(r,e)}if(a.isSuspicion){var s=.001*Date.now();t.vx+=.01*Math.sin(2*s+t.id)*e}}};const ft={name:"aggressive",emoji:"⚡",description:"Sharp, chaotic movement with violent bursts",initialize:function(t){var e=Math.random()*rt.TWO_PI,i=1.5+2*Math.random();t.vx=Math.cos(e)*i,t.vy=Math.sin(e)*i,t.lifeDecay=.015,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={acceleration:.05,jitter:.3,speedDecay:.95}},update:function(t,e,i,n){var a=t.behaviorData;if(t.vx+=(Math.random()-.5)*a.jitter*e,t.vy+=(Math.random()-.5)*a.jitter*e,t.vx*=Math.pow(a.speedDecay,e),t.vy*=Math.pow(a.speedDecay,e),Math.random()<Math.min(.05*e,.5)){var r=Math.random()*rt.TWO_PI;t.vx+=Math.cos(r)*a.acceleration,t.vy+=Math.sin(r)*a.acceleration}}};const vt={name:"scattering",emoji:"😨",description:"Particles flee from center in panic",initialize:function(t){t.vx=0,t.vy=0,t.lifeDecay=.008,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={fleeSpeed:2,panicFactor:1.2,initialized:!1}},update:function(t,e,i,n){var a=t.behaviorData;if(!a.initialized){var r=t.x-i,s=t.y-n,o=Math.sqrt(r*r+s*s);if(o>0)t.vx=r/o*a.fleeSpeed,t.vy=s/o*a.fleeSpeed;else{var h=Math.random()*rt.TWO_PI;t.vx=Math.cos(h)*a.fleeSpeed,t.vy=Math.sin(h)*a.fleeSpeed}a.initialized=!0}var u=t.x-i,c=t.y-n,l=Math.sqrt(u*u+c*c);l>0&&(t.vx+=u/l*a.panicFactor*.01*e,t.vy+=c/l*a.panicFactor*.01*e),t.vx+=.1*(Math.random()-.5)*e,t.vy+=.1*(Math.random()-.5)*e,t.vx*=Math.pow(.98,e),t.vy*=Math.pow(.98,e)}};const dt={name:"repelling",emoji:"🚫",description:"Particles pushed away from center, maintaining distance",initialize:function(t){t.vx=0,t.vy=0,t.lifeDecay=.01,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={repelStrength:.8,minDistance:50,initialized:!1}},update:function(t,e,i,n){var a=t.behaviorData,r=t.x-i,s=t.y-n,o=Math.sqrt(r*r+s*s);if(!a.initialized||o<a.minDistance){if(o>0){var h=a.repelStrength/Math.max(o,5);t.vx+=r/o*h*e,t.vy+=s/o*h*e}a.initialized=!0}t.vx*=Math.pow(.99,e),t.vy*=Math.pow(.99,e)}};const pt={name:"connecting",emoji:"🔗",description:"Chaotic movement with center attraction for social states",initialize:function(t){var e=Math.random()*rt.TWO_PI,i=2+5*Math.random();t.vx=Math.cos(e)*i,t.vy=Math.sin(e)*i,t.lifeDecay=.012,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={attractionForce:.008,chaosFactor:1,friction:.95}},update:function(t,e,i,n){var a=t.behaviorData;t.vx*=Math.pow(a.friction,e),t.vy*=Math.pow(a.friction,e);var r=(i-t.x)*a.attractionForce,s=(n-t.y)*a.attractionForce,o=(Math.random()-.5)*a.chaosFactor,h=(Math.random()-.5)*a.chaosFactor;t.vx+=r+o,t.vy+=s+h}};const yt={name:"resting",emoji:"😴",description:"Ultra-slow vertical drift for deep rest states",initialize:function(t){t.vx=0,t.vy=-.01,t.lifeDecay=.001,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={upwardSpeed:2e-5,friction:.999}},update:function(t,e,i,n){var a=t.behaviorData;t.vy*=Math.pow(a.friction,e),t.vy-=a.upwardSpeed*e,t.vx=0}};const mt={name:"radiant",emoji:"☀️",description:"Particles radiate outward like sunbeams",initialize:function(t){var e=Math.random()*rt.TWO_PI,i=.8+.4*Math.random();if(t.vx=Math.cos(e)*i,t.vy=Math.sin(e)*i,t.lifeDecay=.006,t.emotionColors&&t.emotionColors.length>0)t.color=nt(t.emotionColors);else{t.color=nt(["#FFD700","#FFB347","#FFA500","#FF69B4"])}t.hasGlow=Math.random()<.7,t.glowSizeMultiplier=t.hasGlow?1.5+.5*Math.random():0,t.behaviorData={radialSpeed:.02,shimmer:Math.random()*rt.TWO_PI,shimmerSpeed:.1,friction:.99}},update:function(t,e,i,n){var a=t.behaviorData,r=t.x-i,s=t.y-n,o=Math.sqrt(r*r+s*s);if(o>0){var h=r/o,u=s/o;t.vx+=h*a.radialSpeed*e,t.vy+=u*a.radialSpeed*e}a.shimmer+=a.shimmerSpeed*e;var c=Math.sin(a.shimmer);t.size=t.baseSize*(1+.2*c),t.opacity=t.baseOpacity*(1+.3*c),t.vx*=Math.pow(a.friction,e),t.vy*=Math.pow(a.friction,e)}};function gt(t){t.vx=.02*(Math.random()-.5),t.vy=-.03-.02*Math.random(),t.lifeDecay=8e-4,t.size=(6+6*Math.random())*(t.scaleFactor||1)*(t.particleSizeMultiplier||1)*1.33,t.baseSize=t.size,t.baseOpacity=.2+.2*Math.random(),t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={ascensionSpeed:3e-4,waveFactor:.5,waveFrequency:.001,friction:.998,fadeStartDistance:100}}const bt={name:"ascending",emoji:"🧘",description:"Slow steady upward float like incense smoke",initialize:gt,update:function(t,e,i,n){var a=t.behaviorData;if(a){t.vx*=Math.pow(a.friction,e),t.vy*=Math.pow(a.friction,e),t.vy-=a.ascensionSpeed*e;var r=Math.sin(t.age*a.waveFrequency*1e3)*a.waveFactor;t.vx+=.001*r*e,void 0===t.initialY&&(t.initialY=t.y);var s=t.initialY-t.y;if(s>a.fadeStartDistance){var o=(s-a.fadeStartDistance)/100,h=Math.max(0,1-o);t.baseOpacity*=.995,h<.5&&(t.lifeDecay*=1.02)}Math.abs(t.vx)>.05&&(t.vx*=Math.pow(.95,e)),t.vy<-.1&&(t.vy=-.1)}else gt(t)}};const Mt={name:"erratic",emoji:"😰",description:"Nervous jittery movement for anxious states",initialize:function(t){var e=Math.random()*rt.TWO_PI,i=.1+.15*Math.random();t.vx=Math.cos(e)*i,t.vy=Math.sin(e)*i,t.lifeDecay=.004,t.size=(2+4*Math.random())*(t.scaleFactor||1)*(t.particleSizeMultiplier||1),t.baseSize=t.size,t.baseOpacity=.4+.3*Math.random(),t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={jitterStrength:.02,directionChangeRate:.1,speedVariation:.3,spinRate:.05+.1*Math.random()}},update:function(t,e){var i=t.behaviorData;if(t.vx+=(Math.random()-.5)*i.jitterStrength*e,t.vy+=(Math.random()-.5)*i.jitterStrength*e,Math.random()<Math.min(i.directionChangeRate*e,.5)){var n=Math.random()*rt.TWO_PI,a=Math.sqrt(t.vx*t.vx+t.vy*t.vy);t.vx=Math.cos(n)*a,t.vy=Math.sin(n)*a}var r=1+(Math.random()-.5)*i.speedVariation*e;t.vx*=r,t.vy*=r;var s=t.age*i.spinRate*1e3;t.size=t.baseSize*(1+.2*Math.sin(s)),t.opacity=t.baseOpacity*(.8+.4*Math.random()),t.vx*=Math.pow(.98,e),t.vy*=Math.pow(.98,e);var o=Math.sqrt(t.vx*t.vx+t.vy*t.vy);o>.5&&(t.vx=t.vx/o*.5,t.vy=t.vy/o*.5)}};const kt={name:"cautious",emoji:"🤨",description:"Slow careful movement with watchful pauses",initialize:function(t){var e=Math.random()*rt.TWO_PI,i=.02+.03*Math.random();t.vx=Math.cos(e)*i,t.vy=Math.sin(e)*i,t.lifeDecay=.001,t.life=1,t.size=(4+4*Math.random())*(t.scaleFactor||1)*(t.particleSizeMultiplier||1),t.baseSize=t.size,t.baseOpacity=.8+.2*Math.random(),t.opacity=t.baseOpacity,t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorData={pauseTimer:2*Math.random(),pauseDuration:.5+.5*Math.random(),moveDuration:1+.5*Math.random(),isMoving:Math.random()>.5,moveTimer:0,originalVx:t.vx,originalVy:t.vy,watchRadius:50+30*Math.random()}},update:function(t,e,i,n){var a=t.behaviorData;if(a.moveTimer+=e,a.isMoving)a.moveTimer>a.moveDuration?(a.isMoving=!1,a.moveTimer=0,t.vx=0,t.vy=0):(t.vx=a.originalVx,t.vy=a.originalVy);else if(a.moveTimer>a.pauseDuration){a.isMoving=!0,a.moveTimer=0;var r=Math.random()*rt.TWO_PI,s=.02+.03*Math.random();t.vx=Math.cos(r)*s,t.vy=Math.sin(r)*s,a.originalVx=t.vx,a.originalVy=t.vy}var o=t.x-i,h=t.y-n,u=Math.sqrt(o*o+h*h);if(u>a.watchRadius){t.vx-=o/u*.02*e,t.vy-=h/u*.02*e}t.vx*=Math.pow(.995,e),t.vy*=Math.pow(.995,e),a.isMoving?t.opacity=t.baseOpacity:t.opacity=t.baseOpacity*(.9+.1*Math.sin(5*t.age))}},wt={name:"surveillance",emoji:"👁️",description:"Searchlight scanning with paranoid watchfulness",initialize:function(t,e){t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorState={scanAngle:Math.random()*Math.PI-Math.PI/2,scanDirection:Math.random()<.5?1:-1,scanSpeed:.3+.2*Math.random(),scanRange:Math.PI/3+Math.random()*Math.PI/4,scanCenter:Math.random()*Math.PI*2,pauseTimer:0,pauseDuration:500+500*Math.random(),mode:"scanning",modeTimer:0,nextModeChange:2e3+3e3*Math.random(),dartTarget:{x:0,y:0},dartSpeed:0,patrolRadius:150+100*Math.random(),patrolAngle:Math.random()*Math.PI*2,alertLevel:0,lastPosition:{x:t.x,y:t.y}};var i=Math.random();i<.7?t.behaviorState.primaryRole="scanner":i<.9?(t.behaviorState.primaryRole="patroller",t.behaviorState.mode="patrolling"):(t.behaviorState.primaryRole="watcher",t.behaviorState.mode="frozen")},update:function(t,e,i){var n=t.behaviorState;if(n){switch(n.modeTimer+=16*e,n.modeTimer>n.nextModeChange&&(this.changeMode(t,n),n.modeTimer=0,n.nextModeChange=2e3+4e3*Math.random()),n.mode){case"scanning":this.updateScanning(t,e,n,i);break;case"darting":this.updateDarting(t,e,n,i);break;case"frozen":this.updateFrozen(t,e,n,i);break;case"patrolling":this.updatePatrolling(t,e,n,i)}t.vy+=.05*e,t.x+=t.vx*e,t.y+=t.vy*e,n.lastPosition.x=t.x,n.lastPosition.y=t.y}},updateScanning:function(t,e,i,n){i.pauseTimer>0?(i.pauseTimer-=16*e,t.vx*=.9,t.vy*=.9):(i.scanAngle+=i.scanDirection*i.scanSpeed*e*.02,Math.abs(i.scanAngle)>i.scanRange/2&&(i.scanDirection*=-1,i.pauseTimer=i.pauseDuration,i.scanAngle=Math.sign(i.scanAngle)*i.scanRange/2));var a=i.scanCenter+i.scanAngle,r=.8+.5*i.alertLevel;t.vx=Math.cos(a)*r,t.vy=Math.sin(a)*r*.3},updateDarting:function(t,e,i,n){var a=i.dartTarget.x-t.x,r=i.dartTarget.y-t.y,s=Math.sqrt(a*a+r*r);s>5?(t.vx=a/s*i.dartSpeed,t.vy=r/s*i.dartSpeed):(i.mode="scanning",i.modeTimer=0)},updateFrozen:function(t,e,i,n){t.vx*=.95,t.vy*=.95,Math.random()<.01&&(t.vx+=.5*(Math.random()-.5),t.vy+=.5*(Math.random()-.5))},updatePatrolling:function(t,e,i,n){i.patrolAngle+=.01*e;var a=Math.cos(i.patrolAngle)*i.patrolRadius,r=Math.sin(i.patrolAngle)*i.patrolRadius,s=a-t.x,o=r-t.y;t.vx=.02*s,t.vy=.02*o},changeMode:function(t,e){var i=Math.random();"scanner"===e.primaryRole?i<.1?(e.mode="darting",e.dartTarget={x:200*(Math.random()-.5),y:200*(Math.random()-.5)},e.dartSpeed=3+2*Math.random()):e.mode=i<.2?"frozen":"scanning":"patroller"===e.primaryRole?e.mode=i<.1?"frozen":"patrolling":e.mode=i<.3?"scanning":"frozen"}},St={name:"glitchy",emoji:"⚡",description:"Digital glitch with stuttering orbits and corruption",rhythm:{enabled:!0,glitchTiming:{mode:"subdivision",subdivision:"sixteenth",probability:.3,intensityOnBeat:2,intensityOffBeat:.5},stutterSync:{mode:"pattern",patterns:{dubstep:{freezeOnDrop:!0,dropDuration:100},breakbeat:{randomFreeze:.1,duration:50}}},orbitRhythm:{baseSpeed:"tempo",wobbleSync:"eighth",beatAcceleration:1.5,barReset:!0},rgbSync:{enabled:!0,amount:"intensity",direction:"beat",maxSplit:10},noiseRhythm:{trigger:"accent",duration:50,intensity:"drop"}},initialize:function(t,e,i,n){t.emotionColors&&t.emotionColors.length>0&&(t.color=nt(t.emotionColors)),t.behaviorState={orbitAngle:Math.random()*Math.PI*2,orbitRadius:30+40*Math.random(),orbitSpeed:.01+.02*Math.random(),glitchTimer:0,nextGlitch:500*Math.random()+100,isGlitching:!1,glitchDuration:0,glitchOffset:{x:0,y:0},stutterTimer:0,nextStutter:200*Math.random()+50,isFrozen:!1,frozenPosition:{x:0,y:0},frozenVelocity:{x:0,y:0},hasGhost:Math.random()<.3,ghostOffset:20*Math.random()+10,ghostAngle:Math.random()*Math.PI*2,rgbSplit:Math.random()<.4,rgbPhase:Math.random()*Math.PI*2,noiseLevel:0,noiseBurst:!1,beatPhase:Math.random()*Math.PI*2,beatFrequency:.05+.03*Math.random(),dropIntensity:0},t.lifeDecay=.0015,t.hasGlow=Math.random()<.5,t.hasGlow&&(t.glowSizeMultiplier=2+Math.random())},update:function(t,e,i,n){var a=t.behaviorState;if(a){a.glitchTimer+=16*e,a.stutterTimer+=16*e,a.stutterTimer>a.nextStutter&&(a.isFrozen?(a.isFrozen=!1,a.stutterTimer=0,a.nextStutter=100+300*Math.random(),Math.random()<.3&&(t.x+=20*(Math.random()-.5),t.y+=20*(Math.random()-.5))):(a.isFrozen=!0,a.frozenPosition={x:t.x,y:t.y},a.frozenVelocity={x:t.vx,y:t.vy},a.stutterTimer=0,a.nextStutter=20+40*Math.random())),a.glitchTimer>a.nextGlitch&&!a.isGlitching&&(a.isGlitching=!0,a.glitchDuration=50+100*Math.random(),a.glitchOffset={x:30*(Math.random()-.5),y:30*(Math.random()-.5)},a.glitchTimer=0,Math.random()<.5&&t.emotionColors&&(t.color=nt(t.emotionColors))),a.isGlitching&&a.glitchTimer>a.glitchDuration&&(a.isGlitching=!1,a.glitchTimer=0,a.nextGlitch=200+800*Math.random(),a.glitchOffset={x:0,y:0}),a.beatPhase+=a.beatFrequency*e;var r=.5*Math.sin(a.beatPhase)+.5;if(a.beatPhase%(4*Math.PI)<.5*Math.PI?a.dropIntensity=Math.min(1,a.dropIntensity+.1*e):a.dropIntensity=Math.max(0,a.dropIntensity-.05*e),a.isFrozen)t.vx=.5*(Math.random()-.5),t.vy=.5*(Math.random()-.5);else{a.orbitAngle+=a.orbitSpeed*e*(1+.5*r);var s=a.orbitRadius*(1+.3*a.dropIntensity*Math.sin(4*a.beatPhase)),o=i+Math.cos(a.orbitAngle)*s,h=n+Math.sin(a.orbitAngle)*s*.6;if(a.isGlitching&&(o+=a.glitchOffset.x*Math.random()*.5,h+=a.glitchOffset.y*Math.random()*.5),a.rgbSplit){var u=3*(1+a.dropIntensity);o+=Math.sin(a.rgbPhase)*u,h+=Math.cos(a.rgbPhase)*u,a.rgbPhase+=.1*e}a.dropIntensity>.8&&Math.random()<.1&&(o+=10*(Math.random()-.5),h+=10*(Math.random()-.5));var c=a.isGlitching?.05:.08;t.vx=(o-t.x)*c,t.vy=(h-t.y)*c,t.vx+=(Math.random()-.5)*r*2,t.vy+=(Math.random()-.5)*r*2}t.x+=t.vx*e,t.y+=t.vy*e,Math.random()<.02&&(t.opacity=.1+.9*Math.random()),t.size=t.baseSize*(1+.3*r+.5*a.dropIntensity)}}},Ot={name:"directed",emoji:"🎯",description:"Focused, straight-line movement toward target",config:{speed:3,acceleration:.15,focusStrength:.8,randomness:.1,edgeBuffer:50},initialize:function(t,e,i,n,a){var r=e-t.x,s=i-t.y,o=Math.sqrt(r*r+s*s);if(o>0)t.vx=r/o*this.config.speed,t.vy=s/o*this.config.speed;else{var h=Math.random()*Math.PI*2;t.vx=Math.cos(h)*this.config.speed,t.vy=Math.sin(h)*this.config.speed}t.targetX=e,t.targetY=i,t.directedPhase=0},update:function(t,e,i,n,a,r){t.directedPhase+=.05*e;var s=t.targetX-t.x,o=t.targetY-t.y,h=Math.sqrt(s*s+o*o);if(h>10){var u=s/h*this.config.speed,c=o/h*this.config.speed;t.vx+=(u-t.vx)*this.config.acceleration*e,t.vy+=(c-t.vy)*this.config.acceleration*e,t.vx+=(Math.random()-.5)*this.config.randomness,t.vy+=(Math.random()-.5)*this.config.randomness}else{var l=Math.random()*Math.PI*2,f=100+200*Math.random();t.targetX=i+Math.cos(l)*f,t.targetY=n+Math.sin(l)*f,t.targetX=Math.max(this.config.edgeBuffer,Math.min(a-this.config.edgeBuffer,t.targetX)),t.targetY=Math.max(this.config.edgeBuffer,Math.min(r-this.config.edgeBuffer,t.targetY))}t.x+=t.vx*e,t.y+=t.vy*e,(t.x<=0||t.x>=a)&&(t.vx*=-.8,t.x=Math.max(0,Math.min(a,t.x)),t.targetX=i+300*(Math.random()-.5)),(t.y<=0||t.y>=r)&&(t.vy*=-.8,t.y=Math.max(0,Math.min(r,t.y)),t.targetY=n+300*(Math.random()-.5))},visuals:{trailLength:"medium",opacity:.9,sizeMultiplier:1,blurAmount:.2}},jt={name:"fizzy",emoji:"🫧",description:"Bubbly, effervescent movement like carbonation",config:{baseRiseSpeed:2.5,wobbleAmplitude:30,wobbleFrequency:.15,popChance:.002,popForce:8,fizziness:.3,gravity:-.05},initialize:function(t,e,i,n,a){t.vx=2*(Math.random()-.5),t.vy=-this.config.baseRiseSpeed-2*Math.random(),t.wobblePhase=Math.random()*Math.PI*2,t.wobbleSpeed=this.config.wobbleFrequency*(.8+.4*Math.random()),t.bubbleSize=.5+.5*Math.random(),t.popTimer=0,t.isFizzing=!0},update:function(t,e,i,n,a,r){t.wobblePhase+=t.wobbleSpeed*e;var s=Math.sin(t.wobblePhase)*this.config.wobbleAmplitude;if(t.vx=.05*s+(Math.random()-.5)*this.config.fizziness,t.vy+=this.config.gravity*e,t.vy+=(Math.random()-.5)*this.config.fizziness,Math.random()<this.config.popChance){var o=Math.random()*Math.PI*2;t.vx=Math.cos(o)*this.config.popForce,t.vy=Math.sin(o)*this.config.popForce*.7,t.popTimer=1,t.bubbleSize=.3+.7*Math.random()}t.popTimer>0&&(t.popTimer-=.05*e,t.vx*=.95,t.vy*=.95),t.x+=t.vx*e,t.y+=t.vy*e,t.y<-50&&(t.y=r+50,t.x=i+300*(Math.random()-.5),t.vy=-this.config.baseRiseSpeed-2*Math.random(),t.bubbleSize=.5+.5*Math.random()),(t.x<=0||t.x>=a)&&(t.vx*=-.5,t.x=Math.max(0,Math.min(a,t.x))),t.y>r+50&&(t.y=r,t.vy=1.5*-this.config.baseRiseSpeed),t.size=t.baseSize*t.bubbleSize*(1+.1*Math.sin(2*t.wobblePhase))},visuals:{trailLength:"short",opacity:.6,sizeMultiplier:1.2,blurAmount:.5,sparkle:!0}},Ft={name:"calm",description:"Gentle, peaceful particle movement with slow drift",config:{baseSpeed:.08,driftSpeed:.02,fadeSpeed:8e-4,sizeChange:2e-4,swayAmplitude:3,floatAmplitude:2,rotationSpeed:1e-4,minOpacity:.15,maxOpacity:.35,breathingPeriod:8e3,connectionDistance:0,centerAttraction:5e-5},init:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.behavior="calm",t.speed=this.config.baseSpeed*(.8+.4*Math.random()),t.angle=Math.random()*Math.PI*2,t.driftAngle=Math.random()*Math.PI*2,t.driftSpeed=this.config.driftSpeed*(.5+.5*Math.random()),t.opacity=this.config.minOpacity,t.targetOpacity=this.config.maxOpacity*(.7+.3*Math.random()),t.breathingOffset=Math.random()*Math.PI*2,t.swayOffset=Math.random()*Math.PI*2,t.rotationAngle=0,t.fadeIn=!0,t.lifetime=0,e.startPos){var i=20+30*Math.random(),n=Math.random()*Math.PI*2;t.x=e.startPos.x+Math.cos(n)*i,t.y=e.startPos.y+Math.sin(n)*i}},update:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.lifetime+=e;var n=(t.lifetime+t.breathingOffset*this.config.breathingPeriod)/this.config.breathingPeriod,a=.5*Math.sin(n*Math.PI*2)+.5;t.fadeIn?(t.opacity=Math.min(t.targetOpacity,t.opacity+this.config.fadeSpeed*e),t.opacity>=.95*t.targetOpacity&&(t.fadeIn=!1)):t.opacity=t.targetOpacity*(.85+.15*a),t.driftAngle+=.001*(Math.random()-.5)*e;var r=Math.cos(t.driftAngle)*t.driftSpeed*e,s=Math.sin(t.driftAngle)*t.driftSpeed*e,o=(t.lifetime+1e4*t.swayOffset)/1e4,h=Math.sin(o*Math.PI*2)*this.config.swayAmplitude*.01,u=(t.lifetime+8e3*t.swayOffset)/8e3,c=Math.sin(u*Math.PI*2)*this.config.floatAmplitude*.01;if(t.x+=r+h,t.y+=s+c-t.speed*e*.05,i.centerPos){var l=i.centerPos.x-t.x,f=i.centerPos.y-t.y;Math.sqrt(l*l+f*f)>100&&(t.x+=l*this.config.centerAttraction*e,t.y+=f*this.config.centerAttraction*e)}t.size=t.baseSize*(.95+.05*a),t.rotationAngle+=this.config.rotationSpeed*e,t.life<.2&&(t.opacity*=5*t.life)},render:function(t,e){t.save(),t.globalAlpha=.3*e.opacity,t.fillStyle=e.color||"#7FCDCD",t.shadowBlur=2*e.size,t.shadowColor=e.color||"#7FCDCD",t.beginPath(),t.arc(e.x,e.y,1.5*e.size,0,2*Math.PI),t.fill(),t.globalAlpha=e.opacity,t.shadowBlur=0,t.beginPath(),t.arc(e.x,e.y,e.size,0,2*Math.PI),t.fill(),t.restore()}};function At(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}var xt=new Map;const Bt={registerPluginBehavior:function(t,e){return xt.has(t),!(!e.initialize||"function"!=typeof e.initialize)&&(!(!e.update||"function"!=typeof e.update)&&(xt.set(t,{name:t,emoji:e.emoji||"🔌",description:e.description||"Plugin behavior: ".concat(t),initialize:e.initialize,update:e.update,isPlugin:!0}),!0))},unregisterPluginBehavior:function(t){return!!xt.has(t)&&(xt.delete(t),!0)},getPluginBehavior:function(t){return xt.get(t)||null},getAllPluginBehaviors:function(){return Array.from(xt.keys())},createLegacyAdapter:function(t){return{name:t.name||"legacy",emoji:"🔄",description:t.description||"Legacy plugin behavior",initialize:function(e){if(t.size&&(e.size="object"===(0,r.A)(t.size)?t.size.min+Math.random()*(t.size.max-t.size.min):t.size,e.baseSize=e.size),t.speed){var i="object"===(0,r.A)(t.speed)?t.speed.min+Math.random()*(t.speed.max-t.speed.min):t.speed,n=Math.random()*Math.PI*2;e.vx=Math.cos(n)*i,e.vy=Math.sin(n)*i}if(t.lifespan){var a="object"===(0,r.A)(t.lifespan)?t.lifespan.min+Math.random()*(t.lifespan.max-t.lifespan.min):t.lifespan;e.lifeDecay=1e3/a}t.color&&(e.color=Array.isArray(t.color)?nt(t.color):t.color),t.opacity&&(e.life="object"===(0,r.A)(t.opacity)?t.opacity.min+Math.random()*(t.opacity.max-t.opacity.min):t.opacity),e.behaviorData=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?At(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):At(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}({movementType:t.movementType||"linear",turbulence:t.turbulence||0,drift:t.drift||0,acceleration:t.acceleration||0},t.customData)},update:function(e,i,n,a){var r=e.behaviorData;switch(r.movementType){case"wander":e.vx+=(Math.random()-.5)*r.turbulence*i,e.vy+=(Math.random()-.5)*r.turbulence*i;break;case"fall":e.vy+=.1*i,e.vx+=(Math.random()-.5)*r.drift*i;break;case"rain":e.vy+=r.acceleration*i;break;case"orbit":var s=e.x-n,o=e.y-a,h=Math.sqrt(s*s+o*o);if(h>0){var u=Math.atan2(o,s)+.02*i;e.x=n+Math.cos(u)*h,e.y=a+Math.sin(u)*h}}t.customUpdate&&t.customUpdate(e,i,n,a)}}}};var Ct={};function Pt(t){if(Ct[t])return Ct[t];var e=Bt.getPluginBehavior(t);return e||null}function Et(t,e){var i=Pt(e);return i&&i.initialize?(i.initialize(t),!0):"ambient"!==e&&Et(t,"ambient")}function Tt(t,e,i,n,a){var r=Pt(e);return!(!r||!r.update)&&(r.update(t,i,n,a),!0)}function Rt(){var t=Object.values(Ct).map(function(t){return{name:t.name,emoji:t.emoji||"🎯",description:t.description||"No description",type:"core"}}),e=Bt.getAllPluginBehaviors().map(function(t){var e=Bt.getPluginBehavior(t);return{name:e.name,emoji:e.emoji||"🔌",description:e.description||"Plugin behavior",type:"plugin"}});return[].concat(a(t),a(e))}[at,Ot,jt,st,ot,ht,ct,lt,ft,vt,dt,pt,yt,mt,bt,Mt,kt,wt,St,Ft].forEach(function(t){Ct[t.name]=t}),"undefined"!=typeof window&&window.DEBUG_PARTICLES&&(window.ParticleBehaviors={registry:Ct,list:Rt,get:Pt});var It=i(209);function zt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Dt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?zt(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):zt(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var qt=new(function(){return f(function t(){u(this,t),this.bpm=120,this.timeSignature=[4,4],this.isPlaying=!1,this.startTime=0,this.currentBeat=0,this.currentBar=0,this.beatProgress=0,this.barProgress=0,this.beatDuration=6e4/this.bpm,this.barDuration=this.beatDuration*this.timeSignature[0],this.lastBeatTime=0,this.nextBeatTime=0,this.listeners=new Map,this.beatCallbacks=new Set,this.barCallbacks=new Set,this.subdivisions={sixteenth:0,eighth:0,triplet:0,swing:0},this.audioSync=null,this.syncOffset=0,this.autoSync=!1,this.intensity=1,this.groove=0,this.humanize=.05,this.patterns=new Map,this.currentPattern=null,this.initializePatterns()},[{key:"initializePatterns",value:function(){this.patterns.set("4/4",{name:"4/4",description:"Common time - 4 beats per bar",timeSignature:[4,4],groove:0,accents:[1,.5,.7,.5]}),this.patterns.set("straight",{name:"straight",description:"Straight, even timing",groove:0,accents:[1,.5,.7,.5]}),this.patterns.set("swing",{name:"swing",description:"Swing/shuffle timing",groove:.67,accents:[1,.3,.8,.3]}),this.patterns.set("3/4",{name:"3/4",description:"Waltz time - 3 beats per bar",timeSignature:[3,4],accents:[1,.5,.5]}),this.patterns.set("waltz",{name:"waltz",description:"3/4 waltz timing",timeSignature:[3,4],accents:[1,.5,.5]}),this.patterns.set("6/8",{name:"6/8",description:"Compound duple time",timeSignature:[6,8],accents:[1,.3,.3,.7,.3,.3]}),this.patterns.set("5/4",{name:"5/4",description:"Complex meter - 5 beats per bar",timeSignature:[5,4],accents:[1,.5,.6,.5,.7]}),this.patterns.set("7/8",{name:"7/8",description:"Irregular meter",timeSignature:[7,8],accents:[1,.5,.5,.7,.5,.5,.6]}),this.patterns.set("dubstep",{name:"dubstep",description:"Dubstep half-time feel",accents:[.2,.2,1,.2],subdivisions:{wobble:!0}}),this.patterns.set("breakbeat",{name:"breakbeat",description:"Broken beat pattern",accents:[1,.2,.7,.9,.2,.8,.4,.2]})}},{key:"start",value:function(){this.isPlaying||(this.isPlaying=!0,this.isRunning=!0,this.startTime=performance.now(),this.lastBeatTime=this.startTime,this.nextBeatTime=this.startTime+this.beatDuration,this.currentBeat=0,this.currentBar=0,this.emit("start",{bpm:this.bpm,timeSignature:this.timeSignature,pattern:this.currentPattern}),this.update())}},{key:"stop",value:function(){this.isPlaying&&(this.isPlaying=!1,this.emit("stop",{totalBeats:this.currentBeat,totalBars:this.currentBar}))}},{key:"update",value:function(){var t=this;if(this.isPlaying){var e=(performance.now()-this.startTime)/this.beatDuration,i=Math.floor(e);this.beatProgress=e%1,i>this.currentBeat&&this.onBeat(i);var n=Math.floor(i/this.timeSignature[0]);n>this.currentBar&&this.onBar(n),this.currentBeat=i,this.currentBar=n,this.barProgress=i%this.timeSignature[0]/this.timeSignature[0],this.updateSubdivisions(),this.emit("update",this.getTimeInfo()),this.isPlaying&&requestAnimationFrame(function(){return t.update()})}}},{key:"onBeat",value:function(t){var e=t%this.timeSignature[0],i=this.getAccent(e),n=this.humanize*(Math.random()-.5)*this.beatDuration,a={beat:t,beatInBar:e,bar:this.currentBar,accent:i,intensity:this.intensity*i,humanTiming:n,timestamp:performance.now()};this.emit("beat",a),this.beatCallbacks.forEach(function(t){return t(a)}),this.lastBeatTime=performance.now(),this.nextBeatTime=this.lastBeatTime+this.beatDuration}},{key:"onBar",value:function(t){var e={bar:t,timeSignature:this.timeSignature,pattern:this.currentPattern,timestamp:performance.now()};this.emit("bar",e),this.barCallbacks.forEach(function(t){return t(e)})}},{key:"updateSubdivisions",value:function(){if(this.subdivisions.sixteenth=4*this.beatProgress%1,this.subdivisions.eighth=2*this.beatProgress%1,this.subdivisions.triplet=3*this.beatProgress%1,this.groove>0){var t=.5+.17*this.groove;this.subdivisions.eighth<.5?this.subdivisions.swing=this.subdivisions.eighth/t:this.subdivisions.swing=.5+(this.subdivisions.eighth-.5)/(1-t)}else this.subdivisions.swing=this.subdivisions.eighth}},{key:"getAccent",value:function(t){if(this.currentPattern&&this.patterns.has(this.currentPattern)){var e=this.patterns.get(this.currentPattern);if(e.accents&&void 0!==e.accents[t])return e.accents[t]}return 0===t?1:2===t&&4===this.timeSignature[0]?.7:.5}},{key:"getTimeInfo",value:function(){return{elapsed:performance.now()-this.startTime,beat:this.currentBeat,bar:this.currentBar,beatInBar:this.currentBeat%this.timeSignature[0],beatProgress:this.beatProgress,barProgress:this.barProgress,subdivisions:Dt({},this.subdivisions),bpm:this.bpm,beatDuration:this.beatDuration,timeSignature:a(this.timeSignature),intensity:this.intensity,groove:this.groove,pattern:this.currentPattern,nextBeatIn:this.nextBeatTime-performance.now(),accent:this.getAccent(this.currentBeat%this.timeSignature[0])}}},{key:"setBPM",value:function(t){this.bpm=Math.max(20,Math.min(360,t)),this.beatDuration=6e4/this.bpm,this.barDuration=this.beatDuration*this.timeSignature[0],this.emit("tempoChange",{bpm:this.bpm})}},{key:"setTimeSignature",value:function(t,e){this.timeSignature=[t,e],this.barDuration=this.beatDuration*t,this.emit("timeSignatureChange",{timeSignature:this.timeSignature})}},{key:"setPattern",value:function(t){if(this.patterns.has(t)){var e=this.patterns.get(t);this.currentPattern=t,e.timeSignature&&this.setTimeSignature.apply(this,a(e.timeSignature)),void 0!==e.groove&&(this.groove=e.groove),this.emit("patternChange",{pattern:t})}}},{key:"onBeatCallback",value:function(t){var e=this;return this.beatCallbacks.add(t),function(){return e.beatCallbacks.delete(t)}}},{key:"onBarCallback",value:function(t){var e=this;return this.barCallbacks.add(t),function(){return e.barCallbacks.delete(t)}}},{key:"emit",value:function(t,e){this.listeners.has(t)&&this.listeners.get(t).forEach(function(t){return t(e)})}},{key:"on",value:function(t,e){var i=this;return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e),function(){i.listeners.has(t)&&i.listeners.get(t).delete(e)}}},{key:"syncToAudio",value:function(t,e){this.audioSync={context:t,source:e}}},{key:"getAdapter",value:function(){var t=this;return{getTimeInfo:function(){return t.getTimeInfo()},isOnBeat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return t.beatProgress<e||t.beatProgress>1-e},isOnSubdivision:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=t.subdivisions[e]||0;return n<i||n>1-i},getBeatSync:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"linear",a=t.beatProgress;switch(n){case"ease":a=.5-Math.cos(a*Math.PI)/2;break;case"bounce":a=Math.abs(Math.sin(a*Math.PI));break;case"pulse":a=Math.pow(Math.sin(a*Math.PI),2)}return e+(i-e)*a},getAccentedValue:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e*(1+(t.getAccent(t.currentBeat%t.timeSignature[0])-.5)*i)},onBeat:function(e){return t.onBeatCallback(e)},onBar:function(e){return t.onBarCallback(e)},beatsToMs:function(e){return e*t.beatDuration},msToBeats:function(e){return e/t.beatDuration},isPlaying:function(){return t.isPlaying},getBPM:function(){return t.bpm},getPattern:function(){return t.currentPattern}}}}])}());const _t=qt;var Gt=function(){return f(function t(){u(this,t),this.enabled=!1,this.adapter=null,this.subsystemConfigs=new Map,this.activeModulations=new Map},[{key:"initialize",value:function(){this.adapter=_t.getAdapter(),this.enabled=!0,this.adapter.onBeat(this.handleBeat.bind(this)),this.adapter.onBar(this.handleBar.bind(this))}},{key:"updateBPM",value:function(t){if(t>=60&&t<=220){if(window.rhythmManuallyStoppedForCurrentAudio)return;if(!_t.isRunning)return this.start(t,"straight"),void(window.rhythmSyncVisualizer&&!window.rhythmSyncVisualizer.state.active&&window.rhythmSyncVisualizer.start());_t.setBPM(t)}}},{key:"registerConfig",value:function(t,e,i){if(i.rhythm&&i.rhythm.enabled){var n="".concat(t,":").concat(e);this.subsystemConfigs.set(n,{type:t,name:e,rhythmConfig:i.rhythm,originalConfig:i})}}},{key:"applyGestureRhythm",value:function(t,e,i,n){var a,r,s;if(!this.enabled||null===(a=t.rhythm)||void 0===a||!a.enabled)return{};this.adapter.getTimeInfo();var o=t.rhythm,h={};if(o.amplitudeSync){var u=o.amplitudeSync,c=this.adapter.getBeatSync(u.offBeat||.8,u.onBeat||1.5,u.curve||"linear");h.amplitudeMultiplier=c}if(o.wobbleSync){var l=o.wobbleSync;this.adapter.isOnSubdivision(l.subdivision,.1)?h.wobbleMultiplier=1+l.intensity:h.wobbleMultiplier=1}if(null!==(r=o.accentResponse)&&void 0!==r&&r.enabled){var f=this.adapter.getAccentedValue(1,o.accentResponse.multiplier||1.5);h.accentMultiplier=f}var v=this.adapter.getPattern();return v&&null!==(s=o.patternOverrides)&&void 0!==s&&s[v]&&Object.assign(h,o.patternOverrides[v]),h}},{key:"applyParticleRhythm",value:function(t,e){var i,n;if(!this.enabled||null===(i=t.rhythm)||void 0===i||!i.enabled)return{};var a=this.adapter.getTimeInfo(),r=t.rhythm,s={};if(r.particleEmission){var o=r.particleEmission;"beat"===o.syncMode&&this.adapter.isOnBeat(.1)?s.emitBurst=o.burstSize||3:void 0!==o.offBeatRate&&(s.emissionRate=o.offBeatRate)}if(r.glowSync){var h=r.glowSync,u=this.adapter.getBeatSync(h.intensityRange[0]||1,h.intensityRange[1]||2,"pulse");s.glowIntensity=u}if("bars"===(null===(n=r.breathSync)||void 0===n?void 0:n.mode)){var c=r.breathSync,l=a.bar%c.barsPerBreath/c.barsPerBreath;s.breathPhase=l*Math.PI*2}return s}},{key:"applyBehaviorRhythm",value:function(t,e,i){var n;if(!this.enabled||null===(n=t.rhythm)||void 0===n||!n.enabled)return{};var a=this.adapter.getTimeInfo(),r=t.rhythm,s={};if(r.glitchTiming){var o=r.glitchTiming;if(this.adapter.isOnSubdivision(o.subdivision,.05)&&Math.random()<o.probability){var h=this.adapter.isOnBeat()?o.intensityOnBeat:o.intensityOffBeat;s.triggerGlitch=!0,s.glitchIntensity=h}}if(r.orbitRhythm){var u=r.orbitRhythm;"tempo"===u.baseSpeed&&(s.speedMultiplier=this.adapter.getBPM()/120),u.beatAcceleration&&this.adapter.isOnBeat(.1)&&(s.speedBoost=u.beatAcceleration),u.barReset&&0===a.beatInBar&&(s.resetOrbit=!0)}if(r.stutterSync){var c,l=r.stutterSync,f=this.adapter.getPattern();if(f&&null!==(c=l.patterns)&&void 0!==c&&c[f]){var v=l.patterns[f];v.freezeOnDrop&&2===a.beatInBar?(s.freeze=!0,s.freezeDuration=v.dropDuration):v.randomFreeze&&Math.random()<v.randomFreeze&&(s.freeze=!0,s.freezeDuration=v.duration)}}return s}},{key:"handleBeat",value:function(t){this.lastBeatInfo=t}},{key:"handleBar",value:function(t){this.lastBarInfo=t}},{key:"getMusicalDuration",value:function(t,e){if(!this.enabled||null==t||!t.durationSync)return e;var i=t.durationSync;return"bars"===i.mode?this.adapter.beatsToMs(4*i.bars):"beats"===i.mode?this.adapter.beatsToMs(i.beats):e}},{key:"isEnabled",value:function(){return this.enabled&&this.adapter.isPlaying()}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:120,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"straight";t&&_t.setBPM(t),e&&_t.setPattern(e),_t.start(),this.enabled=!0}},{key:"stop",value:function(){_t.stop(),this.enabled=!1,this.bpmLocked=!1,this.lockedBPM=null}},{key:"setPattern",value:function(t){_t.setPattern(t)}},{key:"setBPM",value:function(t){_t.setBPM(t),this.bpmLocked&&(this.lockedBPM=t)}},{key:"resampleBPM",value:function(){this.bpmLocked=!1,this.lockedBPM=null}},{key:"setTimeSignature",value:function(t){this.timeSignature=t;var e=document.getElementById("time-sig-display");e&&(e.textContent=t),"3/4"===t&&_t.getPattern()}},{key:"syncToAudio",value:function(t,e){_t.syncToAudio(t,e)}}])}();const Lt=new Gt;function Vt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Ht(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Vt(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Vt(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function Xt(t,e,i,n,a,r){var s;if(i&&i.type&&!(n>=1)){t.gestureData||(t.gestureData={originalVx:t.vx,originalVy:t.vy,initialX:t.x,initialY:t.y,startAngle:Math.atan2(t.y-r,t.x-a),startRadius:Math.sqrt(Math.pow(t.x-a,2)+Math.pow(t.y-r,2))});var o=(0,It.getGesture)(i.type);if(o){var h=i;if(Lt.isEnabled()&&null!==(s=o.rhythm)&&void 0!==s&&s.enabled){var u=Lt.applyGestureRhythm(o,t,n,e);h=Ht(Ht({},i),{},{amplitude:(i.amplitude||1)*(u.amplitudeMultiplier||1)*(u.accentMultiplier||1),wobbleAmount:(i.wobbleAmount||0)*(u.wobbleMultiplier||1),rhythmModulation:u})}o.apply&&o.apply(t,n,h,e,a,r),n>=.99&&o.cleanup&&(o.cleanup(t),t.gestureData=null)}}}const Yt=function(){return f(function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ambient",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;u(this,t);var o=Math.random();this.z=o<1/13?.5+.5*Math.random():.9*Math.random()-1;var h=this.z>0?(20+20*Math.random())*a:3*a,c=Math.random()*Math.PI*2;this.x=e+Math.cos(c)*h,this.y=i+Math.sin(c)*h,this.vx=0,this.vy=0,this.vz=0,this.life=0,this.maxLife=1,this.lifeDecay=.01,this.fadeInTime=.15,this.fadeOutTime=.3,this.isFadingOut=!1,this.age=0,this.scaleFactor=a,this.particleSizeMultiplier=r,this.size=(4+6*Math.random())*a*r,this.baseSize=this.size,this.emotionColors=s,this.color="#ffffff",this.opacity=1,this.hasGlow=Math.random()<.333,this.glowSizeMultiplier=this.hasGlow?1.33+.33*Math.random():0,this.isCellShaded=Math.random()<.333,this.baseOpacity=.3+.4*Math.random(),this.cachedColors=new Map,this.lastColor=null,this.lastOpacity=-1,this.behavior=n,this.behaviorData={},this.gestureData={initialX:e,initialY:i},Et(this,n)},[{key:"update",value:function(t,e,i){var n,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=Math.min(t,50)/16.67,o=a&&a.type&&r>0&&(n=a.type,(0,It.isOverrideGesture)(n));o?this.applyGestureMotion(a,r,s,e,i):"falling"===this.gestureBehavior?Tt(this,"falling",s,e,i):"radiant"===this.gestureBehavior?Tt(this,"radiant",s,e,i):(Tt(this,this.behavior,s,e,i),a&&r>0&&this.applyGestureMotion(a,r,s,e,i)),o||(this.x+=this.vx*s,this.y+=this.vy*s);var h=2*e,u=2*i,c=20;this.x-this.size<c?(this.x=c+this.size,this.vx=.5*Math.abs(this.vx)):this.x+this.size>h-c&&(this.x=h-c-this.size,this.vx=.5*-Math.abs(this.vx)),this.y-this.size<c?(this.y=c+this.size,this.vy=.5*Math.abs(this.vy)):this.y+this.size>u-c&&(this.y=u-c-this.size,this.vy=.5*-Math.abs(this.vy)),this.age+=this.lifeDecay*s,this.age<this.fadeInTime?this.life=this.age/this.fadeInTime:this.age<1-this.fadeOutTime?this.life=1:(this.life=(1-this.age)/this.fadeOutTime,this.isFadingOut=!0,"popcorn"===this.behavior&&(this.size=this.baseSize*(.5+.5*this.life))),this.life=Math.max(0,Math.min(1,this.life)),this.opacity=this.easeInOutCubic(this.life),"burst"===this.behavior&&this.behaviorData&&this.life<this.behaviorData.fadeStart&&(this.size=this.baseSize*(this.life/this.behaviorData.fadeStart))}},{key:"applyUndertoneModifier",value:function(t,e){}},{key:"applyGestureMotion",value:function(t,e,i,n,a){Xt(this,i,t,e,n,a)}},{key:"isOutOfBounds",value:function(t,e){return this.x<-50||this.x>t+50||this.y<-50||this.y>e+50}},{key:"isAlive",value:function(){return this.life>0}},{key:"setOutwardVelocity",value:function(t){if(this.behaviorData&&void 0!==this.behaviorData.outwardSpeed){var e=this.behaviorData.outwardSpeed;this.vx=Math.cos(t)*e,this.vy=Math.sin(t)*e+(this.behaviorData.upwardBias||0)}}},{key:"getDepthAdjustedSize",value:function(){var t=1+.2*this.z;return this.size*t}},{key:"getState",value:function(){return{position:{x:this.x,y:this.y,z:this.z},velocity:{x:this.vx,y:this.vy,z:this.vz},life:this.life,behavior:this.behavior,size:this.size,opacity:this.opacity}}},{key:"reset",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ambient",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=Math.random();this.z=s<1/13?.5+.5*Math.random():.9*Math.random()-1;var o=this.z>0?(20+20*Math.random())*n:3*n,h=Math.random()*Math.PI*2;if(this.x=t+Math.cos(h)*o,this.y=e+Math.sin(h)*o,this.vx=0,this.vy=0,this.vz=0,this.life=0,this.age=0,this.scaleFactor=n,this.particleSizeMultiplier=a,this.size=(4+6*Math.random())*n*a,this.baseSize=this.size,this.emotionColors=r,this.cachedColors.clear(),this.opacity=0,this.isFadingOut=!1,this.baseOpacity=.3+.4*Math.random(),this.color="#ffffff",this.behavior=i,this.gestureData=null,this.behaviorData)for(var u in this.behaviorData)delete this.behaviorData[u];else this.behaviorData={};Et(this,i)}},{key:"getCachedColor",value:function(t,e){var i=Math.round(100*e)/100,n="".concat(t,"_").concat(i);return this.cachedColors.has(n)||this.cachedColors.set(n,this.hexToRgba(t,i)),this.cachedColors.get(n)}},{key:"hexToRgba",value:function(t,e){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?"rgba(".concat(parseInt(i[1],16),", ").concat(parseInt(i[2],16),", ").concat(parseInt(i[3],16),", ").concat(e,")"):"rgba(255, 255, 255, ".concat(e,")")}},{key:"easeInOutCubic",value:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}},{key:"render",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ffffff";if(!(this.life<=0)&&isFinite(this.x)&&isFinite(this.y)){var i=this.x,n=this.y,a=Math.max(.1,this.size),r=this.tempColor||this.color||e;if(t.save(),this.isCellShaded){t.strokeStyle=this.getCachedColor(r,.9*this.opacity),t.lineWidth=2,t.beginPath(),t.arc(i,n,a,0,2*Math.PI),t.stroke();var s=Math.floor(3*this.opacity)/3;t.fillStyle=this.getCachedColor(r,s*(this.baseOpacity||.5)*.5),t.beginPath(),t.arc(i,n,Math.max(.1,a-1),0,2*Math.PI),t.fill(),s>.5&&(t.fillStyle=this.getCachedColor("#FFFFFF",.3),t.beginPath(),t.arc(i-.3*a,n-.3*a,.3*a,0,2*Math.PI),t.fill())}else{var o=t.createRadialGradient(i,n,0,i,n,a);if(o.addColorStop(0,this.getCachedColor(r,this.opacity*(this.baseOpacity||.5))),o.addColorStop(.5,this.getCachedColor(r,this.opacity*(this.baseOpacity||.5)*.5)),o.addColorStop(1,this.getCachedColor(r,0)),t.fillStyle=o,t.beginPath(),t.arc(i,n,a,0,2*Math.PI),t.fill(),this.hasGlow&&this.glowSizeMultiplier>0){var h=a*this.glowSizeMultiplier,u=t.createRadialGradient(i,n,.5*a,i,n,h),c=Math.max(.3,this.opacity),l=Math.min(1,this.glowSizeMultiplier/3);u.addColorStop(0,this.getCachedColor(r,Math.max(.5,.8*c)*l)),u.addColorStop(.25,this.getCachedColor(r,Math.max(.3,.6*c)*l)),u.addColorStop(.5,this.getCachedColor(r,Math.max(.2,.4*c)*l)),u.addColorStop(.75,this.getCachedColor(r,Math.max(.1,.2*c)*l)),u.addColorStop(1,this.getCachedColor(r,0)),t.save(),t.globalCompositeOperation="screen",t.fillStyle=u,t.beginPath(),t.arc(i,n,h,0,2*Math.PI),t.fill(),t.restore()}}t.restore()}}}])}();function Ut(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Nt(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Nt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function Nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}const Wt=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;u(this,t),this.errorBoundary=i,this.maxParticles=e,this.absoluteMaxParticles=2*e,this.particles=[],this.pool=[],this.poolSize=Math.min(e,50),this.totalParticlesCreated=0,this.totalParticlesDestroyed=0,this.stateChangeCount=0,this.lastMemoryCheck=Date.now(),this.lastLeakedCount=0,this.spawnAccumulator=0,this.particleCount=0,this.poolHits=0,this.poolMisses=0,this.cleanupTimer=0,this.cleanupInterval=5e3,this.initializePool()},[{key:"initializePool",value:function(){this.pool=[]}},{key:"getParticleFromPool",value:function(t,e,i){var n;return this.pool.length>0?((n=this.pool.pop()).reset(t,e,i,this.scaleFactor||1,this.particleSizeMultiplier||1,this.currentEmotionColors),this.poolHits++):(n=new Yt(t,e,i,this.scaleFactor||1,this.particleSizeMultiplier||1,this.currentEmotionColors),this.poolMisses++,this.totalParticlesCreated++),n.emotion=this.currentEmotion,this.gestureBehavior&&(n.gestureBehavior=this.gestureBehavior),n}},{key:"returnParticleToPool",value:function(t){if(this.pool.length<this.poolSize){if(t.cachedGradient=null,t.cachedGradientKey=null,t.behaviorData)for(var e in t.behaviorData)delete t.behaviorData[e];this.pool.push(t)}else this.totalParticlesDestroyed++}},{key:"spawn",value:function(t,e,i,n,a,r){var s=this,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:10,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,v=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null;if(this.scaleFactor=c,this.particleSizeMultiplier=l,this.errorBoundary)return this.errorBoundary.wrap(function(){s.M(t,e,i,n,a,r,o,h,u,f,v)},"particle-spawn")();this.M(t,e,i,n,a,r,o,h,u,f,v)}},{key:"resetAccumulator",value:function(){this.spawnAccumulator=0}},{key:"_spawn",value:function(t,e,i,n,a,s,o){var h=this,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:10,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null;this.currentEmotion=e,"excited"!==e||this.S||(this.S=!0,setTimeout(function(){h.S=!1},5e3)),this.baseEmotionColors=l,this.currentUndertone=f,this.currentEmotionColors=l&&f?function(t,e){return t&&Array.isArray(t)&&e&&"clear"!==e?t.map(function(t){return"string"==typeof t?j(t,e):t&&"object"===(0,r.A)(t)&&t.color?g(g({},t),{},{color:j(t.color,e)}):t}):t}(l,f):l;var v=i;if(Lt.isEnabled()){var d=U(e);if(d){var p=Lt.applyParticleRhythm(d,this);if(p.emitBurst)for(var y=0;y<p.emitBurst&&this.particles.length<c;y++)this.spawnSingleParticle(t,n,a);void 0!==p.emissionRate&&(v*=p.emissionRate)}}if(null===o){if(!this.skipSpawnThisFrame){for(;this.particles.length<u&&this.particles.length<this.maxParticles;)this.spawnSingleParticle(t,n,a);if(!(this.particles.length>=c||v<=0)){var m=Math.min(s,50),b=v/1e3;for(this.spawnAccumulator+=b*m,this.spawnAccumulator=Math.min(this.spawnAccumulator,3);this.spawnAccumulator>=1&&this.particles.length<c;)this.spawnSingleParticle(t,n,a),this.spawnAccumulator-=1}}}else for(var M=0;M<o&&this.particles.length<this.maxParticles;M++)this.spawnSingleParticle(t,n,a)}},{key:"spawnSingleParticle",value:function(t,e,i){if(!(this.particles.length>=this.absoluteMaxParticles)){var n=this.getSpawnPosition(t,e,i),a=this.clampToCanvas(n.x,n.y,e,i);n.x=a.x,n.y=a.y;var r=this.getParticleFromPool(n.x,n.y,t);"meditation_swirl"===t&&n.palmCenter&&(r.palmCenter=n.palmCenter,r.swirlAngle=n.swirlAngle),this.particles.push(r),this.particleCount++}}},{key:"getSpawnPosition",value:function(t,e,i){var n=Math.min(2*e,2*i)/12,a=2.5*n,r=1.1*a,s=Math.min(1.5*a,e-30,i-30);switch(t){case"ambient":case"resting":var o=Math.random()*Math.PI*2,h=.9*a;return{x:e+Math.cos(o)*h,y:i+Math.sin(o)*h,angle:o};case"rising":case"falling":var u=Math.random()*Math.PI*2,c=r+Math.random()*(s-r);return{x:e+Math.cos(u)*c,y:i+Math.sin(u)*c};case"aggressive":var l=Math.random()*Math.PI*2,f=a+Math.random()*n;return{x:e+Math.cos(l)*f,y:i+Math.sin(l)*f};case"scattering":default:return{x:e,y:i};case"burst":var v=Math.random()*Math.PI*2;if("suspicion"===this.currentEmotion){var d=1.5*n;return{x:e+Math.cos(v)*d,y:i+Math.sin(v)*d}}if("surprise"===this.currentEmotion){var p=1.2*n;return{x:e+Math.cos(v)*p,y:i+Math.sin(v)*p}}return{x:e,y:i};case"repelling":var y=Math.random()*Math.PI*2,m=.9*a;return{x:e+Math.cos(y)*m,y:i+Math.sin(y)*m};case"orbiting":var g=Math.random()*Math.PI*2,b=1.2*a+Math.random()*a*.5;return{x:e+Math.cos(g)*b,y:i+Math.sin(g)*b}}}},{key:"clampToCanvas",value:function(t,e,i,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,r=2*i,s=2*n;return{x:Math.max(a,Math.min(r-a,t)),y:Math.max(a,Math.min(s-a,e))}}},{key:"update",value:function(t,e,i){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(this.errorBoundary)return this.errorBoundary.wrap(function(t,e,i,a,r,s){return n.O(t,e,i,a,r,s)},"particle-update")(t,e,i,a,r,s);this.O(t,e,i,a,r,s)}},{key:"_update",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(this.cleanupTimer+=t,this.cleanupTimer>=this.cleanupInterval&&(this.performCleanup(),this.cleanupTimer=0),Date.now()-this.lastMemoryCheck>3e4){var s=this.totalParticlesCreated-this.totalParticlesDestroyed;s>200&&s>this.lastLeakedCount+50&&(this.lastLeakedCount=s),this.lastMemoryCheck=Date.now()}for(var o=this.particles.length-1;o>=0;o--){var h=this.particles[o];h.update(t,e,i,r,n,a),h.isAlive()||this.removeParticle(o)}for(;this.particles.length>this.maxParticles;)this.removeParticle(0)}},{key:"setGestureBehavior",value:function(t,e){this.gestureBehavior=e?t:null,e?this.particles.forEach(function(e){e.gestureBehavior=t}):this.particles.forEach(function(t){t.gestureBehavior=null})}},{key:"removeParticle",value:function(t){if(t>=0&&t<this.particles.length){var e=this.particles.splice(t,1)[0];e.cachedGradient=null,e.cachedGradientKey=null,this.returnParticleToPool(e),this.particleCount=Math.max(0,this.particleCount-1)}}},{key:"render",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ffffff",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.errorBoundary)return this.errorBoundary.wrap(function(){e.j(t,i,n)},"particle-render")();this.j(t,i,n)}},{key:"renderBackground",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ffffff",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.errorBoundary)return this.errorBoundary.wrap(function(){e.F(t,i,!1,n)},"particle-render-bg")();this.F(t,i,!1,n)}},{key:"renderForeground",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ffffff",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.errorBoundary)return this.errorBoundary.wrap(function(){e.F(t,i,!0,n)},"particle-render-fg")();this.F(t,i,!0,n)}},{key:"_renderLayer",value:function(t,e,i){var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=[],s=t.canvas.width,o=t.canvas.height,h=Ut(this.particles);try{for(h.s();!(n=h.n()).done;){var u=n.value;u.z>=0===i&&(u.x<-50||u.x>s+50||u.y<-50||u.y>o+50||u.life<=0||r.push(u))}}catch(t){h.e(t)}finally{h.f()}r.sort(function(t,e){return t.isCellShaded!==e.isCellShaded?t.isCellShaded?-1:1:t.hasGlow!==e.hasGlow?t.hasGlow?-1:1:0}),this.B(t,r,e,a)}},{key:"_render",value:function(t,e){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=[],r=t.canvas.width,s=t.canvas.height,o=Ut(this.particles);try{for(o.s();!(i=o.n()).done;){var h=i.value;h.x<-50||h.x>r+50||h.y<-50||h.y>s+50||(h.life<=0||a.push(h))}}catch(t){o.e(t)}finally{o.f()}a.sort(function(t,i){if(t.isCellShaded!==i.isCellShaded)return t.isCellShaded?-1:1;if(t.hasGlow!==i.hasGlow)return t.hasGlow?-1:1;var n=t.color||e,a=i.color||e;return n!==a?n<a?-1:1:0}),this.B(t,a,e,n)}},{key:"_renderParticles",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t.save();var a,r=null,s=Ut(e);try{for(s.s();!(a=s.n()).done;){var o=a.value;if(o.isCellShaded)o.render(t,i),r=null;else{var h=o.color||i;if(h!==r&&(t.fillStyle=h,r=h),!isFinite(o.x)||!isFinite(o.y))continue;var u=o.getDepthAdjustedSize?o.getDepthAdjustedSize():o.size,c=Math.max(.1,u),l=1;if(n&&n.fireflyEffect){var f=(.01*o.x+.01*o.y+.1*o.size)%(2*Math.PI),v=n.fireflyTime||.001*Date.now(),d=n.particleGlow||2;l=.3+Math.max(0,Math.sin(3*v+f))*d}if(n&&n.flickerEffect){var p=(.02*o.x+.02*o.y)%(2*Math.PI),y=n.flickerTime||.001*Date.now(),m=n.particleGlow||2;l=.5+Math.sin(12*y+p)*m*.5}if(n&&n.shimmerEffect){var g=o.x-t.canvas.width/2,b=o.y-t.canvas.height/2,M=Math.sqrt(g*g+b*b)/200,k=n.shimmerTime||.001*Date.now(),w=n.shimmerWave||0,S=n.particleGlow||1.2;l=1+.15*Math.sin(3*k-M+w)*S}if(n&&n.glowEffect){n.glowEnvelope;var O=n.glowProgress||0,j=n.particleGlow||2,F=o.x-t.canvas.width/2,A=o.y-t.canvas.height/2,x=Math.sqrt(F*F+A*A)/300,B=Math.min(.3*x,.5),C=Math.max(0,(O-B)/(1-B)),P=Math.sin(C*Math.PI);o.C||(o.C={hasGlow:o.hasGlow,glowSizeMultiplier:o.glowSizeMultiplier||0}),o.hasGlow=!0,o.glowSizeMultiplier=Math.max(3,o.C.glowSizeMultiplier)+P*j*3;tt("safeSize"),O>=.99&&o.C&&(o.hasGlow=o.C.hasGlow,o.glowSizeMultiplier=o.C.glowSizeMultiplier,delete o.C)}if(o.hasGlow||l>1){var E=Math.max(.1,c*(o.glowSizeMultiplier||1.5)*l);t.globalAlpha=.15*o.opacity*l,t.beginPath(),t.arc(o.x,o.y,E,0,2*Math.PI),t.fill(),t.globalAlpha=.25*o.opacity*l,t.beginPath(),t.arc(o.x,o.y,.6*E,0,2*Math.PI),t.fill()}t.globalAlpha=o.opacity*(o.baseOpacity||.5)*.6*Math.min(2,l),t.beginPath(),t.arc(o.x,o.y,c,0,2*Math.PI),t.fill()}}}catch(t){s.e(t)}finally{s.f()}t.restore()}},{key:"clear",value:function(){for(this.stateChangeCount++;this.particles.length>0;){var t=this.particles.pop();if(t.cachedColors&&t.cachedColors.clear(),t.behaviorData)for(var e in t.behaviorData)delete t.behaviorData[e];this.pool.length<this.poolSize&&!this.pool.includes(t)&&this.pool.push(t)}if(this.particles.length=0,this.particleCount=0,this.spawnAccumulator=0,this.pool.length>this.poolSize){var i=this.pool.length-this.poolSize;this.pool.splice(this.poolSize,i)}}},{key:"burst",value:function(t,e,i,n){var a=this;if(this.errorBoundary)return this.errorBoundary.wrap(function(){a.P(t,e,i,n)},"particle-burst")();this.P(t,e,i,n)}},{key:"_burst",value:function(t,e,i,n){for(var a=Math.min(t,this.maxParticles-this.particles.length),r=0;r<a;r++)this.spawnSingleParticle(e,i,n)}},{key:"performCleanup",value:function(){if(this.pool.length>this.poolSize)for(var t=this.pool.length-this.poolSize,e=0;e<t;e++){var i=this.pool.pop();i&&(i.cachedGradient=null,i.cachedGradientKey=null,i.behaviorData=null)}var n,a=Ut(this.particles);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.cachedGradient&&r.life<.5&&(r.cachedGradient=null,r.cachedGradientKey=null)}}catch(t){a.e(t)}finally{a.f()}}},{key:"getStats",value:function(){return{activeParticles:this.particles.length,maxParticles:this.maxParticles,poolSize:this.pool.length,poolHits:this.poolHits,poolMisses:this.poolMisses,poolEfficiency:this.poolHits/Math.max(1,this.poolHits+this.poolMisses),spawnAccumulator:this.spawnAccumulator}}},{key:"setMaxParticles",value:function(t){for(this.originalMaxParticles=this.originalMaxParticles||this.maxParticles,this.maxParticles=Math.max(1,t);this.particles.length>this.maxParticles;)this.removeParticle(0)}},{key:"cleanupDeadParticles",value:function(){var t=this.particles.length;this.particles=this.particles.filter(function(t){return t.isAlive()});var e=t-this.particles.length;return this.pool.length>20&&(this.pool.length=20),e}},{key:"getParticlesByBehavior",value:function(t){return this.particles.filter(function(e){return e.behavior===t})}},{key:"validateParticles",value:function(){var t,e=Ut(this.particles);try{for(e.s();!(t=e.n()).done;){var i=t.value;if(!i.isAlive()||i.life<0||i.life>1)return!1}}catch(t){e.e(t)}finally{e.f()}return!0}},{key:"cleanup",value:function(){for(var t=this.particles.length-1;t>=0;t--)this.particles[t].isAlive()||this.removeParticle(t)}},{key:"destroy",value:function(){this.clear(),this.pool.length=0,this.poolHits=0,this.poolMisses=0}}])}();var Qt={none:{speed:1,amplitude:1,intensity:1,smoothness:1,regularity:1},nervous:{speed:1.2,amplitude:.9,intensity:1.1,smoothness:.7,regularity:.6,addFlutter:!0,addMicroShake:!0},confident:{speed:.9,amplitude:1.3,intensity:1.2,smoothness:1.1,regularity:1.2,addPower:!0,addHold:!0},tired:{speed:.7,amplitude:.7,intensity:.8,smoothness:1.3,regularity:.8,addDroop:!0,addPause:!0},intense:{speed:1.3,amplitude:1.2,intensity:1.4,smoothness:.6,regularity:.9,addPulse:!0,addFocus:!0},subdued:{speed:.8,amplitude:.8,intensity:.7,smoothness:1.2,regularity:1.1,addSoftness:!0,addFade:!0}};function Jt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Zt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Jt(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Jt(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const $t=function(){return f(function t(){u(this,t),this.cache=new Map,this.easingCache=new Map,this.preCalculateEasingCurves()},[{key:"preCalculateEasingCurves",value:function(){for(var t=0,e=["linear","ease-in","ease-out","ease-in-out","bounce"];t<e.length;t++){for(var i=e[t],n=new Float32Array(101),a=0;a<=100;a++){var r=a/100;n[a]=this.calculateEasing(r,i)}this.easingCache.set(i,n)}}},{key:"calculateEasing",value:function(t,e){switch(e){case"ease-in":return t*t;case"ease-out":return t*(2-t);case"ease-in-out":return t<.5?2*t*t:(4-2*t)*t-1;case"bounce":return t<.363636?7.5625*t*t:t<.727272?7.5625*(t-=.545454)*t+.75:t<.90909?7.5625*(t-=.818181)*t+.9375:7.5625*(t-=.954545)*t+.984375;default:return t}}},{key:"getEasingValue",value:function(t,e){var i=this.easingCache.get(e);return i?i[Math.min(Math.floor(100*t),100)]:t}},{key:"compose",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="".concat(t,"-").concat(e,"-").concat(i||"none");if(this.cache.has(n))return this.cache.get(n);var a=(0,It.getGesture)(t),r=a?a.config:{duration:500,amplitude:20,easing:"sine"},s=W(e),o=function(t){return t&&""!==t&&Qt[t]||Qt.none}(i),h=this.applyModifiers(r,s,o,t);return this.cache.size>100&&this.cache.clear(),this.cache.set(n,h),h}},{key:"applyModifiers",value:function(t,e,i,n){var a=Zt({},t),r=e.speed*i.speed;if(a.duration=Math.round(t.duration/r),void 0!==a.amplitude&&(a.amplitude=t.amplitude*e.amplitude*i.amplitude),void 0!==a.scaleAmount&&(a.scaleAmount=t.scaleAmount*e.intensity*i.intensity),void 0!==a.scaleTarget){var s=e.amplitude*i.amplitude;a.scaleTarget=1+(t.scaleTarget-1)*s}void 0!==a.glowAmount&&(a.glowAmount=t.glowAmount*e.intensity*i.intensity),void 0!==a.glowPeak&&(a.glowPeak=1+(t.glowPeak-1)*e.intensity*i.intensity),void 0!==a.rotations&&(a.rotations=t.rotations*e.amplitude*i.amplitude),void 0!==a.angle&&(a.angle=t.angle*e.amplitude*i.amplitude),void 0!==a.distance&&(a.distance=t.distance*e.amplitude*i.amplitude);var o=e.smoothness*i.smoothness;return a.smoothness=o,a.easing=this.selectEasing(t.easing,o),a.regularity=e.regularity*i.regularity,a.effects=[],e.addBounce&&a.effects.push("bounce"),e.addGravity&&a.effects.push("gravity"),e.addShake&&a.effects.push("shake"),e.addJitter&&a.effects.push("shake"),e.addPop&&a.effects.push("pop"),e.addRecoil&&a.effects.push("recoil"),e.addWarmth&&a.effects.push("warmth"),e.addFlow&&a.effects.push("flow"),e.addWobble&&a.effects.push("wobble"),e.addVibration&&a.effects.push("vibration"),e.addDrag&&a.effects.push("drag"),e.addWeight&&a.effects.push("weight"),e.addTension&&a.effects.push("tension"),e.addPrecision&&a.effects.push("precision"),i.addFlutter&&a.effects.push("flutter"),i.addMicroShake&&a.effects.push("microShake"),i.addPower&&a.effects.push("power"),i.addHold&&a.effects.push("hold"),i.addDroop&&a.effects.push("droop"),i.addPause&&a.effects.push("pause"),i.addPulse&&a.effects.push("pulse"),i.addFocus&&a.effects.push("focus"),i.addSoftness&&a.effects.push("softness"),i.addFade&&a.effects.push("fade"),this.applyGestureSpecificMods(a,n,e,i),t.particleMotion&&(a.particleMotion=Zt({},t.particleMotion),void 0!==a.particleMotion.strength&&(a.particleMotion.strength*=e.intensity*i.intensity),void 0!==a.particleMotion.frequency&&(a.particleMotion.frequency*=r),void 0!==a.particleMotion.amplitude&&(a.particleMotion.amplitude*=e.amplitude*i.amplitude)),a}},{key:"selectEasing",value:function(t,e){return e<.5?"linear":e<.8?"quad":e<1.2?t:e<1.5?"cubic":"sine"}},{key:"applyGestureSpecificMods",value:function(t,e,i,n){switch(e){case"bounce":i.addShake&&(t.frequency=Math.floor(1.5*t.frequency)),i.addGravity&&(t.amplitude*=.6,t.frequency=1);break;case"pulse":i.addWarmth&&(t.frequency=2,t.glowAmount*=1.5),n.addFlutter&&(t.irregular=!0);break;case"shake":i.addJitter&&(t.frequency*=1.5,t.amplitude*=1.2),i.addShake&&(t.amplitude*=1.5,t.decay=!1);break;case"spin":i.addBounce&&(t.rotations*=1.5),i.addWobble&&(t.wobble=!0)}}},{key:"clearCache",value:function(){this.cache.clear()}}])}(),Kt={name:"zen-vortex",emoji:"🌀",description:"Swirling meditation vortex effect",config:{vortexSpeed:.02,spiralTightness:.15,maxRadius:1.5,lineWidth:2,segments:50,arms:3,fadeStart:.7,baseOpacity:.3,pulseSpeed:.01},state:{rotation:0,pulsePhase:0,intensity:0},shouldActivate:function(t){var e;return"zen"===t.emotion||(null===(e=t.zenTransition)||void 0===e?void 0:e.active)},apply:function(t,e){var i=e.x,n=e.y,a=e.radius,r=e.intensity,s=void 0===r?1:r,o=e.deltaTime,h=void 0===o?16.67:o;this.state.rotation+=this.config.vortexSpeed*(h/16.67),this.state.pulsePhase+=this.config.pulseSpeed*(h/16.67),this.state.intensity=s,t.save();for(var u=0;u<this.config.arms;u++){var c=2*Math.PI/this.config.arms*u;this.drawSpiralArm(t,i,n,a,c)}this.drawMeditationEyes(t,i,n,.6*a,s),t.restore()},drawSpiralArm:function(t,e,i,n,a){t.beginPath();for(var r=1+.1*Math.sin(this.state.pulsePhase),s=0;s<=this.config.segments;s++){var o=s/this.config.segments,h=this.state.rotation+a+o*Math.PI*4,u=o*n*this.config.maxRadius*r,c=e+Math.cos(h)*u,l=i+Math.sin(h)*u;0===s?t.moveTo(c,l):t.lineTo(c,l)}var f=t.createLinearGradient(e-n,i,e+n,i),v=this.config.baseOpacity*this.state.intensity;f.addColorStop(0,"rgba(147, 112, 219, 0)"),f.addColorStop(.3,"rgba(147, 112, 219, ".concat(.5*v,")")),f.addColorStop(this.config.fadeStart,"rgba(147, 112, 219, ".concat(v,")")),f.addColorStop(1,"rgba(147, 112, 219, 0)"),t.strokeStyle=f,t.lineWidth=this.config.lineWidth,t.stroke()},drawMeditationEyes:function(t,e,i,n,a){t.save();var r=.4*n,s=.3*n;t.strokeStyle="rgba(255, 255, 255, ".concat(.8*a,")"),t.lineWidth=2,t.beginPath(),t.arc(e-s,i,r,Math.PI,0,!0),t.stroke(),t.beginPath(),t.arc(e+s,i,r,Math.PI,0,!0),t.stroke(),t.restore()},reset:function(){this.state.rotation=0,this.state.pulsePhase=0,this.state.intensity=0}},te={name:"recording-glow",emoji:"🔴",description:"Pulsating red recording indicator",config:{color:"#FF0000",pulseSpeed:.08,minIntensity:.6,maxIntensity:1,radiusMultiplier:2,gradientStops:[{position:0,opacity:1},{position:.3,opacity:.7},{position:.6,opacity:.4},{position:.85,opacity:.2},{position:1,opacity:0}]},state:{pulsePhase:0,intensity:.8},shouldActivate:function(t){return!0===t.recording},apply:function(t,e){var i=e.deltaTime,n=void 0===i?16.67:i;this.state.pulsePhase+=this.config.pulseSpeed*(n/16.67);var a=(Math.sin(this.state.pulsePhase)+1)/2;return this.state.intensity=this.config.minIntensity+(this.config.maxIntensity-this.config.minIntensity)*a,!0},drawRecordingIndicator:function(t,e,i){t.save();var n=Math.min(e,i),a=Math.floor(.08*n),r=1.5*a,s=1.5*a,o=.3*a;t.fillStyle=this.hexToRgba("#FF0000",this.state.intensity),t.beginPath(),t.arc(r-a,s,o,0,2*Math.PI),t.fill(),t.strokeStyle=this.hexToRgba("#FFFFFF",.8*this.state.intensity),t.lineWidth=3,t.font="bold ".concat(a,"px 'Arial', sans-serif"),t.textAlign="left",t.textBaseline="middle",t.strokeText("REC",r,s),t.fillStyle=this.hexToRgba("#FF0000",this.state.intensity),t.fillText("REC",r,s),t.restore()},hexToRgba:function(t,e){var i=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return"rgba(".concat(i,", ").concat(n,", ").concat(a,", ").concat(e,")")},reset:function(){this.state.pulsePhase=0,this.state.intensity=0}},ee={name:"speaking-pulse",emoji:"🗣️",description:"Audio-reactive pulse when speaking",config:{scaleMultiplier:.15,smoothing:.1,minPulse:.02,colorShift:!0,ringEffect:!0},state:{audioLevel:0,smoothedLevel:0,rings:[]},shouldActivate:function(t){return!0===t.speaking},apply:function(t,e){var i=e.x,n=e.y,a=e.radius,r=e.audioLevel,s=void 0===r?0:r,o=e.deltaTime,h=void 0===o?16.67:o;this.state.smoothedLevel+=(s-this.state.smoothedLevel)*this.config.smoothing,s>.5&&this.state.audioLevel<=.5&&this.state.rings.push({radius:a,opacity:.5,speed:2}),this.config.ringEffect&&this.drawRings(t,i,n,h),this.state.audioLevel=s},drawRings:function(t,e,i,n){t.save(),t.strokeStyle="rgba(100, 200, 255, 0.5)",t.lineWidth=2;for(var a=this.state.rings.length-1;a>=0;a--){var r=this.state.rings[a];r.radius+=r.speed*(n/16.67),r.opacity-=n/16.67*.02,r.opacity<=0?this.state.rings.splice(a,1):(t.globalAlpha=r.opacity,t.beginPath(),t.arc(e,i,r.radius,0,2*Math.PI),t.stroke())}t.restore()},getScaleModifier:function(){return 1+this.state.smoothedLevel*this.config.scaleMultiplier}},ie={name:"sleeping",emoji:"😴",description:"Sleeping with closed eyes and Z particles",config:{eyeClosedScale:.1,breathingDepth:.15,breathingRate:.8,zParticleInterval:2e3,zDriftSpeed:1,zFadeSpeed:.01,orbDimming:.3,glowDimming:.2},state:{lastZSpawn:0,zParticles:[]},shouldActivate:function(t){return!0===t.sleeping||"resting"===t.emotion},apply:function(t,e){var i=e.x,n=e.y,a=e.radius,r=e.deltaTime,s=void 0===r?16.67:r,o=Date.now();if(o-this.state.lastZSpawn>this.config.zParticleInterval){var h=[100,200,300,400,500,600,700,800,900],u=h[Math.floor(Math.random()*h.length)];this.state.zParticles.push({x:i+a,y:n-a,opacity:1,size:12+8*Math.random(),drift:.5*Math.random()-.25,weight:u,rotation:30*Math.random()-15}),this.state.lastZSpawn=o}this.drawZParticles(t,s)},drawZParticles:function(t,e){t.save(),t.textAlign="center",t.textBaseline="middle";for(var i=this.state.zParticles.length-1;i>=0;i--){var n=this.state.zParticles[i];n.y-=this.config.zDriftSpeed*(e/16.67),n.x+=n.drift*(e/16.67),n.opacity-=this.config.zFadeSpeed*(e/16.67),n.rotation+=e/16.67*.5,n.opacity<=0?this.state.zParticles.splice(i,1):(t.save(),t.translate(n.x,n.y),t.rotate(n.rotation*Math.PI/180),t.globalAlpha=.7*n.opacity,t.fillStyle="rgba(255, 255, 255, 0.9)",t.font="".concat(n.weight," ").concat(n.size,"px 'Poppins', sans-serif"),t.fillText("Z",0,0),t.shadowBlur=3,t.shadowColor="rgba(147, 112, 219, 0.5)",t.fillText("Z",0,0),t.restore())}t.restore()},getEyeOpenness:function(){return this.config.eyeClosedScale},getBreathingModifiers:function(){return{rate:this.config.breathingRate,depth:this.config.breathingDepth}},getDimmingValues:function(){return{orbDimming:this.config.orbDimming,glowDimming:this.config.glowDimming}}},ne={name:"suspicion-scan",emoji:"🔍",description:"Suspicious scanning and squinting",config:{squintAmount:.4,scanInterval:5e3,scanDuration:800,scanAngle:45,squintSpeed:.02,pupilShift:.3},state:{currentSquint:0,targetSquint:0,lastScanTime:0,scanPhase:0,scanning:!1},shouldActivate:function(t){return"suspicion"===t.emotion||!0===t.suspicious},apply:function(t,e){e.x,e.y,e.radius;var i=e.deltaTime,n=void 0===i?16.67:i,a=Date.now();this.updateSquint(n),a-this.state.lastScanTime>this.config.scanInterval&&(this.startScan(),this.state.lastScanTime=a),this.state.scanning&&this.updateScan(a,n)},updateSquint:function(t){this.state.targetSquint=this.config.squintAmount;var e=this.state.targetSquint-this.state.currentSquint;Math.abs(e)>.01?this.state.currentSquint+=e*this.config.squintSpeed*(t/16.67):this.state.currentSquint=this.state.targetSquint},startScan:function(){this.state.scanning=!0,this.state.scanStartTime=Date.now(),this.state.scanPhase=-1},updateScan:function(t,e){var i=(t-this.state.scanStartTime)/this.config.scanDuration;i<.33?this.state.scanPhase=-1:i<.66?this.state.scanPhase=1:(i<1||(this.state.scanning=!1),this.state.scanPhase=0)},getEyeModifiers:function(){return{scaleY:1-this.state.currentSquint,scaleX:1+.3*this.state.currentSquint,offsetX:this.state.scanPhase*this.config.pupilShift}},drawScanLines:function(t,e,i,n){if(this.state.scanning){t.save(),t.strokeStyle="rgba(255, 165, 0, 0.3)",t.lineWidth=1,t.setLineDash([5,5]);var a=this.state.scanPhase*(this.config.scanAngle*Math.PI/180),r=e+Math.cos(a)*n*2,s=i+Math.sin(a)*n*.5;t.beginPath(),t.moveTo(e,i),t.lineTo(r,s),t.stroke(),t.restore()}}},ae={name:"gaze-narrowing",emoji:"👁️",description:"Eye narrowing based on gaze proximity",config:{maxHorizontalScale:1.3,maxVerticalScale:.5,smoothing:.1,focusThreshold:.3},state:{currentScaleX:1,currentScaleY:1,targetScaleX:1,targetScaleY:1},shouldActivate:function(t){return t.gazeIntensity>0||t.gazeLocked},apply:function(t,e){var i=e.gazeIntensity,n=void 0===i?0:i,a=e.deltaTime,r=void 0===a?16.67:a;if(n>this.config.focusThreshold){var s=(n-this.config.focusThreshold)/(1-this.config.focusThreshold);this.state.targetScaleX=1+(this.config.maxHorizontalScale-1)*s,this.state.targetScaleY=1-(1-this.config.maxVerticalScale)*s}else this.state.targetScaleX=1,this.state.targetScaleY=1;this.animateScales(r)},animateScales:function(t){var e=this.config.smoothing*(t/16.67),i=this.state.targetScaleX-this.state.currentScaleX;Math.abs(i)>.001&&(this.state.currentScaleX+=i*e);var n=this.state.targetScaleY-this.state.currentScaleY;Math.abs(n)>.001&&(this.state.currentScaleY+=n*e)},getEyeScales:function(){return{scaleX:this.state.currentScaleX,scaleY:this.state.currentScaleY}},drawFocusIndicator:function(t,e,i,n,a){if(!(a<this.config.focusThreshold)){t.save();var r=.5*(a-this.config.focusThreshold);t.strokeStyle="rgba(100, 200, 255, ".concat(r,")"),t.lineWidth=1,t.setLineDash([2,4]);for(var s=0,o=[0,60,120,180,240,300];s<o.length;s++){var h=o[s]*Math.PI/180,u=2*n,c=1.2*n;t.beginPath(),t.moveTo(e+Math.cos(h)*u,i+Math.sin(h)*u),t.lineTo(e+Math.cos(h)*c,i+Math.sin(h)*c),t.stroke()}t.restore()}}};function re(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return se(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?se(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function se(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}const oe={name:"fingerprint",emoji:"👆",description:"Biometric fingerprint pattern for authentication UI",config:{rings:8,ringSpacing:15,lineWidth:1.5,rotationSpeed:.001,pulseSpeed:.02,waveAmplitude:3,waveFrequency:8,breakPoints:5,opacity:.4,scanLineSpeed:.01,scanLineWidth:3,color:"#00CED1",glowColor:"#00FFFF",successColor:"#00FF00",failColor:"#FF0000"},state:{rotation:0,pulsePhase:0,scanPosition:0,scanDirection:1,isScanning:!1,scanResult:null,breaks:[],whorls:[]},shouldActivate:function(t){return!0===t.biometric||!0===t.fingerprint||!0===t.authenticating},initialize:function(){this.state.breaks=[];for(var t=0;t<this.config.rings;t++){for(var e=[],i=0;i<this.config.breakPoints;i++)e.push(Math.random()*Math.PI*2);this.state.breaks.push(e)}this.state.whorls=[{x:.2,y:-.1,strength:.3},{x:-.15,y:.2,strength:.25},{x:0,y:0,strength:.5}]},apply:function(t,e){var i=e.x,n=e.y,a=e.radius,r=e.deltaTime,s=void 0===r?16.67:r,o=e.scanning,h=void 0!==o&&o,u=e.authResult,c=void 0===u?null:u;0===this.state.breaks.length&&this.initialize(),this.state.rotation+=this.config.rotationSpeed*(s/16.67),this.state.pulsePhase+=this.config.pulseSpeed*(s/16.67),(h||this.state.isScanning)&&(this.state.isScanning=!0,this.state.scanPosition+=this.config.scanLineSpeed*this.state.scanDirection*(s/16.67),this.state.scanPosition>1?(this.state.scanPosition=1,this.state.scanDirection=-1):this.state.scanPosition<-1&&(this.state.scanPosition=-1,this.state.scanDirection=1)),t.save(),this.drawFingerprintPattern(t,i,n,a),this.state.isScanning&&this.drawScanLine(t,i,n,a),c&&this.showAuthResult(t,i,n,a,c),t.restore()},drawFingerprintPattern:function(t,e,i,n){for(var a=.1*Math.sin(this.state.pulsePhase)+1,r=0;r<this.config.rings;r++){var s=(r+1)*this.config.ringSpacing*a;if(!(s>2*n)){t.beginPath(),t.strokeStyle=this.config.color,t.lineWidth=this.config.lineWidth,t.globalAlpha=this.config.opacity*(1-r/this.config.rings*.5);for(var o=0;o<2*Math.PI;o+=.05){var h,u=!1,c=re(this.state.breaks[r]||[]);try{for(c.s();!(h=c.n()).done;){var l=h.value;if(Math.abs(o-l)<.1){u=!0;break}}}catch(t){c.e(t)}finally{c.f()}if(u)t.stroke(),t.beginPath();else{var f,v=s,d=o+this.state.rotation,p=re(this.state.whorls);try{for(p.s();!(f=p.n()).done;){var y=f.value,m=e+y.x*n,g=i+y.y*n,b=e+Math.cos(d)*v,M=i+Math.sin(d)*v,k=Math.sqrt(Math.pow(b-m,2)+Math.pow(M-g,2));d+=.5*(Math.exp(-k/(.5*n))*y.strength)}}catch(t){p.e(t)}finally{p.f()}v+=Math.sin(o*this.config.waveFrequency)*this.config.waveAmplitude;var w=e+Math.cos(d)*v,S=i+Math.sin(d)*v;0===o?t.moveTo(w,S):t.lineTo(w,S)}}t.stroke()}}},drawScanLine:function(t,e,i,n){var a=i+this.state.scanPosition*n,r=t.createLinearGradient(e-n,a,e+n,a);r.addColorStop(0,"rgba(0, 255, 255, 0)"),r.addColorStop(.5,this.config.glowColor),r.addColorStop(1,"rgba(0, 255, 255, 0)"),t.strokeStyle=r,t.lineWidth=this.config.scanLineWidth,t.globalAlpha=.8,t.shadowBlur=10,t.shadowColor=this.config.glowColor,t.beginPath(),t.moveTo(e-n,a),t.lineTo(e+n,a),t.stroke(),t.shadowBlur=0},showAuthResult:function(t,e,i,n,a){var r="success"===a?this.config.successColor:this.config.failColor,s="success"===a?"✓ AUTHENTICATED":"✗ ACCESS DENIED";t.fillStyle=r,t.font="bold ".concat(.15*n,"px monospace"),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=.9,t.fillText(s,e,i+1.3*n),t.strokeStyle=r,t.lineWidth=3,t.globalAlpha=.5,t.beginPath(),t.arc(e,i,1.1*n,0,2*Math.PI),t.stroke()},startScan:function(){this.state.isScanning=!0,this.state.scanPosition=-1,this.state.scanDirection=1,this.state.scanResult=null},completeScan:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.state.isScanning=!1,this.state.scanResult=e?"success":"fail",setTimeout(function(){t.state.scanResult=null},2e3)},reset:function(){this.state.rotation=0,this.state.pulsePhase=0,this.state.scanPosition=0,this.state.scanDirection=1,this.state.isScanning=!1,this.state.scanResult=null}};var he=new Map;function ue(t){t.name&&he.set(t.name,t)}function ce(t){return he.get(t)||null}function le(t,e,i){var n=ce(t);return!!n&&(!!n.apply&&(n.apply(e,i),!0))}function fe(t,e){var i=ce(t);return!(!i||!i.shouldActivate)&&i.shouldActivate(e)}ue(Kt),ue(te),ue(ee),ue(ie),ue(ne),ue(ae),ue(oe);const ve=new(function(){return f(function t(){u(this,t),this.noteDurations={whole:4,half:2,quarter:1,eighth:.5,sixteenth:.25,triplet:.333,"dotted-quarter":1.5,"dotted-half":3},this.cache=new Map,this.lastBPM=0,this.prewarmCache()},[{key:"prewarmCache",value:function(){var t=this,e=[{musical:!0,beats:1},{musical:!0,bars:1},{musical:!0,beats:.5},{musical:!0,beats:2}];[60,90,120,140,160,180].forEach(function(i){e.forEach(function(e){var n="".concat(i,"_").concat(JSON.stringify(e)),a=t.toMilliseconds(e,i);t.cache.set(n,a)})})}},{key:"toMilliseconds",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||_t.bpm||120;if("number"==typeof t)return t;if("object"===(0,r.A)(t)&&t.musical){var i=6e4/e;if(void 0!==t.beats)return t.beats*i;if(void 0!==t.bars){var n=_t.timeSignature||[4,4];return t.bars*n[0]*i}if(void 0!==t.subdivision)return(this.noteDurations[t.subdivision]||1)*i}return 1e3}},{key:"toMusical",value:function(t){for(var e=t/(6e4/((arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||_t.bpm||120)),i="quarter",n=Math.abs(e-1),a=0,r=Object.entries(this.noteDurations);a<r.length;a++){var s=y(r[a],2),o=s[0],h=s[1],u=Math.abs(e-h);u<n&&(n=u,i=o)}return{musical:!0,beats:e,bars:e/4,closestSubdivision:i,exact:n<.01}}},{key:"calculatePhases",value:function(t,e){var i=this;if(!t||0===t.length)return[{name:"main",beats:e,start:0,end:1}];var n=t.reduce(function(t,e){return t+(e.beats||1)},0),a=e/n,r=0;return t.map(function(t){var n=(t.beats||1)*a,s=r/e,o=(r+=n)/e;return{name:t.name,beats:n,start:s,end:o,duration:i.toMilliseconds({musical:!0,beats:n})}})}},{key:"getBeatProgress",value:function(){var t=_t.getTimeInfo();return t?t.beatProgress:0}},{key:"getBarProgress",value:function(){var t=_t.getTimeInfo();return t?t.barProgress:0}},{key:"timeToNextBoundary",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"beat",e=_t.getTimeInfo();if(!e)return 100;switch(t){case"beat":default:return e.nextBeatIn;case"bar":var i=e.timeSignature[0];return(i-e.beatInBar)*e.beatDuration;case"phrase":return(4-(e.bar||0)%4)*i*e.beatDuration}}},{key:"quantize",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"eighth",i=6e4/(_t.bpm||120),n=(this.noteDurations[e]||1)*i;return Math.round(t/n)*n}},{key:"isOnBoundary",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"beat",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=this.timeToNextBoundary(t),n=_t.getTimeInfo();return!!n&&(i<e||n.beatDuration-i<e)}},{key:"getTempoAdaptation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:120,e=(_t.bpm||120)/t;return{speed:e,energy:Math.min(2,Math.max(.5,e)),smoothness:e<.8?1.2:e>1.5?.8:1,intensity:e>1.3?1.2:e<.7?.8:1}}}])}());var de=function(){return f(function t(e){u(this,t),this.renderer=e,this.activeGestures=new Map,this.gestureQueue=[],this.scaleFactor=e.scaleFactor||1,this.gestureAnimations={bounce:{active:!1,progress:0,params:{}},pulse:{active:!1,progress:0,params:{}},shake:{active:!1,progress:0,params:{}},spin:{active:!1,progress:0,params:{}},nod:{active:!1,progress:0,params:{}},tilt:{active:!1,progress:0,params:{}},expand:{active:!1,progress:0,params:{}},contract:{active:!1,progress:0,params:{}},flash:{active:!1,progress:0,params:{}},drift:{active:!1,progress:0,params:{}},stretch:{active:!1,progress:0,params:{}},glow:{active:!1,progress:0,params:{}},flicker:{active:!1,progress:0,params:{}},vibrate:{active:!1,progress:0,params:{}},orbital:{active:!1,progress:0,params:{}},hula:{active:!1,progress:0,params:{}},wave:{active:!1,progress:0,params:{}},breathe:{active:!1,progress:0,params:{}},morph:{active:!1,progress:0,params:{}},slowBlink:{active:!1,progress:0,params:{}},look:{active:!1,progress:0,params:{}},settle:{active:!1,progress:0,params:{}},breathIn:{active:!1,progress:0,params:{}},breathOut:{active:!1,progress:0,params:{}},breathHold:{active:!1,progress:0,params:{}},breathHoldEmpty:{active:!1,progress:0,params:{}},jump:{active:!1,progress:0,params:{}},sway:{active:!1,progress:0,params:{}},float:{active:!1,progress:0,params:{}},sparkle:{active:!1,progress:0,params:{}},shimmer:{active:!1,progress:0,params:{}},wiggle:{active:!1,progress:0,params:{}},groove:{active:!1,progress:0,params:{}},point:{active:!1,progress:0,params:{}},lean:{active:!1,progress:0,params:{}},reach:{active:!1,progress:0,params:{}},headBob:{active:!1,progress:0,params:{}},orbit:{active:!1,progress:0,params:{}},rain:{active:!1,progress:0,params:{}},runningman:{active:!1,progress:0,params:{}},charleston:{active:!1,progress:0,params:{}}}},[{key:"startGesture",value:function(t){var e,i=(0,It.getGesture)(t);if(["bounce","shake","pulse","flash","jump","slam","spin","flicker"].includes(t)&&this.renderer.specialEffects){var n={flash:1,jump:1,shake:.9,bounce:.8,pulse:.7,slam:1,spin:.8,flicker:1}[t]||.8;this.renderer.specialEffects.triggerChromaticAberration(n)}e=this.renderer.gestureCompositor?this.renderer.gestureCompositor.compose(t,this.renderer.state.emotion,this.renderer.currentUndertone):(null==i?void 0:i.config)||{amplitude:20,frequency:2,duration:1e3,scaleAmount:.2,glowAmount:.3,rotations:1,distance:50,angle:15,scaleTarget:1.5,glowPeak:2,scalePeak:1.1,scaleX:1.2,scaleY:.8,maxOpacity:1,minOpacity:.5,lookDirection:"random",lookDistance:1,wobbleFreq:4,squashAmount:.8,stretchAmount:1.2,jumpHeight:100,decay:!0,easing:"sine",effects:[]};var a=1e3;i&&i.config&&(i.config.musicalDuration?a=ve.toMilliseconds(i.config.musicalDuration):i.config.duration&&(a=i.config.duration));var r=this.gestureAnimations[t];r&&(r.active=!0,r.startTime=performance.now(),r.progress=0,r.params=e,r.duration=a,"shake"===t?r.randomAngle=void 0:"drift"===t?(r.startX=void 0,r.startY=void 0,r.currentDriftAngle=void 0):"tilt"===t?r.tiltDirection=void 0:"vibrate"===t&&(r.vibrateAngles=void 0))}},{key:"applyGestureAnimations",value:function(){for(var t=performance.now(),e={offsetX:0,offsetY:0,scale:1,rotation:0,glow:1},i=0,n=Object.entries(this.gestureAnimations);i<n.length;i++){var a=y(n[i],2),r=a[0],s=a[1];if(s.active){var o=t-s.startTime,h=s.duration||(s.params?s.params.duration:1e3);s.progress=Math.min(o/h,1);var u=this.applyEasing(s.progress,s.params.easing),c={};switch(r){case"bounce":c=this.applyBounce(s,u);break;case"pulse":c=this.applyPulse(s,u);break;case"shake":c=this.applyShake(s,u);break;case"spin":c=this.applySpin(s,u);break;case"nod":c=this.applyNod(s,u);break;case"tilt":c=this.applyTilt(s,u);break;case"expand":c=this.applyExpand(s,u);break;case"contract":c=this.applyContract(s,u);break;case"flash":c=this.applyFlash(s,u);break;case"drift":c=this.applyDrift(s,u);break;case"stretch":c=this.applyStretch(s,u);break;case"glow":c=this.applyGlow(s,u);break;case"flicker":c=this.applyFlicker(s,u);break;case"vibrate":c=this.applyVibrate(s,u);break;case"orbital":c=this.applyOrbital(s,u);break;case"hula":c=this.applyHula(s,u);break;case"wave":c=this.applyWave(s,u);break;case"breathe":c=this.applyBreathe(s,u);break;case"morph":c=this.applyMorph(s,u);break;case"slowBlink":c=this.applySlowBlink(s,u);break;case"look":c=this.applyLook(s,u);break;case"settle":c=this.applySettle(s,u);break;case"breathIn":c=this.applyBreathIn(s,u);break;case"breathOut":c=this.applyBreathOut(s,u);break;case"breathHold":c=this.applyBreathHold(s,u);break;case"breathHoldEmpty":c=this.applyBreathHoldEmpty(s,u);break;case"jump":c=this.applyJump(s,u);break;case"sway":c=this.applySway(s,u);break;case"float":c=this.applyFloat(s,u);break;case"rain":c=this.applyRain(s,u);break;case"runningman":c=this.applyRunningMan(s,u);break;case"charleston":c=this.applyCharleston(s,u);break;case"sparkle":c=this.applySparkle(s,u);break;case"shimmer":c=this.applyShimmer(s,u);break;case"wiggle":c=this.applyWiggle(s,u);break;case"groove":c=this.applyGroove(s,u);break;case"point":c=this.applyPoint(s,u);break;case"lean":c=this.applyLean(s,u);break;case"reach":c=this.applyReach(s,u);break;case"headBob":c=this.applyHeadBob(s,u);break;case"orbit":c=this.applyOrbit(s,u)}e.offsetX+=c.offsetX||0,e.offsetY+=c.offsetY||0,e.scale*=c.scale||1,e.rotation+=c.rotation||0,e.glow=Math.max(e.glow,c.glow||1),c.flashWave&&(e.flashWave=c.flashWave),c.fireflyEffect&&(e.fireflyEffect=c.fireflyEffect,e.particleGlow=c.particleGlow,e.fireflyTime=c.fireflyTime),c.flickerEffect&&(e.flickerEffect=c.flickerEffect,e.particleGlow=c.particleGlow,e.flickerTime=c.flickerTime),c.shimmerEffect&&(e.shimmerEffect=c.shimmerEffect,e.particleGlow=c.particleGlow,e.shimmerTime=c.shimmerTime,e.shimmerWave=c.shimmerWave),c.glowEffect&&(e.glowEffect=c.glowEffect,e.particleGlow=c.particleGlow,e.glowTime=c.glowTime,e.glowProgress=c.glowProgress,e.glowEnvelope=c.glowEnvelope),s.progress>=1&&(s.active=!1,s.progress=0,s.startTime=0,"flash"===r&&(s.flashWave=null,s.flashWaveData=null))}}return e}},{key:"update",value:function(t){return this.applyGestureAnimations()}},{key:"stopAllGestures",value:function(){var t=this;Object.keys(this.gestureAnimations).forEach(function(e){t.gestureAnimations[e].active=!1,t.gestureAnimations[e].startTime=0,t.gestureAnimations[e].progress=0,t.gestureAnimations[e].params=null}),this.activeGestures.clear(),this.gestureQueue=[]}},{key:"getCurrentGesture",value:function(){for(var t=0,e=["orbital","hula","wave","spin"];t<e.length;t++){var i=e[t],n=this.gestureAnimations[i];if(n&&n.active){var a,r,s=(0,It.getGesture)(i);return{name:i,particleMotion:(null==s||null===(a=s.config)||void 0===a?void 0:a.particleMotion)||{type:i,strength:(null===(r=n.params)||void 0===r?void 0:r.strength)||1},progress:n.progress||0,params:n.params}}}for(var o=0,h=Object.entries(this.gestureAnimations);o<h.length;o++){var u=y(h[o],2),c=u[0],l=u[1];if(l.active){var f,v,d,p=(0,It.getGesture)(c),m={name:c,particleMotion:(null==p||null===(f=p.config)||void 0===f?void 0:f.particleMotion)||(null===(v=l.params)||void 0===v?void 0:v.particleMotion)||{type:c,strength:(null===(d=l.params)||void 0===d?void 0:d.strength)||1},progress:l.progress||0,params:l.params};return"breathe"===c&&void 0!==l.breathPhase&&(m.breathPhase=l.breathPhase),m}}return null}},{key:"applyEasing",value:function(t,e){switch(e){case"linear":default:return t;case"quad":return t*t;case"cubic":return t*t*t;case"sine":return Math.sin(t*Math.PI/2);case"back":return t*t*(2.7*t-1.7)}}},{key:"applyBounce",value:function(t,e){return{offsetY:-(Math.abs(Math.sin(e*Math.PI*t.params.frequency))*t.params.amplitude*this.scaleFactor)*(t.params.effects&&t.params.effects.includes("gravity")?.6:1)}}},{key:"applyPulse",value:function(t,e){var i=Math.sin(e*Math.PI*t.params.frequency);return{scale:1+i*t.params.scaleAmount,glow:1+i*t.params.glowAmount}}},{key:"applyShake",value:function(t,e){t.randomAngle||(t.randomAngle=Math.random()*Math.PI*2);var i=t.params.decay?1-e:1,n=Math.sin(e*Math.PI*t.params.frequency)*t.params.amplitude*i*this.scaleFactor;return{offsetX:n*Math.cos(t.randomAngle),offsetY:n*Math.sin(t.randomAngle)}}},{key:"applySpin",value:function(t,e){return{rotation:Math.min(1.05*e,1)*t.params.rotations*360,scale:1+Math.sin(e*Math.PI)*t.params.scaleAmount}}},{key:"applyNod",value:function(t,e){return{offsetY:Math.sin(e*Math.PI*t.params.frequency)*t.params.amplitude*this.scaleFactor}}},{key:"applyTilt",value:function(t,e){t.tiltDirection||(t.tiltDirection=Math.random()<.5?-1:1);var i=t.params.frequency||2,n=(t.params.angle||15)*Math.PI/180,a=Math.sin(e*Math.PI*i)*t.tiltDirection;return{rotation:a*n,scaleX:1+.1*Math.abs(a),scaleY:1-.05*Math.abs(a),offsetX:10*a,offsetY:-5*Math.abs(a)}}},{key:"applyExpand",value:function(t,e){var i=Math.max(t.params.scaleAmount||t.params.scaleTarget||1.5,1),n=Math.sin(e*Math.PI/2);return{scale:1+(i-1)*n,glow:1+Math.abs(t.params.glowAmount||.2)*n}}},{key:"applyContract",value:function(t,e){var i=t.params.scaleAmount||t.params.scaleTarget||.7,n=Math.sin(e*Math.PI/2);return{scale:1+(i-1)*n,glow:1+(t.params.glowAmount||-.2)*n}}},{key:"applyFlash",value:function(t,e){t.flashWave||(t.flashWave={innerRadius:0,outerRadius:0,maxRadius:3}),t.flashWave.outerRadius=e*t.flashWave.maxRadius,t.flashWave.innerRadius=Math.max(0,(e-.1)*t.flashWave.maxRadius);var i=Math.max(0,1-.7*e);return t.flashWaveData={innerRadius:t.flashWave.innerRadius,outerRadius:t.flashWave.outerRadius,intensity:i},{glow:1+.3*i,flashWave:t.flashWaveData}}},{key:"applyDrift",value:function(t,e){e<=.01&&!t.currentDriftAngle&&(t.currentDriftAngle=Math.random()*Math.PI*2);var i=t.params.distance*Math.sin(e*Math.PI)*this.scaleFactor,n=t.currentDriftAngle||0;return e>=.99&&(t.currentDriftAngle=null),{offsetX:Math.cos(n)*i,offsetY:Math.sin(n)*i}}},{key:"applyStretch",value:function(t,e){var i=Math.sin(e*Math.PI*t.params.frequency);return{scale:1+((t.params.scaleX+t.params.scaleY)/2-1)*i}}},{key:"applyGlow",value:function(t,e){var i=Math.sin(e*Math.PI*t.params.frequency);return{scale:1+i*(t.params.scaleAmount||.1),glow:1+i*(t.params.glowAmount||.8)}}},{key:"applyFlicker",value:function(t,e){var i,n,a=(null===(i=t.params)||void 0===i?void 0:i.intensity)||2,r=(null===(n=t.params)||void 0===n?void 0:n.speed)||3,s=1+Math.sin(e*Math.PI*2*r)*a*.3,o=5*Math.sin(e*Math.PI*4)*this.scaleFactor,h=.001*Date.now();return{offsetX:o,glow:s,particleGlow:a*(.5*Math.sin(e*Math.PI*r*2)+.5),flickerTime:h,flickerEffect:!0}}},{key:"applyVibrate",value:function(t,e){if(!t.vibrateAngles){t.vibrateAngles={x:2*Math.random()-1,y:2*Math.random()-1};var i=Math.sqrt(Math.pow(t.vibrateAngles.x,2)+Math.pow(t.vibrateAngles.y,2));t.vibrateAngles.x/=i,t.vibrateAngles.y/=i}var n=Math.sin(e*Math.PI*2*t.params.frequency)*t.params.amplitude*this.scaleFactor;return{offsetX:n*t.vibrateAngles.x,offsetY:n*t.vibrateAngles.y}}},{key:"applyWave",value:function(t,e){var i=(t.params.amplitude||40)*this.scaleFactor,n=e*Math.PI*2,a=Math.sin(n)*i,r=-Math.sin(e*Math.PI)*i*.3;return{offsetX:a,offsetY:Math.sin(2*n)*i*.2+r,rotation:5*Math.sin(n),scale:1+.05*Math.sin(e*Math.PI*2),glow:1+.2*Math.sin(e*Math.PI)}}},{key:"applyBreathe",value:function(t,e){var i,n,a=t.params,r=(null===(i=a.particleMotion)||void 0===i?void 0:i.holdPercent)||.1;if(e<.4)n=Math.sin(e/.4*Math.PI/2);else if(e<.4+r)n=1;else if(e<.9){var s=(e-.4-r)/(.5-r);n=Math.cos(s*Math.PI/2)}else n=0;var o=1+n*(a.scaleAmount||.25),h=1+n*(a.glowAmount||.4);return t.breathPhase=n,{scale:o,glow:h,breathPhase:n}}},{key:"applyMorph",value:function(t,e){var i=Math.sin(e*Math.PI*2);return{scale:1+.1*i,rotation:10*i}}},{key:"applySlowBlink",value:function(t,e){return{glow:e<.3?1-e/.3:e<.5?0:e<.8?(e-.5)/.3:1}}},{key:"applyLook",value:function(t,e){if(!t.targetX){var i=t.params.lookDirection,n=50*t.params.lookDistance*this.scaleFactor;switch(i){case"left":t.targetX=-n,t.targetY=0;break;case"right":t.targetX=n,t.targetY=0;break;case"up":t.targetX=0,t.targetY=-n;break;case"down":t.targetX=0,t.targetY=n;break;default:var a=Math.random()*Math.PI*2;t.targetX=Math.cos(a)*n,t.targetY=Math.sin(a)*n}}var r=e;return r=e<.3?e/.3:e<.7?1:1-(e-.7)/.3,{offsetX:t.targetX*r,offsetY:t.targetY*r}}},{key:"applySettle",value:function(t,e){var i=Math.sin(e*Math.PI*t.params.wobbleFreq)*Math.exp(3*-e)*20*this.scaleFactor;return{offsetY:i,scale:1+.01*i}}},{key:"applyBreathIn",value:function(t,e){return{scale:1+(t.params.scaleAmount-1)*Math.sin(e*Math.PI/2)}}},{key:"applyBreathOut",value:function(t,e){return{scale:1-(1-t.params.scaleAmount)*Math.sin(e*Math.PI/2)}}},{key:"applyBreathHold",value:function(t,e){return{scale:t.params.scaleAmount}}},{key:"applyBreathHoldEmpty",value:function(t,e){return{scale:t.params.scaleAmount}}},{key:"applyJump",value:function(t,e){var i=0,n=1;if(e<.2){var a=e/.2;n=1-(1-t.params.squashAmount)*a}else if(e<.7){var r=(e-.2)/.5,s=Math.sin(r*Math.PI);i=-t.params.jumpHeight*s*this.scaleFactor,n=t.params.squashAmount+(t.params.stretchAmount-t.params.squashAmount)*s}else{var o=(e-.7)/.3;n=t.params.stretchAmount-(t.params.stretchAmount-1)*o}return{offsetY:i,scale:n}}},{key:"applySway",value:function(t,e){var i,n,a=((null===(i=t.params)||void 0===i?void 0:i.amplitude)||30)*this.scaleFactor,r=(null===(n=t.params)||void 0===n?void 0:n.frequency)||1;return{offsetX:Math.sin(e*Math.PI*2*r)*a,offsetY:Math.sin(e*Math.PI*4*r)*a*.1,rotation:5*Math.sin(e*Math.PI*2*r)}}},{key:"applyRain",value:function(t,e){var i,n=(null===(i=t.params)||void 0===i?void 0:i.intensity)||1,a=10*e*this.scaleFactor*n,r=5*Math.sin(e*Math.PI*4)*this.scaleFactor;return this.renderer&&this.renderer.particleSystem&&this.renderer.particleSystem.setGestureBehavior("falling",e>0&&e<1),{offsetX:r,offsetY:a,particleEffect:"falling"}}},{key:"applyFloat",value:function(t,e){var i,n,a=((null===(i=t.params)||void 0===i?void 0:i.amplitude)||20)*this.scaleFactor,r=(null===(n=t.params)||void 0===n?void 0:n.speed)||1,s=Math.sin(e*Math.PI*2*r)*a;return{offsetX:Math.sin(e*Math.PI*3*r)*a*.3,offsetY:s,scale:1+.02*Math.sin(e*Math.PI*4*r)}}},{key:"applyOrbital",value:function(t,e){return{offsetX:0,offsetY:0}}},{key:"applyHula",value:function(t,e){var i,n=((null===(i=t.params)||void 0===i?void 0:i.amplitude)||40)*this.scaleFactor,a=e*Math.PI*2;return{offsetX:Math.sin(a)*n,offsetY:Math.sin(2*a)*n*.5}}},{key:"applySparkle",value:function(t,e){var i,n=(null===(i=t.params)||void 0===i?void 0:i.intensity)||2,a=.001*Date.now();return{particleGlow:n,glow:.3*Math.sin(e*Math.PI*4)+.7,fireflyTime:a,fireflyEffect:!0}}},{key:"applyShimmer",value:function(t,e){var i,n=.001*Date.now(),a=(null===(i=t.params)||void 0===i?void 0:i.intensity)||.3,r=Math.sin(2*n+e*Math.PI*2);return{offsetX:0,offsetY:0,glow:1+r*a,scale:1+.01*r,particleGlow:1+.2*r,shimmerTime:n,shimmerWave:r,shimmerEffect:!0}}},{key:"applyWiggle",value:function(t,e){var i,n=((null===(i=t.params)||void 0===i?void 0:i.amplitude)||15)*this.scaleFactor;void 0===t.wiggleDirection&&(t.wiggleDirection=Math.random()<.5?1:-1);var a=t.wiggleDirection,r=0,s=0;if(e<.25){var o=e/.25;r=n*a*o,s=3*a*o}else if(e<.5){var h=(e-.25)/.25;r=n*a*(1-2*h),s=3*a*(1-2*h)}else if(e<.75){var u=(e-.5)/.25;r=n*-a*(1-2*u),s=3*-a*(1-2*u)}else{var c=(e-.75)/.25;r=n*a*(1-c),s=3*a*(1-c)}return{offsetX:r,offsetY:-(Math.abs(Math.sin(e*Math.PI*4))*n*.15),rotation:s}}},{key:"applyGroove",value:function(t,e){var i,n=((null===(i=t.params)||void 0===i?void 0:i.amplitude)||25)*this.scaleFactor;return{offsetX:Math.sin(e*Math.PI*2)*n+Math.sin(e*Math.PI*3+.5)*n*.4,offsetY:Math.sin(e*Math.PI*4+.3)*n*.25,scale:1+.03*Math.sin(e*Math.PI*3+.7),rotation:8*Math.sin(e*Math.PI*2+.2)}}},{key:"applyPoint",value:function(t,e){var i,n;void 0===t.pointDirection&&(t.pointDirection=Math.random()<.5?-1:1);var a,r,s=void 0!==(null===(i=t.params)||void 0===i?void 0:i.direction)?t.params.direction:t.pointDirection,o=((null===(n=t.params)||void 0===n?void 0:n.distance)||40)*this.scaleFactor;return e<.4?r=a=1-Math.pow(1-e/.4,3):e<.6?(a=1,r=1):r=a=Math.pow(1-(e-.6)/.4,3),{offsetX:s*o*a,offsetY:-Math.abs(.15*o*a),scale:1+.15*r,rotation:5*s*r}}},{key:"applyLean",value:function(t,e){var i,n,a=(null===(i=t.params)||void 0===i?void 0:i.angle)||15,r=(null===(n=t.params)||void 0===n?void 0:n.side)||1,s=Math.sin(e*Math.PI),o=a*r*s;return{offsetX:10*r*this.scaleFactor*s,rotation:o}}},{key:"applyReach",value:function(t,e){var i,n,a,r=(null===(i=t.params)||void 0===i?void 0:i.direction)||-Math.PI/2,s=((null===(n=t.params)||void 0===n?void 0:n.distance)||40)*this.scaleFactor;return a=(a=e<.4?e/.4:e<.6?1:1-(e-.6)/.4)*a*(3-2*a),{offsetX:Math.cos(r)*s*a,offsetY:Math.sin(r)*s*a,scale:1+.15*a}}},{key:"applyHeadBob",value:function(t,e){var i,n,a=((null===(i=t.params)||void 0===i?void 0:i.amplitude)||20)*this.scaleFactor,r=e*((null===(n=t.params)||void 0===n?void 0:n.frequency)||2)%1;return{offsetY:r<.3?r/.3*-a:-a*(1-(r-.3)/.7),rotation:r<.3?-3:0}}},{key:"applyOrbit",value:function(t,e){var i,n,a=((null===(i=t.params)||void 0===i?void 0:i.radius)||30)*this.scaleFactor,r=(null===(n=t.params)||void 0===n?void 0:n.speed)||1,s=e*Math.PI*2*r;return{offsetX:Math.cos(s)*a,offsetY:Math.sin(s)*a}}},{key:"startBounce",value:function(){this.startGesture("bounce")}},{key:"startPulse",value:function(){this.startGesture("pulse")}},{key:"startShake",value:function(){this.startGesture("shake")}},{key:"startSpin",value:function(){this.startGesture("spin")}},{key:"startNod",value:function(){this.startGesture("nod")}},{key:"startTilt",value:function(){this.startGesture("tilt")}},{key:"startExpand",value:function(){this.startGesture("expand")}},{key:"startContract",value:function(){this.startGesture("contract")}},{key:"startFlash",value:function(){this.startGesture("flash")}},{key:"startDrift",value:function(){this.startGesture("drift")}},{key:"startStretch",value:function(){this.startGesture("stretch")}},{key:"startGlow",value:function(){this.startGesture("glow")}},{key:"startFlicker",value:function(){this.startGesture("flicker")}},{key:"startVibrate",value:function(){this.startGesture("vibrate")}},{key:"startOrbital",value:function(){this.startGesture("orbital")}},{key:"startHula",value:function(){this.startGesture("hula")}},{key:"startWave",value:function(){this.startGesture("wave")}},{key:"startBreathe",value:function(){this.startGesture("breathe")}},{key:"startMorph",value:function(){this.startGesture("morph")}},{key:"startSlowBlink",value:function(){this.startGesture("slowBlink")}},{key:"startLook",value:function(){this.startGesture("look")}},{key:"startSettle",value:function(){this.startGesture("settle")}},{key:"startBreathIn",value:function(){this.startGesture("breathIn")}},{key:"startBreathOut",value:function(){this.startGesture("breathOut")}},{key:"startBreathHold",value:function(){this.startGesture("breathHold")}},{key:"startBreathHoldEmpty",value:function(){this.startGesture("breathHoldEmpty")}},{key:"startJump",value:function(){this.startGesture("jump")}},{key:"startSway",value:function(){this.startGesture("sway")}},{key:"startFloat",value:function(){this.startGesture("float")}},{key:"startRain",value:function(){this.startGesture("rain")}},{key:"startRunningMan",value:function(){this.startGesture("runningman")}},{key:"startCharleston",value:function(){this.startGesture("charleston")}},{key:"startSparkle",value:function(){this.startGesture("sparkle")}},{key:"startShimmer",value:function(){this.startGesture("shimmer")}},{key:"startWiggle",value:function(){this.startGesture("wiggle")}},{key:"startGroove",value:function(){this.startGesture("groove")}},{key:"startPoint",value:function(){this.startGesture("point")}},{key:"startLean",value:function(){this.startGesture("lean")}},{key:"startReach",value:function(){this.startGesture("reach")}},{key:"startHeadBob",value:function(){this.startGesture("headBob")}},{key:"startOrbit",value:function(){this.startGesture("orbit")}},{key:"applyRunningMan",value:function(t,e){var i=20*Math.sin(e*Math.PI*4)*this.scaleFactor;return{offsetX:i,offsetY:10*-Math.abs(Math.sin(e*Math.PI*8))*this.scaleFactor,rotation:.3*i,scaleY:1-.05*Math.abs(Math.sin(e*Math.PI*8))}}},{key:"applyCharleston",value:function(t,e){var i=25*Math.sin(e*Math.PI*8)*this.scaleFactor;return{offsetX:i,offsetY:10*-Math.abs(Math.sin(e*Math.PI*8))*this.scaleFactor,rotation:.6*i,scaleY:1-.06*Math.abs(Math.sin(e*Math.PI*8))}}}])}();var pe=function(){return f(function t(){u(this,t),this.colorTransition=null},[{key:"applyUndertoneModifiers",value:function(t,e){return e}},{key:"applyUndertoneToColor",value:function(t,e){if(e&&"object"===(0,r.A)(e)&&void 0!==e.weight){var i=e.weight,n=e.type||"clear";if("clear"===n||0===i)return t;var a=this.applyUndertoneSaturation(t,n),s=this.hexToRgb(t),o=this.hexToRgb(a),h=Math.round(s.r+(o.r-s.r)*i),u=Math.round(s.g+(o.g-s.g)*i),c=Math.round(s.b+(o.b-s.b)*i);return this.rgbToHex(h,u,c)}return e&&"clear"!==e?this.applyUndertoneSaturation(t,e):t}},{key:"hexToRgb",value:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}},{key:"rgbToHsl",value:function(t,e,i){t/=255,e/=255,i/=255;var n,a,r=Math.max(t,e,i),s=Math.min(t,e,i),o=(r+s)/2;if(r===s)n=a=0;else{var h=r-s;switch(a=o>.5?h/(2-r-s):h/(r+s),r){case t:n=((e-i)/h+(e<i?6:0))/6;break;case e:n=((i-t)/h+2)/6;break;case i:n=((t-e)/h+4)/6}}return{h:360*n,s:100*a,l:100*o}}},{key:"hslToHex",value:function(t,e,i){var n,a,r;if(t/=360,i/=100,0===(e/=100))n=a=r=i;else{var s=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},o=i<.5?i*(1+e):i+e-i*e,h=2*i-o;n=s(h,o,t+1/3),a=s(h,o,t),r=s(h,o,t-1/3)}var u=function(t){var e=Math.round(255*t).toString(16);return 1===e.length?"0"+e:e};return"#".concat(u(n)).concat(u(a)).concat(u(r))}},{key:"applyUndertoneSaturation",value:function(t,e){var i=this.hexToRgb(t),n=this.rgbToHsl(i.r,i.g,i.b),a={intense:1.5,confident:1.3,energetic:1.2,upbeat:1.2,nervous:1.15,mellow:.8,tired:.8,subdued:.5}[e]||1;return n.s=Math.min(100,n.s*a),this.hslToHex(n.h,n.s,n.l)}},{key:"rgbToHex",value:function(t,e,i){var n=function(t){var e=Math.round(t).toString(16);return 1===e.length?"0"+e:e};return"#".concat(n(t)).concat(n(e)).concat(n(i))}},{key:"startColorTransition",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1500;this.currentColor===t&&this.currentIntensity===e||(this.colorTransition={active:!0,fromColor:this.currentColor||"#ffffff",toColor:t,fromIntensity:this.currentIntensity||1,toIntensity:e,progress:0,startTime:performance.now(),duration:i})}},{key:"updateColorTransition",value:function(t){if(!this.colorTransition||!this.colorTransition.active)return null;var e=performance.now()-this.colorTransition.startTime,i=Math.min(e/this.colorTransition.duration,1),n=1-Math.pow(1-i,2),a=this.hexToRgb(this.colorTransition.fromColor),r=this.hexToRgb(this.colorTransition.toColor),s=Math.round(a.r+(r.r-a.r)*n),o=Math.round(a.g+(r.g-a.g)*n),h=Math.round(a.b+(r.b-a.b)*n),u=this.rgbToHex(s,o,h),c=this.colorTransition.fromIntensity+(this.colorTransition.toIntensity-this.colorTransition.fromIntensity)*n;return this.currentColor=u,this.currentIntensity=c,i>=1&&(this.colorTransition.active=!1),{color:u,intensity:c}}}])}();var ye=function(){return f(function t(e){u(this,t),this.renderer=e,this.ctx=e.ctx,this.canvas=e.canvas,this.recordingActive=!1,this.sleepMode=!1,this.speakingActive=!1,this.zenModeActive=!1,this.speakingRings=[],this.ringSpawnTimer=0,this.ringSpawnInterval=300,this.maxRings=3,this.sleepZ=[],this.sparkles=[],this.chromaticAberration={active:!1,intensity:0,targetIntensity:0,fadeSpeed:.01,maxOffset:30},this.scaleValue=function(t){return e.scaleValue(t)},this.hexToRgba=function(t,i){return e.hexToRgba(t,i)}},[{key:"renderRecordingGlow",value:function(t,e,i,n){var a=this.ctx,r=2.5*i,s=a.createRadialGradient(t,e,0,t,e,r);s.addColorStop(0,"rgba(255, 0, 0, ".concat(.3*n,")")),s.addColorStop(.5,"rgba(255, 0, 0, ".concat(.15*n,")")),s.addColorStop(1,"rgba(255, 0, 0, 0)"),a.save(),a.globalCompositeOperation="screen",a.fillStyle=s,a.fillRect(t-r,e-r,2*r,2*r),a.restore()}},{key:"renderRecordingIndicator",value:function(t,e){var i=Date.now()/1e3,n=.8+.2*Math.sin(2*i);this.ctx.save(),this.ctx.translate(t,e),this.ctx.shadowBlur=this.scaleValue(15),this.ctx.shadowColor="rgba(255, 0, 0, ".concat(.8*n,")");var a=this.scaleValue(80);this.ctx.font="italic 900 ".concat(a,'px "Poppins", sans-serif'),this.ctx.fillStyle="rgba(255, 0, 0, ".concat(n,")"),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("REC",0,0),this.ctx.shadowBlur=0,this.ctx.font="italic 900 ".concat(a-1,'px "Poppins", sans-serif'),this.ctx.fillStyle="rgba(255, 255, 255, ".concat(.3*n,")"),this.ctx.fillText("REC",-.5,-.5),this.ctx.restore()}},{key:"renderSleepIndicator",value:function(t,e,i){var n=this;if(this.ringSpawnTimer+=i,this.ringSpawnTimer>=2e3&&this.sleepZ.length<3){var a=["300","500","700","900"],r=a[Math.floor(Math.random()*a.length)],s=Math.random()>.5?"Z":"z";this.sleepZ.push({x:t+Math.random()*this.scaleValue(30)-this.scaleValue(15),y:e+this.scaleValue(80),size:this.scaleValue(3*(24+8*Math.random())),opacity:1,speed:-.025,drift:Math.random()*this.scaleValue(20)-this.scaleValue(10),lifetime:0,rotation:30*Math.random()-15,text:s,weight:r}),this.ringSpawnTimer=0}this.sleepZ=this.sleepZ.filter(function(t){t.lifetime+=i,t.y+=t.speed*i,t.x+=Math.sin(8e-4*t.lifetime)*t.drift*.008,t.rotation+=.01*i;var e=2e3;if(t.lifetime<e?t.opacity=1:t.lifetime<4e3?t.opacity=1-(t.lifetime-e)/2e3:t.opacity=0,t.opacity>.01){n.ctx.save(),n.ctx.translate(t.x,t.y),n.ctx.rotate(t.rotation*Math.PI/180);var a=n.renderer.state.glowColor||"#4a90e2";n.ctx.shadowBlur=n.scaleValue(15),n.ctx.shadowColor=n.hexToRgba(a,.5*t.opacity);var r=n.ctx.createLinearGradient(-t.size/2,-t.size/2,t.size/2,t.size/2);return r.addColorStop(0,n.hexToRgba(a,t.opacity)),r.addColorStop(.5,n.hexToRgba("#ffffff",.9*t.opacity)),r.addColorStop(1,n.hexToRgba(a,.7*t.opacity)),n.ctx.font="italic ".concat(t.weight||"900"," ").concat(t.size,"px 'Poppins', sans-serif"),n.ctx.fillStyle=r,n.ctx.textAlign="center",n.ctx.textBaseline="middle",n.ctx.fillText(t.text||"Z",0,0),n.ctx.shadowBlur=0,n.ctx.font="italic ".concat(t.weight||"900"," ").concat(.9*t.size,"px 'Poppins', sans-serif"),n.ctx.fillStyle=n.hexToRgba("#ffffff",.3*t.opacity),n.ctx.fillText(t.text||"Z",-1,-1),n.ctx.restore(),!0}return!1})}},{key:"renderSpeakingRings",value:function(t,e,i,n){var a=this;this.ringSpawnTimer+=n,this.ringSpawnTimer>=this.ringSpawnInterval&&this.speakingRings.length<this.maxRings&&(this.speakingRings.push({radius:i,opacity:.8,speed:.15}),this.ringSpawnTimer=0),this.speakingRings=this.speakingRings.filter(function(r){return r.radius+=r.speed*n,r.opacity=Math.max(0,.8*(1-(r.radius-i)/(2*i))),r.opacity>.01&&(a.ctx.strokeStyle=a.hexToRgba(a.renderer.state.glowColor,r.opacity),a.ctx.lineWidth=a.scaleValue(2),a.ctx.beginPath(),a.ctx.arc(t,e,r.radius,0,2*Math.PI),a.ctx.stroke(),!0)})}},{key:"renderZenCore",value:function(t,e,i,n){var a=this.ctx,r=i*(.9+.1*(.5*Math.sin(.001*n)+.5)),s=a.createRadialGradient(t,e,0,t,e,r);s.addColorStop(0,"rgba(147, 112, 219, 0.8)"),s.addColorStop(.7,"rgba(147, 112, 219, 0.3)"),s.addColorStop(1,"rgba(147, 112, 219, 0)"),a.save(),a.globalCompositeOperation="screen",a.fillStyle=s,a.beginPath(),a.arc(t,e,1.5*r,0,2*Math.PI),a.fill(),a.restore()}},{key:"startRecording",value:function(){this.recordingActive=!0}},{key:"stopRecording",value:function(){this.recordingActive=!1}},{key:"enterSleepMode",value:function(){this.sleepMode=!0}},{key:"wakeUp",value:function(){this.sleepMode=!1}},{key:"startSpeaking",value:function(){this.speakingActive=!0}},{key:"stopSpeaking",value:function(){this.speakingActive=!1}},{key:"createSparkle",value:function(t,e){var i,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.sparkles.push({x:t,y:e,vx:(null===(i=a.velocity)||void 0===i?void 0:i.x)||0,vy:(null===(n=a.velocity)||void 0===n?void 0:n.y)||0,size:a.size||3,color:a.color||"hsl(50, 100%, 70%)",lifetime:a.lifetime||1e3,maxLifetime:a.lifetime||1e3,rotation:Math.random()*Math.PI*2,rotationSpeed:.2*(Math.random()-.5)})}},{key:"renderSparkles",value:function(){var t=this,e=this.ctx;this.sparkles.forEach(function(i){var n=1-i.lifetime/i.maxLifetime,a=1-n;e.save(),e.translate(i.x,i.y),e.rotate(i.rotation);var r=t.scaleValue(i.size*(1-.5*n));e.beginPath();for(var s=r,o=.38*r,h=0;h<10;h++){var u=h*Math.PI/5-Math.PI/2,c=h%2==0?s:o;0===h?e.moveTo(Math.cos(u)*c,Math.sin(u)*c):e.lineTo(Math.cos(u)*c,Math.sin(u)*c)}e.closePath(),e.shadowBlur=t.scaleValue(10),e.shadowColor=i.color,e.fillStyle=i.color.replace("70%","".concat(70+30*n,"%")).replace(")",", ".concat(a,")")).replace("hsl","hsla"),e.fill(),e.restore()})}},{key:"triggerChromaticAberration",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.8;this.chromaticAberration.active=!0,this.chromaticAberration.targetIntensity=Math.min(1,t),this.chromaticAberration.intensity=this.chromaticAberration.targetIntensity;var e=document.getElementById("emotive-canvas")||document.querySelector("canvas")||this.canvas;if(e){if(e.style.animation="none",e.offsetHeight,!document.getElementById("chromatic-styles")){var i=document.createElement("style");i.id="chromatic-styles",i.textContent="\n                    @keyframes chromaticGlitch {\n                        0% {\n                            filter: none;\n                            transform: translateX(0);\n                        }\n                        15% {\n                            filter: drop-shadow(-2px 0 0 rgba(255,0,0,0.7)) drop-shadow(2px 0 0 rgba(0,255,255,0.7));\n                            transform: translateX(-0.5px);\n                        }\n                        30% {\n                            filter: drop-shadow(-3px 0 0 rgba(255,0,0,0.8)) drop-shadow(3px 0 0 rgba(0,255,255,0.8));\n                            transform: translateX(0.5px);\n                        }\n                        45% {\n                            filter: drop-shadow(-2px 0 0 rgba(255,0,0,0.6)) drop-shadow(2px 0 0 rgba(0,255,255,0.6));\n                            transform: translateX(-0.3px);\n                        }\n                        60% {\n                            filter: drop-shadow(-1px 0 0 rgba(255,0,0,0.4)) drop-shadow(1px 0 0 rgba(0,255,255,0.4));\n                            transform: translateX(0.2px);\n                        }\n                        100% {\n                            filter: none;\n                            transform: translateX(0);\n                        }\n                    }\n                ",document.head.appendChild(i)}e.style.animation="chromaticGlitch ".concat(300+200*t,"ms ease-out")}}},{key:"applyChromaticAberration",value:function(t,e){if(this.chromaticAberration.active&&!(this.chromaticAberration.intensity<=0)){var i=this.chromaticAberration.intensity,n=this.scaleValue(this.chromaticAberration.maxOffset*i),a=t.globalCompositeOperation;t.save(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation="source-over",t.filter="url(#red-channel)",t.drawImage(e,-n,0),t.globalCompositeOperation="screen",t.filter="url(#green-channel)",t.drawImage(e,0,0),t.globalCompositeOperation="screen",t.filter="url(#blue-channel)",t.drawImage(e,n,0),t.filter="none",t.globalCompositeOperation=a,t.restore()}}},{key:"applyChromaticAberrationSimple",value:function(t,e,i,n,a){if(!this.chromaticAberration.active||this.chromaticAberration.intensity<=0)a();else{var r=this.chromaticAberration.intensity,s=this.scaleValue(this.chromaticAberration.maxOffset*r);t.save(),t.globalCompositeOperation="source-over",t.translate(-s,0),t.globalAlpha=.33,t.fillStyle="#ff0000",t.filter="brightness(3)",a(),t.translate(s,0),t.globalCompositeOperation="screen",t.globalAlpha=.33,t.fillStyle="#00ff00",a(),t.translate(s,0),t.globalAlpha=.33,t.fillStyle="#0000ff",a(),t.restore()}}},{key:"update",value:function(t){this.sparkles=this.sparkles.filter(function(e){return e.x+=e.vx,e.y+=e.vy,e.rotation+=e.rotationSpeed,e.lifetime-=t,e.vy+=.1,e.lifetime>0}),this.chromaticAberration.active&&(this.chromaticAberration.intensity-=this.chromaticAberration.fadeSpeed,this.chromaticAberration.intensity<=0&&(this.chromaticAberration.intensity=0,this.chromaticAberration.active=!1,this.chromaticAberration.targetIntensity=0))}}])}();var me=function(){return f(function t(e){u(this,t),this.renderer=e,this.ctx=e.ctx,this.canvas=e.canvas,this.blinking=!1,this.blinkingEnabled=!0,this.blinkTimer=0,this.nextBlinkTime=this.getRandomBlinkTime(),this.squintAmount=0,this.eyeClose=null,this.eyeOpen=null,this.scaleValue=function(t){return e.scaleValue(t)},this.hexToRgba=function(t,i){return e.hexToRgba(t,i)}},[{key:"update",value:function(t){this.blinking&&(this.blinkTimer+=t,this.blinkTimer>=150&&(this.blinking=!1,this.blinkTimer=0,this.nextBlinkTime=Date.now()+this.getRandomBlinkTime())),this.blinkingEnabled&&!this.blinking&&Date.now()>=this.nextBlinkTime&&this.startBlink()}},{key:"startBlink",value:function(){this.blinkingEnabled&&(this.blinking=!0,this.blinkTimer=0)}},{key:"getRandomBlinkTime",value:function(){return 3e3+4e3*Math.random()}},{key:"getBlinkScale",value:function(){if(!this.blinking)return 1;var t=Math.min(this.blinkTimer/150,1);return 1-.7*Math.sin(t*Math.PI)}},{key:"drawEyes",value:function(t,e,i,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=this.ctx,s=a.eyeOpenness||1,o=a.eyeExpression||"neutral";if(!("zen"===n||"neutral"===n||s<=0)){r.save(),r.strokeStyle="rgba(0, 0, 0, 0.3)",r.lineWidth=this.scaleValue(2),r.lineCap="round";var h=.4*i,u=e-.1*i,c=.25*i;switch(o){case"happy":this.drawHappyEyes(r,t,u,h,c,s);break;case"sad":this.drawSadEyes(r,t,u,h,c,s);break;case"angry":this.drawAngryEyes(r,t,u,h,c,s);break;case"surprised":this.drawSurprisedEyes(r,t,u,h,c,s);break;case"focused":this.drawFocusedEyes(r,t,u,h,c,s);break;case"sleepy":this.drawSleepyEyes(r,t,u,h,c,s);break;case"suspicious":this.drawSuspiciousEyes(r,t,u,h,c,s)}r.restore()}}},{key:"drawHappyEyes",value:function(t,e,i,n,a,r){t.beginPath(),t.arc(e-n,i,a,.2*Math.PI,.8*Math.PI,!1),t.stroke(),t.beginPath(),t.arc(e+n,i,a,.2*Math.PI,.8*Math.PI,!1),t.stroke()}},{key:"drawSadEyes",value:function(t,e,i,n,a,r){t.beginPath(),t.arc(e-n,i+.5*a,a,1.2*Math.PI,1.8*Math.PI,!1),t.stroke(),t.beginPath(),t.arc(e+n,i+.5*a,a,1.2*Math.PI,1.8*Math.PI,!1),t.stroke()}},{key:"drawAngryEyes",value:function(t,e,i,n,a,r){t.beginPath(),t.moveTo(e-n-a,i-.3*a),t.lineTo(e-n+.5*a,i+.3*a),t.stroke(),t.beginPath(),t.moveTo(e+n+a,i-.3*a),t.lineTo(e+n-.5*a,i+.3*a),t.stroke()}},{key:"drawSurprisedEyes",value:function(t,e,i,n,a,r){t.beginPath(),t.arc(e-n,i,1.2*a,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(e+n,i,1.2*a,0,2*Math.PI),t.stroke()}},{key:"drawFocusedEyes",value:function(t,e,i,n,a,r){t.fillStyle="rgba(0, 0, 0, 0.4)",t.beginPath(),t.arc(e-n,i,.3*a,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(e+n,i,.3*a,0,2*Math.PI),t.fill()}},{key:"drawSleepyEyes",value:function(t,e,i,n,a,r){t.beginPath(),t.moveTo(e-n-a,i),t.lineTo(e-n+a,i),t.stroke(),t.beginPath(),t.moveTo(e+n-a,i),t.lineTo(e+n+a,i),t.stroke()}},{key:"drawSuspiciousEyes",value:function(t,e,i,n,a,r){t.beginPath(),t.moveTo(e-n-a,i),t.lineTo(e-n+.7*a,i),t.stroke(),t.beginPath(),t.arc(e+n,i,.8*a,.1*Math.PI,.9*Math.PI,!1),t.stroke()}},{key:"setBlinkingEnabled",value:function(t){this.blinkingEnabled=t,t||(this.blinking=!1,this.blinkTimer=0)}},{key:"setSquintAmount",value:function(t){this.squintAmount=Math.max(0,Math.min(1,t))}},{key:"forceBlink",value:function(){this.startBlink()}}])}();var ge=function(){return f(function t(e){u(this,t),this.renderer=e,this.breathingSpeed=.42,this.breathingDepth=.08,this.breathingPhase=0,this.breathRate=1,this.breathDepth=this.breathingDepth,this.breathRateMult=1,this.breathDepthMult=1,this.breathIrregular=!1,this.customScale=null,this.emotionBreathPatterns={happy:{rate:1.1,depth:1.2},sad:{rate:.8,depth:.7},angry:{rate:1.4,depth:1.3},calm:{rate:.7,depth:.9},excited:{rate:1.5,depth:1.4},focused:{rate:.9,depth:.6},neutral:{rate:1,depth:1},love:{rate:1.2,depth:1.3},surprised:{rate:1.3,depth:1.1},confused:{rate:1.1,depth:.9},amused:{rate:1.2,depth:1.1},bored:{rate:.6,depth:.8},tired:{rate:.5,depth:1.2},anxious:{rate:1.6,depth:.9},determined:{rate:1.1,depth:1},proud:{rate:.9,depth:1.3},content:{rate:.8,depth:1},hopeful:{rate:1,depth:1.1},zen:{rate:.4,depth:1.5},intrigued:{rate:1.1,depth:.8},embarrassed:{rate:1.3,depth:.7},grateful:{rate:.9,depth:1.1},inspired:{rate:1,depth:1.3},silly:{rate:1.4,depth:1.2},sleepy:{rate:.3,depth:1.4}}},[{key:"update",value:function(t,e){var i,n,a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r=r||{};var s=this.emotionBreathPatterns[e]||{rate:1,depth:1},o=(null===(i=r)||void 0===i?void 0:i.breathRateMult)||1,h=(null===(n=r)||void 0===n?void 0:n.breathDepthMult)||1;this.breathRate=s.rate*this.breathRateMult*o,this.breathDepth=this.breathingDepth*s.depth*this.breathDepthMult*h;var u=this.breathingSpeed*this.breathRate*(t/1e3);this.breathIrregular&&null!==(a=r)&&void 0!==a&&a.breathIrregular&&(u*=.8+.4*Math.sin(3e-4*Date.now())),this.breathingPhase+=u,this.breathingPhase>2*Math.PI&&(this.breathingPhase-=2*Math.PI)}},{key:"getBreathingScale",value:function(){return null!==this.customScale?this.customScale:1+Math.sin(this.breathingPhase)*this.breathDepth}},{key:"setCustomScale",value:function(t){this.customScale=t}},{key:"setBreathingSpeed",value:function(t){this.breathingSpeed=t}},{key:"setBreathingDepth",value:function(t){this.breathingDepth=Math.max(0,Math.min(1,t))}},{key:"setBreathRateMultiplier",value:function(t){this.breathRateMult=t}},{key:"setBreathDepthMultiplier",value:function(t){this.breathDepthMult=t}},{key:"setIrregularBreathing",value:function(t){this.breathIrregular=t}},{key:"reset",value:function(){this.breathingPhase=0,this.breathRate=1,this.breathDepth=this.breathingDepth,this.breathRateMult=1,this.breathDepthMult=1,this.breathIrregular=!1,this.customScale=null}},{key:"holdBreath",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.customScale=t?.92:1.08}},{key:"releaseBreath",value:function(){this.customScale=null}},{key:"getBreathingInfo",value:function(){return{phase:this.breathingPhase,rate:this.breathRate,depth:this.breathDepth,scale:this.getBreathingScale(),isCustom:null!==this.customScale,isIrregular:this.breathIrregular}}}])}();var be=function(){return f(function t(e){u(this,t),this.renderer=e,this.ctx=e.ctx,this.canvas=e.canvas,this.glowIntensity=1,this.glowColor="#4a90e2",this.targetGlowColor="#4a90e2",this.glowColorTransition=0,this.glowColorTransitionSpeed=.05,this.offscreenCanvas=null,this.offscreenCtx=null,this.cachedGlowColor=null,this.cachedGlowRadius=0,this.scaleValue=function(t){return e.scaleValue(t)},this.hexToRgba=function(t,i){return e.hexToRgba(t,i)},this.initOffscreenCanvas()},[{key:"initOffscreenCanvas",value:function(){this.offscreenCanvas=document.createElement("canvas"),this.offscreenCtx=this.offscreenCanvas.getContext("2d")}},{key:"updateOffscreenSize",value:function(t){this.offscreenCanvas.width===t&&this.offscreenCanvas.height===t||(this.offscreenCanvas.width=t,this.offscreenCanvas.height=t,this.cachedGlowColor=null)}},{key:"renderGlow",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=this.ctx,r=n.color||this.glowColor,s=void 0!==n.intensity?n.intensity:this.glowIntensity;if(!(s<.01)){this.scaleValue(200);this.renderGlowDirect(a,t,e,i,r,s)}}},{key:"cacheGlowGradient",value:function(t,e){var i=this.offscreenCtx,n=e;this.updateOffscreenSize(2*e),i.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height);var a=i.createRadialGradient(n,n,0,n,n,e);a.addColorStop(0,this.hexToRgba(t,.4)),a.addColorStop(.3,this.hexToRgba(t,.2)),a.addColorStop(.6,this.hexToRgba(t,.1)),a.addColorStop(1,this.hexToRgba(t,0)),i.fillStyle=a,i.fillRect(0,0,2*e,2*e),this.cachedGlowColor=t,this.cachedGlowRadius=e}},{key:"renderGlowDirect",value:function(t,e,i,n,a,r){t.save();for(var s=t.createRadialGradient(e,i,0,e,i,n),o=0;o<=20;o++){var h=o/20,u=.6*Math.pow(1-h,2.2)*r;s.addColorStop(h,this.hexToRgba(a,u))}t.fillStyle=s,t.beginPath(),t.arc(e,i,n,0,2*Math.PI),t.fill(),t.restore()}},{key:"renderRecordingGlow",value:function(t,e,i,n){var a=this.ctx,r=2.5*i,s=a.createRadialGradient(t,e,0,t,e,r);s.addColorStop(0,"rgba(255, 0, 0, ".concat(.3*n,")")),s.addColorStop(.5,"rgba(255, 0, 0, ".concat(.15*n,")")),s.addColorStop(1,"rgba(255, 0, 0, 0)"),a.save(),a.globalCompositeOperation="screen",a.fillStyle=s,a.fillRect(t-r,e-r,2*r,2*r),a.restore()}},{key:"renderZenGlow",value:function(t,e,i,n){var a=this.ctx,r=i*(.9+.1*(.5*Math.sin(.001*n)+.5)),s=a.createRadialGradient(t,e,0,t,e,r);s.addColorStop(0,"rgba(147, 112, 219, 0.8)"),s.addColorStop(.7,"rgba(147, 112, 219, 0.3)"),s.addColorStop(1,"rgba(147, 112, 219, 0)"),a.save(),a.globalCompositeOperation="screen",a.fillStyle=s,a.beginPath(),a.arc(t,e,1.5*r,0,2*Math.PI),a.fill(),a.restore()}},{key:"updateGlowColor",value:function(t,e){this.targetGlowColor!==t&&(this.targetGlowColor=t,this.glowColorTransition=0),this.glowColorTransition<1&&(this.glowColorTransition=Math.min(1,this.glowColorTransition+this.glowColorTransitionSpeed),this.glowColor=this.lerpColor(this.glowColor,this.targetGlowColor,this.glowColorTransition))}},{key:"lerpColor",value:function(t,e,i){var n=this.hexToRgb(t),a=this.hexToRgb(e),r=Math.round(n.r+(a.r-n.r)*i),s=Math.round(n.g+(a.g-n.g)*i),o=Math.round(n.b+(a.b-n.b)*i);return"#".concat(((1<<24)+(r<<16)+(s<<8)+o).toString(16).slice(1))}},{key:"hexToRgb",value:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}},{key:"setGlowIntensity",value:function(t){this.glowIntensity=Math.max(0,Math.min(1,t))}},{key:"setGlowColor",value:function(t){this.glowColor=t,this.targetGlowColor=t,this.glowColorTransition=1}},{key:"destroy",value:function(){this.offscreenCanvas=null,this.offscreenCtx=null,this.cachedGlowColor=null}}])}();var Me=function(){return f(function t(e){u(this,t),this.renderer=e,this.ctx=e.ctx,this.canvas=e.canvas,this.coreColor="#FFFFFF",this.coreOpacity=1,this.coreBorderWidth=0,this.coreBorderColor=null,this.shapePoints=null,this.isMorphing=!1,this.scaleValue=function(t){return e.scaleValue(t)},this.hexToRgba=function(t,i){return e.hexToRgba(t,i)}},[{key:"renderCore",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=this.ctx,r=n.scaleX||1,s=n.scaleY||1,o=n.rotation||0,h=void 0!==n.opacity?n.opacity:this.coreOpacity,u=n.color||this.coreColor,c=n.shapePoints||this.shapePoints;a.save(),a.translate(t,e),0!==o&&a.rotate(o),a.scale(r,s),a.fillStyle=this.hexToRgba(u,h),c&&c.length>0?this.drawMorphedShape(a,c,i):this.drawCircle(a,i),this.coreBorderWidth>0&&this.coreBorderColor&&(a.strokeStyle=this.coreBorderColor,a.lineWidth=this.scaleValue(this.coreBorderWidth),a.stroke()),a.restore()}},{key:"drawDropShadow",value:function(t,e,i){t.save();var n=this.scaleValue(2);if(t.translate(0,n),i&&i.length>32)t.fillStyle="rgba(0, 0, 0, 0.15)",t.beginPath(),t.arc(0,0,1.05*e,0,2*Math.PI),t.fill();else{var a=t.createRadialGradient(0,0,.7*e,0,0,1.2*e);if(a.addColorStop(0,"rgba(0, 0, 0, 0.2)"),a.addColorStop(.8,"rgba(0, 0, 0, 0.1)"),a.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=a,t.beginPath(),i){var r=1.1,s=i.length>20?2:1;t.moveTo(i[0].x*r,i[0].y*r);for(var o=s;o<i.length;o+=s)t.lineTo(i[o].x*r,i[o].y*r);t.closePath()}else t.arc(0,0,1.1*e,0,2*Math.PI);t.fill()}t.restore()}},{key:"drawCircle",value:function(t,e){t.beginPath(),t.arc(0,0,e,0,2*Math.PI),t.fill()}},{key:"drawMorphedShape",value:function(t,e,i){!e||e.length<3?this.drawCircle(t,i):(t.beginPath(),e.forEach(function(e,i){0===i?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)}),t.closePath(),t.fill())}},{key:"renderZenCore",value:function(t,e,i,n){var a=this.ctx,r=i*(.95+.05*(.5*Math.sin(.001*n)+.5));a.save(),a.shadowBlur=this.scaleValue(10),a.shadowColor="rgba(147, 112, 219, 0.3)",a.shadowOffsetX=0,a.shadowOffsetY=0,a.fillStyle="#FFFFFF",a.beginPath(),a.arc(t,e,r,0,2*Math.PI),a.fill(),a.strokeStyle="rgba(147, 112, 219, 0.2)",a.lineWidth=this.scaleValue(1),a.beginPath(),a.arc(t,e,.9*r,0,2*Math.PI),a.stroke(),a.restore()}},{key:"renderSleepyCore",value:function(t,e,i){var n=this.ctx;n.save(),n.translate(t,e),n.scale(1,.85),n.fillStyle="#FFFFFF",n.beginPath(),n.arc(0,0,i,0,2*Math.PI),n.fill(),n.restore()}},{key:"renderGlitchedCore",value:function(t,e,i,n){var a=this,r=this.ctx;r.save(),[{x:-2,y:0,alpha:.3},{x:2,y:0,alpha:.3},{x:0,y:-1,alpha:.2}].forEach(function(s){r.fillStyle=a.hexToRgba("#FFFFFF",s.alpha*n),r.beginPath(),r.arc(t+s.x*n*a.scaleValue(5),e+s.y*n*a.scaleValue(5),i,0,2*Math.PI),r.fill()}),r.fillStyle="#FFFFFF",r.beginPath(),r.arc(t,e,i,0,2*Math.PI),r.fill(),r.restore()}},{key:"setShapePoints",value:function(t){this.shapePoints=t,this.isMorphing=t&&t.length>0}},{key:"clearShapePoints",value:function(){this.shapePoints=null,this.isMorphing=!1}},{key:"setCoreColor",value:function(t){this.coreColor=t}},{key:"setCoreOpacity",value:function(t){this.coreOpacity=Math.max(0,Math.min(1,t))}},{key:"setCoreBorder",value:function(t,e){this.coreBorderWidth=t,this.coreBorderColor=e}},{key:"getCoreInfo",value:function(){return{color:this.coreColor,opacity:this.coreOpacity,hasBorder:this.coreBorderWidth>0,isMorphing:this.isMorphing,shapePointCount:this.shapePoints?this.shapePoints.length:0}}}])}();var ke=function(){return f(function t(e){u(this,t),this.renderer=e,this.brakeStartTime=null,this.brakeDuration=2500,this.brakeStartRotation=0,this.brakeTargetRotation=0,this.brakeStartVelocity=0,this.onComplete=null,this.onProgress=null,this.DURATION_FACTOR=14},[{key:"brakeToUpright",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.brakeToTarget(0,t)}},{key:"brakeToNearest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.renderer.state.manualRotation||0,n=Math.round(i/t)*t;return this.brakeToTarget(n,e)}},{key:"brakeToTarget",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n){var a=i.onProgress,r=void 0===a?null:a,s=i.onComplete,o=void 0===s?null:s;e.onProgress=r,e.onComplete=o;var h=e.renderer.state.rotationSpeed||0,u=e.renderer.state.manualRotation||0;if(0===h||e.brakeStartTime)n();else{if(e.brakeStartTime=performance.now(),e.brakeStartRotation=u,e.brakeStartVelocity=h,0===t)e.brakeTargetRotation=h>0?360*(Math.floor(u/360)+1):360*Math.floor(u/360);else{var c=t%360,l=Math.floor(u/360);e.brakeTargetRotation=h>0?c>u%360?360*l+c:360*(l+1)+c:c<u%360?360*l+c:360*(l-1)+c}var f=Math.abs(e.brakeTargetRotation-e.brakeStartRotation);e.brakeDuration=Math.max(500,f/Math.abs(h)*e.DURATION_FACTOR*5),e.renderer.setRotationSpeed(0),e.resolvePromise=n}})}},{key:"updateBrake",value:function(t){if(!this.brakeStartTime)return null;var e=t-this.brakeStartTime,i=Math.min(e/this.brakeDuration,1),n=1-Math.pow(1-i,4),a=this.brakeStartRotation+(this.brakeTargetRotation-this.brakeStartRotation)*n,r=this.brakeStartVelocity*Math.pow(1-n,2);return this.onProgress&&this.onProgress(n,r,a),i>=1?(this.brakeStartTime=null,this.complete(),{rotation:this.brakeTargetRotation,speed:0,complete:!0}):{rotation:a,speed:r,complete:!1}}},{key:"stop",value:function(){this.brakeStartTime=null}},{key:"complete",value:function(){this.onComplete&&this.onComplete(),this.resolvePromise&&(this.resolvePromise(),this.resolvePromise=null)}},{key:"isBraking",value:function(){return null!==this.brakeStartTime}},{key:"emergencyStop",value:function(){this.stop(),this.renderer.setRotationSpeed(0),this.complete()}},{key:"getProgress",value:function(){if(!this.brakeStartTime)return 0;var t=performance.now()-this.brakeStartTime;return Math.min(t/this.brakeDuration,1)}}])}();const we=function(){return f(function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this,t),this.canvasManager=e,this.ctx=e.getContext(),this.ctx,this.gestureCompositor=new $t,this.currentUndertone=null,this.gestureAnimator=new de(this),this.colorUtilities=new pe,this.specialEffects=new ye(this),this.eyeRenderer=new me(this),this.breathingAnimator=new ge(this),this.glowRenderer=new be(this),this.coreRenderer=new Me(this),this.rotationBrake=new ke(this),this.config={coreColor:i.coreColor||"#FFFFFF",coreSizeDivisor:i.coreSizeDivisor||12,glowMultiplier:i.glowMultiplier||2.5,defaultGlowColor:i.defaultGlowColor||"#14B8A6",breathingSpeed:i.breathingSpeed||.42,breathingDepth:i.breathingDepth||.08,renderingStyle:i.renderingStyle||"classic",baseScale:i.baseScale||1,referenceSize:400,topOffset:i.topOffset||0};var n=Math.min(this.canvasManager.width||400,this.canvasManager.height||400);this.scaleFactor=n/this.config.referenceSize*this.config.baseScale,this.state={emotion:"neutral",glowColor:this.config.defaultGlowColor,glowIntensity:1,breathRate:1,breathDepth:this.config.breathingDepth,coreJitter:!1,speaking:!1,recording:!1,sleeping:!1,blinking:!1,blinkingEnabled:!0,gazeOffset:{x:0,y:0},gazeIntensity:0,gazeLocked:!1,gazeTrackingEnabled:!1,gazeTarget:{x:0,y:0},zenVortexIntensity:1,squintAmount:0,targetSquintAmount:0,scanPhase:0,lastScanTime:0,isSuspicious:!1,customScale:null,sizeMultiplier:1,jitterAmount:0,episodicFlutter:!1,glowRadiusMult:1,breathRateMult:1,breathDepthMult:1,breathIrregular:!1,particleRateMult:1,manualRotation:0,rotationSpeed:0,lastRotationUpdate:performance.now()},this.animationFrameIds={colorTransition:null,eyeClose:null,eyeOpen:null,zenEnter:null,zenExit:null},this.offscreenCanvas=null,this.offscreenCtx=null,this.initOffscreenCanvas(),this.canvas=e.canvas,this.glowCache=new Map,this.maxCacheSize=10,this.gestureAnimations={bounce:{active:!1,startTime:0,progress:0,params:null},pulse:{active:!1,startTime:0,progress:0,params:null},shake:{active:!1,startTime:0,progress:0,params:null},spin:{active:!1,startTime:0,progress:0,params:null},nod:{active:!1,startTime:0,progress:0,params:null},tilt:{active:!1,startTime:0,progress:0,params:null},expand:{active:!1,startTime:0,progress:0,params:null},contract:{active:!1,startTime:0,progress:0,params:null},flash:{active:!1,startTime:0,progress:0,params:null},drift:{active:!1,startTime:0,progress:0,params:null,startX:0,startY:0},stretch:{active:!1,startTime:0,progress:0,params:null},glow:{active:!1,startTime:0,progress:0,params:null},flicker:{active:!1,startTime:0,progress:0,params:null},vibrate:{active:!1,startTime:0,progress:0,params:null},wave:{active:!1,startTime:0,progress:0,params:null},breathe:{active:!1,startTime:0,progress:0,params:null},morph:{active:!1,startTime:0,progress:0,params:null},slowBlink:{active:!1,startTime:0,progress:0,params:null},look:{active:!1,startTime:0,progress:0,params:null,targetX:0,targetY:0},settle:{active:!1,startTime:0,progress:0,params:null},breathIn:{active:!1,startTime:0,progress:0,params:null},breathOut:{active:!1,startTime:0,progress:0,params:null},breathHold:{active:!1,startTime:0,progress:0,params:null},breathHoldEmpty:{active:!1,startTime:0,progress:0,params:null},jump:{active:!1,startTime:0,progress:0,params:null},orbital:{active:!1,startTime:0,progress:0,params:null},hula:{active:!1,startTime:0,progress:0,params:null}},this.episodicEffects={nervous:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:3e3+2e3*Math.random()},confident:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:4e3+2e3*Math.random()},tired:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:5e3+2e3*Math.random()},intense:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:3e3+3e3*Math.random()},subdued:{active:!1,startTime:0,duration:0,intensity:0,nextTrigger:4e3+3e3*Math.random()}},this.speakingRings=[],this.maxRings=5,this.ringSpawnTimer=0,this.ringSpawnInterval=200,this.recordingRings=[],this.recordingPulse=0,this.sleepZ=[],this.zenTransition={active:!1,phase:null,startTime:0,previousEmotion:null,targetEmotion:null,scaleX:1,scaleY:1,arcHeight:0,lotusMorph:0,petalSpread:0,smileCurve:0},this.colorTransition={active:!1,fromColor:this.state.glowColor,toColor:this.state.glowColor,fromIntensity:this.state.glowIntensity,toIntensity:this.state.glowIntensity,progress:0,startTime:0,duration:1500},this.undertoneModifiers={nervous:{hueShift:0,saturationMult:1.05,brightnessMult:1,brightnessFlicker:.05,sizeMultiplier:1,jitterAmount:0,episodicFlutter:!0,glowRadiusMult:1,glowPulse:.05,breathRateMult:1.1,breathDepthMult:.9,breathIrregular:!0},confident:{hueShift:15,saturationMult:1.2,brightnessMult:1.1,sizeMultiplier:1,jitterAmount:0,episodicPowerPose:!0,glowRadiusMult:1.15,breathRateMult:.95,breathDepthMult:1.1,breathIrregular:!1},tired:{hueShift:-5,saturationMult:.7,brightnessMult:.85,sizeMultiplier:.95,jitterAmount:0,episodicMicroSleep:!0,glowRadiusMult:.9,breathRateMult:.8,breathDepthMult:1.2,breathIrregular:!1},intense:{hueShift:5,saturationMult:1.3,brightnessMult:1.15,sizeMultiplier:1,jitterAmount:0,episodicLaserFocus:!0,glowRadiusMult:1.2,breathRateMult:1.2,breathDepthMult:.9,breathIrregular:!1},subdued:{hueShift:-10,saturationMult:.75,brightnessMult:.9,sizeMultiplier:.95,jitterAmount:0,episodicWithdrawal:!0,glowRadiusMult:.85,breathRateMult:.9,breathDepthMult:.9,breathIrregular:!1}},this.lastFrameTime=0},[{key:"scaleValue",value:function(t){return t*this.scaleFactor}},{key:"initOffscreenCanvas",value:function(){this.offscreenCanvas=document.createElement("canvas"),this.offscreenCtx=this.offscreenCanvas.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),this.offscreenCtx,this.updateOffscreenSize()}},{key:"updateOffscreenSize",value:function(){if(this.offscreenCanvas&&this.canvasManager){var t=this.canvasManager.canvas.width,e=this.canvasManager.canvas.height;this.offscreenCanvas.width===t&&this.offscreenCanvas.height===e||(this.offscreenCanvas.width=t,this.offscreenCanvas.height=e)}}},{key:"render",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.gestureTransform=i,this.updateOffscreenSize();var n=this.canvasManager.width||this.canvas.width||400,a=this.canvasManager.height||this.canvas.height||400,r=this.ctx;if(this.ctx=this.offscreenCtx,this.ctx.clearRect(0,0,n,a),this.stateMachine&&this.stateMachine.getWeightedUndertoneModifiers){var s=this.stateMachine.getWeightedUndertoneModifiers();s?this.applyUndertoneModifiers(s):this.applyUndertoneModifiers(null)}if(this.colorTransition&&this.colorTransition.active&&this.updateColorTransition(e),this.updateTimers(e),this.state.gazeTrackingEnabled){this.state.gazeOffset.x+=.15*(50*this.state.gazeTarget.x-this.state.gazeOffset.x),this.state.gazeOffset.y+=.15*(50*this.state.gazeTarget.y-this.state.gazeOffset.y)}else{this.state.gazeOffset.x+=.1*(0-this.state.gazeOffset.x),this.state.gazeOffset.y+=.1*(0-this.state.gazeOffset.y)}var o=Math.min(n,a),h=n/2,u=a/2-this.config.topOffset;t.properties&&t.properties.verticalOffset&&(u=a/2-this.config.topOffset+a*t.properties.verticalOffset),this.scaleFactor=o/this.config.referenceSize*this.config.baseScale;var c=1,l=0,f=1;i&&(h+=i.x||0,u+=i.y||0,c=i.scale||1,l=(i.rotation||0)*Math.PI/180,f=i.glowIntensity||1);var v=this.gestureAnimator.applyGestureAnimations();if(v&&(h+=v.offsetX||0,u+=v.offsetY||0,c*=v.scale||1,l+=(v.rotation||0)*Math.PI/180,f=v.glow||1),"zen"===this.state.emotion&&"in"===this.zenTransition.phase){var d=Date.now()/1e3;u+=15*Math.sin(.3*d)*this.scaleFactor,h+=8*Math.sin(.2*d)*this.scaleFactor,l+=.05*Math.sin(.25*d)}var p,y,m=1,g=1,b=1;if(this.state.sleeping||"resting"===this.state.emotion||fe("sleeping",this.state)){var M=ce("sleeping");if(M){var k=M.getDimmingValues();m=void 0!==this.state.sleepDimness?this.state.sleepDimness:k.orbDimming,b=k.glowDimming,g=void 0!==this.state.sleepScale?this.state.sleepScale:.9}else m=void 0!==this.state.sleepDimness?this.state.sleepDimness:.3,b=.2,g=void 0!==this.state.sleepScale?this.state.sleepScale:.9;this.state.breathRate=.5,this.state.breathDepth=.15}if(null!==this.state.customScale)p=this.state.customScale,y=1+.5*(this.state.customScale-1);else{"zen"===this.state.emotion?this.state.breathDepth:(this.state.breathDepth,this.state.breathRate);var w=this.breathingAnimator.getBreathingScale();p=w,y=1-.5*(w-1)}"nervous"===this.state.undertone&&this.undertoneModifiers.nervous.glowPulse&&(y*=1+Math.sin(Date.now()/200)*this.undertoneModifiers.nervous.glowPulse);var S=this.config.referenceSize/this.config.coreSizeDivisor*this.scaleFactor,O=t.properties&&t.properties.coreSize?t.properties.coreSize:1,j=this.state.sizeMultiplier||1,F=S*O*p*c*g*j,A=S*this.config.glowMultiplier*y*this.state.glowIntensity*c*g*j*f,x=this.state.glowIntensity*f;this.state.sleeping||"zen"===this.state.emotion||(F*=this.eyeRenderer.getBlinkScale());var B=0,C=0,P=this.state.jitterAmount||0;if(this.currentUndertone&&this.episodicEffects[this.currentUndertone]){var E=this.episodicEffects[this.currentUndertone],T=(this.undertoneModifiers[this.currentUndertone],performance.now());if(!E.active&&T>=E.nextTrigger)switch(E.active=!0,E.startTime=T,this.currentUndertone){case"nervous":E.duration=500+500*Math.random(),E.intensity=2+Math.random(),E.nextTrigger=T+3e3+2e3*Math.random();break;case"confident":E.duration=1e3+1e3*Math.random(),E.intensity=.15,E.nextTrigger=T+4e3+2e3*Math.random();break;case"tired":E.duration=1e3+2e3*Math.random(),E.intensity=.2,E.nextTrigger=T+5e3+2e3*Math.random();break;case"intense":E.duration=500+500*Math.random(),E.intensity=.5,E.nextTrigger=T+3e3+3e3*Math.random();break;case"subdued":E.duration=2e3+1e3*Math.random(),E.intensity=.3,E.nextTrigger=T+4e3+3e3*Math.random()}if(E.active){var R=T-E.startTime;if(R<E.duration){var I=R/E.duration;switch(this.currentUndertone){case"nervous":var z=1-I,D=Math.sin(I*Math.PI*15)*z;B=D*E.intensity,C=D*E.intensity*.7;break;case"confident":var q=Math.sin(I*Math.PI);F*=1+E.intensity*q,A*=1+.5*E.intensity*q;break;case"tired":var _=Math.sin(I*Math.PI*.5);F*=1-E.intensity*_,C+=5*_;break;case"intense":var G=1-Math.cos(I*Math.PI);F*=1-.05*G,A*=1+E.intensity*G;break;case"subdued":var L=Math.sin(I*Math.PI*.5);F*=1-.1*L,A*=1-E.intensity*L}}else E.active=!1}}else if(this.state.coreJitter||P>0){var V=Math.max(P,this.state.coreJitter?this.scaleValue(2):0);B=(Math.random()-.5)*V,C=(Math.random()-.5)*V}var H=h+this.state.gazeOffset.x+B,X=u+this.state.gazeOffset.y+C,Y=performance.now();if(this.rotationBrake&&this.rotationBrake.isBraking()){var U=this.rotationBrake.updateBrake(Y);U&&(this.state.manualRotation=U.rotation,this.state.rotationSpeed=U.complete?0:U.speed)}else 0!==this.state.rotationSpeed&&(this.state.manualRotation+=this.state.rotationSpeed);var N=l+this.state.manualRotation*Math.PI/180;if(0!==N&&(this.ctx.save(),this.ctx.translate(H,X),this.ctx.rotate(N),this.ctx.translate(-H,-X)),fe("recording-glow",this.state)?le("recording-glow",this.ctx,{x:H,y:X,radius:A,deltaTime:e}):fe("zen-vortex",this.state)||(this.state.sleeping||"resting"===this.state.emotion||fe("sleeping",this.state)?(this.ctx.save(),this.ctx.globalAlpha=b,this.glowRenderer.renderGlow(H,X,A,{intensity:x}),this.ctx.restore()):this.glowRenderer.renderGlow(H,X,A,{intensity:x})),v&&v.flashWave){var W=v.flashWave,Q=this.ctx;Q.save(),Q.globalCompositeOperation="lighter";var J=F*W.innerRadius,Z=F*W.outerRadius;if(Z>J){var $=Q.createRadialGradient(H,X,J,H,X,Z);$.addColorStop(0,"rgba(255, 255, 255, 0)"),$.addColorStop(.2,"rgba(255, 255, 255, ".concat(.15*W.intensity,")")),$.addColorStop(.5,"rgba(255, 255, 255, ".concat(.25*W.intensity,")")),$.addColorStop(.8,"rgba(255, 255, 255, ".concat(.15*W.intensity,")")),$.addColorStop(1,"rgba(255, 255, 255, 0)"),Q.fillStyle=$,Q.beginPath(),Q.arc(H,X,Z,0,2*Math.PI),Q.arc(H,X,Math.max(0,J),0,2*Math.PI,!0),Q.fill()}Q.restore()}fe("speaking-pulse",this.state)&&le("speaking-pulse",this.ctx,{x:H,y:X,radius:F,audioLevel:this.state.audioLevel||0,deltaTime:e}),(this.state.sleeping||"resting"===this.state.emotion)&&(this.ctx.globalAlpha=m);var K=null,tt=null;this.shapeMorpher&&(this.shapeMorpher.update(),K=this.shapeMorpher.getCanvasPoints(0,0,F),tt=this.shapeMorpher.getCurrentShadow());var et=!1;!tt||"sun"!==tt.type&&"solar-hybrid"!==tt.type||(this.renderSunEffects(H,X,F,tt),et=!0),this.coreRenderer.renderCore(H,X,F,{scaleX:1,scaleY:1,rotation:N,shapePoints:K}),this.specialEffects&&(this.specialEffects.update(e),this.specialEffects.renderSparkles());var it=this.shapeMorpher?this.shapeMorpher.currentShape:null,nt=this.shapeMorpher?this.shapeMorpher.targetShape:null,at=this.shapeMorpher&&"solar"===nt&&this.shapeMorpher.isTransitioning,rt=this.shapeMorpher&&"solar"===it&&this.shapeMorpher.isTransitioning,st=tt&&"solar-hybrid"===tt.type,ot=this.shapeMorpher&&this.shapeMorpher.isTransitioning&&"solar"===it&&"moon"===nt,ht=this.shapeMorpher&&this.shapeMorpher.isTransitioning&&"moon"===it&&"solar"===nt;if(!tt||"crescent"!==tt.type&&"lunar"!==tt.type||ht||this.renderMoonShadow(H,X,F,tt,K,!1,0),(st&&tt.lunarOverlay||at||rt)&&!ot){var ut=st&&tt.lunarOverlay?tt.lunarOverlay:{type:"lunar",coverage:1,color:"rgba(0, 0, 0, 1.0)",progression:"center"},ct=0,lt=0,ft=0;if(this.shapeMorpher){ft=this.shapeMorpher.getProgress();this.shapeMorpher.currentShape,this.shapeMorpher.targetShape;var vt=2.5*F;at&&ft<1?(ct=-vt*(1-ft),lt=vt*(1-ft)):rt&&ft<1&&(ct=vt*ft,lt=-vt*ft)}if(this.renderMoonShadow(H,X,F,ut,K,!0),(at||rt)&&(at||et))if(this.renderBaileysBeads(H,X,F,ct,lt,ft,at,!0),Math.abs(ct)<30&&Math.abs(lt)<30&&this.specialEffects){var dt=Math.sqrt(ct*ct+lt*lt),pt=Math.max(.1,.5*(1-dt/30));this.specialEffects.triggerChromaticAberration(pt)}}if((this.state.sleeping||"resting"===this.state.emotion)&&(this.ctx.globalAlpha=1),0!==N&&this.ctx.restore(),this.state.sleeping&&this.renderSleepIndicator(h,u-A-this.scaleValue(20),e),this.ctx=r,r.drawImage(this.offscreenCanvas,0,0),fe("recording-glow",this.state)){var yt=ce("recording-glow");yt&&yt.drawRecordingIndicator&&yt.drawRecordingIndicator(r,this.canvas.width,this.canvas.height)}}},{key:"renderRecordingGlow",value:function(t,e,i,n){var a,r,s=(null===(a=this.canvas)||void 0===a?void 0:a.width)||600,o=(null===(r=this.canvas)||void 0===r?void 0:r.height)||600,h=Math.min(i,t-10,e-10,s-t-10,o-e-10),u=Math.max(50,h),c=this.ctx.createRadialGradient(t,e,0,t,e,u);c.addColorStop(0,this.hexToRgba("#FF0000",.7*n)),c.addColorStop(.3,this.hexToRgba("#FF0000",.5*n)),c.addColorStop(.6,this.hexToRgba("#FF0000",.3*n)),c.addColorStop(.85,this.hexToRgba("#FF0000",.1*n)),c.addColorStop(1,this.hexToRgba("#FF0000",0)),this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.arc(t,e,u,0,2*Math.PI),this.ctx.fill()}},{key:"renderDropShadow",value:function(t,e,i,n){var a=this.ctx,r=this.shapeMorpher&&this.shapeMorpher.isTransitioning;if(!(this.shapeMorpher&&(this.shapeMorpher.audioDeformation>.1||this.shapeMorpher.vocalEnergy>.1))&&(!r||this.shapeMorpher.morphProgress>.8)){a.save(),a.translate(t,e);var s=this.scaleValue(2);if(a.translate(0,s),n&&n.length>32)a.fillStyle="rgba(0, 0, 0, 0.15)",a.beginPath(),a.arc(0,0,1.05*i,0,2*Math.PI),a.fill();else{var o=a.createRadialGradient(0,0,.7*i,0,0,1.2*i);if(o.addColorStop(0,"rgba(0, 0, 0, 0.2)"),o.addColorStop(.8,"rgba(0, 0, 0, 0.1)"),o.addColorStop(1,"rgba(0, 0, 0, 0)"),a.fillStyle=o,a.beginPath(),n){var h=1.1,u=n.length>20?2:1;a.moveTo(n[0].x*h,n[0].y*h);for(var c=u;c<n.length;c+=u)a.lineTo(n[c].x*h,n[c].y*h);a.closePath()}else a.arc(0,0,1.1*i,0,2*Math.PI);a.fill()}a.restore()}}},{key:"renderSunEffects",value:function(t,e,i,n){var a=this.ctx,r=Date.now()/100;if(a.save(),a.translate(t,e),n.texture&&(void 0===n.textureOpacity||n.textureOpacity>0)){a.save(),a.globalCompositeOperation="screen",a.globalAlpha=void 0!==n.textureOpacity?n.textureOpacity:1;var s=.05*r*(n.turbulence||.3)/.3,o=a.createRadialGradient(Math.sin(s)*i*.15,Math.cos(.7*s)*i*.15,.2*i,0,0,i);o.addColorStop(0,"rgba(255, 255, 200, 0)"),o.addColorStop(.4,"rgba(255, 200, 100, 0.1)"),o.addColorStop(.7,"rgba(255, 150, 50, 0.08)"),o.addColorStop(1,"rgba(255, 100, 30, 0.05)"),a.fillStyle=o,a.beginPath(),a.arc(0,0,i,0,2*Math.PI),a.fill(),a.restore()}var h=void 0!==n.coronaOpacity?n.coronaOpacity:1;if(h>0){a.save(),a.globalCompositeOperation="screen";var u=a.createRadialGradient(0,0,.5*i,0,0,1.1*i);u.addColorStop(0,"rgba(255, 255, 255, ".concat(.8*h,")")),u.addColorStop(.3,"rgba(255, 250, 200, ".concat(.6*h,")")),u.addColorStop(.5,"rgba(255, 200, 100, ".concat(.4*h,")")),u.addColorStop(.7,"rgba(255, 150, 50, ".concat(.2*h,")")),u.addColorStop(1,"rgba(255, 100, 20, 0)"),a.fillStyle=u,a.beginPath(),a.arc(0,0,1.1*i,0,2*Math.PI),a.fill();for(var c=0;c<2;c++){var l=1.3+.4*c,f=(.35-.15*c)*h,v=.05*Math.sin(.1*r+c),d=a.createRadialGradient(0,0,i*(.9+v),0,0,i*(l+v));d.addColorStop(0,"rgba(255, 255, 200, 0)"),d.addColorStop(.4,"rgba(255, 200, 100, ".concat(.5*f,")")),d.addColorStop(.7,"rgba(255, 150, 50, ".concat(f,")")),d.addColorStop(.9,"rgba(255, 100, 30, ".concat(.5*f,")")),d.addColorStop(1,"rgba(255, 50, 10, 0)"),a.fillStyle=d,a.beginPath(),a.arc(0,0,i*(l+v),0,2*Math.PI),a.fill()}a.restore()}if(n.flares){a.save();var p=Math.sin(.08*r),y=Math.sin(.12*r),m=Math.sin(.16*r),g=a.createLinearGradient(0,-i,0,3*-i);g.addColorStop(0,"rgba(255, 255, 230, 0.4)"),g.addColorStop(.2,"rgba(255, 220, 150, 0.25)"),g.addColorStop(.5,"rgba(255, 180, 80, 0.15)"),g.addColorStop(.8,"rgba(255, 120, 40, 0.08)"),g.addColorStop(1,"rgba(255, 60, 20, 0)"),a.fillStyle=g,a.globalCompositeOperation="screen",a.beginPath();for(var b=function(t,e,n,r){var s=Math.cos(t),o=Math.sin(t),h=s*i,u=o*i,c=s*(i+e),l=o*(i+e),f=-o*n*.5,v=s*n*.5,d=r*n*.3;a.moveTo(h-f,u-v),a.quadraticCurveTo(.5*(h+c)+f*d,.5*(u+l)+v*d,c,l),a.quadraticCurveTo(.5*(h+c)-f*d,.5*(u+l)-v*d,h+f,u+v)},M=0;M<8;M++){b(M/8*Math.PI*2+.1*p,i*(1.8+.4*Math.sin(.1*r+.5*M)),.18*i,Math.sin(.15*r+M))}for(var k=0;k<12;k++){b((k+.5)/12*Math.PI*2+.08*y,i*(1.2+.3*Math.sin(.13*r+.7*k)),.12*i,Math.sin(.18*r+1.2*k))}for(var w=0;w<15;w++){b(w/15*Math.PI*2+.05*m,i*(.7+.25*Math.sin(.17*r+.9*w)),.08*i,Math.sin(.2*r+1.5*w))}for(var S=0;S<15;S++){var O=(S+.25)/15*Math.PI*2,j=i*(.4+.2*Math.sin(.22*r+S)),F=.06*i,A=Math.cos(O),x=Math.sin(O),B=A*i,C=x*i,P=A*(i+j),E=x*(i+j),T=-x*F*.5,R=A*F*.5;a.moveTo(B-T,C-R),a.lineTo(P,E),a.lineTo(B+T,C+R)}a.fill(),a.restore()}var I=a.createRadialGradient(0,0,.95*i,0,0,1.05*i);I.addColorStop(0,"rgba(255, 255, 255, 0)"),I.addColorStop(.7,"rgba(255, 255, 200, 0.2)"),I.addColorStop(.9,"rgba(255, 200, 100, 0.5)"),I.addColorStop(1,"rgba(255, 150, 50, 0.3)"),a.fillStyle=I,a.beginPath(),a.arc(0,0,1.05*i,0,2*Math.PI),a.fill(),a.restore()}},{key:"renderBaileysBeads",value:function(t,e,i,n,a,r,s,o){var h=this,u=this.ctx;if(o){var c=Math.abs(n)<1&&Math.abs(a)<1,l=s?30:15;if(Math.abs(n)<l&&Math.abs(a)<l||c){if(!this.T){var f=Math.floor(4*Math.random())+1;this.R=[];for(var v=[],d=0;d<f;d++)v.push(Math.random()*Math.PI*2);for(var p=Array.from({length:f},function(t,e){return e}),y=p.length-1;y>0;y--){var m=Math.floor(Math.random()*(y+1)),g=[p[m],p[y]];p[y]=g[0],p[m]=g[1]}for(var b=0;b<f;b++)this.R.push({angle:v[b],size:3+5*Math.random(),order:p[b],delay:200*p[b]});this.T=Date.now()}var M=Date.now()-this.T;(this.R||[]).forEach(function(n){if(!(M<n.delay)){var a=M-n.delay,r=Math.min(1,a/300),s=t+Math.cos(n.angle)*i,o=e+Math.sin(n.angle)*i;u.save(),u.translate(s,o),u.globalAlpha=r;var c=h.scaleValue(n.size),l=[{color:"rgba(255, 100, 100, ".concat(.6*r,")"),offset:-2},{color:"rgba(100, 255, 100, ".concat(.6*r,")"),offset:0},{color:"rgba(100, 100, 255, ".concat(.6*r,")"),offset:2}];u.globalCompositeOperation="screen",l.forEach(function(t){var e=t.color,i=t.offset,n=u.createRadialGradient(i,i,0,i,i,2*c);n.addColorStop(0,e),n.addColorStop(.2,e.replace("".concat(.6*r),"".concat(.4*r))),n.addColorStop(.5,e.replace("".concat(.6*r),"".concat(.2*r))),n.addColorStop(1,"rgba(255, 255, 255, 0)"),u.fillStyle=n,u.beginPath(),u.arc(i,i,2*c,0,2*Math.PI),u.fill()}),u.globalCompositeOperation="lighter";var f=u.createRadialGradient(0,0,0,0,0,c);f.addColorStop(0,"rgba(255, 255, 255, ".concat(r,")")),f.addColorStop(.3,"rgba(255, 255, 255, ".concat(.5*r,")")),f.addColorStop(1,"rgba(255, 255, 255, 0)"),u.fillStyle=f,u.beginPath(),u.arc(0,0,c,0,2*Math.PI),u.fill(),u.restore()}})}else this.T=null}else this.T=null}},{key:"renderMoonShadow",value:function(t,e,i,n,a){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=this.ctx;if(s.save(),s.translate(t,e),"crescent"===n.type){var o=1,h=n.offset||.7;if(this.shapeMorpher){var u=this.shapeMorpher.getProgress();this.shapeMorpher.currentShape;if("moon"===this.shapeMorpher.targetShape&&void 0!==u&&u<1&&!n.shadowX){h=2.7*(o=u)-2}}var c=(n.angle||-30)*Math.PI/180,l=Math.cos(c)*i*h,f=Math.sin(c)*i*h;if(s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.beginPath(),a){s.moveTo(a[0].x,a[0].y);for(var v=1;v<a.length;v++)s.lineTo(a[v].x,a[v].y);s.closePath()}else s.arc(0,0,i,0,2*Math.PI);s.clip();var d=s.createRadialGradient(l,f,.9*i,l,f,1.1*i),p=void 0!==n.coverage?n.coverage:.85,y=Math.min(1,1.2*o)*(p/.85);d.addColorStop(0,"rgba(0, 0, 0, ".concat(1*y,")")),d.addColorStop(.8,"rgba(0, 0, 0, ".concat(1*y,")")),d.addColorStop(.88,"rgba(0, 0, 0, ".concat(.98*y,")")),d.addColorStop(.91,"rgba(0, 0, 0, ".concat(.95*y,")")),d.addColorStop(.93,"rgba(0, 0, 0, ".concat(.9*y,")")),d.addColorStop(.95,"rgba(0, 0, 0, ".concat(.8*y,")")),d.addColorStop(.96,"rgba(0, 0, 0, ".concat(.65*y,")")),d.addColorStop(.97,"rgba(0, 0, 0, ".concat(.45*y,")")),d.addColorStop(.98,"rgba(0, 0, 0, ".concat(.25*y,")")),d.addColorStop(.99,"rgba(0, 0, 0, ".concat(.1*y,")")),d.addColorStop(1,"rgba(0, 0, 0, 0)"),s.fillStyle=d,s.beginPath(),s.arc(l,f,1.1*i,0,2*Math.PI),s.fill()}else if("lunar"===n.type){var m=1-(void 0!==n.diffusion?n.diffusion:1),g=0,b=0;if(this.shapeMorpher){var M=this.shapeMorpher.getProgress(),k=this.shapeMorpher.currentShape,w=this.shapeMorpher.targetShape;if(r&&"solar"===w&&void 0!==M&&M<1){var S=2.5*i;g=-S*(1-M),b=S*(1-M)}else if(r&&"solar"===k&&"solar"!==w&&null!==w&&void 0!==M&&M<1){var O=2.5*i;g=O*M,b=-O*M}}s.translate(g,b),r?(s.save(),s.beginPath(),s.arc(-g,-b,i,0,2*Math.PI),s.clip()):(s.beginPath(),s.arc(0,0,i,0,2*Math.PI),s.clip());var j=i*(1.8-.5*m),F=s.createRadialGradient(0,0,.2*i,0,0,j),A=n.coverage||.9;if(n.color&&n.color.includes("0, 0, 0")?(F.addColorStop(0,"rgba(0, 0, 0, ".concat(A,")")),F.addColorStop(.3+.2*m,"rgba(0, 0, 0, ".concat(.95*A,")")),F.addColorStop(.6+.2*m,"rgba(0, 0, 0, ".concat(.8*A,")")),F.addColorStop(.85,"rgba(0, 0, 0, ".concat(.4*A,")")),F.addColorStop(1,"rgba(0, 0, 0, 0)")):(F.addColorStop(0,"rgba(10, 2, 0, ".concat(A,")")),F.addColorStop(.3+.2*m,"rgba(20, 5, 0, ".concat(.95*A,")")),F.addColorStop(.6+.2*m,"rgba(40, 10, 5, ".concat(.8*A,")")),F.addColorStop(.85,"rgba(60, 15, 10, ".concat(.4*A,")")),F.addColorStop(1,"rgba(80, 20, 15, 0)")),s.fillStyle=F,s.beginPath(),s.arc(0,0,j,0,2*Math.PI),s.fill(),m>.3){var x=i*(.8+.3*m),B=s.createRadialGradient(0,0,0,0,0,x);n.color&&n.color.includes("0, 0, 0")?(B.addColorStop(0,"rgba(0, 0, 0, ".concat(A,")")),B.addColorStop(.5,"rgba(0, 0, 0, ".concat(.9*A,")")),B.addColorStop(.8,"rgba(0, 0, 0, ".concat(.5*A,")")),B.addColorStop(1,"rgba(0, 0, 0, 0)")):(B.addColorStop(0,"rgba(0, 0, 0, ".concat(A,")")),B.addColorStop(.5,"rgba(10, 2, 0, ".concat(.9*A,")")),B.addColorStop(.8,"rgba(20, 5, 0, ".concat(.5*A,")")),B.addColorStop(1,"rgba(30, 8, 5, 0)")),s.fillStyle=B,s.beginPath(),s.arc(0,0,x,0,2*Math.PI),s.fill()}}r&&s.restore(),s.restore()}},{key:"renderZenCore",value:function(t,e,i){this.ctx.save(),this.state.shakeOffset&&(t+=this.state.shakeOffset),this.state.driftY&&(e+=this.state.driftY),this.ctx.translate(t,e),this.gestureTransform&&void 0!==this.gestureTransform.rotation&&this.ctx.rotate(this.gestureTransform.rotation*Math.PI/180);var n=Date.now()/1e3,a=.5*Math.sin(.5*n)+1.5,r=.1;"in"===this.zenTransition.phase?r=1:"entering"===this.zenTransition.phase?r=Math.max(.1,3.3*(this.zenTransition.lotusMorph-.7)):"exiting"===this.zenTransition.phase&&(r=Math.max(.1,.5*this.zenTransition.lotusMorph));var s=a*r;if(this.zenTransition.lotusMorph>0){this.ctx.shadowBlur=this.scaleValue(100)*s,this.ctx.shadowColor="rgba(255, 223, 0, ".concat(.5*s,")");var o=this.ctx.createRadialGradient(0,0,0,0,0,4*i);"in"!==this.zenTransition.phase?(o.addColorStop(0,"rgba(184, 134, 11, ".concat(.8,")")),o.addColorStop(.3,"rgba(153, 101, 21, ".concat(.6,")")),o.addColorStop(.6,"rgba(139, 69, 19, ".concat(.4,")")),o.addColorStop(1,"rgba(101, 67, 33, 0)")):(o.addColorStop(0,"rgba(255, 255, 255, ".concat(1*s,")")),o.addColorStop(.1,"rgba(255, 255, 240, ".concat(1*s,")")),o.addColorStop(.2,"rgba(255, 250, 205, ".concat(.95*s,")")),o.addColorStop(.35,"rgba(255, 240, 150, ".concat(.85*s,")")),o.addColorStop(.5,"rgba(255, 223, 0, ".concat(.7*s,")")),o.addColorStop(.65,"rgba(255, 215, 0, ".concat(.5*s,")")),o.addColorStop(.8,"rgba(255, 215, 0, ".concat(.3*s,")")),o.addColorStop(.9,"rgba(255, 215, 0, ".concat(.15*s,")")),o.addColorStop(.95,"rgba(255, 215, 0, ".concat(.05*s,")")),o.addColorStop(1,"rgba(255, 215, 0, 0)")),this.ctx.fillStyle=o,this.ctx.strokeStyle="rgba(255, 255, 255, ".concat(.3,")"),this.ctx.lineWidth=this.scaleValue(2),this.ctx.beginPath(),this.ctx.arc(0,0,i,0,2*Math.PI,!1);var h=this.zenTransition.lotusMorph,u=this.zenTransition.petalSpread,c=this.zenTransition.smileCurve;if(h>.1){var l=i*(.05+.15*h);if(this.ctx.moveTo(0,l),this.ctx.bezierCurveTo(-i*(.05+.25*h*u),.1*i,-i*(.05+.3*h*u),-i*(.1+.4*h),0,-i*(.2+.65*h)),this.ctx.bezierCurveTo(i*(.05+.3*h*u),-i*(.1+.4*h),i*(.05+.25*h*u),.1*i,0,l),h>.3){var f=(h-.3)/.7;this.ctx.moveTo(.1*-i*f,.2*i),this.ctx.bezierCurveTo(-i*(.1+.4*f*u),.1*i,-i*(.2+.5*f*u),-i*(.1+.2*f),-i*(.1+.4*f*u),-i*(.2+.45*f)),this.ctx.bezierCurveTo(-i*(.05+.15*f),-i*(.1+.4*f),.05*-i*f,.1*i,.1*-i*f,.2*i),this.ctx.moveTo(.1*i*f,.2*i),this.ctx.bezierCurveTo(i*(.1+.4*f*u),.1*i,i*(.2+.5*f*u),-i*(.1+.2*f),i*(.1+.4*f*u),-i*(.2+.45*f)),this.ctx.bezierCurveTo(i*(.05+.15*f),-i*(.1+.4*f),.05*i*f,.1*i,.1*i*f,.2*i)}if(c>0){this.ctx.moveTo(.6*-i,i*(.5-.1*c)),this.ctx.quadraticCurveTo(0,i*(.5+.1*c),.6*i,i*(.5-.1*c))}}if(this.ctx.closePath(),this.ctx.fill("evenodd"),this.ctx.beginPath(),this.ctx.arc(0,0,i,0,2*Math.PI),this.ctx.stroke(),"in"===this.zenTransition.phase){var v=2*i,d=this.zenTransition.arcHeight*i,p=.5*i,y=this.ctx.createRadialGradient(0,p,0,0,p,1.2*v);y.addColorStop(0,"rgba(255, 255, 255, ".concat(1*s,")")),y.addColorStop(.25,"rgba(255, 252, 240, ".concat(.8*s,")")),y.addColorStop(.5,"rgba(255, 245, 200, ".concat(.6*s,")")),y.addColorStop(.75,"rgba(255, 235, 150, ".concat(.4*s,")")),y.addColorStop(1,"rgba(255, 223, 0, 0)"),this.ctx.fillStyle=y,this.ctx.fill();var m=this.ctx.createRadialGradient(0,-d/2,.5*i,0,-d/2,5*i);m.addColorStop(0,"rgba(255, 223, 0, 0)"),m.addColorStop(.1,"rgba(255, 223, 0, ".concat(.25*s,")")),m.addColorStop(.2,"rgba(255, 220, 0, ".concat(.2*s,")")),m.addColorStop(.35,"rgba(255, 215, 0, ".concat(.15*s,")")),m.addColorStop(.5,"rgba(255, 215, 0, ".concat(.1*s,")")),m.addColorStop(.65,"rgba(255, 215, 0, ".concat(.06*s,")")),m.addColorStop(.8,"rgba(255, 215, 0, ".concat(.03*s,")")),m.addColorStop(.9,"rgba(255, 215, 0, ".concat(.01*s,")")),m.addColorStop(1,"rgba(255, 215, 0, 0)"),this.ctx.fillStyle=m,this.ctx.fill()}}else{this.ctx.shadowBlur=0,this.ctx.shadowColor="transparent";this.ctx.fillStyle="rgba(255, 215, 0, ".concat(.3,")"),this.ctx.beginPath(),this.ctx.arc(0,0,i,0,2*Math.PI),this.ctx.fill();var g=this.ctx.createRadialGradient(0,0,0,0,0,i);g.addColorStop(0,"rgba(255, 255, 255, 0.2)"),g.addColorStop(.5,"rgba(255, 250, 230, 0.1)"),g.addColorStop(1,"rgba(255, 215, 0, 0)"),this.ctx.fillStyle=g,this.ctx.fill()}this.ctx.restore()}},{key:"renderSpeakingRings",value:function(t,e,i,n){return this.specialEffects.renderSpeakingRings(t,e,i,n)}},{key:"renderRecordingIndicator",value:function(t,e){return this.specialEffects.renderRecordingIndicator(t,e)}},{key:"renderSleepIndicator",value:function(t,e,i){return this.specialEffects.renderSleepIndicator(t,e,i)}},{key:"updateTimers",value:function(t){this.breathingAnimator.update(t,this.state.emotion,this.currentUndertone),"zen"===this.state.emotion?(this.breathingAnimator.setBreathRateMultiplier(.15),this.breathingAnimator.setBreathDepthMultiplier(2.5)):this.state.sleeping?(this.breathingAnimator.setBreathRateMultiplier(.5),this.breathingAnimator.setBreathDepthMultiplier(1.2)):(this.breathingAnimator.setBreathRateMultiplier(1),this.breathingAnimator.setBreathDepthMultiplier(1)),this.breathingAnimator.setIrregularBreathing(this.state.breathIrregular),this.eyeRenderer.setBlinkingEnabled(this.state.blinkingEnabled&&!this.state.sleeping&&"zen"!==this.state.emotion),this.eyeRenderer.update(t),this.state.blinking=this.eyeRenderer.blinking}},{key:"applyUndertoneModifiers",value:function(t){if(t&&"object"===(0,r.A)(t)&&void 0!==t.weight){var e=t.weight;return this.state.sizeMultiplier=1+((t.sizeMultiplier||1)-1)*e,this.state.jitterAmount=(t.jitterAmount||0)*e,this.state.episodicFlutter=e>.5&&t.episodicFlutter||!1,this.state.glowRadiusMult=1+((t.glowRadiusMult||1)-1)*e,this.state.breathRateMult=1+((t.breathRateMult||1)-1)*e,this.state.breathDepthMult=1+((t.breathDepthMult||1)-1)*e,this.state.breathIrregular=e>.5&&t.breathIrregular||!1,void(this.state.particleRateMult=1)}if(!t||!this.undertoneModifiers[t])return this.state.sizeMultiplier=1,this.state.jitterAmount=0,this.state.episodicFlutter=!1,this.state.glowRadiusMult=1,this.state.breathRateMult=1,this.state.breathDepthMult=1,this.state.breathIrregular=!1,void(this.state.particleRateMult=1);var i=this.undertoneModifiers[t];this.state.sizeMultiplier=i.sizeMultiplier,this.state.jitterAmount=i.jitterAmount||0,this.state.episodicFlutter=i.episodicFlutter||!1,this.state.glowRadiusMult=i.glowRadiusMult,this.state.breathRateMult=i.breathRateMult,this.state.breathDepthMult=i.breathDepthMult,this.state.breathIrregular=i.breathIrregular||!1,this.state.particleRateMult=1}},{key:"applyUndertoneToColor",value:function(t,e){return this.colorUtilities.applyUndertoneToColor(t,e)}},{key:"hexToRgb",value:function(t){return this.colorUtilities.hexToRgb(t)}},{key:"rgbToHsl",value:function(t,e,i){return this.colorUtilities.rgbToHsl(t,e,i)}},{key:"hslToHex",value:function(t,e,i){return this.colorUtilities.hslToHex(t,e,i)}},{key:"hexToRgba",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?"rgba(".concat(parseInt(i[1],16),", ").concat(parseInt(i[2],16),", ").concat(parseInt(i[3],16),", ").concat(e,")"):"rgba(0, 0, 0, ".concat(e,")")}},{key:"startColorTransition",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1500;this.colorUtilities.currentColor=this.state.glowColor,this.colorUtilities.currentIntensity=this.state.glowIntensity,this.colorUtilities.startColorTransition(t,e,i),this.colorTransition=this.colorUtilities.colorTransition}},{key:"updateColorTransition",value:function(t){var e=this.colorUtilities.updateColorTransition(t);e&&(this.state.glowColor=e.color,this.state.glowIntensity=e.intensity,this.colorTransition=this.colorUtilities.colorTransition)}},{key:"updateUndertone",value:function(t){this.state.undertone!==t&&this.glowCache.clear(),this.state.undertone=t,this.currentUndertone=t;var e=this.stateMachine&&this.stateMachine.getWeightedUndertoneModifiers?this.stateMachine.getWeightedUndertoneModifiers():null;if(this.applyUndertoneModifiers(e||t),this.state.emotion){var i=U(this.state.emotion);if(i){var n=i.glowColor||this.config.defaultGlowColor,a=this.applyUndertoneToColor(n,e||t);this.startColorTransition(a,200)}}}},{key:"setEmotionalState",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.state.emotion===t&&this.state.undertone===i||this.glowCache.clear(),this.state.undertone=i,this.currentUndertone=i;var n=this.stateMachine&&this.stateMachine.getWeightedUndertoneModifiers?this.stateMachine.getWeightedUndertoneModifiers():null;this.applyUndertoneModifiers(n||i);var a,r=e.glowColor||this.config.defaultGlowColor;a="suspicion"===t?e.glowColor||r:this.applyUndertoneToColor(r,n||i);var s=n||(i?this.undertoneModifiers[i]:null),o=e.glowIntensity||1,h=1;if(s)if(n){var u=s.weight||0;h=void 0!==s.glowRadiusMult&&isFinite(s.glowRadiusMult)&&isFinite(u)?1+(s.glowRadiusMult-1)*u:1}else h=void 0!==s.glowRadiusMult?s.glowRadiusMult:1;var c=o*h,l=1500;"anger"===t||"fear"===t?l=800:("sadness"===t||"resting"===t||"zen"===t)&&(l=2e3);var f=this.state.emotion;this.state.emotion=t,"suspicion"===t?(this.state.isSuspicious=!0,this.state.targetSquintAmount=e&&e.coreSquint?e.coreSquint:.4,void 0===this.state.squintAmount&&(this.state.squintAmount=0),this.state.lastScanTime=Date.now(),this.state.scanPhase=0):(this.state.isSuspicious=!1,this.state.targetSquintAmount=0,void 0===this.state.squintAmount&&(this.state.squintAmount=0)),"zen"===t&&"zen"!==f?this.enterZenMode(a,c):"zen"===f&&"zen"!==t?this.exitZenMode(t,a,c):this.startColorTransition(a,c,l);var v=e.breathRate||1,d=e.breathDepth||this.config.breathingDepth;this.state.breathRate=s?v*s.breathRateMult:v,this.state.breathDepth=s?d*s.breathDepthMult:d,this.state.coreJitter=e.coreJitter||s&&s.jitterAmount>0,this.state.emotionEyeOpenness=e.eyeOpenness,this.state.emotionEyeArc=e.eyeArc}},{key:"setBPM",value:function(t){}},{key:"setRotationSpeed",value:function(t){this.state.rotationSpeed=t}},{key:"setRotationAngle",value:function(t){this.state.manualRotation=t}},{key:"setGazeOffset",value:function(t){"object"===(0,r.A)(t)&&null!==t&&(t.hasOwnProperty("x")&&t.hasOwnProperty("y")?this.state.gazeOffset=t:(this.state.gazeOffset=t.offset||{x:0,y:0},this.state.gazeIntensity=t.proximity||0,this.state.gazeLocked=t.isLocked||!1)),this.idleTimer=0,this.isAsleep&&this.wakeUp()}},{key:"getCurrentOrbPosition",value:function(){var t=this.canvasManager.width/2,e=this.canvasManager.height/2-this.config.topOffset;return{x:t+this.state.gazeOffset.x,y:e+this.state.gazeOffset.y}}},{key:"setCustomScale",value:function(t){this.state.customScale=t}},{key:"startSpeaking",value:function(){this.state.speaking=!0,this.speakingRings=[],this.ringSpawnTimer=0}},{key:"stopSpeaking",value:function(){this.state.speaking=!1,this.speakingRings=[]}},{key:"enterSleepMode",value:function(){this.state.sleeping=!0,this.sleepZ=[],this.state.eyeOpenness=1,this.state.sleepDimness=1,this.state.sleepScale=1,this.state.blinking=!1,this.animateEyeClose()}},{key:"animateEyeClose",value:function(){var t=this;this.animationFrameIds.eyeClose&&(cancelAnimationFrame(this.animationFrameIds.eyeClose),this.animationFrameIds.eyeClose=null),this.animationFrameIds.eyeOpen&&(cancelAnimationFrame(this.animationFrameIds.eyeOpen),this.animationFrameIds.eyeOpen=null);var e=performance.now(),i=2e3,n=function(){if(t.state.sleeping){var a=performance.now()-e;if(a<i){var r=a/i,s=1-Math.pow(r,2);t.state.eyeOpenness=.1+.9*s,t.state.sleepDimness=1,t.state.sleepScale=1,t.animationFrameIds.eyeClose=requestAnimationFrame(n)}else if(a<3e3){var o=(a-i)/1e3,h=1-Math.pow(1-o,3);t.state.eyeOpenness=.1,t.state.sleepDimness=1-.4*h,t.state.sleepScale=1-.1*h,t.animationFrameIds.eyeClose=requestAnimationFrame(n)}else t.state.eyeOpenness=.1,t.state.sleepDimness=.6,t.state.sleepScale=.9,t.animationFrameIds.eyeClose=null}else t.animationFrameIds.eyeClose=null};this.animationFrameIds.eyeClose=requestAnimationFrame(n)}},{key:"wakeUp",value:function(){var t=this;this.state.sleeping&&(this.state.sleeping=!1,this.state.breathRate=1,this.state.breathDepth=this.config.breathingDepth,this.sleepZ=[],this.state.blinking=!1,this.eyeRenderer.blinking=!1,this.eyeRenderer.blinkTimer=0,this.animateEyeOpen(),this.state.coreJitter=!0,setTimeout(function(){t.state.coreJitter=!1},200))}},{key:"animateEyeOpen",value:function(){var t=this;this.animationFrameIds.eyeOpen&&(cancelAnimationFrame(this.animationFrameIds.eyeOpen),this.animationFrameIds.eyeOpen=null),this.animationFrameIds.eyeClose&&(cancelAnimationFrame(this.animationFrameIds.eyeClose),this.animationFrameIds.eyeClose=null);var e=performance.now(),i=500,n=function(){var a=performance.now()-e;if(a<i){var r=a/i,s=Math.sin(r*Math.PI/2);t.state.sleepDimness=.6+.4*s,t.state.sleepScale=.9+.1*s,t.state.eyeOpenness=.1,t.animationFrameIds.eyeOpen=requestAnimationFrame(n)}else if(a<1500){var o=(a-i)/1e3,h=Math.sin(o*Math.PI/2);t.state.sleepDimness=1,t.state.sleepScale=1,t.state.eyeOpenness=.1+.9*h,t.animationFrameIds.eyeOpen=requestAnimationFrame(n)}else t.state.eyeOpenness=1,t.state.sleepDimness=1,t.state.sleepScale=1,t.animationFrameIds.eyeOpen=null};this.animationFrameIds.eyeOpen=requestAnimationFrame(n)}},{key:"enterZenMode",value:function(t,e){var i=this;this.animationFrameIds.zenEnter&&(cancelAnimationFrame(this.animationFrameIds.zenEnter),this.animationFrameIds.zenEnter=null),this.animationFrameIds.zenExit&&(cancelAnimationFrame(this.animationFrameIds.zenExit),this.animationFrameIds.zenExit=null),this.state.glowColor=t,this.state.glowIntensity=e,this.colorTransition.active=!1,this.zenTransition={active:!0,phase:"entering",startTime:performance.now(),previousEmotion:this.state.emotion,targetEmotion:null,scaleX:1,scaleY:1,arcHeight:0,lotusMorph:0,petalSpread:0,smileCurve:0};var n=function(){if(i.zenTransition.active&&"entering"===i.zenTransition.phase){var t=performance.now()-i.zenTransition.startTime;if(t<400){var e=t/400,a=1-Math.pow(1-e,2);i.zenTransition.scaleX=1,i.zenTransition.scaleY=1,i.zenTransition.arcHeight=0,i.zenTransition.lotusMorph=a,i.zenTransition.petalSpread=a,i.zenTransition.smileCurve=Math.sin(e*Math.PI/2),i.animationFrameIds.zenEnter=requestAnimationFrame(n)}else i.zenTransition.phase="in",i.zenTransition.scaleX=1,i.zenTransition.scaleY=1,i.zenTransition.arcHeight=0,i.zenTransition.lotusMorph=1,i.zenTransition.petalSpread=1,i.zenTransition.smileCurve=1,i.state.zenVortexIntensity=1,i.animationFrameIds.zenEnter=null}else i.animationFrameIds.zenEnter=null};this.animationFrameIds.zenEnter=requestAnimationFrame(n)}},{key:"exitZenMode",value:function(t,e,i){var n=this;if(this.zenTransition.active&&"in"===this.zenTransition.phase){this.animationFrameIds.zenEnter&&(cancelAnimationFrame(this.animationFrameIds.zenEnter),this.animationFrameIds.zenEnter=null),this.animationFrameIds.zenExit&&(cancelAnimationFrame(this.animationFrameIds.zenExit),this.animationFrameIds.zenExit=null),this.zenTransition.phase="exiting",this.zenTransition.startTime=performance.now(),this.zenTransition.targetEmotion=t;var a=function(){if(n.zenTransition.active&&"exiting"===n.zenTransition.phase){var t=performance.now()-n.zenTransition.startTime,r=150,s=200,o=200;if(t<r){var h=t/r,u=1-Math.pow(1-h,2);if(0!==h&&n.colorTransition.active||n.startColorTransition(e,i,r),n.zenTransition.arcHeight=1.5*(1-u),n.zenTransition.smileCurve=1*(1-u),h>.3){var c=(h-.3)/.7;n.zenTransition.petalSpread=1*(1-c)}if(h>.5){var l=(h-.5)/.5;n.zenTransition.lotusMorph=1*(1-l)}n.animationFrameIds.zenExit=requestAnimationFrame(a)}else if(t<350){var f=(t-r)/s;if(n.zenTransition.lotusMorph=0,n.zenTransition.petalSpread=0,n.zenTransition.smileCurve=0,f<.2){var v=f/.2;n.zenTransition.scaleY=1-.8*Math.sin(v*Math.PI)}else if(f<.6){var d=(f-.2)/.4;n.zenTransition.scaleY=1,n.state.shakeOffset=3*Math.sin(d*Math.PI*4)}else{var p=(f-.6)/.4;n.state.driftY=-10*p,n.state.glowIntensity=1+.5*p}n.animationFrameIds.zenExit=requestAnimationFrame(a)}else if(t<550){var y=(t-r-s)/o,m=Math.sin(y*Math.PI/2);n.zenTransition.scaleX=1,n.zenTransition.scaleY=.2+.8*m,n.state.driftY=-10*(1-y),n.state.glowIntensity=1.5-.5*y,n.animationFrameIds.zenExit=requestAnimationFrame(a)}else if(t<650){var g=(t-r-s-o)/100,b=Math.sin(g*Math.PI);n.zenTransition.scaleX=1+.05*b,n.zenTransition.scaleY=1+.05*b,n.animationFrameIds.zenExit=requestAnimationFrame(a)}else n.zenTransition.active=!1,n.zenTransition.phase=null,n.zenTransition.scaleX=1,n.zenTransition.scaleY=1,n.zenTransition.arcHeight=0,n.zenTransition.lotusMorph=0,n.zenTransition.petalSpread=0,n.zenTransition.smileCurve=0,n.state.shakeOffset=0,n.state.driftY=0,n.animationFrameIds.zenExit=null}else n.animationFrameIds.zenExit=null};this.animationFrameIds.zenExit=requestAnimationFrame(a)}}},{key:"startRecording",value:function(){this.state.recording=!0}},{key:"stopRecording",value:function(){this.state.recording=!1}},{key:"setBlinkingEnabled",value:function(t){this.state.blinkingEnabled=t,t||(this.state.blinking=!1,this.eyeRenderer.blinking=!1,this.eyeRenderer.blinkTimer=0)}},{key:"setGazeTracking",value:function(t){this.state.gazeTrackingEnabled=t,t?this.gazeTrackingInitialized||this.initGazeTracking():this.state.gazeTarget={x:0,y:0}}},{key:"initGazeTracking",value:function(){var t=this;this.gazeTrackingInitialized||(this.handleMouseMove=function(e){if(t.state.gazeTrackingEnabled){var i=t.canvas.getBoundingClientRect(),n=i.width/2,a=i.height/2,r=e.clientX-i.left-n,s=e.clientY-i.top-a;t.state.gazeTarget={x:r/n,y:s/a}}},this.handleTouchMove=function(e){if(t.state.gazeTrackingEnabled&&e.touches.length>0){var i=e.touches[0],n=t.canvas.getBoundingClientRect(),a=n.width/2,r=n.height/2,s=i.clientX-n.left-a,o=i.clientY-n.top-r;t.state.gazeTarget={x:s/a,y:o/r}}},document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),this.gazeTrackingInitialized=!0)}},{key:"cleanupGazeTracking",value:function(){this.gazeTrackingInitialized&&(this.handleMouseMove&&document.removeEventListener("mousemove",this.handleMouseMove),this.handleTouchMove&&document.removeEventListener("touchmove",this.handleTouchMove),this.gazeTrackingInitialized=!1)}},{key:"setQualityLevel",value:function(t){this.qualityLevel=Math.max(0,Math.min(1,t)),this.qualityLevel<.5?(this.ctx.imageSmoothingEnabled=!1,this.state.breathDepth*=.5):this.qualityLevel<.8?(this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="medium"):(this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high")}},{key:"setQualityReduction",value:function(t){t?this.setQualityLevel(.5):this.setQualityLevel(1)}},{key:"handleContextRecovery",value:function(t){this.ctx=t}},{key:"getUndertoneModifier",value:function(){return this.stateMachine&&this.stateMachine.getWeightedUndertoneModifiers?this.stateMachine.getWeightedUndertoneModifiers():this.currentUndertone&&this.undertoneModifiers[this.currentUndertone]?this.undertoneModifiers[this.currentUndertone]:null}},{key:"applyGestureAnimations",value:function(){return this.gestureAnimator.applyGestureAnimations()}},{key:"startGesture",value:function(t){return this.gestureAnimator.startGesture(t)}},{key:"getCurrentGesture",value:function(){return this.gestureAnimator.getCurrentGesture()}},{key:"startBounce",value:function(){this.gestureAnimator.startBounce()}},{key:"startPulse",value:function(){this.gestureAnimator.startPulse()}},{key:"startShake",value:function(){this.gestureAnimator.startShake()}},{key:"startSpin",value:function(){this.gestureAnimator.startSpin()}},{key:"startNod",value:function(){this.gestureAnimator.startNod()}},{key:"startTilt",value:function(){this.gestureAnimator.startTilt()}},{key:"startExpand",value:function(){this.gestureAnimator.startExpand()}},{key:"startContract",value:function(){this.gestureAnimator.startContract()}},{key:"startFlash",value:function(){this.gestureAnimator.startFlash()}},{key:"startDrift",value:function(){this.gestureAnimator.startDrift()}},{key:"startStretch",value:function(){this.gestureAnimator.startStretch()}},{key:"startGlow",value:function(){this.gestureAnimator.startGlow()}},{key:"startFlicker",value:function(){this.gestureAnimator.startFlicker()}},{key:"startVibrate",value:function(){this.gestureAnimator.startVibrate()}},{key:"startOrbital",value:function(){this.gestureAnimator.startOrbital()}},{key:"startHula",value:function(){this.gestureAnimator.startHula()}},{key:"startWave",value:function(){this.gestureAnimator.startWave()}},{key:"startBreathe",value:function(){this.gestureAnimator.startBreathe()}},{key:"startMorph",value:function(){this.gestureAnimator.startMorph()}},{key:"startSlowBlink",value:function(){this.gestureAnimator.startSlowBlink()}},{key:"startLook",value:function(){this.gestureAnimator.startLook()}},{key:"startSettle",value:function(){this.gestureAnimator.startSettle()}},{key:"startBreathIn",value:function(){this.gestureAnimator.startBreathIn()}},{key:"startBreathOut",value:function(){this.gestureAnimator.startBreathOut()}},{key:"startBreathHold",value:function(){this.gestureAnimator.startBreathHold()}},{key:"startBreathHoldEmpty",value:function(){this.gestureAnimator.startBreathHoldEmpty()}},{key:"startJump",value:function(){this.gestureAnimator.startJump()}},{key:"startSway",value:function(){this.gestureAnimator.startSway()}},{key:"startFloat",value:function(){this.gestureAnimator.startFloat()}},{key:"startRain",value:function(){this.gestureAnimator.startRain()}},{key:"startRunningMan",value:function(){this.gestureAnimator.startRunningMan()}},{key:"startCharleston",value:function(){this.gestureAnimator.startCharleston()}},{key:"startSparkle",value:function(){this.gestureAnimator.startSparkle()}},{key:"startShimmer",value:function(){this.gestureAnimator.startShimmer()}},{key:"startWiggle",value:function(){this.gestureAnimator.startWiggle()}},{key:"startGroove",value:function(){this.gestureAnimator.startGroove()}},{key:"startPoint",value:function(){this.gestureAnimator.startPoint()}},{key:"startLean",value:function(){this.gestureAnimator.startLean()}},{key:"startReach",value:function(){this.gestureAnimator.startReach()}},{key:"startHeadBob",value:function(){this.gestureAnimator.startHeadBob()}},{key:"startOrbit",value:function(){this.gestureAnimator.startOrbit()}},{key:"stopAllGestures",value:function(){this.gestureAnimator.stopAllGestures(),this.currentGesture=null}},{key:"isGestureActive",value:function(){return Object.values(this.gestureAnimator.gestureAnimations).some(function(t){return t.active})}},{key:"destroy",value:function(){for(var t in this.animationFrameIds)this.animationFrameIds[t]&&(cancelAnimationFrame(this.animationFrameIds[t]),this.animationFrameIds[t]=null);this.colorTransition.active=!1,this.zenTransition&&(this.zenTransition.active=!1),this.speakingRings=[],this.gestureCompositor&&this.gestureCompositor.clearCache()}}])}();function Se(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Oe(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Se(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Se(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function je(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Fe(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Fe(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function Fe(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}const Ae=function(){return f(function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this,t),this.canvas=e,this.config={smoothing:n.smoothing||.1,maxOffset:n.maxOffset||.3,lockDistance:n.lockDistance||30,enabled:!1!==n.enabled,boundaryPadding:n.boundaryPadding||.8},this.canvasCenter={x:0,y:0},this.mousePos={x:0,y:0},this.targetGaze={x:0,y:0},this.currentGaze={x:0,y:0},this.isLocked=!1,this.proximity=0,this.cachedRect=null,this.touches=new Map,this.primaryTouch=null,this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.onInteraction=null,this.updateCanvasCenter(),this.attachEventListeners(),this.resizeObserver=new ResizeObserver(function(){i.updateCanvasCenter()}),this.resizeObserver.observe(this.canvas)},[{key:"updateCanvasCenter",value:function(){this.cachedRect=this.canvas.getBoundingClientRect(),this.canvasCenter={x:this.cachedRect.width/2,y:this.cachedRect.height/2},0===this.mousePos.x&&0===this.mousePos.y&&(this.mousePos={x:this.canvasCenter.x,y:this.canvasCenter.y})}},{key:"attachEventListeners",value:function(){this.config.enabled&&(this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseleave",this.handleMouseLeave),this.canvas.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.canvas.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.canvas.addEventListener("touchend",this.handleTouchEnd,{passive:!0}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd,{passive:!0}))}},{key:"handleMouseMove",value:function(t){var e=this.cachedRect||this.canvas.getBoundingClientRect();this.mousePos={x:t.clientX-e.left,y:t.clientY-e.top},this.updateTargetGaze(),this.onInteraction&&this.onInteraction("mouse")}},{key:"handleMouseLeave",value:function(){this.targetGaze={x:0,y:0},this.isLocked=!1,this.proximity=0,this.mousePos={x:this.canvasCenter.x,y:this.canvasCenter.y}}},{key:"handleTouchStart",value:function(t){var e,i=je(t.changedTouches);try{for(i.s();!(e=i.n()).done;){var n=e.value;this.touches.set(n.identifier,{x:n.clientX,y:n.clientY}),this.primaryTouch||1!==this.touches.size||(this.primaryTouch=n.identifier)}}catch(t){i.e(t)}finally{i.f()}null!==this.primaryTouch&&this.updateTouchPosition(t.touches)}},{key:"handleTouchMove",value:function(t){var e,i=je(t.changedTouches);try{for(i.s();!(e=i.n()).done;){var n=e.value;this.touches.has(n.identifier)&&this.touches.set(n.identifier,{x:n.clientX,y:n.clientY})}}catch(t){i.e(t)}finally{i.f()}null!==this.primaryTouch&&(this.updateTouchPosition(t.touches),this.onInteraction&&this.onInteraction("touch"))}},{key:"handleTouchEnd",value:function(t){var e,i=je(t.changedTouches);try{for(i.s();!(e=i.n()).done;){var n=e.value;this.touches.delete(n.identifier),n.identifier===this.primaryTouch&&(this.primaryTouch=null,this.touches.size>0?this.primaryTouch=this.touches.keys().next().value:this.handleMouseLeave())}}catch(t){i.e(t)}finally{i.f()}}},{key:"updateTouchPosition",value:function(t){var e,i=je(t);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.identifier===this.primaryTouch){var a=this.cachedRect||this.canvas.getBoundingClientRect();this.mousePos={x:n.clientX-a.left,y:n.clientY-a.top},this.updateTargetGaze();break}}}catch(t){i.e(t)}finally{i.f()}}},{key:"updateTargetGaze",value:function(){var t=this.mousePos.x-this.canvasCenter.x,e=this.mousePos.y-this.canvasCenter.y,i=Math.sqrt(t*t+e*e),n=Math.min(this.canvasCenter.x,this.canvasCenter.y);if(this.proximity=Math.max(0,1-i/n),this.isLocked=i<this.config.lockDistance,this.isLocked)this.targetGaze={x:t*this.config.maxOffset*2,y:e*this.config.maxOffset*2};else{var a=Math.min(this.canvasCenter.x,this.canvasCenter.y)*this.config.maxOffset;if(i>0){var r=Math.min(1,i/n);this.targetGaze={x:t/i*a*r*this.config.boundaryPadding,y:e/i*a*r*this.config.boundaryPadding}}else this.targetGaze={x:0,y:0}}}},{key:"update",value:function(t){if(this.config.enabled){var e=1-Math.pow(1-this.config.smoothing,t/16.67);if(this.currentGaze.x+=(this.targetGaze.x-this.currentGaze.x)*e,this.currentGaze.y+=(this.targetGaze.y-this.currentGaze.y)*e,this.isLocked){this.currentGaze.x+=.5*(Math.random()-.5),this.currentGaze.y+=.5*(Math.random()-.5)}}}},{key:"getGazeOffset",value:function(t){return{x:this.currentGaze.x,y:this.currentGaze.y}}},{key:"getState",value:function(){return{gaze:Oe({},this.currentGaze),target:Oe({},this.targetGaze),proximity:this.proximity,isLocked:this.isLocked,isActive:this.config.enabled}}},{key:"enable",value:function(){this.config.enabled||(this.config.enabled=!0,this.attachEventListeners())}},{key:"disable",value:function(){this.config.enabled&&(this.config.enabled=!1,this.detachEventListeners(),this.targetGaze={x:0,y:0})}},{key:"detachEventListeners",value:function(){this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("touchcancel",this.handleTouchEnd)}},{key:"setInteractionCallback",value:function(t){this.onInteraction=t}},{key:"destroy",value:function(){this.detachEventListeners(),this.resizeObserver&&this.resizeObserver.disconnect(),this.touches.clear()}}])}();function xe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Be(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?xe(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):xe(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const Ce=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.config={blinkInterval:e.blinkInterval||{min:3e3,max:7e3},blinkDuration:e.blinkDuration||150,swayInterval:e.swayInterval||{min:2e4,max:4e4},swayDuration:e.swayDuration||4e3,swayIntensity:e.swayIntensity||1.5,sleepTimeout:void 0!==e.sleepTimeout?e.sleepTimeout:1/0,breathingSpeed:e.breathingSpeed||.25,breathingDepth:e.breathingDepth||.1,enabled:!1!==e.enabled},this.state={isBlinking:!1,isSwaying:!1,isAsleep:!1,breathingPhase:0,breathRate:1,breathDepth:this.config.breathingDepth},this.timers={idle:0,blink:0,sway:0,swayProgress:0,nextBlink:this.getRandomInterval("blink"),nextSway:this.getRandomInterval("sway")},this.swayOffset={x:0,y:0},this.swayTarget={x:0,y:0},this.swayStart={x:0,y:0},this.callbacks={onBlink:null,onSway:null,onSleep:null,onWake:null}},[{key:"update",value:function(t){this.config.enabled&&(this.updateBreathing(t),this.timers.idle+=t,!this.state.isAsleep&&this.timers.idle>=this.config.sleepTimeout&&this.enterSleep(),this.state.isAsleep||this.updateBlinking(t),this.state.isAsleep||this.updateSwaying(t))}},{key:"updateBreathing",value:function(t){var e=this.config.breathingSpeed*this.state.breathRate;this.state.breathingPhase+=e*t/1e3,this.state.breathingPhase>2*Math.PI&&(this.state.breathingPhase-=2*Math.PI)}},{key:"updateBlinking",value:function(t){this.isBlinkingEnabled()&&(this.state.isBlinking?(this.timers.blink+=t,this.timers.blink>=this.config.blinkDuration&&this.endBlink()):(this.timers.blink+=t,this.timers.blink>=this.timers.nextBlink&&this.startBlink()))}},{key:"updateSwaying",value:function(t){if(this.state.isSwaying){this.timers.sway+=t;var e=Math.min(this.timers.sway/this.config.swayDuration,1),i=(Math.sin((e-.5)*Math.PI)+1)/2;this.swayOffset.x=this.swayStart.x+(this.swayTarget.x-this.swayStart.x)*i,this.swayOffset.y=this.swayStart.y+(this.swayTarget.y-this.swayStart.y)*i,e>=1&&this.endSway()}else this.timers.sway+=t,this.timers.sway>=this.timers.nextSway&&this.startSway()}},{key:"startBlink",value:function(){this.state.isBlinking=!0,this.timers.blink=0,this.callbacks.onBlink&&this.callbacks.onBlink({phase:"start"})}},{key:"endBlink",value:function(){this.state.isBlinking=!1,this.timers.blink=0,this.timers.nextBlink=this.getRandomInterval("blink"),this.callbacks.onBlink&&this.callbacks.onBlink({phase:"end"})}},{key:"startSway",value:function(){this.state.isSwaying=!0,this.timers.sway=0,this.swayStart=Be({},this.swayOffset);var t=Math.random()*Math.PI*2,e=this.config.swayIntensity*(.5+.5*Math.random());this.swayTarget={x:Math.cos(t)*e*1.5,y:Math.sin(t)*e*.5},this.callbacks.onSway&&this.callbacks.onSway({phase:"start",offset:this.swayOffset})}},{key:"endSway",value:function(){this.state.isSwaying=!1,this.timers.sway=0,this.timers.nextSway=this.getRandomInterval("sway"),this.swayStart=Be({},this.swayOffset),this.callbacks.onSway&&this.callbacks.onSway({phase:"end",offset:this.swayOffset})}},{key:"enterSleep",value:function(){this.state.isAsleep=!0,this.state.breathRate=.5,this.state.breathDepth=.15,this.state.isBlinking&&(this.state.isBlinking=!1,this.timers.blink=0,this.callbacks.onBlink&&this.callbacks.onBlink({phase:"end"})),this.callbacks.onSleep&&this.callbacks.onSleep()}},{key:"wakeUp",value:function(){this.state.isAsleep&&(this.state.isAsleep=!1,this.state.breathRate=1,this.state.breathDepth=this.config.breathingDepth,this.timers.idle=0,this.callbacks.onWake&&this.callbacks.onWake(),this.performWakeAnimation())}},{key:"performWakeAnimation",value:function(){var t=this,e={x:.5*this.config.swayIntensity,y:-this.config.swayIntensity};this.swayStart=Be({},this.swayOffset),this.swayTarget=e,this.state.isSwaying=!0,this.timers.sway=0,this.callbacks.onSway&&this.callbacks.onSway({phase:"wake",offset:this.swayOffset}),setTimeout(function(){t.swayStart=Be({},t.swayOffset),t.swayTarget={x:0,y:0},t.timers.sway=0},1e3)}},{key:"resetIdleTimer",value:function(){this.timers.idle=0,this.state.isAsleep&&this.wakeUp()}},{key:"setBlinkingEnabled",value:function(t){this.config.blinkingEnabled=t,!t&&this.state.isBlinking&&this.endBlink()}},{key:"isBlinkingEnabled",value:function(){return!1!==this.config.blinkingEnabled}},{key:"getBreathingFactor",value:function(){return 1+Math.sin(this.state.breathingPhase)*this.state.breathDepth*this.state.breathRate}},{key:"getBlinkProgress",value:function(){return this.state.isBlinking?Math.min(this.timers.blink/this.config.blinkDuration,1):0}},{key:"getSwayOffset",value:function(){return this.swayOffset||{x:0,y:0}}},{key:"getRandomInterval",value:function(t){var e=this.config["".concat(t,"Interval")];return e.min+Math.random()*(e.max-e.min)}},{key:"setCallback",value:function(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}},{key:"getState",value:function(){return Be(Be({},this.state),{},{breathingFactor:this.getBreathingFactor(),blinkProgress:this.getBlinkProgress(),swayOffset:this.getSwayOffset()})}},{key:"enable",value:function(){this.config.enabled=!0}},{key:"disable",value:function(){this.config.enabled=!1,this.state.isBlinking=!1,this.state.isSwaying=!1,this.swayOffset={x:0,y:0}}},{key:"destroy",value:function(){this.callbacks={onBlink:null,onSway:null,onSleep:null,onWake:null}}}])}();function Pe(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Ee(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ee(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function Ee(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}const Te=function(){return f(function t(){u(this,t),this.A4_FREQUENCY=440,this.NOTES=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this.INTERVALS={unison:0,minorSecond:1,majorSecond:2,minorThird:3,majorThird:4,perfectFourth:5,tritone:6,perfectFifth:7,minorSixth:8,majorSixth:9,minorSeventh:10,majorSeventh:11,octave:12},this.SCALES={major:[0,2,4,5,7,9,11],naturalMinor:[0,2,3,5,7,8,10],harmonicMinor:[0,2,3,5,7,8,11],melodicMinor:[0,2,3,5,7,9,11],ionian:[0,2,4,5,7,9,11],dorian:[0,2,3,5,7,9,10],phrygian:[0,1,3,5,7,8,10],lydian:[0,2,4,6,7,9,11],mixolydian:[0,2,4,5,7,9,10],aeolian:[0,2,3,5,7,8,10],locrian:[0,1,3,5,6,8,10],majorPentatonic:[0,2,4,7,9],minorPentatonic:[0,3,5,7,10],blues:[0,3,5,6,7,10],chromatic:[0,1,2,3,4,5,6,7,8,9,10,11],wholeHalfDiminished:[0,2,3,5,6,8,9,11],arabic:[0,1,4,5,7,8,11],japanese:[0,1,5,7,8],hungarian:[0,2,3,6,7,8,11],bebopMajor:[0,2,4,5,7,8,9,11]},this.CHORDS={major:[0,4,7],minor:[0,3,7],diminished:[0,3,6],augmented:[0,4,8],sus2:[0,2,7],sus4:[0,5,7],maj7:[0,4,7,11],min7:[0,3,7,10],dom7:[0,4,7,10],min7b5:[0,3,6,10],dim7:[0,3,6,9],maj9:[0,4,7,11,14],min9:[0,3,7,10,14],dom9:[0,4,7,10,14],add9:[0,4,7,14],maj11:[0,4,7,11,14,17],min11:[0,3,7,10,14,17],maj13:[0,4,7,11,14,17,21],min13:[0,3,7,10,14,17,21]},this.EMOTION_MODES={excited:{scale:"lydian",tempo:140,dynamics:"forte",articulation:"staccato"},calm:{scale:"major",tempo:60,dynamics:"piano",articulation:"legato"},curious:{scale:"mixolydian",tempo:100,dynamics:"mezzoForte",articulation:"tenuto"},sleepy:{scale:"aeolian",tempo:50,dynamics:"pianissimo",articulation:"legato"},alert:{scale:"dorian",tempo:120,dynamics:"forte",articulation:"marcato"},pleased:{scale:"majorPentatonic",tempo:90,dynamics:"mezzoForte",articulation:"legato"},confused:{scale:"wholeHalfDiminished",tempo:80,dynamics:"mezzoPiano",articulation:"rubato"},energetic:{scale:"bebopMajor",tempo:160,dynamics:"fortissimo",articulation:"staccato"},melancholy:{scale:"harmonicMinor",tempo:70,dynamics:"mezzoPiano",articulation:"legato"},playful:{scale:"blues",tempo:110,dynamics:"mezzoForte",articulation:"swing"}},this.PROGRESSIONS={I_V_vi_IV:[1,5,6,4],I_IV_V:[1,4,5],ii_V_I:[2,5,1],I_vi_IV_V:[1,6,4,5],vi_IV_I_V:[6,4,1,5],I_VI_ii_V:[1,6,2,5],iii_vi_ii_V:[3,6,2,5],I_ii_iii_IV:[1,2,3,4],I_I_I_I_IV_IV_I_I_V_IV_I_V:[1,1,1,1,4,4,1,1,5,4,1,5],i_VII_VI_VII:[1,7,6,7],I_II_IV_I:[1,2,4,1]}},[{key:"noteToMidi",value:function(t){var e=t.slice(0,-1),i=parseInt(t.slice(-1)),n=this.NOTES.indexOf(e);if(-1===n)throw new Error("Invalid note: ".concat(t));return 12*(i+1)+n}},{key:"midiToFrequency",value:function(t){return this.A4_FREQUENCY*Math.pow(2,(t-69)/12)}},{key:"noteToFrequency",value:function(t){return this.midiToFrequency(this.noteToMidi(t))}},{key:"generateScale",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"major",n=this.SCALES[i];if(!n)throw new Error("Unknown scale type: ".concat(i));var a=this.noteToMidi(t);return n.map(function(t){return e.midiToFrequency(a+t)})}},{key:"generateChord",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"major",n=this.CHORDS[i];if(!n)throw new Error("Unknown chord type: ".concat(i));var a=this.noteToMidi(t);return n.map(function(t){return e.midiToFrequency(a+t)})}},{key:"generateProgression",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"major",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.PROGRESSIONS.I_V_vi_IV,a=this.generateScale(t,i),r=[],s=Pe(n);try{for(s.s();!(e=s.n()).done;){var o=e.value,h=a[(o-1)%a.length],u="major";"major"===i?2===o||3===o||6===o?u="minor":7===o&&(u="diminished"):"naturalMinor"===i&&(u=1===o||4===o||5===o?"minor":2===o?"diminished":"major");var c=Math.round(12*Math.log2(h/this.A4_FREQUENCY)+69),l=Math.floor(c/12)-1,f=c%12,v=this.NOTES[f]+l;r.push({degree:o,root:h,frequencies:this.generateChord(v,u),type:u})}}catch(t){s.e(t)}finally{s.f()}return r}},{key:"getEmotionMusic",value:function(t){return this.EMOTION_MODES[t]||this.EMOTION_MODES.calm}},{key:"circleOfFifths",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"C",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t.replace(/\d/,""),a=this.NOTES.indexOf(n),r=[t],s=1;s<e;s++)a=i?(a+7)%12:(a+5)%12,r.push(this.NOTES[a]);return r}},{key:"analyzeInterval",value:function(t,e){for(var i=this.noteToMidi(t),n=this.noteToMidi(e),a=Math.abs(n-i),r="unknown",s=0,o=Object.entries(this.INTERVALS);s<o.length;s++){var h=y(o[s],2),u=h[0];if(h[1]===a%12){r=u;break}}return{semitones:a,intervalName:r,octaves:Math.floor(a/12),consonant:[0,3,4,5,7,8,9,12].includes(a%12),ratio:this.getIntervalRatio(a%12)}}},{key:"getIntervalRatio",value:function(t){return{0:"1:1",1:"16:15",2:"9:8",3:"6:5",4:"5:4",5:"4:3",6:"45:32",7:"3:2",8:"8:5",9:"5:3",10:"16:9",11:"15:8",12:"2:1"}[t]||"complex"}},{key:"generateMelody",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.key,i=void 0===e?"C4":e,n=t.scale,a=void 0===n?"major":n,r=t.length,s=void 0===r?8:r,o=t.stepProbability,h=void 0===o?.7:o,u=t.restProbability,c=void 0===u?.1:u,l=this.generateScale(i,a),f=[],v=0,d=0;d<s;d++)if(Math.random()<c)f.push({frequency:0,duration:.25,isRest:!0});else{var p=void 0;if(Math.random()<h){var y=Math.random()<.5?-1:1;p=Math.max(0,Math.min(l.length-1,v+y))}else{var m=Math.floor(3*Math.random())+2,g=Math.random()<.5?-1:1;p=Math.max(0,Math.min(l.length-1,v+m*g))}v=p;var b=[.25,.5,.75,1],M=b[Math.floor(Math.random()*b.length)];f.push({frequency:l[v],duration:M,isRest:!1})}return f}}])}();const Re=function(){return f(function t(e){u(this,t),this.audioContext=e,this.musicTheory=new Te,this.currentKey="C4",this.currentScale="major",this.currentTempo=120,this.currentEmotion="calm",this.voices=new Map,this.layers={bass:{active:!1,gain:.3},chord:{active:!1,gain:.2},melody:{active:!1,gain:.4},pad:{active:!1,gain:.15}},this.masterGain=this.audioContext.createGain(),this.masterGain.gain.value=.5,this.masterGain.connect(this.audioContext.destination),this.reverb=this.createReverb(),this.delay=this.createDelay(),this.filter=this.createFilter(),this.filter.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this.masterGain),this.dryGain=this.audioContext.createGain(),this.dryGain.gain.value=.7,this.dryGain.connect(this.masterGain),this.wetGain=this.audioContext.createGain(),this.wetGain.gain.value=.3,this.wetGain.connect(this.filter),this.nextNoteTime=0,this.noteResolution=0,this.noteLength=.05,this.currentChordIndex=0,this.currentMelodyNote=0,this.progression=null,this.isPlaying=!1,this.lookahead=25,this.scheduleAheadTime=.1},[{key:"createReverb",value:function(){for(var t=this.audioContext.createConvolver(),e=2*this.audioContext.sampleRate,i=this.audioContext.createBuffer(2,e,this.audioContext.sampleRate),n=0;n<2;n++)for(var a=i.getChannelData(n),r=0;r<e;r++)a[r]=(2*Math.random()-1)*Math.pow(1-r/e,2);return t.buffer=i,t}},{key:"createDelay",value:function(){var t=this.audioContext.createDelay(1);t.delayTime.value=.15;var e=this.audioContext.createGain();return e.gain.value=.3,t.connect(e),e.connect(t),t}},{key:"createFilter",value:function(){var t=this.audioContext.createBiquadFilter();return t.type="lowpass",t.frequency.value=2e3,t.Q.value=1,t}},{key:"setEmotion",value:function(t){this.currentEmotion=t;var e=this.musicTheory.getEmotionMusic(t);this.currentScale=e.scale,this.currentTempo=e.tempo;var i={excited:{freq:4e3,Q:2},calm:{freq:1500,Q:.7},curious:{freq:2500,Q:1.5},sleepy:{freq:800,Q:.5},alert:{freq:3e3,Q:1.8},energetic:{freq:5e3,Q:2.5}}[t]||{freq:2e3,Q:1};this.filter.frequency.exponentialRampToValueAtTime(i.freq,this.audioContext.currentTime+.5),this.filter.Q.linearRampToValueAtTime(i.Q,this.audioContext.currentTime+.5),this.generateEmotionProgression()}},{key:"generateEmotionProgression",value:function(){var t={excited:"I_V_vi_IV",calm:"I_vi_IV_V",curious:"ii_V_I",sleepy:"vi_IV_I_V",alert:"I_IV_V",energetic:"I_V_vi_IV"}[this.currentEmotion]||"I_V_vi_IV";this.progression=this.musicTheory.generateProgression(this.currentKey,this.currentScale,this.musicTheory.PROGRESSIONS[t])}},{key:"playChord",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01,a=this.audioContext.currentTime,r=this.audioContext.createGain();r.gain.setValueAtTime(0,a),r.gain.linearRampToValueAtTime(this.layers.chord.gain,a+n),r.gain.exponentialRampToValueAtTime(.01,a+i),r.connect(this.dryGain),r.connect(this.wetGain);var s=t.map(function(t,n){var s=e.audioContext.createOscillator();return s.frequency.value=t,s.type=0===n?"sine":1===n?"triangle":"sawtooth",s.detune.value=10*(Math.random()-.5),s.connect(r),s.start(a),s.stop(a+i),s}),o="chord_".concat(Date.now());this.voices.set(o,{oscillators:s,gain:r}),setTimeout(function(){e.voices.delete(o)},1e3*(i+.1))}},{key:"playMelody",value:function(t){var e=this,i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)||this.audioContext.currentTime;t.forEach(function(t,n){if(t.isRest)i+=t.duration;else{var a=e.audioContext.createOscillator(),r=e.audioContext.createGain();a.frequency.value=t.frequency,a.type="sine";var s=e.audioContext.createOscillator(),o=e.audioContext.createGain();s.frequency.value=5,o.gain.value=5,s.connect(o),o.connect(a.frequency),r.gain.setValueAtTime(0,i),r.gain.linearRampToValueAtTime(e.layers.melody.gain,i+.01),r.gain.exponentialRampToValueAtTime(.01,i+.9*t.duration),a.connect(r),r.connect(e.dryGain),r.connect(e.wetGain),a.start(i),a.stop(i+t.duration),s.start(i),s.stop(i+t.duration),i+=t.duration}})}},{key:"createPad",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i=this.audioContext.currentTime,n=this.audioContext.createGain();n.gain.setValueAtTime(0,i),n.gain.linearRampToValueAtTime(this.layers.pad.gain,i+1),n.gain.linearRampToValueAtTime(this.layers.pad.gain,i+e-1),n.gain.linearRampToValueAtTime(0,i+e),n.connect(this.wetGain);for(var a=0;a<4;a++){var r=this.audioContext.createOscillator();r.frequency.value=t,r.type="sawtooth",r.detune.value=15*(a-2);var s=this.audioContext.createGain();s.gain.value=1/4;var o=this.audioContext.createOscillator(),h=this.audioContext.createGain();o.frequency.value=.2+.1*a,h.gain.value=10,o.connect(h),h.connect(r.frequency),r.connect(s),s.connect(n),r.start(i),r.stop(i+e),o.start(i),o.stop(i+e)}}},{key:"playGestureSound",value:function(t){var e=this,i={breathe:function(){var t=e.musicTheory.generateChord(e.currentKey,"maj7");e.playChord(t,2,.5),e.createPad(t[0]/2,3)},excited:function(){var t=e.musicTheory.generateScale(e.currentKey,"lydian").map(function(t,e){return{frequency:t,duration:.1,isRest:!1}});e.playMelody(t)},wave:function(){var t=e.musicTheory.noteToFrequency(e.currentKey),i=2*t,n=e.audioContext.createOscillator(),a=e.audioContext.createGain();n.frequency.setValueAtTime(t,e.audioContext.currentTime),n.frequency.exponentialRampToValueAtTime(i,e.audioContext.currentTime+.5),n.frequency.exponentialRampToValueAtTime(t,e.audioContext.currentTime+1),a.gain.setValueAtTime(0,e.audioContext.currentTime),a.gain.linearRampToValueAtTime(.3,e.audioContext.currentTime+.1),a.gain.linearRampToValueAtTime(.3,e.audioContext.currentTime+.9),a.gain.linearRampToValueAtTime(0,e.audioContext.currentTime+1),n.connect(a),a.connect(e.wetGain),n.start(),n.stop(e.audioContext.currentTime+1)},morph:function(){var t=e.musicTheory.generateChord(e.currentKey,"minor"),i=e.musicTheory.generateChord(e.currentKey,"major");e.playChord(t,.5),setTimeout(function(){e.playChord(i,1)},400)},jump:function(){for(var t=e.musicTheory.generateChord(e.currentKey,"dom7"),i=function(i){setTimeout(function(){e.playChord(t.map(function(t){return t*Math.pow(2,i/12)}),.1,.001)},100*i)},n=0;n<3;n++)i(n)},curious:function(){var t=e.musicTheory.generateMelody({key:e.currentKey,scale:"mixolydian",length:5,stepProbability:.3});e.playMelody(t)}}[t];i&&i()}},{key:"startHarmony",value:function(){this.isPlaying||(this.isPlaying=!0,this.currentChordIndex=0,this.nextNoteTime=this.audioContext.currentTime,this.generateEmotionProgression(),this.scheduleHarmony())}},{key:"scheduleHarmony",value:function(){var t=this;if(this.isPlaying){for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;){if(this.progression&&this.layers.chord.active){var e=this.progression[this.currentChordIndex];this.playChord(e.frequencies,.5),this.currentChordIndex=(this.currentChordIndex+1)%this.progression.length}if(this.layers.bass.active&&this.progression){var i=this.progression[this.currentChordIndex].frequencies[0]/2;this.playBassNote(i,.25)}var n=60/this.currentTempo;this.nextNoteTime+=.25*n}setTimeout(function(){return t.scheduleHarmony()},this.lookahead)}}},{key:"playBassNote",value:function(t,e){var i=this.audioContext.createOscillator(),n=this.audioContext.createGain();i.frequency.value=t,i.type="sine",n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(this.layers.bass.gain,this.audioContext.currentTime+.01),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+e),i.connect(n),n.connect(this.dryGain),i.start(),i.stop(this.audioContext.currentTime+e)}},{key:"stopHarmony",value:function(){this.isPlaying=!1}},{key:"setLayerActive",value:function(t,e){this.layers[t]&&(this.layers[t].active=e)}},{key:"setMasterVolume",value:function(t){this.masterGain.gain.exponentialRampToValueAtTime(Math.max(.01,t),this.audioContext.currentTime+.1)}},{key:"setEffectsMix",value:function(t){var e=1-t;this.dryGain.gain.linearRampToValueAtTime(e,this.audioContext.currentTime+.1),this.wetGain.gain.linearRampToValueAtTime(t,this.audioContext.currentTime+.1)}}])}();var Ie=function(){return f(function t(){u(this,t),this.context=null,this.isEnabled=!1,this.isInitialized=!1,this.nodes={master:null,ambient:null,effects:null},this.harmonicSystem=null,this.useHarmonicSystem=!1,this.warningTimestamps={},this.warningThrottle=5e3,this.currentOscillator=null,this.currentGain=null,this.masterVolume=.5,this.ambientVolume=.1,this.emotionalTones=new Map([["neutral",{frequency:220,waveform:"sine",volume:.1}],["joy",{frequency:440,waveform:"triangle",volume:.15}],["sadness",{frequency:165,waveform:"sine",volume:.08}],["anger",{frequency:330,waveform:"sawtooth",volume:.12}],["fear",{frequency:880,waveform:"square",volume:.09}],["surprise",{frequency:660,waveform:"triangle",volume:.13}],["disgust",{frequency:110,waveform:"sawtooth",volume:.07}],["love",{frequency:528,waveform:"sine",volume:.11}]])},[{key:"initialize",value:(e=o(v.mark(function t(){var e;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=window.AudioContext||window.webkitAudioContext){t.next=1;break}return t.abrupt("return",!1);case 1:return this.context=new e,this.harmonicSystem=new Re(this.context),this.context.state,this.nodes.master=this.context.createGain(),this.nodes.master.gain.setValueAtTime(this.masterVolume,this.context.currentTime),this.nodes.master.connect(this.context.destination),this.nodes.effects=this.context.createGain(),this.nodes.effects.gain.setValueAtTime(1,this.context.currentTime),this.nodes.effects.connect(this.nodes.master),this.isEnabled=!0,this.isInitialized=!0,t.abrupt("return",!0);case 2:return t.prev=2,t.catch(0),this.isEnabled=!1,t.abrupt("return",!1);case 3:case"end":return t.stop()}},t,this,[[0,2]])})),function(){return e.apply(this,arguments)})},{key:"resumeContext",value:(t=o(v.mark(function t(){return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.context||"suspended"!==this.context.state){t.next=4;break}return t.prev=1,t.next=2,this.context.resume();case 2:t.next=4;break;case 3:t.prev=3,t.catch(1);case 4:case"end":return t.stop()}},t,this,[[1,3]])})),function(){return t.apply(this,arguments)})},{key:"setMasterVolume",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.masterVolume=Math.max(0,Math.min(1,t)),this.isEnabled&&this.nodes.master&&(this.nodes.master.gain.setValueAtTime(this.masterVolume,this.context.currentTime),e&&this.updateAmbientVolume(e))}},{key:"getMasterVolume",value:function(){return this.masterVolume}},{key:"isAvailable",value:function(){return this.isEnabled&&this.isInitialized}},{key:"setHarmonicMode",value:function(t){this.useHarmonicSystem=t,t&&this.harmonicSystem?this.stopAmbientTone():!t&&this.harmonicSystem&&this.harmonicSystem.stopHarmony()}},{key:"startHarmony",value:function(){this.harmonicSystem&&this.useHarmonicSystem&&this.isAvailable()&&this.harmonicSystem.startHarmony()}},{key:"stopHarmony",value:function(){this.harmonicSystem&&this.harmonicSystem.stopHarmony()}},{key:"setHarmonicLayer",value:function(t,e){this.harmonicSystem&&this.harmonicSystem.setLayerActive(t,e)}},{key:"setHarmonicEffects",value:function(t){this.harmonicSystem&&this.harmonicSystem.setEffectsMix(t)}},{key:"cleanup",value:function(){try{this.currentOscillator&&(this.currentOscillator.stop(),this.currentOscillator=null),this.currentGain&&(this.currentGain=null),this.context&&"closed"!==this.context.state&&this.context.close()}catch(t){}finally{this.context=null,this.nodes={master:null,ambient:null,effects:null},this.currentOscillator=null,this.currentGain=null,this.isEnabled=!1,this.isInitialized=!1}}},{key:"getEmotionalTone",value:function(t){return this.emotionalTones.get(t)||null}},{key:"setAmbientTone",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(this.isAvailable())if(this.useHarmonicSystem&&this.harmonicSystem)this.harmonicSystem.setEmotion(t);else{var i=this.getEmotionalTone(t);if(i)try{this.resumeContext();var n=this.context.currentTime,a=e/1e3;this.currentOscillator&&this.currentGain&&(this.currentGain.gain.exponentialRampToValueAtTime(.001,n+.5*a),this.currentOscillator.stop(n+.5*a));var r=this.context.createOscillator(),s=this.context.createGain();r.type=i.waveform,r.frequency.setValueAtTime(i.frequency,n);var o=i.volume*this.masterVolume;s.gain.setValueAtTime(.001,n),s.gain.exponentialRampToValueAtTime(o,n+a),r.connect(s),s.connect(this.nodes.master),r.start(n),this.currentOscillator=r,this.currentGain=s}catch(t){}}}},{key:"stopAmbientTone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;if(this.isAvailable()&&this.currentOscillator)try{var e=this.context.currentTime,i=t/1e3;this.currentGain&&this.currentGain.gain.exponentialRampToValueAtTime(.001,e+i),this.currentOscillator.stop(e+i),this.currentOscillator=null,this.currentGain=null}catch(t){}}},{key:"updateAmbientVolume",value:function(t){if(this.isAvailable()&&this.currentGain&&t){var e=this.getEmotionalTone(t);if(e)try{var i=e.volume*this.masterVolume,n=this.context.currentTime;this.currentGain.gain.exponentialRampToValueAtTime(i,n+.1)}catch(t){}}}},{key:"playGestureSound",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"neutral";if(this.isAvailable())if(this.useHarmonicSystem&&this.harmonicSystem)this.harmonicSystem.playGestureSound(t);else{var i=this.getGestureSoundConfig(t);if(i)try{this.resumeContext();var n=this.context.currentTime,a=i.duration/1e3,r=this.getEmotionalModifiers(e),s=i.volume*this.masterVolume*r.intensity,o=this.context.createOscillator(),h=this.context.createGain();o.type=i.waveform,this.applyFrequencyEnvelope(o,i.frequencyEnvelope,n,a),this.applyVolumeEnvelope(h,i.volumeEnvelope,n,a,s),o.connect(h),h.connect(this.nodes.effects),o.start(n),o.stop(n+a)}catch(t){}else this.throttledWarn('Unknown gesture "'.concat(t,'", cannot play sound'),"gesture_".concat(t))}}},{key:"getGestureSoundConfig",value:function(t){return new Map([["bounce",{duration:100,waveform:"triangle",volume:.3,frequencyEnvelope:[{time:0,frequency:200},{time:.5,frequency:400},{time:1,frequency:300}],volumeEnvelope:[{time:0,volume:1},{time:.1,volume:.8},{time:1,volume:0}]}],["pulse",{duration:300,waveform:"sine",volume:.25,frequencyEnvelope:[{time:0,frequency:300},{time:.5,frequency:450},{time:1,frequency:300}],volumeEnvelope:[{time:0,volume:0},{time:.3,volume:1},{time:.7,volume:1},{time:1,volume:0}]}],["shake",{duration:200,waveform:"sawtooth",volume:.2,frequencyEnvelope:[{time:0,frequency:150},{time:.25,frequency:200},{time:.5,frequency:150},{time:.75,frequency:200},{time:1,frequency:150}],volumeEnvelope:[{time:0,volume:.8},{time:.5,volume:1},{time:1,volume:0}]}],["spin",{duration:600,waveform:"triangle",volume:.35,frequencyEnvelope:[{time:0,frequency:220},{time:.3,frequency:440},{time:.7,frequency:660},{time:1,frequency:330}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:1},{time:.8,volume:.8},{time:1,volume:0}]}],["nod",{duration:150,waveform:"sine",volume:.15,frequencyEnvelope:[{time:0,frequency:180},{time:.5,frequency:220},{time:1,frequency:180}],volumeEnvelope:[{time:0,volume:.5},{time:.3,volume:1},{time:1,volume:0}]}],["tilt",{duration:200,waveform:"triangle",volume:.18,frequencyEnvelope:[{time:0,frequency:250},{time:.6,frequency:350},{time:1,frequency:280}],volumeEnvelope:[{time:0,volume:0},{time:.4,volume:1},{time:1,volume:0}]}],["expand",{duration:500,waveform:"sine",volume:.4,frequencyEnvelope:[{time:0,frequency:200},{time:.7,frequency:500},{time:1,frequency:400}],volumeEnvelope:[{time:0,volume:0},{time:.3,volume:1},{time:.9,volume:.8},{time:1,volume:0}]}],["contract",{duration:400,waveform:"triangle",volume:.22,frequencyEnvelope:[{time:0,frequency:400},{time:.8,frequency:200},{time:1,frequency:180}],volumeEnvelope:[{time:0,volume:1},{time:.6,volume:.8},{time:1,volume:0}]}],["flash",{duration:200,waveform:"square",volume:.3,frequencyEnvelope:[{time:0,frequency:800},{time:.1,frequency:1200},{time:.2,frequency:800},{time:1,frequency:600}],volumeEnvelope:[{time:0,volume:0},{time:.05,volume:1},{time:.15,volume:.3},{time:1,volume:0}]}],["wave",{duration:400,waveform:"sine",volume:.25,frequencyEnvelope:[{time:0,frequency:300},{time:.3,frequency:500},{time:.6,frequency:400},{time:1,frequency:350}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:.8},{time:.7,volume:.6},{time:1,volume:0}]}],["breathe",{duration:800,waveform:"triangle",volume:.6,frequencyEnvelope:[{time:0,frequency:300},{time:.3,frequency:500},{time:.5,frequency:600},{time:.7,frequency:400},{time:1,frequency:250}],volumeEnvelope:[{time:0,volume:.2},{time:.2,volume:1},{time:.5,volume:.9},{time:.8,volume:.7},{time:1,volume:0}]}],["morph",{duration:600,waveform:"triangle",volume:.3,frequencyEnvelope:[{time:0,frequency:100},{time:.2,frequency:300},{time:.5,frequency:600},{time:.8,frequency:400},{time:1,frequency:200}],volumeEnvelope:[{time:0,volume:.5},{time:.3,volume:1},{time:.7,volume:.8},{time:1,volume:0}]}],["jump",{duration:250,waveform:"square",volume:.35,frequencyEnvelope:[{time:0,frequency:200},{time:.2,frequency:600},{time:.4,frequency:800},{time:.8,frequency:400},{time:1,frequency:100}],volumeEnvelope:[{time:0,volume:.8},{time:.1,volume:1},{time:.3,volume:.6},{time:1,volume:0}]}],["drift",{duration:800,waveform:"sine",volume:.12,frequencyEnvelope:[{time:0,frequency:160},{time:.4,frequency:240},{time:.8,frequency:200},{time:1,frequency:180}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:1},{time:.8,volume:.8},{time:1,volume:0}]}],["wave",{duration:400,waveform:"sine",volume:.25,frequencyEnvelope:[{time:0,frequency:200},{time:.25,frequency:300},{time:.5,frequency:250},{time:.75,frequency:280},{time:1,frequency:200}],volumeEnvelope:[{time:0,volume:0},{time:.2,volume:.8},{time:.8,volume:.8},{time:1,volume:0}]}],["breathe",{duration:3500,waveform:"sine",volume:.2,frequencyEnvelope:[{time:0,frequency:80},{time:.4,frequency:150},{time:.5,frequency:160},{time:.9,frequency:100},{time:1,frequency:80}],volumeEnvelope:[{time:0,volume:.3},{time:.4,volume:.8},{time:.5,volume:.7},{time:.9,volume:.6},{time:1,volume:.2}]}],["flicker",{duration:300,waveform:"square",volume:.2,frequencyEnvelope:[{time:0,frequency:600},{time:.1,frequency:400},{time:.2,frequency:800},{time:.3,frequency:300},{time:.5,frequency:700},{time:1,frequency:500}],volumeEnvelope:[{time:0,volume:1},{time:.1,volume:.2},{time:.2,volume:.9},{time:.3,volume:.3},{time:.5,volume:.8},{time:1,volume:0}]}],["vibrate",{duration:250,waveform:"sawtooth",volume:.3,frequencyEnvelope:[{time:0,frequency:100},{time:.1,frequency:150},{time:.2,frequency:100},{time:.3,frequency:150},{time:.4,frequency:100},{time:.5,frequency:150},{time:.6,frequency:100},{time:.7,frequency:150},{time:1,frequency:80}],volumeEnvelope:[{time:0,volume:1},{time:.8,volume:1},{time:1,volume:0}]}],["glow",{duration:600,waveform:"sine",volume:.15,frequencyEnvelope:[{time:0,frequency:300},{time:.5,frequency:500},{time:1,frequency:400}],volumeEnvelope:[{time:0,volume:0},{time:.3,volume:1},{time:.7,volume:1},{time:1,volume:0}]}],["stretch",{duration:450,waveform:"triangle",volume:.2,frequencyEnvelope:[{time:0,frequency:250},{time:.3,frequency:180},{time:.7,frequency:320},{time:1,frequency:250}],volumeEnvelope:[{time:0,volume:.6},{time:.2,volume:1},{time:.8,volume:.9},{time:1,volume:0}]}]]).get(t)||null}},{key:"applyFrequencyEnvelope",value:function(t,e,i,n){e.forEach(function(e){var a=i+e.time*n;t.frequency.linearRampToValueAtTime(e.frequency,a)})}},{key:"applyVolumeEnvelope",value:function(t,e,i,n,a){e.forEach(function(e,r){var s=i+e.time*n,o=e.volume*a;0===r?t.gain.setValueAtTime(o,s):t.gain.linearRampToValueAtTime(o,s)})}},{key:"getEmotionalModifiers",value:function(t){var e=new Map([["neutral",{intensity:1,speed:1}],["joy",{intensity:1.3,speed:1.2}],["sadness",{intensity:.6,speed:.8}],["anger",{intensity:1.5,speed:1.4}],["fear",{intensity:.8,speed:1.3}],["surprise",{intensity:1.4,speed:1.5}],["disgust",{intensity:.7,speed:.9}],["love",{intensity:1.1,speed:.9}]]);return e.get(t)||e.get("neutral")}},{key:"setQualityReduction",value:function(t){this.qualityReduction=t,t&&this.audioContext?(this.audioContext.sampleRate,this.maxOscillators=2):this.maxOscillators=4}},{key:"throttledWarn",value:function(t,e){var i=Date.now();i-(this.warningTimestamps[e]||0)>this.warningThrottle&&(this.warningTimestamps[e]=i)}}],[{key:"isSupported",value:function(){return!(!window.AudioContext&&!window.webkitAudioContext)}}]);var t,e}();const ze=function(){return f(function t(){u(this,t),this.timestamps=[],this.fps=0,this.smoothedFPS=0,this.smoothingFactor=.9,this.lastFrameTime=0,this.frameTime=0,this.frameTimes=[],this.maxFrameTimeSamples=10,this.averageFrameTime=0},[{key:"update",value:function(t){for(;this.timestamps.length>0&&this.timestamps[0]<=t-1e3;)this.timestamps.shift();if(this.timestamps.push(t),this.fps=this.timestamps.length,0===this.smoothedFPS?this.smoothedFPS=this.fps:this.smoothedFPS=this.smoothedFPS*this.smoothingFactor+this.fps*(1-this.smoothingFactor),this.lastFrameTime>0&&(this.frameTime=t-this.lastFrameTime,this.frameTimes.push(this.frameTime),this.frameTimes.length>this.maxFrameTimeSamples&&this.frameTimes.shift(),this.frameTimes.length>0)){var e=this.frameTimes.reduce(function(t,e){return t+e},0);this.averageFrameTime=e/this.frameTimes.length}this.lastFrameTime=t}},{key:"getFPS",value:function(){return Math.round(this.fps)}},{key:"getSmoothedFPS",value:function(){return Math.round(this.smoothedFPS)}},{key:"getFrameTime",value:function(){return this.frameTime}},{key:"getAverageFrameTime",value:function(){return this.averageFrameTime}},{key:"reset",value:function(){this.timestamps=[],this.fps=0,this.smoothedFPS=0,this.lastFrameTime=0,this.frameTime=0,this.frameTimes=[],this.averageFrameTime=0}},{key:"getMetrics",value:function(){return{fps:this.getFPS(),smoothedFPS:this.getSmoothedFPS(),frameTime:this.getFrameTime(),averageFrameTime:this.getAverageFrameTime(),status:this.fps>=55?"good":this.fps>=30?"okay":"poor"}}}])}();const De=function(){return f(function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this,t),this.errorBoundary=e,this.config=i,this.config.targetFPS=i.targetFPS||60,this.isRunning=!1,this.animationFrameId=null,this.lastFrameTime=0,this.deltaTime=0,this.isPaused=!1,this.handleVisibilityChange=this.handleVisibilityChange.bind(this),"undefined"!=typeof document&&document.addEventListener("visibilitychange",this.handleVisibilityChange),this.performanceMonitor=null,this.fpsCounter=new ze,this.subsystems={},this.eventCallback=null,this.parentMascot=null},[{key:"setSubsystems",value:function(t){this.subsystems={stateMachine:t.stateMachine,particleSystem:t.particleSystem,renderer:t.renderer,soundSystem:t.soundSystem,canvasManager:t.canvasManager};for(var e=0,i=["stateMachine","particleSystem","renderer"];e<i.length;e++){var n=i[e];if(!this.subsystems[n])throw new Error("Required subsystem '".concat(n,"' not provided"))}this.performanceMonitor&&this.performanceMonitor.setSubsystems(this.subsystems)}},{key:"setEventCallback",value:function(t){if("function"!=typeof t)throw new Error("Event callback must be a function");this.eventCallback=t}},{key:"setParentMascot",value:function(t){this.parentMascot=t}},{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.eventCallback&&this.eventCallback(t,e)}},{key:"start",value:function(){var t=this;return this.errorBoundary.wrap(function(){if(t.isRunning)return!1;if(!t.subsystems.stateMachine)throw new Error("Cannot start animation without subsystems configured");return t.isRunning=!0,t.lastFrameTime=performance.now(),t.subsystems.soundSystem&&t.subsystems.soundSystem.isAvailable()&&t.subsystems.soundSystem.resumeContext(),t.animate(),t.emit("animationStarted",{targetFPS:t.targetFPS}),!0},"animation-start")()}},{key:"stop",value:function(){var t=this;return this.errorBoundary.wrap(function(){return!!t.isRunning&&(t.isRunning=!1,t.animationFrameId&&(cancelAnimationFrame(t.animationFrameId),t.animationFrameId=null),t.subsystems.renderer&&t.subsystems.renderer.stopAllGestures&&t.subsystems.renderer.stopAllGestures(),t.subsystems.soundSystem&&t.subsystems.soundSystem.isAvailable()&&t.subsystems.soundSystem.stopAmbientTone(),t.subsystems.particleSystem&&t.subsystems.particleSystem.clear(),t.emit("animationStopped"),!0)},"animation-stop")()}},{key:"handleVisibilityChange",value:function(){var t,e;document.hidden?(this.isPaused=!0,null!==(t=this.subsystems)&&void 0!==t&&t.particleSystem&&this.subsystems.particleSystem.resetAccumulator()):this.isPaused&&(this.isPaused=!1,this.lastFrameTime=performance.now(),null!==(e=this.subsystems)&&void 0!==e&&e.particleSystem&&this.subsystems.particleSystem.resetAccumulator())}},{key:"animate",value:function(){var t=this;this.isRunning&&!this.isPaused&&this.errorBoundary.wrap(function(){var e,i=performance.now();t.deltaTime=i-t.lastFrameTime;var n,a=t.deltaTime>33;t.deltaTime>50&&(t.deltaTime=50,null!==(n=t.subsystems)&&void 0!==n&&n.particleSystem&&t.subsystems.particleSystem.resetAccumulator());null!==(e=t.subsystems)&&void 0!==e&&e.particleSystem&&(t.subsystems.particleSystem.skipSpawnThisFrame=a),t.lastFrameTime=i,t.performanceMonitor&&t.performanceMonitor.startFrame(i),t.fpsCounter.update(i),t.update(t.deltaTime),t.render(),t.performanceMonitor&&t.performanceMonitor.endFrame(performance.now()),t.animationFrameId=requestAnimationFrame(function(){return t.animate()})},"animation-loop")()}},{key:"update",value:function(t){var e=this;this.errorBoundary.wrap(function(){var i,n,a,r,s;performance.now();if(e.subsystems.stateMachine&&e.subsystems.stateMachine.update(t),e.parentMascot&&"function"==typeof e.parentMascot.update&&e.parentMascot.update(t),!("classic"===(null===(i=e.parentMascot)||void 0===i||null===(i=i.config)||void 0===i?void 0:i.renderingStyle))&&e.subsystems.particleSystem&&e.subsystems.stateMachine&&e.subsystems.canvasManager){var o=e.subsystems.stateMachine.getCurrentEmotionalProperties(),h=e.subsystems.canvasManager.getCenter(),u=null,c=0;if(e.subsystems.renderer&&e.subsystems.renderer.getCurrentGesture){var l=e.subsystems.renderer.getCurrentGesture();l&&l.particleMotion&&(u=l.particleMotion,c=l.progress||0)}e.subsystems.particleSystem.spawn(o.particleBehavior,e.subsystems.stateMachine.getCurrentState().emotion,o.particleRate,h.x,h.y,t),e.subsystems.particleSystem.update(t,h.x,h.y,u,c)}e.performanceMonitor&&e.performanceMonitor.updateMetrics({particleCount:(null===(n=e.subsystems.particleSystem)||void 0===n||null===(a=n.getActiveParticleCount)||void 0===a?void 0:a.call(n))||0,gestureQueueLength:0,audioLatency:(null===(r=e.subsystems.soundSystem)||void 0===r||null===(s=r.getLatency)||void 0===s?void 0:s.call(r))||0})},"subsystem-update")()}},{key:"render",value:function(){var t=this;this.errorBoundary.wrap(function(){t.parentMascot&&"function"==typeof t.parentMascot.render?t.parentMascot.render():t.subsystems.renderer&&t.subsystems.renderer.render()},"frame-render")()}},{key:"getPerformanceMetrics",value:function(){var t=this.fpsCounter?this.fpsCounter.getMetrics():{};return{fps:t.fps||60,instantFps:t.smoothedFPS||60,frameTime:t.frameTime||16.67,averageFrameTime:t.averageFrameTime||16.67,isRunning:this.isRunning,deltaTime:this.deltaTime}}},{key:"setTargetFPS",value:function(t){}},{key:"targetFPS",get:function(){return this.config.targetFPS||60}},{key:"isAnimating",value:function(){return this.isRunning}},{key:"destroy",value:function(){this.stop(),"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.performanceMonitor&&(this.performanceMonitor.destroy(),this.performanceMonitor=null),this.subsystems={},this.eventCallback=null}}])}();function qe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function _e(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?qe(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):qe(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const Ge=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.config=_e({spikeThreshold:e.spikeThreshold||1.5,minimumSpikeLevel:e.minimumSpikeLevel||.1,spikeMinInterval:e.spikeMinInterval||1e3,historySize:e.historySize||10,smoothingTimeConstant:e.smoothingTimeConstant||.8,fftSize:e.fftSize||256,levelUpdateThrottle:e.levelUpdateThrottle||100},e),this.audioContext=null,this.analyser=null,this.dataArray=null,this.currentLevel=0,this.levelHistory=[],this.isActive=!1,this.lastVolumeSpike=0,this.lastLevelEmit=0,this.callbacks={levelUpdate:null,volumeSpike:null,error:null}},[{key:"initialize",value:function(t){var e=this;try{if(!t)throw new Error("AudioContext is required for audio level processing");if("function"!=typeof t.createAnalyser)throw new Error("Invalid AudioContext provided");return this.audioContext=t,this.analyser=t.createAnalyser(),this.analyser.fftSize=this.config.fftSize,this.analyser.smoothingTimeConstant=this.config.smoothingTimeConstant,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.currentLevel=0,this.levelHistory=[],this.lastVolumeSpike=0,this.isActive=!0,"suspended"===t.state&&t.resume().catch(function(t){e.emitError("Failed to resume AudioContext",t)}),!0}catch(t){return this.emitError("Failed to initialize AudioLevelProcessor",t),!1}}},{key:"cleanup",value:function(){try{this.isActive=!1,this.currentLevel=0,this.levelHistory=[],this.lastVolumeSpike=0,this.lastLevelEmit=0,this.audioContext=null,this.analyser=null,this.dataArray=null}catch(t){this.emitError("Error during AudioLevelProcessor cleanup",t)}}},{key:"updateAudioLevel",value:function(){if(this.isActive&&this.analyser&&this.dataArray)try{this.analyser.getByteFrequencyData(this.dataArray);var t=this.calculateRMS();this.currentLevel=Math.min(1,2*t),this.updateLevelHistory(),this.detectVolumeSpikes(),this.emitLevelUpdate()}catch(t){this.emitError("Error updating audio level",t),this.currentLevel=0}}},{key:"calculateRMS",value:function(){if(!this.dataArray||0===this.dataArray.length)return 0;for(var t=0,e=0;e<this.dataArray.length;e++){var i=this.dataArray[e]/255;t+=i*i}return Math.sqrt(t/this.dataArray.length)}},{key:"updateLevelHistory",value:function(){this.levelHistory.push(this.currentLevel),this.levelHistory.length>this.config.historySize&&this.levelHistory.shift()}},{key:"detectVolumeSpikes",value:function(){if(!(this.levelHistory.length<5)){var t=performance.now();if(!(t-this.lastVolumeSpike<this.config.spikeMinInterval)){var e=this.levelHistory.slice(0,-1),i=e.reduce(function(t,e){return t+e},0)/e.length;this.currentLevel>=i*this.config.spikeThreshold&&i>=this.config.minimumSpikeLevel&&this.currentLevel>=2*this.config.minimumSpikeLevel&&(this.lastVolumeSpike=t,this.emitVolumeSpike({level:this.currentLevel,previousAverage:i,spikeRatio:this.currentLevel/i,timestamp:t,threshold:this.config.spikeThreshold,minimumLevel:this.config.minimumSpikeLevel}))}}}},{key:"clearHistory",value:function(){this.levelHistory=[]}},{key:"getCurrentLevel",value:function(){return this.currentLevel}},{key:"getLevelHistory",value:function(){return a(this.levelHistory)}},{key:"getAnalyser",value:function(){return this.analyser}},{key:"getFrequencyData",value:function(){return this.dataArray?new Uint8Array(this.dataArray):null}},{key:"isProcessingActive",value:function(){return this.isActive}},{key:"onLevelUpdate",value:function(t){if("function"!=typeof t)throw new Error("Level update callback must be a function");this.callbacks.levelUpdate=t}},{key:"onVolumeSpike",value:function(t){if("function"!=typeof t)throw new Error("Volume spike callback must be a function");this.callbacks.volumeSpike=t}},{key:"onError",value:function(t){if("function"!=typeof t)throw new Error("Error callback must be a function");this.callbacks.error=t}},{key:"removeAllCallbacks",value:function(){this.callbacks={levelUpdate:null,volumeSpike:null,error:null}}},{key:"updateConfig",value:function(t){this.config=_e(_e({},this.config),t),this.analyser&&(t.fftSize&&(this.analyser.fftSize=this.config.fftSize,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount)),void 0!==t.smoothingTimeConstant&&(this.analyser.smoothingTimeConstant=this.config.smoothingTimeConstant))}},{key:"getConfig",value:function(){return _e({},this.config)}},{key:"getStats",value:function(){return{isActive:this.isActive,currentLevel:this.currentLevel,historySize:this.levelHistory.length,maxHistorySize:this.config.historySize,lastSpikeTime:this.lastVolumeSpike,timeSinceLastSpike:this.lastVolumeSpike>0?performance.now()-this.lastVolumeSpike:0,averageLevel:this.levelHistory.length>0?this.levelHistory.reduce(function(t,e){return t+e},0)/this.levelHistory.length:0}}},{key:"emitLevelUpdate",value:function(){var t=performance.now();if(!(t-this.lastLevelEmit<this.config.levelUpdateThrottle)&&(this.lastLevelEmit=t,this.callbacks.levelUpdate))try{this.callbacks.levelUpdate({level:this.currentLevel,rawData:this.getFrequencyData(),timestamp:t,history:this.getLevelHistory()})}catch(t){}}},{key:"emitVolumeSpike",value:function(t){if(this.callbacks.volumeSpike)try{this.callbacks.volumeSpike(t)}catch(t){}}},{key:"emitError",value:function(t,e){if(this.callbacks.error)try{this.callbacks.error({message:t,error:e,timestamp:performance.now()})}catch(t){}}}],[{key:"isSupported",value:function(){return!(!window.AudioContext&&!window.webkitAudioContext)}}])}();function Le(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Ve(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Le(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Le(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function He(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Xe(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Xe(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function Xe(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}const Ye=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.listeners=new Map,this.onceListeners=new Set,this.maxListeners=e.maxListeners||100,this.enableDebugging=e.enableDebugging||!1,this.enableMonitoring=e.enableMonitoring||!1,this.totalListenerCount=0,this.listenerHistory=[],this.memoryWarningThreshold=e.memoryWarningThreshold||50,this.eventStats=new Map,this.isDestroyed=!1,this.cleanup=this.cleanup.bind(this),this.enableDebugging},[{key:"on",value:function(t,e){if(this.isDestroyed)return!1;if(!this.validateEvent(t,e).isValid)return!1;if(this.totalListenerCount>=this.maxListeners)return!1;this.listeners.has(t)||(this.listeners.set(t,[]),this.eventStats.set(t,{listenerCount:0,emitCount:0,lastEmit:null,created:Date.now()}));var i=this.listeners.get(t);return i.push(e),this.totalListenerCount++,this.eventStats.get(t).listenerCount=i.length,this.enableMonitoring&&this.checkMemoryUsage(),this.enableDebugging,this.emitInternal("listenerAdded",{event:t,listenerCount:i.length,totalListeners:this.totalListenerCount}),!0}},{key:"off",value:function(t,e){if(this.isDestroyed)return!1;if(!this.listeners.has(t))return!1;var i=this.listeners.get(t),n=i.indexOf(e);if(-1===n)return!1;(i.splice(n,1),this.totalListenerCount--,this.onceListeners.delete(e),0===i.length)?(this.listeners.delete(t),this.eventStats.delete(t)):this.eventStats.get(t).listenerCount=i.length;return this.enableDebugging,this.emitInternal("listenerRemoved",{event:t,listenerCount:i.length,totalListeners:this.totalListenerCount}),!0}},{key:"once",value:function(t,e){var i=this;if(this.isDestroyed)return!1;var n=function(a){try{e(a)}finally{i.off(t,n)}};this.onceListeners.add(n);var a=this.on(t,n);return this.enableDebugging,a}},{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isDestroyed)return 0;if(!this.listeners.has(t))return 0;var i=this.listeners.get(t),n=0,r=this.eventStats.get(t);r.emitCount++,r.lastEmit=Date.now();for(var s=0,o=a(i);s<o.length;s++){var h=o[s];try{h(e),n++}catch(e){this.emitInternal("listenerError",{event:t,error:e.message,stack:e.stack})}}return this.enableDebugging,n}},{key:"removeAllListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.isDestroyed)return 0;var e=0;if(null===t){var i,n=He(this.listeners);try{for(n.s();!(i=n.n()).done;){var a=y(i.value,2);a[0];e+=a[1].length}}catch(t){n.e(t)}finally{n.f()}this.listeners.clear(),this.eventStats.clear(),this.onceListeners.clear(),this.totalListenerCount=0,this.enableDebugging}else if(this.listeners.has(t)){var r=this.listeners.get(t);e=r.length;var s,o=He(r);try{for(o.s();!(s=o.n()).done;){var h=s.value;this.onceListeners.delete(h)}}catch(t){o.e(t)}finally{o.f()}this.listeners.delete(t),this.eventStats.delete(t),this.totalListenerCount-=e,this.enableDebugging}return e>0&&this.emitInternal("listenersCleared",{event:t,removedCount:e,totalListeners:this.totalListenerCount}),e}},{key:"listenerCount",value:function(t){return this.listeners.has(t)?this.listeners.get(t).length:0}},{key:"getEventNames",value:function(){return Array.from(this.listeners.keys())}},{key:"getEventStats",value:function(){var t,e={totalListeners:this.totalListenerCount,totalEvents:this.listeners.size,onceListeners:this.onceListeners.size,events:{}},i=He(this.eventStats);try{for(i.s();!(t=i.n()).done;){var n=y(t.value,2),a=n[0],r=n[1];e.events[a]=Ve(Ve({},r),{},{currentListeners:this.listenerCount(a)})}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"validateEvent",value:function(t,e){return"string"==typeof t&&t.trim()?"function"!=typeof e?{isValid:!1,error:"Event callback must be a function"}:{isValid:!0}:{isValid:!1,error:"Event name must be a non-empty string"}}},{key:"checkMemoryUsage",value:function(){this.totalListenerCount>this.memoryWarningThreshold&&this.emitInternal("memoryWarning",{totalListeners:this.totalListenerCount,maxListeners:this.maxListeners,threshold:this.memoryWarningThreshold}),this.listenerHistory.push({timestamp:Date.now(),count:this.totalListenerCount}),this.listenerHistory.length>100&&this.listenerHistory.shift()}},{key:"detectMemoryLeaks",value:function(){if(this.listenerHistory.length<10)return{hasLeak:!1,reason:"Insufficient data"};var t=this.listenerHistory.slice(-10),e=(t[t.length-1].count-t[0].count)/((t[t.length-1].timestamp-t[0].timestamp)/1e3);if(e>10)return{hasLeak:!0,reason:"Rapid listener growth detected",growthRate:e,recommendation:"Check for missing off() calls or cleanup in once() listeners"};var i=t.reduce(function(t,e){return t+e.count},0)/t.length;return i>.8*this.memoryWarningThreshold?{hasLeak:!0,reason:"Consistently high listener count",averageCount:i,recommendation:"Review listener lifecycle and cleanup patterns"}:{hasLeak:!1}}},{key:"emitInternal",value:function(t,e){var i=this;!this.isDestroyed&&this.listeners.has(t)&&setTimeout(function(){i.isDestroyed||i.emit(t,e)},0)}},{key:"cleanup",value:function(){if(!this.isDestroyed){this.totalListenerCount;this.listeners.clear(),this.eventStats.clear(),this.onceListeners.clear(),this.listenerHistory=[],this.totalListenerCount=0,this.enableDebugging}}},{key:"destroy",value:function(){this.isDestroyed||(this.cleanup(),this.isDestroyed=!0,this.enableDebugging)}},{key:"getDebugInfo",value:function(){return{isDestroyed:this.isDestroyed,totalListeners:this.totalListenerCount,maxListeners:this.maxListeners,eventCount:this.listeners.size,onceListenerCount:this.onceListeners.size,memoryWarningThreshold:this.memoryWarningThreshold,enableDebugging:this.enableDebugging,enableMonitoring:this.enableMonitoring,events:this.getEventNames(),stats:this.getEventStats(),memoryLeakCheck:this.detectMemoryLeaks()}}}])}();function Ue(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Ne(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ue(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ue(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const We=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.config=Ne({enableReducedMotion:!1!==e.enableReducedMotion,enableHighContrast:!1!==e.enableHighContrast,enableScreenReaderSupport:!1!==e.enableScreenReaderSupport,enableKeyboardNavigation:!1!==e.enableKeyboardNavigation,enableFocusIndicators:!1!==e.enableFocusIndicators,announceStateChanges:!1!==e.announceStateChanges,colorBlindMode:e.colorBlindMode||"none"},e),this.reducedMotionPreferred=!1,this.highContrastEnabled=!1,this.screenReaderActive=!1,this.keyboardNavigationActive=!1,this.currentColorBlindMode=this.config.colorBlindMode,this.focusableElements=new Map,this.currentFocusIndex=-1,this.focusHistory=[],this.liveRegion=null,this.announcementQueue=[],this.colorSchemes={normal:null,highContrast:{primary:"#FFFFFF",secondary:"#000000",accent:"#FFFF00",background:"#000000",particles:"#FFFFFF"},protanopia:{primary:"#0066CC",secondary:"#FFCC00",accent:"#00CCFF",background:"#1A1A1A",particles:"#66CCFF"},deuteranopia:{primary:"#0099FF",secondary:"#FF9900",accent:"#FF00FF",background:"#1A1A1A",particles:"#9966FF"},tritanopia:{primary:"#FF0066",secondary:"#00FF66",accent:"#FF6600",background:"#1A1A1A",particles:"#FFCC00"}},this.patterns={dots:"dots",stripes:"stripes",crosshatch:"crosshatch",solid:"solid"},this.statePatterns={idle:this.patterns.solid,happy:this.patterns.dots,excited:this.patterns.stripes,calm:this.patterns.solid,curious:this.patterns.crosshatch,frustrated:this.patterns.stripes,sad:this.patterns.dots,neutral:this.patterns.solid},this.initialize()},[{key:"initialize",value:function(){this.detectUserPreferences(),this.setupLiveRegion(),this.config.enableKeyboardNavigation&&this.setupKeyboardNavigation(),this.setupPreferenceListeners()}},{key:"detectUserPreferences",value:function(){if(this.config.enableReducedMotion&&window.matchMedia){var t=window.matchMedia("(prefers-reduced-motion: reduce)");this.reducedMotionPreferred=t.matches}if(this.config.enableHighContrast&&window.matchMedia){var e=window.matchMedia("(prefers-contrast: high)");if(this.highContrastEnabled=e.matches,!this.highContrastEnabled){var i=window.matchMedia("(-ms-high-contrast: active)");this.highContrastEnabled=i.matches}}this.detectScreenReader()}},{key:"detectScreenReader",value:function(){var t=document.querySelector("[aria-live]"),e=document.querySelector("[aria-atomic]"),i=document.querySelector('[role="application"]'),n=navigator.userAgent.toLowerCase(),a=n.includes("nvda")||n.includes("jaws")||n.includes("voiceover");this.screenReaderActive=!!(t||e||i||a)}},{key:"setupLiveRegion",value:function(){this.config.enableScreenReaderSupport&&(this.liveRegion=document.getElementById("mascot-announcements"),this.liveRegion||(this.liveRegion=document.createElement("div"),this.liveRegion.id="mascot-announcements",this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.style.position="absolute",this.liveRegion.style.left="-10000px",this.liveRegion.style.width="1px",this.liveRegion.style.height="1px",this.liveRegion.style.overflow="hidden",document.body.appendChild(this.liveRegion)))}},{key:"setupKeyboardNavigation",value:function(){document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this))}},{key:"setupPreferenceListeners",value:function(){var t=this;window.matchMedia&&(window.matchMedia("(prefers-reduced-motion: reduce)").addListener(function(e){t.reducedMotionPreferred=e.matches,t.onPreferenceChange("reducedMotion",e.matches)}),window.matchMedia("(prefers-contrast: high)").addListener(function(e){t.highContrastEnabled=e.matches,t.onPreferenceChange("highContrast",e.matches)}))}},{key:"handleKeyDown",value:function(t){if(this.config.enableKeyboardNavigation){switch(t.key){case"Tab":t.preventDefault(),this.navigateFocus(t.shiftKey?-1:1);break;case"Enter":case" ":this.activateCurrentFocus();break;case"Escape":this.clearFocus();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.handleArrowNavigation(t.key)}this.keyboardNavigationActive=!0}}},{key:"handleKeyUp",value:function(t){}},{key:"navigateFocus",value:function(t){var e=Array.from(this.focusableElements.values());if(0!==e.length){this.currentFocusIndex+=t,this.currentFocusIndex<0?this.currentFocusIndex=e.length-1:this.currentFocusIndex>=e.length&&(this.currentFocusIndex=0);var i=e[this.currentFocusIndex];this.setFocus(i),i.label&&this.announce("Focused on ".concat(i.label))}}},{key:"handleArrowNavigation",value:function(t){var e={ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1}}[t];e&&this.onArrowNavigation&&this.onArrowNavigation(e)}},{key:"registerFocusableElement",value:function(t,e){this.focusableElements.set(t,{id:t,label:e.label||t,bounds:e.bounds||null,action:e.action||null,type:e.type||"button"})}},{key:"unregisterFocusableElement",value:function(t){this.focusableElements.delete(t)}},{key:"setFocus",value:function(t){this.onFocusChange&&this.onFocusChange(t),this.focusHistory.push(t.id),this.focusHistory.length>10&&this.focusHistory.shift()}},{key:"clearFocus",value:function(){this.currentFocusIndex=-1,this.onFocusChange&&this.onFocusChange(null),this.announce("Focus cleared")}},{key:"activateCurrentFocus",value:function(){var t=Array.from(this.focusableElements.values());if(this.currentFocusIndex>=0&&this.currentFocusIndex<t.length){var e=t[this.currentFocusIndex];e.action&&(e.action(),this.announce("Activated ".concat(e.label)))}}},{key:"announce",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polite";this.config.enableScreenReaderSupport&&this.liveRegion&&(this.announcementQueue.push({message:t,priority:e}),this.processAnnouncementQueue())}},{key:"processAnnouncementQueue",value:function(){var t=this;if(0!==this.announcementQueue.length){var e=this.announcementQueue.shift(),i=e.message,n=e.priority;this.liveRegion.setAttribute("aria-live",n),this.liveRegion.textContent=i,setTimeout(function(){t.liveRegion&&(t.liveRegion.textContent=""),t.announcementQueue.length>0&&t.processAnnouncementQueue()},100)}}},{key:"getAnimationSettings",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reducedMotionPreferred?Ne(Ne({},t),{},{duration:t.duration?.5*t.duration:0,iterations:1,easing:"linear",particlesEnabled:!1,complexAnimations:!1,autoPlay:!1}):t}},{key:"getColorScheme",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.colorSchemes.normal||(this.colorSchemes.normal=Ne({},t)),this.highContrastEnabled?this.colorSchemes.highContrast:"none"!==this.currentColorBlindMode&&this.colorSchemes[this.currentColorBlindMode]?this.colorSchemes[this.currentColorBlindMode]:t}},{key:"getStatePattern",value:function(t){return"none"===this.currentColorBlindMode?this.patterns.solid:this.statePatterns[t]||this.patterns.solid}},{key:"applyPatternOverlay",value:function(t,e,i){if(e!==this.patterns.solid){t.save();var n=document.createElement("canvas"),a=n.getContext("2d");switch(e){case this.patterns.dots:this.createDotPattern(a,n);break;case this.patterns.stripes:this.createStripePattern(a,n);break;case this.patterns.crosshatch:this.createCrosshatchPattern(a,n)}var r=t.createPattern(n,"repeat");t.fillStyle=r,t.globalAlpha=.3,t.fillRect(i.x,i.y,i.width,i.height),t.restore()}}},{key:"createDotPattern",value:function(t,e){e.width=10,e.height=10,t.fillStyle="white",t.beginPath(),t.arc(5,5,2,0,2*Math.PI),t.fill()}},{key:"createStripePattern",value:function(t,e){e.width=10,e.height=10,t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.moveTo(0,10),t.lineTo(10,0),t.stroke()}},{key:"createCrosshatchPattern",value:function(t,e){e.width=10,e.height=10,t.strokeStyle="white",t.lineWidth=1,t.beginPath(),t.moveTo(0,10),t.lineTo(10,0),t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(10,10),t.stroke()}},{key:"setColorBlindMode",value:function(t){["none","protanopia","deuteranopia","tritanopia"].includes(t)&&(this.currentColorBlindMode=t,this.announce("Color blind mode set to ".concat(t)),this.onColorSchemeChange&&this.onColorSchemeChange(this.getColorScheme()))}},{key:"getStatus",value:function(){return{reducedMotion:this.reducedMotionPreferred,highContrast:this.highContrastEnabled,screenReader:this.screenReaderActive,keyboardNavigation:this.keyboardNavigationActive,colorBlindMode:this.currentColorBlindMode,focusedElement:this.currentFocusIndex>=0?Array.from(this.focusableElements.values())[this.currentFocusIndex]:null,registeredElements:this.focusableElements.size}}},{key:"onPreferenceChange",value:function(t,e){this.announce("".concat(t," is now ").concat(e?"enabled":"disabled")),"reducedMotion"===t&&this.onReducedMotionChange&&this.onReducedMotionChange(e),"highContrast"===t&&this.onHighContrastChange&&this.onHighContrastChange(e)}},{key:"createStateDescription",value:function(t){return{idle:"Mascot is idle and gently breathing",happy:"Mascot is happy and bouncing",excited:"Mascot is excited with particles flying",calm:"Mascot is calm and peaceful",curious:"Mascot is curious and looking around",frustrated:"Mascot is frustrated and shaking",sad:"Mascot is sad and drooping",neutral:"Mascot is in a neutral state"}[t.emotional]||"Mascot is active"}},{key:"destroy",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.liveRegion&&this.liveRegion.parentNode&&this.liveRegion.parentNode.removeChild(this.liveRegion),this.focusableElements.clear(),this.announcementQueue=[],this.focusHistory=[]}}])}();function Qe(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Je(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Je(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function Je(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Ze(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function $e(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ze(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ze(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const Ke=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.config=$e({enableTouchOptimization:!1!==e.enableTouchOptimization,enableViewportHandling:!1!==e.enableViewportHandling,enableBatteryOptimization:!1!==e.enableBatteryOptimization,enableOrientationSupport:!1!==e.enableOrientationSupport,enableResponsiveScaling:!1!==e.enableResponsiveScaling,touchSensitivity:e.touchSensitivity||1,doubleTapDelay:e.doubleTapDelay||300,swipeThreshold:e.swipeThreshold||50,pinchThreshold:e.pinchThreshold||.1},e),this.isMobile=this.detectMobile(),this.isTablet=this.detectTablet(),this.isTouchDevice=this.detectTouch(),this.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent),this.isAndroid=/Android/.test(navigator.userAgent),this.touches=new Map,this.lastTouchTime=0,this.lastTapTime=0,this.tapCount=0,this.touchStartPosition=null,this.isPinching=!1,this.isRotating=!1,this.lastPinchDistance=0,this.lastRotation=0,this.currentGesture=null,this.gestureStartTime=0,this.gestureHistory=[],this.viewportSize={width:window.innerWidth,height:window.innerHeight},this.orientation=this.getOrientation(),this.pixelRatio=window.devicePixelRatio||1,this.lastViewportChange=0,this.batteryLevel=1,this.isCharging=!0,this.lowPowerMode=!1,this.mobilePerformanceSettings={reducedParticles:this.isMobile,simplifiedAnimations:this.isMobile,lowerFrameRate:this.isMobile,reducedEffects:this.isMobile||this.isTablet,targetFPS:this.isMobile?30:60,maxParticles:this.isMobile?20:50},this.canvasScale=1,this.useOffscreenCanvas=this.supportsOffscreenCanvas(),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleTouchCancel=this.handleTouchCancel.bind(this),this.handleOrientationChange=this.handleOrientationChange.bind(this),this.handleViewportChange=this.handleViewportChange.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.initialize()},[{key:"initialize",value:function(){this.config.enableTouchOptimization&&this.isTouchDevice&&this.setupTouchHandlers(),this.config.enableViewportHandling&&this.setupViewportHandlers(),this.config.enableBatteryOptimization&&this.setupBatteryMonitoring(),this.config.enableOrientationSupport&&this.setupOrientationHandlers(),this.applyMobileOptimizations()}},{key:"detectMobile",value:function(){var t=navigator.userAgent.toLowerCase(),e=["android","iphone","ipod","windows phone","blackberry"].some(function(e){return t.includes(e)}),i=window.innerWidth<=768,n="ontouchstart"in window||navigator.maxTouchPoints>0;return e||i&&n}},{key:"detectTablet",value:function(){var t=navigator.userAgent.toLowerCase(),e=/ipad/.test(t),i=/android/.test(t)&&!/mobile/.test(t),n=/windows/.test(t)&&/touch/.test(t),a=window.innerWidth>768&&window.innerWidth<=1024,r="ontouchstart"in window||navigator.maxTouchPoints>0;return e||i||n||a&&r}},{key:"detectTouch",value:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}},{key:"supportsOffscreenCanvas",value:function(){return"undefined"!=typeof OffscreenCanvas}},{key:"setupTouchHandlers",value:function(){var t=this.getCanvas();t&&(t.style.touchAction="none",t.style.userSelect="none",t.style.webkitUserSelect="none",t.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),t.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),t.addEventListener("touchend",this.handleTouchEnd,{passive:!1}),t.addEventListener("touchcancel",this.handleTouchCancel,{passive:!1}),t.addEventListener("contextmenu",function(t){return t.preventDefault()}))}},{key:"setupViewportHandlers",value:function(){window.addEventListener("resize",this.handleViewportChange),window.addEventListener("orientationchange",this.handleOrientationChange),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.setupViewportMeta()}},{key:"setupViewportMeta",value:function(){var t=document.querySelector('meta[name="viewport"]');t||((t=document.createElement("meta")).name="viewport",document.head.appendChild(t)),t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}},{key:"setupBatteryMonitoring",value:(t=o(v.mark(function t(){var e,i=this;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(navigator.getBattery){t.next=1;break}return t.abrupt("return");case 1:return t.prev=1,t.next=2,navigator.getBattery();case 2:e=t.sent,this.batteryLevel=e.level,this.isCharging=e.charging,e.addEventListener("levelchange",function(){i.batteryLevel=e.level,i.onBatteryChange()}),e.addEventListener("chargingchange",function(){i.isCharging=e.charging,i.onBatteryChange()}),this.onBatteryChange(),t.next=4;break;case 3:t.prev=3,t.catch(1);case 4:case"end":return t.stop()}},t,this,[[1,3]])})),function(){return t.apply(this,arguments)})},{key:"setupOrientationHandlers",value:function(){var t=this;window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(e){t.handleDeviceOrientation(e)})}},{key:"handleTouchStart",value:function(t){t.preventDefault();var e=Date.now();this.gestureStartTime=e;var i,n=Qe(t.touches);try{for(n.s();!(i=n.n()).done;){var a=i.value;this.touches.set(a.identifier,{id:a.identifier,startX:a.clientX,startY:a.clientY,currentX:a.clientX,currentY:a.clientY,startTime:e})}}catch(t){n.e(t)}finally{n.f()}1===t.touches.length?this.handleSingleTouchStart(t.touches[0]):2===t.touches.length&&this.handleMultiTouchStart(t.touches),this.emitTouchEvent("touchStart",{touches:Array.from(this.touches.values()),timestamp:e})}},{key:"handleSingleTouchStart",value:function(t){var e=Date.now();e-this.lastTapTime<this.config.doubleTapDelay?this.tapCount++:this.tapCount=1,this.lastTapTime=e,this.touchStartPosition={x:t.clientX,y:t.clientY}}},{key:"handleMultiTouchStart",value:function(t){if(2===t.length){var e=t[0],i=t[1];this.lastPinchDistance=this.getDistance(e.clientX,e.clientY,i.clientX,i.clientY),this.lastRotation=this.getAngle(e.clientX,e.clientY,i.clientX,i.clientY),this.isPinching=!0}}},{key:"handleTouchMove",value:function(t){t.preventDefault();var e,i=Qe(t.touches);try{for(i.s();!(e=i.n()).done;){var n=e.value,a=this.touches.get(n.identifier);a&&(a.currentX=n.clientX,a.currentY=n.clientY)}}catch(t){i.e(t)}finally{i.f()}1===t.touches.length?this.handleSingleTouchMove(t.touches[0]):2===t.touches.length&&this.handleMultiTouchMove(t.touches),this.emitTouchEvent("touchMove",{touches:Array.from(this.touches.values()),gesture:this.currentGesture})}},{key:"handleSingleTouchMove",value:function(t){var e=this.touches.get(t.identifier);if(e){var i=t.clientX-e.startX,n=t.clientY-e.startY;if(Math.sqrt(i*i+n*n)>this.config.swipeThreshold){Math.atan2(n,i),Math.PI;Math.abs(i)>Math.abs(n)?this.currentGesture=i>0?"swipeRight":"swipeLeft":this.currentGesture=n>0?"swipeDown":"swipeUp"}else this.currentGesture="pan"}}},{key:"handleMultiTouchMove",value:function(t){if(2===t.length){var e=t[0],i=t[1],n=this.getDistance(e.clientX,e.clientY,i.clientX,i.clientY),a=n-this.lastPinchDistance,r=n/this.lastPinchDistance;Math.abs(a)>this.config.pinchThreshold&&(this.currentGesture=r>1?"pinchOut":"pinchIn",this.emitTouchEvent("pinch",{scale:r,delta:a}));var s=this.getAngle(e.clientX,e.clientY,i.clientX,i.clientY),o=s-this.lastRotation;Math.abs(o)>5&&(this.currentGesture="rotate",this.emitTouchEvent("rotate",{angle:s,delta:o})),this.lastPinchDistance=n,this.lastRotation=s}}},{key:"handleTouchEnd",value:function(t){t.preventDefault();var e,i=Date.now(),n=Qe(t.changedTouches);try{for(n.s();!(e=n.n()).done;){var a=e.value,r=this.touches.get(a.identifier);if(r){var s=i-r.startTime,o=r.currentX-r.startX,h=r.currentY-r.startY,u=Math.sqrt(o*o+h*h);s<300&&u<10&&(2===this.tapCount?(this.emitTouchEvent("doubleTap",{x:r.currentX,y:r.currentY}),this.tapCount=0):this.emitTouchEvent("tap",{x:r.currentX,y:r.currentY})),s>500&&u<10&&this.emitTouchEvent("longPress",{x:r.currentX,y:r.currentY}),this.touches.delete(a.identifier)}}}catch(t){n.e(t)}finally{n.f()}0===t.touches.length&&(this.currentGesture=null,this.isPinching=!1,this.isRotating=!1),this.emitTouchEvent("touchEnd",{gesture:this.currentGesture,duration:i-this.gestureStartTime})}},{key:"handleTouchCancel",value:function(t){this.touches.clear(),this.currentGesture=null,this.isPinching=!1,this.isRotating=!1,this.emitTouchEvent("touchCancel",{})}},{key:"handleOrientationChange",value:function(t){this.orientation=this.getOrientation(),this.emitTouchEvent("orientationChange",{orientation:this.orientation,angle:window.orientation||0}),this.applyOrientationOptimizations()}},{key:"handleDeviceOrientation",value:function(t){var e=t.alpha,i=t.beta,n=t.gamma;this.emitTouchEvent("deviceOrientation",{alpha:e,beta:i,gamma:n})}},{key:"handleViewportChange",value:function(t){var e=Date.now();e-this.lastViewportChange<100||(this.lastViewportChange=e,this.viewportSize={width:window.innerWidth,height:window.innerHeight},this.pixelRatio=window.devicePixelRatio||1,this.emitTouchEvent("viewportChange",{size:this.viewportSize,pixelRatio:this.pixelRatio,orientation:this.getOrientation()}),this.config.enableResponsiveScaling&&this.applyResponsiveScaling())}},{key:"handleVisibilityChange",value:function(t){var e=!document.hidden;this.emitTouchEvent("visibilityChange",{visible:e}),!e&&this.config.enableBatteryOptimization?this.applyBackgroundOptimizations():this.restorePerformance()}},{key:"getOrientation",value:function(){return window.innerWidth>window.innerHeight?"landscape":"portrait"}},{key:"getDistance",value:function(t,e,i,n){var a=i-t,r=n-e;return Math.sqrt(a*a+r*r)}},{key:"getAngle",value:function(t,e,i,n){return 180*Math.atan2(n-e,i-t)/Math.PI}},{key:"applyMobileOptimizations",value:function(){if(this.isMobile||this.isTablet){var t=$e($e({},this.mobilePerformanceSettings),{},{canvasScale:this.calculateOptimalCanvasScale(),useWebGL:!1,useOffscreenCanvas:this.useOffscreenCanvas});return this.emitTouchEvent("mobileOptimizations",t),t}}},{key:"applyOrientationOptimizations",value:function(){var t="landscape"===this.orientation,e={layoutMode:t?"horizontal":"vertical",particleDirection:t?"horizontal":"vertical",uiScale:t?.8:1};return this.emitTouchEvent("orientationOptimizations",e),e}},{key:"applyResponsiveScaling",value:function(){var t=Math.min(this.viewportSize.width/375,2);return this.canvasScale=t,this.emitTouchEvent("responsiveScale",{scale:this.canvasScale,viewport:this.viewportSize}),this.canvasScale}},{key:"applyBackgroundOptimizations",value:function(){var t={targetFPS:5,particlesEnabled:!1,animationsEnabled:!1,audioEnabled:!1};return this.emitTouchEvent("backgroundOptimizations",t),t}},{key:"restorePerformance",value:function(){var t=this.applyMobileOptimizations();return this.emitTouchEvent("performanceRestore",t),t}},{key:"onBatteryChange",value:function(){if(this.lowPowerMode=this.batteryLevel<.2&&!this.isCharging,this.lowPowerMode){this.emitTouchEvent("lowPowerMode",{batteryLevel:this.batteryLevel,isCharging:this.isCharging,optimizations:{targetFPS:15,maxParticles:5,reducedEffects:!0,audioEnabled:!1}})}}},{key:"calculateOptimalCanvasScale",value:function(){return this.isMobile?Math.min(this.pixelRatio,2):this.isTablet?Math.min(this.pixelRatio,2.5):this.pixelRatio}},{key:"getCanvas",value:function(){return this.canvas||document.querySelector("canvas")}},{key:"setCanvas",value:function(t){this.canvas=t,this.config.enableTouchOptimization&&this.isTouchDevice&&this.setupTouchHandlers()}},{key:"emitTouchEvent",value:function(t,e){this.onTouchEvent&&this.onTouchEvent(t,e)}},{key:"getStatus",value:function(){return{device:{isMobile:this.isMobile,isTablet:this.isTablet,isTouchDevice:this.isTouchDevice,isIOS:this.isIOS,isAndroid:this.isAndroid},viewport:{size:this.viewportSize,orientation:this.orientation,pixelRatio:this.pixelRatio,canvasScale:this.canvasScale},battery:{level:this.batteryLevel,isCharging:this.isCharging,lowPowerMode:this.lowPowerMode},touch:{activeTouches:this.touches.size,currentGesture:this.currentGesture,isPinching:this.isPinching,isRotating:this.isRotating},performance:this.mobilePerformanceSettings}}},{key:"destroy",value:function(){var t=this.getCanvas();t&&(t.removeEventListener("touchstart",this.handleTouchStart),t.removeEventListener("touchmove",this.handleTouchMove),t.removeEventListener("touchend",this.handleTouchEnd),t.removeEventListener("touchcancel",this.handleTouchCancel)),window.removeEventListener("resize",this.handleViewportChange),window.removeEventListener("orientationchange",this.handleOrientationChange),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.touches.clear(),this.gestureHistory=[]}}]);var t}();function ti(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return ei(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ei(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function ei(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function ii(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function ni(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ii(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ii(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const ai=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.config=ni({enablePlugins:!1!==e.enablePlugins,validatePlugins:!1!==e.validatePlugins,sandboxPlugins:!1!==e.sandboxPlugins,maxPlugins:e.maxPlugins||50,pluginTimeout:e.pluginTimeout||5e3,allowOverrides:!1!==e.allowOverrides},e),this.plugins=new Map,this.pluginTypes=["emotion","gesture","particle","audio","renderer","animation"],this.pluginsByType=new Map(this.pluginTypes.map(function(t){return[t,new Set]})),this.dependencies=new Map,this.dependencyGraph=new Map,this.pluginStates=new Map,this.loadingPlugins=new Set,this.activePlugins=new Set,this.hooks=new Map([["beforeInit",new Set],["afterInit",new Set],["beforeUpdate",new Set],["afterUpdate",new Set],["beforeRender",new Set],["afterRender",new Set],["beforeDestroy",new Set],["afterDestroy",new Set]]),this.pluginAPI=this.createPluginAPI(),this.conflicts=new Map,this.resolutionStrategies={override:this.overrideConflict.bind(this),merge:this.mergeConflict.bind(this),reject:this.rejectConflict.bind(this),queue:this.queueConflict.bind(this)},this.validationSchemas=this.createValidationSchemas(),this.sandbox=null,this.config.sandboxPlugins&&(this.sandbox=this.createSandbox())},[{key:"createPluginAPI",value:function(){var t=this;return{registerHook:this.registerHook.bind(this),emit:this.emitPluginEvent.bind(this),on:this.onPluginEvent.bind(this),getPlugin:this.getPlugin.bind(this),hasPlugin:this.hasPlugin.bind(this),log:this.logFromPlugin.bind(this),error:this.errorFromPlugin.bind(this),setState:this.setPluginState.bind(this),getState:this.getPluginState.bind(this),getConfig:function(){return ni({},t.config)},version:"1.0.0"}}},{key:"createValidationSchemas",value:function(){var t=new Map,e={name:{type:"string",required:!0},version:{type:"string",required:!0},type:{type:"string",required:!0,enum:this.pluginTypes},description:{type:"string",required:!1},author:{type:"string",required:!1},dependencies:{type:"array",required:!1},conflicts:{type:"array",required:!1},init:{type:"function",required:!0},destroy:{type:"function",required:!0}};return t.set("emotion",ni(ni({},e),{},{emotion:{type:"object",required:!0,properties:{name:{type:"string",required:!0},color:{type:"string",required:!0},particleColor:{type:"string",required:!1},animation:{type:"object",required:!0},transitions:{type:"object",required:!1}}},updateEmotion:{type:"function",required:!0},renderEmotion:{type:"function",required:!1}})),t.set("gesture",ni(ni({},e),{},{gesture:{type:"object",required:!0,properties:{name:{type:"string",required:!0},duration:{type:"number",required:!0},keyframes:{type:"array",required:!0},compatibility:{type:"object",required:!1}}},executeGesture:{type:"function",required:!0},canExecute:{type:"function",required:!1}})),t.set("particle",ni(ni({},e),{},{particle:{type:"object",required:!0,properties:{name:{type:"string",required:!0},maxParticles:{type:"number",required:!1},behavior:{type:"function",required:!0},render:{type:"function",required:!0}}},updateParticles:{type:"function",required:!0},spawnParticle:{type:"function",required:!1}})),t.set("audio",ni(ni({},e),{},{audio:{type:"object",required:!0,properties:{name:{type:"string",required:!0},sounds:{type:"object",required:!0},effects:{type:"array",required:!1}}},playSound:{type:"function",required:!0},processAudio:{type:"function",required:!1}})),t}},{key:"createSandbox",value:function(){return{Math,Date,JSON,console:{log:function(){return null},warn:function(){return null},error:function(){return null}},window:void 0,document:void 0,localStorage:void 0,sessionStorage:void 0,fetch:void 0,XMLHttpRequest:void 0,api:this.pluginAPI}}},{key:"registerPlugin",value:(c=o(v.mark(function t(e){var i,n=this;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.config.enablePlugins){t.next=1;break}return t.abrupt("return",!1);case 1:if(!(this.plugins.size>=this.config.maxPlugins)){t.next=2;break}return t.abrupt("return",!1);case 2:if(!this.config.validatePlugins){t.next=3;break}if(this.validatePlugin(e).valid){t.next=3;break}return t.abrupt("return",!1);case 3:if(!(this.checkConflicts(e).length>0)||this.config.allowOverrides){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=5,this.resolveDependencies(e);case 5:if(t.sent.resolved){t.next=6;break}return t.abrupt("return",!1);case 6:return t.prev=6,this.loadingPlugins.add(e.name),i=this.config.sandboxPlugins?this.sandbox:window,t.next=7,this.initializePlugin(e,i);case 7:if(t.sent){t.next=8;break}throw new Error("Plugin initialization failed");case 8:return this.plugins.set(e.name,e),this.pluginsByType.get(e.type).add(e.name),this.pluginStates.set(e.name,"active"),this.activePlugins.add(e.name),e.dependencies&&(this.dependencies.set(e.name,e.dependencies),this.updateDependencyGraph(e.name,e.dependencies)),e.hooks&&Object.entries(e.hooks).forEach(function(t){var i=y(t,2),a=i[0],r=i[1];n.registerHook(a,r,e.name)}),this.emitPluginEvent("pluginRegistered",{name:e.name,type:e.type,version:e.version}),t.abrupt("return",!0);case 9:return t.prev=9,t.catch(6),t.abrupt("return",!1);case 10:return t.prev=10,this.loadingPlugins.delete(e.name),t.finish(10);case 11:case"end":return t.stop()}},t,this,[[6,9,10,11]])})),function(t){return c.apply(this,arguments)})},{key:"validatePlugin",value:function(t){var e=[];if(t.name&&"string"==typeof t.name||e.push("Plugin must have a valid name"),t.type&&this.pluginTypes.includes(t.type)||e.push("Plugin type must be one of: ".concat(this.pluginTypes.join(", "))),t.version&&"string"==typeof t.version||e.push("Plugin must have a version"),"function"!=typeof t.init&&e.push("Plugin must have an init function"),"function"!=typeof t.destroy&&e.push("Plugin must have a destroy function"),t.type&&this.validationSchemas.has(t.type)){var i=this.validationSchemas.get(t.type),n=this.validateAgainstSchema(t,i);e.push.apply(e,a(n))}return{valid:0===e.length,errors:e}}},{key:"validateAgainstSchema",value:function(t,e){var i=this,n=[];return Object.entries(e).forEach(function(e){var s=y(e,2),o=s[0],h=s[1];if(h.required&&!(o in t)&&n.push("Missing required property: ".concat(o)),o in t){var u=t[o];if(h.type&&(0,r.A)(u)!==h.type&&n.push("Property ".concat(o," must be of type ").concat(h.type)),h.enum&&!h.enum.includes(u)&&n.push("Property ".concat(o," must be one of: ").concat(h.enum.join(", "))),h.properties&&"object"===(0,r.A)(u)){var c=i.validateAgainstSchema(u,h.properties);n.push.apply(n,a(c.map(function(t){return"".concat(o,".").concat(t)})))}}}),n}},{key:"checkConflicts",value:function(t){var e=this,i=[];return t.conflicts&&t.conflicts.forEach(function(t){e.plugins.has(t)&&i.push(t)}),"emotion"!==t.type&&"gesture"!==t.type||this.plugins.forEach(function(e){if(e.type===t.type){var n,a,r=null===(n=e[t.type])||void 0===n?void 0:n.name,s=null===(a=t[t.type])||void 0===a?void 0:a.name;r===s&&i.push("".concat(t.type," name collision: ").concat(s))}}),i}},{key:"resolveDependencies",value:(h=o(v.mark(function t(e){var i,n,a,r,s;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.dependencies&&0!==e.dependencies.length){t.next=1;break}return t.abrupt("return",{resolved:!0,missing:[]});case 1:i=[],n=ti(e.dependencies),t.prev=2,n.s();case 3:if((a=n.n()).done){t.next=6;break}if(r=a.value,this.plugins.has(r)){t.next=5;break}return t.next=4,this.tryLoadDependency(r);case 4:t.sent||i.push(r);case 5:t.next=3;break;case 6:t.next=8;break;case 7:t.prev=7,s=t.catch(2),n.e(s);case 8:return t.prev=8,n.f(),t.finish(8);case 9:return t.abrupt("return",{resolved:0===i.length,missing:i});case 10:case"end":return t.stop()}},t,this,[[2,7,8,9]])})),function(t){return h.apply(this,arguments)})},{key:"tryLoadDependency",value:(s=o(v.mark(function t(e){return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.plugins.has(e));case 1:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"updateDependencyGraph",value:function(t,e){var i=this;this.dependencyGraph.set(t,new Set(e)),e.forEach(function(t){i.dependencyGraph.has(t)||i.dependencyGraph.set(t,new Set)})}},{key:"initializePlugin",value:(n=o(v.mark(function t(e,i){var n,a,r,s=this;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=new Promise(function(t,e){setTimeout(function(){return e(new Error("Plugin initialization timeout"))},s.config.pluginTimeout)}),a=e.init.bind(i),t.next=1,Promise.race([a(this.pluginAPI),n]);case 1:return r=t.sent,t.abrupt("return",!1!==r);case 2:return t.prev=2,t.catch(0),t.abrupt("return",!1);case 3:case"end":return t.stop()}},t,this,[[0,2]])})),function(t,e){return n.apply(this,arguments)})},{key:"unregisterPlugin",value:(i=o(v.mark(function t(e){var i;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.plugins.get(e)){t.next=1;break}return t.abrupt("return",!1);case 1:if(!(this.getDependentPlugins(e).length>0)){t.next=2;break}return t.abrupt("return",!1);case 2:if(t.prev=2,"function"!=typeof i.destroy){t.next=3;break}return t.next=3,i.destroy();case 3:return this.plugins.delete(e),this.pluginsByType.get(i.type).delete(e),this.pluginStates.delete(e),this.activePlugins.delete(e),this.dependencies.delete(e),this.dependencyGraph.delete(e),this.hooks.forEach(function(t){t.forEach(function(i){i.pluginName===e&&t.delete(i)})}),this.emitPluginEvent("pluginUnregistered",{name:e}),t.abrupt("return",!0);case 4:return t.prev=4,t.catch(2),t.abrupt("return",!1);case 5:case"end":return t.stop()}},t,this,[[2,4]])})),function(t){return i.apply(this,arguments)})},{key:"getDependentPlugins",value:function(t){var e=[];return this.dependencies.forEach(function(i,n){i.includes(t)&&e.push(n)}),e}},{key:"registerHook",value:function(t,e,i){this.hooks.has(t)||this.hooks.set(t,new Set),this.hooks.get(t).add({handler:e,pluginName:i})}},{key:"executeHooks",value:(e=o(v.mark(function t(e,i){var n,a,r,s,o,h,u;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((n=this.hooks.get(e))&&0!==n.size){t.next=1;break}return t.abrupt("return",[]);case 1:a=[],r=ti(n),t.prev=2,r.s();case 3:if((s=r.n()).done){t.next=8;break}return o=s.value,t.prev=4,t.next=5,o.handler(i);case 5:h=t.sent,a.push({pluginName:o.pluginName,result:h}),t.next=7;break;case 6:t.prev=6,t.catch(4);case 7:t.next=3;break;case 8:t.next=10;break;case 9:t.prev=9,u=t.catch(2),r.e(u);case 10:return t.prev=10,r.f(),t.finish(10);case 11:return t.abrupt("return",a);case 12:case"end":return t.stop()}},t,this,[[2,9,10,11],[4,6]])})),function(t,i){return e.apply(this,arguments)})},{key:"getPlugin",value:function(t){return this.plugins.get(t)||null}},{key:"hasPlugin",value:function(t){return this.plugins.has(t)}},{key:"getPluginsByType",value:function(t){var e=this,i=this.pluginsByType.get(t);return i?Array.from(i).map(function(t){return e.plugins.get(t)}):[]}},{key:"enablePlugin",value:function(t){if(this.plugins.has(t)){this.pluginStates.set(t,"active"),this.activePlugins.add(t);var e=this.plugins.get(t);e.onEnable&&e.onEnable(),this.emitPluginEvent("pluginEnabled",{name:t})}}},{key:"disablePlugin",value:function(t){if(this.plugins.has(t)){this.getDependentPlugins(t).length,this.pluginStates.set(t,"disabled"),this.activePlugins.delete(t);var e=this.plugins.get(t);e.onDisable&&e.onDisable(),this.emitPluginEvent("pluginDisabled",{name:t})}}},{key:"emitPluginEvent",value:function(t,e){this.onPluginEvent&&this.onPluginEvent(t,e)}},{key:"onPluginEvent",value:function(t,e){}},{key:"logFromPlugin",value:function(t){}},{key:"errorFromPlugin",value:function(t){}},{key:"setPluginState",value:function(t,e,i){this.pluginStates.has(t)||this.pluginStates.set(t,{});var n=this.pluginStates.get(t);"object"===(0,r.A)(n)&&(n[e]=i)}},{key:"getPluginState",value:function(t,e){var i=this.pluginStates.get(t);if("object"===(0,r.A)(i))return i[e]}},{key:"overrideConflict",value:function(t,e){return e}},{key:"mergeConflict",value:function(t,e){return ni(ni({},t),e)}},{key:"rejectConflict",value:function(t,e){return t}},{key:"queueConflict",value:function(t,e){return[t,e]}},{key:"getStatus",value:function(){return{enabled:this.config.enablePlugins,totalPlugins:this.plugins.size,activePlugins:this.activePlugins.size,loadingPlugins:this.loadingPlugins.size,pluginsByType:Object.fromEntries(Array.from(this.pluginsByType.entries()).map(function(t){var e=y(t,2);return[e[0],e[1].size]})),hooks:Object.fromEntries(Array.from(this.hooks.entries()).map(function(t){var e=y(t,2);return[e[0],e[1].size]}))}}},{key:"destroy",value:(t=o(v.mark(function t(){var e,i,n,a;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=Array.from(this.plugins.keys()),i=0,n=e;case 1:if(!(i<n.length)){t.next=3;break}return a=n[i],t.next=2,this.unregisterPlugin(a);case 2:i++,t.next=1;break;case 3:this.plugins.clear(),this.pluginsByType.clear(),this.dependencies.clear(),this.dependencyGraph.clear(),this.pluginStates.clear(),this.activePlugins.clear(),this.loadingPlugins.clear(),this.hooks.clear(),this.conflicts.clear();case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})}]);var t,e,i,n,s,h,c}();function ri(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return si(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?si(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function si(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function oi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function hi(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?oi(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):oi(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var ui=function(){return f(function t(){if(u(this,t),t.I)return this.features=t.I,void(this.capabilities=t.D);this.features={webAudio:this.detectWebAudio(),canvas2d:this.detectCanvas2D(),requestAnimationFrame:this.detectRequestAnimationFrame(),devicePixelRatio:this.detectDevicePixelRatio(),audioContext:this.detectAudioContext(),mediaDevices:this.detectMediaDevices(),performance:this.detectPerformance(),intersectionObserver:this.detectIntersectionObserver()},this.capabilities=this.assessCapabilities(),t.I=this.features,t.D=this.capabilities},[{key:"detectWebAudio",value:function(){try{return!(!window.AudioContext&&!window.webkitAudioContext)}catch(t){return!1}}},{key:"detectCanvas2D",value:function(){try{var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}catch(t){return!1}}},{key:"detectRequestAnimationFrame",value:function(){return!!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame)}},{key:"detectDevicePixelRatio",value:function(){return"number"==typeof window.devicePixelRatio}},{key:"detectAudioContext",value:function(){try{return!!(window.AudioContext||window.webkitAudioContext)}catch(t){return!1}}},{key:"detectMediaDevices",value:function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}},{key:"detectPerformance",value:function(){return!(!window.performance||!window.performance.now)}},{key:"detectIntersectionObserver",value:function(){return"function"==typeof window.IntersectionObserver}},{key:"assessCapabilities",value:function(){var t=Object.values(this.features).filter(Boolean).length,e=Object.keys(this.features).length,i=t/e*100,n="basic";return i>=90?n="full":i>=70?n="good":i>=50&&(n="limited"),{score:t,total:e,percentage:i,level:n,recommendations:this.getRecommendations(n)}}},{key:"getRecommendations",value:function(t){var e=[];return this.features.webAudio||e.push("Audio features will be disabled"),this.features.requestAnimationFrame||e.push("Animation will use setTimeout fallback"),this.features.performance||e.push("Performance monitoring will be limited"),"basic"===t&&e.push("Consider using minimal build for better performance"),e}},{key:"getFeatures",value:function(){return hi({},this.features)}},{key:"getCapabilities",value:function(){return hi({},this.capabilities)}}])}(),ci=function(){return f(function t(){u(this,t),this.polyfills=new Map,this.applied=new Set},[{key:"register",value:function(t,e){this.polyfills.set(t,e)}},{key:"apply",value:function(t){if(this.applied.has(t))return!0;var e=this.polyfills.get(t);if(!e)return!1;try{return e(),this.applied.add(t),!0}catch(t){return!1}}},{key:"applyAll",value:function(){var t,e=[],i=ri(this.polyfills.keys());try{for(i.s();!(t=i.n()).done;){var n=t.value;this.apply(n)&&e.push(n)}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"isApplied",value:function(t){return this.applied.has(t)}}])}();function li(){window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t(Date.now())},1e3/60)},window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){window.clearTimeout(t)})}function fi(){if(!window.performance||!window.performance.now){window.performance||(window.performance={});var t=Date.now();window.performance.now=function(){return Date.now()-t}}}function vi(){window.AudioContext||window.webkitAudioContext||(window.AudioContext=function(){this.state="suspended",this.sampleRate=44100,this.currentTime=0,this.destination={connect:function(){},disconnect:function(){}},this.createGain=function(){return{gain:{value:1},connect:function(){},disconnect:function(){}}},this.createOscillator=function(){return{frequency:{value:440},type:"sine",start:function(){},stop:function(){},connect:function(){},disconnect:function(){}}},this.createAnalyser=function(){return{fftSize:2048,frequencyBinCount:1024,getByteFrequencyData:function(t){for(var e=0;e<t.length;e++)t[e]=0},connect:function(){},disconnect:function(){}}},this.resume=function(){return this.state="running",Promise.resolve()},this.suspend=function(){return this.state="suspended",Promise.resolve()},this.close=function(){return this.state="closed",Promise.resolve()}})}var di=function(){return f(function t(e){u(this,t),this.canvas=e,this.context=null,this.isContextLost=!1,this.recoveryCallbacks=[],this.setupContextLossHandling()},[{key:"setupContextLossHandling",value:function(){var t=this;this.canvas.addEventListener("webglcontextlost",function(e){e.preventDefault(),t.isContextLost=!0}),this.canvas.addEventListener("webglcontextrestored",function(){t.isContextLost=!1,t.context=t.canvas.getContext("2d"),t.recoveryCallbacks.forEach(function(e){try{e(t.context)}catch(t){}})})}},{key:"getContext",value:function(){if(this.isContextLost)return null;if(!this.context)try{this.context=this.canvas.getContext("2d")}catch(t){return null}return this.context}},{key:"onRecovery",value:function(t){this.recoveryCallbacks.push(t)}},{key:"isLost",value:function(){return this.isContextLost}},{key:"recover",value:function(){if(!this.isContextLost)return!0;try{if(this.context=this.canvas.getContext("2d"),this.context)return this.isContextLost=!1,!0}catch(t){}return!1}}])}(),pi=function(){return f(function t(){if(u(this,t),t.q)return this.browser=t.q,void(this.optimizations=t._);this.browser=this.detectBrowser(),this.optimizations=new Map,this.setupOptimizations(),t.q=this.browser,t._=this.optimizations},[{key:"detectBrowser",value:function(){var t=navigator.userAgent,e="unknown",i="unknown";if(t.includes("Chrome")){e="chrome";var n=t.match(/Chrome\/(\d+)/);i=n?n[1]:"unknown"}else if(t.includes("Firefox")){e="firefox";var a=t.match(/Firefox\/(\d+)/);i=a?a[1]:"unknown"}else if(t.includes("Safari")&&!t.includes("Chrome")){e="safari";var r=t.match(/Version\/(\d+)/);i=r?r[1]:"unknown"}else if(t.includes("Edge")){e="edge";var s=t.match(/Edge\/(\d+)/);i=s?s[1]:"unknown"}return{name:e,version:i,userAgent:t}}},{key:"setupOptimizations",value:function(){this.optimizations.set("chrome",{preferredAnimationMethod:"requestAnimationFrame",audioContextOptions:{latencyHint:"interactive"},canvasOptimizations:["willReadFrequently"],particleLimit:50}),this.optimizations.set("firefox",{preferredAnimationMethod:"requestAnimationFrame",audioContextOptions:{latencyHint:"balanced"},canvasOptimizations:[],particleLimit:40}),this.optimizations.set("safari",{preferredAnimationMethod:"requestAnimationFrame",audioContextOptions:{latencyHint:"playback"},canvasOptimizations:[],particleLimit:30}),this.optimizations.set("edge",{preferredAnimationMethod:"requestAnimationFrame",audioContextOptions:{latencyHint:"interactive"},canvasOptimizations:["willReadFrequently"],particleLimit:45})}},{key:"getOptimizations",value:function(){return this.optimizations.get(this.browser.name)||this.optimizations.get("chrome")}},{key:"getBrowser",value:function(){return hi({},this.browser)}},{key:"applyCanvasOptimizations",value:function(t,e){if(this.getOptimizations().canvasOptimizations.includes("willReadFrequently"))try{t.getContext("2d",{willReadFrequently:!0})}catch(t){}}},{key:"getRecommendedParticleLimit",value:function(){return this.getOptimizations().particleLimit}},{key:"getAudioContextOptions",value:function(){return this.getOptimizations().audioContextOptions}}])}(),yi=null;var mi=null;var gi=(mi||(mi=function(){if(yi)return yi;var t=new ui,e=new ci,i=new pi;e.register("requestAnimationFrame",li),e.register("performanceNow",fi),e.register("webAudio",vi);var n=[];return t.features.requestAnimationFrame||e.apply("requestAnimationFrame")&&n.push("requestAnimationFrame"),t.features.performance||e.apply("performanceNow")&&n.push("performanceNow"),t.features.webAudio||e.apply("webAudio")&&n.push("webAudio"),yi={featureDetection:t,polyfillManager:e,browserOptimizations:i,appliedPolyfills:n,capabilities:t.getCapabilities(),browser:i.getBrowser()}}()),mi);function bi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Mi(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?bi(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):bi(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var ki={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4,TRACE:5},wi=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.config=Mi({enabled:!1!==e.enabled,level:e.level||ki.INFO,enableProfiling:!1!==e.enableProfiling,enableErrorTracking:!1!==e.enableErrorTracking,enableMemoryTracking:!1!==e.enableMemoryTracking,maxLogEntries:e.maxLogEntries||1e3,maxProfileEntries:e.maxProfileEntries||500},e),this.logs=[],this.errors=[],this.profiles=new Map,this.memorySnapshots=[],this.frameTimings=[],this.maxFrameTimings=120,this.errorCounts=new Map,this.lastErrors=new Map,this.capabilities={performance:"undefined"!=typeof performance&&performance.now,memory:"undefined"!=typeof performance&&performance.memory,console:"undefined"!=typeof console,stackTrace:"undefined"!=typeof Error},this.startTime=this.now(),this.setupErrorHandling(),this.config.enabled&&this.log("DEBUG","EmotiveDebugger initialized",{config:this.config,capabilities:this.capabilities})},[{key:"now",value:function(){return this.capabilities.performance?performance.now():Date.now()-this.startTime}},{key:"setupErrorHandling",value:function(){var t=this;this.config.enableErrorTracking&&"undefined"!=typeof window&&(window.addEventListener("error",function(e){t.trackError("UNHANDLED_ERROR",e.error||new Error(e.message),{filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",function(e){t.trackError("UNHANDLED_REJECTION",e.reason,{promise:e.promise})}))}},{key:"log",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.config.enabled&&!((ki[t]||ki.INFO)>this.config.level)){var n=this.now(),a={timestamp:n,level:t,message:e,data:i,stackTrace:this.getStackTrace()};if(this.logs.push(a),this.logs.length>this.config.maxLogEntries&&this.logs.shift(),this.capabilities.console){var r=this.getConsoleMethod(t),s="[".concat((n/1e3).toFixed(3),"s]");i?r("".concat(s," [").concat(t,"] ").concat(e),i):r("".concat(s," [").concat(t,"] ").concat(e))}}}},{key:"getConsoleMethod",value:function(t){return function(){}.bind(console)}},{key:"getStackTrace",value:function(){if(!this.capabilities.stackTrace)return null;try{throw new Error}catch(t){return t.stack}}},{key:"trackError",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.config.enableErrorTracking){var n={timestamp:this.now(),type:t,message:e.message||String(e),stack:e.stack,context:i,count:1},a="".concat(t,":").concat(e.message);this.errorCounts.has(a)?(this.errorCounts.set(a,this.errorCounts.get(a)+1),n.count=this.errorCounts.get(a)):this.errorCounts.set(a,1),this.errors.push(n),this.lastErrors.set(t,n),this.log("ERROR","".concat(t,": ").concat(e.message),{error:n,context:i})}}},{key:"startProfile",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.config.enableProfiling){var i={name:t,startTime:this.now(),metadata:e,samples:[],isActive:!0};this.profiles.set(t,i),this.log("TRACE","Started profiling: ".concat(t),e)}}},{key:"profileSample",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.config.enableProfiling){var n=this.profiles.get(t);if(n&&n.isActive){var a={timestamp:this.now(),label:e,data:i,relativeTime:this.now()-n.startTime};n.samples.push(a)}}}},{key:"endProfile",value:function(t){if(!this.config.enableProfiling)return null;var e=this.profiles.get(t);if(!e||!e.isActive)return null;if(e.endTime=this.now(),e.duration=e.endTime-e.startTime,e.isActive=!1,e.stats=this.calculateProfileStats(e),this.log("TRACE","Ended profiling: ".concat(t),{duration:e.duration,samples:e.samples.length,stats:e.stats}),this.profiles.size>this.config.maxProfileEntries){var i=this.profiles.keys().next().value;this.profiles.delete(i)}return Mi({},e)}},{key:"calculateProfileStats",value:function(t){if(0===t.samples.length)return{sampleCount:0};for(var e=[],i=1;i<t.samples.length;i++)e.push(t.samples[i].relativeTime-t.samples[i-1].relativeTime);if(0===e.length)return{sampleCount:t.samples.length};var n=e.reduce(function(t,e){return t+e},0)/e.length,a=Math.min.apply(Math,e),r=Math.max.apply(Math,e);return{sampleCount:t.samples.length,avgSampleDuration:n,minSampleDuration:a,maxSampleDuration:r,totalDuration:t.duration}}},{key:"trackFrameTiming",value:function(t){this.config.enableProfiling&&(this.frameTimings.push({timestamp:this.now(),frameTime:t,fps:1e3/t}),this.frameTimings.length>this.maxFrameTimings&&this.frameTimings.shift())}},{key:"takeMemorySnapshot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"snapshot";if(this.config.enableMemoryTracking&&this.capabilities.memory){var e={timestamp:this.now(),label:t,memory:{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit}};this.memorySnapshots.push(e),this.memorySnapshots.length>100&&this.memorySnapshots.shift(),this.log("DEBUG","Memory snapshot: ".concat(t),e.memory)}}},{key:"getDebugReport",value:function(){return{timestamp:this.now(),uptime:this.now()-0,config:this.config,capabilities:this.capabilities,logCount:this.logs.length,recentLogs:this.logs.slice(-10),errorCount:this.errors.length,uniqueErrors:this.errorCounts.size,recentErrors:this.errors.slice(-5),errorCounts:Object.fromEntries(this.errorCounts),activeProfiles:Array.from(this.profiles.values()).filter(function(t){return t.isActive}).length,completedProfiles:Array.from(this.profiles.values()).filter(function(t){return!t.isActive}).length,frameTimings:this.getFrameTimingStats(),memorySnapshots:this.memorySnapshots.slice(-5)}}},{key:"getFrameTimingStats",value:function(){if(0===this.frameTimings.length)return{sampleCount:0};var t=this.frameTimings.map(function(t){return t.frameTime}),e=this.frameTimings.map(function(t){return t.fps});return{sampleCount:this.frameTimings.length,avgFrameTime:t.reduce(function(t,e){return t+e},0)/t.length,minFrameTime:Math.min.apply(Math,a(t)),maxFrameTime:Math.max.apply(Math,a(t)),avgFPS:e.reduce(function(t,e){return t+e},0)/e.length,minFPS:Math.min.apply(Math,a(e)),maxFPS:Math.max.apply(Math,a(e))}}},{key:"exportDebugData",value:function(){return{metadata:{exportTime:Date.now(),debuggerUptime:this.now(),config:this.config,capabilities:this.capabilities},logs:a(this.logs),errors:a(this.errors),profiles:Object.fromEntries(this.profiles),frameTimings:a(this.frameTimings),memorySnapshots:a(this.memorySnapshots),errorCounts:Object.fromEntries(this.errorCounts)}}},{key:"clear",value:function(){this.logs=[],this.errors=[],this.profiles.clear(),this.frameTimings=[],this.memorySnapshots=[],this.errorCounts.clear(),this.lastErrors.clear(),this.log("INFO","Debug data cleared")}},{key:"destroy",value:function(){this.clear(),this.config.enabled=!1}}])}(),Si=function(){return f(function t(){u(this,t),this.capabilities=this.detectCapabilities(),this.performance=this.measurePerformance()},[{key:"detectCapabilities",value:function(){return{es6:this.detectES6(),es2017:this.detectES2017(),modules:this.detectModules(),webGL:this.detectWebGL(),webGL2:this.detectWebGL2(),webWorkers:this.detectWebWorkers(),serviceWorkers:this.detectServiceWorkers(),performanceObserver:this.detectPerformanceObserver(),intersectionObserver:this.detectIntersectionObserver(),resizeObserver:this.detectResizeObserver(),localStorage:this.detectLocalStorage(),sessionStorage:this.detectSessionStorage(),indexedDB:this.detectIndexedDB(),fetch:this.detectFetch(),webSockets:this.detectWebSockets(),touchEvents:this.detectTouchEvents(),pointerEvents:this.detectPointerEvents(),deviceOrientation:this.detectDeviceOrientation(),canvas2d:this.detectCanvas2D(),canvasFilters:this.detectCanvasFilters(),offscreenCanvas:this.detectOffscreenCanvas()}}},{key:"detectES6",value:function(){try{return"undefined"!=typeof Symbol&&"undefined"!=typeof Promise&&"undefined"!=typeof Map&&"undefined"!=typeof Set}catch(t){return!1}}},{key:"detectES2017",value:function(){try{return"undefined"!=typeof async||function(){try{return"AsyncFunction"===Function("return async function(){}")().constructor.name}catch(t){return!1}}()}catch(t){return!1}}},{key:"detectModules",value:function(){try{return"undefined"!=typeof document&&"noModule"in document.createElement("script")}catch(t){return!1}}},{key:"detectWebGL",value:function(){try{var t=document.createElement("canvas");return!(!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}},{key:"detectWebGL2",value:function(){try{return!!document.createElement("canvas").getContext("webgl2")}catch(t){return!1}}},{key:"detectWebWorkers",value:function(){return"undefined"!=typeof Worker}},{key:"detectServiceWorkers",value:function(){return"serviceWorker"in navigator}},{key:"detectPerformanceObserver",value:function(){return"undefined"!=typeof PerformanceObserver}},{key:"detectIntersectionObserver",value:function(){return"undefined"!=typeof IntersectionObserver}},{key:"detectResizeObserver",value:function(){return"undefined"!=typeof ResizeObserver}},{key:"detectLocalStorage",value:function(){try{return"undefined"!=typeof localStorage&&null!==localStorage}catch(t){return!1}}},{key:"detectSessionStorage",value:function(){try{return"undefined"!=typeof sessionStorage&&null!==sessionStorage}catch(t){return!1}}},{key:"detectIndexedDB",value:function(){return"undefined"!=typeof indexedDB}},{key:"detectFetch",value:function(){return"undefined"!=typeof fetch}},{key:"detectWebSockets",value:function(){return"undefined"!=typeof WebSocket}},{key:"detectTouchEvents",value:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0}},{key:"detectPointerEvents",value:function(){return"undefined"!=typeof PointerEvent}},{key:"detectDeviceOrientation",value:function(){return"ondeviceorientation"in window}},{key:"detectCanvas2D",value:function(){try{return!!document.createElement("canvas").getContext("2d")}catch(t){return!1}}},{key:"detectCanvasFilters",value:function(){try{return"filter"in document.createElement("canvas").getContext("2d")}catch(t){return!1}}},{key:"detectOffscreenCanvas",value:function(){return"undefined"!=typeof OffscreenCanvas}},{key:"measurePerformance",value:function(){for(var t={},e=performance.now(),i=0;i<1e5;i++)Math.random();t.jsExecutionSpeed=performance.now()-e;try{var n=document.createElement("canvas");n.width=100,n.height=100;for(var a=n.getContext("2d"),r=performance.now(),s=0;s<1e3;s++)a.fillRect(100*Math.random(),100*Math.random(),10,10);t.canvasPerformance=performance.now()-r}catch(e){t.canvasPerformance=null}return t}},{key:"getCapabilities",value:function(){return Mi({},this.capabilities)}},{key:"getPerformance",value:function(){return Mi({},this.performance)}},{key:"generateReport",value:function(){var t=Object.entries(this.capabilities).filter(function(t){return y(t,2)[1]}).map(function(t){return y(t,1)[0]}),e=Object.entries(this.capabilities).filter(function(t){return!y(t,2)[1]}).map(function(t){return y(t,1)[0]}),i=t.length/Object.keys(this.capabilities).length*100;return{timestamp:Date.now(),userAgent:navigator.userAgent,supportedFeatures:t,unsupportedFeatures:e,supportPercentage:Math.round(i),performance:this.performance,recommendations:this.generateRecommendations(i)}}},{key:"generateRecommendations",value:function(t){var e=[];return t<50&&e.push("Consider using the minimal build for better compatibility"),this.capabilities.webGL||e.push("WebGL not supported - advanced graphics features unavailable"),this.capabilities.webWorkers||e.push("Web Workers not supported - background processing unavailable"),this.capabilities.fetch||e.push("Fetch API not supported - consider using XMLHttpRequest polyfill"),this.performance.jsExecutionSpeed>50&&e.push("Slow JavaScript execution detected - consider performance optimizations"),this.performance.canvasPerformance>100&&e.push("Slow canvas performance detected - consider reducing visual complexity"),e}}])}(),Oi=new wi({enabled:"undefined"!=typeof window&&window.location&&window.location.search.includes("debug=true"),level:ki.INFO}),ji=new Si;function Fi(t){for(var e=[],i=0;i<t;i++){var n=i/t*Math.PI*2;e.push({x:.5+.5*Math.cos(n),y:.5+.5*Math.sin(n)})}return e}function Ai(t){return Fi(t)}var xi,Bi={circle:{points:Fi(64),shadow:{type:"none"}},heart:{points:function(t){for(var e=[],i=0;i<t;i++){var n=i/t*Math.PI*2,a=16*Math.pow(Math.sin(n),3),r=-(13*Math.cos(n)-5*Math.cos(2*n)-2*Math.cos(3*n)-Math.cos(4*n));e.push({x:.5+a/32,y:.5+r/32})}return e}(64),shadow:{type:"none"}},star:{points:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,i=[],n=[],a=2*Math.PI/e,r=a/2,s=0;s<e;s++){var o=s*a-Math.PI/2;n.push({x:.5+.5*Math.cos(o),y:.5+.5*Math.sin(o)});var h=o+r;n.push({x:.5+.191*Math.cos(h),y:.5+.191*Math.sin(h)})}for(var u=0;u<t;u++){var c=u/t,l=n.length,f=c*l,v=Math.floor(f)%l,d=(v+1)%l,p=f-Math.floor(f),y=n[v],m=n[d];i.push({x:y.x+(m.x-y.x)*p,y:y.y+(m.y-y.y)*p})}return i}(64,5),shadow:{type:"none"}},sun:{points:Ai(64,12),shadow:{type:"sun",corona:!0,intensity:1.5,flares:!0,texture:!0,turbulence:.3}},moon:{points:(xi=64,Fi(xi)),shadow:{type:"crescent",coverage:.85,angle:-30,softness:.05,offset:.7}},lunar:{points:Fi(64),shadow:{type:"lunar",coverage:.7,color:"rgba(80, 20, 0, 0.8)",progression:"center"}},suspicion:{points:function(t){for(var e=[],i=0;i<t;i++){var n=i/t*Math.PI*2,a=void 0,r=void 0;if(n<Math.PI)a=.45*Math.cos(n),r=.45*Math.sin(n);else{var s=2*Math.PI-n;a=.25*Math.cos(s)-.1,r=.35*Math.sin(s)}e.push({x:.5+a,y:.5+r})}return e}(64),shadow:{type:"none"}},eclipse:{points:Fi(64),shadow:{type:"lunar",coverage:.7,color:"rgba(80, 20, 0, 0.8)"}},square:{points:function(t){for(var e=[],i=Math.floor(t/4),n=0;n<4;n++)for(var a=0;a<i;a++){var r=a/i,s=void 0,o=void 0;switch(n){case 0:s=-.5+r,o=-.5;break;case 1:s=.5,o=-.5+r;break;case 2:s=.5-r,o=.5;break;case 3:s=-.5,o=.5-r}e.push({x:.5+.8*s,y:.5+.8*o})}return e}(64),shadow:{type:"none"}},triangle:{points:function(t){var e=[],i=[{x:0,y:-.5},{x:-.433,y:.25},{x:.433,y:.25}],n=[Math.sqrt(Math.pow(i[1].x-i[0].x,2)+Math.pow(i[1].y-i[0].y,2)),Math.sqrt(Math.pow(i[2].x-i[1].x,2)+Math.pow(i[2].y-i[1].y,2)),Math.sqrt(Math.pow(i[0].x-i[2].x,2)+Math.pow(i[0].y-i[2].y,2))],a=n[0]+n[1]+n[2],r=n.map(function(e){return Math.round(t*e/a)}),s=r.reduce(function(t,e){return t+e},0);s<t&&(r[0]+=t-s);for(var o=0;o<3;o++)for(var h=i[o],u=i[(o+1)%3],c=r[o],l=0;l<c;l++)if(!(l===c-1&&o<2)){var f=l/c,v=h.x+(u.x-h.x)*f,d=h.y+(u.y-h.y)*f;e.push({x:.5+.9*v,y:.5+.9*d})}for(;e.length<t;)e.push(e[e.length-1]);for(;e.length>t;)e.pop();return e}(64),shadow:{type:"none"}},solar:{points:Ai(64,12),shadow:{type:"solar-hybrid",corona:!0,intensity:1.5,flares:!0,texture:!0,turbulence:.3,lunarOverlay:{type:"lunar",coverage:1,color:"rgba(0, 0, 0, 1.0)",progression:"center"}}}};const Ci=new(function(){return f(function t(){u(this,t),this.pools=new Map,this.inUse=new Set},[{key:"acquire",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"array",i="".concat(e,"_").concat(t);this.pools.has(i)||this.pools.set(i,[]);var n,a=this.pools.get(i);if(a.length>0){var r=a.pop();return this.inUse.add(r),r}switch(e){case"float32":n=new Float32Array(t);break;case"uint8":n=new Uint8Array(t);break;default:n=new Array(t).fill(0)}return this.inUse.add(n),n}},{key:"release",value:function(t){if(this.inUse.has(t)){this.inUse.delete(t);var e="array";t instanceof Float32Array?e="float32":t instanceof Uint8Array&&(e="uint8");var i=t.length,n="".concat(e,"_").concat(i);t.fill(0),this.pools.has(n)||this.pools.set(n,[]);var a=this.pools.get(n);a.length<10&&a.push(t)}}},{key:"clear",value:function(){this.pools.clear(),this.inUse.clear()}}])}());var Pi=function(){return f(function t(e){u(this,t),this.morpher=e,this.audioDeformation=0,this.vocalEnergy=0,this.vocalEffectActive=!1,this.beatGlitchIntensity=0,this.glitchPoints=[],this.bassEnergy=0,this.vocalPresence=0,this.highFreqEnergy=0,this.transientActive=!1,this.transientStrength=0,this.transientDecay=.92,this.transientHoldTime=8,this.transientHoldCounter=0},[{key:"applyAudioDeformation",value:function(t){var e=this;if(!t||0===t.length)return this.morpher.generateFallbackCircle();if(this.morpher.audioAnalyzer&&this.morpher.audioAnalyzer.currentFrequencies&&this.morpher.audioAnalyzer.currentFrequencies.length>0){this.morpher.frequencyData=a(this.morpher.audioAnalyzer.currentFrequencies);for(var i=0,n=0,r=0;r<=2&&r<this.morpher.frequencyData.length;r++)i+=this.morpher.frequencyData[r],n++;n>0&&(i/=n),this.morpher.bassPeakHistory||(this.morpher.bassPeakHistory=[],this.morpher.bassThumpTimer=0),this.morpher.bassPeakHistory.push(i),this.morpher.bassPeakHistory.length>20&&this.morpher.bassPeakHistory.shift();var s=this.morpher.bassPeakHistory.reduce(function(t,e){return t+e},0)/this.morpher.bassPeakHistory.length,o=(Math.max.apply(Math,a(this.morpher.bassPeakHistory)),this.morpher.audioAnalyzer&&this.morpher.audioAnalyzer.microphoneStream);if(i>1.08*s&&i>(o?.15:.25)){var h=o?8:6;this.bassEnergy=Math.min(1,(i-s)*h),this.morpher.bassThumpTimer=12}else this.morpher.bassThumpTimer>0?(this.morpher.bassThumpTimer--,this.bassEnergy*=.9):this.bassEnergy=0;this.morpher.spectralHistory||(this.morpher.spectralHistory=[],this.morpher.spectralFluxHistory=[],this.morpher.onsetThreshold=0,this.morpher.musicDetector.reset(),this.morpher.detectedBPM=0,this.morpher.onsetStrengths=[],this.morpher.detectedTimeSignature=null,this.morpher.timeSignatureConfidence=0,this.morpher.measureStartTime=0,this.morpher.timeSignatureHistory=[],this.morpher.timeSignatureLocked=!1);var u=a(this.morpher.frequencyData),c=0,l=0;if(this.morpher.spectralHistory.length>0){for(var f=this.morpher.spectralHistory[this.morpher.spectralHistory.length-1],v=0;v<=2&&v<u.length;v++){var d=u[v]-f[v];d>0&&(l+=d)}for(var p=4;p<=15&&p<u.length;p++){var y=u[p]-f[p];if(y>0)c+=y*(p>=9&&p<=13?2:1)}l>.15&&(c*=.3)}if(this.morpher.spectralHistory.push(u),this.morpher.spectralHistory.length>30&&this.morpher.spectralHistory.shift(),this.morpher.spectralFluxHistory.push(c),this.morpher.spectralFluxHistory.length>30&&this.morpher.spectralFluxHistory.shift(),this.morpher.spectralFluxHistory.length>=10){var m=a(this.morpher.spectralFluxHistory).sort(function(t,e){return t-e}),g=m[Math.floor(m.length/2)],b=m.reduce(function(t,e){return t+e},0)/m.length;this.morpher.onsetThreshold=g+.5*(b-g)}var M=c>1.2*this.morpher.onsetThreshold&&c>.02,k=c>2*this.morpher.onsetThreshold&&c>.05;if(M&&(this.transientHoldTime=8,this.morpher.vocalGlowBoost=.3),k){var w=performance.now(),S={time:w,strength:c/(this.morpher.onsetThreshold||1),bassWeight:l};this.morpher.onsetStrengths.push(S),this.morpher.onsetStrengths.length>40&&this.morpher.onsetStrengths.shift(),this.morpher.musicDetector.addOnset(w,c)}this.morpher.musicDetector.update(performance.now()),this.morpher.detectedBPM=this.morpher.musicDetector.detectedBPM,this.morpher.bpmConfidence=this.morpher.musicDetector.bpmConfidence,this.morpher.detectedBPM>0&&this.morpher.bpmConfidence>.8&&this.morpher.forceFastDetection&&(this.morpher.forceFastDetection=!1),this.transientHoldTime>0&&this.transientHoldTime--,this.morpher.vocalGlowBoost>0&&(this.morpher.vocalGlowBoost*=.92),this.vocalPresence=c;this.morpher.bassHistory[this.morpher.historyIndex]=this.bassEnergy,this.morpher.vocalHistory[this.morpher.historyIndex]=this.vocalPresence,this.morpher.historyIndex=(this.morpher.historyIndex+1)%this.morpher.bassHistory.length;this.morpher.bassHistory.reduce(function(t,e){return t+e},0),this.morpher.bassHistory.length,this.morpher.vocalHistory.reduce(function(t,e){return t+e},0),this.morpher.vocalHistory.length;this.morpher.bassEffectActive=this.morpher.bassThumpTimer>0,this.morpher.lastVocalPresence=this.morpher.lastVocalPresence||0;this.vocalPresence,this.morpher.lastVocalPresence;this.morpher.lastVocalPresence=this.vocalPresence,this.vocalEffectActive=this.transientHoldTime>0}var O=this.morpher.frequencyData&&this.morpher.frequencyData.some(function(t){return t>.01});if(this.morpher.audioAnalyzer&&O||(this.audioDeformation>.15?(this.morpher.bassEffectActive=!0,this.bassEnergy=Math.min(1,.8*this.audioDeformation),(!this.morpher.bassThumpTimer||this.morpher.bassThumpTimer<=0)&&(this.morpher.bassThumpTimer=12)):this.morpher.bassThumpTimer>0&&(this.morpher.bassThumpTimer--,this.bassEnergy*=.9),this.vocalEnergy>.2&&(this.vocalEffectActive=!0,this.vocalPresence=this.vocalEnergy)),!O&&this.audioDeformation>.15&&!this.morpher.bassEffectActive&&(this.morpher.bassEffectActive=!0,this.bassEnergy=Math.max(this.bassEnergy,.8*this.audioDeformation),(!this.morpher.bassThumpTimer||this.morpher.bassThumpTimer<=0)&&(this.morpher.bassThumpTimer=12)),!(0!==this.audioDeformation||this.bassEnergy>.01||this.vocalPresence>.01))return t;var j=[],F=.5,A=.5;Date.now();if(this.morpher.bassEffectActive&&(Math.random()<.05&&(this.morpher.undulationDirection*=-1),this.morpher.undulationPhase+=.08*this.morpher.undulationDirection),this.morpher.audioAnalyzer&&this.beatGlitchIntensity>0&&(this.beatGlitchIntensity*=.9),this.vocalEffectActive&&Math.random()<.2){this.glitchPoints=[];for(var x=2+Math.floor(2*Math.random()),B=0;B<x;B++)this.glitchPoints.push({index:Math.floor(Math.random()*t.length),intensity:.02+.03*Math.random(),decay:.94+.02*Math.random()})}this.glitchPoints=this.glitchPoints.filter(function(t){return t.intensity*=t.decay,t.intensity>.01});for(var C=function(i){var n=t[i];if(!n||void 0===n.x||void 0===n.y){var a=i/t.length*Math.PI*2;return j.push({x:.5+.5*Math.cos(a),y:.5+.5*Math.sin(a)}),1}var r=n.x-F,s=n.y-A,o=Math.sqrt(r*r+s*s),h=Math.atan2(s,r),u=.12*Math.abs(e.audioDeformation),c=0,l=0;if(e.morpher.bassEffectActive){var f=.25*e.bassEnergy;c=Math.sin(2*h+e.morpher.undulationPhase)*f,l=Math.sin(.5*e.morpher.undulationPhase)*e.bassEnergy*.08}var v=0,d=e.glitchPoints.find(function(t){return t.index===i});if(d){var p=.015*Date.now(),y=Math.sin(p+.5*i)*Math.cos(.7*p);v=d.intensity*y*.5}var m=1+u+c+l+v,g=o*Math.max(.8,m);j.push({x:F+Math.cos(h)*g,y:A+Math.sin(h)*g})},P=0;P<t.length;P++)C(P);return j}},{key:"setAudioDeformation",value:function(t){this.audioDeformation=Math.max(0,Math.min(1,t)),this.vocalEffectActive=t>.01}},{key:"setVocalEnergy",value:function(t){this.vocalEnergy=Math.max(0,Math.min(1,t)),this.vocalEffectActive=t>.01}},{key:"updateFrequencyBands",value:function(t){t&&(this.bassEnergy=t.bass||0,this.vocalPresence=t.vocal||0,this.highFreqEnergy=t.high||0)}},{key:"processTransient",value:function(t,e){t>e?(this.transientActive=!0,this.transientStrength=t,this.transientHoldCounter=this.transientHoldTime):this.transientHoldCounter>0?this.transientHoldCounter--:(this.transientStrength*=this.transientDecay,this.transientStrength<.01&&(this.transientActive=!1))}},{key:"getState",value:function(){return{audioDeformation:this.audioDeformation,vocalEnergy:this.vocalEnergy,vocalEffectActive:this.vocalEffectActive,beatGlitchIntensity:this.beatGlitchIntensity,transientActive:this.transientActive,transientStrength:this.transientStrength}}},{key:"reset",value:function(){this.audioDeformation=0,this.vocalEnergy=0,this.vocalEffectActive=!1,this.beatGlitchIntensity=0,this.glitchPoints=[],this.transientActive=!1,this.transientStrength=0}}])}();var Ei=function(){return f(function t(){u(this,t),this.agents=[],this.maxAgents=8,this.isActive=!1,this.confidence=0,this.lockedBPM=0,this.lastBeatTime=0,this.peakHistory=[],this.maxHistoryLength=100,this.minBPM=40,this.maxBPM=300,this.convergenceThreshold=.7,this.subdivisionPreference={slow:{min:40,max:80,prefer:1},normal:{min:80,max:140,prefer:1},fast:{min:140,max:180,prefer:.5},veryfast:{min:180,max:300,prefer:.5}}},[{key:"createAgent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{bpm:t,subdivision:e,effectiveBPM:t*e,phase:0,confidence:.5,hits:0,misses:0,lastBeatTime:performance.now(),beatInterval:6e4/(t*e)}}},{key:"initializeAgents",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:120;this.agents=[];(e>180||e>140?[.5,.75,1]:e<60?[1,1.5,2]:[.5,1,1.5]).forEach(function(i){var n=t.createAgent(e,i);e*i<140&&(n.confidence=.6),t.agents.push(n)}),e>140&&(this.agents.push(this.createAgent(e/2,1)),this.agents.push(this.createAgent(e/2,1.5)))}},{key:"processPeak",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:performance.now();if(this.peakHistory.push({strength:t,time:i}),this.peakHistory.length>this.maxHistoryLength&&this.peakHistory.shift(),!(this.peakHistory.length<4)){if(!this.isActive||0===this.agents.length){var n=this.getFFTEstimate();this.initializeAgents(n),this.isActive=!0}this.lockedBPM>0&&this.confidence>.7?(this.agents.forEach(function(n){e.scoreAgent(n,i,t)}),this.confidence<.6&&(this.evolveAgents(),this.checkConvergence())):(this.agents.forEach(function(n){e.scoreAgent(n,i,t)}),this.evolveAgents(),this.checkConvergence())}}},{key:"scoreAgent",value:function(t,e,i){var n=e-t.lastBeatTime,a=t.beatInterval,r=1-2*Math.abs(n%a/a-.5);r>.7?(t.hits++,t.confidence=Math.min(1,t.confidence+.1),r>.85&&(t.lastBeatTime=e)):r<.3&&(t.misses++,t.confidence=Math.max(0,t.confidence-.03)),t.confidence*=.998}},{key:"evolveAgents",value:function(){this.agents.sort(function(t,e){return e.confidence-t.confidence}),this.agents.length>this.maxAgents&&(this.agents=this.agents.slice(0,this.maxAgents));var t=this.agents[0];if(t.confidence>.7&&this.agents.length<this.maxAgents){var e=1+.02*(Math.random()-.5),i=this.createAgent(t.bpm*e,t.subdivision);i.confidence=.8*t.confidence,this.agents.push(i)}this.agents=this.agents.filter(function(t){return t.confidence>.1})}},{key:"checkConvergence",value:function(){if(0!==this.agents.length){var t=this.agents[0];if(t.confidence>this.convergenceThreshold)if(this.agents.filter(function(e){return Math.abs(e.effectiveBPM-t.effectiveBPM)/t.effectiveBPM<.05}).length>=Math.min(2,.3*this.agents.length))return this.lockedBPM=Math.round(t.bpm),this.confidence=t.confidence,this.autoSelectSubdivision(),!0;return!1}}},{key:"autoSelectSubdivision",value:function(){for(var t,e=this,i=function(){var t=y(a[n],2),i=(t[0],t[1]);if(e.lockedBPM>=i.min&&e.lockedBPM<i.max&&e.agents.find(function(t){return Math.abs(t.bpm-e.lockedBPM)<2&&Math.abs(t.subdivision-i.prefer)<.1}))return{v:i.prefer}},n=0,a=Object.entries(this.subdivisionPreference);n<a.length;n++)if(t=i())return t.v;return 1}},{key:"getFFTEstimate",value:function(){if(this.peakHistory.length<4)return 120;for(var t=this.peakHistory.slice(-10),e=[],i=1;i<t.length;i++)e.push(t[i].time-t[i-1].time);if(0===e.length)return 120;e.sort(function(t,e){return t-e});var n=6e4/e[Math.floor(e.length/2)];return n<this.minBPM?n*=2:n>this.maxBPM&&(n/=2),Math.max(this.minBPM,Math.min(this.maxBPM,n))}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.agents=[],this.confidence=0,this.lockedBPM=0,this.peakHistory=[],t&&this.initializeAgents(t)}},{key:"getBPM",value:function(){return this.lockedBPM>0&&this.confidence>.8?this.lockedBPM:this.agents.length>0?Math.round(this.agents[0].bpm):0}},{key:"getSubdivision",value:function(){if(this.agents.length>0){for(var t=this.agents[0],e=t.bpm,i=0,n=Object.entries(this.subdivisionPreference);i<n.length;i++){var a=y(n[i],2),r=(a[0],a[1]);if(e>=r.min&&e<r.max)return r.prefer}return t.subdivision}return 1}},{key:"getStatus",value:function(){return{bpm:this.getBPM(),subdivision:this.getSubdivision(),confidence:this.confidence,locked:this.lockedBPM>0&&this.confidence>.8,agentCount:this.agents.length,topAgents:this.agents.slice(0,3).map(function(t){return{bpm:Math.round(t.bpm),subdivision:t.subdivision,confidence:t.confidence.toFixed(2)}})}}}])}();function Ti(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Ri(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ri(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function Ri(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}var Ii=function(){return f(function t(){u(this,t),this.onsetIntervals=[],this.onsetStrengths=[],this.lastOnsetTime=0,this.onsetThreshold=.3,this.detectedBPM=0,this.bpmConfidence=0,this.lastBPMCalculation=0,this.bpmCalculationInterval=2e3,this.bpmHistory=[],this.tempoLocked=!1,this.fundamentalBPM=0,this.agentDetector=new Ei,this.useAgentDetection=!0,this.timeSignature="4/4",this.detectedTimeSignature=null,this.timeSignatureConfidence=0,this.timeSignatureHistory=[],this.timeSignatureLocked=!1,this.downbeatPhase=0,this.measureLength=4,this.measureStartTime=0,this.isMusicalContent=!1,this.musicalityScore=0,this.forceFastDetection=!1},[{key:"calculateBPM",value:function(){if(this.useAgentDetection){var t=this.agentDetector.getStatus();if(t.locked&&t.confidence>.6)return this.detectedBPM=t.bpm,this.bpmConfidence=t.confidence,this.tempoLocked=!0,this.fundamentalBPM=t.bpm,this.bpmHistory.push(this.detectedBPM),this.bpmHistory.length>10&&this.bpmHistory.shift(),this.detectedBPM;if(t.bpm>0&&t.confidence>.4)return this.detectedBPM=t.bpm,this.bpmConfidence=t.confidence,t.confidence>.6&&(this.tempoLocked=!0),this.detectedBPM}if(this.onsetIntervals.length<4)return this.detectedBPM;var e=this.onsetIntervals.slice(-15),i=this.findTempoCandidates(e);if(0===i.length)return this.detectedBPM;var n=i[0],a=Math.round(6e4/n.interval);if(!this.tempoLocked&&this.bpmHistory.length>3){var r=this.bpmHistory.slice(-3),s=r.reduce(function(t,e){return t+e},0)/r.length;r.reduce(function(t,e){return t+Math.pow(e-s,2)},0)/r.length<5&&(this.fundamentalBPM=Math.round(s),this.tempoLocked=!0,this.bpmConfidence=1)}var o=a;this.tempoLocked&&(this.checkHarmonicRelation(a,this.fundamentalBPM)?(o=this.fundamentalBPM,this.bpmConfidence=Math.min(1,this.bpmConfidence+.1)):(this.bpmConfidence*=.9,this.bpmConfidence<.3&&n.strength>.8?(this.fundamentalBPM=a,this.bpmConfidence=.5):o=this.fundamentalBPM));if(this.bpmHistory.push(o),this.bpmHistory.length>10&&this.bpmHistory.shift(),0===this.detectedBPM)this.detectedBPM=o;else{var h=this.tempoLocked?1:2,u=o-this.detectedBPM;Math.abs(u)<=h?this.detectedBPM=o:this.detectedBPM+=Math.sign(u)*h}return window.rhythmIntegration&&window.rhythmIntegration.updateBPM&&(window.rhythmManuallyStoppedForCurrentAudio||window.rhythmIntegration.updateBPM(this.detectedBPM)),this.detectedBPM}},{key:"findTempoCandidates",value:function(t){for(var e=this,i=[],n=function(){var n,s=r[a],o=t.map(function(t){return t*s}),h=Ti(e.clusterIntervals(o));try{for(h.s();!(n=h.n()).done;){var u=n.value,c=u.intervals.reduce(function(t,e){return t+e},0)/u.intervals.length/s,l=u.intervals.length/t.length*u.consistency,f=6e4/c,v=f>=120&&f<=140?.2:0;f>=60&&f<=220&&i.push({interval:c,strength:l+v,multiplier:s})}}catch(t){h.e(t)}finally{h.f()}},a=0,r=[1,2,4];a<r.length;a++)n();return i.sort(function(t,e){return e.strength-t.strength})}},{key:"clusterIntervals",value:function(t){for(var e=a(t).sort(function(t,e){return t-e}),i=[],n=[e[0]],r=function(){var t=.03*n[0];if(e[s]-n[0]<=t)n.push(e[s]);else{if(n.length>=2){var a=n.reduce(function(t,e){return t+e},0)/n.length,r=1/(1+n.reduce(function(t,e){return t+Math.pow(e-a,2)},0)/n.length/(a*a));i.push({intervals:n,consistency:r})}n=[e[s]]}},s=1;s<e.length;s++)r();if(n.length>=3){var o=n.reduce(function(t,e){return t+e},0)/n.length,h=1/(1+n.reduce(function(t,e){return t+Math.pow(e-o,2)},0)/n.length/(o*o));i.push({intervals:n,consistency:h})}return i}},{key:"checkHarmonicRelation",value:function(t,e){var i=Math.max(t,e)/Math.min(t,e);return[2,1.5,1.333,1.25].some(function(t){return Math.abs(i-t)<.03})}},{key:"detectTimeSignature",value:function(){var t=this.forceFastDetection?6:12;if(0===this.detectedBPM||this.onsetStrengths.length<t)return this.timeSignature;if(this.timeSignatureLocked&&!this.forceFastDetection)return this.detectedTimeSignature||this.timeSignature;var e=6e4/this.detectedBPM,i=new Array(4).fill(0).map(function(){return{strength:0,bassWeight:0,count:0}}),n=this.onsetStrengths.slice(-Math.min(20,this.onsetStrengths.length));if(0===n.length)return this.timeSignature;var a,r=n[0].time,s=Ti(n);try{for(s.s();!(a=s.n()).done;){var o=a.value,h=(o.time-r)/e%4,u=Math.round(h)%4;i[u].strength+=o.strength,i[u].bassWeight+=o.bassWeight||0,i[u].count++}}catch(t){s.e(t)}finally{s.f()}var c,l=0,f=Ti(i);try{for(f.s();!(c=f.n()).done;){var v=c.value;v.count>0&&(v.strength/=v.count,v.bassWeight/=v.count,l=Math.max(l,v.strength+v.bassWeight))}}catch(t){f.e(t)}finally{f.f()}var d="4/4";i[0].strength>2*i[1].strength&&i[0].strength>2*i[2].strength&&i[3].count<.5*i[0].count&&(this.testWaltzPattern(n,e)>.8&&(d="3/4"));this.timeSignatureHistory.push(d),this.timeSignatureHistory.length>3&&this.timeSignatureHistory.shift();var p=this.forceFastDetection?2:3;if(this.timeSignatureHistory.length>=p){var m,g={},b=Ti(this.timeSignatureHistory);try{for(b.s();!(m=b.n()).done;){var M=m.value;g[M]=(g[M]||0)+1}}catch(t){b.e(t)}finally{b.f()}for(var k="4/4",w=0,S=0,O=Object.entries(g);S<O.length;S++){var j=y(O[S],2),F=j[0],A=j[1];A>w&&(w=A,k=F)}if(w>=2){this.detectedTimeSignature=k,this.timeSignatureLocked=!0,this.timeSignatureConfidence=w/3,window.rhythmIntegration&&window.rhythmIntegration.setTimeSignature&&window.rhythmIntegration.setTimeSignature(this.detectedTimeSignature);var x=document.getElementById("time-sig-display");x&&(x.textContent=this.detectedTimeSignature)}}return this.detectedTimeSignature||this.timeSignature}},{key:"testWaltzPattern",value:function(t,e){for(var i=0,n=0,a=0;a<t.length-2;a+=3)if(a+2<t.length){n++;var r=t[a].strength+(t[a].bassWeight||0),s=t[a+1].strength+(t[a+1].bassWeight||0),o=t[a+2].strength+(t[a+2].bassWeight||0);r>1.5*s&&r>1.5*o&&i++}return n>0?i/n:0}},{key:"addOnset",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.useAgentDetection&&this.agentDetector.processPeak(e,t),this.lastOnsetTime>0){var n=t-this.lastOnsetTime;n>273&&n<1e3&&(this.onsetIntervals.push(n),this.onsetIntervals.length>20&&this.onsetIntervals.shift())}this.onsetStrengths.push({time:t,strength:e,bassWeight:i}),this.onsetStrengths.length>40&&this.onsetStrengths.shift(),this.lastOnsetTime=t}},{key:"update",value:function(t){t-this.lastBPMCalculation>this.bpmCalculationInterval&&(this.calculateBPM(),this.detectTimeSignature(),this.lastBPMCalculation=t)}},{key:"getRecommendedSubdivision",value:function(){return this.useAgentDetection?this.agentDetector.getSubdivision():this.detectedBPM<60?2:this.detectedBPM<80?1:this.detectedBPM>180||this.detectedBPM>140?.5:1}},{key:"reset",value:function(){this.onsetIntervals=[],this.onsetStrengths=[],this.lastOnsetTime=0,this.detectedBPM=0,this.bpmConfidence=0,this.bpmHistory=[],this.tempoLocked=!1,this.fundamentalBPM=0,this.timeSignature="4/4",this.detectedTimeSignature=null,this.timeSignatureConfidence=0,this.timeSignatureHistory=[],this.agentDetector&&this.agentDetector.reset(),this.timeSignatureLocked=!1,this.isMusicalContent=!1,this.forceFastDetection=!1}},{key:"getMusicInfo",value:function(){return{bpm:this.detectedBPM,confidence:this.bpmConfidence,timeSignature:this.timeSignature,isMusical:this.isMusicalContent,musicalityScore:this.musicalityScore}}}])}();var zi=function(){return f(function t(e){u(this,t),this.morpher=e,this.isTransitioning=!1,this.transitionStartTime=0,this.transitionDuration=800,this.transitionProgress=0,this.easingFunction="easeInOutQuad",this.currentShape="circle",this.targetShape=null,this.previousShape=null,this.morphQueue=[],this.maxQueueSize=3,this.shadowConfig=null,this.shadowProgress=0},[{key:"startTransition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isTransitioning&&this.morphQueue.length<this.maxQueueSize?this.morphQueue.push({shape:t,options:e}):(this.previousShape=this.currentShape,this.targetShape=t,this.isTransitioning=!0,this.transitionStartTime=performance.now(),this.transitionDuration=e.duration||800,this.easingFunction=e.easing||"easeInOutQuad",this.transitionProgress=0,this.shadowConfig=this.getTransitionConfig(this.currentShape,t))}},{key:"update",value:function(t){if(this.isTransitioning){var e=performance.now()-this.transitionStartTime,i=Math.min(1,e/this.transitionDuration);this.transitionProgress=this.applyEasing(i),this.shadowConfig&&(this.shadowProgress=this.calculateShadowProgress(i)),i>=1&&this.completeTransition()}}},{key:"completeTransition",value:function(){if(this.currentShape=this.targetShape,this.targetShape=null,this.isTransitioning=!1,this.transitionProgress=0,this.shadowConfig=null,this.morphQueue.length>0){var t=this.morphQueue.shift();this.startTransition(t.shape,t.options)}}},{key:"getTransitionConfig",value:function(t,e){return{"circle-heart":{type:"bloom",shadowColor:"#ff69b4",shadowIntensity:.3},"heart-circle":{type:"contract",shadowColor:"#ff69b4",shadowIntensity:.2},"circle-star":{type:"burst",shadowColor:"#ffd700",shadowIntensity:.4},"star-circle":{type:"collapse",shadowColor:"#ffd700",shadowIntensity:.3}}["".concat(t,"-").concat(e)]||null}},{key:"calculateShadowProgress",value:function(t){if(!this.shadowConfig)return 0;switch(this.shadowConfig.type){case"bloom":return t<.5?2*t:2-2*t;case"burst":return Math.pow(1-t,2);case"contract":case"collapse":return Math.sin(t*Math.PI);default:return 0}}},{key:"applyEasing",value:function(t){switch(this.easingFunction){case"linear":default:return t;case"easeInQuad":return t*t;case"easeOutQuad":return t*(2-t);case"easeInOutQuad":return t<.5?2*t*t:(4-2*t)*t-1;case"easeInCubic":return t*t*t;case"easeOutCubic":return--t*t*t+1;case"easeInOutCubic":return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}}},{key:"clearQueue",value:function(){this.morphQueue=[]}},{key:"hasQueuedMorphs",value:function(){return this.morphQueue.length>0}},{key:"getState",value:function(){return{isTransitioning:this.isTransitioning,currentShape:this.currentShape,targetShape:this.targetShape,progress:this.transitionProgress,queueLength:this.morphQueue.length}}},{key:"reset",value:function(){this.isTransitioning=!1,this.currentShape="circle",this.targetShape=null,this.transitionProgress=0,this.morphQueue=[],this.shadowConfig=null}}])}();function Di(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function qi(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Di(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Di(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const _i=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.numPoints=e.numPoints||64,this.morphDuration=e.morphDuration||1e3,this.easing=e.easing||"easeInOutCubic",this.transitionManager=new zi(this),this.audioDeformer=new Pi(this),this.musicDetector=new Ii,this.currentShape="circle",this.targetShape=null,this.morphProgress=0,this.visualProgress=0,this.morphStartTime=null,this.isTransitioning=!1,this.shapeCache=new Map,this.currentPoints=[],this.targetPoints=[],this.musicalDuration=null,this.onBeat=!1,this.audioDeformation=0,this.vocalEnergy=0,this.lastAudioUpdate=0,this.lastVocalUpdate=0,this.audioUpdateInterval=33,this.audioAnalyzer=null,this.frequencyData=Ci.acquire(32,"float32"),this.glitchPoints=[],this.undulationPhase=0,this.undulationDirection=1,this.beatGlitchIntensity=0,this.bassEnergy=0,this.vocalPresence=0,this.bassHistory=Ci.acquire(60,"float32"),this.vocalHistory=Ci.acquire(60,"float32"),this.historyIndex=0,this.bassEffectCooldown=0,this.vocalEffectCooldown=0,this.bassThresholdMultiplier=1.2,this.vocalThresholdMultiplier=1.1,this.bassEffectActive=!1,this.vocalEffectActive=!1,this.transientHoldTime=0,this.vocalGlowBoost=0,this.onComplete=null,this.onProgress=null,this.queuedMorph=null,this.currentPoints=this.getShapePoints("circle"),this.shapesLoaded=!0,this.prewarmCache()},[{key:"prewarmCache",value:function(){var t=this;["circle","heart","star","sun","moon","lunar","square","triangle"].forEach(function(e){Bi[e]&&t.getShapePoints(e)});[0,.25,.5,.75,1].forEach(function(e){t.applyEasing(e)})}},{key:"getShapePoints",value:function(t){if(!this.shapeCache.has(t)){var e=Bi[t];if(!e||!e.points){var i=Bi.circle.points;return this.shapeCache.set(t,i),i}var n=e.points;return this.shapeCache.set(t,n),n}return this.shapeCache.get(t)}},{key:"morphTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shapesLoaded&&(t!==this.currentShape||this.isTransitioning)){if(this.isTransitioning&&!e.force)return this.queuedMorph={targetShape:t,options:e},"queued";this.isTransitioning&&e.force&&this.completeMorph(!0);var i=this.getTransitionConfig(this.currentShape,t);if(this.targetShape=t,this.targetPoints=this.getShapePoints(t),this.morphStartTime=Date.now(),this.isTransitioning=!0,this.morphProgress=0,this.visualProgress=0,"bar"===e.duration||"beat"===e.duration){var n=6e4/(qt.bpm||120);"bar"===e.duration?this.morphDuration=4*n:this.morphDuration=n,this.musicalDuration=!0,this.onBeat=!1!==e.onBeat}else this.morphDuration=(null==i?void 0:i.duration)||e.duration||1e3,this.musicalDuration=null,this.onBeat=!1;this.morphMode=e.mode||"smooth",this.transitionConfig=i,this.onComplete=e.onComplete,this.onProgress=e.onProgress}}},{key:"update",value:function(t){if(this.audioAnalyzer&&this.audioAnalyzer.isAnalyzing){var e=this.audioAnalyzer.getShapeMorpherData();if(e&&e.frequencies){for(var i=!1,n=0;n<Math.min(e.frequencies.length,this.frequencyData.length);n++)this.frequencyData[n]=e.frequencies[n],e.frequencies[n]>0&&(i=!0);i&&!this.G&&(this.G=!0)}}if(this.isTransitioning&&this.targetShape){var a=Date.now()-this.morphStartTime;if(this.musicalDuration){var r=6e4/(qt.bpm||120),s=this.morphDuration>2*r;this.morphDuration=s?4*r:r}var o=Math.min(a/this.morphDuration,1);if(this.musicalDuration&&this.onBeat){var h,u=qt.bpm||120;h=u>140?2:u>100?4:8;var c=6e4/u,l=this.morphDuration/c,f=o*l,v=Math.round(f*h)/h,d=Math.min(1,v/l),p=(.3+.5*(u<90?Math.max(.3,(u-60)/30):Math.max(.4,Math.min(1,1-(u-90)/90))))*(.3+.7*Math.sin(o*Math.PI));o+=(d-o)*(p*p*(3-2*p))}this.morphProgress=this.applyEasing(o),this.visualProgress=.8*this.visualProgress+.2*this.morphProgress,Math.abs(this.visualProgress-this.morphProgress)<.001&&(this.visualProgress=this.morphProgress),this.onProgress&&this.onProgress(this.morphProgress),this.morphProgress>=1&&(this.visualProgress=1,this.completeMorph())}}},{key:"completeMorph",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.targetShape&&(this.currentShape=this.targetShape,this.currentPoints=a(this.targetPoints)),this.targetShape=null,this.isTransitioning=!1,this.morphProgress=0,this.visualProgress=0,this.onComplete&&this.onComplete(this.currentShape),!e&&this.queuedMorph){var i=this.queuedMorph;this.queuedMorph=null,setTimeout(function(){t.morphTo(i.targetShape,i.options)},50)}}},{key:"hasQueuedMorph",value:function(){return null!==this.queuedMorph}},{key:"clearQueue",value:function(){this.queuedMorph=null}},{key:"getCanvasPoints",value:function(t,e,i){var n;try{n=this.getInterpolatedPoints()}catch(t){n=this.generateFallbackCircle()}this.canvasPointsCache||(this.canvasPointsCache=[]);var a=this.canvasPointsCache;if(a.length=0,!n||0===n.length){for(var r=0;r<this.numPoints;r++){var s=r/this.numPoints*Math.PI*2;a.push({x:t+Math.cos(s)*i,y:e+Math.sin(s)*i})}return a}for(var o=Array.isArray(n)?n:[],h=0;h<o.length;h++){var u=o[h];if(u&&"number"==typeof u.x&&"number"==typeof u.y){var c=t+(u.x-.5)*i*2,l=e+(u.y-.5)*i*2;a.push({x:c,y:l})}else{var f=h/o.length*Math.PI*2;a.push({x:t+Math.cos(f)*i,y:e+Math.sin(f)*i})}}for(;a.length<this.numPoints;){var v=a.length/this.numPoints*Math.PI*2;a.push({x:t+Math.cos(v)*i,y:e+Math.sin(v)*i})}return a}},{key:"getInterpolatedPoints",value:function(){if(this.currentPoints&&0!==this.currentPoints.length||(this.currentPoints=this.generateFallbackCircle()),!this.isTransitioning)return this.applyAudioDeformation(this.currentPoints);for(var t=[],e=0;e<this.numPoints;e++){var i=this.currentPoints[e],n=this.targetPoints[e];if(i&&n){var a=this.visualProgress,r=void 0,s=void 0,o=["square","circle","star","triangle"],h=o.includes(this.currentShape),u=o.includes(this.targetShape);if(h||u){var c=.5,l=.5;if(u&&!h){var f=n.x-c,v=n.y-l;this.applyEasing(a);if(a<.3){var d=a/.3;r=i.x+(c-i.x)*d,s=i.y+(l-i.y)*d}else{var p=(a-.3)/.7;r=c+f*p,s=l+v*p}}else if(h&&!u){var y=i.x-c,m=i.y-l;if(a<.5){var g=a/.5;r=i.x-y*g,s=i.y-m*g}else{var b=(a-.5)/.5;r=c+(n.x-c)*b,s=l+(n.y-l)*b}}else{var M=i.x-c,k=i.y-l,w=n.x-c,S=n.y-l;if(a<.5){var O=a/.5;r=i.x-M*O,s=i.y-k*O}else{var j=(a-.5)/.5;r=c+w*j,s=l+S*j}}}else if("spiral"===this.morphMode){var F=a*Math.PI*2,A=.02*Math.sin(F+.2*e)*(1-2*Math.abs(a-.5));r=i.x+(n.x-i.x)*a+A,s=i.y+(n.y-i.y)*a+A}else if("wave"===this.morphMode){var x=.01*Math.sin(.3*e+a*Math.PI*4);r=i.x+(n.x-i.x)*a+x,s=i.y+(n.y-i.y)*a+x}else r=i.x+(n.x-i.x)*a,s=i.y+(n.y-i.y)*a;t.push({x:r,y:s})}else{var B=e/this.numPoints*Math.PI*2;t.push({x:.5+.5*Math.cos(B),y:.5+.5*Math.sin(B)})}}return this.applyAudioDeformation(t)}},{key:"applyAudioDeformation",value:function(t){return this.audioDeformer.applyAudioDeformation(t)}},{key:"setAudioDeformation",value:function(t){var e=Date.now();e-this.lastAudioUpdate>this.audioUpdateInterval&&(this.audioDeformation=Math.max(-1,Math.min(1,t)),this.lastAudioUpdate=e,this.audioDeformer&&this.audioDeformer.setAudioDeformation(Math.abs(this.audioDeformation)))}},{key:"setVocalEnergy",value:function(t){var e=Date.now();e-this.lastVocalUpdate>this.audioUpdateInterval&&(this.vocalEnergy=Math.max(0,Math.min(1,t)),this.lastVocalUpdate=e,this.audioDeformer&&this.audioDeformer.setVocalEnergy(this.vocalEnergy))}},{key:"getTransitionConfig",value:function(t,e){var i,n,a,r,s=Bi[t],o=Bi[e];return"moon"===e?{type:"to_moon",easing:"easeInOutCubic",duration:1500,glowIntensity:1.5,fadeInCrescent:!0}:"moon"===t&&"lunar"===e?{type:"moon_to_lunar",easing:"easeInOutSine",duration:2e3,slideOutCrescent:!1,description:"Crescent shadow moves to center and becomes lunar eclipse"}:"moon"===t?{type:"from_moon",easing:"easeInOutCubic",duration:1e3,slideOutCrescent:!0,shadowSlideRatio:.4,description:"Moon shadow slides away THEN morphs to target"}:"lunar"===e?{type:"eclipse_enter_lunar",startAngle:-30}:"lunar"===t&&"moon"===e?{type:"lunar_to_moon",exitAngle:-30}:"lunar"===t?{type:"eclipse_exit_lunar",exitAngle:-30}:"none"===(null==s||null===(i=s.shadow)||void 0===i?void 0:i.type)&&"solar"===(null==o||null===(n=o.shadow)||void 0===n?void 0:n.type)?{type:"eclipse_enter",direction:"right"}:"solar"===(null==s||null===(a=s.shadow)||void 0===a?void 0:a.type)&&"none"===(null==o||null===(r=o.shadow)||void 0===r?void 0:r.type)?{type:"eclipse_exit",direction:"left"}:"sun"===t&&"sun"!==e?{type:"sun_fade",fadeEffects:!0}:"sun"!==t&&"sun"===e?{type:"sun_bloom",bloomEffects:!0}:{type:"standard"}}},{key:"getCurrentShadow",value:function(){var t=this.currentShape||"circle",e=Bi[t],i=this.targetShape?Bi[this.targetShape]:null,n=(null==e?void 0:e.shadow)||{type:"none"},a=(null==i?void 0:i.shadow)||null;if(!this.isTransitioning||!a)return n;var r=this.morphProgress;if(this.transitionConfig&&"from_moon"===this.transitionConfig.type&&this.transitionConfig.slideOutCrescent){var s=this.transitionConfig.shadowSlideRatio||.4;if(r<s){var o=r/s,h=-30*Math.PI/180,u=.7+1.8*o;return{type:"crescent",coverage:o>.8?.85*(1-5*(o-.8)):.85,angle:-30,offset:u,shadowX:Math.cos(h)*u,shadowY:Math.sin(h)*u}}return{type:"none"}}if(this.transitionConfig&&"moon_to_lunar"===this.transitionConfig.type){var c=this.transitionConfig.startAngle*Math.PI/180,l=1-r,f=.7*Math.cos(c)*l,v=.7*Math.sin(c)*l,d=Math.pow(r,2);if(r<.6)return{type:"crescent",coverage:.85*(1-.2*d),angle:this.transitionConfig.startAngle,offset:.7*l,shadowX:f,shadowY:v};var p=(r-.6)/.4,y=Math.sin(p*Math.PI/2);return{type:"lunar",coverage:.85+.1*y,color:"rgba(80, 20, 0, ".concat(.7+.2*y,")"),shadowX:f*(1-y),shadowY:v*(1-y),diffusion:y,shadowProgress:r}}if(this.transitionConfig&&"eclipse_enter_lunar"===this.transitionConfig.type){if(r<.3)return{type:"none"};var m=(r-.3)/.7,g=Math.sin(m*Math.PI/2),b=this.transitionConfig.startAngle*Math.PI/180,M=1-g,k=.7*Math.cos(b)*M,w=.7*Math.sin(b)*M;if(m<.7)return{type:"crescent",coverage:.85*Math.pow(m/.7,.5),angle:this.transitionConfig.startAngle,offset:.7*M,shadowX:k,shadowY:w};var S=(m-.7)/.3,O=Math.sin(S*Math.PI/2);return{type:"lunar",coverage:.85+.1*O,color:"rgba(80, 20, 0, ".concat(.6+.3*O,")"),shadowX:k*(1-O),shadowY:w*(1-O),diffusion:O,shadowProgress:m}}if(this.transitionConfig&&"lunar_to_moon"===this.transitionConfig.type){var j=this.transitionConfig.exitAngle*Math.PI/180,F=Math.sin(r*Math.PI/2),A=.7*Math.cos(j)*F,x=.7*Math.sin(j)*F;if(r<.6){var B=r/.6,C=Math.pow(B,.7);return{type:"lunar",coverage:.95-.1*C,color:"rgba(80, 20, 0, ".concat(.9-.3*C,")"),shadowX:.7*A,shadowY:.7*x,diffusion:1-C}}var P=(r-.6)/.4;return{type:"crescent",coverage:.85*Math.sin(P*Math.PI/2)+.1,angle:this.transitionConfig.exitAngle,offset:.7,shadowX:A,shadowY:x}}if(this.transitionConfig&&"eclipse_exit_lunar"===this.transitionConfig.type){if(r<.7){var E=r/.7,T=(Math.sin(E*Math.PI/2),this.transitionConfig.exitAngle*Math.PI/180);if(E<.4){var R=E/.4,I=1-R,z=.3*R;return{type:"lunar",coverage:.95-.1*R,color:"rgba(80, 20, 0, ".concat(.9-.2*R,")"),shadowX:.7*Math.cos(T)*z,shadowY:.7*Math.sin(T)*z,diffusion:I}}var D=(E-.4)/.6,q=Math.pow(D,.8),_=.7*Math.cos(T)*q,G=.7*Math.sin(T)*q;return{type:"crescent",coverage:.85*(1-Math.pow(D,2)),angle:this.transitionConfig.exitAngle,offset:.7*q,shadowX:_,shadowY:G}}return{type:"none"}}if(this.transitionConfig&&"eclipse_enter"===this.transitionConfig.type){var L=1.5-1.5*r;return qi(qi({},a),{},{shadowX:L,shadowProgress:r})}if("eclipse_exit"===this.transitionConfig.type){var V=1.5*-r;return qi(qi({},n),{},{coverage:n.coverage*(1-r),shadowX:V,shadowProgress:1-r})}if("sun_fade"===this.transitionConfig.type){var H=1-r;return qi(qi({},n),{},{intensity:(n.intensity||1)*Math.pow(H,.7),corona:n.corona,coronaOpacity:H,flares:n.flares,flaresOpacity:Math.pow(H,1.5),texture:n.texture,textureOpacity:Math.pow(H,2),turbulence:(n.turbulence||.3)*H})}if("sun_bloom"===this.transitionConfig.type){var X=r;return qi(qi({},a),{},{intensity:(a.intensity||1)*Math.pow(X,1.5),corona:a.corona,coronaOpacity:Math.pow(X,.8),flares:a.flares,flaresOpacity:X>.3?Math.pow((X-.3)/.7,.7):0,texture:a.texture,textureOpacity:X>.5?Math.pow((X-.5)/.5,2):0,turbulence:(a.turbulence||.3)*X})}if("none"!==n.type||"none"!==a.type){var Y=(n.coverage||0)+((a.coverage||0)-(n.coverage||0))*r;return{type:"none"!==a.type?a.type:n.type,coverage:Y,angle:a.angle||n.angle||0,softness:a.softness||n.softness||.2,progress:r}}return n}},{key:"getCurrentRenderer",value:function(){return null}},{key:"applyEasing",value:function(t){var e;switch((null===(e=this.transitionConfig)||void 0===e?void 0:e.easing)||this.easing||"linear"){case"linear":return t;case"easeInQuad":return t*t;case"easeOutQuad":return t*(2-t);case"easeInOutQuad":return t<.5?2*t*t:(4-2*t)*t-1;case"easeInOutSine":return-(Math.cos(Math.PI*t)-1)/2;default:return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}}},{key:"calculateBPM",value:function(){return this.musicDetector.calculateBPM()}},{key:"findTempoCandidates",value:function(t){return this.musicDetector.findTempoCandidates(t)}},{key:"clusterIntervals",value:function(t){return this.musicDetector.clusterIntervals(t)}},{key:"checkHarmonicRelation",value:function(t,e){return this.musicDetector.checkHarmonicRelation(t,e)}},{key:"detectTimeSignature",value:function(){this.musicDetector.forceFastDetection=this.forceFastDetection;var t=this.musicDetector.detectTimeSignature();return this.detectedTimeSignature=this.musicDetector.detectedTimeSignature,this.timeSignatureConfidence=this.musicDetector.timeSignatureConfidence,this.timeSignatureLocked=this.musicDetector.timeSignatureLocked,t}},{key:"testWaltzPattern",value:function(t,e){return this.musicDetector.testWaltzPattern(t,e)}},{key:"resetMusicDetection",value:function(){this.forceFastDetection=!0,this.musicDetector.reset(),this.musicDetector.forceFastDetection=!0,this.onsetThreshold=0,this.detectedBPM=0,this.bpmConfidence=0,this.onsetStrengths=[],this.detectedTimeSignature=null,this.timeSignatureConfidence=0,this.musicDetector.lastBPMCalculation=0,this.measureStartTime=0,this.timeSignatureHistory=[],this.timeSignatureLocked=!1,this.spectralHistory=[],this.spectralFluxHistory=[];var t=document.getElementById("time-sig-display");t&&(t.textContent="—")}},{key:"getCurrentMusicInfo",value:function(){return{bpm:this.detectedBPM,timeSignature:this.detectedTimeSignature,bpmLocked:this.tempoLocked,timeSigLocked:this.timeSignatureLocked}}},{key:"generateFallbackCircle",value:function(){for(var t=[],e=0;e<this.numPoints;e++){var i=e/this.numPoints*Math.PI*2;t.push({x:.5+.5*Math.cos(i),y:.5+.5*Math.sin(i)})}return t}},{key:"getState",value:function(){return{currentShape:this.currentShape,targetShape:this.targetShape,isTransitioning:this.isTransitioning,progress:this.morphProgress,audioDeformation:this.audioDeformation,vocalEnergy:this.vocalEnergy}}},{key:"getProgress",value:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.visualProgress:this.morphProgress}},{key:"isInTransition",value:function(){return this.isTransitioning}}])}();var Gi=function(){return f(function t(){u(this,t),this.audioContext=null,this.analyser=null,this.source=null,this.elementSource=null,this.dataArray=null,this.isAnalyzing=!1,this.connectedElement=null,this.gainNode=null,this.frequencyBands=32,this.smoothingFactor=.3,this.vocalRange={min:80,max:1e3},this.currentAmplitude=0,this.currentFrequencies=new Array(this.frequencyBands).fill(0),this.beatThreshold=.3,this.lastBeatTime=0,this.beatCallbacks=[]},[{key:"init",value:(e=o(v.mark(function t(){var e;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.5,e=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(e),t.abrupt("return",!0);case 1:return t.prev=1,t.catch(0),t.abrupt("return",!1);case 2:case"end":return t.stop()}},t,this,[[0,1]])})),function(){return e.apply(this,arguments)})},{key:"connectAudioElement",value:function(t){if(this.audioContext)try{this.elementSource&&this.connectedElement===t||(this.elementSource=this.audioContext.createMediaElementSource(t),this.elementSource.connect(this.analyser),this.elementSource.connect(this.audioContext.destination)),this.source=this.elementSource,this.connectedElement=t,this.isAnalyzing=!0,this.analyze()}catch(e){e.message&&e.message.includes("already been used")&&(this.source=this.elementSource,this.connectedElement=t,this.isAnalyzing=!0,this.analyze())}}},{key:"analyze",value:function(){var t=this;if(this.isAnalyzing){requestAnimationFrame(function(){return t.analyze()}),this.analyser.getByteFrequencyData(this.dataArray);var e=new Uint8Array(this.analyser.frequencyBinCount);if(this.analyser.getByteTimeDomainData(e),!this.L){var i=Math.max.apply(Math,a(this.dataArray)),n=Math.max.apply(Math,a(e)),r=Math.min.apply(Math,a(e));i>0||128!==n||128!==r?this.L=!0:(this.V||(this.V=0),this.V++,this.V)}for(var s=0,o=0,h=0,u=this.audioContext.sampleRate/2/this.dataArray.length,c=Math.floor(this.vocalRange.min/u),l=Math.ceil(this.vocalRange.max/u),f=0;f<this.dataArray.length;f++){var v=this.dataArray[f]/255;s+=v,f>=c&&f<=l&&(o+=v,h++)}this.currentAmplitude=s/this.dataArray.length;var d=h>0?o/h:0;return this.extractFrequencyBands(),this.detectBeat(this.currentAmplitude),{amplitude:this.currentAmplitude,vocalAmplitude:d,frequencies:this.currentFrequencies,rawData:this.dataArray}}}},{key:"extractFrequencyBands",value:function(){for(var t=Math.floor(this.dataArray.length/this.frequencyBands),e=0;e<this.frequencyBands;e++){for(var i=0,n=e*t,a=Math.min(n+t,this.dataArray.length),r=n;r<a;r++)i+=this.dataArray[r]/255;var s=i/t;this.currentFrequencies[e]=this.currentFrequencies[e]*this.smoothingFactor+s*(1-this.smoothingFactor)}}},{key:"detectBeat",value:function(t){var e=performance.now();t>this.beatThreshold&&e-this.lastBeatTime>60&&(this.lastBeatTime=e,this.beatCallbacks.forEach(function(e){return e(t)}))}},{key:"getVocalInstability",value:function(){for(var t=0,e=this.currentFrequencies.reduce(function(t,e){return t+e},0)/this.frequencyBands,i=0;i<this.frequencyBands;i++)t+=Math.pow(this.currentFrequencies[i]-e,2);return t=Math.sqrt(t/this.frequencyBands),Math.min(1,2*t+.5*this.currentAmplitude)}},{key:"getShapeMorpherData",value:function(){return{instability:this.getVocalInstability(),frequencies:a(this.currentFrequencies),amplitude:this.currentAmplitude}}},{key:"onBeat",value:function(t){this.beatCallbacks.push(t)}},{key:"stop",value:function(){if(this.isAnalyzing=!1,this.gainNode){try{this.gainNode.disconnect()}catch(t){}this.gainNode=null}if(this.elementSource&&this.connectedElement){try{this.elementSource.connect(this.analyser)}catch(t){}this.source=this.elementSource}}},{key:"resume",value:(t=o(v.mark(function t(){return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.audioContext||"suspended"!==this.audioContext.state){t.next=1;break}return t.next=1,this.audioContext.resume();case 1:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.stop(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.analyser=null,this.dataArray=null,this.beatCallbacks=[]}}]);var t,e}(),Li=function(){return f(function t(e){u(this,t),this.mascot=e,this.vocalUpdateInterval=null},[{key:"init",value:function(){}},{key:"disconnectAudio",value:function(){return this.mascot.audioAnalyzer&&this.mascot.audioAnalyzer.stop(),this.vocalUpdateInterval&&(clearInterval(this.vocalUpdateInterval),this.vocalUpdateInterval=null),this.mascot.shapeMorpher&&(this.mascot.shapeMorpher.setVocalEnergy(0),this.mascot.shapeMorpher.setAudioDeformation(0),this.mascot.shapeMorpher.audioAnalyzer=null,this.mascot.shapeMorpher.beatGlitchIntensity=0,this.mascot.shapeMorpher.glitchPoints=[]),this.mascot}},{key:"connectAudio",value:(t=o(v.mark(function t(e){var i=this;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.mascot.audioAnalyzer){t.next=1;break}return t.abrupt("return",this.mascot);case 1:if(this.mascot.audioAnalyzer.audioContext){t.next=2;break}return t.next=2,this.mascot.audioAnalyzer.init();case 2:return this.mascot.audioAnalyzer.connectAudioElement(e),this.mascot.shapeMorpher&&(this.mascot.shapeMorpher.audioAnalyzer=this.mascot.audioAnalyzer,this.mascot.audioAnalyzer.onBeat(function(t){i.mascot.shapeMorpher&&i.mascot.shapeMorpher.vocalEffectActive&&(i.mascot.shapeMorpher.beatGlitchIntensity=.3*t)})),this.vocalUpdateInterval&&clearInterval(this.vocalUpdateInterval),this.vocalUpdateInterval=setInterval(function(){if(i.mascot.audioAnalyzer.isAnalyzing&&i.mascot.shapeMorpher){var t=i.mascot.audioAnalyzer.currentAmplitude||0,e=i.mascot.audioAnalyzer.getVocalInstability()||0;i.mascot.shapeMorpher.setVocalEnergy(e),i.mascot.shapeMorpher.setAudioDeformation(2*t)}},50),this.mascot.renderer&&(this.mascot.renderer.audioAnalyzer=this.mascot.audioAnalyzer),t.abrupt("return",this.mascot);case 3:case"end":return t.stop()}},t,this)})),function(e){return t.apply(this,arguments)})},{key:"stopSpeaking",value:function(){if(!this.mascot.speaking)return this.mascot;var t=this.mascot.audioLevelProcessor.getCurrentLevel();return this.mascot.audioLevelProcessor.cleanup(),this.mascot.speaking=!1,this.mascot.renderer.onSpeechStop(),this.mascot.emit("speechStopped",{previousAudioLevel:t,returnToBaseTime:500}),this.mascot}},{key:"setVolume",value:function(t){var e=Math.max(0,Math.min(1,t));if(this.mascot.config.masterVolume=e,this.mascot.soundSystem.isAvailable()){var i=this.mascot.stateMachine.getCurrentState().emotion;this.mascot.soundSystem.setMasterVolume(e,i)}return this.mascot.emit("volumeChanged",{volume:e}),this.mascot}},{key:"destroy",value:function(){this.disconnectAudio()}}]);var t}(),Vi=function(){return f(function t(e){u(this,t),this.mascot=e,this.currentGesture=null,this.gestureQueue=[]},[{key:"init",value:function(){}},{key:"destroy",value:function(){this.gestureQueue=[],this.currentGesture=null}}])}(),Hi=function(){return f(function t(e){u(this,t),this.mascot=e,this.currentEmotion="neutral",this.emotionIntensity=1},[{key:"init",value:function(){}},{key:"setEmotion",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i={happy:"joy",calm:"neutral",curious:"surprise",frustrated:"anger",sad:"sadness"}[t]||t,n=null,a=500;if("string"==typeof e?n=e:e&&"object"===(0,r.A)(e)&&(n=e.undertone||null,a=e.duration||500),this.mascot.stateMachine.setEmotion(i,n,a)){var s=U(i);if(s&&Lt.registerConfig("emotion",i,s),this.mascot.particleSystem){this.mascot.particleSystem.clear();var o,h=this.mascot.stateMachine.getCurrentEmotionalProperties();if((o="neutral"===i?1:"resting"===i?4:Math.min(3,Math.floor(h.particleRate/4)))>0){var u=this.mascot.canvasManager.width/2,c=this.mascot.canvasManager.height/2;this.mascot.particleSystem.burst(o,h.particleBehavior,u,c)}}if("classic"===this.mascot.config.renderingStyle&&this.mascot.renderer.setEmotionalState){var l=N(i);this.mascot.renderer.setEmotionalState(i,l,n)}this.mascot.emit("emotionChanged",{emotion:i,undertone:n,duration:a})}return this.currentEmotion=i,this.mascot}},{key:"destroy",value:function(){this.currentEmotion="neutral"}}])}(),Xi=function(){return f(function t(e){u(this,t),this.mascot=e,this.animationId=null,this.isRunning=!1,this.lastTime=0},[{key:"init",value:function(){}},{key:"start",value:function(){if(this.mascot.animationController.isAnimating())return this.mascot;if(this.mascot.animationController.start()){if(this.mascot.isRunning=!0,this.isRunning=!0,"classic"===this.mascot.config.renderingStyle&&this.mascot.particleSystem){var t,e,i=this.mascot.stateMachine.getCurrentState(),n=i.emotion,a=(i.undertone,N(n));if(this.mascot.renderer&&this.mascot.renderer.getCurrentOrbPosition){var r=this.mascot.renderer.getCurrentOrbPosition();t=r.x,e=r.y}else t=this.mascot.canvasManager.width/2,e=this.mascot.canvasManager.height/2;if(this.mascot.particleSystem.clear(),a.particleRate>0){var s=Math.min(3,Math.floor(a.particleRate/4));s>0&&this.mascot.particleSystem.burst(s,a.particleBehavior,t,e)}}this.mascot.degradationManager&&this.mascot.degradationManager.startMonitoring(),this.mascot.emit("started")}return this.mascot}},{key:"stop",value:function(){return this.mascot.animationController.isAnimating()?(this.mascot.speaking&&this.mascot.audioHandler.stopSpeaking(),this.mascot.animationController.stop()&&(this.mascot.isRunning=!1,this.isRunning=!1,this.mascot.degradationManager&&this.mascot.degradationManager.stopMonitoring(),this.mascot.emit("stopped")),this.mascot):this.mascot}},{key:"update",value:function(t){if(this.mascot.speaking&&this.mascot.audioLevelProcessor.isProcessingActive()&&this.mascot.audioLevelProcessor.updateAudioLevel(t),"classic"===this.mascot.config.renderingStyle){if(this.mascot.gazeTracker)if(this.mascot.gazeTracker.update(t),"suspicion"===this.mascot.stateMachine.getCurrentState().emotion){var e=this.mascot.gazeTracker.mousePos,i=this.mascot.canvas.width/2,n=this.mascot.canvas.height/2,a=Math.sqrt(Math.pow(e.x-i,2)+Math.pow(e.y-n,2)),r=U("suspicion");if(r&&r.visual){var s=Math.min(i,n),o=Math.max(0,Math.min(1,1-a/s));r.visual.threatLevel=o}}if(this.mascot.idleBehavior&&this.mascot.idleBehavior.update(t),this.mascot.gazeTracker&&this.mascot.idleBehavior){var h=this.mascot.gazeTracker.getGazeOffset(),u=this.mascot.idleBehavior.getSwayOffset(),c=this.mascot.gazeTracker.getState(),l={offset:{x:h.x+u.x,y:h.y+u.y},proximity:c.proximity,isFocused:c.isFocused};this.mascot.renderer.setGazeData&&this.mascot.renderer.setGazeData(l)}}}},{key:"destroy",value:function(){this.stop()}}])}();function Yi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Ui(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Yi(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Yi(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var Ni=function(){return f(function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this,t),this.mascot=e,this.config=this.validateConfig(i)},[{key:"validateConfig",value:function(t){var e,i,n,a,r,s;return Ui({canvasId:t.canvasId||"emotive-canvas",startingEmotion:t.startingEmotion||"neutral",emotionalResponsiveness:null!==(e=t.emotionalResponsiveness)&&void 0!==e?e:.5,particleIntensity:null!==(i=t.particleIntensity)&&void 0!==i?i:1,glowIntensity:null!==(n=t.glowIntensity)&&void 0!==n?n:1,audioEnabled:null!==(a=t.audioEnabled)&&void 0!==a&&a,showFPS:null!==(r=t.showFPS)&&void 0!==r&&r,debugMode:null!==(s=t.debugMode)&&void 0!==s&&s,renderMode:t.renderMode||"default",maxParticles:t.maxParticles||100},t)}},{key:"getConfig",value:function(){return Ui({},this.config)}},{key:"updateConfig",value:function(t){return this.config=Ui(Ui({},this.config),t),this.config}}])}();function Wi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function Qi(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Wi(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Wi(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const Ji=function(){return f(function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.errorBoundary=new p,this.eventManager=new Ye({maxListeners:i.maxEventListeners||100,enableDebugging:i.enableEventDebugging||!1,enableMonitoring:i.enableEventMonitoring||!0,memoryWarningThreshold:i.eventMemoryWarningThreshold||50}),this.errorBoundary.wrap(function(){e.initialize(i)},"initialization")()},[{key:"initialize",value:function(t){var e=this,i=gi.browserOptimizations.getOptimizations(),n=(gi.capabilities,{canvasId:"emotive-mascot",targetFPS:60,enableAudio:gi.featureDetection.features.webAudio,masterVolume:.5,maxParticles:i.particleLimit,defaultEmotion:"neutral",enableAutoOptimization:!0,enableGracefulDegradation:!0,renderingStyle:"classic",enableGazeTracking:!0,enableIdleBehaviors:!0,classicConfig:{coreColor:"#FFFFFF",coreSizeDivisor:12,glowMultiplier:2.5,defaultGlowColor:"#14B8A6"},topOffset:0});if(this.config=Qi(Qi({},n),t),this.canvas="string"==typeof this.config.canvasId?document.getElementById(this.config.canvasId):this.config.canvasId,!this.canvas)throw new Error("Canvas with ID '".concat(this.config.canvasId,"' not found"));this.canvasManager=new d(this.canvas),this.contextRecovery=new di(this.canvas),this.contextRecovery.onRecovery(function(t){e.renderer&&e.renderer.handleContextRecovery(t)}),gi.browserOptimizations.applyCanvasOptimizations(this.canvas,this.canvasManager.getContext()),this.stateMachine=new K(this.errorBoundary),this.particleSystem=new Wt(this.config.maxParticles,this.errorBoundary),this.renderer=new we(this.canvasManager,Qi(Qi({},this.config.classicConfig),{},{topOffset:this.config.topOffset||0})),this.shapeMorpher=new _i,this.audioAnalyzer=new Gi,this.shapeMorpher.audioAnalyzer=this.audioAnalyzer,this.renderer.shapeMorpher=this.shapeMorpher,this.renderer.audioAnalyzer=this.audioAnalyzer,this.renderer.stateMachine=this.stateMachine,this.stateMachine.renderer=this.renderer,this.config.enableGazeTracking&&(this.gazeTracker=new Ae(this.canvas,{smoothing:.1,maxOffset:.15,enabled:!0}),this.gazeTracker.setInteractionCallback(function(){e.sleeping?e.wake():e.idleBehavior&&e.idleBehavior.resetIdleTimer()})),this.config.enableIdleBehaviors&&(this.idleBehavior=new Ce({enabled:!0,sleepTimeout:1/0}),this.idleBehavior.setCallback("onBlink",function(t){e.renderer&&e.renderer.state&&(e.renderer.state.blinking="start"===t.phase)}),this.idleBehavior.setCallback("onSleep",function(){e.renderer&&e.renderer.enterSleepMode&&e.renderer.enterSleepMode()}),this.idleBehavior.setCallback("onWake",function(){e.renderer&&e.renderer.wakeUp&&e.renderer.wakeUp()})),this.soundSystem=new Ie,this.degradationManager=null,this.accessibilityManager=new We({enableReducedMotion:!1!==this.config.enableReducedMotion,enableHighContrast:!1!==this.config.enableHighContrast,enableScreenReaderSupport:!1!==this.config.enableScreenReaderSupport,enableKeyboardNavigation:!1!==this.config.enableKeyboardNavigation,colorBlindMode:this.config.colorBlindMode||"none"}),this.mobileOptimization=new Ke({enableTouchOptimization:!1!==this.config.enableTouchOptimization,enableViewportHandling:!1!==this.config.enableViewportHandling,enableBatteryOptimization:!1!==this.config.enableBatteryOptimization}),this.mobileOptimization.setCanvas(this.canvas),this.pluginSystem=new ai({enablePlugins:!1!==this.config.enablePlugins,validatePlugins:!1!==this.config.validatePlugins,sandboxPlugins:!1!==this.config.sandboxPlugins}),this.audioLevelProcessor=new Ge({spikeThreshold:this.config.spikeThreshold||1.5,minimumSpikeLevel:this.config.minimumSpikeLevel||.1,spikeMinInterval:this.config.spikeMinInterval||1e3});try{this.animationController=new De(this.errorBoundary,{targetFPS:this.config.targetFPS})}catch(t){this.animationController={isAnimating:function(){return e.isRunning},start:function(){return e.isRunning=!0,!0},stop:function(){return e.isRunning=!1,!0},setTargetFPS:function(){},targetFPS:this.config.targetFPS,getPerformanceMetrics:function(){return{fps:0,isRunning:e.isRunning,performanceDegradation:!1,deltaTime:16,frameCount:0,targetFPS:e.config.targetFPS}},setSubsystems:function(){},setEventCallback:function(){},setParentMascot:function(){},destroy:function(){},deltaTime:16}}this.animationController.setSubsystems({stateMachine:this.stateMachine,particleSystem:this.particleSystem,renderer:this.renderer,soundSystem:this.soundSystem,canvasManager:this.canvasManager}),this.animationController.setEventCallback(function(t,i){e.emit(t,i)}),this.animationController.setParentMascot(this),this.isRunning=!1,this.config.enableAudio&&this.soundSystem.initialize().then(function(t){t&&e.soundSystem.setMasterVolume(e.config.masterVolume)}),this.speaking=!1,this.warningTimestamps={},this.rhythmEnabled=!1,Lt.initialize(),"undefined"!=typeof window&&(window.rhythmIntegration=Lt),this.warningThrottle=5e3,this.recording=!1,this.sleeping=!1,this.tts={available:"undefined"!=typeof window&&"speechSynthesis"in window,speaking:!1,currentUtterance:null},this.audioHandler=new Li(this),this.gestureController=new Vi(this),this.stateCoordinator=new Hi(this),this.visualizationRunner=new Xi(this),this.configurationManager=new Ni(this,t),this.audioHandler.init(),this.gestureController.init(),this.stateCoordinator.init(),this.visualizationRunner.init(),this.debugMode=this.config.enableDebug||!1,this.debugMode&&(Oi.log("INFO","Debug mode enabled for EmotiveMascot",{config:this.config,runtimeCapabilities:ji.generateReport()}),Oi.startProfile("mascot-initialization",{canvasId:this.config.canvasId,maxParticles:this.config.maxParticles})),this.setupAudioLevelProcessorCallbacks(),this.stateMachine.setEmotion(this.config.defaultEmotion),this.canvasManager.onResize(function(t,i,n){e.handleResize(t,i,n)}),this.debugMode&&(Oi.endProfile("mascot-initialization"),Oi.takeMemorySnapshot("post-initialization"))}},{key:"handleDegradationEvent",value:function(t,e){switch(t){case"degradationApplied":this.applyDegradationSettings(e.settings),this.emit("performanceDegradation",e);break;case"recoveryApplied":this.applyDegradationSettings(e.settings),this.emit("performanceRecovery",e);break;case"levelChanged":this.applyDegradationSettings(e.settings),this.emit("degradationLevelChanged",e)}}},{key:"applyDegradationSettings",value:function(t){this.particleSystem&&void 0!==t.particleLimit&&this.particleSystem.setMaxParticles(t.particleLimit),this.soundSystem&&void 0!==t.audioEnabled&&!t.audioEnabled&&this.soundSystem.isAvailable()&&this.soundSystem.stopAmbientTone(200),this.renderer&&void 0!==t.qualityLevel&&this.renderer.setQualityLevel(t.qualityLevel)}},{key:"setupAudioLevelProcessorCallbacks",value:function(){var t=this;this.audioLevelProcessor.onLevelUpdate(function(e){t.renderer.updateAudioLevel(e.level),t.emit("audioLevelUpdate",{level:e.level,rawData:Array.from(e.rawData),timestamp:e.timestamp})}),this.audioLevelProcessor.onVolumeSpike(function(e){if(!t.particleSystem.particles.some(function(t){return t.gestureProgress<1})){t.stateMachine.getCurrentState().emotion,t.stateMachine.getCurrentEmotionalProperties();t.express("pulse");t.emit("volumeSpike",Qi(Qi({},e),{},{gestureTriggered:!0}))}}),this.audioLevelProcessor.onError(function(e){t.emit("audioProcessingError",e)})}},{key:"setEmotion",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.errorBoundary.wrap(function(){return e.stateCoordinator.setEmotion(t,i)},"emotion-setting",this)()}},{key:"updateUndertone",value:function(t){var e=this;return this.errorBoundary.wrap(function(){return e.stateMachine.applyUndertoneModifier(t),e.renderer&&e.renderer.updateUndertone&&e.renderer.updateUndertone(t),e},"undertone-update",this)()}},{key:"setBPM",value:function(t){var e=this;return this.errorBoundary.wrap(function(){return e.renderer&&e.renderer.setBPM&&e.renderer.setBPM(t),e},"bpm-update",this)()}},{key:"setRotationSpeed",value:function(t){var e=this;return this.errorBoundary.wrap(function(){return e.renderer&&e.renderer.setRotationSpeed&&e.renderer.setRotationSpeed(t),e},"rotation-speed-update",this)()}},{key:"setRotationAngle",value:function(t){var e=this;return this.errorBoundary.wrap(function(){return e.renderer&&e.renderer.setRotationAngle&&e.renderer.setRotationAngle(t),e},"rotation-angle-update",this)()}},{key:"setGazeTracking",value:function(t){var e=this;return this.errorBoundary.wrap(function(){return e.renderer&&e.renderer.setGazeTracking&&e.renderer.setGazeTracking(t),e},"gaze-tracking-update",this)()}},{key:"express",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.errorBoundary.wrap(function(){var n;if(!t)return e;if(!i.fromScheduler&&window.gestureScheduler&&window.rhythmIntegration&&window.rhythmIntegration.enabled){window.gestureScheduler.requestGesture(t,i);return e}var a=(n={bounce:"startBounce",pulse:"startPulse",shake:"startShake",spin:"startSpin",nod:"startNod",tilt:"startTilt",expand:"startExpand",contract:"startContract",flash:"startFlash",drift:"startDrift",stretch:"startStretch",glow:"startGlow",sparkle:"startSparkle",shimmer:"startShimmer",wiggle:"startWiggle",groove:"startGroove",point:"startPoint",lean:"startLean",reach:"startReach",headBob:"startHeadBob",orbit:"startOrbit",flicker:"startFlicker",vibrate:"startVibrate",wave:"startWave",breathe:"startBreathe",morph:"startMorph",slowBlink:"startSlowBlink",look:"startLook",settle:"startSettle"},(0,h.A)((0,h.A)((0,h.A)((0,h.A)((0,h.A)((0,h.A)((0,h.A)((0,h.A)((0,h.A)((0,h.A)(n,"orbit","startOrbital"),"orbital","startOrbital"),"hula","startHula"),"sway","startSway"),"breathIn","startBreathIn"),"breathOut","startBreathOut"),"breathHold","startBreathHold"),"breathHoldEmpty","startBreathHoldEmpty"),"jump","startJump"),"rain","startRain"),(0,h.A)((0,h.A)(n,"runningman","startRunningMan"),"charleston","startCharleston"))[t];if(a&&e.renderer&&e.renderer[a])return e.renderer[a](),e.soundSystem.isAvailable()&&e.soundSystem.playGestureSound(t),e;var r,s=(0,It.getGesture)(t);return s?(Lt.registerConfig("gesture",t,s),e.currentModularGesture={type:t,config:s,startTime:performance.now(),duration:(null===(r=s.defaultParams)||void 0===r?void 0:r.duration)||1e3,progress:0},e.soundSystem.isAvailable()&&e.soundSystem.playGestureSound(t),e):(e.throttledWarn("Unknown gesture: ".concat(t),"gesture_".concat(t)),e)},"gesture-expression",this)()}},{key:"chain",value:function(){return arguments.length>0&&this.express(arguments.length<=0?void 0:arguments[0]),this}},{key:"startSpeaking",value:function(t){var e=this;return this.errorBoundary.wrap(function(){if(!t)throw new Error("AudioContext is required for speech reactivity");return e.config.enableAudio?e.speaking?e:e.audioLevelProcessor.initialize(t)?(e.speaking=!0,e.renderer.onSpeechStart(t),e.emit("speechStarted",{audioContext:t,analyser:e.audioLevelProcessor.getAnalyser(),mascot:e}),e):e:e},"speech-start",this)()}},{key:"stopSpeaking",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.audioHandler.stopSpeaking()},"speech-stop",this)()}},{key:"speak",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!window.speechSynthesis)return null;var n=new SpeechSynthesisUtterance(t);return i.voice&&(n.voice=i.voice),i.rate&&(n.rate=i.rate),i.pitch&&(n.pitch=i.pitch),i.volume&&(n.volume=i.volume),i.lang&&(n.lang=i.lang),n.onstart=function(){e.setTTSSpeaking(!0),e.emit("tts:start",{text:t})},n.onend=function(){e.setTTSSpeaking(!1),e.emit("tts:end")},n.onerror=function(t){e.setTTSSpeaking(!1),e.emit("tts:error",{error:t})},n.onboundary=function(t){e.emit("tts:boundary",{name:t.name,charIndex:t.charIndex,charLength:t.charLength})},window.speechSynthesis.speak(n),n}},{key:"stopTTS",value:function(){window.speechSynthesis&&(window.speechSynthesis.cancel(),this.setTTSSpeaking(!1))}},{key:"startRecording",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.recording||(t.recording=!0,t.renderer&&t.renderer.startRecording&&t.renderer.startRecording(),t.emit("recordingStarted")),t},"recording-start",this)()}},{key:"stopRecording",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.recording?(t.recording=!1,t.renderer&&t.renderer.stopRecording&&t.renderer.stopRecording(),t.emit("recordingStopped"),t):t},"recording-stop",this)()}},{key:"sleep",value:function(){var t=this;return this.errorBoundary.wrap(o(v.mark(function e(){return v.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.sleeping){e.next=1;break}return e.abrupt("return",t);case 1:return t.express("yawn"),e.next=2,new Promise(function(t){return setTimeout(t,1e3)});case 2:return t.express("sway"),e.next=3,new Promise(function(t){return setTimeout(t,1e3)});case 3:return t.sleeping=!0,t.renderer&&t.renderer.enterSleepMode&&t.renderer.enterSleepMode(),t.idleBehavior&&t.idleBehavior.enterSleep&&t.idleBehavior.enterSleep(),t.emit("sleep"),e.abrupt("return",t);case 4:case"end":return e.stop()}},e)})),"sleep",this)()}},{key:"wake",value:function(){var t=this;return this.errorBoundary.wrap(o(v.mark(function e(){return v.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.sleeping){e.next=1;break}return e.abrupt("return",t);case 1:return t.sleeping=!1,t.renderer&&t.renderer.wakeUp&&t.renderer.wakeUp(),t.idleBehavior&&t.idleBehavior.wakeUp&&t.idleBehavior.wakeUp(),t.express("stretch"),e.next=2,new Promise(function(t){return setTimeout(t,1e3)});case 2:return t.express("slowBlink"),e.next=3,new Promise(function(t){return setTimeout(t,1e3)});case 3:return t.express("shake"),e.next=4,new Promise(function(t){return setTimeout(t,500)});case 4:return t.emit("wake"),e.abrupt("return",t);case 5:case"end":return e.stop()}},e)})),"wake",this)()}},{key:"getTTSVoices",value:function(){return this.tts.available?window.speechSynthesis.getVoices():[]}},{key:"isTTSSpeaking",value:function(){return this.tts.speaking}},{key:"start",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.visualizationRunner.start()},"start",this)()}},{key:"stop",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.visualizationRunner.stop()},"stop",this)()}},{key:"setBreathePattern",value:function(t,e,i,n){var a=this;return this.errorBoundary.wrap(function(){var r=t+e+i+n;return a.breathePattern={inhale:t,hold1:e,exhale:i,hold2:n,totalCycle:r,currentPhase:"inhale",phaseStartTime:Date.now(),phaseProgress:0},a.startBreathingAnimation(),a},"setBreathePattern",this)()}},{key:"setOrbScale",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"easeInOut";return this.errorBoundary.wrap(function(){if(e.renderer){var a=e.currentOrbScale||1,r=Date.now(),s=function(){var o=Date.now()-r,h=Math.min(o/i,1),u=h;"easeIn"===n?u=h*h:"easeOut"===n?u=h*(2-h):"easeInOut"===n&&(u=h<.5?2*h*h:(4-2*h)*h-1),e.currentOrbScale=a+(t-a)*u,e.renderer.setCustomScale&&e.renderer.setCustomScale(e.currentOrbScale),h<1&&e.isRunning&&requestAnimationFrame(s)};s()}return e},"setOrbScale",this)()}},{key:"breathe",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"calm";return this.errorBoundary.wrap(function(){var i={calm:{inhale:4,hold1:0,exhale:4,hold2:0},anxious:{inhale:2,hold1:0,exhale:2,hold2:0},meditative:{inhale:4,hold1:7,exhale:8,hold2:0},deep:{inhale:5,hold1:5,exhale:5,hold2:5},sleep:{inhale:6,hold1:0,exhale:8,hold2:2}},n=i[e]||i.calm;return t.setBreathePattern(n.inhale,n.hold1,n.exhale,n.hold2)},"breathe",this)()}},{key:"startBreathingAnimation",value:function(){var t=this;this.breathingAnimationId&&cancelAnimationFrame(this.breathingAnimationId);var e=function(){if(t.breathePattern&&t.isRunning){var i=t.breathePattern,n=Date.now(),a=(n-i.phaseStartTime)/1e3,r=1,s=i.currentPhase;switch(i.currentPhase){case"inhale":if(a>=i.inhale)s="hold1",i.phaseStartTime=n,t.emit("hold-start",{type:"post-inhale"});else r=1+.3*(a/i.inhale);break;case"hold1":a>=i.hold1&&(s="exhale",i.phaseStartTime=n,t.emit("exhale-start")),r=1.3;break;case"exhale":if(a>=i.exhale)s="hold2",i.phaseStartTime=n,t.emit("hold-start",{type:"post-exhale"});else r=1.3-.4*(a/i.exhale);break;case"hold2":a>=i.hold2&&(s="inhale",i.phaseStartTime=n,t.emit("inhale-start")),r=.9}s!==i.currentPhase&&(i.currentPhase=s),t.renderer&&t.renderer.setCustomScale&&t.renderer.setCustomScale(r),t.breathingAnimationId=requestAnimationFrame(e)}};this.breathePattern.currentPhase="inhale",this.breathePattern.phaseStartTime=Date.now(),this.emit("inhale-start"),e()}},{key:"stopBreathing",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.breathingAnimationId&&(cancelAnimationFrame(t.breathingAnimationId),t.breathingAnimationId=null),t.breathePattern=null,t.renderer&&t.renderer.setCustomScale&&t.renderer.setCustomScale(1),t},"stopBreathing",this)()}},{key:"on",value:function(t,e){var i=this;return this.errorBoundary.wrap(function(){i.eventManager.on(t,e);return i},"event-listener-add",this)()}},{key:"off",value:function(t,e){var i=this;return this.errorBoundary.wrap(function(){return i.eventManager.off(t,e),i},"event-listener-remove",this)()}},{key:"once",value:function(t,e){var i=this;return this.errorBoundary.wrap(function(){i.eventManager.once(t,e);return i},"event-listener-once",this)()}},{key:"removeAllListeners",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.errorBoundary.wrap(function(){t.eventManager.removeAllListeners(e);return t},"event-listeners-clear",this)()}},{key:"listenerCount",value:function(t){return this.eventManager.listenerCount(t)}},{key:"getEventNames",value:function(){return this.eventManager.getEventNames()}},{key:"getEventStats",value:function(){return this.eventManager.getEventStats()}},{key:"getEventDebugInfo",value:function(){return this.eventManager.getDebugInfo()}},{key:"getBrowserCompatibility",value:function(){return{browser:gi.browser,features:gi.featureDetection.getFeatures(),capabilities:gi.capabilities,appliedPolyfills:gi.appliedPolyfills,optimizations:gi.browserOptimizations.getOptimizations()}}},{key:"getDegradationStatus",value:function(){return this.degradationManager?{currentLevel:this.degradationManager.getCurrentLevel(),availableFeatures:this.degradationManager.getAvailableFeatures(),recommendedSettings:this.degradationManager.getRecommendedSettings(),performanceStats:this.degradationManager.getPerformanceStats(),allLevels:this.degradationManager.getAllLevels()}:null}},{key:"setDegradationLevel",value:function(t){return!!this.degradationManager&&this.degradationManager.setLevel(t)}},{key:"isFeatureAvailable",value:function(t){return this.degradationManager?this.degradationManager.isFeatureAvailable(t):gi.featureDetection.getFeatures()[t]||!1}},{key:"recoverCanvasContext",value:function(){return!!this.contextRecovery&&this.contextRecovery.recover()}},{key:"isCanvasContextLost",value:function(){return!!this.contextRecovery&&this.contextRecovery.isLost()}},{key:"setDebugMode",value:function(t){return this.config.showDebug=!!t,this.config.showFPS=!!t,this}},{key:"getDebugReport",value:function(){var t={timestamp:Date.now(),mascot:{isRunning:this.isRunning,speaking:this.speaking,debugMode:this.debugMode,config:this.config},currentState:this.getCurrentState(),performanceMetrics:this.getPerformanceMetrics(),audioStats:this.getAudioStats(),eventStats:this.getEventStats(),browserCompatibility:this.getBrowserCompatibility(),degradationStatus:this.getDegradationStatus(),runtimeCapabilities:ji.generateReport(),debuggerReport:Oi.getDebugReport()};return this.debugMode&&Oi.log("DEBUG","Generated debug report",{reportSize:JSON.stringify(t).length,sections:Object.keys(t)}),t}},{key:"exportDebugData",value:function(){var t,e={metadata:{exportTime:Date.now(),version:"1.0.0",userAgent:navigator.userAgent,url:null===(t=window.location)||void 0===t?void 0:t.href},mascotState:{config:this.config,currentState:this.getCurrentState(),isRunning:this.isRunning,speaking:this.speaking},performance:{metrics:this.getPerformanceMetrics(),degradationStatus:this.getDegradationStatus(),frameTimings:Oi.frameTimings},compatibility:{browser:this.getBrowserCompatibility(),runtimeCapabilities:ji.generateReport()},debuggerData:Oi.exportDebugData()};return this.debugMode&&Oi.log("INFO","Exported debug data",{dataSize:JSON.stringify(e).length}),e}},{key:"startProfiling",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.debugMode&&Oi.startProfile(t,e)}},{key:"endProfiling",value:function(t){return this.debugMode?Oi.endProfile(t):null}},{key:"takeMemorySnapshot",value:function(t){this.debugMode&&Oi.takeMemorySnapshot(t)}},{key:"clearDebugData",value:function(){Oi.clear(),this.debugMode&&Oi.log("INFO","Debug data cleared")}},{key:"getRuntimeCapabilities",value:function(){return ji.generateReport()}},{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.eventManager.emit(t,e)}},{key:"update",value:function(t){var e=this;this.errorBoundary.wrap(function(){e.visualizationRunner.update(t)},"audio-update")()}},{key:"render",value:function(){var t=16.67,e=0;try{var i;e=this.debugMode?performance.now():0,t=this.animationController?this.animationController.deltaTime:16.67;var n={properties:this.stateMachine.getCurrentEmotionalProperties(),emotion:this.stateMachine.getCurrentState().emotion,undertone:this.stateMachine.getCurrentState().undertone,particleSystem:this.particleSystem,speaking:this.speaking,audioLevel:this.audioLevelProcessor.getCurrentLevel(),gazeOffset:this.gazeTracker?this.gazeTracker.currentGaze:{x:0,y:0}};if(this.debugMode&&Oi.trackFrameTiming(t),this.canvasManager.clear(),this.gazeTracker&&this.gazeTracker.update(t),"suspicion"===n.emotion&&this.gazeTracker){var a=U("suspicion");if(a&&a.visual){this.gazeTracker.getState();var r=this.gazeTracker.mousePos,s=this.canvasManager.width/2,o=this.canvasManager.height/2-this.config.topOffset,h=Math.sqrt(Math.pow(r.x-s,2)+Math.pow(r.y-o,2)),u=Math.min(this.canvasManager.width,this.canvasManager.height)/2,c=Math.max(0,Math.min(1,1-h/u));a.visual.threatLevel=c}}var l=N(n.emotion);this.renderer.setEmotionalState(n.emotion,l,n.undertone);var f=this.canvasManager.width/2,v=this.canvasManager.height/2-this.config.topOffset,d=this.stateMachine.getCurrentEmotionalProperties();d.verticalOffset&&(v=this.canvasManager.height/2-this.config.topOffset+this.canvasManager.height*d.verticalOffset);var p=l.particleBehavior||"ambient",y=l.particleRate||15,m=void 0!==l.minParticles?l.minParticles:d.minParticles||0,g=void 0!==l.maxParticles?l.maxParticles:d.maxParticles||10;"zen"===n.emotion&&(p=Math.random()<.6?"falling":"orbiting"),this.renderer.state&&this.renderer.state.particleBehaviorOverride&&(p=this.renderer.state.particleBehaviorOverride),this.renderer.state&&this.renderer.state.particleRateMult&&(y=Math.floor(y*this.renderer.state.particleRateMult),g=Math.floor(g*this.renderer.state.particleRateMult)),this.particleSystem.spawn(p,n.emotion,y,f,v,t,null,m,g,this.renderer.scaleFactor||1,(null===(i=this.config.classicConfig)||void 0===i?void 0:i.particleSizeMultiplier)||1,l.particleColors||null,n.undertone);var b=this.renderer.getUndertoneModifier?this.renderer.getUndertoneModifier():null,M=b;"zen"===n.emotion&&this.renderer.state.zenVortexIntensity&&(M=Qi(Qi({},b||{}),{},{zenVortexIntensity:this.renderer.state.zenVortexIntensity}));var k=null,w=0;if(this.currentModularGesture){var S=performance.now()-this.currentModularGesture.startTime;(w=Math.min(S/this.currentModularGesture.duration,1))>=1?(k={type:this.currentModularGesture.type,amplitude:1,frequency:1,intensity:1},w=1,this.currentModularGesture.cleanupPending?this.currentModularGesture=null:this.currentModularGesture.cleanupPending=!0):k={type:this.currentModularGesture.type,amplitude:1,frequency:1,intensity:1}}else if(this.renderer&&this.renderer.getCurrentGesture){var O=this.renderer.getCurrentGesture();O&&O.particleMotion&&(k=O.particleMotion,w=O.progress||0)}this.particleSystem.update(t,f,v,k,w,M);var j=this.renderer.gestureAnimator?this.renderer.gestureAnimator.applyGestureAnimations():null;if(this.particleSystem.renderBackground(this.canvasManager.getContext(),l.glowColor,j),this.renderer.render(n,t,j),this.particleSystem.renderForeground(this.canvasManager.getContext(),l.glowColor,j),(this.config.showFPS||this.config.showDebug)&&this.renderDebugInfo(t),this.debugMode){var F=performance.now()-e;F>16.67&&Oi.log("WARN","Slow render frame detected",{renderTime:F,deltaTime:t,particleCount:this.particleSystem.getStats().activeParticles})}}catch(t){this.errorBoundary.logError(t,"main-render")}}},{key:"renderDebugInfo",value:function(t){var e=this.canvasManager.getContext();e.save(),e.fillStyle="#ffffff",e.font="12px monospace",e.strokeStyle="#000000",e.lineWidth=2;var i=20;if(this.config.showFPS){var n=this.animationController.getPerformanceMetrics(),r=n.instantFps||n.fps||0,s=n.averageFrameTime?n.averageFrameTime.toFixed(1):"0.0",o=this.particleSystem.getStats(),h=["FPS: ".concat(r),"Frame: ".concat(s,"ms"),"Particles: ".concat(o.activeParticles)],u=0;h.forEach(function(t){var i=e.measureText(t).width;i>u&&(u=i)});var c,l=this.canvasManager.width-u-8-10;e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(l-8,i-14,u+16,18*h.length+4),c=r>=55?"#00ff00":r>=30?"#ffff00":"#ff0000",e.strokeStyle=c,e.lineWidth=2,e.strokeRect(l-8,i-14,u+16,18*h.length+4),h.forEach(function(t,n){var a=i+16*n;e.fillStyle="#ffffff",e.fillText(t,l,a)}),i+=16*h.length}if(this.config.showDebug){var f=this.stateMachine.getCurrentState(),v=this.particleSystem.getStats(),d=["Emotion: ".concat(f.emotion).concat(f.undertone?" (".concat(f.undertone,")"):""),"Particles: ".concat(v.activeParticles,"/").concat(v.maxParticles),"Gesture: ".concat(this.currentModularGesture?this.currentModularGesture.type:"none"),"Queue: 0","Speaking: ".concat(this.speaking?"yes":"no"),"Audio Level: ".concat((100*this.audioLevel).toFixed(1),"%")];e.fillStyle="rgba(0, 0, 0, 0.7)";var p=Math.max.apply(Math,a(d.map(function(t){return e.measureText(t).width})));e.fillRect(8,i-14,p+16,16*d.length+4),e.fillStyle="#ffffff";for(var y=0,m=d;y<m.length;y++){var g=m[y];e.fillText(g,10,i),i+=16}}e.restore()}},{key:"getEmotionalColor",value:function(){var t=this.stateMachine.getCurrentEmotionalProperties();return(null==t?void 0:t.primaryColor)||"#B0B0B0"}},{key:"getCurrentState",value:function(){return this.stateMachine.getCurrentState()}},{key:"getAvailableEmotions",value:function(){return this.stateMachine.getAvailableEmotions()}},{key:"getAvailableUndertones",value:function(){return this.stateMachine.getAvailableUndertones()}},{key:"getAudioLevel",value:function(){return this.speaking?this.audioLevel:0}},{key:"getAudioStats",value:function(){return this.audioLevelProcessor.getStats()}},{key:"updateAudioConfig",value:function(t){this.audioLevelProcessor.updateConfig(t)}},{key:"getAvailableGestures",value:function(){return["bounce","pulse","shake","spin","drift","nod","tilt","expand","contract","flash","stretch","glow","flicker","vibrate","wave","morph","slowBlink","look","settle","breathIn","breathOut","breathHold","breathHoldEmpty","jump"]}},{key:"connectAudioSource",value:function(t){var e=this;return this.errorBoundary.wrap(function(){return e.audioAnalyser&&t&&"function"==typeof t.connect?(t.connect(e.audioAnalyser),e.emit("audioSourceConnected",{audioSource:t}),e):e},"audio-source-connection",this)()}},{key:"setVolume",value:function(t){var e=this;return this.errorBoundary.wrap(function(){return e.audioHandler.setVolume(t)},"volume-setting",this)()}},{key:"getVolume",value:function(){return this.config.masterVolume}},{key:"pause",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.animationController.isAnimating()?(t.animationController.stop(),t.isRunning=!1,t.soundSystem.isAvailable()&&t.soundSystem.stopAmbientTone(200),t.emit("paused"),t):t},"pause",this)()}},{key:"resume",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.animationController.isAnimating()||(t.animationController.start(),t.isRunning=!0,t.emit("resumed")),t},"resume",this)()}},{key:"isActive",value:function(){return this.animationController.isAnimating()}},{key:"setTargetFPS",value:function(t){var e=Math.max(15,Math.min(120,t));return this.config.targetFPS=e,this.animationController.setTargetFPS(e),this.emit("targetFPSChanged",{targetFPS:e}),this}},{key:"getTargetFPS",value:function(){return this.animationController.targetFPS}},{key:"setPerformanceDegradation",value:function(t){var e=this.animationController.getPerformanceMetrics();if(t&&!e.performanceDegradation){var i=this.particleSystem.maxParticles,n=Math.max(5,Math.floor(.5*i));this.particleSystem.setMaxParticles(n)}else!t&&e.performanceDegradation&&this.particleSystem.setMaxParticles(this.config.maxParticles);return this}},{key:"isSpeaking",value:function(){return this.speaking}},{key:"setAudioSmoothing",value:function(t){var e=this;return this.errorBoundary.wrap(function(){var i=Math.max(0,Math.min(1,t));return e.audioAnalyser&&(e.audioAnalyser.smoothingTimeConstant=i),e},"audio-smoothing",this)()}},{key:"getSystemStatus",value:function(){var t=this;return this.errorBoundary.wrap(function(){var e,i,n=t.stateMachine.getCurrentState(),a=t.particleSystem.getStats(),r=t.renderer.getStats(),s=t.animationController.getPerformanceMetrics();return{isRunning:s.isRunning,fps:s.fps,targetFPS:s.targetFPS,performanceDegradation:s.performanceDegradation,emotion:n.emotion,undertone:n.undertone,isTransitioning:n.isTransitioning,transitionProgress:n.transitionProgress,currentGesture:(null===(e=t.renderer)||void 0===e?void 0:e.currentGesture)||null,gestureActive:(null===(i=t.renderer)||void 0===i?void 0:i.isGestureActive())||!1,particles:{active:a.activeParticles,max:a.maxParticles,poolEfficiency:a.poolEfficiency},audioEnabled:t.config.enableAudio,soundSystemAvailable:t.soundSystem.isAvailable(),speaking:t.speaking,audioLevel:t.audioLevel,masterVolume:t.config.masterVolume,renderer:{gradientCacheSize:r.gradientCacheSize,breathingPhase:r.breathingPhase,layers:r.layers},eventListeners:t.getEventNames().length,errorStats:t.errorBoundary.getErrorStats()}},"system-status",{})()}},{key:"triggerTestError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"manual-test";return this.errorBoundary.wrap(function(){throw new Error("Test error triggered in context: ".concat(t))},t,this)()}},{key:"getPerformanceMetrics",value:function(){var t=this.animationController.getPerformanceMetrics(),e=this.stateMachine.getCurrentState();return Qi(Qi({},t),{},{currentEmotion:e.emotion,currentUndertone:e.undertone,isTransitioning:e.isTransitioning,errorStats:this.errorBoundary.getErrorStats()})}},{key:"registerPlugin",value:(t=o(v.mark(function t(e){return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginSystem.registerPlugin(e));case 1:case"end":return t.stop()}},t,this)})),function(e){return t.apply(this,arguments)})},{key:"setAccessibility",value:function(t){t.colorBlindMode&&this.accessibilityManager.setColorBlindMode(t.colorBlindMode),void 0!==t.reducedMotion&&(this.accessibilityManager.reducedMotionPreferred=t.reducedMotion),void 0!==t.highContrast&&(this.accessibilityManager.highContrastEnabled=t.highContrast)}},{key:"getMobileStatus",value:function(){return this.mobileOptimization.getStatus()}},{key:"getAccessibilityStatus",value:function(){return this.accessibilityManager.getStatus()}},{key:"setState",value:function(t){return this.setEmotion(t)}},{key:"setTTSSpeaking",value:function(t){this.ttsSpeaking=t,this.renderer&&this.renderer.startSpeaking&&(t?this.renderer.startSpeaking():this.renderer.stopSpeaking()),this.speaking=t}},{key:"getVoices",value:function(){return window.speechSynthesis?window.speechSynthesis.getVoices():[]}},{key:"handleResize",value:function(t,e,i){if(this.renderer&&this.renderer.initOffscreenCanvas&&this.renderer.initOffscreenCanvas(),this.stateMachine){var n=this.stateMachine.currentEmotion,a=this.stateMachine.currentUndertone;n&&this.stateMachine.setEmotion(n),a&&"none"!==a&&this.stateMachine.setUndertone(a)}this.emit("resize",{width:t,height:e,dpr:i})}},{key:"morphTo",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.errorBoundary.wrap(function(){return e.shapeMorpher?(e.shapeMorpher.morphTo(t,i),e.renderer&&(e.renderer.shapeMorpher=e.shapeMorpher),e.emit("shapeMorphStarted",{from:e.shapeMorpher.currentShape,to:t}),e):e},"morphTo",this)()}},{key:"connectAudio",value:function(t){var e=this;return this.errorBoundary.wrap(o(v.mark(function i(){return v.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=1,e.audioHandler.connectAudio(t);case 1:return i.abrupt("return",i.sent);case 2:case"end":return i.stop()}},i)})),"connectAudio",this)()}},{key:"disconnectAudio",value:function(){var t=this;return this.errorBoundary.wrap(function(){return t.audioHandler.disconnectAudio()},"disconnectAudio",this)()}},{key:"getAvailableShapes",value:function(){return _i.getAvailableShapes()}},{key:"destroy",value:function(){var t=this;this.errorBoundary.wrap(function(){t.stop(),t.speaking&&t.stopSpeaking(),t.animationController&&t.animationController.destroy(),t.soundSystem&&t.soundSystem.cleanup(),t.audioLevelProcessor&&t.audioLevelProcessor.cleanup(),t.particleSystem&&t.particleSystem.destroy(),t.renderer&&(t.renderer.stopAllGestures(),t.renderer.destroy()),t.canvasManager&&t.canvasManager.destroy(),t.eventManager&&t.eventManager.destroy(),t.accessibilityManager&&t.accessibilityManager.destroy(),t.mobileOptimization&&t.mobileOptimization.destroy(),t.pluginSystem&&t.pluginSystem.destroy(),t.audioAnalyzer&&(t.disconnectAudio(),t.audioAnalyzer.destroy()),t.shapeMorpher&&t.shapeMorpher.reset(),t.errorBoundary.clearErrors()},"destruction")()}},{key:"throttledWarn",value:function(t,e){var i=Date.now();i-(this.warningTimestamps[e]||0)>this.warningThrottle&&(this.warningTimestamps[e]=i)}}]);var t}();function Zi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function $i(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Zi(Object(i),!0).forEach(function(e){(0,h.A)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Zi(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const Ki=function(){return f(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.H=this.X(e),this.Y=null,this.U=[],this.N=!1,this.W=0,this.J=0,this.Z=!1,this.$=null,this.K=0,this.tt=!1,this.init=this.init.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this)},[{key:"_getReal",value:function(){return this.et||this.Y}},{key:"_sanitizeConfig",value:function(t){var e=$i({},t);return delete e.enableDebug,delete e.enableInternalAPIs,delete e.exposeInternals,e.mode="production",void 0===e.enableGazeTracking&&(e.enableGazeTracking=!0),e}},{key:"init",value:(n=o(v.mark(function t(e){var i,n;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.tt){t.next=1;break}return t.abrupt("return",Promise.resolve());case 1:return i=$i($i({},this.H),{},{canvasId:e}),n=new Ji(i),Object.defineProperty(this,"et",{value:n,writable:!1,enumerable:!1,configurable:!1}),this.Y=new Proxy(n,{get:function(t,e){if(["soundSystem","stateMachine","emotionLibrary","audioLevelProcessor","particleSystem","errorBoundary","performanceMonitor","config","debugMode"].includes(e))return new Proxy({},{get:function(){},set:function(){return!1},has:function(){return!1},ownKeys:function(){return[]},getOwnPropertyDescriptor:function(){}});if("renderer"===e||"shapeMorpher"===e||"audioAnalyzer"===e||"gazeTracker"===e){var i=t[e];if(!i)return;return new Proxy(i,{get:function(t,i){var n;if(null!==(n={renderer:["setBlinkingEnabled"],shapeMorpher:["resetMusicDetection","frequencyData"],audioAnalyzer:["microphoneStream","currentFrequencies"],gazeTracker:["enable","disable","mousePos","updateTargetGaze","currentGaze","getState"]}[e])&&void 0!==n&&n.includes(i))return t[i]},set:function(){return!1},has:function(){return!1},ownKeys:function(){return[]}})}return t[e]},set:function(){return!1},has:function(t,e){return!["soundSystem","stateMachine","emotionLibrary"].includes(e)&&e in t},ownKeys:function(t){return["canvas","start","stop","pause","resume","setEmotion","morphTo","express"].filter(function(e){return e in t})}}),this.canvas=this.Y.canvas,this.tt=!0,t.abrupt("return",Promise.resolve());case 2:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"start",value:function(){var t=this.it();if(!t)throw new Error("Engine not initialized. Call init() first.");t.start()}},{key:"stop",value:function(){var t=this.it();if(!t)throw new Error("Engine not initialized. Call init() first.");t.stop()}},{key:"pause",value:function(){var t=this.it();if(!t)throw new Error("Engine not initialized. Call init() first.");t.pause()}},{key:"resume",value:function(){var t=this.it();if(!t)throw new Error("Engine not initialized. Call init() first.");t.resume()}},{key:"loadAudio",value:(i=o(v.mark(function t(e){var i;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof Blob)){t.next=2;break}return this.$=e,i=URL.createObjectURL(e),t.next=1,this.nt(i);case 1:URL.revokeObjectURL(i),t.next=3;break;case 2:return t.next=3,this.nt(e);case 3:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"_loadAudioFromUrl",value:(e=o(v.mark(function t(e){var i,n=this;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=new Audio(e),t.next=1,new Promise(function(t,e){i.addEventListener("loadedmetadata",function(){n.K=1e3*i.duration,t()}),i.addEventListener("error",e),i.load()});case 1:if(!this.et||!this.et.soundSystem){t.next=2;break}return t.next=2,this.et.soundSystem.loadAudioFromURL(e);case 2:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"getAudioAnalysis",value:function(){var t,e,i,n,a=this.it();return a&&a.audioAnalyzer?{bpm:(null===(t=a.rhythmIntegration)||void 0===t?void 0:t.getBPM())||0,beats:(null===(e=a.rhythmIntegration)||void 0===e?void 0:e.getBeatMarkers())||[],energy:(null===(i=a.audioAnalyzer)||void 0===i?void 0:i.getEnergyLevel())||0,frequencies:(null===(n=a.audioAnalyzer)||void 0===n?void 0:n.getFrequencyData())||[]}:null}},{key:"connectAudio",value:function(t){var e=this.it();if(!e)throw new Error("Engine not initialized. Call init() first.");e.connectAudio&&e.connectAudio(t)}},{key:"disconnectAudio",value:function(t){var e=this.it();e&&e.disconnectAudio&&e.disconnectAudio(t)}},{key:"getSpectrumData",value:function(){var t=this.it();return t&&t.audioAnalyzer?t.audioAnalyzer.dataArray?Array.from(t.audioAnalyzer.dataArray).map(function(t){return t/255}):t.shapeMorpher&&t.shapeMorpher.frequencyData?Array.from(t.shapeMorpher.frequencyData):[]:[]}},{key:"startRhythmSync",value:function(t){var e=this.it();if(!e)throw new Error("Engine not initialized. Call init() first.");e.rhythmIntegration&&(t&&e.rhythmIntegration.setBPM(t),e.rhythmIntegration.start())}},{key:"stopRhythmSync",value:function(){var t=this.it();t&&t.rhythmIntegration&&t.rhythmIntegration.stop()}},{key:"getPerformanceMetrics",value:function(){var t;return this.it()?this.Y.performanceMonitor?{fps:this.Y.performanceMonitor.getCurrentFPS()||0,frameTime:this.Y.performanceMonitor.getAverageFrameTime()||0,particleCount:(null===(t=this.Y.particleSystem)||void 0===t?void 0:t.activeParticles)||0}:this.Y.animationController?{fps:this.Y.animationController.currentFPS||0,frameTime:1e3/60,particleCount:0}:{fps:0,frameTime:0,particleCount:0}:{fps:0,frameTime:0}}},{key:"triggerGesture",value:function(t,e){var i=this.it();if(!i)throw new Error("Engine not initialized. Call init() first.");if(this.N){var n=e||Date.now()-this.W;this.U.push({type:"gesture",name:t,time:n})}i.express(t)}},{key:"setEmotion",value:function(t,e,i){var n=this.it();if(!n)throw new Error("Engine not initialized. Call init() first.");var a=null,s=i;if("string"==typeof e?a=e:"number"==typeof e?s=e:e&&"object"===(0,r.A)(e)&&(a=e.undertone),this.N){var o=s||Date.now()-this.W;this.U.push({type:"emotion",name:t,undertone:a,time:o})}a?n.setEmotion(t,{undertone:a}):n.setEmotion(t)}},{key:"setSoundEnabled",value:function(t){var e=this.it();if(!e)throw new Error("Engine not initialized. Call init() first.");e.soundSystem&&(e.soundSystem.enabled=t)}},{key:"setShape",value:function(t,e){var i=this.it();if(!i)throw new Error("Engine not initialized. Call init() first.");var n={},a=void 0;if("number"==typeof e?a=e:e&&"object"===(0,r.A)(e)&&(a=(n=e).timestamp),this.N){var s=a||Date.now()-this.W;this.U.push({type:"shape",name:t,time:s,config:n})}i&&i.morphTo(t,n)}},{key:"enableGazeTracking",value:function(){var t=this.it();if(!t)throw new Error("Engine not initialized. Call init() first.");t.gazeTracker&&t.gazeTracker.enable()}},{key:"disableGazeTracking",value:function(){var t=this.it();if(!t)throw new Error("Engine not initialized. Call init() first.");t.gazeTracker&&t.gazeTracker.disable()}},{key:"setGazeTarget",value:function(t,e){var i=this.it();if(!i)throw new Error("Engine not initialized. Call init() first.");i.gazeTracker&&(i.gazeTracker.mousePos={x:t,y:e},i.gazeTracker.updateTargetGaze())}},{key:"getGazeState",value:function(){var t=this.it();if(!t)throw new Error("Engine not initialized. Call init() first.");return t.gazeTracker?t.gazeTracker.getState():null}},{key:"setBPM",value:function(t){var e=this.it();e&&e.rhythmIntegration&&e.rhythmIntegration.setBPM(t)}},{key:"setQuality",value:function(t){var e={low:{particleCount:50,fps:30},medium:{particleCount:100,fps:60},high:{particleCount:200,fps:60}},i=e[t]||e.medium;this.Y.performanceMonitor&&this.Y.performanceMonitor.setTargetFPS(i.fps),this.Y.particleSystem&&this.Y.particleSystem.setMaxParticles(i.particleCount)}},{key:"startRecording",value:function(){this.U=[],this.N=!0,this.W=Date.now()}},{key:"stopRecording",value:function(){return this.N=!1,this.U}},{key:"playTimeline",value:function(t){var e=this;if(t&&t.length){this.Z=!0,this.J=Date.now(),t.forEach(function(t){setTimeout(function(){if(e.Z){var i=e.it();if(i)switch(t.type){case"gesture":i.express(t.name);break;case"emotion":i.setEmotion(t.name);break;case"shape":i.morphTo(t.name)}}},t.time)});var i=Math.max.apply(Math,a(t.map(function(t){return t.time})));setTimeout(function(){e.Z=!1},i)}}},{key:"stopPlayback",value:function(){this.Z=!1}},{key:"getTimeline",value:function(){return a(this.U)}},{key:"loadTimeline",value:function(t){this.U=a(t)}},{key:"exportTimeline",value:function(){return JSON.stringify({version:"1.0",duration:this.K||0,events:this.U})}},{key:"importTimeline",value:function(t){var e=JSON.parse(t);this.U=e.events||[],this.K=e.duration||0}},{key:"getCurrentTime",value:function(){return this.Z?Date.now()-this.J:0}},{key:"seek",value:function(t){var e=this.U.filter(function(e){return e.time<=t}),i={};e.forEach(function(t){i[t.type]=t});var n=this.it();n&&(i.emotion&&n.setEmotion(i.emotion.name),i.shape&&n.morphTo(i.shape.name))}},{key:"getFrameData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png",e=this.canvas||this.Y.canvas;return e?e.toDataURL("image/".concat(t)):null}},{key:"getFrameBlob",value:(t=o(v.mark(function t(){var e,i,n=arguments;return v.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=n.length>0&&void 0!==n[0]?n[0]:"png",i=this.canvas||this.Y.canvas){t.next=1;break}return t.abrupt("return",null);case 1:return t.abrupt("return",new Promise(function(t){i.toBlob(function(e){return t(e)},"image/".concat(e))}));case 2:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"getAnimationData",value:function(){var t,e;return{timeline:this.U,duration:this.K,currentTime:this.getCurrentTime(),emotion:(null===(t=this.Y.state)||void 0===t?void 0:t.emotion)||"neutral",shape:(null===(e=this.Y.state)||void 0===e?void 0:e.currentShape)||"circle"}}},{key:"getAvailableGestures",value:function(){return["bounce","pulse","shake","spin","nod","tilt","drift","vibrate","sway","float","wave","expand","contract","stretch","morph","jump","flash","glow","flicker","scan","hula","orbit","breathe","settle"]}},{key:"getAvailableEmotions",value:function(){return["neutral","joy","sadness","anger","fear","surprise","disgust","love","euphoria","excited","suspicion","resting"]}},{key:"getAvailableShapes",value:function(){return["circle","square","triangle","star","heart","moon","sun"]}},{key:"getVersion",value:function(){return"2.4.0"}},{key:"getCapabilities",value:function(){return{audio:!0,recording:!0,timeline:!0,export:!0,shapes:!0,gestures:!0,emotions:!0,particles:!0,gazeTracking:!0}}},{key:"renderer",get:function(){var t=this.it();return t&&t.renderer?new Proxy(t.renderer,{get:function(t,e){return["setBlinkingEnabled"].includes(e)?t[e]:void 0}}):null}},{key:"shapeMorpher",get:function(){var t=this.it();return t&&t.shapeMorpher?new Proxy(t.shapeMorpher,{get:function(t,e){return["resetMusicDetection","frequencyData"].includes(e)?t[e]:void 0}}):null}},{key:"gazeTracker",get:function(){var t=this.it();return t&&t.gazeTracker?new Proxy(t.gazeTracker,{get:function(t,e){return["enable","disable","mousePos","updateTargetGaze","currentGaze","getState"].includes(e)?t[e]:void 0}}):null}},{key:"destroy",value:function(){this.stop(),this.U=[],this.N=!1,this.Z=!1;var t=this.it();t&&t.destroy&&t.destroy()}}]);var t,e,i,n}()})(),n=n.default})());