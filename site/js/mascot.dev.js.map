{"version":3,"file":"mascot.dev.js","sources":["../src/core/CanvasManager.js","../src/core/ErrorBoundary.js","../src/utils/colorUtils.js","../src/utils/easing.js","../src/core/emotions/plugin-adapter.js","../src/core/emotions/states/suspicion.js","../src/core/emotions/states/glitch.js","../src/core/emotions/states/calm.js","../src/core/emotions/index.js","../src/core/emotions/states/neutral.js","../src/core/emotions/states/joy.js","../src/core/emotions/states/sadness.js","../src/core/emotions/states/anger.js","../src/core/emotions/states/fear.js","../src/core/emotions/states/surprise.js","../src/core/emotions/states/disgust.js","../src/core/emotions/states/love.js","../src/core/emotions/states/excited.js","../src/core/emotions/states/resting.js","../src/core/emotions/states/euphoria.js","../src/core/emotions/states/focused.js","../src/core/EmotiveStateMachine.js","../src/core/particles/utils/colorUtils.js","../src/core/particles/behaviors/ambient.js","../src/core/particles/config/physics.js","../src/core/particles/behaviors/orbiting.js","../src/core/particles/behaviors/rising.js","../src/core/particles/behaviors/falling.js","../src/core/particles/config/playground.js","../src/core/particles/behaviors/popcorn.js","../src/core/particles/behaviors/burst.js","../src/core/particles/behaviors/aggressive.js","../src/core/particles/behaviors/scattering.js","../src/core/particles/behaviors/repelling.js","../src/core/particles/behaviors/connecting.js","../src/core/particles/behaviors/resting.js","../src/core/particles/behaviors/radiant.js","../src/core/particles/behaviors/ascending.js","../src/core/particles/behaviors/erratic.js","../src/core/particles/behaviors/cautious.js","../src/core/particles/behaviors/surveillance.js","../src/core/particles/behaviors/glitchy.js","../src/core/particles/behaviors/directed.js","../src/core/particles/behaviors/fizzy.js","../src/core/particles/behaviors/zen.js","../src/core/particles/behaviors/plugin-adapter.js","../src/core/particles/behaviors/index.js","../src/core/gestures/plugin-adapter.js","../src/core/gestures/motions/bounce.js","../src/core/gestures/motions/pulse.js","../src/core/gestures/motions/shake.js","../src/core/gestures/motions/nod.js","../src/core/gestures/motions/vibrate.js","../src/core/gestures/motions/orbit.js","../src/core/gestures/motions/twitch.js","../src/core/gestures/motions/sway.js","../src/core/gestures/motions/float.js","../src/core/gestures/motions/jitter.js","../src/core/gestures/transforms/spin.js","../src/core/gestures/transforms/jump.js","../src/core/gestures/transforms/morph.js","../src/core/gestures/transforms/stretch.js","../src/core/gestures/transforms/tilt.js","../src/core/gestures/transforms/orbital.js","../src/core/gestures/transforms/hula.js","../src/core/gestures/transforms/scan.js","../src/core/gestures/transforms/twist.js","../src/core/gestures/effects/wave.js","../src/core/gestures/effects/drift.js","../src/core/gestures/effects/flicker.js","../src/core/gestures/effects/burst.js","../src/core/gestures/effects/directional.js","../src/core/gestures/effects/settle.js","../src/core/gestures/effects/breathe.js","../src/core/gestures/effects/expand.js","../src/core/gestures/effects/contract.js","../src/core/gestures/effects/flash.js","../src/core/gestures/effects/glow.js","../src/core/gestures/effects/peek.js","../src/core/gestures/index.js","../src/core/gestures/effects/fade.js","../src/core/gestures/effects/hold.js","../src/core/gestures/effects/runningman.js","../src/core/gestures/effects/charleston.js","../src/core/rhythm.js","../src/core/rhythmIntegration.js","../src/core/Particle.js","../src/core/gestures/GestureMotion.js","../src/core/ParticleSystem.js","../src/config/undertoneModifiers.js","../src/core/GestureCompositor.js","../src/core/effects/zen-vortex.js","../src/core/effects/recording-glow.js","../src/core/effects/speaking-pulse.js","../src/core/effects/sleeping-effect.js","../src/core/effects/suspicion-scan.js","../src/core/effects/gaze-narrowing.js","../src/core/effects/fingerprint.js","../src/core/effects/index.js","../src/core/MusicalDuration.js","../src/core/renderer/GestureAnimator.js","../src/core/renderer/ColorUtilities.js","../src/core/renderer/SpecialEffects.js","../src/core/renderer/EyeRenderer.js","../src/core/renderer/BreathingAnimator.js","../src/core/renderer/GradientCache.js","../src/core/renderer/GlowRenderer.js","../src/core/renderer/CoreRenderer.js","../src/core/animation/RotationBrake.js","../src/core/renderer/AmbientDanceAnimator.js","../src/core/AnimationLoopManager.js","../src/core/EmotiveRenderer.js","../src/core/GazeTracker.js","../src/core/IdleBehavior.js","../src/core/MusicTheory.js","../src/core/HarmonicSystem.js","../src/core/SoundSystem.js","../src/core/SimpleFPSCounter.js","../src/core/AnimationController.js","../src/core/AudioLevelProcessor.js","../src/core/EventManager.js","../src/core/AccessibilityManager.js","../src/core/MobileOptimization.js","../src/core/PluginSystem.js","../src/utils/browserCompatibility.js","../src/utils/debugger.js","../src/core/shapes/shapeDefinitions.js","../src/utils/ArrayPool.js","../src/core/morpher/AudioDeformer.js","../src/core/morpher/AgentBPMDetector.js","../src/core/morpher/MusicDetector.js","../src/core/morpher/TransitionManager.js","../src/core/ShapeMorpher.js","../src/core/AudioAnalyzer.js","../src/core/GestureCompatibility.js","../src/core/GrooveTemplates.js","../src/mascot/AudioHandler.js","../src/mascot/GestureController.js","../src/mascot/StateCoordinator.js","../src/mascot/VisualizationRunner.js","../src/mascot/ConfigurationManager.js","../src/EmotiveMascot.js"],"sourcesContent":["/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                      ◐ ◑ ◒ ◓  CANVAS MANAGER  ◓ ◒ ◑ ◐                      \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Canvas Manager - High-DPI Rendering & Canvas Lifecycle\n * @author Emotive Engine Team\n * @version 2.1.0\n * @module CanvasManager\n * @changelog 2.1.0 - Added resize callback system for visual resampling\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ The FOUNDATION of visual rendering. Handles canvas setup, high-DPI scaling,       \n * ║ resize events, and provides optimized 2D context for smooth animations.           \n * ║ Ensures crisp rendering on Retina displays and manages canvas lifecycle.          \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🎨 CANVAS FEATURES                                                                \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Device Pixel Ratio (DPR) scaling for Retina displays                            \n * │ • Automatic resize handling with debouncing                                       \n * │ • Resize callback system for component notification                               \n * │ • Optimized 2D context settings for animations                                    \n * │ • Center point calculation for orb positioning                                    \n * │ • Clean canvas clearing with proper scaling                                       \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ ⚡ CONTEXT OPTIMIZATIONS                                                           \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • alpha: true               - Enables transparency                                \n * │ • desynchronized: true      - Better animation performance                        \n * │ • willReadFrequently: false - We don't read pixels                                \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\nclass CanvasManager {\n    constructor(canvas) {\n        this.canvas = canvas;\n        // Get context with optimal settings for particle rendering\n        this.ctx = canvas.getContext('2d', {\n            alpha: true,\n            desynchronized: true,  // Better performance for animations\n            willReadFrequently: false  // We're not reading pixels\n        });\n        this.dpr = window.devicePixelRatio || 1;\n        this.width = 0;\n        this.height = 0;\n        this.centerX = 0;\n        this.centerY = 0;\n        \n        // Resize callbacks\n        this.resizeCallbacks = [];\n        \n        // Bind resize handler\n        this.handleResize = this.handleResize.bind(this);\n        window.addEventListener('resize', this.handleResize);\n        \n        // Initial resize\n        this.resize();\n    }\n\n    /**\n     * Handles canvas resizing with proper high-DPI support\n     */\n    resize() {\n        // Check if canvas has explicit width/height attributes\n        const hasExplicitSize = this.canvas.hasAttribute('width') && this.canvas.hasAttribute('height');\n        \n        if (hasExplicitSize) {\n            // Use the explicit canvas dimensions from attributes\n            // This prevents the canvas from changing size when DevTools opens\n            const attrWidth = parseInt(this.canvas.getAttribute('width'), 10);\n            const attrHeight = parseInt(this.canvas.getAttribute('height'), 10);\n            \n            // Use attribute dimensions as base size\n            this.width = attrWidth;\n            this.height = attrHeight;\n            \n            // Set actual canvas buffer size (no DPR scaling for fixed-size canvases)\n            this.canvas.width = attrWidth;\n            this.canvas.height = attrHeight;\n            \n            // No DPR scaling needed for fixed-size canvases\n            // The browser will handle the scaling automatically\n        } else {\n            // For responsive canvases, use the bounding rect\n            const rect = this.canvas.getBoundingClientRect();\n            \n            // Set display size (CSS pixels)\n            this.width = rect.width;\n            this.height = rect.height;\n            \n            // Set actual size in memory (scaled for high-DPI)\n            this.canvas.width = this.width * this.dpr;\n            this.canvas.height = this.height * this.dpr;\n            \n            // Scale the drawing context for high-DPI\n            this.ctx.scale(this.dpr, this.dpr);\n        }\n        \n        // Update center coordinates\n        this.centerX = this.width / 2;\n        this.centerY = this.height / 2;\n        \n        //     dpr: this.dpr,\n        //     center: { x: this.centerX, y: this.centerY }\n        // });\n        \n        // Trigger resize callbacks\n        this.resizeCallbacks.forEach(callback => {\n            try {\n                callback(this.width, this.height, this.dpr);\n            } catch (error) {\n            }\n        });\n    }\n    \n    /**\n     * Register a callback to be called on canvas resize\n     * @param {Function} callback - Function to call with (width, height, dpr) parameters\n     */\n    onResize(callback) {\n        if (typeof callback === 'function') {\n            this.resizeCallbacks.push(callback);\n        }\n    }\n\n    /**\n     * Debounced resize handler to prevent excessive resize calls\n     */\n    handleResize() {\n        clearTimeout(this.resizeTimeout);\n        this.resizeTimeout = setTimeout(() => {\n            this.resize();\n        }, 100);\n    }\n\n    /**\n     * Clears the entire canvas\n     */\n    clear() {\n        this.ctx.clearRect(0, 0, this.width, this.height);\n    }\n\n    /**\n     * Gets the center coordinates of the canvas\n     * @returns {Object} Object with x and y center coordinates\n     */\n    getCenter() {\n        return {\n            x: this.centerX,\n            y: this.centerY\n        };\n    }\n\n    /**\n     * Sets transform for drawing operations\n     * @param {number} x - X translation\n     * @param {number} y - Y translation  \n     * @param {number} scale - Scale factor\n     * @param {number} rotation - Rotation in radians\n     */\n    setTransform(x = 0, y = 0, scale = 1, rotation = 0) {\n        this.ctx.save();\n        this.ctx.translate(x, y);\n        this.ctx.rotate(rotation);\n        this.ctx.scale(scale, scale);\n    }\n\n    /**\n     * Restores the previous transform state\n     */\n    restoreTransform() {\n        this.ctx.restore();\n    }\n\n    /**\n     * Gets the 2D rendering context\n     * @returns {CanvasRenderingContext2D} The canvas 2D context\n     */\n    getContext() {\n        return this.ctx;\n    }\n\n    /**\n     * Gets canvas dimensions\n     * @returns {Object} Object with width and height\n     */\n    getDimensions() {\n        return {\n            width: this.width,\n            height: this.height\n        };\n    }\n\n    /**\n     * Cleanup method to remove event listeners\n     */\n    destroy() {\n        window.removeEventListener('resize', this.handleResize);\n        clearTimeout(this.resizeTimeout);\n    }\n}\n\nexport default CanvasManager;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                       ◐ ◑ ◒ ◓  ERROR BOUNDARY  ◓ ◒ ◑ ◐                       \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Error Boundary - Error Handling & Recovery System\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module ErrorBoundary\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The SAFETY NET of the Emotive Engine. Catches errors, provides fallbacks,         \r\n * ║ logs issues for debugging, and attempts recovery to keep the animation            \r\n * ║ running even when things go wrong. Never let the orb die!                         \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🛡️ ERROR HANDLING FEATURES                                                        \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Try-catch wrapping for all critical functions                                   \r\n * │ • Safe default values for all emotional states                                    \r\n * │ • Error logging with context and timestamps                                       \r\n * │ • Automatic error suppression after threshold                                     \r\n * │ • Recovery attempts with exponential backoff                                      \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🔄 FALLBACK VALUES                                                                \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • emotion       : 'neutral' (safe default state)                                  \r\n * │ • gesture       : null (no animation)                                             \r\n * │ • audioLevel    : 0 (silent)                                                      \r\n * │ • particleCount : 0 (no particles)                                                \r\n * │ • glowIntensity : 0.7 (moderate glow)                                             \r\n * │ • color         : '#B0B0B0' (neutral gray)                                        \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 📊 VALIDATION LISTS                                                               \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ VALID EMOTIONS:                                                                   \r\n * │   neutral, joy, sadness, anger, fear, surprise, disgust, love,                    \r\n * │   suspicion, resting, connecting, thinking, speaking, zen, focused                \r\n * │                                                                                    \r\n * │ VALID UNDERTONES:                                                                 \r\n * │   nervous, confident, tired, intense, subdued                                     \r\n * │                                                                                    \r\n * │ VALID GESTURES:                                                                    \r\n * │   bounce, pulse, shake, spin, nod, tilt, expand, contract, flash,                 \r\n * │   drift, breathe, wave, slowBlink, jump, breathHold                               \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ⚠️  ERROR THRESHOLDS                                                              \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Max errors in log      : 10 (then rotates)                                      \r\n * │ • Errors before suppress : 3 per context                                          \r\n * │ • Recovery max attempts  : 3                                                      \r\n * │ • Recovery backoff       : 100ms * 2^attempt                                      \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                           USING ERROR BOUNDARY                                    \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ // Wrap any risky function:                                                       \r\n * ║ const safeFunction = errorBoundary.wrap(riskyFunction, 'context', fallback);      \r\n * ║                                                                                    \r\n * ║ // Validate input:                                                                \r\n * ║ const validEmotion = errorBoundary.validateInput(input, 'emotion', 'neutral');    \r\n * ║                                                                                    \r\n * ║ // Attempt recovery:                                                              \r\n * ║ await errorBoundary.attemptRecovery('render', retryFn, 3);                        \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\nclass ErrorBoundary {\r\n    constructor() {\r\n        this.errors = [];\r\n        this.maxErrors = 10;\r\n        this.errorCounts = new Map();\r\n        \r\n        // Safe default values for various contexts\r\n        this.defaults = {\r\n            emotion: 'neutral',\r\n            gesture: null,\r\n            audioLevel: 0,\r\n            particleCount: 0,\r\n            glowIntensity: 0.7,\r\n            coreSize: 1.0,\r\n            breathRate: 1.0,\r\n            color: '#B0B0B0'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Wraps a function with error handling\r\n     * @param {Function} fn - Function to wrap\r\n     * @param {string} context - Context description for error logging\r\n     * @param {*} fallbackValue - Value to return on error\r\n     * @returns {Function} Wrapped function\r\n     */\r\n    wrap(fn, context, fallbackValue = null) {\r\n        return (...args) => {\r\n            try {\r\n                return fn(...args);\r\n            } catch (error) {\r\n                this.logError(error, context);\r\n                return fallbackValue !== null ? fallbackValue : this.getDefault(context);\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Logs an error with context and timestamp\r\n     * @param {Error} error - The error object\r\n     * @param {string} context - Context where the error occurred\r\n     */\r\n    logError(error, context) {\r\n        const timestamp = new Date().toISOString();\r\n        const errorEntry = {\r\n            timestamp,\r\n            context,\r\n            message: error.message,\r\n            stack: error.stack\r\n        };\r\n\r\n        // Add to error log\r\n        this.errors.push(errorEntry);\r\n        \r\n        // Maintain error count per context\r\n        const count = this.errorCounts.get(context) || 0;\r\n        this.errorCounts.set(context, count + 1);\r\n\r\n        // Rotate error log if it gets too large\r\n        if (this.errors.length > this.maxErrors) {\r\n            this.errors.shift();\r\n        }\r\n\r\n        // Log to console with appropriate level based on frequency\r\n        if (count < 3) {\r\n        } else if (count === 3) {\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a safe default value for a given context\r\n     * @param {string} context - The context to get default for\r\n     * @returns {*} Safe default value\r\n     */\r\n    getDefault(context) {\r\n        // Context-specific defaults\r\n        const contextDefaults = {\r\n            'emotion-transition': this.defaults.emotion,\r\n            'gesture-execution': this.defaults.gesture,\r\n            'audio-processing': this.defaults.audioLevel,\r\n            'particle-system': this.defaults.particleCount,\r\n            'rendering': {\r\n                glowIntensity: this.defaults.glowIntensity,\r\n                coreSize: this.defaults.coreSize,\r\n                color: this.defaults.color\r\n            },\r\n            'canvas-operations': null,\r\n            'state-management': this.defaults.emotion\r\n        };\r\n\r\n        return contextDefaults.hasOwnProperty(context) ? contextDefaults[context] : null;\r\n    }\r\n\r\n    /**\r\n     * Validates input parameters and returns safe values\r\n     * @param {*} value - Value to validate\r\n     * @param {string} type - Expected type\r\n     * @param {*} defaultValue - Default value if validation fails\r\n     * @returns {*} Validated value or default\r\n     */\r\n    validateInput(value, type, defaultValue) {\r\n        try {\r\n            switch (type) {\r\n                case 'emotion':\r\n                    const validEmotions = ['neutral', 'joy', 'sadness', 'anger', 'fear', 'surprise', 'disgust', 'love', 'euphoria'];\r\n                    return validEmotions.includes(value) ? value : defaultValue;\r\n                \r\n                case 'undertone':\r\n                    const validUndertones = ['nervous', 'confident', 'tired', 'intense', 'subdued'];\r\n                    return value === null || validUndertones.includes(value) ? value : null;\r\n                \r\n                case 'gesture':\r\n                    const validGestures = ['bounce', 'pulse', 'shake', 'spin', 'nod', 'tilt', 'expand', 'contract', 'flash', 'drift'];\r\n                    return validGestures.includes(value) ? value : defaultValue;\r\n                \r\n                case 'number':\r\n                    return typeof value === 'number' && !isNaN(value) ? value : defaultValue;\r\n                \r\n                case 'string':\r\n                    return typeof value === 'string' ? value : defaultValue;\r\n                \r\n                case 'boolean':\r\n                    return typeof value === 'boolean' ? value : defaultValue;\r\n                \r\n                default:\r\n                    return value !== undefined && value !== null ? value : defaultValue;\r\n            }\r\n        } catch (error) {\r\n            this.logError(error, 'input-validation');\r\n            return defaultValue;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks if a context has exceeded error threshold\r\n     * @param {string} context - Context to check\r\n     * @param {number} threshold - Error threshold (default: 5)\r\n     * @returns {boolean} True if threshold exceeded\r\n     */\r\n    hasExceededThreshold(context, threshold = 5) {\r\n        return (this.errorCounts.get(context) || 0) >= threshold;\r\n    }\r\n\r\n    /**\r\n     * Gets error statistics\r\n     * @returns {Object} Error statistics\r\n     */\r\n    getErrorStats() {\r\n        return {\r\n            totalErrors: this.errors.length,\r\n            errorsByContext: Object.fromEntries(this.errorCounts),\r\n            recentErrors: this.errors.slice(-5)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Clears error history\r\n     */\r\n    clearErrors() {\r\n        this.errors = [];\r\n        this.errorCounts.clear();\r\n    }\r\n\r\n    /**\r\n     * Attempts to recover from a failed operation\r\n     * @param {string} operation - The operation that failed\r\n     * @param {Function} retryFn - Function to retry\r\n     * @param {number} maxRetries - Maximum retry attempts\r\n     * @returns {Promise} Recovery attempt result\r\n     */\r\n    async attemptRecovery(operation, retryFn, maxRetries = 3) {\r\n        let attempts = 0;\r\n        \r\n        while (attempts < maxRetries) {\r\n            try {\r\n                return await retryFn();\r\n            } catch (error) {\r\n                attempts++;\r\n                this.logError(error, `recovery-${operation}-attempt-${attempts}`);\r\n                \r\n                if (attempts >= maxRetries) {\r\n                    throw new Error(`Recovery failed for ${operation} after ${maxRetries} attempts`);\r\n                }\r\n                \r\n                // Exponential backoff\r\n                await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempts) * 100));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default ErrorBoundary;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                     ◐ ◑ ◒ ◓  COLOR UTILS  ◓ ◒ ◑ ◐                     \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Color Utils - Color Interpolation & Manipulation\r\n * @author Emotive Engine Team\r\n * @version 2.1.0\r\n * @module ColorUtils\r\n * @changelog 2.1.0 - Added undertone saturation modifiers for dynamic depth\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The COLOR SCIENCE module of the engine. Provides smooth color transitions         \r\n * ║ between emotional states using HSL interpolation for perceptually uniform         \r\n * ║ transitions that feel natural and emotionally resonant.                           \r\n * ║                                                                                    \r\n * ║ NEW: Undertone saturation system creates dynamic depth by adjusting saturation    \r\n * ║ based on emotional undertones (intense → oversaturated, subdued → desaturated)    \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎨 COLOR OPERATIONS                                                               \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Hex to RGB/HSL conversion                                                       \r\n * │ • RGB to Hex/HSL conversion                                                       \r\n * │ • HSL interpolation for smooth transitions                                        \r\n * │ • Color mixing and blending                                                       \r\n * │ • Luminance calculations                                                          \r\n * │ • Perceptually uniform color shifts                                               \r\n * │ • Undertone-based saturation adjustments                                          \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🌈 UNDERTONE SATURATION SYSTEM                                                    \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ Undertones dynamically adjust color saturation to create emotional depth:         \r\n * │                                                                                    \r\n * │ • INTENSE   : +60% saturation - Electric, vibrant, overwhelming                   \r\n * │ • CONFIDENT : +30% saturation - Bold, present, assertive                          \r\n * │ • NERVOUS   : +15% saturation - Slightly heightened, anxious energy               \r\n * │ • CLEAR     :   0% saturation - Normal midtone, balanced state                    \r\n * │ • TIRED     : -20% saturation - Washed out, fading, depleted                      \r\n * │ • SUBDUED   : -50% saturation - Ghostly, barely there, withdrawn                  \r\n * │                                                                                    \r\n * │ This creates a visual hierarchy where emotional intensity directly affects        \r\n * │ the vibrancy and presence of colors, making the mascot's state immediately        \r\n * │ readable through color alone.                                                     \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\n/**\r\n * Converts hex color to RGB values\r\n * @param {string} hex - Hex color string (e.g., '#FF0000')\r\n * @returns {Object} RGB object with r, g, b properties\r\n */\r\nexport function hexToRgb(hex) {\r\n    // Remove # if present\r\n    hex = hex.replace('#', '');\r\n    \r\n    // Handle 3-digit hex\r\n    if (hex.length === 3) {\r\n        hex = hex.split('').map(char => char + char).join('');\r\n    }\r\n    \r\n    const r = parseInt(hex.substr(0, 2), 16);\r\n    const g = parseInt(hex.substr(2, 2), 16);\r\n    const b = parseInt(hex.substr(4, 2), 16);\r\n    \r\n    return { r, g, b };\r\n}\r\n\r\n/**\r\n * Converts RGB values to hex color\r\n * @param {number} r - Red component (0-255)\r\n * @param {number} g - Green component (0-255)\r\n * @param {number} b - Blue component (0-255)\r\n * @returns {string} Hex color string\r\n */\r\nexport function rgbToHex(r, g, b) {\r\n    const toHex = (component) => {\r\n        const hex = Math.round(Math.max(0, Math.min(255, component))).toString(16);\r\n        return hex.length === 1 ? '0' + hex : hex;\r\n    };\r\n    \r\n    return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\r\n}\r\n\r\n/**\r\n * Converts RGB to HSL color space\r\n * @param {number} r - Red component (0-255)\r\n * @param {number} g - Green component (0-255)\r\n * @param {number} b - Blue component (0-255)\r\n * @returns {Object} HSL object with h, s, l properties\r\n */\r\nexport function rgbToHsl(r, g, b) {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    \r\n    const max = Math.max(r, g, b);\r\n    const min = Math.min(r, g, b);\r\n    let h, s, l = (max + min) / 2;\r\n    \r\n    if (max === min) {\r\n        h = s = 0; // achromatic\r\n    } else {\r\n        const d = max - min;\r\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n        \r\n        switch (max) {\r\n            case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n            case g: h = (b - r) / d + 2; break;\r\n            case b: h = (r - g) / d + 4; break;\r\n        }\r\n        h /= 6;\r\n    }\r\n    \r\n    return { h: h * 360, s: s * 100, l: l * 100 };\r\n}\r\n\r\n/**\r\n * Converts HSL to RGB color space\r\n * @param {number} h - Hue (0-360)\r\n * @param {number} s - Saturation (0-100)\r\n * @param {number} l - Lightness (0-100)\r\n * @returns {Object} RGB object with r, g, b properties\r\n */\r\nexport function hslToRgb(h, s, l) {\r\n    h /= 360;\r\n    s /= 100;\r\n    l /= 100;\r\n    \r\n    const hue2rgb = (p, q, t) => {\r\n        if (t < 0) t += 1;\r\n        if (t > 1) t -= 1;\r\n        if (t < 1/6) return p + (q - p) * 6 * t;\r\n        if (t < 1/2) return q;\r\n        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;\r\n        return p;\r\n    };\r\n    \r\n    let r, g, b;\r\n    \r\n    if (s === 0) {\r\n        r = g = b = l; // achromatic\r\n    } else {\r\n        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n        const p = 2 * l - q;\r\n        r = hue2rgb(p, q, h + 1/3);\r\n        g = hue2rgb(p, q, h);\r\n        b = hue2rgb(p, q, h - 1/3);\r\n    }\r\n    \r\n    return {\r\n        r: Math.round(r * 255),\r\n        g: Math.round(g * 255),\r\n        b: Math.round(b * 255)\r\n    };\r\n}\r\n\r\n/**\r\n * Interpolates between two colors in RGB space\r\n * @param {string} color1 - Start color (hex)\r\n * @param {string} color2 - End color (hex)\r\n * @param {number} progress - Interpolation progress (0-1)\r\n * @returns {string} Interpolated color (hex)\r\n */\r\nexport function interpolateRgb(color1, color2, progress) {\r\n    const rgb1 = hexToRgb(color1);\r\n    const rgb2 = hexToRgb(color2);\r\n    \r\n    const r = Math.round(rgb1.r + (rgb2.r - rgb1.r) * progress);\r\n    const g = Math.round(rgb1.g + (rgb2.g - rgb1.g) * progress);\r\n    const b = Math.round(rgb1.b + (rgb2.b - rgb1.b) * progress);\r\n    \r\n    return rgbToHex(r, g, b);\r\n}\r\n\r\n/**\r\n * Interpolates between two colors in HSL space (better for emotional transitions)\r\n * @param {string} color1 - Start color (hex)\r\n * @param {string} color2 - End color (hex)\r\n * @param {number} progress - Interpolation progress (0-1)\r\n * @returns {string} Interpolated color (hex)\r\n */\r\nexport function interpolateHsl(color1, color2, progress) {\r\n    const rgb1 = hexToRgb(color1);\r\n    const rgb2 = hexToRgb(color2);\r\n    const hsl1 = rgbToHsl(rgb1.r, rgb1.g, rgb1.b);\r\n    const hsl2 = rgbToHsl(rgb2.r, rgb2.g, rgb2.b);\r\n    \r\n    // Handle hue interpolation (shortest path around color wheel)\r\n    let h1 = hsl1.h;\r\n    let h2 = hsl2.h;\r\n    let hDiff = h2 - h1;\r\n    \r\n    if (hDiff > 180) {\r\n        h2 -= 360;\r\n    } else if (hDiff < -180) {\r\n        h2 += 360;\r\n    }\r\n    \r\n    const h = h1 + (h2 - h1) * progress;\r\n    const s = hsl1.s + (hsl2.s - hsl1.s) * progress;\r\n    const l = hsl1.l + (hsl2.l - hsl1.l) * progress;\r\n    \r\n    // Normalize hue\r\n    const normalizedH = ((h % 360) + 360) % 360;\r\n    \r\n    const rgb = hslToRgb(normalizedH, s, l);\r\n    return rgbToHex(rgb.r, rgb.g, rgb.b);\r\n}\r\n\r\n/**\r\n * Creates an RGBA color string\r\n * @param {string} hex - Hex color\r\n * @param {number} alpha - Alpha value (0-1)\r\n * @returns {string} RGBA color string\r\n */\r\nexport function hexToRgba(hex, alpha = 1) {\r\n    const rgb = hexToRgb(hex);\r\n    return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha})`;\r\n}\r\n\r\n/**\r\n * Adjusts the brightness of a color\r\n * @param {string} hex - Hex color\r\n * @param {number} factor - Brightness factor (0.5 = darker, 1.5 = brighter)\r\n * @returns {string} Adjusted color (hex)\r\n */\r\nexport function adjustBrightness(hex, factor) {\r\n    const rgb = hexToRgb(hex);\r\n    const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);\r\n    \r\n    hsl.l = Math.max(0, Math.min(100, hsl.l * factor));\r\n    \r\n    const adjustedRgb = hslToRgb(hsl.h, hsl.s, hsl.l);\r\n    return rgbToHex(adjustedRgb.r, adjustedRgb.g, adjustedRgb.b);\r\n}\r\n\r\n/**\r\n * Adjusts the saturation of a color\r\n * @param {string} hex - Hex color\r\n * @param {number} factor - Saturation factor (0.5 = less saturated, 1.5 = more saturated)\r\n * @returns {string} Adjusted color (hex)\r\n */\r\nexport function adjustSaturation(hex, factor) {\r\n    const rgb = hexToRgb(hex);\r\n    const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);\r\n    \r\n    hsl.s = Math.max(0, Math.min(100, hsl.s * factor));\r\n    \r\n    const adjustedRgb = hslToRgb(hsl.h, hsl.s, hsl.l);\r\n    return rgbToHex(adjustedRgb.r, adjustedRgb.g, adjustedRgb.b);\r\n}\r\n\r\n/**\r\n * Gets the luminance of a color (for contrast calculations)\r\n * @param {string} hex - Hex color\r\n * @returns {number} Luminance value (0-1)\r\n */\r\nexport function getLuminance(hex) {\r\n    const rgb = hexToRgb(hex);\r\n    \r\n    // Convert to linear RGB\r\n    const toLinear = (component) => {\r\n        const c = component / 255;\r\n        return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);\r\n    };\r\n    \r\n    const r = toLinear(rgb.r);\r\n    const g = toLinear(rgb.g);\r\n    const b = toLinear(rgb.b);\r\n    \r\n    return 0.2126 * r + 0.7152 * g + 0.0722 * b;\r\n}\r\n\r\n/**\r\n * Calculates contrast ratio between two colors\r\n * @param {string} color1 - First color (hex)\r\n * @param {string} color2 - Second color (hex)\r\n * @returns {number} Contrast ratio (1-21)\r\n */\r\nexport function getContrastRatio(color1, color2) {\r\n    const lum1 = getLuminance(color1);\r\n    const lum2 = getLuminance(color2);\r\n    \r\n    const brightest = Math.max(lum1, lum2);\r\n    const darkest = Math.min(lum1, lum2);\r\n    \r\n    return (brightest + 0.05) / (darkest + 0.05);\r\n}\r\n\r\n/**\r\n * Undertone saturation modifiers for dynamic emotional depth\r\n * Maps undertone names to saturation adjustment factors\r\n */\r\nexport const UNDERTONE_SATURATION = {\r\n    intense: 1.6,    // +60% saturation - Electric, overwhelming\r\n    confident: 1.3,  // +30% saturation - Bold, present\r\n    nervous: 1.15,   // +15% saturation - Slightly heightened\r\n    clear: 1.0,      // No change - Normal midtone\r\n    tired: 0.8,      // -20% saturation - Washed out, fading\r\n    subdued: 0.5     // -50% saturation - Ghostly, barely there\r\n};\r\n\r\n/**\r\n * Applies undertone saturation adjustment to a color\r\n * @param {string} hex - Base color\r\n * @param {string} undertone - Undertone name (intense, confident, nervous, clear, tired, subdued)\r\n * @returns {string} Adjusted color with undertone saturation applied\r\n */\r\nexport function applyUndertoneSaturation(hex, undertone) {\r\n    if (!undertone || undertone === 'clear') {\r\n        return hex; // No adjustment for clear or missing undertone\r\n    }\r\n    \r\n    const factor = UNDERTONE_SATURATION[undertone.toLowerCase()];\r\n    if (!factor || factor === 1.0) {\r\n        return hex;\r\n    }\r\n    \r\n    return adjustSaturation(hex, factor);\r\n}\r\n\r\n/**\r\n * Applies undertone saturation to an array of colors (for particle systems)\r\n * @param {Array} colors - Array of colors (can be strings or objects with color property)\r\n * @param {string} undertone - Undertone name\r\n * @returns {Array} Adjusted color array with undertone saturation applied\r\n */\r\nexport function applyUndertoneSaturationToArray(colors, undertone) {\r\n    if (!colors || !Array.isArray(colors)) return colors;\r\n    if (!undertone || undertone === 'clear') return colors;\r\n    \r\n    return colors.map(colorItem => {\r\n        if (typeof colorItem === 'string') {\r\n            // Simple color string\r\n            return applyUndertoneSaturation(colorItem, undertone);\r\n        } else if (colorItem && typeof colorItem === 'object' && colorItem.color) {\r\n            // Weighted color object\r\n            return {\r\n                ...colorItem,\r\n                color: applyUndertoneSaturation(colorItem.color, undertone)\r\n            };\r\n        }\r\n        return colorItem;\r\n    });\r\n}\r\n\r\n/**\r\n * Gets the saturation factor for an undertone\r\n * @param {string} undertone - Undertone name\r\n * @returns {number} Saturation multiplication factor\r\n */\r\nexport function getUndertoneSaturationFactor(undertone) {\r\n    if (!undertone) return 1.0;\r\n    return UNDERTONE_SATURATION[undertone.toLowerCase()] || 1.0;\r\n}\r\n\r\n/**\r\n * Emotional color palette for the mascot system\r\n */\r\nexport const EMOTIONAL_COLORS = {\r\n    neutral: '#B0B0B0',\r\n    joy: '#FFD700',\r\n    sadness: '#4169E1',\r\n    anger: '#DC143C',\r\n    fear: '#8B008B',\r\n    surprise: '#FF8C00',\r\n    disgust: '#9ACD32',\r\n    love: '#FF69B4'\r\n};\r\n\r\n/**\r\n * Gets RGB values for emotional colors (for performance)\r\n */\r\nexport const EMOTIONAL_COLORS_RGB = Object.fromEntries(\r\n    Object.entries(EMOTIONAL_COLORS).map(([emotion, hex]) => {\r\n        const rgb = hexToRgb(hex);\r\n        return [emotion, `${rgb.r}, ${rgb.g}, ${rgb.b}`];\r\n    })\r\n);","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                       ◐ ◑ ◒ ◓  EASING  ◓ ◒ ◑ ◐                       \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Easing Functions - Smooth Animation Transitions\n * @author Emotive Engine Team\n * @version 2.0.0\n * @module Easing\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ The MOTION MATHEMATICS of the engine. Provides easing functions that create       \n * ║ natural, organic movement patterns for emotional transitions and gestures,         \n * ║ making the mascot feel alive and responsive rather than mechanical.               \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🎢 EASING CURVES                                                                  \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Linear: Constant speed, no acceleration                                         \n * │ • Quadratic: Gentle acceleration/deceleration                                     \n * │ • Cubic: Moderate acceleration/deceleration                                       \n * │ • Elastic: Spring-like overshoot and bounce                                       \n * │ • Bounce: Realistic bouncing effect                                               \n * │ • Custom: Apply any easing by name                                                \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\n\n/**\n * Linear easing - no acceleration\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function linear(t) {\n    return t;\n}\n\n/**\n * Ease out quadratic - decelerating to zero velocity\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeOutQuad(t) {\n    return t * (2 - t);\n}\n\n/**\n * Ease in quadratic - accelerating from zero velocity\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeInQuad(t) {\n    return t * t;\n}\n\n/**\n * Ease in-out quadratic - acceleration until halfway, then deceleration\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeInOutQuad(t) {\n    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n}\n\n/**\n * Ease out cubic - decelerating to zero velocity (smoother than quad)\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeOutCubic(t) {\n    return 1 - Math.pow(1 - t, 3);\n}\n\n/**\n * Ease in cubic - accelerating from zero velocity\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeInCubic(t) {\n    return t * t * t;\n}\n\n/**\n * Ease in-out cubic - acceleration until halfway, then deceleration\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeInOutCubic(t) {\n    return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;\n}\n\n/**\n * Ease out elastic - elastic snap effect\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeOutElastic(t) {\n    const c4 = (2 * Math.PI) / 3;\n    return t === 0 ? 0 : t === 1 ? 1 : Math.pow(2, -10 * t) * Math.sin((t * 10 - 0.75) * c4) + 1;\n}\n\n/**\n * Ease out bounce - bouncing effect\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeOutBounce(t) {\n    const n1 = 7.5625;\n    const d1 = 2.75;\n\n    if (t < 1 / d1) {\n        return n1 * t * t;\n    } else if (t < 2 / d1) {\n        return n1 * (t -= 1.5 / d1) * t + 0.75;\n    } else if (t < 2.5 / d1) {\n        return n1 * (t -= 2.25 / d1) * t + 0.9375;\n    } else {\n        return n1 * (t -= 2.625 / d1) * t + 0.984375;\n    }\n}\n\n/**\n * Ease in-out back - slight overshoot effect\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeInOutBack(t) {\n    const c1 = 1.70158;\n    const c2 = c1 * 1.525;\n\n    return t < 0.5\n        ? (Math.pow(2 * t, 2) * ((c2 + 1) * 2 * t - c2)) / 2\n        : (Math.pow(2 * t - 2, 2) * ((c2 + 1) * (t * 2 - 2) + c2) + 2) / 2;\n}\n\n/**\n * Ease out sine - sinusoidal easing\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeOutSine(t) {\n    return Math.sin((t * Math.PI) / 2);\n}\n\n/**\n * Ease in-out sine - sinusoidal easing with smooth start and end\n * @param {number} t - Progress (0 to 1)\n * @returns {number} Eased value\n */\nexport function easeInOutSine(t) {\n    return -(Math.cos(Math.PI * t) - 1) / 2;\n}\n\n/**\n * Gets an easing function by name\n * @param {string} name - Name of the easing function\n * @returns {Function} Easing function\n */\nexport function getEasingFunction(name) {\n    const easingFunctions = {\n        linear,\n        easeOutQuad,\n        easeInQuad,\n        easeInOutQuad,\n        easeOutCubic,\n        easeInCubic,\n        easeInOutCubic,\n        easeOutElastic,\n        easeOutBounce,\n        easeInOutBack,\n        easeOutSine,\n        easeInOutSine\n    };\n\n    return easingFunctions[name] || linear;\n}\n\n/**\n * Applies easing to a value between start and end\n * @param {number} progress - Progress (0 to 1)\n * @param {number} start - Start value\n * @param {number} end - End value\n * @param {string|Function} easing - Easing function name or function\n * @returns {number} Eased value between start and end\n */\nexport function applyEasing(progress, start, end, easing = 'linear') {\n    const easingFn = typeof easing === 'string' ? getEasingFunction(easing) : easing;\n    const easedProgress = easingFn(Math.max(0, Math.min(1, progress)));\n    return start + (end - start) * easedProgress;\n}","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE v4.0 - Emotion Plugin Adapter\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Bridge between plugin system and emotion registry\n * @author Emotive Engine Team\n * @version 4.0.0\n * @module emotions/plugin-adapter\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Adapter for dynamic emotion registration from plugins.                            \n * ║ • Maintains separate registry for plugin emotions                                 \n * ║ • Validates emotion definitions for required properties                           \n * ║ • Provides legacy format conversion for older plugins                             \n * ║ • Enables runtime registration and unregistration                                 \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n */\n\n/**\n * Plugin emotion registry\n */\nconst pluginEmotions = new Map();\n\n/**\n * Register a plugin emotion\n * @param {string} name - Emotion name\n * @param {Object} emotionDef - Emotion definition object\n */\nexport function registerPluginEmotion(name, emotionDef) {\n    // Ensure emotion has required properties\n    if (!emotionDef.color) {\n        return false;\n    }\n    \n    // Add name if not present\n    if (!emotionDef.name) {\n        emotionDef.name = name;\n    }\n    \n    // Ensure visual and modifiers exist\n    if (!emotionDef.visual) {\n        emotionDef.visual = {\n            primaryColor: emotionDef.color,\n            particleCount: emotionDef.particleCount || 15,\n            particleSize: emotionDef.particleSize || { min: 2, max: 6 }\n        };\n    }\n    \n    if (!emotionDef.modifiers) {\n        emotionDef.modifiers = {\n            speed: 1.0,\n            amplitude: 1.0,\n            intensity: 1.0\n        };\n    }\n    \n    pluginEmotions.set(name, emotionDef);\n    \n    if (typeof window !== 'undefined' && window.DEBUG_EMOTIONS) {\n    }\n    \n    return true;\n}\n\n/**\n * Unregister a plugin emotion\n * @param {string} name - Emotion name to remove\n */\nexport function unregisterPluginEmotion(name) {\n    if (pluginEmotions.has(name)) {\n        pluginEmotions.delete(name);\n        \n        if (typeof window !== 'undefined' && window.DEBUG_EMOTIONS) {\n        }\n        \n        return true;\n    }\n    return false;\n}\n\n/**\n * Get a plugin emotion by name\n * @param {string} name - Emotion name\n * @returns {Object|null} Emotion object or null if not found\n */\nexport function getPluginEmotion(name) {\n    return pluginEmotions.get(name) || null;\n}\n\n/**\n * Get all plugin emotion names\n * @returns {Array<string>} Array of emotion names\n */\nexport function getAllPluginEmotions() {\n    return Array.from(pluginEmotions.keys());\n}\n\n/**\n * Clear all plugin emotions\n */\nexport function clearPluginEmotions() {\n    pluginEmotions.clear();\n}\n\n/**\n * Convert legacy plugin emotion format to new format\n * @param {Object} legacyEmotion - Old format emotion\n * @returns {Object} New format emotion\n */\nexport function createLegacyAdapter(legacyEmotion) {\n    return {\n        name: legacyEmotion.name || 'unknown',\n        emoji: legacyEmotion.emoji || '🔌',\n        color: legacyEmotion.primaryColor || legacyEmotion.color || '#7B68EE',\n        energy: legacyEmotion.energy || 'medium',\n        \n        visual: {\n            primaryColor: legacyEmotion.primaryColor || legacyEmotion.color || '#7B68EE',\n            secondaryColor: legacyEmotion.secondaryColor,\n            particleCount: legacyEmotion.particleCount || legacyEmotion.particleRate || 15,\n            particleSize: legacyEmotion.particleSize || { min: 2, max: 6 },\n            glowIntensity: legacyEmotion.glowIntensity || 0.5,\n            trailLength: legacyEmotion.trailLength || 5,\n            pulseRate: legacyEmotion.pulseRate || legacyEmotion.breathRate || 1.0\n        },\n        \n        particles: {\n            behavior: legacyEmotion.particleBehavior || 'ambient',\n            density: legacyEmotion.particleDensity || 'medium',\n            speed: legacyEmotion.particleSpeed || 'normal'\n        },\n        \n        modifiers: {\n            speed: legacyEmotion.speedMultiplier || 1.0,\n            amplitude: legacyEmotion.amplitudeMultiplier || 1.0,\n            intensity: legacyEmotion.intensityMultiplier || 1.0,\n            smoothness: legacyEmotion.smoothnessMultiplier || 1.0\n        },\n        \n        gestures: legacyEmotion.gestures || [],\n        transitions: legacyEmotion.transitions || {}\n    };\n}\n\n// Export adapter interface\nexport default {\n    registerPluginEmotion,\n    unregisterPluginEmotion,\n    getPluginEmotion,\n    getAllPluginEmotions,\n    clearPluginEmotions,\n    createLegacyAdapter\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Suspicion Emotion\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'suspicion',\r\n    emoji: '🤨',\r\n    description: 'Paranoid watchfulness with surveillance scanning',\r\n    \r\n    // Visual properties\r\n    visual: {\r\n        glowColor: '#6B46C1',       // Deep purple paranoia\r\n        glowIntensity: 0.85,        // Watchful glow that intensifies with threat\r\n        particleRate: 18,           // Increased surveillance particles\r\n        minParticles: 6,            // More eyes watching\r\n        maxParticles: 12,           // Heightened alert capacity\r\n        particleBehavior: 'surveillance',  // NEW: Searchlight scanning behavior\r\n        particleSpeed: 0.2,         // Base particle speed\r\n        breathRate: 0.6,            // Slower, more deliberate breathing\r\n        breathDepth: 0.04,          // Very shallow, tense breaths\r\n        coreJitter: 0.02,           // Slight nervous tremor\r\n        particleColors: [\r\n            { color: '#6B46C1', weight: 30 },  // Deep purple paranoia\r\n            { color: '#4A5568', weight: 25 },  // Shadowy slate gray\r\n            { color: '#8B4789', weight: 20 },  // Dark magenta mystery\r\n            { color: '#9F7AEA', weight: 15 },  // Alert purple highlights\r\n            { color: '#2D3748', weight: 10 }   // Deep shadow lurking\r\n        ],\r\n        // Dynamic threat level properties\r\n        threatLevel: 0,             // 0-1 scale, updated by gaze distance\r\n        getGlowIntensity: function() {\r\n            return 0.3 + (this.threatLevel * 0.7);\r\n        },\r\n        getParticleSpeed: function() {\r\n            return 0.2 + (this.threatLevel * 0.8);\r\n        },\r\n        getGlowColor: function() {\r\n            // Color shifts from purple to red as threat increases\r\n            const baseColor = { r: 107, g: 70, b: 193 };  // #6B46C1\r\n            const alertColor = { r: 220, g: 38, b: 127 }; // #DC267F (magenta-red)\r\n            \r\n            const t = this.threatLevel || 0;\r\n            \r\n            const r = Math.round(baseColor.r + (alertColor.r - baseColor.r) * t);\r\n            const g = Math.round(baseColor.g + (alertColor.g - baseColor.g) * t);\r\n            const b = Math.round(baseColor.b + (alertColor.b - baseColor.b) * t);\r\n            \r\n            // Convert to hex\r\n            const toHex = (val) => val.toString(16).padStart(2, '0');\r\n            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\r\n        }\r\n    },\r\n    \r\n    // Gesture modifiers\r\n    modifiers: {\r\n        speed: 0.4,         // Slower, more deliberate movements\r\n        amplitude: 0.6,     // Smaller, controlled movements\r\n        intensity: 1.2,     // Higher alertness\r\n        smoothness: 0.3,    // Jerky, paranoid movements\r\n        regularity: 0.2,    // Highly unpredictable patterns\r\n        focus: 1.5,         // Hyper-focused attention\r\n        addWobble: true     // Uncertain, questioning motion\r\n    },\r\n    \r\n    // Typical gestures for suspicion\r\n    typicalGestures: ['scan', 'twitch', 'peek', 'tilt', 'hold'],\r\n    \r\n    // Transition configuration\r\n    transitions: { \r\n        duration: 500,       // Moderate alertness shift\r\n        easing: 'linear',   // Steady, controlled transition\r\n        priority: 4         // Mid-level alert priority\r\n    },\r\n    \r\n    // Special suspicion properties\r\n    special: {\r\n        coreSquint: 0.6,        // More pronounced eye narrowing\r\n        scanInterval: 2000,     // More frequent scans\r\n        scanDuration: 1200,     // Longer, more thorough scanning\r\n        scanAngle: 60,          // Wider scanning range\r\n        twitchChance: 0.02,     // 2% chance per frame to twitch\r\n        peekInterval: 4000,     // Time between peek gestures\r\n        maxThreatDistance: 300, // Distance for threat calculation\r\n        alertThreshold: 0.7     // Threat level for maximum alert\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Glitch Emotion\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'glitch',\r\n    emoji: '⚡',\r\n    description: 'Digital distortion with erratic particle stutters',\r\n    \r\n    // Visual properties\r\n    visual: {\r\n        primaryColor: '#00FFAA',    // Bright digital cyan-green\r\n        glowColor: '#00FFAA',       // Bright digital cyan-green\r\n        glowIntensity: 2.2,         // Intense, flickering energy\r\n        particleRate: 30,           // High rate for glitchy effect\r\n        minParticles: 12,           // Constant digital noise\r\n        maxParticles: 20,           // Maximum chaos\r\n        particleBehavior: 'glitchy', // New glitch behavior\r\n        particleSpeed: 1.5,         // Fast, erratic speeds\r\n        breathRate: 0.3,            // Rapid, stuttering breaths\r\n        breathDepth: 0.08,          // Shallow, digital hiccups\r\n        coreJitter: 0.04,           // Constant digital tremor\r\n        coreSize: 1.1,              // Slightly enlarged core\r\n        eyeOpenness: 1.0,           // Wide open eyes\r\n        particleColors: [\r\n            { color: '#00FFAA', weight: 25 },  // Bright cyan-green\r\n            { color: '#FF00AA', weight: 20 },  // Hot magenta\r\n            { color: '#00FF00', weight: 15 },  // Pure digital green\r\n            { color: '#FF0099', weight: 15 },  // Neon pink\r\n            { color: '#00FFFF', weight: 10 },  // Electric cyan\r\n            { color: '#FFAA00', weight: 8 },   // Digital amber warning\r\n            { color: '#FF00FF', weight: 5 },   // Pure magenta glitch\r\n            { color: '#FFFFFF', weight: 2 }    // Rare white static\r\n        ],\r\n        // Glitch-specific properties\r\n        glitchIntensity: 0.8,      // How intense the glitching is\r\n        flickerChance: 0.05,       // 5% chance per frame to flicker\r\n        rgbShift: true,            // Enable RGB channel separation\r\n        digitalNoise: true,        // Add digital noise pattern\r\n        getGlowIntensity: function() {\r\n            // Random intensity flickers\r\n            if (Math.random() < this.flickerChance) {\r\n                return 0.2 + Math.random() * 2.5;\r\n            }\r\n            return this.glowIntensity;\r\n        },\r\n        getGlowColor: function() {\r\n            // Occasionally shift to random glitch colors\r\n            if (Math.random() < 0.02) {\r\n                const glitchColors = ['#FF00AA', '#00FFFF', '#FF0099', '#00FFAA', '#FFAA00'];\r\n                return glitchColors[Math.floor(Math.random() * glitchColors.length)];\r\n            }\r\n            return this.glowColor;\r\n        }\r\n    },\r\n    \r\n    // Gesture modifiers\r\n    modifiers: {\r\n        speed: 2.0,         // Hyper-speed movements\r\n        amplitude: 0.8,     // Constrained but erratic\r\n        intensity: 1.8,     // High energy bursts\r\n        smoothness: 0.1,    // Extremely jerky, stuttering motion\r\n        regularity: 0.1,    // Completely unpredictable\r\n        focus: 0.5,         // Scattered, unfocused\r\n        addGlitch: true,    // Special glitch modifier\r\n        addStutter: true    // Stuttering motion effect\r\n    },\r\n    \r\n    // Typical gestures for glitch\r\n    typicalGestures: ['twitch', 'jitter', 'breathe', 'pulse', 'shake', 'flicker'],\r\n    \r\n    // Transition configuration\r\n    transitions: { \r\n        duration: 100,          // Instant, jarring transitions\r\n        easing: 'linear',       // No smoothing - digital snap\r\n        priority: 7,            // High priority disruption\r\n        glitchIn: true          // Special glitch transition effect\r\n    },\r\n    \r\n    // Special glitch properties\r\n    special: {\r\n        stutterInterval: 50,        // Stutter every 50ms\r\n        stutterDuration: 20,        // Each stutter lasts 20ms\r\n        rgbOffset: 3,               // Pixel offset for RGB separation\r\n        scanlineEffect: true,       // Add CRT scanlines\r\n        datamoshChance: 0.01,       // 1% chance to datamosh\r\n        corruptionZones: 3,         // Number of corruption areas\r\n        digitalTearHeight: 10       // Height of digital tears\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Calm Emotion\r\n *  └─○═╝\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Calm emotional state - serene and peaceful\r\n * @author Emotive Engine Team\r\n * @module emotions/states/calm\r\n */\r\n\r\n/**\r\n * Calm emotion configuration\r\n * A state of deep tranquility and inner peace\r\n */\r\nexport default {\r\n    name: 'calm',\r\n    emoji: '😌',\r\n    description: 'Serene, peaceful state with gentle movements',\r\n\r\n    // Visual properties\r\n    visual: {\r\n        glowColor: '#66D9CC',        // Bright mint/turquoise (more distinct from neutral blue)\r\n        glowIntensity: 0.6,          // Softer glow than neutral\r\n        particleRate: 25,            // Steady, peaceful emission like sadness\r\n        minParticles: 8,             // Keep some particles always\r\n        maxParticles: 25,            // Allow more particles like sadness\r\n        particleBehavior: 'zen',     // Zen orbital behavior\r\n        breathRate: 0.4,             // Much slower breathing than neutral (1.0)\r\n        breathDepth: 0.12,           // Deeper breaths than neutral (0.08)\r\n        coreJitter: false,           // Perfectly still core\r\n        particleColors: [\r\n            { color: '#66D9CC', weight: 35 },  // Bright turquoise\r\n            { color: '#99E6D9', weight: 25 },  // Light mint\r\n            { color: '#40BFB3', weight: 20 },  // Medium teal\r\n            { color: '#B3F2E6', weight: 15 },  // Pale mint\r\n            { color: '#339980', weight: 5 }    // Deep teal shadow\r\n        ]\r\n    },\r\n\r\n    // Gesture modifiers\r\n    modifiers: {\r\n        speed: 0.5,         // Much slower than neutral (1.0)\r\n        amplitude: 0.3,     // Significantly reduced motion range\r\n        intensity: 0.4,     // Very gentle force level\r\n        smoothness: 2.0,    // Much smoother than neutral\r\n        regularity: 1.5,    // More consistent patterns\r\n        addWeight: false,   // Light, floating feeling\r\n        floatHeight: 0.2,   // Minimal floating height\r\n        swayAmount: 0.15,   // Very minimal side-to-side sway\r\n        duration: 1.5       // Extend gesture duration\r\n    },\r\n\r\n    // Typical gestures for this emotion\r\n    typicalGestures: [\r\n        'breathe',   // Deep, slow breathing\r\n        'float',     // Gentle floating\r\n        'drift',     // Slow drifting\r\n        'idle'       // Peaceful idle state\r\n    ],\r\n\r\n    // Transition hints\r\n    transitions: {\r\n        duration: 800,           // Slower transition into calm\r\n        easing: 'easeInOutSine', // Very smooth sine curve\r\n        priority: 1              // Low-medium priority\r\n    },\r\n\r\n    // Audio/sound associations\r\n    audio: {\r\n        ambientSound: 'soft_waves',  // Gentle ambient sounds\r\n        transitionSound: null,        // No harsh transition\r\n        gestureSound: null,           // Silent gestures\r\n        volumeModifier: 0.5           // Quieter overall\r\n    },\r\n\r\n    // Particle spawn patterns\r\n    particleSpawn: {\r\n        pattern: 'center_drift',  // Spawn from center, drift outward\r\n        frequency: 'slow',        // Very slow spawn rate\r\n        burstOnEntry: false,      // No burst when entering\r\n        fadeOnExit: true,         // Gentle fade when leaving\r\n        spawnRadius: 0.3,         // Spawn close to center\r\n        driftSpeed: 0.2           // Very slow particle drift\r\n    },\r\n\r\n    // Eye/core appearance\r\n    coreAppearance: {\r\n        pupilSize: 0.9,           // Slightly relaxed pupils\r\n        irisPattern: 'soft',       // Softer iris edges\r\n        blinkRate: 'slow',        // Slower, relaxed blinking\r\n        lookDirection: 'soft_center', // Soft focus, not sharp\r\n        eyeOpenness: 0.85         // Slightly droopy, relaxed eyes\r\n    },\r\n\r\n    // Movement patterns\r\n    movement: {\r\n        floatPattern: 'sine_slow',     // Slow sine wave floating\r\n        floatPeriod: 6000,              // 6 second float cycle\r\n        floatAmplitude: 8,              // 8 pixel vertical range\r\n        swayPattern: 'gentle',          // Gentle side sway\r\n        swayPeriod: 8000,               // 8 second sway cycle\r\n        swayAmplitude: 5,               // 5 pixel horizontal range\r\n        microMovements: false           // No jittery movements\r\n    },\r\n\r\n    /**\r\n     * Get core rendering parameters\r\n     * @param {Object} state - Current renderer state\r\n     * @returns {Object} Core rendering configuration\r\n     */\r\n    getCoreParams: function(state) {\r\n        const time = state.time || Date.now();\r\n        const breathPhase = Math.sin(time * 0.0006) * 0.5 + 0.5; // Very slow breathing\r\n\r\n        return {\r\n            scaleX: 1.0 - (breathPhase * 0.02),  // Very subtle breathing scale\r\n            scaleY: 1.0 - (breathPhase * 0.02),\r\n            eyeOpenness: 0.85,                   // Relaxed eyes\r\n            eyeExpression: 'serene',             // New serene expression\r\n            pupilOffset: {\r\n                x: Math.sin(time * 0.0003) * 2,  // Slow, minimal eye movement\r\n                y: Math.cos(time * 0.0004) * 1\r\n            },\r\n            glowPulse: 0.95 + (breathPhase * 0.05)  // Very subtle glow pulse\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Optional: Custom particle behavior for calm state\r\n     * @param {Object} particle - Particle to update\r\n     * @param {number} deltaTime - Time since last update\r\n     */\r\n    updateParticle: function(particle, deltaTime) {\r\n        // Super slow drift\r\n        particle.x += Math.sin(particle.life * 0.001) * 0.1;\r\n        particle.y -= deltaTime * 0.02; // Very slow rise\r\n\r\n        // Gentle fade based on life\r\n        particle.opacity = Math.sin(particle.life * 0.002) * 0.3 + 0.2;\r\n\r\n        // Slow size pulse\r\n        particle.size = particle.baseSize * (1 + Math.sin(particle.life * 0.001) * 0.2);\r\n    },\r\n\r\n    /**\r\n     * Optional: Custom core rendering\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     * @returns {boolean} True if custom rendering was done\r\n     */\r\n    renderCore: function(ctx, x, y, radius) {\r\n        // Return false to use default rendering with parameters\r\n        return false;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE v4.0 - Emotion Registry\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Central emotion registry with full plugin support\r\n * @author Emotive Engine Team\r\n * @version 4.0.0\r\n * @module emotions\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Central registry for modular emotion system with plugin adapter integration.\r\n * ║ • Core emotions are loaded synchronously at startup\r\n * ║ • Plugin emotions can be registered dynamically via adapter\r\n * ║ • Each emotion is self-contained with visual, gesture, and transition data\r\n * ║ • Value-agnostic design allows easy tuning without code changes\r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nimport pluginAdapter from './plugin-adapter.js';\r\n\r\n// Import all emotion modules\r\nimport neutral from './states/neutral.js';\r\nimport joy from './states/joy.js';\r\nimport sadness from './states/sadness.js';\r\nimport anger from './states/anger.js';\r\nimport fear from './states/fear.js';\r\nimport surprise from './states/surprise.js';\r\nimport disgust from './states/disgust.js';\r\nimport love from './states/love.js';\r\nimport suspicion from './states/suspicion.js';\r\nimport excited from './states/excited.js';\r\nimport resting from './states/resting.js';\r\nimport euphoria from './states/euphoria.js';\r\nimport focused from './states/focused.js';\r\nimport glitch from './states/glitch.js';\r\nimport calm from './states/calm.js';\r\n\r\n// Registry to store all registered emotions\r\nconst emotionRegistry = new Map();\r\n\r\n// Emotion aliases for compatibility\r\nconst emotionAliases = {\r\n    'happy': 'joy',\r\n    'peaceful': 'calm',\r\n    'curious': 'surprise',\r\n    'frustrated': 'anger',\r\n    'sad': 'sadness'\r\n};\r\n\r\n// Register all emotions SYNCHRONOUSLY\r\n[neutral, joy, sadness, anger, fear, surprise, disgust,\r\n love, suspicion, excited, resting, euphoria, focused, glitch, calm].forEach(emotion => {\r\n    if (emotion && emotion.name) {\r\n        emotionRegistry.set(emotion.name, emotion);\r\n    }\r\n});\r\n\r\n\r\n/**\r\n * Register an emotion module\r\n * @param {Object} emotionModule - The emotion module to register\r\n */\r\nexport function registerEmotion(emotionModule) {\r\n    if (!emotionModule.name) {\r\n        return;\r\n    }\r\n    emotionRegistry.set(emotionModule.name, emotionModule);\r\n}\r\n\r\n/**\r\n * Get emotion configuration by name (checks both core and plugin emotions)\r\n * @param {string} emotionName - Name of the emotion (or alias)\r\n * @returns {Object|null} The emotion configuration or null if not found\r\n */\r\nexport function getEmotion(emotionName) {\r\n    // Check aliases first\r\n    const resolvedName = emotionAliases[emotionName] || emotionName;\r\n\r\n    // Check core emotions\r\n    const coreEmotion = emotionRegistry.get(resolvedName);\r\n    if (coreEmotion) {\r\n        return coreEmotion;\r\n    }\r\n\r\n    // Check plugin emotions\r\n    const pluginEmotion = pluginAdapter.getPluginEmotion(resolvedName);\r\n    if (pluginEmotion) {\r\n        return pluginEmotion;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n/**\r\n * Get emotion parameters (visual properties) with dynamic evaluation\r\n * @param {string} emotionName - Name of the emotion\r\n * @returns {Object} Visual parameters for the emotion\r\n */\r\nexport function getEmotionVisualParams(emotionName) {\r\n    const emotion = getEmotion(emotionName);\r\n    if (!emotion) {\r\n        return getEmotion('neutral').visual;\r\n    }\r\n\r\n    // Make sure visual exists\r\n    if (!emotion.visual) {\r\n        return {};\r\n    }\r\n    \r\n    // Create a copy of visual properties, excluding functions\r\n    const visual = emotion.visual;\r\n    const params = {};\r\n    \r\n    // Copy non-function properties\r\n    for (const key in visual) {\r\n        if (typeof visual[key] !== 'function') {\r\n            params[key] = visual[key];\r\n        }\r\n    }\r\n    \r\n    // Evaluate dynamic functions if they exist and override static values\r\n    if (typeof visual.getGlowIntensity === 'function') {\r\n        params.glowIntensity = visual.getGlowIntensity.call(visual);\r\n    }\r\n    \r\n    if (typeof visual.getParticleSpeed === 'function') {\r\n        params.particleSpeed = visual.getParticleSpeed.call(visual);\r\n    }\r\n    \r\n    if (typeof visual.getParticleRate === 'function') {\r\n        params.particleRate = visual.getParticleRate.call(visual);\r\n    }\r\n    \r\n    if (typeof visual.getGlowColor === 'function') {\r\n        params.glowColor = visual.getGlowColor.call(visual);\r\n    }\r\n    \r\n    return params;\r\n}\r\n\r\n/**\r\n * Get emotion modifiers (gesture adjustments)\r\n * @param {string} emotionName - Name of the emotion\r\n * @returns {Object} Gesture modifiers for the emotion\r\n */\r\nexport function getEmotionModifiers(emotionName) {\r\n    const emotion = getEmotion(emotionName);\r\n    if (!emotion) {\r\n        return getEmotion('neutral').modifiers;\r\n    }\r\n    return emotion.modifiers;\r\n}\r\n\r\n/**\r\n * Get list of available emotions (core and plugin)\r\n * @returns {Array<string>} List of emotion names\r\n */\r\nexport function listEmotions() {\r\n    const coreEmotions = Array.from(emotionRegistry.keys());\r\n    const pluginEmotions = pluginAdapter.getAllPluginEmotions();\r\n    return [...coreEmotions, ...pluginEmotions];\r\n}\r\n\r\n/**\r\n * Get all emotion configurations\r\n * @returns {Object} Object mapping emotion names to configurations\r\n */\r\nexport function getAllEmotions() {\r\n    const emotions = {};\r\n    emotionRegistry.forEach((value, key) => {\r\n        emotions[key] = value;\r\n    });\r\n    return emotions;\r\n}\r\n\r\n/**\r\n * Check if an emotion exists (checks both core and plugin)\r\n * @param {string} emotionName - Name of the emotion to check\r\n * @returns {boolean} True if emotion exists\r\n */\r\nexport function hasEmotion(emotionName) {\r\n    const resolvedName = emotionAliases[emotionName] || emotionName;\r\n    return emotionRegistry.has(resolvedName) || pluginAdapter.getPluginEmotion(resolvedName) !== null;\r\n}\r\n\r\n/**\r\n * Add an emotion alias\r\n * @param {string} alias - The alias name\r\n * @param {string} emotionName - The actual emotion name\r\n */\r\nexport function addEmotionAlias(alias, emotionName) {\r\n    emotionAliases[alias] = emotionName;\r\n}\r\n\r\n/**\r\n * Get emotion transition parameters\r\n * @param {string} fromEmotion - Starting emotion\r\n * @param {string} toEmotion - Target emotion\r\n * @returns {Object} Transition parameters\r\n */\r\nexport function getTransitionParams(fromEmotion, toEmotion) {\r\n    const from = getEmotion(fromEmotion);\r\n    const to = getEmotion(toEmotion);\r\n    \r\n    if (!from || !to) {\r\n        return {\r\n            duration: 1000,\r\n            easing: 'ease-in-out'\r\n        };\r\n    }\r\n    \r\n    // Check if 'to' emotion has specific transition hints\r\n    if (to.transitions && to.transitions[fromEmotion]) {\r\n        return to.transitions[fromEmotion];\r\n    }\r\n    \r\n    // Use default transition\r\n    return {\r\n        duration: 1000,\r\n        easing: 'ease-in-out',\r\n        gesture: to.transitions?.defaultGesture || null\r\n    };\r\n}\r\n\r\n/**\r\n * Get typical gestures for an emotion\r\n * @param {string} emotionName - Name of the emotion\r\n * @returns {Array<string>} List of typical gesture names\r\n */\r\nexport function getEmotionGestures(emotionName) {\r\n    const emotion = getEmotion(emotionName);\r\n    return emotion?.gestures || [];\r\n}\r\n\r\n// Debug utilities can be imported directly if needed\r\n// No longer polluting global scope\r\n\r\n// Export plugin adapter for external use\r\nexport { pluginAdapter };\r\n\r\n// Export everything\r\nexport default {\r\n    registerEmotion,\r\n    getEmotion,\r\n    getEmotionVisualParams,\r\n    getEmotionParams: getEmotionVisualParams, // Alias for compatibility\r\n    getEmotionModifiers,\r\n    listEmotions,\r\n    getAllEmotions,\r\n    hasEmotion,\r\n    addEmotionAlias,\r\n    getTransitionParams,\r\n    getEmotionGestures,\r\n    pluginAdapter\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Neutral Emotion\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Neutral emotional state - calm baseline\r\n * @author Emotive Engine Team\r\n * @module emotions/states/neutral\r\n */\r\n\r\n/**\r\n * Neutral emotion configuration\r\n * The default calm state, baseline for all other emotions\r\n */\r\nexport default {\r\n    name: 'neutral',\r\n    emoji: '😐',\r\n    description: 'Calm, balanced emotional state',\r\n    \r\n    // Visual properties\r\n    visual: {\r\n        glowColor: '#00BCD4',        // Cyan baseline (more modern)\r\n        glowIntensity: 0.9,          // Slightly softer glow\r\n        particleRate: 2,              // Minimal particle generation\r\n        minParticles: 8,             // Baseline particle presence\r\n        maxParticles: 10,            // Limited particle count\r\n        particleBehavior: 'ambient', // Gentle floating behavior\r\n        breathRate: 1.0,             // Normal, relaxed breathing\r\n        breathDepth: 0.08,           // Subtle breath variation\r\n        coreJitter: false,           // Stable, still core\r\n        particleColors: [\r\n            { color: '#00BCD4', weight: 25 },  // Primary cyan\r\n            { color: '#00ACC1', weight: 20 },  // Darker cyan\r\n            { color: '#26C6DA', weight: 15 },  // Light cyan\r\n            { color: '#B2EBF2', weight: 15 },  // Pale cyan highlight\r\n            { color: '#0097A7', weight: 10 },  // Deep cyan shadow\r\n            { color: '#80DEEA', weight: 10 },  // Cyan light\r\n            { color: '#E0F7FA', weight: 5 }    // Very pale cyan\r\n        ]\r\n    },\r\n    \r\n    // Gesture modifiers\r\n    modifiers: {\r\n        speed: 1.0,        // Baseline movement speed\r\n        amplitude: 1.0,    // Standard motion range\r\n        intensity: 1.0,    // Default force level\r\n        smoothness: 1.0,   // Natural motion flow\r\n        regularity: 1.0    // Consistent patterns\r\n    },\r\n    \r\n    // Typical gestures for this emotion\r\n    typicalGestures: [\r\n        'breathe',   // Calm breathing\r\n        'float',     // Gentle floating\r\n        'idle',      // Idle animation\r\n        'blink'      // Occasional blinks\r\n    ],\r\n    \r\n    // Transition hints\r\n    transitions: {\r\n        duration: 500,      // Standard transition duration\r\n        easing: 'easeInOut', // Balanced transition curve\r\n        priority: 0         // Baseline priority level\r\n    },\r\n    \r\n    // Audio/sound associations (optional)\r\n    audio: {\r\n        ambientSound: null,     // No specific ambient sound\r\n        transitionSound: null,  // No transition sound\r\n        gestureSound: null      // No gesture sound\r\n    },\r\n    \r\n    // Particle spawn patterns\r\n    particleSpawn: {\r\n        pattern: 'random',      // Random spawn positions\r\n        frequency: 'steady',    // Steady spawn rate\r\n        burstOnEntry: false,    // No burst when entering state\r\n        fadeOnExit: true        // Fade particles when leaving\r\n    },\r\n    \r\n    // Eye/core appearance\r\n    coreAppearance: {\r\n        pupilSize: 1.0,        // Standard pupil dilation\r\n        irisPattern: 'default', // Basic iris pattern\r\n        blinkRate: 'normal',    // Regular blink frequency\r\n        lookDirection: 'center' // Centered, neutral gaze\r\n    },\r\n    \r\n    /**\r\n     * Get core rendering parameters\r\n     * @param {Object} state - Current renderer state\r\n     * @returns {Object} Core rendering configuration\r\n     */\r\n    getCoreParams: function(state) {\r\n        return {\r\n            scaleX: 1.0,\r\n            scaleY: 1.0,\r\n            eyeOpenness: 1.0,\r\n            eyeExpression: 'neutral', // neutral, happy, sad, focused\r\n            pupilOffset: { x: 0, y: 0 }\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Optional: Custom core rendering\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     * @returns {boolean} True if custom rendering was done\r\n     */\r\n    renderCore: function(ctx, x, y, radius) {\r\n        // Return false to use default rendering\r\n        return false;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Joy Emotion\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Joy emotional state - playful happiness\r\n * @author Emotive Engine Team\r\n * @module emotions/states/joy\r\n */\r\n\r\n/**\r\n * Joy emotion configuration\r\n * Playful happiness with popcorn popping particles\r\n */\r\nexport default {\r\n    name: 'joy',\r\n    emoji: '😊',\r\n    description: 'Playful happiness and celebration',\r\n    \r\n    // Visual properties\r\n    visual: {\r\n        glowColor: '#FFEB3B',       // Bright yellow sunshine\r\n        glowIntensity: 1.6,         // Stronger cheerful glow\r\n        particleRate: 40,           // Abundant celebration particles\r\n        minParticles: 0,            // Can start from stillness\r\n        maxParticles: 40,           // Maximum joyful expression\r\n        particleBehavior: 'popcorn', // Spontaneous popping effect\r\n        breathRate: 1.5,            // Excited, happy breathing\r\n        breathDepth: 0.10,          // Moderate breath variation\r\n        coreJitter: false,          // Stable, confident happiness\r\n        particleColors: [\r\n            { color: '#FFEB3B', weight: 25 },  // Bright sunshine yellow\r\n            { color: '#FFC107', weight: 20 },  // Amber joy\r\n            { color: '#FFFF00', weight: 15 },  // Pure yellow burst\r\n            { color: '#FFD700', weight: 15 },  // Gold celebration\r\n            { color: '#FFF59D', weight: 10 },  // Pale yellow sparkle\r\n            { color: '#FF9800', weight: 10 },  // Orange warmth\r\n            { color: '#FFFDE7', weight: 5 }    // Light cream highlight\r\n        ]\r\n    },\r\n    \r\n    // Gesture modifiers\r\n    modifiers: {\r\n        speed: 1.8,        // Energetic, lively pace\r\n        amplitude: 1.9,    // Expansive, celebratory movements\r\n        intensity: 1.1,    // Enhanced joyful energy\r\n        smoothness: 1.0,   // Natural, flowing motion\r\n        regularity: 0.9,   // Playful, varied rhythm\r\n        addBounce: true    // Extra springiness effect\r\n    },\r\n    \r\n    // Typical gestures for joy\r\n    typicalGestures: [\r\n        'bounce',    // Happy bouncing\r\n        'spin',      // Joyful spinning\r\n        'wave',      // Excited waving\r\n        'expand',    // Expanding with joy\r\n        'shake',     // Excited shaking (gentle)\r\n        'float'      // Floating with happiness\r\n    ],\r\n    \r\n    // Transition hints\r\n    transitions: {\r\n        duration: 400,         // Swift mood elevation\r\n        easing: 'easeOutBack', // Bouncy, playful entrance\r\n        priority: 5,           // Elevated positive priority\r\n        burstOnEntry: true     // Celebratory particle burst\r\n    },\r\n    \r\n    // Audio/sound associations\r\n    audio: {\r\n        ambientSound: 'cheerful_hum',    // Cheerful background\r\n        transitionSound: 'pop',           // Pop sound on entry\r\n        gestureSound: 'giggle'            // Giggle on gestures\r\n    },\r\n    \r\n    // Particle spawn patterns\r\n    particleSpawn: {\r\n        pattern: 'fountain',     // Fountain-like spawn\r\n        frequency: 'burst',      // Burst spawning\r\n        burstOnEntry: true,      // Big burst on entry\r\n        fadeOnExit: false,       // Particles pop away\r\n        specialEffect: 'sparkle' // Sparkle effect\r\n    },\r\n    \r\n    // Eye/core appearance\r\n    coreAppearance: {\r\n        pupilSize: 1.2,          // Dilated with excitement\r\n        irisPattern: 'radiant',   // Radiant, sparkling iris\r\n        blinkRate: 'frequent',    // Happy, frequent blinking\r\n        lookDirection: 'up',      // Optimistic upward gaze\r\n        specialEffect: 'twinkle'  // Sparkling eye effect\r\n    },\r\n    \r\n    // Rhythm configuration - joy bounces to the beat\r\n    rhythm: {\r\n        enabled: true,\r\n        \r\n        // Particle emission celebrates on beat\r\n        particleEmission: {\r\n            syncMode: 'beat',\r\n            burstSize: 8,           // Big celebration bursts\r\n            offBeatRate: 0.6,       // Still happy between beats\r\n            popcornSync: true       // Popcorn pops on beat\r\n        },\r\n        \r\n        // Breathing syncs to happy tempo\r\n        breathSync: {\r\n            mode: 'beats',\r\n            beatsPerBreath: 4,     // One breath per bar\r\n            intensity: 1.2          // Deeper happy breaths\r\n        },\r\n        \r\n        // Glow pulses with joy\r\n        glowSync: {\r\n            intensityRange: [1.2, 1.8],\r\n            syncTo: 'beat',\r\n            attack: 0.05,           // Quick brightening\r\n            decay: 0.4              // Bouncy fade\r\n        },\r\n        \r\n        // Pattern-specific joy expressions\r\n        patternBehaviors: {\r\n            'waltz': {\r\n                // Elegant happy waltz\r\n                particleEmission: { burstSize: 5 },\r\n                breathSync: { beatsPerBreath: 3 }\r\n            },\r\n            'swing': {\r\n                // Jazzy playful joy\r\n                particleEmission: { \r\n                    syncMode: 'swing',\r\n                    burstSize: 6\r\n                },\r\n                glowSync: { curve: 'bounce' }\r\n            },\r\n            'dubstep': {\r\n                // Explosive joy on drops\r\n                particleEmission: {\r\n                    burstSize: 15,\r\n                    dropMultiplier: 3.0\r\n                }\r\n            },\r\n            'breakbeat': {\r\n                // Chaotic happy energy\r\n                particleEmission: {\r\n                    syncMode: 'random',\r\n                    burstRange: [3, 12]\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Get core rendering parameters for joy\r\n     */\r\n    getCoreParams: function(state) {\r\n        return {\r\n            scaleX: 1.0,\r\n            scaleY: 1.0,\r\n            eyeOpenness: 1.0,\r\n            eyeExpression: 'happy',  // ∪ shaped eyes\r\n            pupilOffset: { x: 0, y: -0.1 },  // Looking slightly up\r\n            sparkle: true  // Add sparkle effect\r\n        };\r\n    }\r\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Sadness Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Sadness emotional state - melancholic sorrow\n * @author Emotive Engine Team\n * @module emotions/states/sadness\n */\n\nexport default {\n    name: 'sadness',\n    emoji: '😢',\n    description: 'Deep melancholic sorrow',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#4169E1',       // Royal blue melancholy\n        glowIntensity: 0.65,        // Dimmer, more subdued glow\n        particleRate: 25,           // Steady tear-like emission\n        minParticles: 0,            // Can fade to emptiness\n        maxParticles: 25,           // Abundant sorrow display\n        particleBehavior: 'falling', // Tears falling downward\n        breathRate: 0.6,            // Slow, heavy breathing\n        breathDepth: 0.12,          // Deep, sighing breaths\n        coreJitter: false,          // Still, heavy core\n        particleColors: [\n            { color: '#4169E1', weight: 25 },  // Royal blue sorrow\n            { color: '#1E90FF', weight: 20 },  // Dodger blue tears\n            { color: '#6495ED', weight: 15 },  // Cornflower blue melancholy\n            { color: '#B0C4DE', weight: 15 },  // Light steel blue mist\n            { color: '#191970', weight: 10 },  // Midnight blue depth\n            { color: '#87CEEB', weight: 10 },  // Sky blue glimmer\n            { color: '#2F4F4F', weight: 5 }    // Dark slate gray shadow\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 0.7,         // Slowed, weary pace\n        amplitude: 0.6,     // Diminished movement range\n        intensity: 0.8,     // Weakened emotional force\n        smoothness: 1.3,    // Smooth, flowing sorrow\n        regularity: 1.1,    // Slightly monotonous patterns\n        addGravity: true    // Downward, heavy feeling\n    },\n    \n    // Typical gestures for sadness\n    typicalGestures: [\n        'droop',\n        'sway',\n        'contract',\n        'drift',\n        'sink'\n    ],\n    \n    // Transition configuration\n    transitions: {\n        duration: 800,         // Gradual mood shift\n        easing: 'easeInOut',  // Smooth emotional transition\n        priority: 3           // Lower emotional priority\n    },\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Anger Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Anger emotional state - intense rage\n * @author Emotive Engine Team\n * @module emotions/states/anger\n */\n\n/**\n * Anger emotion configuration\n * Intense aggressive state with rapid, chaotic particles\n */\nexport default {\n    name: 'anger',\n    emoji: '😠',\n    description: 'Intense rage and aggression',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#DC143C',       // Crimson rage - more intense\n        glowIntensity: 1.8,         // Stronger, burning aura\n        particleRate: 20,           // More frequent particle generation for chaos\n        minParticles: 3,            // Maintain constant agitation\n        maxParticles: 10,           // More particles for intensity\n        particleBehavior: 'aggressive', // Erratic, forceful particle movement\n        breathRate: 2.2,            // Rapid, agitated breathing rhythm\n        breathDepth: 0.15,          // Deep, forceful breath cycles\n        coreJitter: true,           // Visual tremor from internal rage\n        particleColors: [\n            { color: '#DC143C', weight: 25 },  // Crimson rage\n            { color: '#FF0000', weight: 20 },  // Pure red fury\n            { color: '#B22222', weight: 15 },  // FireBrick intensity\n            { color: '#FF4500', weight: 15 },  // OrangeRed flames\n            { color: '#8B0000', weight: 10 },  // Dark red depth\n            { color: '#FF6347', weight: 10 },  // Tomato heat\n            { color: '#660000', weight: 5 }    // Nearly black ember\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 1.5,        // Accelerated motion for urgency\n        amplitude: 1.4,    // Exaggerated movement range\n        intensity: 1.3,    // Heightened force and impact\n        smoothness: 0.3,   // Sharp, abrupt transitions\n        regularity: 0.7,   // Erratic, unpredictable patterns\n        addShake: true     // Tremor effect from rage\n    },\n    \n    // Typical gestures for anger\n    typicalGestures: [\n        'shake',     // Violent shaking\n        'vibrate',   // Angry vibration\n        'expand',    // Explosive expansion\n        'pulse',     // Angry pulsing\n        'flicker',   // Rage flickering\n        'strike'     // Strike motion\n    ],\n    \n    // Transition hints\n    transitions: {\n        duration: 300,          // Swift state change\n        easing: 'easeOutExpo',  // Explosive, sudden entrance\n        priority: 8,            // High priority emotional state\n        shakeOnEntry: true      // Trigger screen disturbance\n    },\n    \n    // Audio/sound associations\n    audio: {\n        ambientSound: 'rumble',      // Low rumbling\n        transitionSound: 'explosion', // Explosive sound\n        gestureSound: 'growl'         // Growling sounds\n    },\n    \n    // Particle spawn patterns\n    particleSpawn: {\n        pattern: 'explosive',    // Explosive spawn\n        frequency: 'chaotic',    // Chaotic frequency\n        burstOnEntry: true,      // Explosion on entry\n        fadeOnExit: false,       // Particles dissipate violently\n        specialEffect: 'flames'  // Flame-like effect\n    },\n    \n    // Eye/core appearance\n    coreAppearance: {\n        pupilSize: 0.7,           // Constricted for focused intensity\n        irisPattern: 'sharp',      // Angular, aggressive iris pattern\n        blinkRate: 'rare',        // Unwavering, intense gaze\n        lookDirection: 'forward',  // Direct, confrontational focus\n        specialEffect: 'flames',   // Fire-like eye effects\n        pulseRate: 'rapid'        // Quick, agitated pulsing\n    },\n    \n    // Special anger properties\n    special: {\n        screenShake: true,         // Environmental disturbance effect\n        particleTrails: 'fire',    // Incendiary particle trail style\n        glowPulse: true,          // Rhythmic aura fluctuation\n        temperatureEffect: 'hot'   // Warm spectrum color shifting\n    }\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Fear Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n */\n\nexport default {\n    name: 'fear',\n    emoji: '😨',\n    description: 'Anxious state with fleeing particles',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#8A2BE2',       // Dark violet (BlueViolet) - more ominous\n        glowIntensity: 0.9,         // Slightly stronger, pulsing glow\n        particleRate: 18,           // More rapid nervous emission\n        minParticles: 4,            // Constant anxious presence\n        maxParticles: 16,           // Scattered fearful display\n        particleBehavior: 'scattering', // Particles flee outward\n        breathRate: 2.5,            // Rapid, shallow breathing\n        breathDepth: 0.06,          // Short, panicked breaths\n        coreJitter: true,           // Trembling with anxiety\n        particleColors: [\n            { color: '#8A2BE2', weight: 25 },  // Dark violet base\n            { color: '#4B0082', weight: 20 },  // Indigo dread\n            { color: '#9400D3', weight: 15 },  // Dark violet panic\n            { color: '#6B46C1', weight: 15 },  // Deep purple anxiety\n            { color: '#9932CC', weight: 10 },  // Dark orchid fear\n            { color: '#E6E6FA', weight: 8 },   // Pale lavender flash\n            { color: '#301934', weight: 7 }    // Almost black shadow\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 1.4,        // Quick, reactive movements\n        amplitude: 0.8,    // Restricted, defensive range\n        intensity: 1.2,    // Heightened fight-or-flight response\n        smoothness: 0.5,   // Jerky, startled transitions\n        regularity: 0.5,   // Unpredictable panic patterns\n        addJitter: true    // Nervous trembling overlay\n    },\n    \n    // Typical gestures for fear\n    typicalGestures: ['shake', 'vibrate', 'contract', 'flicker', 'retreat'],\n    \n    // Transition configuration\n    transitions: { \n        duration: 400,       // Quick fear response\n        easing: 'easeOut',  // Sudden onset\n        priority: 7         // High alert priority\n    }\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Surprise Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n */\n\nexport default {\n    name: 'surprise',\n    emoji: '😲',\n    description: 'Sudden shock with explosive particles',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#FFD700',       // Bright gold (shining surprise)\n        glowIntensity: 1.8,         // Very intense, sudden flash\n        particleRate: 30,           // Rapid burst emission\n        minParticles: 0,            // Can start from nothing\n        maxParticles: 15,           // Burst of shocked particles\n        particleBehavior: 'burst',  // Explosive outward motion\n        breathRate: 0.3,            // Gasping, held breath\n        breathDepth: 0.18,          // Large shocked inhale\n        coreJitter: false,          // Frozen in surprise\n        particleColors: [\n            { color: '#FFD700', weight: 25 },  // Gold burst\n            { color: '#FFA500', weight: 20 },  // Orange shock\n            { color: '#FFFF00', weight: 15 },  // Yellow flash\n            { color: '#FF6347', weight: 15 },  // Tomato red excitement\n            { color: '#FFE4B5', weight: 10 },  // Moccasin highlight\n            { color: '#FF4500', weight: 10 },  // OrangeRed pop\n            { color: '#FFFACD', weight: 5 }    // LemonChiffon sparkle\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 1.6,         // Rapid, startled reactions\n        amplitude: 1.5,     // Large, exaggerated movements\n        intensity: 1.4,     // Strong shock force\n        smoothness: 0.7,    // Abrupt, jerky motions\n        regularity: 0.8,    // Erratic surprise patterns\n        addPop: true        // Popping, explosive effect\n    },\n    \n    // Typical gestures for surprise\n    typicalGestures: ['expand', 'bounce', 'flash', 'pulse', 'pop'],\n    \n    // Transition configuration\n    transitions: { \n        duration: 200,           // Instant shock response\n        easing: 'easeOutBack',  // Snappy, elastic reaction\n        priority: 6             // High interrupt priority\n    }\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Disgust Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n */\n\nexport default {\n    name: 'disgust',\n    emoji: '🤢',\n    description: 'Revulsion with repelling particles',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#9ACD32',       // Sickly yellow-green (YellowGreen)\n        glowIntensity: 1.0,         // Stronger, toxic glow\n        particleRate: 15,           // More particles for nauseating effect\n        minParticles: 5,            // Maintain visible repulsion\n        maxParticles: 12,           // Controlled rejection display\n        particleBehavior: 'repelling', // Particles flee from center\n        breathRate: 0.7,            // Slow, queasy breathing\n        breathDepth: 0.04,          // Shallow, uncomfortable breaths\n        coreJitter: false,          // Stable but uneasy core\n        particleColors: [\n            { color: '#9ACD32', weight: 25 },  // Yellow-green toxic\n            { color: '#ADFF2F', weight: 20 },  // Bright acid green\n            { color: '#7FFF00', weight: 15 },  // Chartreuse nausea\n            { color: '#BDB76B', weight: 15 },  // Dark khaki sick\n            { color: '#6B8E23', weight: 10 },  // Olive drab decay\n            { color: '#CCFF00', weight: 8 },   // Fluorescent bile\n            { color: '#556B2F', weight: 7 }    // Dark olive shadow\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 0.9,        // Slightly slowed movements\n        amplitude: 0.7,    // Restricted, withdrawn motion\n        intensity: 0.9,    // Controlled repulsion force\n        smoothness: 0.8,   // Mostly smooth with discomfort\n        regularity: 1.0,   // Consistent rejection pattern\n        addRecoil: true    // Recoiling motion effect\n    },\n    \n    // Typical gestures for disgust\n    typicalGestures: ['contract', 'shake', 'recoil', 'wobble'],\n    \n    // Transition configuration\n    transitions: { \n        duration: 600,       // Moderate transition speed\n        easing: 'easeIn',   // Gradual onset of revulsion\n        priority: 4         // Mid-level priority state\n    }\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Love Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n */\n\nexport default {\n    name: 'love',\n    emoji: '💕',\n    description: 'Warm affection with orbiting particles',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#FF1493',       // Deep passionate pink (DeepPink)\n        glowIntensity: 1.8,         // Strong, radiant warmth\n        particleRate: 25,           // Generous particle flow\n        minParticles: 10,           // Constant loving presence\n        maxParticles: 18,           // Abundant affection display\n        particleBehavior: 'orbiting', // Particles orbit romantically\n        breathRate: 0.75,           // Slow, content breathing\n        breathDepth: 0.15,          // Deep, satisfied breaths\n        coreJitter: false,          // Stable, secure feeling\n        particleColors: [\n            { color: '#FF1493', weight: 30 },  // Deep passionate pink\n            { color: '#FF69B4', weight: 25 },  // Hot pink\n            { color: '#FF007F', weight: 15 },  // Rose red\n            { color: '#FFB6C1', weight: 10 },  // Light pink highlights\n            { color: '#FF45A0', weight: 10 },  // Vibrant magenta\n            { color: '#E91E63', weight: 5 },   // Material pink accent\n            { color: '#FFC0CB', weight: 5 }    // Soft pink glow\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 0.9,         // Gentle, romantic pace\n        amplitude: 1.1,     // Slightly expanded movements\n        intensity: 1.2,     // Enhanced emotional depth\n        smoothness: 1.4,    // Extra smooth, flowing motion\n        regularity: 1.2,    // Consistent, rhythmic patterns\n        addWarmth: true     // Warm, inviting quality\n    },\n    \n    // Typical gestures for love\n    typicalGestures: ['pulse', 'sway', 'orbit', 'glow', 'breathe', 'float'],\n    \n    // Transition configuration\n    transitions: { \n        duration: 700,         // Gradual emotional shift\n        easing: 'easeInOut',  // Smooth, gentle transition\n        priority: 5           // Moderate emotional priority\n    },\n    \n    // Rhythm configuration - how love emotion responds to musical timing\n    rhythm: {\n        enabled: true,\n        \n        // Particle emission syncs to rhythm\n        particleEmission: {\n            syncMode: 'beat',        // Emit bursts on beat\n            burstSize: 3,            // Extra particles per beat\n            offBeatRate: 0.7         // Reduced emission between beats\n        },\n        \n        // Orbital motion rhythm\n        orbitalSync: {\n            speedMultiplier: {\n                onBeat: 1.2,         // Speed up on beat\n                offBeat: 0.9,        // Slow between beats\n                curve: 'ease'        // Smooth speed changes\n            },\n            radiusSync: {\n                enabled: true,\n                subdivision: 'quarter',  // Pulse radius on quarters\n                amount: 0.15            // 15% radius variation\n            }\n        },\n        \n        // Glow pulsing with rhythm\n        glowSync: {\n            intensityRange: [1.4, 2.0],  // Min/max glow intensity\n            syncTo: 'beat',              // Pulse on beats\n            attack: 0.1,                 // Quick brightening\n            decay: 0.6                   // Gentle fade\n        },\n        \n        // Breathing synced to bars\n        breathSync: {\n            mode: 'bars',\n            barsPerBreath: 2,    // One breath every 2 bars\n            intensity: 1.0        // Full sync strength\n        },\n        \n        // Pattern-specific overrides\n        patternBehaviors: {\n            'waltz': {\n                // 3/4 time creates romantic swaying\n                orbitalSync: { \n                    radiusSync: { subdivision: 'bar', amount: 0.25 }\n                },\n                particleEmission: { syncMode: 'bar', burstSize: 5 }\n            },\n            'swing': {\n                // Jazzy, playful love\n                orbitalSync: {\n                    speedMultiplier: { onBeat: 1.5, curve: 'bounce' }\n                }\n            }\n        },\n        \n        // Intensity modulation\n        intensityMapping: {\n            low: { particleRate: 0.6, glowIntensity: 0.8 },\n            medium: { particleRate: 1.0, glowIntensity: 1.0 },\n            high: { particleRate: 1.4, glowIntensity: 1.3 }\n        }\n    }\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Excited Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n */\n\nexport default {\n    name: 'excited',\n    emoji: '🤩',\n    description: 'High energy with rapid particles',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#FF6B35',       // Vibrant orange-red energy\n        glowIntensity: 1.5,         // Stronger energetic aura\n        particleRate: 25,           // Increased emission frequency (was 15)\n        minParticles: 8,            // More constant particles (was 5)\n        maxParticles: 30,           // More maximum particles (was 20)\n        particleBehavior: 'burst',  // Explosive particle behavior\n        breathRate: 2.0,            // Quick, excited breathing\n        breathDepth: 0.14,          // Deep, energized breaths\n        coreJitter: true,           // Vibrating with enthusiasm\n        particleColors: [\n            { color: '#FF6B35', weight: 25 },  // Vibrant orange energy\n            { color: '#FF1744', weight: 20 },  // Red accent excitement\n            { color: '#FFC107', weight: 15 },  // Amber sparkle\n            { color: '#FF9100', weight: 15 },  // Deep orange burst\n            { color: '#FFEB3B', weight: 10 },  // Yellow flash\n            { color: '#FF5722', weight: 10 },  // Deep orange-red\n            { color: '#FFF59D', weight: 5 }    // Pale yellow highlight\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 1.4,         // Quickened, energetic pace\n        amplitude: 1.3,     // Expansive, enthusiastic movements\n        intensity: 1.3,     // Strong energetic force\n        smoothness: 0.8,    // Smooth with energetic bursts\n        regularity: 0.7,    // Spontaneous, varied patterns\n        addVibration: true  // Buzzing with excitement\n    },\n    \n    // Typical gestures for excitement\n    typicalGestures: ['bounce', 'spin', 'vibrate', 'expand', 'shake', 'pulse'],\n    \n    // Transition configuration\n    transitions: { \n        duration: 300,              // Quick state entry\n        easing: 'easeOutElastic',  // Bouncy, elastic entrance\n        priority: 6                // High-energy priority level\n    },\n    \n    // Rhythm configuration - excited syncs energetically to beat\n    rhythm: {\n        enabled: true,\n        \n        // Particle emission doubles on beat\n        particleEmission: {\n            syncMode: 'beat',\n            burstSize: 5,           // Big bursts on beat\n            offBeatRate: 0.5        // Calmer between beats\n        },\n        \n        // Core jitter syncs to subdivisions\n        jitterSync: {\n            subdivision: 'sixteenth',  // Rapid jitter on 16th notes\n            intensity: 0.8,           // Strong rhythm influence\n            onBeat: 1.5              // Extra jitter on beat\n        },\n        \n        // Glow pulses rapidly with beat\n        glowSync: {\n            intensityRange: [1.0, 1.8],\n            syncTo: 'eighth',         // Pulse on 8th notes\n            attack: 0.05,            // Very quick attack\n            decay: 0.2               // Quick decay\n        },\n        \n        // Different patterns create different excitement\n        patternBehaviors: {\n            'dubstep': {\n                // Heavy drops create explosion effects\n                particleEmission: { \n                    syncMode: 'beat',\n                    burstSize: 10,      // Huge bursts on drop\n                    dropMultiplier: 2   // Double on beat 3\n                }\n            },\n            'breakbeat': {\n                // Broken beats create chaotic energy\n                jitterSync: {\n                    subdivision: 'random',\n                    intensity: 1.0\n                }\n            }\n        }\n    }\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Resting Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n */\n\nexport default {\n    name: 'resting',\n    emoji: '😴',\n    description: 'Deep relaxation with slow drift',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#9370DB',       // Sleepy purple twilight\n        glowIntensity: 0.8,         // Dimmed, drowsy glow\n        particleRate: 10,           // Lazy particle generation\n        minParticles: 3,            // Minimal sleepy presence\n        maxParticles: 5,            // Few drifting particles\n        particleBehavior: 'resting', // Slow, floating behavior\n        breathRate: 0.8,            // Deep, slow breathing\n        breathDepth: 0.12,          // Pronounced rest breaths\n        coreJitter: false,          // Perfectly still core\n        particleColors: [\n            { color: '#9370DB', weight: 30 },  // Primary sleepy purple\n            { color: '#A591C4', weight: 20 },  // Soft lavender drift\n            { color: '#B366FF', weight: 20 },  // Dreamy violet accent\n            { color: '#B8A1E6', weight: 15 },  // Light drowsy highlights\n            { color: '#674D9B', weight: 15 }   // Deep sleep shadows\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 0.5,         // Slowed, drowsy pace\n        amplitude: 0.4,     // Minimal movement range\n        intensity: 0.5,     // Reduced energy level\n        smoothness: 1.4,    // Extra smooth drifting\n        regularity: 0.9,    // Slightly irregular, natural rest\n        addWeight: true     // Heavy, weighted feeling\n    },\n    \n    // Typical gestures for resting\n    typicalGestures: ['breathe', 'drift', 'sway', 'float'],\n    \n    // Transition configuration\n    transitions: { \n        duration: 1000,         // Slow fade to rest\n        easing: 'easeInOut',   // Gentle transition\n        priority: 2            // Low priority state\n    }\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Euphoria Emotion\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n */\n\nexport default {\n    name: 'euphoria',\n    emoji: '🌟',\n    description: 'Radiant hope and new beginnings',\n    \n    // Visual properties\n    visual: {\n        glowColor: '#FFB6C1',       // Light pink euphoric glow\n        glowIntensity: 2.0,         // Maximum transcendent radiance\n        particleRate: 35,           // Abundant particle emission\n        minParticles: 15,           // Abundant positive energy\n        maxParticles: 30,           // Maximum radiant display\n        particleBehavior: 'radiant', // Outward radiating particles\n        breathRate: 1.3,            // Elevated, joyful breathing\n        breathDepth: 0.25,          // Full, satisfied breaths\n        coreJitter: false,          // Stable, confident core\n        particleColors: [\n            { color: '#FFB6C1', weight: 20 },  // Light pink bliss\n            { color: '#FFD700', weight: 18 },  // Golden joy\n            { color: '#87CEEB', weight: 15 },  // Sky blue serenity\n            { color: '#DDA0DD', weight: 15 },  // Plum transcendence\n            { color: '#98FB98', weight: 12 },  // Pale green harmony\n            { color: '#FFA07A', weight: 10 },  // Light salmon warmth\n            { color: '#E6E6FA', weight: 8 },   // Lavender dream\n            { color: '#FFFFFF', weight: 2 }    // Pure white sparkle\n        ]\n    },\n    \n    // Gesture modifiers\n    modifiers: {\n        speed: 1.4,         // Energized, flowing pace\n        amplitude: 1.5,     // Expansive, reaching movements\n        intensity: 1.6,     // Powerful positive force\n        smoothness: 1.3,    // Extra fluid, graceful motion\n        regularity: 0.8,    // Natural variation in rhythm\n        addWarmth: true,    // Warm, inviting quality\n        addLift: true       // Upward, elevating tendency\n    },\n    \n    // Typical gestures for euphoria\n    typicalGestures: ['expand', 'radiate', 'pulse', 'glow', 'float', 'bloom'],\n    \n    // Transition configuration\n    transitions: { \n        duration: 600,           // Smooth emergence\n        easing: 'easeOutExpo',  // Explosive, radiant entrance\n        priority: 8             // High priority transcendent state\n    }\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Focused Emotion\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'focused',\r\n    emoji: '🎯',\r\n    description: 'Intense concentration with directed flow',\r\n    \r\n    // Visual properties\r\n    visual: {\r\n        glowColor: '#00CED1',       // Sharp cyan concentration\r\n        glowIntensity: 1.2,         // Clear, defined aura\r\n        particleRate: 10,           // Steady, controlled emission\r\n        minParticles: 5,            // Consistent focus presence\r\n        maxParticles: 12,           // Controlled attention display\r\n        particleBehavior: 'directed', // Particles follow target\r\n        breathRate: 1.2,            // Steady, measured breathing\r\n        breathDepth: 0.08,          // Controlled, regular breaths\r\n        coreJitter: true,           // Minimal tracking adjustments\r\n        particleColors: [\r\n            { color: '#00CED1', weight: 30 },  // Primary focused cyan\r\n            { color: '#4A9FA0', weight: 20 },  // Muted concentration tone\r\n            { color: '#00FFFF', weight: 20 },  // Bright attention burst\r\n            { color: '#5FE5E7', weight: 15 },  // Light focus highlights\r\n            { color: '#006B6D', weight: 15 }   // Deep concentration base\r\n        ],\r\n        eyeOpenness: 0.7,           // Narrowed for concentration\r\n        microAdjustments: true      // Subtle tracking movements\r\n    },\r\n    \r\n    // Gesture modifiers\r\n    modifiers: {\r\n        speed: 1.0,         // Baseline, deliberate pace\r\n        amplitude: 0.9,     // Controlled movement range\r\n        intensity: 1.1,     // Enhanced focus strength\r\n        smoothness: 1.1,    // Precise, smooth tracking\r\n        regularity: 1.2,    // Consistent, predictable patterns\r\n        addPrecision: true  // Enhanced accuracy mode\r\n    },\r\n    \r\n    // Typical gestures for focus\r\n    typicalGestures: ['track', 'lock', 'scan', 'pulse', 'vibrate'],\r\n    \r\n    // Transition configuration\r\n    transitions: { \r\n        duration: 400,       // Moderate focus shift\r\n        easing: 'easeIn',   // Gradual concentration\r\n        priority: 5         // Mid-level attention priority\r\n    },\r\n    \r\n    // Core appearance parameters\r\n    getCoreParams: function(state) {\r\n        return {\r\n            scaleX: 1.1,              // Slightly widened awareness\r\n            scaleY: 0.7,              // Narrowed for concentration\r\n            eyeOpenness: 0.7,         // Focused gaze intensity\r\n            eyeExpression: 'focused', // Concentrated expression\r\n            pupilOffset: { x: 0, y: 0 }, // Centered attention\r\n            microAdjustments: true    // Small tracking movements\r\n        };\r\n    }\r\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                     ◐ ◑ ◒ ◓  STATE MACHINE CORE  ◓ ◒ ◑ ◐                     \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Emotive State Machine - Emotional State & Transition Management\n * @author Emotive Engine Team\n * @version 2.0.0\n * @module EmotiveStateMachine\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ The BRAIN of the Emotive Engine. Manages emotional states, transitions,           \n * ║ undertones, and gesture queues. This is where emotions become behavior.           \n * ║ Works with emotionMap.js for visuals but defines the LOGIC and TIMING.           \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🧠 CORE RESPONSIBILITIES                                                          \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Emotional state management (current, target, transitions)                       \n * │ • Undertone layering (nervous + happy, tired + angry, etc.)                      \n * │ • Gesture queue processing (sequential animation management)                      \n * │ • Smooth property interpolation during transitions                                \n * │ • Event emission for state changes                                                \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ ⚠️  CRITICAL STATE PROPERTIES                                                     \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • emotion      : Current emotional state (must be valid emotion)                  \n * │ • undertone    : Optional modifier (null or valid undertone)                      \n * │ • gesture      : Currently playing gesture animation\n * │ • transitions  : Active transition data (progress, timing, easing)\n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🔄 TRANSITION SYSTEM                                                              \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Smooth blending between emotional states                                        \n * │ • Configurable transition duration (default 500ms)                                \n * │ • Easing functions for natural motion                                             \n * │ • Property interpolation (colors, sizes, speeds)                                  \n * │ • Prevents jarring visual changes                                                 \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ ❌ DO NOT MODIFY WITHOUT UNDERSTANDING                                            \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ ✗ State validation logic    → Breaks error handling                              \n * │ ✗ Transition timing        → Causes visual glitches                              \n * │ ✗ Event emission order     → Breaks dependent systems                            \n * │ ✗ Property interpolation   → Creates animation artifacts                         \n * │ ✗ Queue processing         → Causes gesture conflicts                            \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                          ADDING NEW EMOTIONAL STATES                              \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ 1. Define visual properties in emotionMap.js                                      \n * ║ 2. Add state definition in initializeEmotionalStates()                            \n * ║ 3. Add validation to ErrorBoundary.js                                             \n * ║ 4. Test transitions FROM and TO the new state                                     \n * ║ 5. Verify particle behavior and performance                                       \n * ║ 6. Document any special transition rules                                          \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\n\nimport { interpolateHsl } from '../utils/colorUtils.js';\nimport { applyEasing, easeInOutCubic } from '../utils/easing.js';\nimport { hasEmotion, listEmotions } from './emotions/index.js';\n\nclass EmotiveStateMachine {\n    constructor(errorBoundary) {\n        this.errorBoundary = errorBoundary;\n        \n        // Current state\n        this.state = {\n            emotion: 'neutral',\n            undertone: null,\n            gesture: null,\n            speaking: false,\n            audioLevel: 0\n        };\n        \n        // Transition management\n        this.transitions = {\n            emotional: {\n                current: 'neutral',\n                target: null,\n                progress: 0,\n                duration: 500,\n                startTime: 0,\n                isActive: false\n            },\n            undertone: {\n                current: null,\n                target: null,\n                progress: 0,\n                duration: 300,  // Faster than emotion transitions\n                startTime: 0,\n                isActive: false,\n                currentWeight: 0,  // 0-1 weight of current undertone\n                targetWeight: 0    // 0-1 weight of target undertone\n            }\n        };\n        \n        // Cache for interpolation results\n        this.interpolationCache = {\n            lastUpdate: 0,\n            cacheInterval: 100, // Cache for 100ms\n            cachedProperties: null,\n            cachedRenderState: null\n        };\n        \n        // Initialize emotional state definitions\n        this.initializeEmotionalStates();\n        this.initializeUndertoneModifiers();\n    }\n\n    /**\n     * Initialize all 8 emotional states with their visual properties\n     */\n    initializeEmotionalStates() {\n        this.emotionalStates = {\n            neutral: {\n                primaryColor: '#B0B0B0',\n                glowIntensity: 0.7,\n                particleRate: 1,  // DECIMATED - minimal particles\n                minParticles: 3,  // Always have at least 3 particles for gestures to affect\n                maxParticles: 4,  // Max 4 particles\n                particleBehavior: 'ambient',\n                coreSize: 1.0,\n                breathRate: 1.0,\n                breathDepth: 0.1\n            },\n            joy: {\n                primaryColor: '#FFD700',\n                glowIntensity: 1.2,\n                particleRate: 2,           // More frequent popping\n                minParticles: 3,           // Always popping\n                maxParticles: 8,           // Can have many kernels popping\n                particleBehavior: 'popcorn', // Spontaneous popping effect\n                coreSize: 1.1,\n                breathRate: 1.3,\n                breathDepth: 0.15\n            },\n            sadness: {\n                primaryColor: '#4169E1',\n                glowIntensity: 0.6,\n                particleRate: 2,  // Halved from 3\n                minParticles: 1,  // At least 1\n                maxParticles: 3,  // Max 3 particles\n                particleBehavior: 'falling',\n                coreSize: 0.9,\n                breathRate: 0.7,\n                breathDepth: 0.08\n            },\n            anger: {\n                primaryColor: '#DC143C',\n                glowIntensity: 1.3,\n                particleRate: 1,  // ~30% chance per frame\n                minParticles: 3,  // Always show anger\n                maxParticles: 8,  // Can get intense\n                particleBehavior: 'aggressive',\n                coreSize: 1.2,\n                breathRate: 1.5,\n                breathDepth: 0.2\n            },\n            fear: {\n                primaryColor: '#8B008B',\n                glowIntensity: 0.8,\n                particleRate: 1,  // chance per frame\n                minParticles: 2,  // Always visible\n                maxParticles: 6,  // Moderate max\n                particleBehavior: 'scattering',\n                coreSize: 0.8,\n                breathRate: 1.8,\n                breathDepth: 0.12\n            },\n            surprise: {\n                primaryColor: '#FF8C00',\n                glowIntensity: 1.4,\n                particleRate: 1,\n                minParticles: 3,  // Burst effect\n                maxParticles: 10,  // Can burst big\n                particleBehavior: 'burst',\n                coreSize: 1.3,\n                breathRate: 2.0,\n                breathDepth: 0.25\n            },\n            disgust: {\n                primaryColor: '#9ACD32',\n                glowIntensity: 0.9,\n                particleRate: 2,\n                minParticles: 2,  // Always show disgust\n                maxParticles: 4,  // Limited particles\n                particleBehavior: 'repelling',\n                coreSize: 0.95,\n                breathRate: 0.8,\n                breathDepth: 0.06\n            },\n            love: {\n                primaryColor: '#FF69B4',\n                glowIntensity: 1.1,\n                particleRate: 1,  // Halved from 9\n                minParticles: 2,  // Always orbiting\n                maxParticles: 5,  // Gentle max\n                particleBehavior: 'orbiting',\n                coreSize: 1.05,\n                breathRate: 0.9,\n                breathDepth: 0.18\n            },\n            excited: {\n                primaryColor: '#FF00FF',  // Hot magenta\n                glowIntensity: 1.2,  // Bright glow for excitement\n                particleRate: 360,  // Double rate for more visible particles\n                minParticles: 480,  // Double particles for denser effect\n                maxParticles: 900,  // Double max particles\n                particleBehavior: 'fizzy',\n                coreSize: 0.85,  // Slightly smaller than neutral\n                breathRate: 1.5,  // Excited breathing\n                breathDepth: 0.08,  // Moderate breath\n                eyeOpenness: 1.0  // Wide eyes\n            },\n            resting: {\n                primaryColor: '#7C3AED',   // Soft purple for resting\n                glowIntensity: 0.8,\n                particleRate: 2,          // Moderate particles for visible effect\n                minParticles: 3,  // Always 3-5 visible\n                maxParticles: 5,  // Calm max\n                particleBehavior: 'resting',\n                coreSize: 1.0,\n                breathRate: 0.8,           // 12-16 breaths per minute (resting human)\n                breathDepth: 0.12          // Gentle, relaxed breathing\n            },\n            euphoria: {\n                primaryColor: '#FFD700',   // Golden sunrise\n                glowIntensity: 1.8,        // Radiant warm glow\n                particleRate: 3,           // Abundant like sunbeams\n                minParticles: 15,          // Always sparkling\n                maxParticles: 30,          // Maximum celebration\n                particleBehavior: 'radiant', // Radiating outward\n                coreSize: 1.15,            // Expanded with joy\n                breathRate: 1.3,           // Energized breathing\n                breathDepth: 0.25,         // Deep refreshing breaths\n            },\n            focused: {\n                primaryColor: '#00CED1',  // Bright cyan\n                glowIntensity: 1.2,\n                particleRate: 0.5,  // Frequent, like synapses\n                minParticles: 2,\n                maxParticles: 5,\n                particleBehavior: 'directed',  // Fast, straight paths\n                coreSize: 1.05,\n                breathRate: 1.2,  // Alert breathing\n                breathDepth: 0.08,\n                eyeOpenness: 0.7,  // Narrowed for concentration\n                microAdjustments: true  // Enable tiny shifts\n            },\n            suspicion: {\n                primaryColor: '#708090',  // Slate gray\n                glowIntensity: 0.9,\n                particleRate: 20,  // Higher rate for continuous particles\n                minParticles: 8,\n                maxParticles: 15,  // More particles for better visibility\n                particleBehavior: 'burst',  // Use burst like surprise but we'll modify it\n                coreSize: 1.0,\n                breathRate: 0.8,  // Controlled breathing\n                breathDepth: 0.05,  // Shallow, alert breathing\n                eyeOpenness: 0.5,  // Narrowed, skeptical eyes\n                eyeArc: -0.2  // Slight frown\n            }\n        };\n    }\n\n    /**\n     * Initialize undertone modifiers that affect base emotional properties\n     */\n    initializeUndertoneModifiers() {\n        this.undertoneModifiers = {\n            nervous: {\n                jitterAmount: 0.3,\n                breathRateMultiplier: 1.2,\n                glowIntensityMultiplier: 0.9,\n                particleRateMultiplier: 1.1\n            },\n            confident: {\n                coreSizeMultiplier: 1.1,\n                glowIntensityMultiplier: 1.2,\n                breathRateMultiplier: 0.9,\n                particleRateMultiplier: 1.0\n            },\n            tired: {\n                breathRateMultiplier: 0.7,\n                particleRateMultiplier: 0.5,\n                glowIntensityMultiplier: 0.8,\n                coreSizeMultiplier: 0.95\n            },\n            intense: {\n                amplificationFactor: 1.3\n            },\n            subdued: {\n                dampeningFactor: 0.7\n            }\n        };\n    }\n\n    /**\n     * Sets the emotional state with optional undertone\n     * @param {string} emotion - The emotion to set\n     * @param {string|null} undertone - Optional undertone modifier\n     * @param {number} duration - Transition duration in milliseconds\n     * @returns {boolean} Success status\n     */\n    setEmotion(emotion, undertone = null, duration = 500) {\n        return this.errorBoundary.wrap(() => {\n            // Clear interpolation cache when emotion changes\n            this.interpolationCache.cachedProperties = null;\n            this.interpolationCache.cachedRenderState = null;\n            \n            // Validate emotion using modular system\n            if (!hasEmotion(emotion) && !this.emotionalStates.hasOwnProperty(emotion)) {\n                const validEmotions = [...Object.keys(this.emotionalStates), ...listEmotions()];\n                const uniqueEmotions = [...new Set(validEmotions)];\n                throw new Error(`Invalid emotion: ${emotion}. Valid emotions: ${uniqueEmotions.join(', ')}`);\n            }\n\n            // Validate undertone\n            if (undertone !== null && !this.undertoneModifiers.hasOwnProperty(undertone)) {\n                throw new Error(`Invalid undertone: ${undertone}. Valid undertones: ${Object.keys(this.undertoneModifiers).join(', ')}`);\n            }\n\n            // If already in this state, just update undertone\n            if (this.state.emotion === emotion && this.state.undertone === undertone) {\n                return true;\n            }\n\n            // Set up emotion transition if emotion is changing\n            if (this.state.emotion !== emotion) {\n                if (duration > 0) {\n                    this.transitions.emotional = {\n                        current: this.state.emotion,\n                        target: emotion,\n                        progress: 0,\n                        duration: Math.max(100, duration),\n                        startTime: performance.now(),\n                        isActive: true\n                    };\n                    \n                    // Reset simulated time for testing\n                    if (this._simulatedTime !== undefined) {\n                        this._simulatedTime = 0;\n                    }\n                } else {\n                    // Immediate transition\n                    this.transitions.emotional = {\n                        current: emotion,\n                        target: null,\n                        progress: 1,\n                        duration: 0,\n                        startTime: performance.now(),\n                        isActive: false\n                    };\n                }\n                this.state.emotion = emotion;\n            }\n            \n            // Set up undertone transition if undertone is changing\n            if (this.state.undertone !== undertone) {\n                this.transitions.undertone = {\n                    current: this.state.undertone,\n                    target: undertone,\n                    progress: 0,\n                    duration: 300,  // Always smooth undertone transitions\n                    startTime: performance.now(),\n                    isActive: true,\n                    currentWeight: this.state.undertone ? 1 : 0,\n                    targetWeight: undertone ? 1 : 0\n                };\n                this.state.undertone = undertone;\n            }\n\n            return true;\n        }, 'emotion-setting', false)();\n    }\n\n    /**\n     * Applies undertone modifiers to base emotional properties\n     * @param {Object} baseProperties - Base emotional properties\n     * @param {string|null} undertone - Undertone to apply\n     * @returns {Object} Modified properties\n     */\n    applyUndertone(baseProperties, undertone) {\n        if (!undertone || !this.undertoneModifiers.hasOwnProperty(undertone)) {\n            return { ...baseProperties };\n        }\n\n        const modifier = this.undertoneModifiers[undertone];\n        const modified = { ...baseProperties };\n\n        // Apply specific modifiers\n        if (modifier.glowIntensityMultiplier !== undefined) {\n            modified.glowIntensity *= modifier.glowIntensityMultiplier;\n        }\n        if (modifier.breathRateMultiplier !== undefined) {\n            modified.breathRate *= modifier.breathRateMultiplier;\n        }\n        if (modifier.particleRateMultiplier !== undefined) {\n            modified.particleRate = Math.round(modified.particleRate * modifier.particleRateMultiplier);\n        }\n        if (modifier.coreSizeMultiplier !== undefined) {\n            modified.coreSize *= modifier.coreSizeMultiplier;\n        }\n\n        // Apply amplification/dampening factors\n        if (modifier.amplificationFactor !== undefined) {\n            const factor = modifier.amplificationFactor;\n            modified.glowIntensity *= factor;\n            modified.breathRate *= factor;\n            modified.particleRate = Math.round(modified.particleRate * factor);\n            modified.coreSize *= factor;\n        }\n        if (modifier.dampeningFactor !== undefined) {\n            const factor = modifier.dampeningFactor;\n            modified.glowIntensity *= factor;\n            modified.breathRate *= factor;\n            modified.particleRate = Math.round(modified.particleRate * factor);\n            modified.coreSize *= factor;\n        }\n\n        // Add special properties\n        if (modifier.jitterAmount !== undefined) {\n            modified.jitterAmount = modifier.jitterAmount;\n        }\n\n        return modified;\n    }\n\n    /**\n     * Updates the state machine with delta time\n     * @param {number} deltaTime - Time since last update in milliseconds\n     */\n    update(deltaTime) {\n        this.errorBoundary.wrap(() => {\n            // Update emotional transition\n            if (this.transitions.emotional.isActive) {\n                this.updateEmotionalTransition(deltaTime);\n            }\n            \n            // Update undertone transition\n            if (this.transitions.undertone.isActive) {\n                this.updateUndertoneTransition(deltaTime);\n            }\n        }, 'state-machine-update')();\n    }\n\n    /**\n     * Updates undertone transition progress\n     * @param {number} deltaTime - Time since last update in milliseconds\n     */\n    updateUndertoneTransition(deltaTime) {\n        const transition = this.transitions.undertone;\n        \n        // Calculate elapsed time\n        const elapsed = performance.now() - transition.startTime;\n        const progress = Math.min(elapsed / transition.duration, 1);\n        \n        // Apply easing\n        const easedProgress = easeInOutCubic(progress);\n        \n        // Update weights for smooth transition\n        if (transition.current && transition.target) {\n            // Transitioning between two undertones\n            transition.currentWeight = 1 - easedProgress;\n            transition.targetWeight = easedProgress;\n        } else if (transition.current && !transition.target) {\n            // Fading out current undertone\n            transition.currentWeight = 1 - easedProgress;\n            transition.targetWeight = 0;\n        } else if (!transition.current && transition.target) {\n            // Fading in new undertone\n            transition.currentWeight = 0;\n            transition.targetWeight = easedProgress;\n        }\n        \n        transition.progress = progress;\n        \n        // Complete transition\n        if (progress >= 1) {\n            transition.isActive = false;\n            transition.current = transition.target;\n            transition.currentWeight = transition.target ? 1 : 0;\n            transition.targetWeight = 0;\n        }\n    }\n    \n    /**\n     * Updates emotional state transition progress\n     * @param {number} deltaTime - Time since last update in milliseconds\n     */\n    updateEmotionalTransition(deltaTime) {\n        const transition = this.transitions.emotional;\n        \n        // Use either real elapsed time or simulated deltaTime for testing\n        let elapsed;\n        if (this._simulatedTime !== undefined) {\n            // For testing - use accumulated simulated time\n            this._simulatedTime += deltaTime;\n            elapsed = this._simulatedTime;\n        } else {\n            // For real usage - use actual elapsed time\n            elapsed = performance.now() - transition.startTime;\n        }\n        \n        // Calculate progress (0 to 1)\n        transition.progress = Math.min(1, elapsed / transition.duration);\n        \n        // Check if transition is complete\n        if (transition.progress >= 1) {\n            transition.isActive = false;\n            transition.current = transition.target;\n            transition.target = null;\n            transition.progress = 1;\n        }\n    }\n\n    /**\n     * Gets the current interpolated emotional properties\n     * @returns {Object} Current emotional properties with smooth transitions\n     */\n    getCurrentEmotionalProperties() {\n        return this.errorBoundary.wrap(() => {\n            const now = performance.now();\n            \n            // Use cached result if still valid\n            if (this.interpolationCache.cachedProperties && \n                (now - this.interpolationCache.lastUpdate) < this.interpolationCache.cacheInterval) {\n                return this.interpolationCache.cachedProperties;\n            }\n            \n            const transition = this.transitions.emotional;\n            let properties;\n\n            if (transition.isActive && transition.target) {\n                // Interpolate between current and target states\n                properties = this.interpolateEmotionalProperties(\n                    transition.current,\n                    transition.target,\n                    transition.progress\n                );\n            } else {\n                // Use current state properties - fallback to neutral if emotion not found\n                const emotionState = this.emotionalStates[this.state.emotion] || this.emotionalStates.neutral;\n                properties = { ...emotionState };\n            }\n\n            // Apply undertone modifiers\n            properties = this.applyUndertone(properties, this.state.undertone);\n            \n            // Cache the result\n            this.interpolationCache.cachedProperties = properties;\n            this.interpolationCache.lastUpdate = now;\n\n            return properties;\n        }, 'emotional-properties', () => this.emotionalStates.neutral)();\n    }\n\n    /**\n     * Interpolates between two emotional states\n     * @param {string} fromEmotion - Source emotion\n     * @param {string} toEmotion - Target emotion\n     * @param {number} progress - Interpolation progress (0-1)\n     * @returns {Object} Interpolated properties\n     */\n    interpolateEmotionalProperties(fromEmotion, toEmotion, progress) {\n        const fromProps = this.emotionalStates[fromEmotion] || this.emotionalStates.neutral;\n        const toProps = this.emotionalStates[toEmotion] || this.emotionalStates.neutral;\n        \n        // Apply easing to progress\n        const easedProgress = applyEasing(progress, 0, 1, 'easeOutCubic');\n\n        return {\n            // Interpolate color in HSL space for better transitions\n            primaryColor: interpolateHsl(fromProps.primaryColor, toProps.primaryColor, easedProgress),\n            \n            // Interpolate numeric properties\n            glowIntensity: fromProps.glowIntensity + (toProps.glowIntensity - fromProps.glowIntensity) * easedProgress,\n            particleRate: Math.round(fromProps.particleRate + (toProps.particleRate - fromProps.particleRate) * easedProgress),\n            coreSize: fromProps.coreSize + (toProps.coreSize - fromProps.coreSize) * easedProgress,\n            breathRate: fromProps.breathRate + (toProps.breathRate - fromProps.breathRate) * easedProgress,\n            breathDepth: fromProps.breathDepth + (toProps.breathDepth - fromProps.breathDepth) * easedProgress,\n            \n            // Use target behavior when transition is more than 50% complete\n            particleBehavior: easedProgress > 0.5 ? toProps.particleBehavior : fromProps.particleBehavior\n        };\n    }\n\n    /**\n     * Gets the current state for external inspection\n     * @returns {Object} Current state information\n     */\n    getCurrentState() {\n        return {\n            emotion: this.state.emotion,\n            undertone: this.state.undertone,\n            isTransitioning: this.transitions.emotional.isActive,\n            transitionProgress: this.transitions.emotional.progress,\n            properties: this.getCurrentEmotionalProperties()\n        };\n    }\n\n    /**\n     * Applies an undertone to the current emotional state\n     * @param {string|null} undertone - Undertone to apply\n     * @returns {boolean} Success status\n     */\n    applyUndertoneModifier(undertone) {\n        return this.errorBoundary.wrap(() => {\n            // Validate undertone\n            if (undertone !== null && !this.undertoneModifiers.hasOwnProperty(undertone)) {\n                throw new Error(`Invalid undertone: ${undertone}. Valid undertones: ${Object.keys(this.undertoneModifiers).join(', ')}`);\n            }\n\n            // Apply the undertone\n            this.state.undertone = undertone;\n            \n            return true;\n        }, 'undertone-application', false)();\n    }\n\n    /**\n     * Clears the current undertone and resets to base emotional state\n     */\n    clearUndertone() {\n        this.state.undertone = null;\n    }\n\n    /**\n     * Gets the raw undertone modifier data for a specific undertone\n     * @param {string} undertone - Undertone name\n     * @returns {Object|null} Undertone modifier data or null if invalid\n     */\n    getUndertoneModifier(undertone) {\n        return this.errorBoundary.wrap(() => {\n            // Try to get from renderer first (comprehensive modifiers)\n            if (this.renderer && this.renderer.undertoneModifiers && \n                this.renderer.undertoneModifiers[undertone]) {\n                // Return the full modifier from renderer\n                return { ...this.renderer.undertoneModifiers[undertone] };\n            }\n            \n            // Fallback to local modifiers\n            if (!undertone || !this.undertoneModifiers.hasOwnProperty(undertone)) {\n                return null;\n            }\n            // Ensure essential properties exist in fallback\n            const localMod = { ...this.undertoneModifiers[undertone] };\n            if (!localMod.glowRadiusMult) {\n                localMod.glowRadiusMult = 1.0; // Default value\n            }\n            return localMod;\n        }, 'undertone-retrieval', null)();\n    }\n    \n    /**\n     * Gets weighted undertone modifiers based on current transition state\n     * @returns {Object|null} Combined undertone modifiers with transition weights applied\n     */\n    getWeightedUndertoneModifiers() {\n        const transition = this.transitions.undertone;\n        \n        // If no transition is active, return current undertone modifiers directly\n        if (!transition.isActive) {\n            if (this.state.undertone) {\n                const mod = this.getUndertoneModifier(this.state.undertone);\n                if (mod) {\n                    // Return full modifier with weight of 1.0 (fully applied) and type\n                    return { ...mod, weight: 1.0, type: this.state.undertone };\n                }\n            }\n            return null;\n        }\n        \n        // During transition, return the target modifier with interpolated weight\n        if (transition.target) {\n            const targetMod = this.getUndertoneModifier(transition.target);\n            if (targetMod) {\n                // Return target modifier with transition weight and type\n                return { ...targetMod, weight: transition.targetWeight, type: transition.target };\n            }\n        }\n        \n        // Fading out - return current modifier with decreasing weight  \n        if (transition.current && transition.currentWeight > 0) {\n            const currentMod = this.getUndertoneModifier(transition.current);\n            if (currentMod) {\n                return { ...currentMod, weight: transition.currentWeight, type: transition.current };\n            }\n        }\n        \n        return null;\n    }\n\n    /**\n     * Resets the state machine to neutral emotion\n     * @param {number} duration - Transition duration in milliseconds\n     */\n    reset(duration = 500) {\n        this.setEmotion('neutral', null, duration);\n    }\n\n    /**\n     * Validates if an emotion is valid\n     * @param {string} emotion - Emotion to validate\n     * @returns {boolean} True if valid\n     */\n    isValidEmotion(emotion) {\n        return this.emotionalStates.hasOwnProperty(emotion);\n    }\n\n    /**\n     * Validates if an undertone is valid\n     * @param {string} undertone - Undertone to validate\n     * @returns {boolean} True if valid\n     */\n    isValidUndertone(undertone) {\n        return undertone === null || this.undertoneModifiers.hasOwnProperty(undertone);\n    }\n\n    /**\n     * Gets all available emotions\n     * @returns {Array} Array of emotion names\n     */\n    getAvailableEmotions() {\n        return Object.keys(this.emotionalStates);\n    }\n\n    /**\n     * Gets all available undertones\n     * @returns {Array} Array of undertone names\n     */\n    getAvailableUndertones() {\n        return Object.keys(this.undertoneModifiers);\n    }\n\n    /**\n     * Checks if a transition is currently active\n     * @returns {boolean} True if transitioning\n     */\n    isTransitioning() {\n        return this.transitions.emotional.isActive;\n    }\n\n    /**\n     * Gets the current transition progress\n     * @returns {number} Progress from 0 to 1, or 1 if not transitioning\n     */\n    getTransitionProgress() {\n        return this.transitions.emotional.isActive ? this.transitions.emotional.progress : 1;\n    }\n\n    /**\n     * Forces completion of current transition\n     */\n    completeTransition() {\n        if (this.transitions.emotional.isActive) {\n            this.transitions.emotional.progress = 1;\n            this.transitions.emotional.isActive = false;\n            this.transitions.emotional.current = this.transitions.emotional.target;\n            this.transitions.emotional.target = null;\n        }\n    }\n\n    /**\n     * Gets interpolated property value with easing\n     * @param {number} from - Start value\n     * @param {number} to - End value  \n     * @param {number} progress - Progress (0-1)\n     * @param {string} easingType - Easing function name\n     * @returns {number} Interpolated value\n     */\n    interpolateProperty(from, to, progress, easingType = 'easeOutCubic') {\n        return from + (to - from) * applyEasing(progress, 0, 1, easingType);\n    }\n\n    /**\n     * Enables simulated time for testing purposes\n     * @param {boolean} enabled - Whether to use simulated time\n     */\n    enableSimulatedTime(enabled = true) {\n        if (enabled) {\n            this._simulatedTime = 0;\n        } else {\n            delete this._simulatedTime;\n        }\n    }\n}\n\nexport default EmotiveStateMachine;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Color Utilities\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Color selection and manipulation utilities for particles\r\n * @author Emotive Engine Team\r\n * @module particles/utils/colorUtils\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Handles weighted color selection for particles. Each emotion has a palette of     \r\n * ║ colors with different weights (probabilities). This creates visual variety        \r\n * ║ while maintaining the emotional theme.                                            \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\n/**\r\n * Select a color from an array with optional weights\r\n * \r\n * EXAMPLE INPUT:\r\n * [\r\n *   { color: '#FF69B4', weight: 30 },  // 30% chance\r\n *   { color: '#FFB6C1', weight: 25 },  // 25% chance\r\n *   { color: '#FF1493', weight: 20 },  // 20% chance\r\n *   '#FFC0CB',                          // Remaining weight split evenly\r\n *   '#C71585'                           // between unweighted colors\r\n * ]\r\n * \r\n * @param {Array} colors - Array of color strings or {color, weight} objects\r\n * @returns {string} Selected hex color\r\n */\r\nexport function selectWeightedColor(colors) {\r\n    if (!colors || colors.length === 0) return '#FFFFFF';\r\n    \r\n    // Parse colors and weights\r\n    let totalExplicitWeight = 0;\r\n    let unweightedCount = 0;\r\n    const parsedColors = [];\r\n    \r\n    for (const item of colors) {\r\n        if (typeof item === 'string') {\r\n            // Simple string color - will get default weight\r\n            parsedColors.push({ color: item, weight: null });\r\n            unweightedCount++;\r\n        } else if (item && typeof item === 'object' && item.color) {\r\n            // Object with color and optional weight\r\n            parsedColors.push({ color: item.color, weight: item.weight || null });\r\n            if (item.weight) {\r\n                totalExplicitWeight += item.weight;\r\n            } else {\r\n                unweightedCount++;\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Calculate weight for unweighted colors\r\n    // If weights total 75, and there are 2 unweighted colors, each gets 12.5\r\n    const remainingWeight = Math.max(0, 100 - totalExplicitWeight);\r\n    const defaultWeight = unweightedCount > 0 ? remainingWeight / unweightedCount : 0;\r\n    \r\n    // Build cumulative probability table for efficient selection\r\n    const probTable = [];\r\n    let cumulative = 0;\r\n    \r\n    for (const item of parsedColors) {\r\n        const weight = item.weight !== null ? item.weight : defaultWeight;\r\n        cumulative += weight;\r\n        probTable.push({ color: item.color, threshold: cumulative });\r\n    }\r\n    \r\n    // Select based on random value\r\n    const random = Math.random() * cumulative;\r\n    for (const entry of probTable) {\r\n        if (random <= entry.threshold) {\r\n            return entry.color;\r\n        }\r\n    }\r\n    \r\n    // Fallback to last color (shouldn't happen but safety first)\r\n    return parsedColors[parsedColors.length - 1].color;\r\n}\r\n\r\n/**\r\n * Convert hex color to RGB object\r\n * @param {string} hex - Hex color string (#RRGGBB)\r\n * @returns {Object} RGB values {r, g, b}\r\n */\r\nexport function hexToRgb(hex) {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result ? {\r\n        r: parseInt(result[1], 16),\r\n        g: parseInt(result[2], 16),\r\n        b: parseInt(result[3], 16)\r\n    } : { r: 255, g: 255, b: 255 }; // Default to white\r\n}\r\n\r\n/**\r\n * Convert RGB values to hex string\r\n * @param {number} r - Red (0-255)\r\n * @param {number} g - Green (0-255)\r\n * @param {number} b - Blue (0-255)\r\n * @returns {string} Hex color string\r\n */\r\nexport function rgbToHex(r, g, b) {\r\n    return '#' + [r, g, b].map(x => {\r\n        const hex = x.toString(16);\r\n        return hex.length === 1 ? '0' + hex : hex;\r\n    }).join('');\r\n}\r\n\r\n/**\r\n * Blend two colors together\r\n * @param {string} color1 - First hex color\r\n * @param {string} color2 - Second hex color\r\n * @param {number} ratio - Blend ratio (0=color1, 1=color2)\r\n * @returns {string} Blended hex color\r\n */\r\nexport function blendColors(color1, color2, ratio) {\r\n    const rgb1 = hexToRgb(color1);\r\n    const rgb2 = hexToRgb(color2);\r\n    \r\n    const r = Math.round(rgb1.r + (rgb2.r - rgb1.r) * ratio);\r\n    const g = Math.round(rgb1.g + (rgb2.g - rgb1.g) * ratio);\r\n    const b = Math.round(rgb1.b + (rgb2.b - rgb1.b) * ratio);\r\n    \r\n    return rgbToHex(r, g, b);\r\n}\r\n\r\nexport default {\r\n    selectWeightedColor,\r\n    hexToRgb,\r\n    rgbToHex,\r\n    blendColors\r\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Ambient Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Gentle upward drift behavior for neutral emotional state\n * @author Emotive Engine Team\n * @module particles/behaviors/ambient\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a calm, peaceful atmosphere with particles gently drifting upward         \n * ║ like smoke or steam. This is the default behavior for neutral emotional states.   \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *        ↑  ↑  ↑\n *       ·  ·  ·    ← particles drift straight up\n *      ·  ·  ·  \n *     ·  ⭐  ·     ← orb center\n *      ·  ·  ·\n *       ·  ·  ·\n * \n * USED BY EMOTIONS:\n * - neutral (default calm state)\n * \n * RECIPE TO MODIFY:\n * - Increase upwardSpeed for faster rising (more energy)\n * - Decrease friction for longer-lasting momentum\n * - Add waviness for side-to-side motion (currently disabled)\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\n\n/**\n * Initialize ambient behavior for a particle\n * Sets up initial velocities and behavior-specific data\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeAmbient(particle) {\n    // Start with gentle upward movement\n    particle.vx = 0;  // NO horizontal drift\n    particle.vy = -0.04 - Math.random() * 0.02;  // Slower upward movement\n    particle.lifeDecay = 0.002;  // Even slower fade - particles last ~8 seconds\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        // Languid upward drift\n        upwardSpeed: 0.0005,      // Very slow continuous upward drift\n        waviness: 0,              // NO side-to-side (set to 0.5-2 for wave motion)\n        friction: 0.998           // Even more gradual slowdown\n    };\n}\n\n/**\n * Update ambient behavior each frame\n * Applies gentle upward drift with air resistance\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (frame time)\n * @param {number} centerX - Orb center X (unused but kept for consistency)\n * @param {number} centerY - Orb center Y (unused but kept for consistency)\n */\nexport function updateAmbient(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // Apply friction to y velocity only (frame-rate independent)\n    // Use exponential decay: friction^dt where dt is normalized to 60fps\n    particle.vy *= Math.pow(data.friction, dt);\n    \n    // Add continuous upward drift\n    particle.vy -= data.upwardSpeed * dt;\n    \n    // NO horizontal movement or waviness (zen-like straight up)\n    particle.vx = 0;\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'ambient',\n    emoji: '☁️',\n    description: 'Gentle upward drift like smoke',\n    initialize: initializeAmbient,\n    update: updateAmbient\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Particle Physics Configuration\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Physics constants for particle behavior\n * @author Emotive Engine Team\n * @module particles/config/physics\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Core physics values that control how particles move and interact with the world.  \n * ║ Modify these with caution as they affect all particle behaviors globally.         \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n */\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ PHYSICS CONSTANTS - Core physics values (modify with caution)\n// └─────────────────────────────────────────────────────────────────────────────────────\nexport const PHYSICS = {\n    GRAVITY: 0.098,           // Downward acceleration (Earth-like)\n    AIR_RESISTANCE: 0.99,     // Velocity dampening per frame\n    BOUNCE_DAMPENING: 0.5,    // Energy lost on boundary collision\n    MIN_VELOCITY: 0.01,       // Velocity below this is set to 0\n    MAX_VELOCITY: 10,         // Speed limit to prevent runaway particles\n    BOUNDARY_MARGIN: 20,      // Pixels from canvas edge\n    \n    // Math constants\n    TWO_PI: Math.PI * 2,\n    HALF_PI: Math.PI / 2,\n    QUARTER_PI: Math.PI / 4\n};\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ LIFECYCLE CONSTANTS - Particle birth/death timing\n// └─────────────────────────────────────────────────────────────────────────────────────\nexport const LIFECYCLE = {\n    FADE_IN_PERCENT: 0.15,    // First 15% of life fades in\n    FADE_OUT_PERCENT: 0.30,   // Last 30% of life fades out\n    MIN_LIFESPAN: 50,         // Minimum frames before death\n    MAX_LIFESPAN: 500,        // Maximum frames before death\n    DEFAULT_DECAY: 0.01       // Standard life lost per frame\n};\n\nexport default { PHYSICS, LIFECYCLE };","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Orbiting Behavior\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Romantic orbiting behavior for love emotional state\r\n * @author Emotive Engine Team\r\n * @module particles/behaviors/orbiting\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a romantic atmosphere with particles orbiting the orb like fireflies      \r\n * ║ dancing at a valentine's day party. Features individual blinking and sparkles.    \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *        ✨     ✨\r\n *      💕  ╭───╮  💕    ← particles orbit & sparkle\r\n *    ✨   │  ⭐  │   ✨   ← orb center\r\n *      💕  ╰───╯  💕\r\n *        ✨     ✨\r\n * \r\n * USED BY EMOTIONS:\r\n * - love (romantic valentine vibes)\r\n * \r\n * RECIPE TO MODIFY:\r\n * - Increase angularVelocity for faster spinning\r\n * - Increase floatAmount for more vertical movement\r\n * - Adjust blinkSpeed for different firefly effects\r\n * - Increase baseRadius for wider orbits\r\n */\r\n\r\nimport { selectWeightedColor } from '../utils/colorUtils.js';\r\nimport { PHYSICS } from '../config/physics.js';\r\n\r\n// Rhythm configuration for orbiting particles\r\nexport const rhythmConfig = {\r\n    enabled: true,\r\n    \r\n    // Orbital speed syncs to tempo\r\n    orbitSpeed: {\r\n        baseSync: 'tempo',       // Speed scales with BPM\r\n        beatAcceleration: 1.3,   // Speed up on beat\r\n        offBeatSpeed: 0.9        // Slow between beats\r\n    },\r\n    \r\n    // Radius pulses with rhythm\r\n    radiusPulse: {\r\n        subdivision: 'quarter',  // Pulse on quarter notes\r\n        amount: 0.1,            // 10% radius variation\r\n        curve: 'ease'           // Smooth pulsing\r\n    },\r\n    \r\n    // Twinkle/sparkle syncs to beat\r\n    twinkleSync: {\r\n        onBeat: true,           // Extra sparkles on beat\r\n        intensity: 2.0,         // Double sparkle on beat\r\n        probability: 0.3        // 30% chance per beat\r\n    },\r\n    \r\n    // Pattern-specific behaviors\r\n    patterns: {\r\n        'waltz': {\r\n            // Elegant 3/4 waltz orbiting\r\n            orbitSpeed: { beatAcceleration: 1.1 },\r\n            radiusPulse: { amount: 0.15 }\r\n        },\r\n        'swing': {\r\n            // Jazzy swing orbiting\r\n            orbitSpeed: { beatAcceleration: 1.5 },\r\n            twinkleSync: { intensity: 3.0 }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Initialize orbiting behavior for a particle\r\n * Creates valentine fireflies with individual timing\r\n * \r\n * @param {Particle} particle - The particle to initialize\r\n */\r\nexport function initializeOrbiting(particle) {\r\n    // Individual fade timing - each particle has its own lifespan\r\n    particle.lifeDecay = 0.001 + Math.random() * 0.002;  // Variable decay (0.001-0.003)\r\n    \r\n    // Use emotion colors if provided - glittery valentine palette\r\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\r\n        particle.color = selectWeightedColor(particle.emotionColors);\r\n    }\r\n    \r\n    // Check if this is a lighter/sparkle color (light pinks)\r\n    particle.isSparkle = particle.color === '#FFE4E1' || \r\n                        particle.color === '#FFCCCB' || \r\n                        particle.color === '#FFC0CB';\r\n    \r\n    // Particles orbit at various distances for depth\r\n    const orbRadius = (particle.scaleFactor || 1) * 40; // Approximate orb size\r\n    const depthLayer = Math.random();\r\n    const baseRadius = orbRadius * (1.3 + depthLayer * 0.9); // 1.3x to 2.2x orb radius\r\n    \r\n    // Glitter firefly properties - each with unique timing\r\n    particle.blinkPhase = Math.random() * PHYSICS.TWO_PI; // Random starting phase\r\n    particle.blinkSpeed = 0.3 + Math.random() * 1.2; // Varied blink speeds (0.3-1.5)\r\n    particle.blinkIntensity = 0.6 + Math.random() * 0.4; // How bright the blink gets\r\n    \r\n    // Individual fade properties\r\n    particle.fadePhase = Math.random() * PHYSICS.TWO_PI; // Random fade starting phase\r\n    particle.fadeSpeed = 0.1 + Math.random() * 0.3; // Different fade speeds\r\n    particle.minOpacity = 0.2 + Math.random() * 0.2; // Min brightness varies (0.2-0.4)\r\n    particle.maxOpacity = 0.8 + Math.random() * 0.2; // Max brightness varies (0.8-1.0)\r\n    \r\n    // Sparkles have different properties\r\n    if (particle.isSparkle) {\r\n        particle.blinkSpeed *= 2; // Sparkles blink faster\r\n        particle.blinkIntensity = 1.0; // Full intensity sparkles\r\n        particle.minOpacity = 0; // Can fade to nothing\r\n        particle.maxOpacity = 1.0; // Can be fully bright\r\n    }\r\n    \r\n    particle.behaviorData = {\r\n        angle: Math.random() * PHYSICS.TWO_PI,\r\n        radius: baseRadius,\r\n        baseRadius: baseRadius,\r\n        angularVelocity: 0.0008 + Math.random() * 0.0017,  // Varied rotation speeds\r\n        swayAmount: 3 + Math.random() * 7,  // Gentle floating sway\r\n        swaySpeed: 0.2 + Math.random() * 0.5,  // Varied sway rhythm\r\n        floatOffset: Math.random() * PHYSICS.TWO_PI,  // Random vertical float phase\r\n        floatSpeed: 0.3 + Math.random() * 0.7,  // Varied vertical floating speed\r\n        floatAmount: 2 + Math.random() * 6,  // How much they float up/down\r\n        twinklePhase: Math.random() * PHYSICS.TWO_PI,  // Individual twinkle timing\r\n        twinkleSpeed: 2 + Math.random() * 3  // Fast twinkle for glitter effect\r\n    };\r\n}\r\n\r\n/**\r\n * Update orbiting behavior each frame\r\n * Creates romantic firefly dance with sparkles\r\n * \r\n * @param {Particle} particle - The particle to update\r\n * @param {number} dt - Delta time (frame time)\r\n * @param {number} centerX - Orb center X position\r\n * @param {number} centerY - Orb center Y position\r\n */\r\nexport function updateOrbiting(particle, dt, centerX, centerY) {\r\n    const data = particle.behaviorData;\r\n\r\n    // Slow romantic rotation around the orb\r\n    data.angle += data.angularVelocity * dt;\r\n\r\n    // Gentle swaying motion\r\n    const swayOffset = Math.sin(data.angle * data.swaySpeed) * data.swayAmount;\r\n\r\n    // Radius changes for breathing effect\r\n    const radiusPulse = Math.sin(data.angle * 1.5) * 6;\r\n\r\n    // Use data.radius if it exists (can be modified by gestures), otherwise use baseRadius\r\n    const currentRadius = (data.radius || data.baseRadius) + radiusPulse + swayOffset * 0.2;\r\n\r\n    // Calculate desired orbital position\r\n    const targetX = centerX + Math.cos(data.angle) * currentRadius;\r\n    const targetY = centerY + Math.sin(data.angle) * currentRadius;\r\n\r\n    // Add gentle vertical floating (like fireflies)\r\n    data.floatOffset += data.floatSpeed * dt * 0.001;\r\n    const verticalFloat = Math.sin(data.floatOffset) * data.floatAmount;\r\n\r\n    // Smoothly move towards target position instead of directly setting it\r\n    // This allows gestures to temporarily offset particles\r\n    const smoothingFactor = 0.1; // How quickly particles return to orbit\r\n    particle.vx = (targetX - particle.x) * smoothingFactor;\r\n    particle.vy = (targetY + verticalFloat - particle.y) * smoothingFactor;\r\n    \r\n    // Update individual fade phase\r\n    particle.fadePhase += particle.fadeSpeed * dt * 0.001;\r\n    \r\n    // Calculate individual particle fade (independent timing)\r\n    const fadeValue = Math.sin(particle.fadePhase) * 0.5 + 0.5; // 0 to 1\r\n    const fadeOpacity = particle.minOpacity + (particle.maxOpacity - particle.minOpacity) * fadeValue;\r\n    \r\n    // Firefly blinking effect\r\n    particle.blinkPhase += particle.blinkSpeed * dt * 0.002;\r\n    \r\n    // Create a complex glitter blink with multiple harmonics\r\n    let blinkValue;\r\n    if (particle.isSparkle) {\r\n        // Sparkles have sharp, dramatic twinkles\r\n        data.twinklePhase += data.twinkleSpeed * dt * 0.001;\r\n        const twinkle = Math.pow(Math.sin(data.twinklePhase), 16); // Sharp peaks\r\n        const shimmer = Math.sin(particle.blinkPhase * 5) * 0.2;\r\n        blinkValue = twinkle * 0.7 + shimmer + 0.1;\r\n    } else {\r\n        // Regular particles have smoother, firefly-like pulses\r\n        blinkValue = Math.sin(particle.blinkPhase) * 0.4 + \r\n                    Math.sin(particle.blinkPhase * 3) * 0.3 +\r\n                    Math.sin(particle.blinkPhase * 7) * 0.2 +\r\n                    Math.sin(particle.blinkPhase * 11) * 0.1; // Added harmonic\r\n    }\r\n    \r\n    // Map to 0-1 range with intensity control\r\n    const normalizedBlink = (blinkValue + 1) * 0.5; // Convert from -1,1 to 0,1\r\n    const blink = 0.2 + normalizedBlink * particle.blinkIntensity * 0.8;\r\n    \r\n    // Combine individual fade with blink effect\r\n    particle.opacity = particle.baseOpacity * fadeOpacity * blink;\r\n    \r\n    // Sparkles pulse size more dramatically\r\n    if (particle.isSparkle) {\r\n        particle.size = particle.baseSize * (0.5 + normalizedBlink * 1.0); // 50-150% size\r\n    } else {\r\n        particle.size = particle.baseSize * (0.8 + normalizedBlink * 0.3); // 80-110% size\r\n    }\r\n    \r\n    // Add subtle color shift for sparkles (shimmer effect)\r\n    if (particle.isSparkle) {\r\n        // Light pink sparkles can shift to white at peak brightness\r\n        if (normalizedBlink > 0.85) {\r\n            particle.tempColor = '#FFFFFF'; // Flash white at peak for extra sparkle\r\n        } else {\r\n            particle.tempColor = particle.color;\r\n        }\r\n    }\r\n}\r\n\r\n// Export behavior definition for registry\r\nexport default {\r\n    name: 'orbiting',\r\n    emoji: '💕',\r\n    description: 'Romantic firefly dance around the orb',\r\n    initialize: initializeOrbiting,\r\n    update: updateOrbiting\r\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Rising Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Buoyant upward movement for joyful states\n * @author Emotive Engine Team\n * @module particles/behaviors/rising\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a buoyant, uplifting atmosphere with particles rising like bubbles        \n * ║ or balloons. Slight horizontal drift adds organic movement.                       \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *      ↗  ↑  ↖\n *     ·  ·  ·    ← particles rise with drift\n *    ·  ·  ·  \n *   ·  ⭐  ·     ← orb center\n *    ·  ·  ·\n *     ·  ·  ·\n * \n * USED BY EMOTIONS:\n * - joy (subtle happiness)\n * - optimism\n * \n * RECIPE TO MODIFY:\n * - Increase buoyancy for faster rising (like helium balloons)\n * - Increase driftAmount for more side-to-side movement\n * - Decrease air resistance for longer-lasting momentum\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\n\n/**\n * Initialize rising behavior for a particle\n * Sets up buoyant upward movement with gentle drift\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeRising(particle) {\n    particle.vx = (Math.random() - 0.5) * 0.02;  // Even slower horizontal drift\n    particle.vy = -0.05 - Math.random() * 0.03;   // Much slower upward movement\n    particle.lifeDecay = 0.002;                   // Very slow decay\n    particle.baseOpacity = 0.7 + Math.random() * 0.3;  // More opaque (70-100%)\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        buoyancy: 0.001,      // Even gentler upward force\n        driftAmount: 0.005    // Minimal drift\n    };\n}\n\n/**\n * Update rising behavior each frame\n * Applies buoyancy and gentle drift\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (frame time)\n * @param {number} centerX - Orb center X (unused)\n * @param {number} centerY - Orb center Y (unused)\n */\nexport function updateRising(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // Add buoyancy (upward force)\n    particle.vy -= data.buoyancy * dt;\n    \n    // Add horizontal drift\n    particle.vx += (Math.random() - 0.5) * data.driftAmount * dt;\n    \n    // Apply air resistance (frame-independent)\n    particle.vx *= Math.pow(0.995, dt);\n    particle.vy *= Math.pow(0.998, dt);\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'rising',\n    emoji: '🎈',\n    description: 'Buoyant upward movement like balloons',\n    initialize: initializeRising,\n    update: updateRising\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Falling Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Heavy downward drift for sad emotional states\n * @author Emotive Engine Team\n * @module particles/behaviors/falling\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a melancholic atmosphere with particles slowly falling like tears         \n * ║ or autumn leaves. Heavy, weighted movement conveys sadness.                       \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *     ·  ·  ·\n *    ·  ·  ·  \n *   ·  ⭐  ·     ← orb center\n *    ·  ·  ·\n *     ·  ·  ·    ← particles fall slowly\n *      ↓  ↓  ↓\n * \n * USED BY EMOTIONS:\n * - sadness (melancholy, grief)\n * - disappointment\n * - tired\n * \n * RECIPE TO MODIFY:\n * - Increase gravity for heavier falling (more weight)\n * - Decrease drag for faster falling (less air resistance)\n * - Add horizontal drift for leaf-like falling\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\n\n/**\n * Initialize falling behavior for a particle\n * Sets up slow, heavy downward movement\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeFalling(particle) {\n    particle.vx = (Math.random() - 0.5) * 0.03;   // MUCH slower horizontal drift\n    particle.vy = 0.05 + Math.random() * 0.05;    // MUCH slower falling\n    particle.lifeDecay = 0.002;                   // Very slow decay\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        gravity: 0.002,       // Very gentle gravity\n        drag: 0.995           // High drag for slow fall\n    };\n}\n\n/**\n * Update falling behavior each frame\n * Applies gravity with air resistance\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (frame time)\n * @param {number} centerX - Orb center X (unused)\n * @param {number} centerY - Orb center Y (unused)\n */\nexport function updateFalling(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // Apply gravity\n    particle.vy += data.gravity * dt;\n    \n    // Apply drag (frame-independent)\n    particle.vx *= Math.pow(data.drag, dt);\n    particle.vy *= Math.pow(data.drag, dt);\n    \n    // Limit terminal velocity\n    if (particle.vy > 2) {\n        particle.vy = 2;\n    }\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'falling',\n    emoji: '💧',\n    description: 'Heavy downward drift like tears',\n    initialize: initializeFalling,\n    update: updateFalling\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Playground Configuration 🎮\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Safe values for experimentation and tweaking\n * @author Emotive Engine Team\n * @module particles/config/playground\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                            🎮 PLAYGROUND VALUES                                   \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ SAFE TO MODIFY! These values are designed for experimentation.                    \n * ║ Change them to create new visual effects and behaviors.                           \n * ║                                                                                    \n * ║ TIP: After changing values, refresh your browser to see the effects!              \n * ║ TIP: Set window.DEBUG_PARTICLES = true in console to visualize changes            \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n */\n\nexport const PLAYGROUND = {\n    // ┌─────────────────────────────────────────────────────────────────────────────────\n    // │ PARTICLE APPEARANCE - How particles look\n    // └─────────────────────────────────────────────────────────────────────────────────\n    particle: {\n        MIN_SIZE: 4,           // 🎯 Smallest particle (pixels) - Try: 2-10\n        MAX_SIZE: 10,          // 🎯 Largest particle (pixels) - Try: 5-20\n        GLOW_CHANCE: 0.33,     // 🎯 Chance of glowing (0=never, 1=always)\n        CELL_SHADE_CHANCE: 0.33, // 🎯 Chance of cartoon style (0=never, 1=always)\n        BASE_OPACITY: 1.0      // 🎯 Starting opacity (0=invisible, 1=solid)\n    },\n    \n    // ┌─────────────────────────────────────────────────────────────────────────────────\n    // │ SPARKLE & SHIMMER - Valentine firefly effects (love state)\n    // └─────────────────────────────────────────────────────────────────────────────────\n    sparkle: {\n        BLINK_SPEED_MIN: 0.3,  // 🎯 Slowest blink rate - Try: 0.1-1.0\n        BLINK_SPEED_MAX: 1.5,  // 🎯 Fastest blink rate - Try: 0.5-3.0\n        INTENSITY_MIN: 0.6,    // 🎯 Dimmest sparkle - Try: 0.3-0.8\n        INTENSITY_MAX: 1.0,    // 🎯 Brightest sparkle - Try: 0.8-1.2\n        SIZE_PULSE: 0.3        // 🎯 Size change during sparkle - Try: 0.1-0.5\n    },\n    \n    // ┌─────────────────────────────────────────────────────────────────────────────────\n    // │ POPCORN BEHAVIOR - Joy particles that pop!\n    // └─────────────────────────────────────────────────────────────────────────────────\n    popcorn: {\n        POP_DELAY_MIN: 100,    // 🎯 Fastest pop (ms) - Try: 50-500\n        POP_DELAY_MAX: 2000,   // 🎯 Slowest pop (ms) - Try: 1000-5000\n        POP_FORCE_MIN: 3,      // 🎯 Weakest pop - Try: 1-5\n        POP_FORCE_MAX: 8,      // 🎯 Strongest pop - Try: 5-15\n        BOUNCE_HEIGHT: 0.7     // 🎯 Bounce energy retained - Try: 0.3-0.9\n    },\n    \n    // ┌─────────────────────────────────────────────────────────────────────────────────\n    // │ EMOTION INTENSITIES - How dramatic each emotion appears\n    // └─────────────────────────────────────────────────────────────────────────────────\n    emotions: {\n        ANGER_SHAKE: 2.0,      // 🎯 Anger intensity - Try: 1.0-3.0\n        FEAR_JITTER: 1.5,      // 🎯 Fear nervousness - Try: 0.5-2.5\n        LOVE_SWAY: 1.2,        // 🎯 Love romance - Try: 0.8-2.0\n        JOY_BOUNCE: 1.8,       // 🎯 Joy energy - Try: 1.0-3.0\n        SADNESS_WEIGHT: 0.6    // 🎯 Sadness heaviness - Try: 0.3-0.8\n    }\n};\n\n/**\n * ┌─────────────────────────────────────────────────────────────────────────────────────\n * │ 📝 RECIPES FOR COMMON MODIFICATIONS\n * └─────────────────────────────────────────────────────────────────────────────────────\n * \n * MAKE PARTICLES MORE ENERGETIC:\n * - Increase JOY_BOUNCE to 2.5+\n * - Decrease POP_DELAY_MIN to 50\n * - Increase POP_FORCE_MAX to 12\n * \n * MAKE PARTICLES MORE ROMANTIC:\n * - Increase LOVE_SWAY to 1.8\n * - Increase BLINK_SPEED_MAX to 2.0\n * - Increase SIZE_PULSE to 0.5\n * \n * MAKE PARTICLES MORE DRAMATIC:\n * - Increase all emotion intensities by 50%\n * - Increase MAX_SIZE to 15\n * - Set GLOW_CHANCE to 0.7\n * \n * MAKE PARTICLES MORE SUBTLE:\n * - Decrease all emotion intensities by 50%\n * - Decrease MAX_SIZE to 6\n * - Set BASE_OPACITY to 0.7\n */\n\nexport default PLAYGROUND;","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Popcorn Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Spontaneous popping with bounces for joyful celebration\n * @author Emotive Engine Team\n * @module particles/behaviors/popcorn\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a celebratory atmosphere with particles that wait, then POP! and bounce   \n * ║ around with gravity. Perfect for pure joy and celebration moments.                \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *     Stage 1: Wait      Stage 2: POP!       Stage 3: Bounce\n *         ·                  💥 ↗             ↘ \n *        ···                ↖ 💥 ↗              ↓\n *       ·⭐·                  💥                 🎊 ← bounce!\n *        ···                ↙ 💥 ↘              ↑\n *         ·                  💥 ↓               ↗\n * \n * USED BY EMOTIONS:\n * - joy (celebration, happiness, excitement)\n * \n * RECIPE TO MODIFY:\n * - Decrease popDelay for faster popping (more energetic)\n * - Increase popStrength for bigger pops\n * - Adjust gravity for different bounce physics\n * - Increase maxBounces for longer bouncing\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\nimport { PLAYGROUND } from '../config/playground.js';\n\n/**\n * Initialize popcorn behavior for a particle\n * Sets up kernel waiting to pop\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializePopcorn(particle) {\n    // Start with little to no movement (kernel waiting to pop)\n    particle.vx = (Math.random() - 0.5) * 0.1;\n    particle.vy = (Math.random() - 0.5) * 0.1;\n    // Faster, more varied decay for dynamic disappearing\n    particle.lifeDecay = 0.008 + Math.random() * 0.012; // Random between 0.008-0.020\n    \n    // Use emotion colors if provided, otherwise default popcorn colors\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    } else {\n        // Default popcorn colors (buttery whites and yellows)\n        const colors = ['#FFFFFF', '#FFFACD', '#FFF8DC', '#FFFFE0', '#FAFAD2'];\n        particle.color = selectWeightedColor(colors);\n    }\n    \n    // Vary sizes more dramatically - some big fluffy pieces, some small\n    particle.size = (Math.random() < 0.3) ? \n        (8 + Math.random() * 4) * particle.scaleFactor * particle.particleSizeMultiplier : // 30% big\n        (2 + Math.random() * 4) * particle.scaleFactor * particle.particleSizeMultiplier;  // 70% small\n    particle.baseSize = particle.size;\n    \n    // Less glow, more solid popcorn look\n    particle.hasGlow = Math.random() < 0.2; // Only 20% have glow\n    particle.glowSizeMultiplier = particle.hasGlow ? 1.2 : 0;\n    \n    particle.behaviorData = {\n        // Popcorn popping mechanics\n        popDelay: Math.random() * PLAYGROUND.popcorn.POP_DELAY_MAX,\n        hasPopped: false,\n        popStrength: PLAYGROUND.popcorn.POP_FORCE_MIN + \n                    Math.random() * (PLAYGROUND.popcorn.POP_FORCE_MAX - PLAYGROUND.popcorn.POP_FORCE_MIN),\n        \n        // Physics after popping\n        gravity: 0.098,                    // Gravity strength\n        bounceDamping: PLAYGROUND.popcorn.BOUNCE_HEIGHT,\n        bounceCount: 0,\n        maxBounces: 2 + Math.floor(Math.random() * 2), // 2-3 bounces\n        \n        // Visual flair\n        spinRate: (Math.random() - 0.5) * 10, // Rotation speed (for future use)\n        lifetime: 0                           // Track time since spawn\n    };\n}\n\n/**\n * Update popcorn behavior each frame\n * Handles waiting, popping, and bouncing phases\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (frame time)\n * @param {number} centerX - Orb center X position\n * @param {number} centerY - Orb center Y position\n */\nexport function updatePopcorn(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    data.lifetime += dt * 16.67; // Convert to milliseconds\n    \n    // Check if it's time to pop\n    if (!data.hasPopped && data.lifetime > data.popDelay) {\n        // POP! Sudden burst of velocity in all directions for celebration\n        data.hasPopped = true;\n        const popAngle = Math.random() * Math.PI * 2; // Full 360 degree spread\n        particle.vx = Math.cos(popAngle) * data.popStrength * 1.5; // Extra horizontal spread\n        particle.vy = Math.sin(popAngle) * data.popStrength - 0.3; // Slight upward bias for joy\n        \n        // Expand size when popping for dramatic effect\n        particle.size = particle.baseSize * 1.25;\n    }\n    \n    if (data.hasPopped) {\n        // Apply gravity\n        particle.vy += data.gravity * dt;\n        \n        // Check for ground bounce\n        const groundLevel = centerY + 100 * particle.scaleFactor; // Below the orb\n        if (particle.y > groundLevel && data.bounceCount < data.maxBounces) {\n            particle.y = groundLevel;\n            particle.vy = -Math.abs(particle.vy) * data.bounceDamping; // Bounce up with damping\n            particle.vx *= 0.9; // Reduce horizontal speed on bounce\n            data.bounceCount++;\n            \n            // Shrink slightly with each bounce\n            particle.size = particle.baseSize * (1.5 - data.bounceCount * 0.1);\n        }\n        \n        // Fade dramatically after final bounce\n        if (data.bounceCount >= data.maxBounces) {\n            particle.lifeDecay = 0.03 + Math.random() * 0.02; // Very fast fade\n            particle.size *= 0.95; // Also shrink rapidly\n        }\n        \n        // Dynamic fading based on velocity - slower particles fade faster\n        const speed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);\n        if (speed < 0.5) {\n            particle.lifeDecay *= 1.5; // 50% faster fade when moving slowly\n        }\n    }\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'popcorn',\n    emoji: '🍿',\n    description: 'Spontaneous popping with gravity and bounces',\n    initialize: initializePopcorn,\n    update: updatePopcorn\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Burst Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Explosive expansion for surprise and suspicion states\n * @author Emotive Engine Team\n * @module particles/behaviors/burst\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates dramatic expansion effects. For surprise: fast burst then sudden stop.    \n * ║ For suspicion: controlled, watchful expansion. Particles shoot out from center.   \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *   Surprise:                  Suspicion:\n *       💥→                        •→\n *     ↗ 💥 ↘                    ↗ • ↘\n *   ← ⭐ →    STOP!          ← ⭐ →    (controlled)\n *     ↙ 💥 ↖                    ↙ • ↖\n *       💥←                        •←\n * \n * USED BY EMOTIONS:\n * - surprise (dramatic burst then stop)\n * - suspicion (controlled, watchful expansion)\n * \n * RECIPE TO MODIFY:\n * - Increase speed for more dramatic burst\n * - Adjust friction for different deceleration\n * - Change stopTime for surprise effect timing\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\nimport { PHYSICS } from '../config/physics.js';\n\n/**\n * Initialize burst behavior for a particle\n * Sets up explosive outward movement\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeBurst(particle) {\n    // Check emotion type for behavior variation\n    const isSuspicion = particle.emotion === 'suspicion';\n    const isSurprise = particle.emotion === 'surprise';\n    \n    // Random direction for burst\n    const angle = Math.random() * PHYSICS.TWO_PI;\n    \n    // Speed based on emotion\n    const speed = isSuspicion ? \n        (1.0 + Math.random() * 0.8) :      // Controlled burst for suspicion (1-1.8)\n        (isSurprise ? \n            (7.0 + Math.random() * 5.0) :  // Much faster burst for surprise (7-12)\n            (3.5 + Math.random() * 2.5));  // Normal burst for others (3.5-6)\n    \n    particle.vx = Math.cos(angle) * speed;\n    particle.vy = Math.sin(angle) * speed;\n    \n    // Lifespan based on emotion\n    particle.lifeDecay = isSuspicion ? \n        0.010 : \n        (isSurprise ? 0.006 + Math.random() * 0.008 : 0.015);\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    // Make suspicion particles more visible\n    if (isSuspicion) {\n        particle.size = (6 + Math.random() * 4) * \n                       (particle.scaleFactor || 1) * \n                       (particle.particleSizeMultiplier || 1);\n        particle.baseSize = particle.size;\n        particle.opacity = 1.0;  // Full opacity for visibility\n        particle.baseOpacity = particle.opacity;\n    }\n    \n    particle.behaviorData = {\n        isSuspicion,\n        isSurprise,\n        age: 0,\n        fadeStart: isSuspicion ? 0.3 : 0.2  // When to start fading\n    };\n}\n\n/**\n * Update burst behavior each frame\n * Handles explosive expansion with emotion-specific variations\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (frame time)\n * @param {number} centerX - Orb center X (unused)\n * @param {number} centerY - Orb center Y (unused)\n */\nexport function updateBurst(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // Surprise particles: burst out then STOP suddenly\n    if (data.isSurprise) {\n        // Track age for timing the stop\n        data.age += dt * 0.016; // Convert to seconds\n        \n        if (data.age < 0.15) {\n            // First 0.15 seconds: maintain high speed\n            const friction = 0.98;\n            particle.vx *= Math.pow(friction, dt);\n            particle.vy *= Math.pow(friction, dt);\n        } else if (data.age < 0.25) {\n            // 0.15-0.25 seconds: SUDDEN STOP!\n            const friction = 0.85; // Heavy braking\n            particle.vx *= Math.pow(friction, dt);\n            particle.vy *= Math.pow(friction, dt);\n        } else {\n            // After stop: float gently\n            const friction = 0.99;\n            particle.vx *= Math.pow(friction, dt);\n            particle.vy *= Math.pow(friction, dt);\n            // Tiny random drift\n            particle.vx += (Math.random() - 0.5) * 0.01 * dt;\n            particle.vy += (Math.random() - 0.5) * 0.01 * dt;\n        }\n    } else {\n        // Normal burst behavior for other emotions\n        const friction = data.isSuspicion ? 0.99 : 0.95;\n        particle.vx *= Math.pow(friction, dt);\n        particle.vy *= Math.pow(friction, dt);\n    }\n    \n    // For suspicion, add a subtle scanning motion\n    if (data.isSuspicion) {\n        // Add a very subtle side-to-side drift\n        const time = Date.now() * 0.001;\n        particle.vx += Math.sin(time * 2 + particle.id) * 0.01 * dt;\n    }\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'burst',\n    emoji: '💥',\n    description: 'Explosive expansion from center',\n    initialize: initializeBurst,\n    update: updateBurst\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Aggressive Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Sharp, chaotic movement for angry emotional states\n * @author Emotive Engine Team\n * @module particles/behaviors/aggressive\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates an intense, volatile atmosphere with particles moving erratically.        \n * ║ Sharp jitters and sudden bursts of movement convey anger and frustration.         \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *      ⚡→    ←⚡\n *        ↘  ↙       ← erratic, sharp movements\n *    ⚡← ⭐ →⚡      ← orb center (shaking)\n *        ↗  ↖\n *      ⚡←    →⚡\n * \n * USED BY EMOTIONS:\n * - anger (rage, fury)\n * - frustration\n * - irritation\n * \n * RECIPE TO MODIFY:\n * - Increase jitter for more chaotic movement\n * - Increase acceleration for more violent bursts\n * - Decrease speedDecay for longer-lasting energy\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\nimport { PHYSICS } from '../config/physics.js';\n\n/**\n * Initialize aggressive behavior for a particle\n * Sets up chaotic, sharp movement patterns\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeAggressive(particle) {\n    const angle = Math.random() * PHYSICS.TWO_PI;\n    const speed = 1.5 + Math.random() * 2;\n    particle.vx = Math.cos(angle) * speed;\n    particle.vy = Math.sin(angle) * speed;\n    particle.lifeDecay = 0.015;\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        acceleration: 0.05,\n        jitter: 0.3,\n        speedDecay: 0.95\n    };\n}\n\n/**\n * Update aggressive behavior each frame\n * Applies jitter and random acceleration bursts\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (frame time)\n * @param {number} centerX - Orb center X (unused)\n * @param {number} centerY - Orb center Y (unused)\n */\nexport function updateAggressive(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // Add jitter to movement\n    particle.vx += (Math.random() - 0.5) * data.jitter * dt;\n    particle.vy += (Math.random() - 0.5) * data.jitter * dt;\n    \n    // Apply speed decay (frame-independent)\n    particle.vx *= Math.pow(data.speedDecay, dt);\n    particle.vy *= Math.pow(data.speedDecay, dt);\n    \n    // Occasionally add burst of acceleration\n    // Scale probability with frame time\n    if (Math.random() < Math.min(0.05 * dt, 0.5)) {\n        const angle = Math.random() * PHYSICS.TWO_PI;\n        particle.vx += Math.cos(angle) * data.acceleration;\n        particle.vy += Math.sin(angle) * data.acceleration;\n    }\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'aggressive',\n    emoji: '⚡',\n    description: 'Sharp, chaotic movement with violent bursts',\n    initialize: initializeAggressive,\n    update: updateAggressive\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Scattering Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Particles fleeing from center for fear states\n * @author Emotive Engine Team\n * @module particles/behaviors/scattering\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates an anxious atmosphere with particles frantically fleeing from the center. \n * ║ Conveys fear, panic, and the desire to escape.                                    \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *    ← · · · →\n *    ↖       ↗       ← particles flee outward\n *  · · ⭐ · ·       ← orb center (source of fear)\n *    ↙       ↘\n *    ← · · · →\n * \n * USED BY EMOTIONS:\n * - fear (panic, anxiety)\n * - startled\n * - nervous\n * \n * RECIPE TO MODIFY:\n * - Increase fleeSpeed for more frantic escape\n * - Increase panicFactor for more erratic fleeing\n * - Add jitter for nervous shaking while fleeing\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\nimport { PHYSICS } from '../config/physics.js';\n\n/**\n * Initialize scattering behavior for a particle\n * Sets up fleeing movement away from center\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeScattering(particle) {\n    // Will be set relative to center in update\n    particle.vx = 0;\n    particle.vy = 0;\n    particle.lifeDecay = 0.008;  // Live longer to spread further\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        fleeSpeed: 2.0,     // Much faster fleeing\n        panicFactor: 1.2,   // More panicked movement\n        initialized: false\n    };\n}\n\n/**\n * Update scattering behavior each frame\n * Particles flee away from center with panic\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (frame time)\n * @param {number} centerX - Orb center X position\n * @param {number} centerY - Orb center Y position\n */\nexport function updateScattering(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // Initialize flee direction if not done\n    if (!data.initialized) {\n        const dx = particle.x - centerX;\n        const dy = particle.y - centerY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        \n        if (distance > 0) {\n            particle.vx = (dx / distance) * data.fleeSpeed;\n            particle.vy = (dy / distance) * data.fleeSpeed;\n        } else {\n            // If at center, pick random direction\n            const angle = Math.random() * PHYSICS.TWO_PI;\n            particle.vx = Math.cos(angle) * data.fleeSpeed;\n            particle.vy = Math.sin(angle) * data.fleeSpeed;\n        }\n        data.initialized = true;\n    }\n    \n    // Continue fleeing with panic factor\n    const dx = particle.x - centerX;\n    const dy = particle.y - centerY;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    \n    if (distance > 0) {\n        // Add acceleration away from center\n        particle.vx += (dx / distance) * data.panicFactor * 0.01 * dt;\n        particle.vy += (dy / distance) * data.panicFactor * 0.01 * dt;\n    }\n    \n    // Add nervous jitter\n    particle.vx += (Math.random() - 0.5) * 0.1 * dt;\n    particle.vy += (Math.random() - 0.5) * 0.1 * dt;\n    \n    // Apply friction\n    particle.vx *= Math.pow(0.98, dt);\n    particle.vy *= Math.pow(0.98, dt);\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'scattering',\n    emoji: '😨',\n    description: 'Particles flee from center in panic',\n    initialize: initializeScattering,\n    update: updateScattering\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Repelling Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Particles pushed away from center for aversion states\n * @author Emotive Engine Team\n * @module particles/behaviors/repelling\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a space of rejection with particles being pushed away from the center,    \n * ║ maintaining a minimum distance. Conveys disgust, rejection, and boundaries.       \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *    ← - - - →\n *    ↖       ↗       ← particles pushed away\n *  - - (  ) - -      ← empty zone around center\n *    ↙       ↘       ← minimum distance maintained\n *    ← - - - →\n * \n * USED BY EMOTIONS:\n * - disgust (keeping things at bay)\n * - contempt\n * - aversion\n * \n * RECIPE TO MODIFY:\n * - Increase repelStrength for stronger push\n * - Increase minDistance for larger empty zone\n * - Adjust damping for smoother/rougher motion\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\n\n/**\n * Initialize repelling behavior for a particle\n * Sets up repulsion from center\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeRepelling(particle) {\n    particle.vx = 0;\n    particle.vy = 0;\n    particle.lifeDecay = 0.01; // Moderate life\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        repelStrength: 0.8,      // How strongly to push away\n        minDistance: 50,         // Minimum distance from center\n        initialized: false       // Track if initial repel has been applied\n    };\n}\n\n/**\n * Update repelling behavior - particles maintain distance from center\n * \n * Used for: DISGUST emotion (keeping unpleasant things away)\n * Visual effect: Particles are pushed away from center and maintain a \n *                minimum distance, creating an empty zone\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (milliseconds since last frame, typically ~16.67 for 60fps)\n * @param {number} centerX - X coordinate of the orb's center (canvas center)\n * @param {number} centerY - Y coordinate of the orb's center (canvas center)\n */\nexport function updateRepelling(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // STEP 1: Calculate distance from center\n    // dx/dy = distance from center to particle (can be negative)\n    const dx = particle.x - centerX;\n    const dy = particle.y - centerY;\n    // dist = straight-line distance using Pythagorean theorem\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    \n    // STEP 2: Apply repelling force if too close to center\n    // This ensures particles maintain minimum distance\n    if (!data.initialized || distance < data.minDistance) {\n        if (distance > 0) {\n            // Calculate repel force (stronger when closer)\n            // Math.max(distance, 5) prevents division by very small numbers\n            const repelForce = data.repelStrength / Math.max(distance, 5);\n            \n            // Apply force in direction away from center\n            // dx/distance = unit vector component pointing away\n            // Multiply by dt for frame-rate independence\n            particle.vx += (dx / distance) * repelForce * dt;\n            particle.vy += (dy / distance) * repelForce * dt;\n        }\n        data.initialized = true;\n    }\n    \n    // STEP 3: Apply gentle damping to smooth motion\n    // This prevents infinite acceleration and creates natural deceleration\n    // Math.pow ensures frame-rate independence\n    particle.vx *= Math.pow(0.99, dt);\n    particle.vy *= Math.pow(0.99, dt);\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'repelling',\n    emoji: '🚫',\n    description: 'Particles pushed away from center, maintaining distance',\n    initialize: initializeRepelling,\n    update: updateRepelling\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Connecting Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Chaotic particles drawn to center for social connection states\n * @author Emotive Engine Team\n * @module particles/behaviors/connecting\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates an energetic social atmosphere with particles moving chaotically but       \n * ║ staying connected to the center. Like a lively party or bustling community.       \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *    ↗↘ ↖↙ ↗↘\n *   ↙ ↗ ↘ ↖ ↙       ← chaotic but connected\n *  ↘ ↖ ⭐ ↗ ↙       ← drawn to center\n *   ↗ ↙ ↖ ↘ ↗       ← higher energy than ambient\n *    ↙↖ ↗↘ ↙↖\n * \n * USED BY EMOTIONS:\n * - curiosity (social exploration)\n * - playfulness\n * - engagement\n * \n * RECIPE TO MODIFY:\n * - Increase attractionForce for stronger pull to center\n * - Increase chaosFactor for more erratic movement\n * - Decrease friction for more energetic motion\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\nimport { PHYSICS } from '../config/physics.js';\n\n/**\n * Initialize connecting behavior for a particle\n * Sets up chaotic but connected movement\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeConnecting(particle) {\n    // Original Emotive connecting: speed 2-7, higher chaos\n    const angle = Math.random() * PHYSICS.TWO_PI;\n    const speed = 2 + Math.random() * 5; // Faster than ambient\n    particle.vx = Math.cos(angle) * speed;\n    particle.vy = Math.sin(angle) * speed;\n    particle.lifeDecay = 0.012; // Shorter life for more dynamic feel\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        // Higher attraction and chaos for connecting state\n        attractionForce: 0.008,  // Stronger pull (original)\n        chaosFactor: 1.0,        // Higher chaos (original)\n        friction: 0.95          // Less friction than ambient\n    };\n}\n\n/**\n * Update connecting behavior - chaotic movement with center attraction\n * \n * Used for: CURIOSITY/SOCIAL emotions (engaged, exploring, connecting)\n * Visual effect: Particles move chaotically but are drawn back to center,\n *                creating a bustling, connected atmosphere\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (milliseconds since last frame, typically ~16.67 for 60fps)\n * @param {number} centerX - X coordinate of the orb's center (canvas center)\n * @param {number} centerY - Y coordinate of the orb's center (canvas center)\n */\nexport function updateConnecting(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // STEP 1: Apply friction to slow particles gradually\n    // This prevents infinite acceleration\n    // Math.pow ensures frame-rate independence\n    particle.vx *= Math.pow(data.friction, dt);\n    particle.vy *= Math.pow(data.friction, dt);\n    \n    // STEP 2: Apply attraction force towards center\n    // (centerX - this.x) gives direction vector to center\n    // Multiplied by attractionForce to control strength\n    const attractX = (centerX - particle.x) * data.attractionForce;\n    const attractY = (centerY - particle.y) * data.attractionForce;\n    \n    // STEP 3: Add chaos for erratic movement\n    // (Math.random() - 0.5) gives random value between -0.5 and 0.5\n    // Multiplied by chaosFactor for intensity\n    const chaosX = (Math.random() - 0.5) * data.chaosFactor;\n    const chaosY = (Math.random() - 0.5) * data.chaosFactor;\n    \n    // STEP 4: Combine forces\n    // Attraction keeps particles connected to center\n    // Chaos makes movement unpredictable and lively\n    particle.vx += attractX + chaosX;\n    particle.vy += attractY + chaosY;\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'connecting',\n    emoji: '🔗',\n    description: 'Chaotic movement with center attraction for social states',\n    initialize: initializeConnecting,\n    update: updateConnecting\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Resting Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Ultra-slow movement for deeply relaxed states\n * @author Emotive Engine Team\n * @module particles/behaviors/resting\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates an atmosphere of deep calm and rest. Particles barely move, creating      \n * ║ a meditative, peaceful environment. Like watching dust motes in sunlight.         \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *        ·\n *       · ·         ← barely moving\n *      · · ·        ← vertical drift only\n *     · ⭐ ·        ← no horizontal motion\n *      · · ·        \n *       · ·         \n *        ·\n * \n * USED BY EMOTIONS:\n * - sleepy (deep rest)\n * - meditative\n * - tranquil\n * \n * RECIPE TO MODIFY:\n * - Decrease upwardSpeed for even slower movement\n * - Increase lifeDecay for shorter-lived particles\n * - Add tiny horizontal drift for slight variation\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\n\n/**\n * Initialize resting behavior for a particle\n * Sets up minimal movement\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeResting(particle) {\n    particle.vx = 0;  // NO horizontal movement\n    particle.vy = -0.01;  // Tiniest upward drift\n    particle.lifeDecay = 0.001;  // Very slow fade - particles last 10+ seconds\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        upwardSpeed: 0.00002,  // Barely perceptible upward drift\n        friction: 0.999       // Almost no friction (preserve any motion)\n    };\n}\n\n/**\n * Update resting behavior - ultra-slow vertical drift\n * \n * Used for: SLEEPY/MEDITATIVE emotions (deep rest, tranquility)\n * Visual effect: Particles drift upward so slowly they appear almost still,\n *                creating a deeply peaceful atmosphere\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (milliseconds since last frame, typically ~16.67 for 60fps)\n * @param {number} centerX - X coordinate of the orb's center (unused)\n * @param {number} centerY - Y coordinate of the orb's center (unused)\n */\nexport function updateResting(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // STEP 1: Apply friction to vertical velocity only\n    // This creates a very gentle deceleration\n    // Math.pow ensures frame-rate independence\n    particle.vy *= Math.pow(data.friction, dt);\n    \n    // STEP 2: Add tiny continuous upward drift\n    // Negative value because canvas Y increases downward\n    // Multiplied by dt for frame-rate independence\n    particle.vy -= data.upwardSpeed * dt;\n    \n    // STEP 3: Enforce NO horizontal movement\n    // This creates the characteristic vertical-only drift\n    // Essential for the peaceful, non-chaotic feel\n    particle.vx = 0;\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'resting',\n    emoji: '😴',\n    description: 'Ultra-slow vertical drift for deep rest states',\n    initialize: initializeResting,\n    update: updateResting\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Radiant Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Particles radiating outward like sun rays for euphoric states\n * @author Emotive Engine Team\n * @module particles/behaviors/radiant\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a euphoric atmosphere with particles bursting outward like sunbeams,      \n * ║ with shimmering and twinkling effects. Perfect for moments of pure joy and hope.  \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *        ☀️\n *    ✨  ↗  ✨       ← particles radiate outward\n *  ✨ ↖ ⭐ ↗ ✨     ← orb center (like the sun)\n *    ✨  ↘  ✨       ← with shimmer effect\n *        ☀️\n * \n * USED BY EMOTIONS:\n * - euphoria (first day of spring, sunrise vibes)\n * - elation\n * - triumph\n * \n * RECIPE TO MODIFY:\n * - Increase radialSpeed for faster radiation\n * - Increase shimmerSpeed for faster twinkling\n * - Adjust friction for longer/shorter rays\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\nimport { PHYSICS } from '../config/physics.js';\n\n/**\n * Initialize radiant behavior for a particle\n * Sets up sunburst radiation pattern\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeRadiant(particle) {\n    // Particles burst outward from center like sunbeams\n    const angle = Math.random() * PHYSICS.TWO_PI;\n    const speed = 0.8 + Math.random() * 0.4; // Moderate to fast speed\n    particle.vx = Math.cos(angle) * speed;\n    particle.vy = Math.sin(angle) * speed;\n    particle.lifeDecay = 0.006; // Moderate life - last ~8-10 seconds\n    \n    // Use emotion colors if provided, otherwise default sunrise colors\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    } else {\n        // Default golden sunrise colors\n        const colors = ['#FFD700', '#FFB347', '#FFA500', '#FF69B4'];\n        particle.color = selectWeightedColor(colors);\n    }\n    \n    // More particles have glow for radiant effect\n    particle.hasGlow = Math.random() < 0.7; // 70% chance of glow\n    particle.glowSizeMultiplier = particle.hasGlow ? (1.5 + Math.random() * 0.5) : 0;\n    \n    particle.behaviorData = {\n        // Continuous outward radiation\n        radialSpeed: 0.02,        // Constant outward acceleration\n        shimmer: Math.random() * PHYSICS.TWO_PI, // Initial shimmer phase\n        shimmerSpeed: 0.1,        // Shimmer oscillation speed\n        friction: 0.99            // Very light friction for long rays\n    };\n}\n\n/**\n * Update radiant behavior - particles radiate outward like sun rays\n * \n * Used for: EUPHORIA emotion (first day of spring, sunrise vibes)\n * Visual effect: Particles burst outward from center like sunbeams, with a \n *                shimmering/twinkling effect as they travel\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (milliseconds since last frame, typically ~16.67 for 60fps)\n * @param {number} centerX - X coordinate of the orb's center (canvas center)\n * @param {number} centerY - Y coordinate of the orb's center (canvas center)\n */\nexport function updateRadiant(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // STEP 1: Calculate this particle's direction from the orb center\n    // dx/dy = distance from center to particle (can be negative)\n    const dx = particle.x - centerX;\n    const dy = particle.y - centerY;\n    // dist = straight-line distance using Pythagorean theorem\n    const dist = Math.sqrt(dx * dx + dy * dy);\n    \n    // STEP 2: Push particle outward from center (like sun rays)\n    if (dist > 0) {\n        // Convert dx/dy into a unit vector (length = 1) pointing away from center\n        // This gives us pure direction without magnitude\n        const dirX = dx / dist;\n        const dirY = dy / dist;\n        \n        // Add velocity in the outward direction\n        // radialSpeed controls how fast particles shoot outward\n        // Multiply by dt to make movement frame-rate independent\n        particle.vx += dirX * data.radialSpeed * dt;\n        particle.vy += dirY * data.radialSpeed * dt;\n    }\n    \n    // STEP 3: Create shimmering effect (particles twinkle as they radiate)\n    // Increment shimmer phase over time (shimmerSpeed controls twinkle rate)\n    data.shimmer += data.shimmerSpeed * dt;\n    // Create sine wave oscillation (-1 to 1)\n    const shimmerEffect = Math.sin(data.shimmer);\n    // Make particle size pulse: baseSize ± 20%\n    particle.size = particle.baseSize * (1 + shimmerEffect * 0.2);\n    // Make particle opacity pulse: baseOpacity ± 30%\n    particle.opacity = particle.baseOpacity * (1 + shimmerEffect * 0.3);\n    \n    // STEP 4: Apply friction to slow particles over time\n    // This prevents infinite acceleration and creates natural deceleration\n    particle.vx *= Math.pow(data.friction, dt);\n    particle.vy *= Math.pow(data.friction, dt);\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'radiant',\n    emoji: '☀️',\n    description: 'Particles radiate outward like sunbeams',\n    initialize: initializeRadiant,\n    update: updateRadiant\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Ascending Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Slow, steady upward float for zen and meditative states\n * @author Emotive Engine Team\n * @module particles/behaviors/ascending\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a zen atmosphere with particles rising like incense smoke. Slow, steady,  \n * ║ and ethereal movement that gradually fades as particles ascend.                   \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *        ↑\n *       ~~~        ← gentle wave motion\n *        ↑\n *       ~~~        ← like incense smoke\n *        ↑\n *      ⭐⭐⭐      ← orb center\n *        \n * \n * USED BY EMOTIONS:\n * - zen (deep meditation)\n * - contemplative\n * - spiritual\n * \n * RECIPE TO MODIFY:\n * - Decrease ascensionSpeed for slower rise\n * - Increase waveFactor for more horizontal drift\n * - Adjust fadeStartDistance to control when fade begins\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\n\n/**\n * Initialize ascending behavior for a particle\n * Sets up slow, steady upward movement\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeAscending(particle) {\n    // Very slow, steady upward movement\n    particle.vx = (Math.random() - 0.5) * 0.02;  // Minimal horizontal drift\n    particle.vy = -0.03 - Math.random() * 0.02;  // Slow upward movement (0.03-0.05)\n    particle.lifeDecay = 0.0008;  // Very long-lived particles (30+ seconds)\n    \n    // Larger, more ethereal particles for zen\n    particle.size = (6 + Math.random() * 6) * \n        (particle.scaleFactor || 1) * \n        (particle.particleSizeMultiplier || 1) * \n        1.33;  // 1.33x larger for zen (reduced from 2x)\n    particle.baseSize = particle.size;\n    particle.baseOpacity = 0.2 + Math.random() * 0.2;  // Very translucent (20-40%)\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        // Continuous gentle upward drift\n        ascensionSpeed: 0.0003,      // Very gentle continuous upward\n        waveFactor: 0.5,             // Subtle horizontal wave motion\n        waveFrequency: 0.001,        // Very slow wave oscillation\n        friction: 0.998,             // Almost no slowdown\n        fadeStartDistance: 100       // Start fading after rising 100px\n    };\n}\n\n/**\n * Update ascending behavior - slow upward float like incense\n * \n * Used for: ZEN/CONTEMPLATIVE emotions (meditation, spirituality)\n * Visual effect: Particles rise slowly and steadily with subtle wave motion,\n *                gradually fading as they ascend like incense smoke\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (milliseconds since last frame, typically ~16.67 for 60fps)\n * @param {number} centerX - X coordinate of the orb's center (unused)\n * @param {number} centerY - Y coordinate of the orb's center (unused)\n */\nexport function updateAscending(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // Validate data exists\n    if (!data) {\n        initializeAscending(particle);\n        return;\n    }\n    \n    // STEP 1: Apply friction to velocities\n    // Very light friction to maintain smooth motion\n    // Math.pow ensures frame-rate independence\n    particle.vx *= Math.pow(data.friction, dt);\n    particle.vy *= Math.pow(data.friction, dt);\n    \n    // STEP 2: Add continuous upward ascension\n    // Negative because canvas Y increases downward\n    // Multiplied by dt for frame-rate independence\n    particle.vy -= data.ascensionSpeed * dt;\n    \n    // STEP 3: Add subtle wave motion for organic feel\n    // Creates the characteristic incense smoke waviness\n    // Age gives us time-based oscillation\n    const waveOffset = Math.sin(particle.age * data.waveFrequency * 1000) * data.waveFactor;\n    particle.vx += waveOffset * 0.001 * dt;\n    \n    // STEP 4: Track initial Y position for fade calculation\n    if (particle.initialY === undefined) {\n        particle.initialY = particle.y;\n    }\n    \n    // STEP 5: Calculate distance traveled upward\n    const distanceTraveled = particle.initialY - particle.y;\n    \n    // STEP 6: Start fading after traveling fadeStartDistance pixels\n    // This creates the incense smoke dissipation effect\n    if (distanceTraveled > data.fadeStartDistance) {\n        const fadeProgress = (distanceTraveled - data.fadeStartDistance) / 100;\n        const fadeFactor = Math.max(0, 1 - fadeProgress);\n        particle.baseOpacity *= 0.995;  // Gradual fade\n        \n        // Accelerate life decay as particle fades\n        if (fadeFactor < 0.5) {\n            particle.lifeDecay *= 1.02;\n        }\n    }\n    \n    // STEP 7: Dampen excessive horizontal movement\n    // Keeps the ascension primarily vertical\n    if (Math.abs(particle.vx) > 0.05) {\n        particle.vx *= Math.pow(0.95, dt);\n    }\n    \n    // STEP 8: Cap upward velocity for consistency\n    // Prevents particles from accelerating too much\n    if (particle.vy < -0.1) {\n        particle.vy = -0.1;\n    }\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'ascending',\n    emoji: '🧘',\n    description: 'Slow steady upward float like incense smoke',\n    initialize: initializeAscending,\n    update: updateAscending\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Erratic Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Nervous, jittery movement for anxious states\n * @author Emotive Engine Team\n * @module particles/behaviors/erratic\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a nervous, unstable atmosphere with particles jittering and changing       \n * ║ direction unpredictably. Conveys anxiety, nervousness, and instability.           \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *    ↗↙↖  ↘↗\n *   ↙ ↗↘  ↖↙       ← unpredictable changes\n *  ↘↖ ⭐ ↗↙        ← jittery movement\n *   ↗ ↙↖  ↘↗       ← nervous energy\n *    ↙↗↘  ↖↙\n * \n * USED BY EMOTIONS:\n * - nervous (anxiety, jitters)\n * - unstable\n * - agitated\n * \n * RECIPE TO MODIFY:\n * - Increase jitterStrength for more shaking\n * - Increase directionChangeRate for more frequent changes\n * - Increase speedVariation for more erratic speed changes\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\nimport { PHYSICS } from '../config/physics.js';\n\n/**\n * Initialize erratic behavior for a particle\n * Sets up nervous, jittery movement\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeErratic(particle) {\n    // Random, chaotic initial direction\n    const angle = Math.random() * PHYSICS.TWO_PI;\n    const speed = 0.1 + Math.random() * 0.15;\n    particle.vx = Math.cos(angle) * speed;\n    particle.vy = Math.sin(angle) * speed;\n    particle.lifeDecay = 0.004;  // Shorter lived due to nervous energy\n    \n    particle.size = (2 + Math.random() * 4) * \n        (particle.scaleFactor || 1) * \n        (particle.particleSizeMultiplier || 1);  // Varied sizes scaled\n    particle.baseSize = particle.size;\n    particle.baseOpacity = 0.4 + Math.random() * 0.3;  // More visible\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        jitterStrength: 0.02,        // Random direction changes\n        directionChangeRate: 0.1,    // How often to change direction\n        speedVariation: 0.3,         // Speed changes randomly\n        spinRate: 0.05 + Math.random() * 0.1  // Particles spin\n    };\n}\n\n/**\n * Update erratic behavior - nervous, jittery movement\n * \n * Used for: NERVOUS/ANXIOUS emotions (anxiety, instability, agitation)\n * Visual effect: Particles jitter nervously, changing direction and speed\n *                unpredictably, creating an unstable atmosphere\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (milliseconds since last frame, typically ~16.67 for 60fps)\n * @param {number} centerX - X coordinate of the orb's center (unused)\n * @param {number} centerY - Y coordinate of the orb's center (unused)\n */\nexport function updateErratic(particle, dt) {\n    const data = particle.behaviorData;\n    \n    // STEP 1: Add constant jitter to movement\n    // Creates the nervous shaking effect\n    // (Math.random() - 0.5) gives values between -0.5 and 0.5\n    // Multiplied by jitterStrength and dt for controlled chaos\n    particle.vx += (Math.random() - 0.5) * data.jitterStrength * dt;\n    particle.vy += (Math.random() - 0.5) * data.jitterStrength * dt;\n    \n    // STEP 2: Randomly change direction occasionally\n    // Creates unpredictable movement patterns\n    // Math.min ensures probability doesn't exceed reasonable bounds\n    if (Math.random() < Math.min(data.directionChangeRate * dt, 0.5)) {\n        // Pick new random direction\n        const newAngle = Math.random() * PHYSICS.TWO_PI;\n        const currentSpeed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);\n        \n        // Apply new direction while maintaining similar speed\n        particle.vx = Math.cos(newAngle) * currentSpeed;\n        particle.vy = Math.sin(newAngle) * currentSpeed;\n    }\n    \n    // STEP 3: Vary the speed randomly\n    // Creates erratic acceleration/deceleration\n    const speedMultiplier = 1 + (Math.random() - 0.5) * data.speedVariation * dt;\n    particle.vx *= speedMultiplier;\n    particle.vy *= speedMultiplier;\n    \n    // STEP 4: Apply spin to particle size\n    // Makes particles appear to rotate/vibrate\n    const spinPhase = particle.age * data.spinRate * 1000;\n    particle.size = particle.baseSize * (1 + Math.sin(spinPhase) * 0.2);\n    \n    // STEP 5: Fluctuate opacity nervously\n    // Creates a flickering effect\n    particle.opacity = particle.baseOpacity * (0.8 + Math.random() * 0.4);\n    \n    // STEP 6: Apply damping to prevent infinite acceleration\n    // Keeps movement bounded\n    particle.vx *= Math.pow(0.98, dt);\n    particle.vy *= Math.pow(0.98, dt);\n    \n    // STEP 7: Cap maximum velocity\n    // Prevents particles from moving too fast\n    const speed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);\n    if (speed > 0.5) {\n        particle.vx = (particle.vx / speed) * 0.5;\n        particle.vy = (particle.vy / speed) * 0.5;\n    }\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'erratic',\n    emoji: '😰',\n    description: 'Nervous jittery movement for anxious states',\n    initialize: initializeErratic,\n    update: updateErratic\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Cautious Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Slow, careful movement with pauses for suspicious states\n * @author Emotive Engine Team\n * @module particles/behaviors/cautious\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Creates a watchful, suspicious atmosphere with particles moving slowly and         \n * ║ pausing frequently, as if carefully observing. Like being on guard.               \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * VISUAL DIAGRAM:\n *    · → · STOP\n *   STOP ← ·        ← move, then pause\n *    · ⭐ ·         ← watching center\n *   · STOP →        ← pause, then move\n *    STOP · ← ·\n * \n * USED BY EMOTIONS:\n * - suspicion (watchful, guarded)\n * - uncertainty\n * - wariness\n * \n * RECIPE TO MODIFY:\n * - Increase pauseDuration for longer stops\n * - Decrease moveDuration for shorter movements\n * - Adjust watchRadius to control patrol area\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\nimport { PHYSICS } from '../config/physics.js';\n\n/**\n * Initialize cautious behavior for a particle\n * Sets up slow, deliberate movement patterns\n * \n * @param {Particle} particle - The particle to initialize\n */\nexport function initializeCautious(particle) {\n    // Particles move very slowly and deliberately\n    const angle = Math.random() * PHYSICS.TWO_PI;\n    const speed = 0.02 + Math.random() * 0.03; // Very slow: 0.02-0.05 units/frame\n    particle.vx = Math.cos(angle) * speed;\n    particle.vy = Math.sin(angle) * speed;\n    particle.lifeDecay = 0.001;  // Very long-lived for visibility\n    particle.life = 1.0;  // Ensure full life\n    \n    particle.size = (4 + Math.random() * 4) * \n        (particle.scaleFactor || 1) * \n        (particle.particleSizeMultiplier || 1);\n    particle.baseSize = particle.size;\n    particle.baseOpacity = 0.8 + Math.random() * 0.2;  // Very visible (80-100%)\n    particle.opacity = particle.baseOpacity;\n    \n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n    \n    particle.behaviorData = {\n        pauseTimer: Math.random() * 2,      // Start with random pause offset\n        pauseDuration: 0.5 + Math.random() * 0.5,  // Pause for 0.5-1s\n        moveDuration: 1 + Math.random() * 0.5,     // Move for 1-1.5s\n        isMoving: Math.random() > 0.5,             // Randomly start moving or paused\n        moveTimer: 0,\n        originalVx: particle.vx,\n        originalVy: particle.vy,\n        watchRadius: 50 + Math.random() * 30       // Stay within 50-80 units of core\n    };\n}\n\n/**\n * Update cautious behavior - slow movement with frequent pauses\n * \n * Used for: SUSPICION/UNCERTAINTY emotions (watchful, guarded, wary)\n * Visual effect: Particles move slowly and deliberately, pausing frequently\n *                as if carefully observing their surroundings\n * \n * @param {Particle} particle - The particle to update\n * @param {number} dt - Delta time (milliseconds since last frame, typically ~16.67 for 60fps)\n * @param {number} centerX - X coordinate of the orb's center\n * @param {number} centerY - Y coordinate of the orb's center\n */\nexport function updateCautious(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    \n    // STEP 1: Update movement timer\n    // Tracks how long we've been in current state (moving or paused)\n    data.moveTimer += dt;\n    \n    // STEP 2: Switch between moving and pausing states\n    if (data.isMoving) {\n        // Currently moving - check if time to pause\n        if (data.moveTimer > data.moveDuration) {\n            data.isMoving = false;\n            data.moveTimer = 0;\n            // Stop movement during pause (watchful stillness)\n            particle.vx = 0;\n            particle.vy = 0;\n        } else {\n            // Continue moving at cautious speed\n            particle.vx = data.originalVx;\n            particle.vy = data.originalVy;\n        }\n    } else {\n        // Currently paused - check if time to move\n        if (data.moveTimer > data.pauseDuration) {\n            data.isMoving = true;\n            data.moveTimer = 0;\n            // Pick a new careful direction\n            const angle = Math.random() * PHYSICS.TWO_PI;\n            const speed = 0.02 + Math.random() * 0.03;\n            particle.vx = Math.cos(angle) * speed;\n            particle.vy = Math.sin(angle) * speed;\n            // Store for next movement phase\n            data.originalVx = particle.vx;\n            data.originalVy = particle.vy;\n        }\n    }\n    \n    // STEP 3: Keep particles within watch radius of core\n    // They're suspicious, so they don't stray too far\n    const dx = particle.x - centerX;\n    const dy = particle.y - centerY;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n    \n    if (dist > data.watchRadius) {\n        // Pull back towards core slowly (maintaining caution)\n        const pullStrength = 0.02;\n        particle.vx -= (dx / dist) * pullStrength * dt;\n        particle.vy -= (dy / dist) * pullStrength * dt;\n    }\n    \n    // STEP 4: Apply very light damping\n    // Keeps movement controlled and deliberate\n    particle.vx *= Math.pow(0.995, dt);\n    particle.vy *= Math.pow(0.995, dt);\n    \n    // STEP 5: Subtle opacity flicker during pauses\n    // Creates a watchful \"blinking\" effect\n    if (!data.isMoving) {\n        particle.opacity = particle.baseOpacity * (0.9 + Math.sin(particle.age * 5) * 0.1);\n    } else {\n        particle.opacity = particle.baseOpacity;\n    }\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'cautious',\n    emoji: '🤨',\n    description: 'Slow careful movement with watchful pauses',\n    initialize: initializeCautious,\n    update: updateCautious\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Surveillance Behavior\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Searchlight scanning behavior for suspicious/paranoid states\r\n * @author Emotive Engine Team\r\n * @module particles/behaviors/surveillance\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ CONCEPT                                                                           \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Particles act like searchlights or surveillance cameras, slowly scanning back     \r\n * ║ and forth in arcs, pausing at edges, occasionally darting to new positions.       \r\n * ║ Creates a paranoid, watchful atmosphere with deliberate, searching movements.     \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n * \r\n * BEHAVIOR PATTERN:\r\n * • Slow horizontal scanning arcs (like searchlights)\r\n * • Pause at scan extremes (checking corners)\r\n * • Occasional quick darts to new positions (alert response)\r\n * • Some particles patrol perimeter (edge surveillance)\r\n * • Random freezing in place (listening/watching)\r\n * \r\n * ┌──────────────────────────────────────────────────────────────────────────────────┐\r\n * │  VISUAL: Searchlight Scanning                                                    │\r\n * │                                                                                   │\r\n * │     ←─────────────→  (slow scan)                                                │\r\n * │    •               •                                                             │\r\n * │                                                                                   │\r\n * │   pause...     ...pause                                                         │\r\n * │                                                                                   │\r\n * │     DART! ──→ • (quick repositioning)                                          │\r\n * └──────────────────────────────────────────────────────────────────────────────────┘\r\n */\r\n\r\nimport { selectWeightedColor } from '../utils/colorUtils.js';\r\n\r\nexport default {\r\n    name: 'surveillance',\r\n    emoji: '👁️',\r\n    description: 'Searchlight scanning with paranoid watchfulness',\r\n    \r\n    /**\r\n     * Initialize particle state for surveillance behavior\r\n     */\r\n    initialize: function(particle, config) {\r\n        // Set particle color from emotion palette\r\n        if (particle.emotionColors && particle.emotionColors.length > 0) {\r\n            particle.color = selectWeightedColor(particle.emotionColors);\r\n        }\r\n        \r\n        particle.behaviorState = {\r\n            // Scanning properties\r\n            scanAngle: Math.random() * Math.PI - Math.PI/2,  // Current scan angle\r\n            scanDirection: Math.random() < 0.5 ? 1 : -1,      // Scan direction\r\n            scanSpeed: 0.3 + Math.random() * 0.2,             // Individual scan rate\r\n            scanRange: Math.PI/3 + Math.random() * Math.PI/4, // Scan arc size\r\n            scanCenter: Math.random() * Math.PI * 2,          // Center of scan arc\r\n            pauseTimer: 0,                                     // Pause at edges\r\n            pauseDuration: 500 + Math.random() * 500,         // How long to pause\r\n            \r\n            // Movement states\r\n            mode: 'scanning',  // 'scanning', 'darting', 'frozen', 'patrolling'\r\n            modeTimer: 0,\r\n            nextModeChange: 2000 + Math.random() * 3000,\r\n            \r\n            // Dart properties\r\n            dartTarget: { x: 0, y: 0 },\r\n            dartSpeed: 0,\r\n            \r\n            // Patrol properties\r\n            patrolRadius: 150 + Math.random() * 100,\r\n            patrolAngle: Math.random() * Math.PI * 2,\r\n            \r\n            // Threat response\r\n            alertLevel: 0,\r\n            lastPosition: { x: particle.x, y: particle.y }\r\n        };\r\n        \r\n        // Assign roles: 70% scanners, 20% patrollers, 10% watchers\r\n        const role = Math.random();\r\n        if (role < 0.7) {\r\n            particle.behaviorState.primaryRole = 'scanner';\r\n        } else if (role < 0.9) {\r\n            particle.behaviorState.primaryRole = 'patroller';\r\n            particle.behaviorState.mode = 'patrolling';\r\n        } else {\r\n            particle.behaviorState.primaryRole = 'watcher';\r\n            particle.behaviorState.mode = 'frozen';\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Update particle physics for surveillance behavior\r\n     */\r\n    update: function(particle, dt, config) {\r\n        const state = particle.behaviorState;\r\n        if (!state) return;\r\n        \r\n        // Update mode timer\r\n        state.modeTimer += dt * 16;\r\n        \r\n        // Check for mode changes\r\n        if (state.modeTimer > state.nextModeChange) {\r\n            this.changeMode(particle, state);\r\n            state.modeTimer = 0;\r\n            state.nextModeChange = 2000 + Math.random() * 4000;\r\n        }\r\n        \r\n        // Update based on current mode\r\n        switch(state.mode) {\r\n            case 'scanning':\r\n                this.updateScanning(particle, dt, state, config);\r\n                break;\r\n            case 'darting':\r\n                this.updateDarting(particle, dt, state, config);\r\n                break;\r\n            case 'frozen':\r\n                this.updateFrozen(particle, dt, state, config);\r\n                break;\r\n            case 'patrolling':\r\n                this.updatePatrolling(particle, dt, state, config);\r\n                break;\r\n        }\r\n        \r\n        // Apply slight downward drift for weight\r\n        particle.vy += 0.05 * dt;\r\n        \r\n        // Update position\r\n        particle.x += particle.vx * dt;\r\n        particle.y += particle.vy * dt;\r\n        \r\n        // Store last position\r\n        state.lastPosition.x = particle.x;\r\n        state.lastPosition.y = particle.y;\r\n    },\r\n    \r\n    /**\r\n     * Scanning mode - slow searchlight sweeps\r\n     */\r\n    updateScanning: function(particle, dt, state, config) {\r\n        // Update scan angle\r\n        if (state.pauseTimer > 0) {\r\n            // Pausing at edge of scan\r\n            state.pauseTimer -= dt * 16;\r\n            particle.vx *= 0.9;  // Slow down during pause\r\n            particle.vy *= 0.9;\r\n        } else {\r\n            // Active scanning\r\n            state.scanAngle += state.scanDirection * state.scanSpeed * dt * 0.02;\r\n            \r\n            // Check scan limits and pause at edges\r\n            if (Math.abs(state.scanAngle) > state.scanRange / 2) {\r\n                state.scanDirection *= -1;\r\n                state.pauseTimer = state.pauseDuration;\r\n                state.scanAngle = Math.sign(state.scanAngle) * state.scanRange / 2;\r\n            }\r\n        }\r\n        \r\n        // Apply scanning motion\r\n        const actualAngle = state.scanCenter + state.scanAngle;\r\n        const speed = 0.8 + state.alertLevel * 0.5;\r\n        particle.vx = Math.cos(actualAngle) * speed;\r\n        particle.vy = Math.sin(actualAngle) * speed * 0.3;  // Less vertical movement\r\n    },\r\n    \r\n    /**\r\n     * Darting mode - quick repositioning\r\n     */\r\n    updateDarting: function(particle, dt, state, config) {\r\n        const dx = state.dartTarget.x - particle.x;\r\n        const dy = state.dartTarget.y - particle.y;\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        if (distance > 5) {\r\n            // Move toward dart target quickly\r\n            particle.vx = (dx / distance) * state.dartSpeed;\r\n            particle.vy = (dy / distance) * state.dartSpeed;\r\n        } else {\r\n            // Reached target, switch back to scanning\r\n            state.mode = 'scanning';\r\n            state.modeTimer = 0;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Frozen mode - watchful stillness\r\n     */\r\n    updateFrozen: function(particle, dt, state, config) {\r\n        // Almost no movement, just tiny vibrations\r\n        particle.vx *= 0.95;\r\n        particle.vy *= 0.95;\r\n        \r\n        // Occasional tiny twitch\r\n        if (Math.random() < 0.01) {\r\n            particle.vx += (Math.random() - 0.5) * 0.5;\r\n            particle.vy += (Math.random() - 0.5) * 0.5;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Patrolling mode - edge surveillance\r\n     */\r\n    updatePatrolling: function(particle, dt, state, config) {\r\n        // Patrol in a circle around the edge\r\n        state.patrolAngle += 0.01 * dt;\r\n        \r\n        const targetX = Math.cos(state.patrolAngle) * state.patrolRadius;\r\n        const targetY = Math.sin(state.patrolAngle) * state.patrolRadius;\r\n        \r\n        // Move toward patrol position\r\n        const dx = targetX - particle.x;\r\n        const dy = targetY - particle.y;\r\n        \r\n        particle.vx = dx * 0.02;\r\n        particle.vy = dy * 0.02;\r\n    },\r\n    \r\n    /**\r\n     * Change behavior mode\r\n     */\r\n    changeMode: function(particle, state) {\r\n        const rand = Math.random();\r\n        \r\n        // Mode transition probabilities based on role\r\n        if (state.primaryRole === 'scanner') {\r\n            if (rand < 0.1) {\r\n                // Dart to new position\r\n                state.mode = 'darting';\r\n                state.dartTarget = {\r\n                    x: (Math.random() - 0.5) * 200,\r\n                    y: (Math.random() - 0.5) * 200\r\n                };\r\n                state.dartSpeed = 3 + Math.random() * 2;\r\n            } else if (rand < 0.2) {\r\n                // Freeze and watch\r\n                state.mode = 'frozen';\r\n            } else {\r\n                // Continue scanning\r\n                state.mode = 'scanning';\r\n            }\r\n        } else if (state.primaryRole === 'patroller') {\r\n            if (rand < 0.1) {\r\n                state.mode = 'frozen';\r\n            } else {\r\n                state.mode = 'patrolling';\r\n            }\r\n        } else {\r\n            // Watcher role\r\n            if (rand < 0.3) {\r\n                state.mode = 'scanning';\r\n            } else {\r\n                state.mode = 'frozen';\r\n            }\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Glitchy Behavior\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Digital glitch behavior with stuttering orbits and corruption\r\n * @author Emotive Engine Team\r\n * @module particles/behaviors/glitchy\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ CONCEPT                                                                           \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Particles orbit like in love state but with digital glitches, stutters, and      \r\n * ║ corruption artifacts. Creates a captivating dubstep-like visual rhythm.           \r\n * ║ Combines smooth orbiting with sudden position jumps and digital artifacts.        \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n * \r\n * BEHAVIOR PATTERN:\r\n * • Base orbiting motion (like love state)\r\n * • Random position jumps (teleportation glitches)\r\n * • Stuttering/freezing (frame drops)\r\n * • Trail duplication (ghosting artifacts)\r\n * • RGB channel separation\r\n * • Digital noise bursts\r\n * \r\n * ┌──────────────────────────────────────────────────────────────────────────────────┐\r\n * │  VISUAL: Glitched Orbiting                                                       │\r\n * │                                                                                   │\r\n * │       ░░▒▒▓▓█  ←─ Digital trail                                                 │\r\n * │     •  ┊  •                                                                      │\r\n * │   •┊  ⚡  ┊•  ←─ Glitch jump                                                    │\r\n * │     •  ┊  •                                                                      │\r\n * │       ░░▒▒▓▓█                                                                    │\r\n * └──────────────────────────────────────────────────────────────────────────────────┘\r\n */\r\n\r\nimport { selectWeightedColor } from '../utils/colorUtils.js';\r\n\r\nexport default {\r\n    name: 'glitchy',\r\n    emoji: '⚡',\r\n    description: 'Digital glitch with stuttering orbits and corruption',\r\n    \r\n    // Rhythm configuration for glitchy behavior\r\n    rhythm: {\r\n        enabled: true,\r\n        \r\n        // Glitch events sync to rhythm\r\n        glitchTiming: {\r\n            mode: 'subdivision',     // Glitch on subdivisions\r\n            subdivision: 'sixteenth', // 16th notes for rapid glitches\r\n            probability: 0.3,        // 30% chance on each 16th\r\n            intensityOnBeat: 2.0,    // Stronger glitches on beat\r\n            intensityOffBeat: 0.5    // Weaker between beats\r\n        },\r\n        \r\n        // Stutter/freeze timing\r\n        stutterSync: {\r\n            mode: 'pattern',         // Based on rhythm pattern\r\n            patterns: {\r\n                'dubstep': {\r\n                    freezeOnDrop: true,  // Freeze on the drop (beat 3)\r\n                    dropDuration: 100    // Freeze for 100ms\r\n                },\r\n                'breakbeat': {\r\n                    randomFreeze: 0.1,   // 10% chance per beat\r\n                    duration: 50         // Short 50ms freezes\r\n                }\r\n            }\r\n        },\r\n        \r\n        // Orbital speed modulation\r\n        orbitRhythm: {\r\n            baseSpeed: 'tempo',      // Speed scales with BPM\r\n            wobbleSync: 'eighth',    // Wobble on 8th notes\r\n            beatAcceleration: 1.5,   // Speed boost on beat\r\n            barReset: true           // Reset orbit angle each bar\r\n        },\r\n        \r\n        // RGB split effect rhythm\r\n        rgbSync: {\r\n            enabled: true,\r\n            amount: 'intensity',     // Split based on musical intensity\r\n            direction: 'beat',        // Change split direction on beat\r\n            maxSplit: 10             // Maximum pixel split\r\n        },\r\n        \r\n        // Digital noise bursts\r\n        noiseRhythm: {\r\n            trigger: 'accent',       // Noise on accented beats\r\n            duration: 50,            // 50ms noise bursts\r\n            intensity: 'drop'        // Scale with drop intensity\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize particle state for glitchy behavior\r\n     */\r\n    initialize: function(particle, config, centerX, centerY) {\r\n        // Set particle color from emotion palette\r\n        if (particle.emotionColors && particle.emotionColors.length > 0) {\r\n            particle.color = selectWeightedColor(particle.emotionColors);\r\n        }\r\n        \r\n        particle.behaviorState = {\r\n            // Orbital properties (tighter orbit to stay centered)\r\n            orbitAngle: Math.random() * Math.PI * 2,\r\n            orbitRadius: 30 + Math.random() * 40,  // Reduced from 40-120 to 30-70\r\n            orbitSpeed: 0.01 + Math.random() * 0.02,\r\n            \r\n            // Glitch properties\r\n            glitchTimer: 0,\r\n            nextGlitch: Math.random() * 500 + 100,\r\n            isGlitching: false,\r\n            glitchDuration: 0,\r\n            glitchOffset: { x: 0, y: 0 },\r\n            \r\n            // Stutter properties\r\n            stutterTimer: 0,\r\n            nextStutter: Math.random() * 200 + 50,\r\n            isFrozen: false,\r\n            frozenPosition: { x: 0, y: 0 },\r\n            frozenVelocity: { x: 0, y: 0 },\r\n            \r\n            // Trail ghost properties\r\n            hasGhost: Math.random() < 0.3,\r\n            ghostOffset: Math.random() * 20 + 10,\r\n            ghostAngle: Math.random() * Math.PI * 2,\r\n            \r\n            // RGB separation\r\n            rgbSplit: Math.random() < 0.4,\r\n            rgbPhase: Math.random() * Math.PI * 2,\r\n            \r\n            // Digital noise\r\n            noiseLevel: 0,\r\n            noiseBurst: false,\r\n            \r\n            // Dubstep rhythm sync\r\n            beatPhase: Math.random() * Math.PI * 2,\r\n            beatFrequency: 0.05 + Math.random() * 0.03,\r\n            dropIntensity: 0\r\n        };\r\n        \r\n        // Special properties for glitch\r\n        particle.lifeDecay = 0.0015; // Slower decay for trails\r\n        particle.hasGlow = Math.random() < 0.5; // More glow for digital effect\r\n        if (particle.hasGlow) {\r\n            particle.glowSizeMultiplier = 2.0 + Math.random(); // Bigger glows\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Update particle physics for glitchy behavior\r\n     */\r\n    update: function(particle, dt, centerX, centerY) {\r\n        const state = particle.behaviorState;\r\n        if (!state) return;\r\n        \r\n        // centerX and centerY are passed correctly from updateBehavior\r\n        // No need for fallbacks - they should always be provided\r\n        \r\n        // Update timers\r\n        state.glitchTimer += dt * 16;\r\n        state.stutterTimer += dt * 16;\r\n        \r\n        // Check for stutter/freeze\r\n        if (state.stutterTimer > state.nextStutter) {\r\n            if (!state.isFrozen) {\r\n                // Start freeze\r\n                state.isFrozen = true;\r\n                state.frozenPosition = { x: particle.x, y: particle.y };\r\n                state.frozenVelocity = { x: particle.vx, y: particle.vy };\r\n                state.stutterTimer = 0;\r\n                state.nextStutter = 20 + Math.random() * 40; // Short freeze\r\n            } else {\r\n                // End freeze\r\n                state.isFrozen = false;\r\n                state.stutterTimer = 0;\r\n                state.nextStutter = 100 + Math.random() * 300;\r\n                \r\n                // Sometimes jump on unfreeze (smaller jumps to stay centered)\r\n                if (Math.random() < 0.3) {\r\n                    particle.x += (Math.random() - 0.5) * 20;  // Reduced from 50\r\n                    particle.y += (Math.random() - 0.5) * 20;  // Reduced from 50\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Check for glitch events\r\n        if (state.glitchTimer > state.nextGlitch && !state.isGlitching) {\r\n            state.isGlitching = true;\r\n            state.glitchDuration = 50 + Math.random() * 100;\r\n            state.glitchOffset = {\r\n                x: (Math.random() - 0.5) * 30,  // Reduced from 100 to keep particles closer\r\n                y: (Math.random() - 0.5) * 30   // Reduced from 100 to keep particles closer\r\n            };\r\n            state.glitchTimer = 0;\r\n            \r\n            // Change color during glitch\r\n            if (Math.random() < 0.5 && particle.emotionColors) {\r\n                particle.color = selectWeightedColor(particle.emotionColors);\r\n            }\r\n        }\r\n        \r\n        // End glitch\r\n        if (state.isGlitching && state.glitchTimer > state.glitchDuration) {\r\n            state.isGlitching = false;\r\n            state.glitchTimer = 0;\r\n            state.nextGlitch = 200 + Math.random() * 800;\r\n            state.glitchOffset = { x: 0, y: 0 };\r\n        }\r\n        \r\n        // Update beat phase for dubstep rhythm\r\n        state.beatPhase += state.beatFrequency * dt;\r\n        const beatIntensity = Math.sin(state.beatPhase) * 0.5 + 0.5;\r\n        \r\n        // Calculate drop intensity (periodic bass drops)\r\n        const dropCycle = state.beatPhase % (Math.PI * 4);\r\n        if (dropCycle < Math.PI * 0.5) {\r\n            state.dropIntensity = Math.min(1, state.dropIntensity + dt * 0.1);\r\n        } else {\r\n            state.dropIntensity = Math.max(0, state.dropIntensity - dt * 0.05);\r\n        }\r\n        \r\n        if (!state.isFrozen) {\r\n            // Update orbital position with beat modulation\r\n            state.orbitAngle += state.orbitSpeed * dt * (1 + beatIntensity * 0.5);\r\n            \r\n            // Add drop wobble\r\n            const wobbleRadius = state.orbitRadius * (1 + state.dropIntensity * 0.3 * Math.sin(state.beatPhase * 4));\r\n            \r\n            // Calculate target position relative to center\r\n            let targetX = centerX + Math.cos(state.orbitAngle) * wobbleRadius;\r\n            let targetY = centerY + Math.sin(state.orbitAngle) * wobbleRadius * 0.6; // Elliptical\r\n            \r\n            // Apply glitch offset (smaller random factor to stay closer)\r\n            if (state.isGlitching) {\r\n                targetX += state.glitchOffset.x * Math.random() * 0.5;  // Reduced effect\r\n                targetY += state.glitchOffset.y * Math.random() * 0.5;  // Reduced effect\r\n            }\r\n            \r\n            // RGB split effect\r\n            if (state.rgbSplit) {\r\n                const splitAmount = 3 * (1 + state.dropIntensity);\r\n                targetX += Math.sin(state.rgbPhase) * splitAmount;\r\n                targetY += Math.cos(state.rgbPhase) * splitAmount;\r\n                state.rgbPhase += 0.1 * dt;\r\n            }\r\n            \r\n            // Digital noise bursts on drops (smaller to stay centered)\r\n            if (state.dropIntensity > 0.8 && Math.random() < 0.1) {\r\n                targetX += (Math.random() - 0.5) * 10;  // Reduced from 20\r\n                targetY += (Math.random() - 0.5) * 10;  // Reduced from 20\r\n            }\r\n            \r\n            // Stronger pull to center to prevent wandering\r\n            const smoothing = state.isGlitching ? 0.05 : 0.08;  // Increased from 0.02/0.05\r\n            particle.vx = (targetX - particle.x) * smoothing;\r\n            particle.vy = (targetY - particle.y) * smoothing;\r\n            \r\n            // Add jitter based on beat\r\n            particle.vx += (Math.random() - 0.5) * beatIntensity * 2;\r\n            particle.vy += (Math.random() - 0.5) * beatIntensity * 2;\r\n            \r\n        } else {\r\n            // Frozen - vibrate in place\r\n            particle.vx = (Math.random() - 0.5) * 0.5;\r\n            particle.vy = (Math.random() - 0.5) * 0.5;\r\n        }\r\n        \r\n        // Apply velocity\r\n        particle.x += particle.vx * dt;\r\n        particle.y += particle.vy * dt;\r\n        \r\n        // Flicker opacity for digital effect\r\n        if (Math.random() < 0.02) {\r\n            particle.opacity = 0.1 + Math.random() * 0.9;\r\n        }\r\n        \r\n        // Size pulsing with beat\r\n        particle.size = particle.baseSize * (1 + beatIntensity * 0.3 + state.dropIntensity * 0.5);\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Directed Particle Behavior\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Directed behavior - particles move in focused, straight paths\r\n * @author Emotive Engine Team\r\n * @module particles/behaviors/directed\r\n */\r\n\r\n/**\r\n * DIRECTED BEHAVIOR - FOCUSED STRAIGHT PATHS\r\n * Used by: focused emotion\r\n * \r\n * Particles move in deliberate, straight lines toward a target or direction,\r\n * representing intense concentration and focus.\r\n */\r\nexport default {\r\n    name: 'directed',\r\n    emoji: '🎯',\r\n    description: 'Focused, straight-line movement toward target',\r\n    \r\n    // ┌─────────────────────────────────────────────────────────────────────────────────\r\n    // │ CONFIGURATION\r\n    // └─────────────────────────────────────────────────────────────────────────────────\r\n    config: {\r\n        speed: 3.0,              // Fast movement\r\n        acceleration: 0.15,      // Quick acceleration\r\n        focusStrength: 0.8,      // Strong pull toward target\r\n        randomness: 0.1,         // Minimal deviation\r\n        edgeBuffer: 50           // Buffer from canvas edges\r\n    },\r\n    \r\n    // ┌─────────────────────────────────────────────────────────────────────────────────\r\n    // │ INITIALIZATION\r\n    // └─────────────────────────────────────────────────────────────────────────────────\r\n    initialize(particle, centerX, centerY, canvasWidth, canvasHeight) {\r\n        // Set initial direction toward center\r\n        const dx = centerX - particle.x;\r\n        const dy = centerY - particle.y;\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        if (distance > 0) {\r\n            particle.vx = (dx / distance) * this.config.speed;\r\n            particle.vy = (dy / distance) * this.config.speed;\r\n        } else {\r\n            // Random initial direction if at center\r\n            const angle = Math.random() * Math.PI * 2;\r\n            particle.vx = Math.cos(angle) * this.config.speed;\r\n            particle.vy = Math.sin(angle) * this.config.speed;\r\n        }\r\n        \r\n        // Store target position\r\n        particle.targetX = centerX;\r\n        particle.targetY = centerY;\r\n        particle.directedPhase = 0;\r\n    },\r\n    \r\n    // ┌─────────────────────────────────────────────────────────────────────────────────\r\n    // │ UPDATE LOOP\r\n    // └─────────────────────────────────────────────────────────────────────────────────\r\n    update(particle, dt, centerX, centerY, canvasWidth, canvasHeight) {\r\n        // Update phase for variation\r\n        particle.directedPhase += dt * 0.05;\r\n        \r\n        // Calculate direction to target\r\n        const dx = particle.targetX - particle.x;\r\n        const dy = particle.targetY - particle.y;\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        if (distance > 10) {\r\n            // Move toward target with focus strength\r\n            const targetVx = (dx / distance) * this.config.speed;\r\n            const targetVy = (dy / distance) * this.config.speed;\r\n            \r\n            // Apply acceleration toward target velocity\r\n            particle.vx += (targetVx - particle.vx) * this.config.acceleration * dt;\r\n            particle.vy += (targetVy - particle.vy) * this.config.acceleration * dt;\r\n            \r\n            // Add minimal randomness for organic feel\r\n            particle.vx += (Math.random() - 0.5) * this.config.randomness;\r\n            particle.vy += (Math.random() - 0.5) * this.config.randomness;\r\n        } else {\r\n            // Near target, pick new target\r\n            const angle = Math.random() * Math.PI * 2;\r\n            const radius = 100 + Math.random() * 200;\r\n            particle.targetX = centerX + Math.cos(angle) * radius;\r\n            particle.targetY = centerY + Math.sin(angle) * radius;\r\n            \r\n            // Keep within canvas bounds\r\n            particle.targetX = Math.max(this.config.edgeBuffer, \r\n                              Math.min(canvasWidth - this.config.edgeBuffer, particle.targetX));\r\n            particle.targetY = Math.max(this.config.edgeBuffer, \r\n                              Math.min(canvasHeight - this.config.edgeBuffer, particle.targetY));\r\n        }\r\n        \r\n        // Apply velocity\r\n        particle.x += particle.vx * dt;\r\n        particle.y += particle.vy * dt;\r\n        \r\n        // Edge bouncing with dampening\r\n        if (particle.x <= 0 || particle.x >= canvasWidth) {\r\n            particle.vx *= -0.8;\r\n            particle.x = Math.max(0, Math.min(canvasWidth, particle.x));\r\n            // Pick new target after bounce\r\n            particle.targetX = centerX + (Math.random() - 0.5) * 300;\r\n        }\r\n        if (particle.y <= 0 || particle.y >= canvasHeight) {\r\n            particle.vy *= -0.8;\r\n            particle.y = Math.max(0, Math.min(canvasHeight, particle.y));\r\n            // Pick new target after bounce\r\n            particle.targetY = centerY + (Math.random() - 0.5) * 300;\r\n        }\r\n    },\r\n    \r\n    // ┌─────────────────────────────────────────────────────────────────────────────────\r\n    // │ VISUAL CHARACTERISTICS\r\n    // └─────────────────────────────────────────────────────────────────────────────────\r\n    visuals: {\r\n        trailLength: 'medium',      // Medium trail for motion clarity\r\n        opacity: 0.9,               // High opacity for focus\r\n        sizeMultiplier: 1.0,        // Standard size\r\n        blurAmount: 0.2             // Sharp, focused appearance\r\n    }\r\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Fizzy Particle Behavior\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Fizzy behavior - bubbly, effervescent particle movement\n * @author Emotive Engine Team\n * @module particles/behaviors/fizzy\n */\n\n/**\n * FIZZY BEHAVIOR - BUBBLY EFFERVESCENCE\n * Used by: excited emotion\n * \n * Particles bubble upward with random pops and fizz, like carbonation in soda.\n * Creates an energetic, celebratory atmosphere.\n */\nexport default {\n    name: 'fizzy',\n    emoji: '🫧',\n    description: 'Bubbly, effervescent movement like carbonation',\n    \n    // ┌─────────────────────────────────────────────────────────────────────────────────\n    // │ CONFIGURATION\n    // └─────────────────────────────────────────────────────────────────────────────────\n    config: {\n        baseRiseSpeed: 2.5,      // Base upward velocity\n        wobbleAmplitude: 30,     // Horizontal wobble range\n        wobbleFrequency: 0.15,   // Wobble oscillation speed\n        popChance: 0.002,        // Chance to \"pop\" per frame\n        popForce: 8,             // Force of pop burst\n        fizziness: 0.3,          // Random velocity variation\n        gravity: -0.05           // Slight upward bias\n    },\n    \n    // ┌─────────────────────────────────────────────────────────────────────────────────\n    // │ INITIALIZATION\n    // └─────────────────────────────────────────────────────────────────────────────────\n    initialize(particle, centerX, centerY, canvasWidth, canvasHeight) {\n        // Start with upward velocity\n        particle.vx = (Math.random() - 0.5) * 2;\n        particle.vy = -this.config.baseRiseSpeed - Math.random() * 2;\n        \n        // Fizzy properties\n        particle.wobblePhase = Math.random() * Math.PI * 2;\n        particle.wobbleSpeed = this.config.wobbleFrequency * (0.8 + Math.random() * 0.4);\n        particle.bubbleSize = 0.5 + Math.random() * 0.5;\n        particle.popTimer = 0;\n        particle.isFizzing = true;\n    },\n    \n    // ┌─────────────────────────────────────────────────────────────────────────────────\n    // │ UPDATE LOOP\n    // └─────────────────────────────────────────────────────────────────────────────────\n    update(particle, dt, centerX, centerY, canvasWidth, canvasHeight) {\n        // Update wobble phase\n        particle.wobblePhase += particle.wobbleSpeed * dt;\n        \n        // Apply wobble to horizontal movement\n        const wobble = Math.sin(particle.wobblePhase) * this.config.wobbleAmplitude;\n        particle.vx = wobble * 0.05 + (Math.random() - 0.5) * this.config.fizziness;\n        \n        // Apply upward force with variation\n        particle.vy += this.config.gravity * dt;\n        particle.vy += (Math.random() - 0.5) * this.config.fizziness;\n        \n        // Random \"pop\" events\n        if (Math.random() < this.config.popChance) {\n            // Pop! Send particle in random direction\n            const popAngle = Math.random() * Math.PI * 2;\n            particle.vx = Math.cos(popAngle) * this.config.popForce;\n            particle.vy = Math.sin(popAngle) * this.config.popForce * 0.7; // Slightly favor horizontal\n            particle.popTimer = 1; // Visual feedback timer\n            \n            // Resize on pop\n            particle.bubbleSize = 0.3 + Math.random() * 0.7;\n        }\n        \n        // Decay pop effect\n        if (particle.popTimer > 0) {\n            particle.popTimer -= dt * 0.05;\n            // Slow down after pop\n            particle.vx *= 0.95;\n            particle.vy *= 0.95;\n        }\n        \n        // Apply velocity\n        particle.x += particle.vx * dt;\n        particle.y += particle.vy * dt;\n        \n        // Wrap around vertically (bubbles rise and restart)\n        if (particle.y < -50) {\n            particle.y = canvasHeight + 50;\n            particle.x = centerX + (Math.random() - 0.5) * 300;\n            particle.vy = -this.config.baseRiseSpeed - Math.random() * 2;\n            particle.bubbleSize = 0.5 + Math.random() * 0.5;\n        }\n        \n        // Horizontal bounds with soft bounce\n        if (particle.x <= 0 || particle.x >= canvasWidth) {\n            particle.vx *= -0.5;\n            particle.x = Math.max(0, Math.min(canvasWidth, particle.x));\n        }\n        \n        // Bottom boundary (bubbles can spawn from bottom)\n        if (particle.y > canvasHeight + 50) {\n            particle.y = canvasHeight;\n            particle.vy = -this.config.baseRiseSpeed * 1.5;\n        }\n        \n        // Update size based on bubble properties\n        particle.size = particle.baseSize * particle.bubbleSize * \n                       (1 + Math.sin(particle.wobblePhase * 2) * 0.1);\n    },\n    \n    // ┌─────────────────────────────────────────────────────────────────────────────────\n    // │ VISUAL CHARACTERISTICS\n    // └─────────────────────────────────────────────────────────────────────────────────\n    visuals: {\n        trailLength: 'short',       // Short trails for bubbly feel\n        opacity: 0.6,               // Semi-transparent like bubbles\n        sizeMultiplier: 1.2,        // Slightly larger for bubble effect\n        blurAmount: 0.5,            // Soft, bubble-like appearance\n        sparkle: true               // Occasional sparkle effect\n    }\n};","/**\n * Calm Particle Behavior\n * Particles drift peacefully with minimal, smooth movement\n */\n\nimport { selectWeightedColor } from '../utils/colorUtils.js';\n\n// Behavior configuration\nconst config = {\n    baseSpeed: 0.08,           // Very slow base movement\n    driftSpeed: 0.02,          // Minimal drift speed\n    fadeSpeed: 0.0008,         // Very slow fade\n    sizeChange: 0.0002,        // Minimal size variation\n    swayAmplitude: 3,          // Gentle horizontal sway\n    floatAmplitude: 2,         // Minimal vertical float\n    rotationSpeed: 0.0001,     // Barely perceptible rotation\n    minOpacity: 0.15,          // Minimum visibility\n    maxOpacity: 0.35,          // Maximum visibility (subtle)\n    breathingPeriod: 8000,     // 8 second breathing cycle\n    connectionDistance: 0,      // No connections between particles\n    centerAttraction: 0.00005  // Very slight pull to center\n};\n\n/**\n * Initialize a particle with calm properties\n * @param {Object} particle - The particle to initialize\n */\nexport function initializeCalm(particle) {\n    // Start with faster initial burst movement\n    particle.vx = (Math.random() - 0.5) * 0.5;  // Increased 5x from 0.1\n    particle.vy = (Math.random() - 0.5) * 0.5;  // Increased 5x from 0.1\n    particle.lifeDecay = 0.003;  // Moderate fade (particles last ~5-6 seconds)\n\n    // Use emotion colors if provided\n    if (particle.emotionColors && particle.emotionColors.length > 0) {\n        particle.color = selectWeightedColor(particle.emotionColors);\n    }\n\n    // Calm-specific behavior data\n    particle.behaviorData = {\n        orbitAngle: Math.random() * Math.PI * 2,  // Starting angle around center\n        orbitRadius: 40 + Math.random() * 60,      // Distance from center (40-100 pixels)\n        orbitSpeed: 0.0008 + Math.random() * 0.0006, // Faster orbit speed (4x)\n        floatOffset: Math.random() * Math.PI * 2,\n        breathingOffset: Math.random() * Math.PI * 2,\n        lifetime: 0\n    };\n}\n\n/**\n * Update calm behavior each frame\n * @param {Object} particle - The particle to update\n * @param {number} dt - Delta time\n * @param {number} centerX - Orb center X\n * @param {number} centerY - Orb center Y\n */\nexport function updateCalm(particle, dt, centerX, centerY) {\n    const data = particle.behaviorData;\n    if (!data) return;\n\n    data.lifetime += dt;\n\n    // Breathing effect (very subtle size change)\n    const breathPhase = (data.lifetime + data.breathingOffset * config.breathingPeriod) / config.breathingPeriod;\n    const breathIntensity = Math.sin(breathPhase * Math.PI * 2) * 0.5 + 0.5;\n\n    // Apply subtle size pulsing\n    particle.size = particle.baseSize * (0.95 + breathIntensity * 0.05);\n\n    // Slow orbital movement around the mascot\n    data.orbitAngle += data.orbitSpeed * dt;\n\n    // Vary the orbit radius slightly over time for organic movement\n    const radiusVariation = Math.sin(data.lifetime * 0.0001 + data.floatOffset) * 10;\n    const currentRadius = data.orbitRadius + radiusVariation;\n\n    // Calculate target position in orbit\n    const targetX = centerX + Math.cos(data.orbitAngle) * currentRadius;\n    const targetY = centerY + Math.sin(data.orbitAngle) * currentRadius;\n\n    // Add vertical floating motion\n    const floatY = Math.sin(data.lifetime * 0.0003 + data.breathingOffset) * 15;\n\n    // Smoothly move toward orbital position\n    const dx = targetX - particle.x;\n    const dy = (targetY + floatY) - particle.y;\n\n    // Faster movement toward target position\n    particle.vx = dx * 0.03;  // Faster following (3x)\n    particle.vy = dy * 0.03;  // Faster following (3x)\n\n    // Add more random drift for organic feel\n    particle.vx += (Math.random() - 0.5) * 0.02;  // More drift\n    particle.vy += (Math.random() - 0.5) * 0.02;  // More drift\n\n    // Apply very light friction\n    particle.vx *= 0.98;\n    particle.vy *= 0.98;\n}\n\n// Export behavior definition for registry\nexport default {\n    name: 'zen',\n    emoji: '☯️',\n    description: 'Peaceful orbital movement like a hovering aura',\n    initialize: initializeCalm,\n    update: updateCalm\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Plugin Behavior Adapter\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Adapter for plugin-defined particle behaviors\r\n * @author Emotive Engine Team\r\n * @module particles/behaviors/plugin-adapter\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Bridges the gap between the plugin system and modular particle behaviors.         \r\n * ║ Allows plugins to register custom particle behaviors that integrate seamlessly    \r\n * ║ with the modular particle system.                                                 \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nimport { selectWeightedColor } from '../utils/colorUtils.js';\r\n\r\n// Registry for plugin-defined behaviors\r\nconst pluginBehaviors = new Map();\r\n\r\n/**\r\n * Register a custom particle behavior from a plugin\r\n * @param {string} name - Unique name for the behavior\r\n * @param {Object} behaviorDef - Behavior definition object\r\n * @returns {boolean} Success status\r\n */\r\nexport function registerPluginBehavior(name, behaviorDef) {\r\n    if (pluginBehaviors.has(name)) {\r\n    }\r\n    \r\n    // Validate behavior definition\r\n    if (!behaviorDef.initialize || typeof behaviorDef.initialize !== 'function') {\r\n        return false;\r\n    }\r\n    \r\n    if (!behaviorDef.update || typeof behaviorDef.update !== 'function') {\r\n        return false;\r\n    }\r\n    \r\n    // Store the behavior\r\n    pluginBehaviors.set(name, {\r\n        name,\r\n        emoji: behaviorDef.emoji || '🔌',\r\n        description: behaviorDef.description || `Plugin behavior: ${name}`,\r\n        initialize: behaviorDef.initialize,\r\n        update: behaviorDef.update,\r\n        isPlugin: true\r\n    });\r\n    \r\n    return true;\r\n}\r\n\r\n/**\r\n * Unregister a plugin behavior\r\n * @param {string} name - Name of the behavior to remove\r\n * @returns {boolean} Success status\r\n */\r\nexport function unregisterPluginBehavior(name) {\r\n    if (pluginBehaviors.has(name)) {\r\n        pluginBehaviors.delete(name);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Get a plugin behavior by name\r\n * @param {string} name - Name of the behavior\r\n * @returns {Object|null} Behavior definition or null\r\n */\r\nexport function getPluginBehavior(name) {\r\n    return pluginBehaviors.get(name) || null;\r\n}\r\n\r\n/**\r\n * Get all registered plugin behaviors\r\n * @returns {Array} Array of behavior names\r\n */\r\nexport function getAllPluginBehaviors() {\r\n    return Array.from(pluginBehaviors.keys());\r\n}\r\n\r\n/**\r\n * Create a behavior wrapper for legacy plugin particle effects\r\n * Converts old-style particle definitions to modular behavior format\r\n * @param {Object} legacyBehavior - Legacy behavior configuration\r\n * @returns {Object} Modular behavior definition\r\n */\r\nexport function createLegacyAdapter(legacyBehavior) {\r\n    return {\r\n        name: legacyBehavior.name || 'legacy',\r\n        emoji: '🔄',\r\n        description: legacyBehavior.description || 'Legacy plugin behavior',\r\n        \r\n        initialize: function(particle) {\r\n            // Apply legacy configuration\r\n            if (legacyBehavior.size) {\r\n                particle.size = typeof legacyBehavior.size === 'object' ?\r\n                    legacyBehavior.size.min + Math.random() * (legacyBehavior.size.max - legacyBehavior.size.min) :\r\n                    legacyBehavior.size;\r\n                particle.baseSize = particle.size;\r\n            }\r\n            \r\n            if (legacyBehavior.speed) {\r\n                const speed = typeof legacyBehavior.speed === 'object' ?\r\n                    legacyBehavior.speed.min + Math.random() * (legacyBehavior.speed.max - legacyBehavior.speed.min) :\r\n                    legacyBehavior.speed;\r\n                const angle = Math.random() * Math.PI * 2;\r\n                particle.vx = Math.cos(angle) * speed;\r\n                particle.vy = Math.sin(angle) * speed;\r\n            }\r\n            \r\n            if (legacyBehavior.lifespan) {\r\n                const lifespan = typeof legacyBehavior.lifespan === 'object' ?\r\n                    legacyBehavior.lifespan.min + Math.random() * (legacyBehavior.lifespan.max - legacyBehavior.lifespan.min) :\r\n                    legacyBehavior.lifespan;\r\n                particle.lifeDecay = 1000 / lifespan; // Convert ms to decay rate\r\n            }\r\n            \r\n            if (legacyBehavior.color) {\r\n                particle.color = Array.isArray(legacyBehavior.color) ?\r\n                    selectWeightedColor(legacyBehavior.color) :\r\n                    legacyBehavior.color;\r\n            }\r\n            \r\n            if (legacyBehavior.opacity) {\r\n                particle.life = typeof legacyBehavior.opacity === 'object' ?\r\n                    legacyBehavior.opacity.min + Math.random() * (legacyBehavior.opacity.max - legacyBehavior.opacity.min) :\r\n                    legacyBehavior.opacity;\r\n            }\r\n            \r\n            // Store legacy-specific data\r\n            particle.behaviorData = {\r\n                movementType: legacyBehavior.movementType || 'linear',\r\n                turbulence: legacyBehavior.turbulence || 0,\r\n                drift: legacyBehavior.drift || 0,\r\n                acceleration: legacyBehavior.acceleration || 0,\r\n                ...legacyBehavior.customData\r\n            };\r\n        },\r\n        \r\n        update: function(particle, dt, centerX, centerY) {\r\n            const data = particle.behaviorData;\r\n            \r\n            // Apply movement based on type\r\n            switch (data.movementType) {\r\n                case 'wander':\r\n                    // Random wandering\r\n                    particle.vx += (Math.random() - 0.5) * data.turbulence * dt;\r\n                    particle.vy += (Math.random() - 0.5) * data.turbulence * dt;\r\n                    break;\r\n                    \r\n                case 'fall':\r\n                    // Falling with drift\r\n                    particle.vy += 0.1 * dt; // Gravity\r\n                    particle.vx += (Math.random() - 0.5) * data.drift * dt;\r\n                    break;\r\n                    \r\n                case 'rain':\r\n                    // Digital rain effect\r\n                    particle.vy += data.acceleration * dt;\r\n                    break;\r\n                    \r\n                case 'orbit':\r\n                    // Orbital motion\r\n                    const dx = particle.x - centerX;\r\n                    const dy = particle.y - centerY;\r\n                    const dist = Math.sqrt(dx * dx + dy * dy);\r\n                    if (dist > 0) {\r\n                        const angle = Math.atan2(dy, dx) + 0.02 * dt;\r\n                        particle.x = centerX + Math.cos(angle) * dist;\r\n                        particle.y = centerY + Math.sin(angle) * dist;\r\n                    }\r\n                    break;\r\n                    \r\n                case 'linear':\r\n                default:\r\n                    // Simple linear motion (already handled by velocity)\r\n                    break;\r\n            }\r\n            \r\n            // Call custom update if provided\r\n            if (legacyBehavior.customUpdate) {\r\n                legacyBehavior.customUpdate(particle, dt, centerX, centerY);\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\n// Export adapter functions for plugin system integration\r\nexport default {\r\n    registerPluginBehavior,\r\n    unregisterPluginBehavior,\r\n    getPluginBehavior,\r\n    getAllPluginBehaviors,\r\n    createLegacyAdapter\r\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE v4.0 - Behavior Registry\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Central registry for all particle behaviors with plugin support\n * @author Emotive Engine Team\n * @version 4.0.0\n * @module particles/behaviors\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Control center for particle behaviors with plugin adapter integration.            \n * ║ • Each behavior defines unique particle physics and movement patterns             \n * ║ • Core behaviors loaded synchronously at startup                                  \n * ║ • Plugin behaviors registered dynamically via adapter                             \n * ║ • Value-agnostic design for easy physics tuning                                   \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n */\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ IMPORT ALL BEHAVIORS\n// └─────────────────────────────────────────────────────────────────────────────────────\nimport ambient from './ambient.js';\nimport orbiting from './orbiting.js';\nimport rising from './rising.js';\nimport falling from './falling.js';\nimport popcorn from './popcorn.js';\nimport burst from './burst.js';\nimport aggressive from './aggressive.js';\nimport scattering from './scattering.js';\nimport repelling from './repelling.js';\nimport connecting from './connecting.js';\nimport resting from './resting.js';\nimport radiant from './radiant.js';\nimport ascending from './ascending.js';\nimport erratic from './erratic.js';\nimport cautious from './cautious.js';\nimport surveillance from './surveillance.js';\nimport glitchy from './glitchy.js';\nimport directed from './directed.js';\nimport fizzy from './fizzy.js';\nimport zen from './zen.js';\nimport pluginAdapter from './plugin-adapter.js';\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ BEHAVIOR COLLECTION\n// └─────────────────────────────────────────────────────────────────────────────────────\nconst BEHAVIORS = [\n    ambient,\n    directed,\n    fizzy,\n    orbiting,\n    rising,\n    falling,\n    popcorn,\n    burst,\n    aggressive,\n    scattering,\n    repelling,\n    connecting,\n    resting,\n    radiant,\n    ascending,\n    erratic,\n    cautious,\n    surveillance,\n    glitchy,\n    zen\n];\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ BEHAVIOR REGISTRY - Fast lookup by name\n// └─────────────────────────────────────────────────────────────────────────────────────\nexport const BEHAVIOR_REGISTRY = {};\n\n// Build the registry from the behaviors array - SYNCHRONOUSLY\nBEHAVIORS.forEach(behavior => {\n    BEHAVIOR_REGISTRY[behavior.name] = behavior;\n});\n\n/**\n * Get a behavior by name (checks both core and plugin behaviors)\n * @param {string} name - Behavior name (e.g., 'ambient', 'orbiting')\n * @returns {Object|null} Behavior object or null if not found\n */\nexport function getBehavior(name) {\n    // Check core behaviors first\n    if (BEHAVIOR_REGISTRY[name]) {\n        return BEHAVIOR_REGISTRY[name];\n    }\n    // Check plugin behaviors\n    const pluginBehavior = pluginAdapter.getPluginBehavior(name);\n    if (pluginBehavior) {\n        return pluginBehavior;\n    }\n    return null;\n}\n\n/**\n * Initialize a particle with a specific behavior\n * @param {Particle} particle - The particle to initialize\n * @param {string} behaviorName - Name of the behavior to apply\n * @returns {boolean} True if behavior was found and applied\n */\nexport function initializeBehavior(particle, behaviorName) {\n    const behavior = getBehavior(behaviorName);\n    if (behavior && behavior.initialize) {\n        behavior.initialize(particle);\n        return true;\n    }\n    // Fallback to ambient if behavior not found\n    if (behaviorName !== 'ambient') {\n        return initializeBehavior(particle, 'ambient');\n    }\n    return false;\n}\n\n/**\n * Update a particle's behavior\n * @param {Particle} particle - The particle to update\n * @param {string} behaviorName - Name of the behavior\n * @param {number} dt - Delta time\n * @param {number} centerX - Orb center X\n * @param {number} centerY - Orb center Y\n * @returns {boolean} True if behavior was found and updated\n */\nexport function updateBehavior(particle, behaviorName, dt, centerX, centerY) {\n    const behavior = getBehavior(behaviorName);\n    if (behavior && behavior.update) {\n        behavior.update(particle, dt, centerX, centerY);\n        return true;\n    }\n    return false;\n}\n\n/**\n * Get list of all available behaviors (core and plugin)\n * @returns {Array} Array of behavior names and descriptions\n */\nexport function listBehaviors() {\n    // Get core behaviors\n    const coreBehaviors = Object.values(BEHAVIOR_REGISTRY).map(behavior => ({\n        name: behavior.name,\n        emoji: behavior.emoji || '🎯',\n        description: behavior.description || 'No description',\n        type: 'core'\n    }));\n    \n    // Get plugin behaviors\n    const pluginBehaviorNames = pluginAdapter.getAllPluginBehaviors();\n    const pluginBehaviors = pluginBehaviorNames.map(name => {\n        const behavior = pluginAdapter.getPluginBehavior(name);\n        return {\n            name: behavior.name,\n            emoji: behavior.emoji || '🔌',\n            description: behavior.description || 'Plugin behavior',\n            type: 'plugin'\n        };\n    });\n    \n    return [...coreBehaviors, ...pluginBehaviors];\n}\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ DEBUG UTILITIES\n// └─────────────────────────────────────────────────────────────────────────────────────\nif (typeof window !== 'undefined' && window.DEBUG_PARTICLES) {\n    window.ParticleBehaviors = {\n        registry: BEHAVIOR_REGISTRY,\n        list: listBehaviors,\n        get: getBehavior\n    };\n}\n\n// Export plugin adapter for external use\nexport { pluginAdapter };\n\n// Export everything\nexport default {\n    BEHAVIOR_REGISTRY,\n    getBehavior,\n    initializeBehavior,\n    updateBehavior,\n    listBehaviors,\n    pluginAdapter\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE v4.0 - Gesture Plugin Adapter\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Bridge between plugin system and gesture registry\r\n * @author Emotive Engine Team\r\n * @version 4.0.0\r\n * @module gestures/plugin-adapter\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Adapter for dynamic gesture registration from plugins.                            \r\n * ║ • Maintains separate registry for plugin gestures                                 \r\n * ║ • Validates gesture definitions for required apply() function                     \r\n * ║ • Provides legacy format conversion for older plugins                             \r\n * ║ • Enables runtime registration and unregistration                                 \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\n/**\r\n * Plugin gesture registry\r\n */\r\nconst pluginGestures = new Map();\r\n\r\n/**\r\n * Register a plugin gesture\r\n * @param {string} name - Gesture name\r\n * @param {Object} gestureDef - Gesture definition object\r\n */\r\nexport function registerPluginGesture(name, gestureDef) {\r\n    // Ensure gesture has required properties\r\n    if (!gestureDef.apply && !gestureDef.type) {\r\n        return false;\r\n    }\r\n    \r\n    // Add name if not present\r\n    if (!gestureDef.name) {\r\n        gestureDef.name = name;\r\n    }\r\n    \r\n    // Set default type if not specified\r\n    if (!gestureDef.type) {\r\n        gestureDef.type = 'blending';\r\n    }\r\n    \r\n    pluginGestures.set(name, gestureDef);\r\n    \r\n    if (typeof window !== 'undefined' && window.DEBUG_GESTURES) {\r\n    }\r\n    \r\n    return true;\r\n}\r\n\r\n/**\r\n * Unregister a plugin gesture\r\n * @param {string} name - Gesture name to remove\r\n */\r\nexport function unregisterPluginGesture(name) {\r\n    if (pluginGestures.has(name)) {\r\n        pluginGestures.delete(name);\r\n        \r\n        if (typeof window !== 'undefined' && window.DEBUG_GESTURES) {\r\n        }\r\n        \r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Get a plugin gesture by name\r\n * @param {string} name - Gesture name\r\n * @returns {Object|null} Gesture object or null if not found\r\n */\r\nexport function getPluginGesture(name) {\r\n    return pluginGestures.get(name) || null;\r\n}\r\n\r\n/**\r\n * Get all plugin gesture names\r\n * @returns {Array<string>} Array of gesture names\r\n */\r\nexport function getAllPluginGestures() {\r\n    return Array.from(pluginGestures.keys());\r\n}\r\n\r\n/**\r\n * Clear all plugin gestures\r\n */\r\nexport function clearPluginGestures() {\r\n    pluginGestures.clear();\r\n}\r\n\r\n/**\r\n * Convert legacy plugin gesture format to new format\r\n * @param {Object} legacyGesture - Old format gesture\r\n * @returns {Object} New format gesture\r\n */\r\nexport function createLegacyAdapter(legacyGesture) {\r\n    return {\r\n        name: legacyGesture.name || 'unknown',\r\n        type: legacyGesture.type || 'blending',\r\n        emoji: legacyGesture.emoji || '🔌',\r\n        description: legacyGesture.description || 'Plugin gesture',\r\n        config: legacyGesture.config || {},\r\n        \r\n        apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n            // Adapt old plugin format to new format\r\n            if (legacyGesture.animate) {\r\n                // Old plugins might use 'animate' instead of 'apply'\r\n                legacyGesture.animate(particle, progress, motion, dt, centerX, centerY);\r\n            } else if (legacyGesture.apply) {\r\n                legacyGesture.apply(particle, progress, motion, dt, centerX, centerY);\r\n            }\r\n        },\r\n        \r\n        cleanup: legacyGesture.cleanup || function(particle) {\r\n            // Default cleanup\r\n            if (particle.gestureData && particle.gestureData[this.name]) {\r\n                delete particle.gestureData[this.name];\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\n// Export adapter interface\r\nexport default {\r\n    registerPluginGesture,\r\n    unregisterPluginGesture,\r\n    getPluginGesture,\r\n    getAllPluginGestures,\r\n    clearPluginGestures,\r\n    createLegacyAdapter\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Bounce Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Bounce gesture - vertical oscillation motion\r\n * @author Emotive Engine Team\r\n * @module gestures/motions/bounce\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a bouncing motion with particles oscillating vertically.                  \r\n * ║ This is a BLENDING gesture that adds to existing particle motion.                 \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *        ↑\r\n *       ⭐      <- peak\r\n *      ↗ ↘\r\n *     ↗   ↘\r\n *    ⭐     ⭐   <- midpoint\r\n *   ↗       ↘\r\n *  ↗         ↘\r\n * ⭐           ⭐ <- trough\r\n * \r\n * USED BY:\r\n * - Joy emotions (playful bouncing)\r\n * - Excited states (energetic movement)\r\n * - Celebration gestures\r\n */\r\n\r\n/**\r\n * Bounce gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'bounce',\r\n    emoji: '⬆️',\r\n    type: 'blending', // Adds to existing motion\r\n    description: 'Vertical oscillation with smooth easing',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 800,      // Legacy fallback\r\n        musicalDuration: { musical: true, beats: 2 }, // 2 beats\r\n        amplitude: 30,      // Bounce height range\r\n        frequency: 2,       // Number of oscillations\r\n        axis: 'vertical',   // Movement axis: 'vertical' or 'horizontal'\r\n        damping: true,      // Enable amplitude reduction over time\r\n        easing: 'sine',     // Animation curve type\r\n        strength: 0.6,      // Overall motion intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'bounce',\r\n            axis: 'vertical',   // Oscillation direction\r\n            strength: 0.6,      // Particle bounce strength\r\n            frequency: 2        // Particle oscillation count\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - bounce syncs perfectly to beat\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',  // Each bounce lands on a beat\r\n        timingSync: 'nextBeat',     // Start on next beat\r\n        interruptible: true,         // Can interrupt mid-bounce\r\n        priority: 3,                 // Lower priority\r\n        blendable: true,             // Can blend with other effects\r\n        crossfadePoint: 'anyBeat',   // Can transition out on any beat\r\n        \r\n        // Bounce height syncs to beat intensity\r\n        amplitudeSync: {\r\n            onBeat: 1.8,      // Higher bounce on beat\r\n            offBeat: 0.6,     // Lower between beats\r\n            curve: 'bounce'   // Natural bounce curve\r\n        },\r\n        \r\n        // Frequency can sync to tempo\r\n        frequencySync: {\r\n            mode: 'tempo',    // Bounces per beat scale with BPM\r\n            multiplier: 1.0   // 1 bounce per beat\r\n        },\r\n        \r\n        // Duration syncs to musical time\r\n        durationSync: {\r\n            mode: 'beats',    // Duration in beats\r\n            beats: 4          // Bounce for 4 beats (1 bar in 4/4)\r\n        },\r\n        \r\n        // Accent response for stronger downbeats\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 1.5   // 50% higher on accented beats\r\n        },\r\n        \r\n        // Pattern-specific bouncing styles\r\n        patternOverrides: {\r\n            'waltz': {\r\n                // 3/4 time creates elegant triple bounce\r\n                frequencySync: { multiplier: 0.75 },\r\n                durationSync: { beats: 3 }\r\n            },\r\n            'swing': {\r\n                // Jazzy swing bounce with syncopation\r\n                amplitudeSync: { onBeat: 2.0, offBeat: 0.4, curve: 'ease' }\r\n            },\r\n            'dubstep': {\r\n                // Heavy drop on beat 3\r\n                amplitudeSync: { \r\n                    onBeat: 1.5,\r\n                    dropBeat: 3.0,  // Massive bounce on the drop\r\n                    curve: 'pulse'\r\n                }\r\n            },\r\n            'breakbeat': {\r\n                // Chaotic broken rhythm bouncing\r\n                frequencySync: { multiplier: 1.5 },\r\n                amplitudeSync: { onBeat: 2.2, offBeat: 0.3 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * Called once when gesture starts\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     */\r\n    initialize: function(particle, motion) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        particle.gestureData.bounce = {\r\n            startY: particle.y,\r\n            startX: particle.x,\r\n            startVx: particle.vx,\r\n            startVy: particle.vy,\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply bounce motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.bounce?.initialized) {\r\n            this.initialize(particle, motion);\r\n        }\r\n        \r\n        const config = { ...this.config, ...motion };\r\n        const strength = config.strength || this.config.strength || 1.0;\r\n        \r\n        // Apply easing\r\n        const easeProgress = this.easeInOutCubic(progress);\r\n        \r\n        // Calculate oscillation\r\n        let frequency = config.frequency;\r\n        const phase = motion.phase || 0;\r\n        \r\n        // Apply rhythm modulation if present\r\n        let amplitude = config.amplitude * strength * particle.scaleFactor;\r\n        if (motion.rhythmModulation) {\r\n            amplitude *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            amplitude *= (motion.rhythmModulation.accentMultiplier || 1);\r\n            // Frequency modulation for tempo sync\r\n            if (motion.rhythmModulation.frequencyMultiplier) {\r\n                frequency *= motion.rhythmModulation.frequencyMultiplier;\r\n            }\r\n        }\r\n        \r\n        const oscillation = Math.sin((easeProgress + phase) * Math.PI * 2 * frequency);\r\n        if (config.damping && progress > 0.7) {\r\n            // Reduce amplitude toward end of animation\r\n            const dampProgress = (progress - 0.7) / 0.3;\r\n            amplitude *= (1 - dampProgress * 0.8);\r\n        }\r\n        \r\n        // Apply motion based on axis\r\n        if (config.axis === 'vertical') {\r\n            particle.vy += oscillation * amplitude * 0.01 * dt;\r\n            \r\n            // Dampen horizontal movement slightly for stability\r\n            if (progress > 0.9) {\r\n                particle.vx *= 0.98;\r\n            }\r\n        } else if (config.axis === 'horizontal') {\r\n            particle.vx += oscillation * amplitude * 0.01 * dt;\r\n            \r\n            // Dampen vertical movement slightly for stability\r\n            if (progress > 0.9) {\r\n                particle.vy *= 0.98;\r\n            }\r\n        }\r\n        \r\n        // Smooth ending - gradually reduce velocity modifications\r\n        if (progress > 0.9) {\r\n            const endFactor = 1 - ((progress - 0.9) * 10);\r\n            particle.vx = particle.vx * (0.95 + endFactor * 0.05);\r\n            particle.vy = particle.vy * (0.95 + endFactor * 0.05);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.bounce) {\r\n            delete particle.gestureData.bounce;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Easing function for smooth animation\r\n     * @param {number} t - Progress (0-1)\r\n     * @returns {number} Eased value\r\n     */\r\n    easeInOutCubic: function(t) {\r\n        return t < 0.5 \r\n            ? 4 * t * t * t \r\n            : 1 - Math.pow(-2 * t + 2, 3) / 2;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Pulse Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Pulse gesture - radial expansion and contraction\r\n * @author Emotive Engine Team\r\n * @module gestures/motions/pulse\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a breathing/heartbeat effect with particles expanding and contracting      \r\n * ║ radially from the center. This is a BLENDING gesture that modifies positions.     \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *     Expand          Contract         Expand\r\n *    ← · · · →         → ⭐ ←         ← · · · →\r\n *    ↖ · · ↗           ↘ ↓ ↙           ↖ · · ↗\r\n *    · · ⭐ · ·   →    · ⭐ ·     →   · · ⭐ · ·\r\n *    ↙ · · ↘           ↗ ↑ ↖           ↙ · · ↘\r\n *    ← · · · →         → ⭐ ←         ← · · · →\r\n * \r\n * USED BY:\r\n * - Love emotions (heartbeat rhythm)\r\n * - Breathing/calm states\r\n * - Emphasis gestures\r\n */\r\n\r\n/**\r\n * Pulse gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'pulse',\r\n    emoji: '💗',\r\n    type: 'blending', // Adds to existing motion\r\n    description: 'Radial expansion and contraction from center',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 600,      // Animation duration\r\n        amplitude: 30,      // Expansion distance\r\n        frequency: 1,       // Number of pulses\r\n        holdPeak: 0.1,      // Peak expansion hold time\r\n        easing: 'sine',     // Animation curve type\r\n        scaleAmount: 0.2,   // Orb scale variation\r\n        glowAmount: 0.3,    // Orb glow intensity change\r\n        strength: 0.15,     // Particle motion strength\r\n        direction: 'outward', // Radial direction\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'pulse',\r\n            strength: 0.15,\r\n            direction: 'outward',\r\n            frequency: 1\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - pulse as heartbeat synced to music\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',  // Heartbeat on every beat\r\n        \r\n        // Pulse strength syncs to beat\r\n        amplitudeSync: {\r\n            onBeat: 1.6,      // Strong expansion on beat\r\n            offBeat: 0.8,     // Gentle contraction off beat\r\n            curve: 'pulse'    // Sharp attack, gradual release\r\n        },\r\n        \r\n        // Frequency locks to tempo\r\n        frequencySync: {\r\n            mode: 'locked',   // One pulse per beat\r\n            subdivision: 'quarter'  // Pulse on quarter notes\r\n        },\r\n        \r\n        // Duration in musical time\r\n        durationSync: {\r\n            mode: 'beats',\r\n            beats: 1          // One pulse per beat\r\n        },\r\n        \r\n        // Stronger pulse on downbeats\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 2.0   // Double strength on accent\r\n        },\r\n        \r\n        // Pattern-specific pulse styles\r\n        patternOverrides: {\r\n            'waltz': {\r\n                // Elegant 3/4 heartbeat\r\n                amplitudeSync: { onBeat: 2.0, offBeat: 0.5 },\r\n                durationSync: { beats: 3 }\r\n            },\r\n            'swing': {\r\n                // Syncopated jazz pulse\r\n                amplitudeSync: { onBeat: 1.8, offBeat: 0.6, curve: 'ease' },\r\n                frequencySync: { subdivision: 'swing' }\r\n            },\r\n            'dubstep': {\r\n                // Deep bass pulse on drop\r\n                amplitudeSync: {\r\n                    onBeat: 1.2,\r\n                    dropBeat: 4.0,  // Massive pulse on beat 3\r\n                    curve: 'pulse'\r\n                }\r\n            },\r\n            'breakbeat': {\r\n                // Erratic heartbeat\r\n                frequencySync: { mode: 'random', range: [0.5, 2.0] },\r\n                amplitudeSync: { onBeat: 2.5, offBeat: 0.3 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        // Calculate initial distance and angle from center\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        const angle = Math.atan2(dy, dx);\r\n        \r\n        particle.gestureData.pulse = {\r\n            baseDistance: distance,\r\n            angle: angle,\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply pulse motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.pulse?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.pulse;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = motion.strength || 1.0;\r\n        \r\n        // Apply easing\r\n        const easeProgress = this.easeInOutSine(progress);\r\n        \r\n        // Calculate pulse with optional peak hold\r\n        let pulseValue;\r\n        let frequency = config.frequency;\r\n        let amplitude = config.amplitude;\r\n        \r\n        // Apply rhythm modulation if present\r\n        if (motion.rhythmModulation) {\r\n            amplitude *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            amplitude *= (motion.rhythmModulation.accentMultiplier || 1);\r\n            if (motion.rhythmModulation.frequencyMultiplier) {\r\n                frequency *= motion.rhythmModulation.frequencyMultiplier;\r\n            }\r\n        }\r\n        \r\n        const rawPulse = (easeProgress * frequency * 2) % 2;\r\n        \r\n        if (config.holdPeak > 0 && rawPulse > (1 - config.holdPeak) && rawPulse < (1 + config.holdPeak)) {\r\n            // Hold at peak\r\n            pulseValue = 1;\r\n        } else {\r\n            // Normal sine wave\r\n            pulseValue = Math.sin(easeProgress * Math.PI * 2 * frequency);\r\n        }\r\n        \r\n        // Calculate expansion amount\r\n        const expansion = pulseValue * amplitude * strength * particle.scaleFactor;\r\n        \r\n        // Calculate target position\r\n        const targetDistance = data.baseDistance + expansion;\r\n        const targetX = centerX + Math.cos(data.angle) * targetDistance;\r\n        const targetY = centerY + Math.sin(data.angle) * targetDistance;\r\n        \r\n        // Smoothly move toward target\r\n        const moveSpeed = 0.15 * dt;\r\n        particle.vx += (targetX - particle.x) * moveSpeed * 0.1;\r\n        particle.vy += (targetY - particle.y) * moveSpeed * 0.1;\r\n        \r\n        // Fade effect at the end\r\n        if (progress > 0.9) {\r\n            const fadeFactor = 1 - ((progress - 0.9) * 10);\r\n            particle.vx *= (0.9 + fadeFactor * 0.1);\r\n            particle.vy *= (0.9 + fadeFactor * 0.1);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.pulse) {\r\n            delete particle.gestureData.pulse;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Sine easing for smooth breathing motion\r\n     * @param {number} t - Progress (0-1)\r\n     * @returns {number} Eased value\r\n     */\r\n    easeInOutSine: function(t) {\r\n        return -(Math.cos(Math.PI * t) - 1) / 2;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Shake Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Shake gesture - random jitter motion\r\n * @author Emotive Engine Team\r\n * @module gestures/motions/shake\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a shaking/vibrating effect with random jitter. Perfect for expressing     \r\n * ║ nervousness, excitement, or impact effects. This is a BLENDING gesture.           \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *     Frame 1        Frame 2        Frame 3\r\n *        ⭐      →    ⭐       →      ⭐\r\n *       ↙↗↘↖         ↖↘↗↙          ↗↖↙↘\r\n *    (random)      (random)       (random)\r\n * \r\n * USED BY:\r\n * - Nervous/anxious states\r\n * - Anger (trembling with rage)\r\n * - Cold/shivering effects\r\n * - Impact reactions\r\n */\r\n\r\n/**\r\n * Shake gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'shake',\r\n    emoji: '🫨',\r\n    type: 'blending', // Adds to existing motion\r\n    description: 'Random jitter movement for vibration effects',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 400,      // Animation duration\r\n        amplitude: 15,      // Shake movement range\r\n        frequency: 15,      // Oscillation speed\r\n        decay: 0.9,         // Intensity reduction over time\r\n        smoothing: 0.1,     // Motion smoothness factor\r\n        axes: 'both',       // Affected axes: 'both', 'horizontal', 'vertical'\r\n        easing: 'linear',   // Animation curve type\r\n        strength: 3.0,      // Overall shake intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'shake',\r\n            strength: 3.0,      // Particle shake strength\r\n            frequency: 15,      // Particle oscillation rate\r\n            decay: false        // Maintain consistent intensity\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - shake intensifies with tempo\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'subdivision',  // Shake on subdivisions\r\n        \r\n        // Shake intensity modulation\r\n        amplitudeSync: {\r\n            subdivision: 'sixteenth',  // Shake on 16th notes\r\n            onBeat: 2.5,              // Violent shake on beat\r\n            offBeat: 0.7,             // Gentler between beats\r\n            curve: 'pulse'            // Sharp attack\r\n        },\r\n        \r\n        // Frequency scales with tempo\r\n        frequencySync: {\r\n            mode: 'tempo',\r\n            baseFrequency: 15,        // Base at 120 BPM\r\n            scaling: 'linear'         // Linear scaling with BPM\r\n        },\r\n        \r\n        // Duration in musical time\r\n        durationSync: {\r\n            mode: 'beats',\r\n            beats: 2                  // Shake for 2 beats\r\n        },\r\n        \r\n        // Pattern-specific shake styles\r\n        patternOverrides: {\r\n            'breakbeat': {\r\n                // Chaotic broken shake\r\n                amplitudeSync: { onBeat: 3.0, offBeat: 0.2 },\r\n                frequencySync: { mode: 'random', range: [8, 20] }\r\n            },\r\n            'dubstep': {\r\n                // Bass wobble shake\r\n                amplitudeSync: {\r\n                    subdivision: 'eighth',\r\n                    onBeat: 4.0,\r\n                    dropBeat: 6.0,  // Massive shake on drop\r\n                    curve: 'pulse'\r\n                }\r\n            },\r\n            'swing': {\r\n                // Jazzy shimmy shake\r\n                amplitudeSync: { onBeat: 1.8, offBeat: 1.0, curve: 'ease' }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     */\r\n    initialize: function(particle, motion) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        particle.gestureData.shake = {\r\n            originalX: particle.x,  // Store original position\r\n            originalY: particle.y,  // Store original position\r\n            randomAngle: Math.random() * Math.PI * 2, // Random shake direction per particle\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply shake motion to particle\r\n     * Creates synchronized vibration effect matching orb shake\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.shake?.initialized) {\r\n            this.initialize(particle, motion);\r\n        }\r\n        \r\n        const data = particle.gestureData.shake;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = config.strength || this.config.strength || 1.0;\r\n        \r\n        // Apply rhythm modulation if present\r\n        let amplitude = config.amplitude;\r\n        let frequency = config.frequency;\r\n        if (motion.rhythmModulation) {\r\n            amplitude *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            amplitude *= (motion.rhythmModulation.accentMultiplier || 1);\r\n            if (motion.rhythmModulation.frequencyMultiplier) {\r\n                frequency *= motion.rhythmModulation.frequencyMultiplier;\r\n            }\r\n        }\r\n        \r\n        // Match orb shake logic for synchronized movement\r\n        // Apply decay if enabled to reduce intensity over time\r\n        const decay = config.decay ? (1 - progress) : 1;\r\n        const shake = Math.sin(progress * Math.PI * frequency) * amplitude * decay * strength * particle.scaleFactor;\r\n        \r\n        // Calculate directional offset using particle's random angle\r\n        const offsetX = shake * Math.cos(data.randomAngle);\r\n        const offsetY = shake * Math.sin(data.randomAngle);\r\n        \r\n        // Set particle position directly for perfect synchronization\r\n        // Particles shake in unison with the orb\r\n        particle.x = data.originalX + offsetX;\r\n        particle.y = data.originalY + offsetY;\r\n    },\r\n    \r\n    /**\r\n     * Generate pseudo-random number from seed\r\n     * @param {number} seed - Seed value\r\n     * @returns {number} Pseudo-random value between 0 and 1\r\n     */\r\n    pseudoRandom: function(seed) {\r\n        const x = Math.sin(seed) * 10000;\r\n        return x - Math.floor(x);\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.shake) {\r\n            // Restore original position\r\n            particle.x = particle.gestureData.shake.originalX;\r\n            particle.y = particle.gestureData.shake.originalY;\r\n            delete particle.gestureData.shake;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Nod Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Nod gesture - vertical agreement motion\r\n * @author Emotive Engine Team\r\n * @module gestures/motions/nod\r\n */\r\n\r\nexport default {\r\n    name: 'nod',\r\n    emoji: '🙂',\r\n    type: 'blending',\r\n    description: 'Vertical nodding motion',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 500,      // Animation duration\r\n        amplitude: 15,      // Vertical movement range\r\n        frequency: 2,       // Number of nod cycles\r\n        easing: 'sine',     // Animation curve type\r\n        strength: 0.4,      // Overall motion intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'bounce',\r\n            axis: 'vertical',   // Movement direction\r\n            strength: 0.4,      // Particle nod strength\r\n            frequency: 2,       // Particle nod count\r\n            phase: 0           // Synchronization with orb\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - nod as agreement to the beat\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',\r\n        timingSync: 'nextBeat',     // Wait for next beat to start\r\n        interruptible: false,        // Must complete the nod\r\n        priority: 5,                 // Medium priority\r\n        blendable: false,            // Don't blend with other motions\r\n        minDuration: 'halfBar',      // Minimum time before interrupt\r\n        \r\n        // Nod frequency locks to beat\r\n        frequencySync: {\r\n            mode: 'subdivision',\r\n            subdivision: 'half',  // Nod on half notes\r\n            multiplier: 1.0\r\n        },\r\n        \r\n        // Amplitude stronger on downbeats\r\n        amplitudeSync: {\r\n            onBeat: 1.4,\r\n            offBeat: 0.8,\r\n            curve: 'ease'\r\n        },\r\n        \r\n        // Duration in beats\r\n        durationSync: {\r\n            mode: 'beats',\r\n            beats: 2  // Nod for 2 beats\r\n        },\r\n        \r\n        // Pattern-specific nodding\r\n        patternOverrides: {\r\n            'waltz': {\r\n                // Graceful 3/4 nod\r\n                frequencySync: { subdivision: 'quarter' },\r\n                amplitudeSync: { onBeat: 1.6, curve: 'ease' }\r\n            },\r\n            'swing': {\r\n                // Jazzy syncopated nod\r\n                amplitudeSync: { onBeat: 1.5, offBeat: 0.9 }\r\n            },\r\n            'dubstep': {\r\n                // Heavy head-bang on drop\r\n                amplitudeSync: {\r\n                    onBeat: 1.2,\r\n                    dropBeat: 3.0,\r\n                    curve: 'pulse'\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle, motion) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        particle.gestureData.nod = {\r\n            startY: particle.y,\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.nod?.initialized) {\r\n            this.initialize(particle, motion);\r\n        }\r\n        \r\n        const config = { ...this.config, ...motion };\r\n        const strength = config.strength || this.config.strength || 1.0;\r\n        let frequency = config.frequency;\r\n        let amplitude = config.amplitude;\r\n        \r\n        // Apply rhythm modulation if present\r\n        if (motion.rhythmModulation) {\r\n            amplitude *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            amplitude *= (motion.rhythmModulation.accentMultiplier || 1);\r\n            if (motion.rhythmModulation.frequencyMultiplier) {\r\n                frequency *= motion.rhythmModulation.frequencyMultiplier;\r\n            }\r\n        }\r\n        \r\n        const oscillation = Math.sin(progress * Math.PI * 2 * frequency);\r\n        amplitude = amplitude * strength * particle.scaleFactor;\r\n        \r\n        // Apply vertical nodding motion\r\n        particle.vy += oscillation * amplitude * 0.01 * dt;\r\n        \r\n        // Dampen at the end\r\n        if (progress > 0.9) {\r\n            particle.vy *= 0.95;\r\n        }\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.nod) {\r\n            delete particle.gestureData.nod;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Vibrate Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Vibrate gesture - high frequency micro-shake\r\n * @author Emotive Engine Team\r\n * @module gestures/motions/vibrate\r\n */\r\n\r\nexport default {\r\n    name: 'vibrate',\r\n    emoji: '📳',\r\n    type: 'blending',\r\n    description: 'High frequency vibration',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 500,      // Animation duration\r\n        frequency: 20,      // Vibration frequency\r\n        amplitude: 8,       // Vibration amplitude\r\n        easing: 'linear',   // Animation curve type\r\n        strength: 2.0,      // Overall motion intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'shake',\r\n            strength: 2.0,\r\n            frequency: 20,\r\n            amplitude: 8\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - vibrate as tremolo effect\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'subdivision',\r\n        \r\n        // Vibration frequency syncs to tempo\r\n        frequencySync: {\r\n            subdivision: 'thirty-second',  // Very fast subdivisions\r\n            baseFrequency: 20,\r\n            tempoScaling: true  // Scale with BPM\r\n        },\r\n        \r\n        // Amplitude pulses with beat\r\n        amplitudeSync: {\r\n            onBeat: 1.5,\r\n            offBeat: 0.8,\r\n            curve: 'pulse'\r\n        },\r\n        \r\n        // Duration in musical time\r\n        durationSync: {\r\n            mode: 'beats',\r\n            beats: 1  // Vibrate for 1 beat\r\n        },\r\n        \r\n        // Pattern-specific vibration\r\n        patternOverrides: {\r\n            'dubstep': {\r\n                // Bass wobble vibration\r\n                frequencySync: { subdivision: 'sixteenth' },\r\n                amplitudeSync: { onBeat: 2.0, dropBeat: 3.0 }\r\n            },\r\n            'breakbeat': {\r\n                // Chaotic vibration\r\n                frequencySync: { mode: 'random', range: [15, 30] }\r\n            }\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle, motion) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        particle.gestureData.vibrate = {\r\n            timer: 0,\r\n            seed: Math.random() * 1000,\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.vibrate?.initialized) {\r\n            this.initialize(particle, motion);\r\n        }\r\n        \r\n        const data = particle.gestureData.vibrate;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = config.strength || this.config.strength || 1.0;\r\n        \r\n        // Apply rhythm modulation if present\r\n        let amplitude = config.amplitude;\r\n        let frequency = config.frequency;\r\n        if (motion.rhythmModulation) {\r\n            amplitude *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            amplitude *= (motion.rhythmModulation.accentMultiplier || 1);\r\n            if (motion.rhythmModulation.frequencyMultiplier) {\r\n                frequency *= motion.rhythmModulation.frequencyMultiplier;\r\n            }\r\n        }\r\n        \r\n        // Update timer\r\n        data.timer += dt * frequency;\r\n        \r\n        // High frequency vibration\r\n        const vibrateX = (Math.random() - 0.5) * amplitude * strength;\r\n        const vibrateY = (Math.random() - 0.5) * amplitude * strength;\r\n        \r\n        // Apply rapid vibration movements\r\n        particle.vx += vibrateX * 0.5 * dt;\r\n        particle.vy += vibrateY * 0.5 * dt;\r\n        \r\n        // Apply damping for control\r\n        particle.vx *= 0.9;\r\n        particle.vy *= 0.9;\r\n        \r\n        // Fade out at the end\r\n        if (progress > 0.8) {\r\n            const fadeFactor = 1 - ((progress - 0.8) * 5);\r\n            particle.vx *= fadeFactor;\r\n            particle.vy *= fadeFactor;\r\n        }\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.vibrate) {\r\n            delete particle.gestureData.vibrate;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Orbit Gesture Motion\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview 3D orbital motion where particles circle around the orb\r\n * @author Emotive Engine Team\r\n * @module gestures/motions/orbit\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a mesmerizing 3D orbit effect where particles circle around the orb,      \r\n * ║ dynamically transitioning between foreground and background layers using the      \r\n * ║ z-coordinate system. Like planets orbiting a star or a hula-hoop in motion.       \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM (Top View):\r\n *     · → · → ·\r\n *   ↓           ↑\r\n *   ·    ⭐    ·   ← particles orbit around center\r\n *   ↑           ↓  \r\n *     · ← · ← ·\r\n * \r\n * VISUAL DIAGRAM (Side View):\r\n *   front  ·····   back\r\n *         /     \\\r\n *        ·   ⭐  ·  ← z-coordinate changes as particles orbit\r\n *         \\     /\r\n *   back   ·····   front\r\n */\r\n\r\n/**\r\n * Apply orbital motion to a particle\r\n * Particles orbit around the center with dynamic z-depth changes\r\n * \r\n * @param {Object} particle - The particle to animate\r\n * @param {Object} gestureData - Persistent data for this particle's gesture\r\n * @param {Object} config - Gesture configuration\r\n * @param {number} progress - Gesture progress (0-1)\r\n * @param {number} strength - Gesture strength multiplier\r\n * @param {number} centerX - Orb center X\r\n * @param {number} centerY - Orb center Y\r\n */\r\nexport function applyOrbit(particle, gestureData, config, progress, strength, centerX, centerY) {\r\n    // Initialize gesture data if needed\r\n    if (!gestureData.initialized) {\r\n        // Store original position and velocity\r\n        gestureData.originalX = particle.x;\r\n        gestureData.originalY = particle.y;\r\n        gestureData.originalZ = particle.z || 0;\r\n        gestureData.originalVx = particle.vx || 0;\r\n        gestureData.originalVy = particle.vy || 0;\r\n        \r\n        // Calculate initial angle and radius from center\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        gestureData.radius = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        // Ensure minimum radius to prevent clustering at center\r\n        if (gestureData.radius < 50) {\r\n            gestureData.radius = 50 + Math.random() * 100;\r\n        }\r\n        \r\n        gestureData.initialAngle = Math.atan2(dy, dx);\r\n        \r\n        // Random orbit parameters for variety\r\n        gestureData.orbitSpeed = config.speed * (0.8 + Math.random() * 0.4); // Speed variation\r\n        gestureData.orbitTilt = Math.random() * 0.3; // Slight tilt for realism\r\n        \r\n        gestureData.initialized = true;\r\n    }\r\n    \r\n    // Apply rhythm modulation if present\r\n    let rotations = config.rotations;\r\n    let radiusPulseAmount = 0.05;\r\n    if (config.rhythmModulation) {\r\n        if (config.rhythmModulation.speedMultiplier) {\r\n            gestureData.orbitSpeed *= config.rhythmModulation.speedMultiplier;\r\n        }\r\n        if (config.rhythmModulation.rotationMultiplier) {\r\n            rotations *= config.rhythmModulation.rotationMultiplier;\r\n        }\r\n        if (config.rhythmModulation.radiusPulse) {\r\n            radiusPulseAmount = config.rhythmModulation.radiusPulse;\r\n        }\r\n    }\r\n    \r\n    // Smooth entry/exit transitions\r\n    let transitionFactor = 1.0;\r\n    let velocityTransition = 1.0;\r\n    \r\n    if (progress < 0.15) {\r\n        // Smooth entry (first 15%)\r\n        transitionFactor = progress / 0.15;\r\n        transitionFactor = transitionFactor * transitionFactor * (3 - 2 * transitionFactor); // Smooth step\r\n        velocityTransition = transitionFactor;\r\n    } else if (progress > 0.85) {\r\n        // Smooth exit (last 15%)\r\n        transitionFactor = (1 - progress) / 0.15;\r\n        transitionFactor = transitionFactor * transitionFactor * (3 - 2 * transitionFactor); // Smooth step\r\n        velocityTransition = transitionFactor;\r\n    }\r\n    \r\n    // Calculate current angle based on progress with smooth acceleration\r\n    const angle = gestureData.initialAngle + (progress * Math.PI * 2 * rotations * transitionFactor);\r\n    \r\n    // Calculate orbital radius (can pulse slightly) with transition\r\n    const radiusPulse = 1 + Math.sin(progress * Math.PI * 4) * radiusPulseAmount * transitionFactor;\r\n    const currentRadius = gestureData.radius * strength * radiusPulse * transitionFactor;\r\n    \r\n    // Calculate new position in orbit\r\n    const targetX = centerX + Math.cos(angle) * currentRadius;\r\n    const targetY = centerY + Math.sin(angle) * currentRadius;\r\n    \r\n    // CRITICAL: Update z-coordinate for 3D effect with smooth transition\r\n    // Particles in front (positive z) when at top of orbit, behind (negative z) at bottom\r\n    const zAngle = angle * config.zRotations; // Can rotate in z-plane at different rate\r\n    particle.z = Math.sin(zAngle) * 0.8 * transitionFactor + gestureData.originalZ * (1 - transitionFactor);\r\n    \r\n    // During entry, smoothly transition from original position\r\n    if (progress < 0.15) {\r\n        const entryLerp = transitionFactor * 0.3; // Slower entry\r\n        particle.x = gestureData.originalX + (targetX - gestureData.originalX) * entryLerp;\r\n        particle.y = gestureData.originalY + (targetY - gestureData.originalY) * entryLerp;\r\n        \r\n        // Smooth velocity transition\r\n        const orbitalVx = -Math.sin(angle) * currentRadius * gestureData.orbitSpeed;\r\n        const orbitalVy = Math.cos(angle) * currentRadius * gestureData.orbitSpeed;\r\n        particle.vx = gestureData.originalVx + (orbitalVx - gestureData.originalVx) * velocityTransition;\r\n        particle.vy = gestureData.originalVy + (orbitalVy - gestureData.originalVy) * velocityTransition;\r\n    } \r\n    // During exit, smoothly return to original\r\n    else if (progress > 0.85) {\r\n        particle.x = targetX + (gestureData.originalX - targetX) * (1 - transitionFactor);\r\n        particle.y = targetY + (gestureData.originalY - targetY) * (1 - transitionFactor);\r\n        \r\n        // Smooth velocity transition back\r\n        const orbitalVx = -Math.sin(angle) * currentRadius * gestureData.orbitSpeed;\r\n        const orbitalVy = Math.cos(angle) * currentRadius * gestureData.orbitSpeed;\r\n        particle.vx = orbitalVx * velocityTransition + gestureData.originalVx * (1 - velocityTransition);\r\n        particle.vy = orbitalVy * velocityTransition + gestureData.originalVy * (1 - velocityTransition);\r\n    }\r\n    // Normal orbit\r\n    else {\r\n        // Add vertical oscillation for hula-hoop effect if enabled\r\n        if (config.verticalOscillation > 0) {\r\n            const verticalOffset = Math.sin(angle * 2) * config.verticalOscillation * strength;\r\n            particle.y = targetY + verticalOffset;\r\n            particle.x = targetX;\r\n        } else {\r\n            // Smooth interpolation to target position\r\n            const lerpFactor = config.smoothness || 0.1;\r\n            particle.x += (targetX - particle.x) * lerpFactor;\r\n            particle.y += (targetY - particle.y) * lerpFactor;\r\n        }\r\n        \r\n        // Set orbital velocity\r\n        particle.vx = -Math.sin(angle) * currentRadius * gestureData.orbitSpeed;\r\n        particle.vy = Math.cos(angle) * currentRadius * gestureData.orbitSpeed;\r\n    }\r\n    \r\n    // Apply centripetal acContinceleration effect (particles speed up when closer)\r\n    if (config.centripetal) {\r\n        const speed = 1 + (1 - Math.abs(particle.z)) * 0.3; // Speed varies with z-position\r\n        const speedAngle = gestureData.initialAngle + (progress * Math.PI * 2 * config.rotations * speed);\r\n        particle.x = centerX + Math.cos(speedAngle) * currentRadius;\r\n        particle.y = centerY + Math.sin(speedAngle) * currentRadius;\r\n    }\r\n}\r\n\r\n// Export gesture configuration\r\nexport default {\r\n    name: 'orbit',\r\n    emoji: '🪐',\r\n    description: '3D orbital motion around center',\r\n    type: 'override', // Takes full control of particle position\r\n    \r\n    // Default configuration\r\n    config: {\r\n        speed: 1.0,              // Base orbital speed\r\n        rotations: 1,            // Number of full rotations per gesture\r\n        zRotations: 1,           // Z-plane rotation ratio (1 = same as xy, 2 = twice as fast)\r\n        smoothness: 0.15,        // Position interpolation factor\r\n        verticalOscillation: 0,  // Hula-hoop vertical movement (0 = flat orbit)\r\n        centripetal: false,      // Enable speed variation based on position\r\n    },\r\n    \r\n    // Rhythm configuration - orbital motion syncs to musical cycles\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'bar',  // Complete orbit per bar\r\n        \r\n        // Orbital speed syncs to tempo\r\n        speedSync: {\r\n            mode: 'tempo',\r\n            baseSpeed: 1.0,\r\n            scaling: 'linear'  // Speed scales with BPM\r\n        },\r\n        \r\n        // Rotations per musical period\r\n        rotationSync: {\r\n            mode: 'bars',\r\n            rotationsPerBar: 1,  // One full orbit per bar\r\n            zSync: true  // Z-rotation also syncs\r\n        },\r\n        \r\n        // Radius pulses with beat\r\n        radiusSync: {\r\n            subdivision: 'quarter',\r\n            pulsAmount: 0.1,  // 10% radius variation\r\n            curve: 'ease'\r\n        },\r\n        \r\n        // Pattern-specific orbital styles\r\n        patternOverrides: {\r\n            'waltz': {\r\n                // Elegant 3-step orbit\r\n                rotationSync: { rotationsPerBar: 0.75 },\r\n                radiusSync: { pulsAmount: 0.15 }\r\n            },\r\n            'swing': {\r\n                // Jazzy elliptical orbit\r\n                speedSync: { mode: 'swing', ratio: 0.67 },\r\n                verticalOscillation: 0.2\r\n            },\r\n            'dubstep': {\r\n                // Wobbling orbit with drops\r\n                radiusSync: { \r\n                    subdivision: 'eighth',\r\n                    pulsAmount: 0.3,\r\n                    dropMultiplier: 2.0\r\n                }\r\n            },\r\n            'breakbeat': {\r\n                // Chaotic orbital patterns\r\n                speedSync: { mode: 'random', range: [0.5, 2.0] },\r\n                centripetal: true\r\n            }\r\n        }\r\n    },\r\n    \r\n    // Apply function\r\n    apply: applyOrbit,\r\n    \r\n    // Supported emotions (great for mystical/energetic states)\r\n    emotions: ['zen', 'love', 'excited', 'surprise'],\r\n    \r\n    // Gesture-specific features\r\n    features: {\r\n        uses3D: true,           // Uses z-coordinate system\r\n        smooth: true,           // Smooth continuous motion\r\n        looping: true,          // Natural looping animation\r\n        dramatic: true          // Visually impressive effect\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Twitch Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Paranoid twitching motion for suspicious/nervous states\r\n * @author Emotive Engine Team\r\n * @module gestures/motions/twitch\r\n * \r\n * GESTURE TYPE:\r\n * type: 'blending' - Adds to existing particle motion\r\n * \r\n * VISUAL EFFECT:\r\n * Random, sudden jerky movements that blend with existing behavior.\r\n * Creates a nervous, paranoid feeling with unpredictable micro-movements.\r\n */\r\n\r\nexport default {\r\n    name: 'twitch',\r\n    emoji: '⚡',\r\n    type: 'blending',\r\n    description: 'Nervous, paranoid twitching',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        intensity: 8,           // Twitch strength\r\n        frequency: 0.08,        // Chance of twitching per frame\r\n        duration: 100,          // How long each twitch lasts (ms)\r\n        recovery: 200,          // Recovery time between twitches\r\n        maxOffset: 15,          // Maximum twitch distance\r\n        sharpness: 0.9         // How sudden the movements are\r\n    },\r\n    \r\n    // Rhythm configuration - twitch syncs to nervous subdivisions\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'subdivision',\r\n        \r\n        // Twitch probability increases on beat\r\n        probabilitySync: {\r\n            subdivision: 'sixteenth',\r\n            onBeat: 0.3,        // 30% chance on beat\r\n            offBeat: 0.05,      // 5% chance off beat\r\n            accentBoost: 2.0    // Double on accents\r\n        },\r\n        \r\n        // Intensity follows rhythm\r\n        intensitySync: {\r\n            onBeat: 2.0,\r\n            offBeat: 0.8,\r\n            curve: 'pulse'      // Sharp, sudden\r\n        },\r\n        \r\n        // Pattern-specific twitching\r\n        patternOverrides: {\r\n            'breakbeat': {\r\n                // Erratic broken twitches\r\n                probabilitySync: { onBeat: 0.5, offBeat: 0.1 },\r\n                intensitySync: { onBeat: 3.0, offBeat: 0.5 }\r\n            },\r\n            'dubstep': {\r\n                // Heavy twitch on drop\r\n                intensitySync: {\r\n                    onBeat: 1.5,\r\n                    dropBeat: 5.0,\r\n                    curve: 'pulse'\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize twitch data if needed\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        if (!particle.gestureData.twitch) {\r\n            particle.gestureData.twitch = {\r\n                twitchOffset: { x: 0, y: 0 },\r\n                targetOffset: { x: 0, y: 0 },\r\n                isTwitching: false,\r\n                twitchTimer: 0,\r\n                cooldownTimer: 0,\r\n                lastTwitch: 0\r\n            };\r\n        }\r\n        \r\n        const data = particle.gestureData.twitch;\r\n        const config = this.config;\r\n        let intensity = motion.intensity || config.intensity;\r\n        let frequency = config.frequency;\r\n        \r\n        // Apply rhythm modulation if present\r\n        if (motion.rhythmModulation) {\r\n            intensity *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            intensity *= (motion.rhythmModulation.accentMultiplier || 1);\r\n            if (motion.rhythmModulation.probabilityMultiplier) {\r\n                frequency *= motion.rhythmModulation.probabilityMultiplier;\r\n            }\r\n        }\r\n        \r\n        // Update timers\r\n        const currentTime = Date.now();\r\n        \r\n        // Check for new twitch\r\n        if (!data.isTwitching && data.cooldownTimer <= 0) {\r\n            if (Math.random() < (motion.frequency || config.frequency)) {\r\n                // Start a new twitch\r\n                data.isTwitching = true;\r\n                data.twitchTimer = config.duration;\r\n                data.cooldownTimer = config.recovery;\r\n                \r\n                // Random twitch direction and distance\r\n                const angle = Math.random() * Math.PI * 2;\r\n                const distance = (config.maxOffset * 0.5) + Math.random() * (config.maxOffset * 0.5);\r\n                \r\n                data.targetOffset = {\r\n                    x: Math.cos(angle) * distance * intensity / 8,\r\n                    y: Math.sin(angle) * distance * intensity / 8\r\n                };\r\n                \r\n                data.lastTwitch = currentTime;\r\n            }\r\n        }\r\n        \r\n        // Update cooldown\r\n        if (data.cooldownTimer > 0) {\r\n            data.cooldownTimer -= dt * 16;\r\n        }\r\n        \r\n        // Apply twitch motion\r\n        if (data.isTwitching) {\r\n            data.twitchTimer -= dt * 16;\r\n            \r\n            if (data.twitchTimer > 0) {\r\n                // Sharp movement toward target\r\n                const sharpness = config.sharpness;\r\n                data.twitchOffset.x += (data.targetOffset.x - data.twitchOffset.x) * sharpness;\r\n                data.twitchOffset.y += (data.targetOffset.y - data.twitchOffset.y) * sharpness;\r\n            } else {\r\n                // Twitch complete, start returning\r\n                data.isTwitching = false;\r\n            }\r\n        } else {\r\n            // Return to normal position\r\n            data.twitchOffset.x *= 0.85;\r\n            data.twitchOffset.y *= 0.85;\r\n        }\r\n        \r\n        // Apply the twitch offset to velocity (blending mode)\r\n        particle.vx += data.twitchOffset.x * dt * 0.5;\r\n        particle.vy += data.twitchOffset.y * dt * 0.5;\r\n        \r\n        // Add micro-jitter for constant nervousness\r\n        if (Math.random() < 0.1) {\r\n            particle.vx += (Math.random() - 0.5) * intensity * 0.3;\r\n            particle.vy += (Math.random() - 0.5) * intensity * 0.3;\r\n        }\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.twitch) {\r\n            delete particle.gestureData.twitch;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Sway Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'sway',\r\n    type: 'blending',\r\n    emoji: '🌊',\r\n    description: 'Gentle side-to-side swaying motion',\r\n    \r\n    config: {\r\n        duration: 2000,\r\n        amplitude: 20,\r\n        frequency: 1,\r\n        strength: 0.5\r\n    },\r\n    \r\n    // Rhythm configuration - sway naturally follows the beat\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'bar',  // Sway completes one cycle per bar\r\n        \r\n        // Amplitude increases on downbeats\r\n        amplitudeSync: {\r\n            onBeat: 1.2,\r\n            offBeat: 0.9,\r\n            curve: 'ease'  // Smooth transitions\r\n        },\r\n        \r\n        // Duration syncs to bars for natural rhythm\r\n        durationSync: {\r\n            mode: 'bars',\r\n            bars: 1  // One full sway per bar\r\n        },\r\n        \r\n        // Pattern-specific swaying\r\n        patternOverrides: {\r\n            'waltz': {\r\n                // 3/4 time creates elegant waltz sway\r\n                durationSync: { bars: 1 },\r\n                amplitudeSync: { onBeat: 1.5, curve: 'ease' }\r\n            },\r\n            'swing': {\r\n                // Jazzy swing sway\r\n                amplitudeSync: { onBeat: 1.3, offBeat: 0.7, curve: 'bounce' }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Apply sway motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        const config = { ...this.config, ...motion };\r\n        const amplitude = config.amplitude || this.config.amplitude;\r\n        const frequency = config.frequency || this.config.frequency;\r\n        const strength = config.strength || this.config.strength;\r\n        \r\n        // Smooth side-to-side motion\r\n        const sway = Math.sin(progress * Math.PI * 2 * frequency) * amplitude;\r\n        \r\n        // Apply horizontal sway\r\n        particle.vx += sway * 0.01 * dt * strength;\r\n        \r\n        // Slight vertical drift for natural feel\r\n        particle.vy += Math.cos(progress * Math.PI * 4) * 0.5 * dt * strength;\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        // No cleanup needed for sway\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Float Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'float',\r\n    type: 'blending',\r\n    emoji: '🎈',\r\n    description: 'Gentle floating upward motion',\r\n    \r\n    config: {\r\n        duration: 2000,\r\n        amplitude: 80,  // Increased for more visible effect\r\n        wobbleAmount: 20,  // More wobble\r\n        strength: 1.0  // Full strength\r\n    },\r\n    \r\n    // Rhythm configuration - defines how this gesture responds to musical timing\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',  // 'beat', 'bar', 'continuous', or 'none'\r\n        \r\n        // How amplitude changes with beat\r\n        amplitudeSync: {\r\n            onBeat: 1.5,      // Multiply amplitude on beat\r\n            offBeat: 0.8,     // Reduce amplitude off beat\r\n            curve: 'bounce'   // Animation curve: 'linear', 'ease', 'bounce', 'pulse'\r\n        },\r\n        \r\n        // How wobble syncs to subdivisions\r\n        wobbleSync: {\r\n            subdivision: 'eighth',  // Sync to 8th notes\r\n            intensity: 0.7          // How much rhythm affects wobble\r\n        },\r\n        \r\n        // Duration can sync to musical time\r\n        durationSync: {\r\n            mode: 'bars',     // Duration in bars instead of milliseconds\r\n            bars: 2           // Float for 2 bars\r\n        },\r\n        \r\n        // Response to musical accents\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 1.3   // Boost effect on accented beats\r\n        },\r\n        \r\n        // Optional: Different behavior for different patterns\r\n        patternOverrides: {\r\n            'waltz': {\r\n                wobbleSync: { subdivision: 'quarter', intensity: 0.9 }\r\n            },\r\n            'dubstep': {\r\n                amplitudeSync: { onBeat: 2.0, curve: 'pulse' }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Apply float motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Store original values on first frame\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        if (!particle.gestureData.float) {\r\n            particle.gestureData.float = {\r\n                originalSize: particle.size,\r\n                originalOpacity: particle.opacity || 1\r\n            };\r\n        }\r\n        \r\n        const config = { ...this.config, ...motion };\r\n        let amplitude = config.amplitude || this.config.amplitude;\r\n        let wobbleAmount = config.wobbleAmount || this.config.wobbleAmount;\r\n        const strength = config.strength || this.config.strength;\r\n        \r\n        // Apply rhythm modulation if present (passed from GestureMotion.js)\r\n        if (motion.rhythmModulation) {\r\n            amplitude *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            amplitude *= (motion.rhythmModulation.accentMultiplier || 1);\r\n            wobbleAmount *= (motion.rhythmModulation.wobbleMultiplier || 1);\r\n        }\r\n        \r\n        // Upward floating with slight wobble\r\n        const wobble = Math.sin(progress * Math.PI * 4) * wobbleAmount;\r\n        \r\n        // Apply upward force and wobble\r\n        particle.vy -= amplitude * 0.01 * dt * strength * (1 - progress * 0.5);\r\n        particle.vx += wobble * 0.01 * dt * strength;\r\n        \r\n        // Slight size variation for depth effect\r\n        particle.size = particle.baseSize * (1 + progress * 0.1);\r\n        \r\n        // Fade slightly as it floats up\r\n        particle.opacity = 1 - progress * 0.3;\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        // Reset to original values\r\n        if (particle.gestureData?.float) {\r\n            particle.opacity = particle.gestureData.float.originalOpacity;\r\n            particle.size = particle.gestureData.float.originalSize;\r\n            delete particle.gestureData.float;\r\n        } else {\r\n            // Fallback if no data stored\r\n            particle.opacity = 1;\r\n            particle.size = particle.baseSize;\r\n        }\r\n        \r\n        // Dampen velocity to help particle settle\r\n        particle.vx *= 0.5;\r\n        particle.vy *= 0.5;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Jitter Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'jitter',\r\n    type: 'blending',\r\n    emoji: '🫨',\r\n    description: 'Nervous jittery movement',\r\n    \r\n    config: {\r\n        duration: 1000,\r\n        intensity: 15,  // Increased for more visible jitter\r\n        frequency: 30,  // Higher frequency\r\n        strength: 1.0  // Full strength\r\n    },\r\n    \r\n    // Rhythm configuration - jitter intensifies on beat\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',\r\n        \r\n        // Jitter intensity syncs to beat\r\n        amplitudeSync: {\r\n            onBeat: 2.0,      // Double jitter on beat\r\n            offBeat: 0.5,     // Calmer between beats\r\n            curve: 'pulse'    // Sharp attack\r\n        },\r\n        \r\n        // Different patterns create different nervousness\r\n        patternOverrides: {\r\n            'breakbeat': {\r\n                // Chaotic jitter for breakbeat\r\n                amplitudeSync: { onBeat: 3.0, offBeat: 0.3 }\r\n            },\r\n            'dubstep': {\r\n                // Freeze then explode\r\n                amplitudeSync: { onBeat: 5.0, offBeat: 0.1, curve: 'pulse' }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Apply jitter motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Store original values on first frame\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        if (!particle.gestureData.jitter) {\r\n            particle.gestureData.jitter = {\r\n                originalSize: particle.size\r\n            };\r\n        }\r\n        \r\n        const config = { ...this.config, ...motion };\r\n        let intensity = config.intensity || this.config.intensity;\r\n        const strength = config.strength || this.config.strength;\r\n        \r\n        // Apply rhythm modulation if present\r\n        if (motion.rhythmModulation) {\r\n            intensity *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            intensity *= (motion.rhythmModulation.accentMultiplier || 1);\r\n        }\r\n        \r\n        // Random jitter in both directions\r\n        const jitterX = (Math.random() - 0.5) * intensity * strength;\r\n        const jitterY = (Math.random() - 0.5) * intensity * strength;\r\n        \r\n        // Apply jitter with decreasing intensity over time\r\n        const fadeOut = 1 - progress * 0.5;\r\n        particle.vx += jitterX * 0.1 * dt * fadeOut;\r\n        particle.vy += jitterY * 0.1 * dt * fadeOut;\r\n        \r\n        // Slight size variation for nervous effect\r\n        particle.size = particle.baseSize * (1 + (Math.random() - 0.5) * 0.1);\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        // Reset to original values\r\n        if (particle.gestureData?.jitter) {\r\n            particle.size = particle.gestureData.jitter.originalSize;\r\n            delete particle.gestureData.jitter;\r\n        } else {\r\n            particle.size = particle.baseSize;\r\n        }\r\n        \r\n        // Dampen velocity to help particle settle\r\n        particle.vx *= 0.7;\r\n        particle.vy *= 0.7;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Spin Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Spin gesture - orbital rotation around center\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/spin\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a spinning vortex effect with particles orbiting around the center.       \r\n * ║ This is an OVERRIDE gesture that completely replaces particle motion.             \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *        ↻ Clockwise rotation\r\n *      · → ·\r\n *     ↓     ↑\r\n *    · ← ⭐ → ·\r\n *     ↑     ↓  \r\n *      · ← ·\r\n * \r\n * USED BY:\r\n * - Dizzy/confused states\r\n * - Celebration spins\r\n * - Whirlwind effects\r\n * - Portal/vortex animations\r\n */\r\n\r\n/**\r\n * Spin gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'spin',\r\n    emoji: '🌀',\r\n    type: 'override', // Completely replaces motion\r\n    description: 'Orbital rotation around center point',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 600,          // Legacy fallback\r\n        musicalDuration: { musical: true, beats: 1 }, // 1 beat (quarter note)\r\n        rotations: 1,           // Number of full rotations\r\n        direction: 'random',    // 'clockwise', 'counter-clockwise', or 'random'\r\n        radiusMultiplier: 1.0,  // Orbital radius multiplier\r\n        spiralOut: false,       // Spiral outward while spinning\r\n        accelerate: true,       // Speed up then slow down\r\n        maintainDistance: true, // Keep relative distance from center\r\n        scaleAmount: 0.1,       // Scale change during spin\r\n        easing: 'linear',       // Animation curve type\r\n        strength: 0.7,          // Particle motion strength\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'spin',\r\n            strength: 0.7,\r\n            rotations: 1,\r\n            radius: 1.0\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - spin as a dance move\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'bar',\r\n        \r\n        // Rotations sync to musical time\r\n        rotationSync: {\r\n            mode: 'bars',\r\n            rotationsPerBar: 1,  // One spin per bar\r\n            accelerateOnBeat: true  // Speed up on downbeats\r\n        },\r\n        \r\n        // Radius changes with beat\r\n        radiusSync: {\r\n            subdivision: 'quarter',\r\n            expandOnBeat: 1.2,\r\n            contractOffBeat: 0.9,\r\n            curve: 'bounce'\r\n        },\r\n        \r\n        // Duration in musical time\r\n        durationSync: {\r\n            mode: 'beats',\r\n            beats: 4  // Spin for 4 beats (1 bar)\r\n        },\r\n        \r\n        // Pattern-specific spins\r\n        patternOverrides: {\r\n            'waltz': {\r\n                // Elegant waltz spin\r\n                rotationSync: { rotationsPerBar: 0.75 },\r\n                radiusSync: { curve: 'ease' }\r\n            },\r\n            'swing': {\r\n                // Jazzy swing spin\r\n                rotationSync: { accelerateOnBeat: false },\r\n                direction: 'alternating'  // Change direction each bar\r\n            },\r\n            'dubstep': {\r\n                // Aggressive spin with wobble\r\n                radiusSync: {\r\n                    subdivision: 'eighth',\r\n                    expandOnBeat: 1.5,\r\n                    dropMultiplier: 2.0\r\n                },\r\n                spiralOut: true\r\n            },\r\n            'breakbeat': {\r\n                // Chaotic spin patterns\r\n                rotationSync: { mode: 'random', range: [0.5, 2] },\r\n                direction: 'random'\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        // Calculate starting position relative to center\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        \r\n        // Determine spin direction\r\n        let direction = motion.direction || this.config.direction;\r\n        if (direction === 'random') {\r\n            direction = Math.random() < 0.5 ? 'clockwise' : 'counter-clockwise';\r\n        }\r\n        \r\n        particle.gestureData.spin = {\r\n            startAngle: Math.atan2(dy, dx),\r\n            startRadius: Math.sqrt(dx * dx + dy * dy) || 30, // Min radius if at center\r\n            originalX: particle.x,\r\n            originalY: particle.y,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            direction: direction, // Store chosen direction\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply spin motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.spin?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.spin;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = motion.strength || 1.0;\r\n        \r\n        // Apply rhythm modulation if present\r\n        let rotations = config.rotations;\r\n        let radiusMultiplier = config.radiusMultiplier;\r\n        if (motion.rhythmModulation) {\r\n            if (motion.rhythmModulation.rotationMultiplier) {\r\n                rotations *= motion.rhythmModulation.rotationMultiplier;\r\n            }\r\n            if (motion.rhythmModulation.radiusMultiplier) {\r\n                radiusMultiplier *= motion.rhythmModulation.radiusMultiplier;\r\n            }\r\n        }\r\n        \r\n        // Apply acceleration curve if enabled\r\n        let speedProgress = progress;\r\n        if (config.accelerate) {\r\n            // Speed up for first half, slow down for second half\r\n            if (progress < 0.5) {\r\n                speedProgress = this.easeInQuad(progress * 2) * 0.5;\r\n            } else {\r\n                speedProgress = 0.5 + this.easeOutQuad((progress - 0.5) * 2) * 0.5;\r\n            }\r\n        }\r\n        \r\n        // Calculate rotation angle using stored direction\r\n        const rotationAmount = rotations * Math.PI * 2 * strength;\r\n        const direction = data.direction === 'counter-clockwise' ? -1 : 1;\r\n        const currentAngle = data.startAngle + (rotationAmount * speedProgress * direction);\r\n        \r\n        // Calculate radius (with optional spiral)\r\n        let currentRadius = data.startRadius;\r\n        if (config.spiralOut) {\r\n            currentRadius *= (1 + progress * 0.5); // Expand outward during spin\r\n        }\r\n        if (radiusMultiplier !== 1) {\r\n            // Apply radius multiplier with smooth curve\r\n            const radiusCurve = Math.sin(progress * Math.PI); // Peak at middle\r\n            currentRadius *= (1 + (radiusMultiplier - 1) * radiusCurve);\r\n        }\r\n        \r\n        // Calculate target position\r\n        const targetX = centerX + Math.cos(currentAngle) * currentRadius;\r\n        const targetY = centerY + Math.sin(currentAngle) * currentRadius;\r\n        \r\n        // For override gesture, directly set position with smooth interpolation\r\n        const moveSpeed = 0.25; // Adjust for smoothness\r\n        particle.x += (targetX - particle.x) * moveSpeed;\r\n        particle.y += (targetY - particle.y) * moveSpeed;\r\n        \r\n        // Set velocity to match movement (for trail effects)\r\n        particle.vx = (targetX - particle.x) * 0.5;\r\n        particle.vy = (targetY - particle.y) * 0.5;\r\n        \r\n        // Smooth ending - return to original velocities\r\n        if (progress > 0.9) {\r\n            const endFactor = (1 - progress) * 10;\r\n            particle.vx = particle.vx * endFactor + data.originalVx * (1 - endFactor);\r\n            particle.vy = particle.vy * endFactor + data.originalVy * (1 - endFactor);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.spin) {\r\n            // Restore original velocities\r\n            const data = particle.gestureData.spin;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            delete particle.gestureData.spin;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Easing function for acceleration\r\n     * @param {number} t - Progress (0-1)\r\n     * @returns {number} Eased value\r\n     */\r\n    easeInQuad: function(t) {\r\n        return t * t;\r\n    },\r\n    \r\n    /**\r\n     * Easing function for deceleration\r\n     * @param {number} t - Progress (0-1)\r\n     * @returns {number} Eased value\r\n     */\r\n    easeOutQuad: function(t) {\r\n        return t * (2 - t);\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Jump Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Jump gesture - squash, leap, and land animation\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/jump\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a classic jump animation with squash & stretch principles. Particles       \r\n * ║ compress before jumping, stretch during flight, and squash on landing.            \r\n * ║ This is an OVERRIDE gesture that completely controls particle motion.             \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *    Phase 1: Squash    Phase 2: Jump      Phase 3: Land\r\n *         ⭐              ↗ ⭐ ↘              ⭐\r\n *         ___            /     \\             ___\r\n *     (compressed)     (stretched)       (squashed)\r\n * \r\n * USED BY:\r\n * - Joy/excitement expressions\r\n * - Surprise reactions\r\n * - Celebration animations\r\n * - Playful interactions\r\n */\r\n\r\n/**\r\n * Jump gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'jump',\r\n    emoji: '🦘',\r\n    type: 'override', // Completely replaces motion\r\n    description: 'Squash, leap, and land with classic animation principles',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 800,         // Animation duration\r\n        jumpHeight: 60,        // Maximum vertical leap distance\r\n        squashAmount: 0.8,     // Compression ratio during squash\r\n        stretchAmount: 1.2,    // Extension ratio during stretch\r\n        anticipation: 0.2,     // Pre-jump preparation duration ratio\r\n        hangTime: 0.1,         // Pause duration at jump peak\r\n        landingImpact: true,   // Enable landing squash effect\r\n        driftOutward: true,    // Particles spread during jump\r\n        easing: 'quad',        // Animation curve type\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'jump',\r\n            strength: 0.9,         // Jump motion intensity\r\n            jumpHeight: 60,        // Particle jump height\r\n            squash: 0.8,          // Particle compression amount\r\n            stretch: 1.2          // Particle extension amount\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - jump lands on beat\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',  // Jump timing syncs to beat\r\n        \r\n        // Jump phases sync to rhythm\r\n        phaseSync: {\r\n            anticipation: 'eighth',    // Squash on 8th note before beat\r\n            jump: 'beat',              // Launch on the beat\r\n            landing: 'sixteenth'       // Land on 16th after beat\r\n        },\r\n        \r\n        // Jump height modulation\r\n        heightSync: {\r\n            onBeat: 1.5,              // Higher jumps on strong beats\r\n            offBeat: 0.8,             // Lower jumps on weak beats\r\n            accent: 2.0,              // Extra high on accented beats\r\n            curve: 'exponential'      // Sharp takeoff\r\n        },\r\n        \r\n        // Squash and stretch intensity\r\n        deformationSync: {\r\n            squashOnBeat: 0.6,        // More squash on beat\r\n            stretchOnBeat: 1.4,       // More stretch on beat\r\n            timing: 'anticipatory'    // Deform before beat hits\r\n        },\r\n        \r\n        // Hang time varies with tempo\r\n        hangTimeSync: {\r\n            mode: 'tempo',\r\n            baseDuration: 0.1,        // Base hang at 120 BPM\r\n            scaling: 'inverse'        // Slower tempo = longer hang\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: { jumpHeight: 80, stretch: 1.3 },   // Big jumps on loud\r\n            piano: { jumpHeight: 30, stretch: 1.1 }    // Small hops on soft\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        particle.gestureData.jump = {\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            startSize: particle.size,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            driftDirection: (particle.x - centerX) * 0.1, // Drift away from center\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply jump motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.jump?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.jump;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = motion.strength || 1.0;\r\n        \r\n        const jumpHeight = config.jumpHeight * strength * particle.scaleFactor;\r\n        const squash = config.squashAmount;\r\n        const stretch = config.stretchAmount;\r\n        \r\n        // Define phase breakpoints\r\n        const anticipationEnd = config.anticipation;\r\n        const jumpEnd = 1 - config.anticipation * 0.5; // Leave time for landing\r\n        \r\n        if (progress < anticipationEnd) {\r\n            // PHASE 1: Anticipation (squash down)\r\n            const squashProgress = progress / anticipationEnd;\r\n            const easedSquash = this.easeOutQuad(squashProgress);\r\n            \r\n            // Squash size\r\n            particle.size = data.startSize * (1 - (1 - squash) * easedSquash);\r\n            \r\n            // Slightly lower position (crouch)\r\n            particle.y = data.startY + easedSquash * 5 * particle.scaleFactor;\r\n            \r\n            // Stop horizontal movement during anticipation\r\n            particle.vx = 0;\r\n            particle.vy = 0;\r\n            \r\n        } else if (progress < jumpEnd) {\r\n            // PHASE 2: Jump (arc motion with stretch)\r\n            const jumpProgress = (progress - anticipationEnd) / (jumpEnd - anticipationEnd);\r\n            \r\n            // Use sine curve for smooth arc\r\n            let jumpCurve = Math.sin(jumpProgress * Math.PI);\r\n            \r\n            // Add hang time at peak\r\n            if (config.hangTime > 0 && jumpProgress > 0.4 && jumpProgress < 0.6) {\r\n                const hangProgress = (jumpProgress - 0.4) / 0.2;\r\n                const hangCurve = this.easeInOutCubic(hangProgress);\r\n                jumpCurve = 0.95 + hangCurve * 0.05; // Flatten at peak\r\n            }\r\n            \r\n            // Vertical position\r\n            particle.y = data.startY - jumpCurve * jumpHeight;\r\n            \r\n            // Horizontal drift if enabled\r\n            if (config.driftOutward) {\r\n                particle.x = data.startX + jumpCurve * data.driftDirection;\r\n            }\r\n            \r\n            // Stretch/squash based on velocity\r\n            if (jumpProgress < 0.5) {\r\n                // Going up - stretch\r\n                const stretchProgress = jumpProgress * 2;\r\n                particle.size = data.startSize * (squash + (stretch - squash) * stretchProgress);\r\n            } else {\r\n                // Coming down - return to normal then squash slightly\r\n                const fallProgress = (jumpProgress - 0.5) * 2;\r\n                particle.size = data.startSize * (stretch - (stretch - 1) * fallProgress * 0.8);\r\n            }\r\n            \r\n            // Set velocity for motion blur/trails\r\n            particle.vx = data.driftDirection * 0.5;\r\n            particle.vy = -Math.cos(jumpProgress * Math.PI) * jumpHeight * 0.1;\r\n            \r\n        } else {\r\n            // PHASE 3: Landing (impact squash)\r\n            const landProgress = (progress - jumpEnd) / (1 - jumpEnd);\r\n            const easedLand = this.easeOutBounce(landProgress);\r\n            \r\n            // Return to ground with bounce\r\n            particle.y = data.startY;\r\n            \r\n            if (config.landingImpact) {\r\n                // Landing squash effect\r\n                if (landProgress < 0.3) {\r\n                    const impactProgress = landProgress / 0.3;\r\n                    particle.size = data.startSize * (1 - (1 - squash * 0.8) * (1 - impactProgress));\r\n                } else {\r\n                    // Recover from squash\r\n                    const recoverProgress = (landProgress - 0.3) / 0.7;\r\n                    particle.size = data.startSize * (squash * 0.8 + (1 - squash * 0.8) * recoverProgress);\r\n                }\r\n            } else {\r\n                // Simple size recovery\r\n                particle.size = data.startSize * (squash + (1 - squash) * easedLand);\r\n            }\r\n            \r\n            // Gradually stop motion\r\n            particle.vx = data.originalVx * easedLand;\r\n            particle.vy = data.originalVy * easedLand;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.jump) {\r\n            const data = particle.gestureData.jump;\r\n            // Restore original properties\r\n            particle.size = data.startSize;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            delete particle.gestureData.jump;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Easing functions\r\n     */\r\n    easeOutQuad: function(t) {\r\n        return t * (2 - t);\r\n    },\r\n    \r\n    easeInOutCubic: function(t) {\r\n        return t < 0.5 \r\n            ? 4 * t * t * t \r\n            : 1 - Math.pow(-2 * t + 2, 3) / 2;\r\n    },\r\n    \r\n    easeOutBounce: function(t) {\r\n        const n1 = 7.5625;\r\n        const d1 = 2.75;\r\n        \r\n        if (t < 1 / d1) {\r\n            return n1 * t * t;\r\n        } else if (t < 2 / d1) {\r\n            return n1 * (t -= 1.5 / d1) * t + 0.75;\r\n        } else if (t < 2.5 / d1) {\r\n            return n1 * (t -= 2.25 / d1) * t + 0.9375;\r\n        } else {\r\n            return n1 * (t -= 2.625 / d1) * t + 0.984375;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Morph Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Morph gesture - form geometric patterns\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/morph\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Transforms the particle cloud into geometric shapes like circles, stars,          \r\n * ║ hearts, or other patterns. This is an OVERRIDE gesture that moves particles       \r\n * ║ to specific positions to form recognizable shapes.                                \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *    Random Cloud      →      Star Pattern      →      Heart Pattern\r\n *      · · ·                    ★                         ♥♥\r\n *     · · · ·          →      ·   ·           →         ♥   ♥\r\n *      · · ·                ·   ★   ·                  ♥     ♥\r\n *                             ·   ·                      ♥   ♥\r\n *                               ★                          ♥\r\n * \r\n * USED BY:\r\n * - Love emotions (heart shape)\r\n * - Magic/special effects (star patterns)\r\n * - Achievement celebrations (trophy/medal shapes)\r\n * - Transitions between states\r\n */\r\n\r\n/**\r\n * Morph gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'morph',\r\n    emoji: '✨',\r\n    type: 'override', // Completely replaces motion\r\n    description: 'Form geometric patterns and shapes',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        // Musical duration - morph over 2 beats\r\n        musicalDuration: {\r\n            musical: true,\r\n            beats: 2,          // Default to half a bar\r\n            minBeats: 1,       // Minimum quarter note\r\n            maxBeats: 8        // Maximum 2 bars\r\n        },\r\n        \r\n        // Musical phases of the morph\r\n        phases: [\r\n            { name: 'gather', beats: 0.25 },    // Particles gather\r\n            { name: 'form', beats: 0.75 },      // Form the shape\r\n            { name: 'hold', beats: 0.5 },       // Hold the shape\r\n            { name: 'dissolve', beats: 0.5 }    // Dissolve back\r\n        ],\r\n        \r\n        morphType: 'fluid',     // Type of morph animation\r\n        pattern: 'star',        // Shape to morph into\r\n        points: 5,              // Number of points (for star/polygon)\r\n        innerRadius: 0.4,       // Inner radius ratio (for star)\r\n        size: 80,               // Base size of the pattern\r\n        amplitude: 20,          // Motion amplitude\r\n        rotation: 0,            // Rotation angle in degrees\r\n        smooth: true,           // Smooth movement to positions\r\n        randomizeOrder: false,  // Randomize which particles go where\r\n        easing: 'sine',         // Animation curve type\r\n        strength: 1.2,          // Formation strength\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'morph',\r\n            pattern: 'star',\r\n            strength: 1.2,\r\n            smooth: true,\r\n            points: 5\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - morphs on musical phrases\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'phrase',  // Morph on musical phrases\r\n        \r\n        // Pattern changes with musical structure\r\n        patternSync: {\r\n            verse: 'circle',          // Simple shape for verse\r\n            chorus: 'star',           // Complex shape for chorus\r\n            bridge: 'heart',          // Special shape for bridge\r\n            drop: 'explosion'         // Dramatic for drops\r\n        },\r\n        \r\n        // Morph timing syncs to measures\r\n        timingSync: {\r\n            formationBeat: 1,         // Start forming on beat 1\r\n            holdBeats: 2,             // Hold shape for 2 beats\r\n            dissolveBeat: 4,          // Dissolve on beat 4\r\n            curve: 'anticipatory'     // Ease into formation\r\n        },\r\n        \r\n        // Size pulses with rhythm\r\n        sizeSync: {\r\n            onBeat: 1.2,              // Expand on beat\r\n            offBeat: 0.95,            // Contract off beat\r\n            subdivision: 'quarter',    // Pulse every quarter note\r\n            curve: 'elastic'          // Bouncy expansion\r\n        },\r\n        \r\n        // Rotation syncs to bars\r\n        rotationSync: {\r\n            mode: 'continuous',       // Continuous rotation\r\n            degreesPerBar: 90,        // Rotate 90° per bar\r\n            direction: 'clockwise'    // Rotation direction\r\n        },\r\n        \r\n        // Musical dynamics affect complexity\r\n        dynamics: {\r\n            forte: { points: 8, size: 100 },    // Complex shapes when loud\r\n            piano: { points: 3, size: 60 }      // Simple shapes when soft\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     * @param {EmotiveMascot} mascot - The mascot instance for core morphing\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY, mascot) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        const config = { ...this.config, ...motion };\r\n        \r\n        // Store original position\r\n        const startX = particle.x;\r\n        const startY = particle.y;\r\n        \r\n        // Calculate angle from center for position assignment\r\n        const angle = Math.atan2(particle.y - centerY, particle.x - centerX);\r\n        \r\n        // Random rotation direction for the pattern\r\n        const rotationDirection = Math.random() < 0.5 ? 1 : -1;\r\n        \r\n        // Calculate target position based on pattern\r\n        let targetX, targetY;\r\n        const size = config.size * particle.scaleFactor;\r\n        const rotation = ((config.rotation || 0) * Math.PI / 180) * rotationDirection;\r\n        \r\n        switch (config.pattern) {\r\n            case 'star':\r\n                targetX = centerX;\r\n                targetY = centerY;\r\n                this.calculateStarPosition(particle, angle, size, config.points, config.innerRadius, rotation, centerX, centerY);\r\n                break;\r\n                \r\n            case 'heart':\r\n                this.calculateHeartPosition(particle, angle, size, rotation, centerX, centerY);\r\n                break;\r\n                \r\n            case 'square':\r\n                this.calculateSquarePosition(particle, angle, size, rotation, centerX, centerY);\r\n                break;\r\n                \r\n            case 'triangle':\r\n                this.calculateTrianglePosition(particle, angle, size, rotation, centerX, centerY);\r\n                break;\r\n                \r\n            case 'circle':\r\n            default:\r\n                // Simple circle pattern\r\n                const targetRadius = size;\r\n                targetX = centerX + Math.cos(angle + rotation) * targetRadius;\r\n                targetY = centerY + Math.sin(angle + rotation) * targetRadius;\r\n                break;\r\n        }\r\n        \r\n        particle.gestureData.morph = {\r\n            startX: startX,\r\n            startY: startY,\r\n            targetX: particle.gestureData.morphTargetX || targetX,\r\n            targetY: particle.gestureData.morphTargetY || targetY,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            rotationDirection: rotationDirection, // Store random rotation direction\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Calculate star pattern position\r\n     */\r\n    calculateStarPosition: function(particle, angle, size, points, innerRadius, rotation, centerX, centerY) {\r\n        const armAngle = (Math.PI * 2) / points;\r\n        const nearestArm = Math.round(angle / armAngle) * armAngle;\r\n        const armIndex = Math.round(angle / armAngle) % points;\r\n        const isOuter = Math.random() > 0.5; // Distribute between inner and outer points\r\n        \r\n        let radius;\r\n        let targetAngle;\r\n        \r\n        if (isOuter) {\r\n            // Outer point of star\r\n            radius = size;\r\n            targetAngle = armIndex * armAngle + rotation;\r\n        } else {\r\n            // Inner point of star (between arms)\r\n            radius = size * innerRadius;\r\n            targetAngle = armIndex * armAngle + armAngle * 0.5 + rotation;\r\n        }\r\n        \r\n        particle.gestureData.morphTargetX = centerX + Math.cos(targetAngle) * radius;\r\n        particle.gestureData.morphTargetY = centerY + Math.sin(targetAngle) * radius;\r\n    },\r\n    \r\n    /**\r\n     * Calculate heart pattern position\r\n     */\r\n    calculateHeartPosition: function(particle, angle, size, rotation, centerX, centerY) {\r\n        // Map angle to heart curve parameter\r\n        const t = (angle + Math.PI) / (Math.PI * 2);\r\n        \r\n        // Heart parametric equations\r\n        const scale = size * 0.05;\r\n        let x = 16 * Math.pow(Math.sin(t * Math.PI * 2), 3);\r\n        let y = -(13 * Math.cos(t * Math.PI * 2) - 5 * Math.cos(2 * t * Math.PI * 2) - \r\n                  2 * Math.cos(3 * t * Math.PI * 2) - Math.cos(4 * t * Math.PI * 2));\r\n        \r\n        // Scale and rotate\r\n        const cosR = Math.cos(rotation);\r\n        const sinR = Math.sin(rotation);\r\n        const rotX = x * cosR - y * sinR;\r\n        const rotY = x * sinR + y * cosR;\r\n        \r\n        particle.gestureData.morphTargetX = centerX + rotX * scale;\r\n        particle.gestureData.morphTargetY = centerY + rotY * scale;\r\n    },\r\n    \r\n    /**\r\n     * Calculate square pattern position\r\n     */\r\n    calculateSquarePosition: function(particle, angle, size, rotation, centerX, centerY) {\r\n        // Determine which edge the particle should go to\r\n        const rotatedAngle = angle + rotation;\r\n        const normalizedAngle = ((rotatedAngle % (Math.PI * 2)) + Math.PI * 2) % (Math.PI * 2);\r\n        \r\n        let x, y;\r\n        const halfSize = size;\r\n        \r\n        // Map to square edges\r\n        if (normalizedAngle < Math.PI / 4 || normalizedAngle >= 7 * Math.PI / 4) {\r\n            // Right edge\r\n            x = halfSize;\r\n            y = halfSize * Math.tan(normalizedAngle);\r\n        } else if (normalizedAngle < 3 * Math.PI / 4) {\r\n            // Top edge\r\n            x = halfSize / Math.tan(normalizedAngle);\r\n            y = halfSize;\r\n        } else if (normalizedAngle < 5 * Math.PI / 4) {\r\n            // Left edge\r\n            x = -halfSize;\r\n            y = -halfSize * Math.tan(normalizedAngle);\r\n        } else {\r\n            // Bottom edge\r\n            x = -halfSize / Math.tan(normalizedAngle);\r\n            y = -halfSize;\r\n        }\r\n        \r\n        // Apply rotation\r\n        const cosR = Math.cos(rotation);\r\n        const sinR = Math.sin(rotation);\r\n        const rotX = x * cosR - y * sinR;\r\n        const rotY = x * sinR + y * cosR;\r\n        \r\n        particle.gestureData.morphTargetX = centerX + rotX;\r\n        particle.gestureData.morphTargetY = centerY + rotY;\r\n    },\r\n    \r\n    /**\r\n     * Calculate triangle pattern position\r\n     */\r\n    calculateTrianglePosition: function(particle, angle, size, rotation, centerX, centerY) {\r\n        // Three vertices of equilateral triangle\r\n        const vertices = [\r\n            { x: 0, y: -size },                    // Top\r\n            { x: -size * 0.866, y: size * 0.5 },   // Bottom left\r\n            { x: size * 0.866, y: size * 0.5 }     // Bottom right\r\n        ];\r\n        \r\n        // Determine which edge the particle should go to\r\n        const edgeIndex = Math.floor(((angle + Math.PI) / (Math.PI * 2)) * 3) % 3;\r\n        const nextIndex = (edgeIndex + 1) % 3;\r\n        \r\n        // Position along the edge\r\n        const edgeProgress = Math.random();\r\n        const x = vertices[edgeIndex].x + (vertices[nextIndex].x - vertices[edgeIndex].x) * edgeProgress;\r\n        const y = vertices[edgeIndex].y + (vertices[nextIndex].y - vertices[edgeIndex].y) * edgeProgress;\r\n        \r\n        // Apply rotation\r\n        const cosR = Math.cos(rotation);\r\n        const sinR = Math.sin(rotation);\r\n        const rotX = x * cosR - y * sinR;\r\n        const rotY = x * sinR + y * cosR;\r\n        \r\n        particle.gestureData.morphTargetX = centerX + rotX;\r\n        particle.gestureData.morphTargetY = centerY + rotY;\r\n    },\r\n    \r\n    /**\r\n     * Apply morph motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.morph?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.morph;\r\n        const config = { ...this.config, ...motion };\r\n        \r\n        // Calculate eased progress\r\n        let morphProgress = progress;\r\n        \r\n        // Add hold time at the shape\r\n        if (config.holdTime > 0) {\r\n            const holdStart = 0.5 - config.holdTime / 2;\r\n            const holdEnd = 0.5 + config.holdTime / 2;\r\n            \r\n            if (progress < holdStart) {\r\n                morphProgress = progress / holdStart * 0.5;\r\n            } else if (progress < holdEnd) {\r\n                morphProgress = 0.5; // Hold at shape\r\n            } else {\r\n                morphProgress = 0.5 + (progress - holdEnd) / (1 - holdEnd) * 0.5;\r\n            }\r\n        }\r\n        \r\n        const easeProgress = this.easeInOutCubic(morphProgress);\r\n        \r\n        // Calculate interpolated position\r\n        let targetX, targetY;\r\n        \r\n        if (morphProgress <= 0.5) {\r\n            // Moving to shape\r\n            const moveProgress = morphProgress * 2;\r\n            targetX = data.startX + (data.targetX - data.startX) * this.easeOutQuad(moveProgress);\r\n            targetY = data.startY + (data.targetY - data.startY) * this.easeOutQuad(moveProgress);\r\n        } else {\r\n            // Returning from shape\r\n            const returnProgress = (morphProgress - 0.5) * 2;\r\n            targetX = data.targetX + (data.startX - data.targetX) * this.easeInQuad(returnProgress);\r\n            targetY = data.targetY + (data.startY - data.targetY) * this.easeInQuad(returnProgress);\r\n        }\r\n        \r\n        // Apply position\r\n        if (config.smooth) {\r\n            // Smooth movement\r\n            const moveSpeed = 0.2;\r\n            particle.x += (targetX - particle.x) * moveSpeed;\r\n            particle.y += (targetY - particle.y) * moveSpeed;\r\n        } else {\r\n            // Direct positioning\r\n            particle.x = targetX;\r\n            particle.y = targetY;\r\n        }\r\n        \r\n        // Set velocity for trails\r\n        particle.vx = (targetX - particle.x) * 0.5;\r\n        particle.vy = (targetY - particle.y) * 0.5;\r\n        \r\n        // Restore original velocities at the end\r\n        if (progress > 0.9) {\r\n            const blendFactor = (1 - progress) * 10;\r\n            particle.vx = particle.vx * blendFactor + data.originalVx * (1 - blendFactor);\r\n            particle.vy = particle.vy * blendFactor + data.originalVy * (1 - blendFactor);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.morph) {\r\n            const data = particle.gestureData.morph;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            delete particle.gestureData.morph;\r\n            delete particle.gestureData.morphTargetX;\r\n            delete particle.gestureData.morphTargetY;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Easing functions\r\n     */\r\n    easeInOutCubic: function(t) {\r\n        return t < 0.5 \r\n            ? 4 * t * t * t \r\n            : 1 - Math.pow(-2 * t + 2, 3) / 2;\r\n    },\r\n    \r\n    easeOutQuad: function(t) {\r\n        return t * (2 - t);\r\n    },\r\n    \r\n    easeInQuad: function(t) {\r\n        return t * t;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Stretch Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Stretch gesture - scale particles along axes\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/stretch\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Stretches or squashes the particle cloud along X and Y axes independently.        \r\n * ║ This is an OVERRIDE gesture that directly controls particle positions to          \r\n * ║ create elastic deformation effects.                                               \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *    Normal          Stretch X         Stretch Y        Squash\r\n *      ⭐             ← ⭐ →             ↑               ___\r\n *     ·⭐·           · · ⭐ · ·          ⭐              ·⭐·\r\n *      ⭐                                ·               ‾‾‾\r\n *                                        ·\r\n *                                        ↓\r\n * \r\n * USED BY:\r\n * - Elastic animations\r\n * - Impact effects (squash on hit)\r\n * - Breathing/pulsing variations\r\n * - Transition effects\r\n */\r\n\r\n/**\r\n * Stretch gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'stretch',\r\n    emoji: '↔️',\r\n    type: 'override', // Completely replaces motion\r\n    description: 'Scale particles along X and Y axes',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 2000,        // Animation duration\r\n        scaleX: 1.3,           // Horizontal scale factor\r\n        scaleY: 0.9,           // Vertical scale factor\r\n        alternate: false,      // Alternate between X and Y stretch\r\n        elastic: true,         // Add elastic overshoot\r\n        overshoot: 0.1,        // Elastic overshoot amount\r\n        frequency: 1,          // Number of stretches\r\n        easing: 'sine',        // Animation curve type\r\n        strength: 1.0,         // Motion strength\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'stretch',\r\n            scaleX: 1.8,       // Particle horizontal scale\r\n            scaleY: 0.6,       // Particle vertical scale\r\n            strength: 1.0\r\n        },\r\n        centerBased: true,     // Scale from center vs. origin\r\n        preserveArea: false    // Keep total area constant\r\n    },\r\n    \r\n    // Rhythm configuration - stretch pulses with rhythm\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',  // Stretch on beats\r\n        \r\n        // Scale modulation with rhythm\r\n        scaleSync: {\r\n            onBeat: { x: 1.5, y: 0.7 },     // Stretch wide on beat\r\n            offBeat: { x: 0.8, y: 1.3 },     // Stretch tall off beat\r\n            subdivision: 'eighth',            // Change every 8th note\r\n            curve: 'elastic'                 // Bouncy stretch\r\n        },\r\n        \r\n        // Alternation pattern\r\n        alternateSync: {\r\n            pattern: 'XYXY',                 // X stretch, Y stretch pattern\r\n            beatsPerChange: 1,               // Change axis each beat\r\n            overlap: 0.1                      // Slight overlap in transitions\r\n        },\r\n        \r\n        // Elastic overshoot on accents\r\n        overshootSync: {\r\n            normal: 0.1,                     // Standard overshoot\r\n            accent: 0.3,                     // Big overshoot on accent\r\n            downbeat: 0.2,                   // Medium on downbeat\r\n            curve: 'spring'                  // Spring-like motion\r\n        },\r\n        \r\n        // Area preservation modes\r\n        preservationSync: {\r\n            verse: true,                     // Maintain area in verse\r\n            chorus: false,                   // Free deformation in chorus\r\n            bridge: true                     // Back to preservation\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: { scaleX: 2.0, scaleY: 0.5, overshoot: 0.4 },\r\n            piano: { scaleX: 1.1, scaleY: 0.95, overshoot: 0.05 }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        // Calculate offset from center\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        \r\n        particle.gestureData.stretch = {\r\n            offsetX: dx,\r\n            offsetY: dy,\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply stretch motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.stretch?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.stretch;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = motion.strength || 1.0;\r\n        \r\n        // Calculate scale factors\r\n        let scaleX = config.scaleX;\r\n        let scaleY = config.scaleY;\r\n        \r\n        // Apply area preservation if enabled\r\n        if (config.preserveArea && scaleX !== 1 && scaleY !== 1) {\r\n            // Adjust scales to maintain area\r\n            const targetArea = scaleX * scaleY;\r\n            const factor = Math.sqrt(1 / targetArea);\r\n            scaleX *= factor;\r\n            scaleY *= factor;\r\n        }\r\n        \r\n        // Handle alternating stretch\r\n        if (config.alternate) {\r\n            // First half: stretch X\r\n            // Second half: stretch Y\r\n            if (progress < 0.5) {\r\n                const altProgress = progress * 2;\r\n                scaleX = 1 + (scaleX - 1) * this.getElasticProgress(altProgress, config);\r\n                scaleY = 1 + (1 / scaleX - 1) * (config.preserveArea ? 1 : 0); // Area compensation\r\n            } else {\r\n                const altProgress = (progress - 0.5) * 2;\r\n                scaleX = scaleX + (1 - scaleX) * this.getElasticProgress(altProgress, config);\r\n                scaleY = 1 + (scaleY - 1) * this.getElasticProgress(altProgress, config);\r\n            }\r\n        } else {\r\n            // Apply both scales simultaneously\r\n            const easeProgress = this.getElasticProgress(progress, config);\r\n            scaleX = 1 + (scaleX - 1) * easeProgress * strength;\r\n            scaleY = 1 + (scaleY - 1) * easeProgress * strength;\r\n        }\r\n        \r\n        // Calculate target position\r\n        let targetX, targetY;\r\n        \r\n        if (config.centerBased) {\r\n            // Scale from center point\r\n            targetX = centerX + data.offsetX * scaleX;\r\n            targetY = centerY + data.offsetY * scaleY;\r\n        } else {\r\n            // Scale from original position\r\n            targetX = data.startX * scaleX;\r\n            targetY = data.startY * scaleY;\r\n        }\r\n        \r\n        // Apply position\r\n        particle.x = targetX;\r\n        particle.y = targetY;\r\n        \r\n        // Set velocity based on stretch direction\r\n        particle.vx = data.offsetX * (scaleX - 1) * strength * 0.1;\r\n        particle.vy = data.offsetY * (scaleY - 1) * strength * 0.1;\r\n        \r\n        // Smooth ending\r\n        if (progress > 0.9) {\r\n            const endFactor = (1 - progress) * 10;\r\n            particle.vx = particle.vx * endFactor + data.originalVx * (1 - endFactor);\r\n            particle.vy = particle.vy * endFactor + data.originalVy * (1 - endFactor);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Calculate progress with optional elastic overshoot\r\n     * @param {number} progress - Raw progress (0-1)\r\n     * @param {Object} config - Configuration with elastic settings\r\n     * @returns {number} Modified progress value\r\n     */\r\n    getElasticProgress: function(progress, config) {\r\n        if (!config.elastic) {\r\n            return this.easeInOutCubic(progress);\r\n        }\r\n        \r\n        // Elastic easing with overshoot\r\n        if (progress === 0) return 0;\r\n        if (progress === 1) return 1;\r\n        \r\n        const overshoot = config.overshoot || 0.1;\r\n        const p = 0.3;\r\n        const s = p / 4;\r\n        \r\n        if (progress < 0.5) {\r\n            // Ease in with slight pull back\r\n            const t = progress * 2;\r\n            return 0.5 * this.easeInElastic(t, overshoot);\r\n        } else {\r\n            // Ease out with overshoot\r\n            const t = (progress - 0.5) * 2;\r\n            return 0.5 + 0.5 * this.easeOutElastic(t, overshoot);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.stretch) {\r\n            const data = particle.gestureData.stretch;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            delete particle.gestureData.stretch;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Easing functions\r\n     */\r\n    easeInOutCubic: function(t) {\r\n        return t < 0.5 \r\n            ? 4 * t * t * t \r\n            : 1 - Math.pow(-2 * t + 2, 3) / 2;\r\n    },\r\n    \r\n    easeInElastic: function(t, overshoot) {\r\n        if (t === 0) return 0;\r\n        if (t === 1) return 1;\r\n        const p = 0.3;\r\n        const s = p / 4;\r\n        return -(Math.pow(2, 10 * (t - 1)) * Math.sin((t - 1 - s) * (2 * Math.PI) / p)) * (1 + overshoot);\r\n    },\r\n    \r\n    easeOutElastic: function(t, overshoot) {\r\n        if (t === 0) return 0;\r\n        if (t === 1) return 1;\r\n        const p = 0.3;\r\n        const s = p / 4;\r\n        return Math.pow(2, -10 * t) * Math.sin((t - s) * (2 * Math.PI) / p) * (1 + overshoot) + 1;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Tilt Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Tilt gesture - particles gather and sway together\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/tilt\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a cohesive tilting motion where particles first gather toward the center, \r\n * ║ then tilt and sway as a unified group. Perfect for curious or questioning         \r\n * ║ expressions, like a head tilt.                                                    \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *    Phase 1: Gather    Phase 2: Tilt Left    Phase 3: Tilt Right\r\n *      · · ·               ↖ ⭐                    ⭐ ↗\r\n *     · · · ·      →      ↖ ⭐ ⭐        →      ⭐ ⭐ ↗\r\n *      · · ·               ↖ ⭐                    ⭐ ↗\r\n *    (scattered)         (tilted left)         (tilted right)\r\n * \r\n * USED BY:\r\n * - Curiosity/questioning states\r\n * - Contemplation animations\r\n * - Playful head-tilt effects\r\n * - Character personality expressions\r\n */\r\n\r\n/**\r\n * Tilt gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'tilt',\r\n    emoji: '🤔',\r\n    type: 'override', // Completely replaces motion\r\n    description: 'Gather particles then tilt as unified group',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 500,         // Animation duration\r\n        gatherPhase: 0.2,      // Gathering phase ratio\r\n        tiltAngle: 45,         // Maximum tilt angle in degrees\r\n        swayAmount: 80,        // Horizontal sway distance\r\n        liftAmount: 60,        // Vertical lift distance during tilt\r\n        frequency: 3,          // Number of tilt cycles\r\n        homeRadius: 20,        // Gathering radius from center\r\n        easing: 'sine',        // Animation curve type\r\n        strength: 2.5,         // Overall motion intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'tilt',\r\n            strength: 2.5,\r\n            frequency: 3,\r\n            swayAmount: 80,\r\n            liftAmount: 60\r\n        },\r\n        smoothness: 0.25       // Movement smoothing factor\r\n    },\r\n    \r\n    // Rhythm configuration - tilts sync to swing rhythm\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'swing',  // Tilt with swing feel\r\n        \r\n        // Tilt angle syncs to beat pattern\r\n        angleSync: {\r\n            onBeat: 45,                      // Full tilt on beat\r\n            offBeat: -30,                    // Counter-tilt off beat\r\n            swing: 15,                       // Extra tilt on swing beats\r\n            subdivision: 'triplet',          // Triplet feel for smooth sway\r\n            curve: 'ease-in-out'            // Smooth tilt transitions\r\n        },\r\n        \r\n        // Gathering phase timing\r\n        gatherSync: {\r\n            beatsBefore: 0.5,                // Gather half beat before tilt\r\n            releaseAfter: 0.25,              // Release quarter beat after\r\n            intensity: 'dynamic'             // Gather speed varies with tempo\r\n        },\r\n        \r\n        // Sway amount modulation\r\n        swaySync: {\r\n            verse: 60,                       // Gentle sway in verse\r\n            chorus: 100,                     // Big sway in chorus\r\n            bridge: 80,                      // Medium in bridge\r\n            syncopated: true                 // Off-beat emphasis\r\n        },\r\n        \r\n        // Lift coordination\r\n        liftSync: {\r\n            upOnTilt: true,                  // Lift when tilting\r\n            heightOnAccent: 80,              // Higher lift on accents\r\n            normalHeight: 40,                // Standard lift height\r\n            curve: 'bounce'                  // Bouncy lift motion\r\n        },\r\n        \r\n        // Musical expression\r\n        dynamics: {\r\n            forte: { tiltAngle: 60, swayAmount: 120, frequency: 4 },\r\n            piano: { tiltAngle: 20, swayAmount: 40, frequency: 2 }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        // Calculate initial position and angle\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        const angle = Math.atan2(dy, dx);\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        // Assign a role for variation (some particles lag slightly)\r\n        const role = Math.random();\r\n        \r\n        // Calculate home position (where particle gathers to)\r\n        const config = { ...this.config, ...motion };\r\n        const homeRadius = (config.homeRadius + Math.random() * 20) * particle.scaleFactor;\r\n        \r\n        particle.gestureData.tilt = {\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            angle: angle,\r\n            distance: distance,\r\n            homeRadius: homeRadius,\r\n            homeX: centerX + Math.cos(angle) * homeRadius,\r\n            homeY: centerY + Math.sin(angle) * homeRadius,\r\n            role: role, // Variation factor for timing and smoothness\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply tilt motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.tilt?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.tilt;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = motion.strength || 1.0;\r\n        \r\n        let targetX, targetY;\r\n        \r\n        if (progress < config.gatherPhase) {\r\n            // PHASE 1: Gather toward center\r\n            const gatherProgress = progress / config.gatherPhase;\r\n            const easedGather = this.easeInOutCubic(gatherProgress);\r\n            \r\n            // Interpolate from start to home position\r\n            targetX = data.startX + (data.homeX - data.startX) * easedGather;\r\n            targetY = data.startY + (data.homeY - data.startY) * easedGather;\r\n            \r\n            // Apply gathering motion\r\n            const speed = 0.6;  // Gathering speed factor\r\n            particle.x += (targetX - particle.x) * speed;\r\n            particle.y += (targetY - particle.y) * speed;\r\n            \r\n        } else {\r\n            // PHASE 2: Tilting motion\r\n            const tiltPhase = (progress - config.gatherPhase) / (1 - config.gatherPhase);\r\n            const t = tiltPhase * Math.PI * config.frequency;\r\n            const tiltProgress = Math.sin(t);\r\n            \r\n            // Convert tilt angle to radians\r\n            const maxTiltRad = (config.tiltAngle * Math.PI / 180) * strength;\r\n            \r\n            // Calculate sway angle (oscillates left and right)\r\n            const swayAngle = data.angle + (tiltProgress * maxTiltRad);\r\n            \r\n            // Add lift effect (particles rise slightly during tilt)\r\n            const liftAmount = Math.abs(tiltProgress) * config.liftAmount * particle.scaleFactor;\r\n            const currentRadius = data.homeRadius + liftAmount;\r\n            \r\n            // Calculate target position with tilt\r\n            targetX = centerX + Math.cos(swayAngle) * currentRadius;\r\n            targetY = centerY + Math.sin(swayAngle) * currentRadius - liftAmount * 0.3; // Add upward bias\r\n            \r\n            // Apply role-based variation (some particles lag)\r\n            const smoothness = config.smoothness + data.role * 0.1;\r\n            \r\n            // Smooth movement to target\r\n            particle.x += (targetX - particle.x) * smoothness;\r\n            particle.y += (targetY - particle.y) * smoothness;\r\n            \r\n            // Add subtle rotation feel with velocity\r\n            const tangentX = -Math.sin(swayAngle);\r\n            const tangentY = Math.cos(swayAngle);\r\n            particle.vx = tangentX * tiltProgress * 2;\r\n            particle.vy = tangentY * tiltProgress * 2;\r\n        }\r\n        \r\n        // Store current velocity for trails\r\n        if (progress < config.gatherPhase) {\r\n            particle.vx = (targetX - particle.x) * 0.25;\r\n            particle.vy = (targetY - particle.y) * 0.25;\r\n        }\r\n        \r\n        // Smooth ending - return to original velocities\r\n        if (progress > 0.9) {\r\n            const endFactor = (1 - progress) * 10;\r\n            const returnX = data.startX + (particle.x - data.startX) * endFactor;\r\n            const returnY = data.startY + (particle.y - data.startY) * endFactor;\r\n            \r\n            particle.x = returnX;\r\n            particle.y = returnY;\r\n            particle.vx = particle.vx * endFactor + data.originalVx * (1 - endFactor);\r\n            particle.vy = particle.vy * endFactor + data.originalVy * (1 - endFactor);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.tilt) {\r\n            const data = particle.gestureData.tilt;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            delete particle.gestureData.tilt;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Easing function for smooth animation\r\n     * @param {number} t - Progress (0-1)\r\n     * @returns {number} Eased value\r\n     */\r\n    easeInOutCubic: function(t) {\r\n        return t < 0.5 \r\n            ? 4 * t * t * t \r\n            : 1 - Math.pow(-2 * t + 2, 3) / 2;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Orbital Gesture with 3D Depth\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview 3D orbital gesture - particles orbit with dynamic z-depth changes\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/orbital\r\n * \r\n * GESTURE TYPE:\r\n * type: 'override' - Takes complete control of particle motion\r\n * \r\n * ACCEPTABLE TYPES:\r\n * - 'blending' : Adds motion to existing particle behavior (used in motions/)\r\n * - 'override' : Replaces particle motion completely (used in transforms/)\r\n * - 'effect'   : Visual effects without changing position (used in effects/)\r\n * \r\n * VISUAL EFFECT:\r\n * Particles orbit around the center while transitioning between foreground and\r\n * background layers, creating a true 3D effect where particles pass behind and\r\n * in front of the orb.\r\n */\r\n\r\nexport default {\r\n    name: 'orbital',\r\n    emoji: '🪐',\r\n    type: 'override',\r\n    description: 'Orbital motion around center',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        speed: 0.02,              // Orbital rotation speed\r\n        maintainRadius: true,     // Keep constant orbit radius\r\n        elliptical: false,        // Use circular orbit\r\n        use3D: true,              // Enable z-coordinate animation\r\n        zPhaseOffset: 0,          // Phase offset for z-oscillation\r\n        verticalOscillation: 0,   // Vertical movement for hula-hoop effect\r\n        duration: 3000,           // Animation duration\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'orbital',\r\n            strength: 1.0\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - orbital paths sync to harmony\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'harmonic',  // Orbit follows harmonic intervals\r\n        \r\n        // Speed based on harmonic ratios\r\n        speedSync: {\r\n            tonic: 0.02,              // Base orbit speed\r\n            fifth: 0.03,              // 3:2 ratio (perfect fifth)\r\n            octave: 0.04,             // 2:1 ratio (octave)\r\n            third: 0.025,             // 5:4 ratio (major third)\r\n            curve: 'smooth'           // Smooth transitions\r\n        },\r\n        \r\n        // Orbital layers by pitch\r\n        radiusSync: {\r\n            bass: 150,                // Outer orbit for low notes\r\n            mid: 100,                 // Middle orbit for mids\r\n            treble: 50,               // Inner orbit for highs\r\n            scaling: 'logarithmic'    // Natural pitch scaling\r\n        },\r\n        \r\n        // 3D depth syncs to chord progression\r\n        depthSync: {\r\n            major: { z: 1.0, phase: 0 },        // Front-facing for major\r\n            minor: { z: -1.0, phase: Math.PI }, // Back-facing for minor\r\n            diminished: { z: 0.5, phase: Math.PI/2 }, // Side angle\r\n            augmented: { z: 0.8, phase: -Math.PI/2 }  // Other side\r\n        },\r\n        \r\n        // Phase relationships\r\n        phaseSync: {\r\n            mode: 'harmonic',         // Particles phase-lock harmonically\r\n            intervals: [1, 1.5, 2],   // Unison, fifth, octave\r\n            drift: 0.05               // Slight phase drift for organic feel\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: { speed: 0.04, maintainRadius: false }, // Chaotic orbits\r\n            piano: { speed: 0.01, maintainRadius: true }   // Stable orbits\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        const calculatedRadius = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        // Random direction for orbit\r\n        const direction = Math.random() < 0.5 ? 1 : -1;\r\n        \r\n        // Set minimum radius to prevent center clustering - 3x larger spread\r\n        const MIN_RADIUS = 100;\r\n        const radius = Math.max(calculatedRadius, MIN_RADIUS + Math.random() * 180); // At least 180-360 pixels\r\n        \r\n        particle.gestureData.orbital = {\r\n            radius: radius,\r\n            targetRadius: radius, // Store target for smooth transitions\r\n            angle: calculatedRadius < 5 ? Math.random() * Math.PI * 2 : Math.atan2(dy, dx), // Random angle if at center\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            originalZ: particle.z || 0,  // Store original z-coordinate\r\n            zPhase: Math.random() * Math.PI * 2,  // Random phase for variety\r\n            direction: direction  // Random orbit direction\r\n        };\r\n    },\r\n    \r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.orbital) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.orbital;\r\n        const speed = (motion.speed || this.config.speed) * (motion.strength || 1);\r\n        \r\n        // Update angle with direction (dt is already normalized to 60fps)\r\n        data.angle += speed * dt * data.direction;\r\n        \r\n        // Use the stored radius (which has minimum enforced)\r\n        let radius = data.radius;\r\n        \r\n        if (!motion.maintainRadius) {\r\n            // Allow radius to vary slightly for organic motion\r\n            radius = data.radius * (1 + Math.sin(progress * Math.PI * 2) * 0.1);\r\n        }\r\n        \r\n        particle.x = centerX + Math.cos(data.angle) * radius;\r\n        particle.y = centerY + Math.sin(data.angle) * radius;\r\n        \r\n        // 3D DEPTH: Animate z-coordinate for particles passing behind/in front\r\n        if (motion.use3D !== false) {  // Default to true\r\n            // Z oscillates as particle orbits, creating 3D effect\r\n            // When angle is 0/2π (right side), z is positive (front)\r\n            // When angle is π (left side), z is negative (back)\r\n            const zAngle = data.angle + data.zPhase + (motion.zPhaseOffset || 0);\r\n            particle.z = Math.sin(zAngle) * 0.8; // Z-depth range for layering\r\n            \r\n            // Add vertical oscillation for hula-hoop effect\r\n            if (motion.verticalOscillation) {\r\n                const verticalOffset = Math.cos(zAngle) * motion.verticalOscillation * radius * 0.1;\r\n                particle.y += verticalOffset;\r\n            }\r\n        }\r\n        \r\n        // Set velocity to match motion\r\n        particle.vx = -Math.sin(data.angle) * radius * speed;\r\n        particle.vy = Math.cos(data.angle) * radius * speed;\r\n        \r\n        // Restore original velocity at end\r\n        if (progress > 0.9) {\r\n            const blendFactor = (1 - progress) * 10;\r\n            particle.vx = particle.vx * blendFactor + data.originalVx * (1 - blendFactor);\r\n            particle.vy = particle.vy * blendFactor + data.originalVy * (1 - blendFactor);\r\n        }\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.orbital) {\r\n            const data = particle.gestureData.orbital;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            particle.z = data.originalZ;  // Restore original z-coordinate\r\n            delete particle.gestureData.orbital;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Hula-Hoop Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Hula-hoop variation of orbital with vertical oscillation\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/hula\r\n * \r\n * VISUAL EFFECT:\r\n * Like a hula-hoop spinning around the orb - particles orbit horizontally while\r\n * oscillating vertically, creating a tilted ring effect with 3D depth.\r\n */\r\n\r\nexport default {\r\n    name: 'hula',\r\n    emoji: '🌀',\r\n    type: 'override',\r\n    description: 'Hula-hoop motion with vertical waves',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        speed: 0.015,             // Rotation speed\r\n        maintainRadius: false,     // Allow radius variation for organic feel\r\n        elliptical: true,          // Elliptical orbit shape\r\n        use3D: true,               // Enable 3D depth effect\r\n        zPhaseOffset: Math.PI / 4, // Ring tilt angle\r\n        verticalOscillation: 0.3,  // Vertical wave amount\r\n        wobbleAmount: 0.15,        // Ring wobble intensity\r\n        duration: 2500,            // Animation duration\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'hula',\r\n            strength: 1.0,\r\n            verticalOscillation: 0.3\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - hula syncs to groove\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'bar',  // Full rotation per bar\r\n        \r\n        // Speed syncs to tempo for consistent rotation\r\n        speedSync: {\r\n            mode: 'tempo',\r\n            baseSpeed: 0.015,      // Base speed at 120 BPM\r\n            scaling: 'proportional' // Speed scales with BPM\r\n        },\r\n        \r\n        // Wobble syncs to beat for rhythmic variation\r\n        wobbleSync: {\r\n            onBeat: 0.25,          // More wobble on beat\r\n            offBeat: 0.1,          // Less wobble off beat\r\n            curve: 'sine'          // Smooth transitions\r\n        },\r\n        \r\n        // Vertical oscillation creates wave patterns\r\n        verticalSync: {\r\n            subdivision: 'quarter', // Wave every quarter note\r\n            amplitude: 0.4,        // Wave height on beat\r\n            phase: 'sequential'    // Waves follow rotation\r\n        },\r\n        \r\n        // Musical expression\r\n        dynamics: {\r\n            forte: { wobbleAmount: 0.3, speed: 1.2 },  // Wilder on loud\r\n            piano: { wobbleAmount: 0.05, speed: 0.8 }  // Gentler on soft\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        const calculatedRadius = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        // Random direction for hula-hoop\r\n        const direction = Math.random() < 0.5 ? 1 : -1;\r\n        \r\n        // Set minimum radius to prevent center clustering - 3x larger spread\r\n        const MIN_RADIUS = 100; // Slightly larger for hula effect\r\n        const radius = Math.max(calculatedRadius, MIN_RADIUS + Math.random() * 180); // At least 210-390 pixels\r\n        \r\n        particle.gestureData.hula = {\r\n            radius: radius,\r\n            angle: calculatedRadius < 5 ? Math.random() * Math.PI * 2 : Math.atan2(dy, dx), // Random angle if at center\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            originalZ: particle.z || 0,\r\n            zPhase: Math.random() * Math.PI * 2,\r\n            wobblePhase: Math.random() * Math.PI * 2,\r\n            direction: direction  // Random hula direction\r\n        };\r\n    },\r\n    \r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.hula) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.hula;\r\n        const speed = (motion.speed || this.config.speed) * (motion.strength || 1);\r\n        \r\n        // Smooth entry/exit transitions\r\n        let transitionFactor = 1.0;\r\n        if (progress < 0.1) {\r\n            // Smooth entry (first 10%)\r\n            transitionFactor = progress / 0.1;\r\n            transitionFactor = Math.sin(transitionFactor * Math.PI * 0.5); // Smooth ease-in\r\n        } else if (progress > 0.9) {\r\n            // Smooth exit (last 10%)\r\n            transitionFactor = (1 - progress) / 0.1;\r\n            transitionFactor = Math.sin(transitionFactor * Math.PI * 0.5); // Smooth ease-out\r\n        }\r\n        \r\n        // Update angle with direction (dt is already normalized to 60fps)\r\n        data.angle += speed * dt * data.direction * transitionFactor;\r\n        \r\n        // Wobble effect - the hoop wobbles as it spins\r\n        const wobble = Math.sin(data.angle * 2 + data.wobblePhase) * (motion.wobbleAmount || this.config.wobbleAmount) * transitionFactor;\r\n        \r\n        // Calculate elliptical radius with wobble and transition\r\n        let radiusX = data.radius * (1 + wobble) * transitionFactor;\r\n        let radiusY = data.radius * (0.7 + wobble) * transitionFactor; // Elliptical shape factor\r\n        \r\n        // Smoothly transition from original position to orbit position\r\n        const targetX = centerX + Math.cos(data.angle) * radiusX;\r\n        const targetY = centerY + Math.sin(data.angle) * radiusY;\r\n        \r\n        if (progress < 0.1) {\r\n            // During entry, lerp from original position\r\n            const dx = particle.x - centerX;\r\n            const dy = particle.y - centerY;\r\n            const currentRadius = Math.sqrt(dx * dx + dy * dy);\r\n            if (currentRadius < 50) {\r\n                // If particle is at center, move it out smoothly\r\n                particle.x = centerX + Math.cos(data.angle) * radiusX;\r\n                particle.y = centerY + Math.sin(data.angle) * radiusY;\r\n            } else {\r\n                particle.x = particle.x + (targetX - particle.x) * transitionFactor * 0.5;\r\n                particle.y = particle.y + (targetY - particle.y) * transitionFactor * 0.5;\r\n            }\r\n        } else {\r\n            particle.x = targetX;\r\n            particle.y = targetY;\r\n        }\r\n        \r\n        // 3D DEPTH with strong vertical oscillation\r\n        const zAngle = data.angle + data.zPhase + (motion.zPhaseOffset || this.config.zPhaseOffset);\r\n        \r\n        // Z-coordinate for depth (behind/in front) with transition\r\n        particle.z = Math.sin(zAngle) * 0.9 * transitionFactor;\r\n        \r\n        // Vertical oscillation synchronized with z-depth\r\n        const verticalAmount = motion.verticalOscillation || this.config.verticalOscillation;\r\n        const verticalOffset = Math.cos(zAngle * 2) * verticalAmount * data.radius * 0.2 * transitionFactor;\r\n        particle.y += verticalOffset;\r\n        \r\n        // Tilt effect - particles higher when in front, lower when behind\r\n        const tiltOffset = particle.z * data.radius * 0.1;\r\n        particle.y -= tiltOffset;\r\n        \r\n        // Set velocity to match motion with smooth transitions\r\n        const targetVx = -Math.sin(data.angle) * radiusX * speed;\r\n        const targetVy = Math.cos(data.angle) * radiusY * speed;\r\n        \r\n        if (progress < 0.1) {\r\n            // Smooth velocity transition during entry\r\n            particle.vx = data.originalVx + (targetVx - data.originalVx) * transitionFactor;\r\n            particle.vy = data.originalVy + (targetVy - data.originalVy) * transitionFactor;\r\n        } else if (progress > 0.9) {\r\n            // Smooth velocity transition during exit\r\n            particle.vx = targetVx * transitionFactor + data.originalVx * (1 - transitionFactor);\r\n            particle.vy = targetVy * transitionFactor + data.originalVy * (1 - transitionFactor);\r\n            particle.z = particle.z * transitionFactor + data.originalZ * (1 - transitionFactor);\r\n        } else {\r\n            particle.vx = targetVx;\r\n            particle.vy = targetVy;\r\n        }\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.hula) {\r\n            const data = particle.gestureData.hula;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            particle.z = data.originalZ;\r\n            delete particle.gestureData.hula;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Scan Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Searchlight scanning gesture for suspicious states\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/scan\r\n * \r\n * GESTURE TYPE:\r\n * type: 'override' - Takes complete control of particle motion\r\n * \r\n * VISUAL EFFECT:\r\n * Particles sweep back and forth in a searchlight pattern, pausing at edges\r\n * to simulate surveillance scanning or paranoid checking behavior.\r\n */\r\n\r\nexport default {\r\n    name: 'scan',\r\n    emoji: '🔍',\r\n    type: 'override',\r\n    description: 'Searchlight scanning motion',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        scanSpeed: 0.008,         // Slow, deliberate scanning\r\n        scanWidth: 120,           // Width of scan arc in pixels\r\n        pauseDuration: 300,       // Pause at edges in ms\r\n        scanHeight: 40,           // Vertical variation\r\n        layers: 3,                // Number of scan layers\r\n        duration: 3000            // Total animation duration\r\n    },\r\n    \r\n    // Rhythm configuration - scanning syncs to measures\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'measure',  // Scan sweeps align with measures\r\n        \r\n        // Scan timing to musical structure\r\n        sweepSync: {\r\n            beatsPerSweep: 4,         // One sweep per measure\r\n            pauseOnDownbeat: true,    // Pause at measure start\r\n            reverseOnBar: true,       // Change direction each bar\r\n            curve: 'linear'           // Steady scan motion\r\n        },\r\n        \r\n        // Layer activation by dynamics\r\n        layerSync: {\r\n            quiet: 1,                 // Single layer when quiet\r\n            moderate: 2,              // Two layers at medium\r\n            loud: 3,                  // All layers when loud\r\n            stagger: 'sequential'     // Layers activate in order\r\n        },\r\n        \r\n        // Pause duration on beats\r\n        pauseSync: {\r\n            onBeat: 500,              // Longer pause on beat\r\n            offBeat: 100,             // Quick pause off beat\r\n            accent: 800,              // Extra pause on accent\r\n            subdivision: 'quarter'    // Check every quarter note\r\n        },\r\n        \r\n        // Width modulation\r\n        widthSync: {\r\n            verse: 80,                // Narrow scan in verse\r\n            chorus: 140,              // Wide scan in chorus\r\n            bridge: 100,              // Medium in bridge\r\n            transition: 'smooth'      // Smooth width changes\r\n        },\r\n        \r\n        // Musical tension mapping\r\n        dynamics: {\r\n            forte: { scanSpeed: 0.012, layers: 4 },    // Frantic scanning\r\n            piano: { scanSpeed: 0.004, layers: 1 }     // Slow, single beam\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        // Assign particles to different scan layers\r\n        const layer = Math.floor(Math.random() * this.config.layers);\r\n        \r\n        particle.gestureData.scan = {\r\n            layer: layer,\r\n            phase: Math.random() * Math.PI * 2,  // Random starting phase\r\n            direction: Math.random() < 0.5 ? 1 : -1,  // Start direction\r\n            pauseTimer: 0,\r\n            isPaused: false,\r\n            originalX: particle.x,\r\n            originalY: particle.y,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            scanOffset: (Math.random() - 0.5) * 20,  // Individual variation\r\n            verticalOffset: layer * 30 - 30,  // Layer separation\r\n            initialized: true,\r\n            startTime: Date.now()\r\n        };\r\n    },\r\n    \r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.scan) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.scan;\r\n        const speed = motion.scanSpeed || this.config.scanSpeed;\r\n        const width = motion.scanWidth || this.config.scanWidth;\r\n        const pauseDuration = motion.pauseDuration || this.config.pauseDuration;\r\n        \r\n        // Handle pause at edges\r\n        if (data.isPaused) {\r\n            data.pauseTimer -= dt * 16;\r\n            if (data.pauseTimer <= 0) {\r\n                data.isPaused = false;\r\n                data.direction *= -1;  // Reverse direction after pause\r\n            }\r\n        } else {\r\n            // Update scan phase\r\n            data.phase += speed * data.direction * dt;\r\n            \r\n            // Check for edge reached\r\n            const scanPosition = Math.sin(data.phase);\r\n            if (Math.abs(scanPosition) > 0.95) {\r\n                data.isPaused = true;\r\n                data.pauseTimer = pauseDuration;\r\n            }\r\n        }\r\n        \r\n        // Calculate position\r\n        const scanX = Math.sin(data.phase) * width;\r\n        const scanY = Math.cos(data.phase * 0.5) * (this.config.scanHeight / 2);\r\n        \r\n        // Smooth entry transition (first 15% of animation)\r\n        let transitionFactor = 1.0;\r\n        if (progress < 0.15) {\r\n            transitionFactor = progress / 0.15;\r\n            transitionFactor = transitionFactor * transitionFactor; // Ease in\r\n        }\r\n        // Smooth exit transition (last 15% of animation)\r\n        else if (progress > 0.85) {\r\n            transitionFactor = (1 - progress) / 0.15;\r\n            transitionFactor = transitionFactor * transitionFactor; // Ease out\r\n        }\r\n        \r\n        // Apply layer-specific positioning with smooth transitions\r\n        const targetX = centerX + scanX + data.scanOffset;\r\n        const targetY = centerY + scanY + data.verticalOffset;\r\n        \r\n        particle.x = data.originalX + (targetX - data.originalX) * transitionFactor;\r\n        particle.y = data.originalY + (targetY - data.originalY) * transitionFactor;\r\n        \r\n        // Slow down during pauses for more realistic scanning\r\n        if (data.isPaused) {\r\n            particle.vx *= 0.85;\r\n            particle.vy *= 0.85;\r\n        } else {\r\n            // Set velocity based on scan motion\r\n            particle.vx = -Math.cos(data.phase) * width * speed * 60;\r\n            particle.vy = -Math.sin(data.phase * 0.5) * this.config.scanHeight * speed * 30;\r\n        }\r\n        \r\n        // Add slight jitter for realism\r\n        if (Math.random() < 0.02) {\r\n            particle.vx += (Math.random() - 0.5) * 2;\r\n            particle.vy += (Math.random() - 0.5) * 2;\r\n        }\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.scan) {\r\n            const data = particle.gestureData.scan;\r\n            // Restore original velocities for smooth exit\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            delete particle.gestureData.scan;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Twist Gesture\r\n *  └─○═╝\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Twist gesture - alternating rotational dance motion\r\n * @author Emotive Engine Team\r\n * @module gestures/transforms/twist\r\n *\r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE\r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a twisting dance motion with alternating rotation and contraction.\r\n * ║ This is an OVERRIDE gesture that replaces existing particle motion.\r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *     ↻ ⭐ ↺      <- twist left/right\r\n *    ╱     ╲\r\n *   ⭐       ⭐    <- particles contract\r\n *    ╲     ╱\r\n *     ↺ ⭐ ↻      <- twist opposite\r\n *\r\n * USED BY:\r\n * - Dance gestures\r\n * - Playful emotions\r\n * - Music synchronization\r\n */\r\n\r\n/**\r\n * Twist gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'twist',\r\n    emoji: '🌀',\r\n    type: 'override', // Replaces existing motion\r\n    description: 'Twisting dance motion with alternating rotation',\r\n\r\n    // Default configuration\r\n    config: {\r\n        duration: 1200,      // Animation duration\r\n        rotationAngle: 45,   // Max rotation angle in degrees\r\n        contractionFactor: 0.8, // How much to contract during twist\r\n        twistFrequency: 2,   // Number of twist cycles\r\n        easing: 'smooth',    // Animation curve type\r\n        strength: 0.8,       // Overall motion intensity\r\n        // Particle motion configuration\r\n        particleMotion: {\r\n            type: 'twist',\r\n            rotationAngle: 45,\r\n            contractionFactor: 0.8,\r\n            twistFrequency: 2\r\n        }\r\n    },\r\n\r\n    // Rhythm configuration - twist syncs to beat\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',\r\n        timingSync: 'nextBeat',\r\n        interruptible: true,\r\n        priority: 4,\r\n        blendable: false,  // Override gesture, no blending\r\n        crossfadePoint: 'anyBeat',\r\n\r\n        // Twist intensity syncs to beat\r\n        amplitudeSync: {\r\n            onBeat: 1.5,      // Stronger twist on beat\r\n            offBeat: 0.7,     // Lighter between beats\r\n            curve: 'elastic'  // Bouncy twist motion\r\n        },\r\n\r\n        // Pattern-specific twisting styles\r\n        patternOverrides: {\r\n            'funk': {\r\n                // Funky twist with more rotation\r\n                rotationAngle: 60,\r\n                contractionFactor: 0.7\r\n            },\r\n            'disco': {\r\n                // Classic disco twist\r\n                twistFrequency: 3,\r\n                rotationAngle: 50\r\n            },\r\n            'latin': {\r\n                // Latin-style hip twist\r\n                rotationAngle: 35,\r\n                contractionFactor: 0.85,\r\n                twistFrequency: 2.5\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Initialize gesture data for a particle\r\n     */\r\n    initialize: function(particle, motion) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n\r\n        particle.gestureData.twist = {\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            startAngle: Math.atan2(particle.y - motion.centerY, particle.x - motion.centerX),\r\n            startDistance: Math.sqrt(\r\n                Math.pow(particle.x - motion.centerX, 2) +\r\n                Math.pow(particle.y - motion.centerY, 2)\r\n            ),\r\n            initialized: true\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Apply twist motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.twist?.initialized) {\r\n            this.initialize(particle, { ...motion, centerX, centerY });\r\n        }\r\n\r\n        const config = { ...this.config, ...motion };\r\n        const data = particle.gestureData.twist;\r\n        const strength = config.strength || this.config.strength || 1.0;\r\n\r\n        // Calculate twist oscillation\r\n        const twistProgress = progress * config.twistFrequency * Math.PI * 2;\r\n        const twistAmount = Math.sin(twistProgress) * strength;\r\n\r\n        // Apply rhythm modulation if present\r\n        let rotationAngle = config.rotationAngle;\r\n        let contractionFactor = config.contractionFactor;\r\n\r\n        if (motion.rhythmModulation) {\r\n            rotationAngle *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            contractionFactor = 1 - ((1 - contractionFactor) * (motion.rhythmModulation.amplitudeMultiplier || 1));\r\n        }\r\n\r\n        // Convert rotation to radians\r\n        const rotationRad = (rotationAngle * Math.PI / 180) * twistAmount;\r\n\r\n        // Calculate contraction (pull particles closer during twist)\r\n        const currentContraction = 1 - ((1 - contractionFactor) * Math.abs(twistAmount));\r\n\r\n        // Apply twist transformation\r\n        const newAngle = data.startAngle + rotationRad;\r\n        const newDistance = data.startDistance * currentContraction;\r\n\r\n        // Calculate new position\r\n        const targetX = centerX + Math.cos(newAngle) * newDistance;\r\n        const targetY = centerY + Math.sin(newAngle) * newDistance;\r\n\r\n        // Smoothly move to target position\r\n        const moveStrength = 0.15 * strength;\r\n        particle.x += (targetX - particle.x) * moveStrength;\r\n        particle.y += (targetY - particle.y) * moveStrength;\r\n\r\n        // Add some velocity for fluid motion\r\n        particle.vx = (targetX - particle.x) * 0.05;\r\n        particle.vy = (targetY - particle.y) * 0.05;\r\n\r\n        // Add slight vertical bounce for more dynamic feel\r\n        const bounceAmount = Math.sin(progress * Math.PI * 4) * 5 * strength;\r\n        particle.y += bounceAmount * 0.1;\r\n\r\n        // Smooth ending\r\n        if (progress > 0.9) {\r\n            const endFactor = 1 - ((progress - 0.9) * 10);\r\n            particle.vx *= endFactor;\r\n            particle.vy *= endFactor;\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     * Clean up gesture data when complete\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.twist) {\r\n            delete particle.gestureData.twist;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Wave Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Wave gesture - infinity pattern flow\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/wave\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a flowing wave motion with particles moving in an infinity (∞) pattern.   \r\n * ║ This is an OVERRIDE gesture that creates smooth, hypnotic figure-8 movements.     \r\n * ║ Particles phase in and out for a dreamlike effect.                                \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *        ∞ Infinity Pattern\r\n *      ↗ → ↘     ↙ ← ↖\r\n *     ⭐     ⭐ ⭐     ⭐\r\n *      ↖ ← ↙     ↘ → ↗\r\n *         (continuous flow)\r\n * \r\n * USED BY:\r\n * - Hypnotic/mesmerizing effects\r\n * - Dreamy transitions\r\n * - Magical gestures\r\n * - Flow states\r\n */\r\n\r\n/**\r\n * Wave gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'wave',\r\n    emoji: '🌊',\r\n    type: 'override', // Completely replaces motion\r\n    description: 'Infinity pattern flow with phasing',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        // Musical duration - wave flows for exactly 1 bar\r\n        musicalDuration: {\r\n            musical: true,\r\n            bars: 1,           // Default to 1 bar of wave motion\r\n            minBeats: 4,       // Minimum 1 bar\r\n            maxBeats: 16       // Maximum 4 bars\r\n        },\r\n        \r\n        // Musical phases of the wave gesture\r\n        phases: [\r\n            { name: 'gather', beats: 0.5 },     // Particles gather\r\n            { name: 'rise', beats: 0.5 },       // Begin rising motion\r\n            { name: 'waveLeft', beats: 1 },     // Wave to the left\r\n            { name: 'waveRight', beats: 1 },    // Wave to the right\r\n            { name: 'settle', beats: 1 }        // Settle back to center\r\n        ],\r\n        \r\n        amplitude: 40,         // Infinity pattern width\r\n        frequency: 1,          // Complete cycle count\r\n        phaseShift: 0.3,       // Particle timing offset\r\n        liftHeight: 20,        // Vertical movement range\r\n        fadeInOut: true,       // Enable opacity transitions\r\n        smoothness: 0.1,       // Motion fluidity factor\r\n        easing: 'sine',        // Animation curve type\r\n        strength: 1.0,         // Overall effect intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'wave',\r\n            strength: 1.0,     // Wave motion strength\r\n            amplitude: 50      // Pattern size\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - flowing wave patterns synchronized to musical waves and phrases\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'wave',    // Flow with musical wave patterns and melodic contours\r\n        \r\n        // Amplitude responds to musical dynamics and melodic range\r\n        amplitudeSync: {\r\n            onWave: 65,           // Large waves during musical waves\r\n            onStatic: 25,         // Small waves during static sections\r\n            curve: 'flowing'      // Smooth, continuous transitions\r\n        },\r\n        \r\n        // Frequency matches musical phrase rhythm\r\n        frequencySync: {\r\n            mode: 'phrase',\r\n            slow: 0.7,            // Slower waves for slow phrases\r\n            fast: 1.8,            // Faster waves for quick phrases\r\n            curve: 'melodic'      // Follows melodic contour\r\n        },\r\n        \r\n        // Duration automatically syncs to bars via musicalDuration config\r\n        durationSync: {\r\n            mode: 'bars',         // Uses bars from musicalDuration\r\n            adaptToPhrase: true,  // Extend to complete musical phrases\r\n            sustain: true         // Maintain wave through phrase\r\n        },\r\n        \r\n        // Phase shift creates ensemble wave effects\r\n        phaseSync: {\r\n            enabled: true,\r\n            multiplier: 0.5,      // Moderate phase variation\r\n            type: 'ensemble'      // Creates group wave patterns\r\n        },\r\n        \r\n        // Response to melodic contour\r\n        melodicResponse: {\r\n            enabled: true,\r\n            multiplier: 1.4,      // Wave amplitude follows melody\r\n            type: 'amplitude'     // Affects wave size\r\n        },\r\n        \r\n        // Style variations for different music types\r\n        patternOverrides: {\r\n            'ambient': {\r\n                // Slow, hypnotic waves\r\n                amplitudeSync: { onWave: 80, onStatic: 40, curve: 'hypnotic' },\r\n                frequencySync: { slow: 0.5, fast: 1.2 },\r\n                durationSync: { minBeats: 16, maxBeats: 64 }\r\n            },\r\n            'ocean': {\r\n                // Natural, oceanic wave patterns\r\n                amplitudeSync: { onWave: 90, onStatic: 20, curve: 'natural' },\r\n                phaseSync: { multiplier: 0.8 },\r\n                melodicResponse: { multiplier: 1.8 }\r\n            },\r\n            'electronic': {\r\n                // Precise, digital wave forms\r\n                amplitudeSync: { onWave: 70, onStatic: 30, curve: 'digital' },\r\n                frequencySync: { slow: 0.8, fast: 2.5, curve: 'precise' }\r\n            },\r\n            'orchestral': {\r\n                // Rich, complex wave interactions\r\n                amplitudeSync: { onWave: 75, onStatic: 35 },\r\n                phaseSync: { multiplier: 0.7 },\r\n                melodicResponse: { multiplier: 2.0 }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: {\r\n                // Powerful, sweeping waves\r\n                amplitudeSync: { \r\n                    onWave: { multiplier: 1.8 },\r\n                    onStatic: { multiplier: 1.4 }\r\n                },\r\n                frequencySync: { multiplier: 1.3 },\r\n                melodicResponse: { multiplier: 2.2 }\r\n            },\r\n            piano: {\r\n                // Gentle, subtle waves\r\n                amplitudeSync: { \r\n                    onWave: { multiplier: 0.6 },\r\n                    onStatic: { multiplier: 0.4 }\r\n                },\r\n                frequencySync: { multiplier: 0.7 },\r\n                melodicResponse: { multiplier: 1.1 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        // Calculate initial position relative to center\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        const angle = Math.atan2(dy, dx);\r\n        const radius = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        // Random direction for wave motion\r\n        const direction = Math.random() < 0.5 ? 1 : -1;\r\n        \r\n        particle.gestureData.wave = {\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            baseOpacity: particle.opacity || particle.life || 1,\r\n            angle: angle,\r\n            radius: radius,\r\n            offset: Math.random() * Math.PI * 2, // Random phase offset\r\n            role: Math.random(), // 0-1 for variation\r\n            direction: direction, // Random wave direction\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply wave motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.wave?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.wave;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = motion.strength || 1.0;\r\n        \r\n        // Apply easing to progress\r\n        const easeProgress = this.easeInOutSine(progress);\r\n        \r\n        // Add phase shift based on particle role (creates wave effect)\r\n        const phaseShift = data.role * config.phaseShift;\r\n        const adjustedPhase = Math.max(0, easeProgress - phaseShift);\r\n        \r\n        // Calculate infinity pattern (lemniscate) with direction\r\n        const t = adjustedPhase * Math.PI * 2 * config.frequency * data.direction + data.offset;\r\n        \r\n        // Scale amplitude based on distance from center\r\n        const radiusFactor = 0.5 + (data.radius / 100) * 0.5;\r\n        const amplitude = config.amplitude * radiusFactor * strength * particle.scaleFactor;\r\n        \r\n        // Infinity pattern equations\r\n        const infinityX = Math.sin(t) * amplitude;\r\n        const infinityY = Math.sin(t * 2) * amplitude * 0.3; // Smaller vertical component\r\n        \r\n        // Add vertical lift effect\r\n        const lift = -Math.abs(Math.sin(easeProgress * Math.PI)) * config.liftHeight * particle.scaleFactor;\r\n        \r\n        // Calculate target position\r\n        const targetX = centerX + infinityX;\r\n        const targetY = centerY + infinityY + lift;\r\n        \r\n        // Smooth movement with role-based variation\r\n        const smoothness = config.smoothness + data.role * 0.12;\r\n        \r\n        // Apply position with smoothing\r\n        particle.x += (targetX - particle.x) * smoothness;\r\n        particle.y += (targetY - particle.y) * smoothness;\r\n        \r\n        // Set velocity for trails\r\n        particle.vx = (targetX - particle.x) * 0.3;\r\n        particle.vy = (targetY - particle.y) * 0.3;\r\n        \r\n        // Apply fade effect if enabled\r\n        if (config.fadeInOut) {\r\n            let fadeFactor;\r\n            \r\n            if (adjustedPhase < 0.1) {\r\n                // Fade in\r\n                fadeFactor = adjustedPhase / 0.1;\r\n            } else if (adjustedPhase > 0.9) {\r\n                // Fade out\r\n                fadeFactor = (1 - adjustedPhase) / 0.1;\r\n            } else {\r\n                // Full opacity with sine variation\r\n                fadeFactor = 0.5 + Math.sin(adjustedPhase * Math.PI) * 0.5;\r\n            }\r\n            \r\n            particle.opacity = data.baseOpacity * (0.3 + fadeFactor * 0.7);\r\n            \r\n            // Update life for particles that use it instead of opacity\r\n            if (particle.life !== undefined) {\r\n                particle.life = particle.opacity;\r\n            }\r\n        }\r\n        \r\n        // Smooth ending\r\n        if (progress >= 0.95) {\r\n            const endFactor = (1 - progress) * 20;\r\n            particle.vx = particle.vx * endFactor + data.originalVx * (1 - endFactor);\r\n            particle.vy = particle.vy * endFactor + data.originalVy * (1 - endFactor);\r\n            \r\n            // Restore opacity\r\n            if (config.fadeInOut) {\r\n                particle.opacity = data.baseOpacity * endFactor;\r\n                if (particle.life !== undefined) {\r\n                    particle.life = particle.opacity;\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.wave) {\r\n            const data = particle.gestureData.wave;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            particle.opacity = data.baseOpacity;\r\n            if (particle.life !== undefined) {\r\n                particle.life = data.baseOpacity;\r\n            }\r\n            delete particle.gestureData.wave;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Sine easing for smooth wave motion\r\n     * @param {number} t - Progress (0-1)\r\n     * @returns {number} Eased value\r\n     */\r\n    easeInOutSine: function(t) {\r\n        return -(Math.cos(Math.PI * t) - 1) / 2;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Drift Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Drift gesture - controlled floating motion\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/drift\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a dreamy drifting effect where particles float outward then return home.  \r\n * ║ This is an OVERRIDE gesture with smooth, controlled movement and fading effects.  \r\n * ║ Perfect for transitions, sleepy states, or ethereal moments.                      \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *    Start         Drift Out        Hold         Return\r\n *      ⭐           · · ⭐           · · ·          ⭐\r\n *     ⭐⭐    →    · ⭐ · ⭐    →   · · · ·    →   ⭐⭐\r\n *      ⭐           ⭐ · ·           · · ·          ⭐\r\n *   (grouped)     (spread)        (faded)      (regrouped)\r\n * \r\n * USED BY:\r\n * - Sleepy/drowsy states\r\n * - Dreamy transitions\r\n * - Dispersal effects\r\n * - Meditation/calm states\r\n */\r\n\r\n/**\r\n * Drift gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'drift',\r\n    emoji: '☁️',\r\n    type: 'override', // Completely replaces motion\r\n    description: 'Controlled floating with fade effects',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 800,         // Animation duration\r\n        distance: 50,          // Maximum drift distance\r\n        angle: 45,             // Primary drift direction\r\n        returnToOrigin: true,  // Return to starting position\r\n        fadeOut: false,        // Apply fade effect during drift (disabled to prevent disappearing)\r\n        holdTime: 0.2,         // Pause duration at drift peak\r\n        turbulence: 0.1,       // Random movement variation amount\r\n        angleSpread: 45,       // Directional spread range\r\n        smoothness: 0.08,      // Movement fluidity factor\r\n        easing: 'ease',        // Animation curve type\r\n        strength: 1.0,         // Overall drift intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'drift',\r\n            strength: 1.0,     // Drift motion strength\r\n            distance: 60       // Maximum drift distance\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - ethereal drift following ambient musical textures\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'ambient',  // Sync to ambient musical textures\r\n        \r\n        // Distance varies with musical dynamics\r\n        distanceSync: {\r\n            quiet: 30,            // Small drift in quiet sections\r\n            loud: 80,             // Large drift in loud sections\r\n            crescendo: 'expand',  // Expand drift on crescendos\r\n            diminuendo: 'contract' // Contract drift on diminuendos\r\n        },\r\n        \r\n        // Angle follows harmonic progression\r\n        angleSync: {\r\n            major: 45,            // Upward drift in major keys\r\n            minor: 225,           // Downward drift in minor keys\r\n            modulation: 'smooth', // Smooth angle changes\r\n            cadence: 'return'     // Return to center on cadences\r\n        },\r\n        \r\n        // Hold time syncs to phrase length\r\n        holdSync: {\r\n            shortPhrase: 0.1,     // Brief hold for short phrases\r\n            longPhrase: 0.4,      // Extended hold for long phrases\r\n            fermata: 'sustain'    // Sustain hold on fermatas\r\n        },\r\n        \r\n        // Gentle accent response\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 1.3,      // Subtle drift increase on accents\r\n            type: 'distance'      // Accent affects drift distance\r\n        },\r\n        \r\n        // Pattern-specific drift styles\r\n        patternOverrides: {\r\n            'ambient': {\r\n                // Slow, ethereal drifting\r\n                distanceSync: { quiet: 40, loud: 100 },\r\n                holdSync: { shortPhrase: 0.3, longPhrase: 0.6 }\r\n            },\r\n            'classical': {\r\n                // Elegant, controlled drifting\r\n                angleSync: { major: 30, minor: 210 },\r\n                distanceSync: { quiet: 25, loud: 60 }\r\n            },\r\n            'jazz': {\r\n                // Syncopated, unpredictable drifting\r\n                angleSync: { \r\n                    major: 60, \r\n                    minor: 240,\r\n                    swing: true,\r\n                    syncopated: true\r\n                }\r\n            },\r\n            'new_age': {\r\n                // Meditative, flowing drift\r\n                distanceSync: { quiet: 35, loud: 70 },\r\n                holdSync: { shortPhrase: 0.4, longPhrase: 0.8 },\r\n                angleSync: { modulation: 'gradual' }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics variations\r\n        dynamics: {\r\n            forte: {\r\n                // Expansive, bold drifting\r\n                distanceSync: { \r\n                    quiet: { multiplier: 1.5 },\r\n                    loud: { multiplier: 1.8 }\r\n                },\r\n                holdSync: { multiplier: 1.2 },\r\n                accentResponse: { multiplier: 1.6 }\r\n            },\r\n            piano: {\r\n                // Delicate, subtle drifting\r\n                distanceSync: { \r\n                    quiet: { multiplier: 0.6 },\r\n                    loud: { multiplier: 0.8 }\r\n                },\r\n                holdSync: { multiplier: 0.8 },\r\n                accentResponse: { multiplier: 1.1 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        // Calculate drift direction\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        let driftAngle = Math.atan2(dy, dx);\r\n        \r\n        // Add some spread to the drift angle\r\n        const config = { ...this.config, ...motion };\r\n        const spreadRad = (config.angleSpread * Math.PI / 180);\r\n        const angleOffset = (Math.random() - 0.5) * spreadRad;\r\n        driftAngle += angleOffset;\r\n        \r\n        // Determine home position (closer to center)\r\n        const homeRadius = 30 + Math.random() * 30;\r\n        \r\n        particle.gestureData.drift = {\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy,\r\n            baseOpacity: particle.opacity || particle.life || 1,\r\n            driftAngle: driftAngle,\r\n            angleOffset: angleOffset,\r\n            homeRadius: homeRadius * particle.scaleFactor,\r\n            homeX: centerX + Math.cos(driftAngle) * homeRadius,\r\n            homeY: centerY + Math.sin(driftAngle) * homeRadius,\r\n            role: Math.random(), // 0-1 for timing variation\r\n            turbulencePhase: Math.random() * Math.PI * 2,\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply drift motion to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.drift?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.drift;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = motion.strength || 1.0;\r\n        \r\n        // Apply easing\r\n        const easeProgress = this.easeInOutCubic(progress);\r\n        \r\n        // Add role-based phase shift for staggered movement\r\n        const adjustedPhase = Math.max(0, easeProgress - data.role * 0.1);\r\n        \r\n        let targetX, targetY;\r\n        let currentRadius;\r\n        \r\n        // Determine phase of drift\r\n        if (!config.returnToOrigin) {\r\n            // Simple outward drift\r\n            const driftProgress = adjustedPhase;\r\n            currentRadius = data.homeRadius + driftProgress * config.distance * strength * particle.scaleFactor;\r\n            \r\n        } else if (adjustedPhase < 0.4) {\r\n            // Phase 1: Move to home position\r\n            const homeProgress = adjustedPhase / 0.4;\r\n            const easedHome = this.easeOutQuad(homeProgress);\r\n            targetX = data.startX + (data.homeX - data.startX) * easedHome;\r\n            targetY = data.startY + (data.homeY - data.startY) * easedHome;\r\n            \r\n        } else if (adjustedPhase < 0.6 + config.holdTime) {\r\n            // Phase 2: Drift outward\r\n            const driftPhase = (adjustedPhase - 0.4) / (0.2 + config.holdTime);\r\n            currentRadius = data.homeRadius + \r\n                Math.sin(driftPhase * Math.PI * 0.5) * config.distance * strength * particle.scaleFactor;\r\n            \r\n        } else {\r\n            // Phase 3: Return to origin\r\n            const returnPhase = (adjustedPhase - 0.6 - config.holdTime) / (0.4 - config.holdTime);\r\n            currentRadius = data.homeRadius + \r\n                Math.cos(returnPhase * Math.PI * 0.5) * config.distance * strength * particle.scaleFactor;\r\n        }\r\n        \r\n        // Calculate position with turbulence\r\n        if (currentRadius !== undefined) {\r\n            // Add turbulence\r\n            data.turbulencePhase += config.turbulence * dt;\r\n            const turbulenceX = Math.sin(data.turbulencePhase) * config.turbulence * 10;\r\n            const turbulenceY = Math.cos(data.turbulencePhase * 1.3) * config.turbulence * 10;\r\n            \r\n            const angle = data.driftAngle + data.angleOffset;\r\n            targetX = centerX + Math.cos(angle) * currentRadius + turbulenceX;\r\n            targetY = centerY + Math.sin(angle) * currentRadius + turbulenceY;\r\n        }\r\n        \r\n        // Smooth movement with role variation\r\n        const smoothness = config.smoothness + data.role * 0.08;\r\n        particle.x += (targetX - particle.x) * smoothness;\r\n        particle.y += (targetY - particle.y) * smoothness;\r\n        \r\n        // Set velocity for trails\r\n        particle.vx = (targetX - particle.x) * 0.25;\r\n        particle.vy = (targetY - particle.y) * 0.25;\r\n        \r\n        // Apply fade effect\r\n        if (config.fadeOut) {\r\n            let fadeFactor;\r\n            \r\n            if (progress < 0.25) {\r\n                // Fade in\r\n                fadeFactor = 0.3 + (progress / 0.25) * 0.7;\r\n            } else if (progress < 0.75) {\r\n                // Main phase with sine variation\r\n                fadeFactor = 0.7 + Math.sin((progress - 0.25) * Math.PI / 0.5) * 0.3;\r\n            } else {\r\n                // Fade back\r\n                fadeFactor = (1 - progress) * 4;\r\n            }\r\n            \r\n            particle.opacity = data.baseOpacity * fadeFactor;\r\n            if (particle.life !== undefined) {\r\n                particle.life = particle.opacity;\r\n            }\r\n        }\r\n        \r\n        // Clean ending\r\n        if (progress >= 0.99) {\r\n            particle.vx = data.originalVx * 0.1;\r\n            particle.vy = data.originalVy * 0.1;\r\n            \r\n            if (config.fadeOut) {\r\n                particle.opacity = data.baseOpacity;\r\n                if (particle.life !== undefined) {\r\n                    particle.life = data.baseOpacity;\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.drift) {\r\n            const data = particle.gestureData.drift;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            particle.opacity = data.baseOpacity;\r\n            if (particle.life !== undefined) {\r\n                particle.life = data.baseOpacity;\r\n            }\r\n            delete particle.gestureData.drift;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Easing functions\r\n     */\r\n    easeInOutCubic: function(t) {\r\n        return t < 0.5 \r\n            ? 4 * t * t * t \r\n            : 1 - Math.pow(-2 * t + 2, 3) / 2;\r\n    },\r\n    \r\n    easeOutQuad: function(t) {\r\n        return t * (2 - t);\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Flicker Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Flicker gesture - opacity and motion variation\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/flicker\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a flickering effect with rapid opacity changes and subtle motion jitter.  \r\n * ║ This is a BLENDING gesture that adds visual instability, perfect for glitches,   \r\n * ║ electrical effects, or nervous energy.                                            \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *    Frame 1      Frame 2      Frame 3      Frame 4\r\n *      ⭐          ·⭐·         ⭐⭐⭐         ·⭐\r\n *    (100%)       (30%)        (120%)        (50%)\r\n *    normal       dimmed       bright        partial\r\n * \r\n * USED BY:\r\n * - Glitch/digital effects\r\n * - Electrical sparks\r\n * - Nervous/unstable states\r\n * - Teleportation effects\r\n * - Broken/malfunctioning states\r\n */\r\n\r\n/**\r\n * Flicker gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'flicker',\r\n    emoji: '⚡',\r\n    type: 'blending', // Adds to existing motion\r\n    description: 'Rapid opacity changes with motion jitter',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 800,         // Animation duration\r\n        flickerRate: 15,       // Flicker speed\r\n        frequency: 6,          // Flicker count\r\n        minOpacity: 0.3,       // Minimum visibility\r\n        maxOpacity: 1.0,       // Maximum visibility\r\n        jitterAmount: 2,       // Position wobble range\r\n        colorShift: false,     // Enable hue variation\r\n        strobe: false,         // Regular vs random pattern\r\n        pulseMode: false,      // Smooth vs sharp transitions\r\n        groupFlicker: 0.3,     // Group synchronization probability\r\n        easing: 'linear',      // Animation curve type\r\n        strength: 0.7,         // Overall effect intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'flicker',\r\n            strength: 0.7,     // Particle flicker strength\r\n            frequency: 6       // Particle flicker rate\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - flicker syncs to subdivisions\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'subdivision',  // Flicker on subdivisions\r\n        \r\n        // Flicker rate syncs to tempo\r\n        rateSync: {\r\n            subdivision: 'sixteenth',  // Flicker on 16th notes\r\n            onBeat: 30,               // Rapid flicker on beat\r\n            offBeat: 10,              // Slower between beats\r\n            triplet: 20,              // Medium on triplets\r\n            curve: 'step'             // Instant changes\r\n        },\r\n        \r\n        // Opacity patterns with rhythm\r\n        opacitySync: {\r\n            pattern: 'HLMH',          // High-Low-Medium-High\r\n            subdivision: 'eighth',     // Pattern rate\r\n            onAccent: 0.1,           // Nearly off on accent (dramatic)\r\n            regular: 0.5              // Medium normally\r\n        },\r\n        \r\n        // Jitter amount varies\r\n        jitterSync: {\r\n            onBeat: 5,                // Big jitter on beat\r\n            offBeat: 1,               // Minimal between\r\n            accent: 10,               // Extreme on accent\r\n            curve: 'random'           // Chaotic motion\r\n        },\r\n        \r\n        // Strobe modes\r\n        strobeSync: {\r\n            verse: false,             // No strobe in verse\r\n            chorus: true,             // Strobe in chorus\r\n            drop: 'intense',          // Intense strobe on drop\r\n            pattern: 'XOXO'          // Strobe pattern\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: { flickerRate: 25, jitterAmount: 5, minOpacity: 0.1 },\r\n            piano: { flickerRate: 8, jitterAmount: 1, minOpacity: 0.5 }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     */\r\n    initialize: function(particle, motion) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        const config = { ...this.config, ...motion };\r\n        \r\n        // Determine if this particle is part of a synchronized group\r\n        const isGrouped = Math.random() < config.groupFlicker;\r\n        \r\n        particle.gestureData.flicker = {\r\n            baseOpacity: particle.opacity || particle.life || 1,\r\n            baseColor: particle.color,\r\n            baseX: particle.x,\r\n            baseY: particle.y,\r\n            flickerTimer: 0,\r\n            lastFlicker: 0,\r\n            flickerState: true,\r\n            isGrouped: isGrouped,\r\n            groupId: isGrouped ? Math.floor(Math.random() * 3) : -1, // Assign to flicker group\r\n            phase: Math.random() * Math.PI * 2,  // Random phase offset\r\n            colorHue: 0,\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply flicker effect to particle\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.flicker?.initialized) {\r\n            this.initialize(particle, motion);\r\n        }\r\n        \r\n        const data = particle.gestureData.flicker;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = motion.strength || 1.0;\r\n        \r\n        // Update flicker timer\r\n        data.flickerTimer += dt * config.flickerRate;\r\n        \r\n        // Calculate opacity based on mode\r\n        let opacityMultiplier;\r\n        \r\n        if (config.strobe) {\r\n            // Strobe pattern - regular on/off\r\n            const strobePhase = (data.flickerTimer + data.phase) % 1;\r\n            opacityMultiplier = strobePhase < 0.5 ? 1 : config.minOpacity;\r\n            \r\n        } else if (config.pulseMode) {\r\n            // Smooth pulsing\r\n            const pulsePhase = data.flickerTimer + data.phase;\r\n            opacityMultiplier = config.minOpacity + \r\n                (config.maxOpacity - config.minOpacity) * (Math.sin(pulsePhase) * 0.5 + 0.5);\r\n            \r\n        } else {\r\n            // Random flicker\r\n            if (data.flickerTimer - data.lastFlicker > 1) {\r\n                data.lastFlicker = data.flickerTimer;\r\n                \r\n                // Group flicker logic\r\n                if (data.isGrouped) {\r\n                    // Flicker based on group timing\r\n                    const groupPhase = Math.floor(data.flickerTimer) % 3;\r\n                    data.flickerState = groupPhase === data.groupId;\r\n                } else {\r\n                    // Individual random flicker\r\n                    data.flickerState = Math.random() > 0.3;\r\n                }\r\n            }\r\n            \r\n            // Calculate target opacity\r\n            const targetOpacity = data.flickerState ? \r\n                config.maxOpacity : \r\n                config.minOpacity + Math.random() * 0.3;\r\n            \r\n            // Smooth transition for less harsh flicker\r\n            const currentOpacity = particle.opacity / data.baseOpacity;\r\n            opacityMultiplier = currentOpacity + (targetOpacity - currentOpacity) * 0.3;\r\n        }\r\n        \r\n        // Apply opacity with strength\r\n        const finalOpacity = data.baseOpacity * (1 + (opacityMultiplier - 1) * strength);\r\n        particle.opacity = Math.max(0, Math.min(1, finalOpacity)); // Clamp to 0-1\r\n        \r\n        // Update life if used instead of opacity\r\n        if (particle.life !== undefined) {\r\n            particle.life = particle.opacity;\r\n        }\r\n        \r\n        // Apply position jitter\r\n        if (config.jitterAmount > 0 && opacityMultiplier > config.minOpacity) {\r\n            const jitter = config.jitterAmount * strength * particle.scaleFactor;\r\n            const jitterX = (Math.random() - 0.5) * jitter * opacityMultiplier;\r\n            const jitterY = (Math.random() - 0.5) * jitter * opacityMultiplier;\r\n            \r\n            particle.vx += jitterX * 0.1 * dt;\r\n            particle.vy += jitterY * 0.1 * dt;\r\n        }\r\n        \r\n        // Apply color shift if enabled\r\n        if (config.colorShift && particle.color) {\r\n            data.colorHue += 0.01 * dt;\r\n            const hueShift = Math.sin(data.colorHue) * 30; // ±30 degree hue shift\r\n            particle.color = this.shiftHue(data.baseColor, hueShift * strength);\r\n        }\r\n        \r\n        // Smooth fade in/out at gesture boundaries\r\n        let fadeFactor = 1;\r\n        if (progress < 0.1) {\r\n            fadeFactor = progress / 0.1;  // Fade in\r\n        } else if (progress > 0.9) {\r\n            fadeFactor = (1 - progress) / 0.1;  // Fade out\r\n        }\r\n        \r\n        particle.opacity *= fadeFactor;\r\n        if (particle.life !== undefined) {\r\n            particle.life = particle.opacity;\r\n        }\r\n        \r\n        // Dampen velocity slightly for stability\r\n        if (progress > 0.8) {\r\n            particle.vx *= 0.95;\r\n            particle.vy *= 0.95;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Shift the hue of a color\r\n     * @param {string} color - Hex color string\r\n     * @param {number} degrees - Degrees to shift hue\r\n     * @returns {string} New hex color\r\n     */\r\n    shiftHue: function(color, degrees) {\r\n        // Simple hue shift implementation\r\n        // In production, use a proper color library\r\n        if (!color || !color.startsWith('#')) return color;\r\n        \r\n        // Convert hex to RGB\r\n        const hex = color.slice(1);\r\n        const r = parseInt(hex.substr(0, 2), 16) / 255;\r\n        const g = parseInt(hex.substr(2, 2), 16) / 255;\r\n        const b = parseInt(hex.substr(4, 2), 16) / 255;\r\n        \r\n        // Simple hue rotation (approximate)\r\n        const hueRad = degrees * Math.PI / 180;\r\n        const cos = Math.cos(hueRad);\r\n        const sin = Math.sin(hueRad);\r\n        \r\n        // Rotate around luminance axis (simplified)\r\n        const newR = r * cos - g * sin;\r\n        const newG = r * sin + g * cos;\r\n        const newB = b;\r\n        \r\n        // Convert back to hex\r\n        const toHex = (n) => {\r\n            const val = Math.max(0, Math.min(255, Math.round(n * 255)));\r\n            return val.toString(16).padStart(2, '0');\r\n        };\r\n        \r\n        return '#' + toHex(newR) + toHex(newG) + toHex(newB);\r\n    },\r\n    \r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.flicker) {\r\n            const data = particle.gestureData.flicker;\r\n            particle.opacity = data.baseOpacity;\r\n            particle.color = data.baseColor;\r\n            if (particle.life !== undefined) {\r\n                particle.life = data.baseOpacity;\r\n            }\r\n            delete particle.gestureData.flicker;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Burst Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Burst gesture - explosive outward motion\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/burst\r\n */\r\n\r\nexport default {\r\n    name: 'burst',\r\n    emoji: '💥',\r\n    type: 'blending',\r\n    description: 'Explosive outward burst from center',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        decay: 0.5,      // Force reduction over time\r\n        strength: 2.0    // Initial explosion intensity\r\n    },\r\n    \r\n    // Rhythm configuration - explosive bursts on strong beats\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',  // Burst on strong beats and accents\r\n        \r\n        // Strength syncs to beat intensity\r\n        strengthSync: {\r\n            onBeat: 3.5,          // Powerful burst on beats\r\n            offBeat: 1.0,         // Gentle burst off-beat\r\n            curve: 'explosion'    // Sharp attack, rapid decay\r\n        },\r\n        \r\n        // Decay rate responds to tempo\r\n        decaySync: {\r\n            mode: 'tempo',\r\n            fast: 0.8,            // Quick decay for fast songs\r\n            slow: 0.3,            // Slow decay for slow songs\r\n            curve: 'exponential'\r\n        },\r\n        \r\n        // Duration matches beat timing\r\n        durationSync: {\r\n            mode: 'beats',\r\n            beats: 0.5,           // Half-beat burst duration\r\n            sustain: false        // No sustain, pure burst\r\n        },\r\n        \r\n        // Strong response to accents\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 2.5,      // Massive burst on accents\r\n            type: 'strength'      // Accent affects burst power\r\n        },\r\n        \r\n        // Pattern-specific burst styles\r\n        patternOverrides: {\r\n            'rock': {\r\n                // Heavy, aggressive bursts\r\n                strengthSync: { onBeat: 4.0, offBeat: 1.5 },\r\n                decaySync: { fast: 0.6, slow: 0.4 }\r\n            },\r\n            'electronic': {\r\n                // Sharp, precise bursts\r\n                strengthSync: { onBeat: 3.8, offBeat: 0.8, curve: 'sharp' },\r\n                decaySync: { fast: 0.9, slow: 0.7 }\r\n            },\r\n            'jazz': {\r\n                // Syncopated, varied bursts\r\n                strengthSync: { \r\n                    onBeat: 2.8, \r\n                    offBeat: 1.8,  // Strong off-beat emphasis\r\n                    swing: true \r\n                },\r\n                decaySync: { fast: 0.5, slow: 0.2 }\r\n            },\r\n            'orchestral': {\r\n                // Dynamic, expressive bursts\r\n                strengthSync: { onBeat: 3.2, offBeat: 0.5 },\r\n                accentResponse: { multiplier: 3.0 }  // Very responsive to dynamics\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics variations\r\n        dynamics: {\r\n            forte: {\r\n                // Explosive, powerful bursts\r\n                strengthSync: { \r\n                    onBeat: { multiplier: 2.0 },\r\n                    offBeat: { multiplier: 1.5 }\r\n                },\r\n                decaySync: { multiplier: 0.7 },  // Slower decay for impact\r\n                accentResponse: { multiplier: 3.5 }\r\n            },\r\n            piano: {\r\n                // Subtle, gentle bursts\r\n                strengthSync: { \r\n                    onBeat: { multiplier: 0.6 },\r\n                    offBeat: { multiplier: 0.3 }\r\n                },\r\n                decaySync: { multiplier: 1.3 },  // Faster decay for gentleness\r\n                accentResponse: { multiplier: 1.8 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Apply explosive burst motion to particle\r\n     * Pushes particles radially outward with decaying force\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Calculate force decay over gesture duration\r\n        const decay = motion.decay || this.config.decay;\r\n        const strength = (motion.strength || this.config.strength) * (1 - progress * decay);\r\n        \r\n        // Calculate direction from center to particle\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        \r\n        // Apply outward force if particle isn't at center\r\n        if (distance > 1) {\r\n            // Normalize direction and apply explosive force\r\n            particle.vx += (dx / distance) * strength * 2 * dt;\r\n            particle.vy += (dy / distance) * strength * 2 * dt;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Directional Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Directional gesture - move particles in specific direction\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/directional\r\n */\r\n\r\nexport default {\r\n    name: 'directional',\r\n    emoji: '➡️',\r\n    type: 'blending',\r\n    description: 'Move particles in a specific direction',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        angle: 0,                // Movement direction in degrees\r\n        returnToOrigin: false,   // Whether particles return to start\r\n        strength: 1.0           // Force intensity\r\n    },\r\n    \r\n    // Rhythm configuration - directional movement following musical flow\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'flow',  // Follow musical flow and direction\r\n        \r\n        // Direction changes with musical progression\r\n        angleSync: {\r\n            verse: 0,             // Right movement in verses\r\n            chorus: 90,           // Upward movement in choruses  \r\n            bridge: 180,          // Left movement in bridges\r\n            outro: 270,           // Downward movement in outros\r\n            transition: 'smooth'  // Smooth direction changes\r\n        },\r\n        \r\n        // Strength pulses with rhythm\r\n        strengthSync: {\r\n            onBeat: 1.8,          // Strong push on beats\r\n            offBeat: 0.6,         // Gentle drift off-beat\r\n            curve: 'wave'         // Wave-like motion curve\r\n        },\r\n        \r\n        // Return motion syncs to musical sections\r\n        returnSync: {\r\n            enabled: true,\r\n            onSectionChange: true, // Return on section changes\r\n            duration: 'transition', // Use transition timing\r\n            strength: 1.2\r\n        },\r\n        \r\n        // Accent response affects direction\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 2.0,      // Sharp directional push on accents\r\n            type: 'strength'      // Accent affects movement force\r\n        },\r\n        \r\n        // Pattern-specific directional styles\r\n        patternOverrides: {\r\n            'march': {\r\n                // Military-style directional movement\r\n                angleSync: { verse: 0, chorus: 0 }, // Always forward\r\n                strengthSync: { onBeat: 2.5, offBeat: 1.0 }\r\n            },\r\n            'waltz': {\r\n                // Flowing, circular directional movement\r\n                angleSync: { \r\n                    verse: 45, \r\n                    chorus: 135,\r\n                    bridge: 225,\r\n                    outro: 315,\r\n                    transition: 'circular'\r\n                }\r\n            },\r\n            'swing': {\r\n                // Syncopated directional swaying\r\n                strengthSync: { \r\n                    onBeat: 1.6, \r\n                    offBeat: 1.4,  // Strong off-beat emphasis\r\n                    swing: true \r\n                }\r\n            },\r\n            'electronic': {\r\n                // Sharp, precise directional cuts\r\n                angleSync: { transition: 'instant' },\r\n                strengthSync: { onBeat: 2.2, offBeat: 0.4, curve: 'sharp' }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics variations\r\n        dynamics: {\r\n            forte: {\r\n                // Powerful, decisive direction changes\r\n                strengthSync: { \r\n                    onBeat: { multiplier: 1.6 },\r\n                    offBeat: { multiplier: 1.2 }\r\n                },\r\n                angleSync: { transition: 'sharp' },\r\n                accentResponse: { multiplier: 2.5 }\r\n            },\r\n            piano: {\r\n                // Gentle, subtle directional drift\r\n                strengthSync: { \r\n                    onBeat: { multiplier: 0.7 },\r\n                    offBeat: { multiplier: 0.8 }\r\n                },\r\n                angleSync: { transition: 'gradual' },\r\n                accentResponse: { multiplier: 1.4 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize directional movement data\r\n     * Stores particle's starting position for return motion\r\n     */\r\n    initialize: function(particle) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        particle.gestureData.directional = {\r\n            initialX: particle.x,\r\n            initialY: particle.y\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply directional force to particle\r\n     * Pushes particles in specified direction with optional return\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.directional) {\r\n            this.initialize(particle);\r\n        }\r\n        \r\n        // Convert angle to radians for calculation\r\n        const angle = (motion.angle || this.config.angle) * Math.PI / 180;\r\n        const strength = motion.strength || this.config.strength;\r\n        \r\n        // Apply directional force\r\n        particle.vx += Math.cos(angle) * strength * 0.3 * dt;\r\n        particle.vy += Math.sin(angle) * strength * 0.3 * dt;\r\n        \r\n        // Optional return motion in second half of gesture\r\n        if (motion.returnToOrigin && progress > 0.5) {\r\n            const returnProgress = (progress - 0.5) * 2;\r\n            const data = particle.gestureData.directional;\r\n            // Calculate return force toward initial position\r\n            const dx = data.initialX - particle.x;\r\n            const dy = data.initialY - particle.y;\r\n            particle.vx += dx * returnProgress * 0.02 * dt;\r\n            particle.vy += dy * returnProgress * 0.02 * dt;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Settle Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Settle gesture - gradually reduce velocity\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/settle\r\n */\r\n\r\nexport default {\r\n    name: 'settle',\r\n    emoji: '🍃',\r\n    type: 'blending',\r\n    description: 'Gradually settle particles to rest',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        damping: 0.02,     // Velocity reduction rate\r\n        threshold: 0.01    // Minimum velocity before stop\r\n    },\r\n    \r\n    // Rhythm configuration - gradual settling synchronized to musical resolution\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'resolution', // Settle during chord resolutions and phrase endings\r\n        \r\n        // Damping rate responds to musical tension/release\r\n        dampingSync: {\r\n            onResolution: 0.035,    // Faster settling on resolution\r\n            onTension: 0.015,       // Slower settling during tension\r\n            curve: 'gradual'        // Smooth, natural decay\r\n        },\r\n        \r\n        // Threshold adapts to dynamic level\r\n        thresholdSync: {\r\n            mode: 'dynamics',\r\n            forte: 0.02,            // Higher threshold for loud music\r\n            piano: 0.005,           // Lower threshold for quiet music\r\n            curve: 'exponential'\r\n        },\r\n        \r\n        // Duration follows musical phrase structure\r\n        durationSync: {\r\n            mode: 'phrase',\r\n            minBeats: 2,            // Minimum 2-beat settling\r\n            maxBeats: 12,           // Maximum phrase-length settling\r\n            sustain: true           // Maintain settling through resolution\r\n        },\r\n        \r\n        // Response to cadential movements\r\n        cadenceResponse: {\r\n            enabled: true,\r\n            multiplier: 1.6,        // Enhanced settling on cadences\r\n            type: 'damping'         // Affects settling rate\r\n        },\r\n        \r\n        // Style variations for different music types\r\n        patternOverrides: {\r\n            'ambient': {\r\n                // Slow, atmospheric settling\r\n                dampingSync: { onResolution: 0.025, onTension: 0.008, curve: 'atmospheric' },\r\n                durationSync: { minBeats: 8, maxBeats: 32 }\r\n            },\r\n            'jazz': {\r\n                // Smooth settling with swing feel\r\n                dampingSync: { onResolution: 0.040, onTension: 0.020 },\r\n                cadenceResponse: { multiplier: 1.8 }\r\n            },\r\n            'classical': {\r\n                // Expressive settling following harmonic rhythm\r\n                dampingSync: { onResolution: 0.045, onTension: 0.012, curve: 'expressive' },\r\n                cadenceResponse: { multiplier: 2.0 }\r\n            },\r\n            'minimalist': {\r\n                // Very gradual, meditative settling\r\n                dampingSync: { onResolution: 0.020, onTension: 0.005 },\r\n                durationSync: { minBeats: 16, maxBeats: 64 }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: {\r\n                // Decisive, clear settling\r\n                dampingSync: { \r\n                    onResolution: { multiplier: 1.4 },\r\n                    onTension: { multiplier: 0.8 }\r\n                },\r\n                thresholdSync: { multiplier: 2.0 },\r\n                cadenceResponse: { multiplier: 2.2 }\r\n            },\r\n            piano: {\r\n                // Gentle, soft settling\r\n                dampingSync: { \r\n                    onResolution: { multiplier: 0.7 },\r\n                    onTension: { multiplier: 1.2 }\r\n                },\r\n                thresholdSync: { multiplier: 0.5 },\r\n                cadenceResponse: { multiplier: 1.3 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Apply settling effect to particle\r\n     * Gradually reduces velocity until particles come to rest\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        const damping = motion.damping || this.config.damping;\r\n        const threshold = motion.threshold || this.config.threshold;\r\n        \r\n        // Apply exponential velocity damping\r\n        particle.vx *= Math.max(0, 1 - damping * dt * 60);\r\n        particle.vy *= Math.max(0, 1 - damping * dt * 60);\r\n        \r\n        // Stop completely when velocity falls below threshold\r\n        if (Math.abs(particle.vx) < threshold) particle.vx = 0;\r\n        if (Math.abs(particle.vy) < threshold) particle.vy = 0;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Breathe Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Breathe gesture - inhale/exhale particle motion\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/breathe\r\n */\r\n\r\nexport default {\r\n    name: 'breathe',\r\n    emoji: '🫁',\r\n    type: 'blending',\r\n    description: 'Breathing rhythm with inhale and exhale',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        // Musical duration - one full breath per bar\r\n        musicalDuration: {\r\n            musical: true,\r\n            bars: 1,           // Default to 1 bar breathing cycle\r\n            minBeats: 2,       // Minimum half bar\r\n            maxBeats: 16       // Maximum 4 bars for slow breathing\r\n        },\r\n        \r\n        // Musical phases of breathing\r\n        phases: [\r\n            { name: 'inhale', beats: 1.5 },     // Inhale phase\r\n            { name: 'hold_in', beats: 0.5 },    // Hold at peak\r\n            { name: 'exhale', beats: 1.5 },     // Exhale phase\r\n            { name: 'hold_out', beats: 0.5 }    // Hold at rest\r\n        ],\r\n        \r\n        inhaleRadius: 1.5,     // Maximum expansion distance\r\n        exhaleRadius: 0.3,     // Minimum contraction distance\r\n        breathRate: 0.3,       // Breathing rhythm speed\r\n        spiralStrength: 0.002, // Subtle spiral motion intensity\r\n        scaleAmount: 0.25,     // Core size variation amount\r\n        glowAmount: 0.4,       // Glow intensity variation\r\n        frequency: 1,          // Number of breath cycles\r\n        easing: 'sine',        // Smooth, natural curve type\r\n        strength: 0.8,         // Overall motion influence\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'breathe',\r\n            strength: 0.8,         // Particle response strength\r\n            inhaleRadius: 1.5,     // Particle expansion limit\r\n            exhaleRadius: 0.3      // Particle contraction limit\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - breathing synced to musical phrases\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'phrase',  // Long breathing cycles across musical phrases\r\n        \r\n        // Breath rate syncs to musical tempo\r\n        breathRateSync: {\r\n            mode: 'tempo',\r\n            bpm: 'auto',          // Match song tempo\r\n            subdivision: 'whole', // Full breaths on whole notes\r\n            curve: 'sine'         // Natural breathing curve\r\n        },\r\n        \r\n        // Inhale/exhale expansion syncs to dynamics\r\n        radiusSync: {\r\n            inhale: {\r\n                onUpbeat: 1.8,    // Deeper inhale on upbeats\r\n                onDownbeat: 1.4,  // Standard inhale on downbeats\r\n                curve: 'ease-in'\r\n            },\r\n            exhale: {\r\n                onUpbeat: 0.2,    // Complete exhale on upbeats\r\n                onDownbeat: 0.4,  // Gentle exhale on downbeats\r\n                curve: 'ease-out'\r\n            }\r\n        },\r\n        \r\n        // Duration matches musical phrasing\r\n        durationSync: {\r\n            mode: 'phrases',\r\n            phrases: 2,           // Breathe across 2 musical phrases\r\n            hold: 'fermata'       // Hold breath on fermatas\r\n        },\r\n        \r\n        // Respond to musical accents\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 1.5,      // Deeper breath on accents\r\n            type: 'expansion'     // Accent affects radius expansion\r\n        },\r\n        \r\n        // Pattern-specific breathing styles\r\n        patternOverrides: {\r\n            'ballad': {\r\n                // Slow, deep breathing for emotional ballads\r\n                breathRateSync: { subdivision: 'double-whole' },\r\n                radiusSync: { \r\n                    inhale: { onUpbeat: 2.2, onDownbeat: 1.8 },\r\n                    exhale: { onUpbeat: 0.1, onDownbeat: 0.2 }\r\n                }\r\n            },\r\n            'uptempo': {\r\n                // Quick, energetic breathing\r\n                breathRateSync: { subdivision: 'half' },\r\n                radiusSync: { \r\n                    inhale: { onUpbeat: 1.4, onDownbeat: 1.2 },\r\n                    exhale: { onUpbeat: 0.3, onDownbeat: 0.4 }\r\n                }\r\n            },\r\n            'ambient': {\r\n                // Ethereal, floating breathing\r\n                breathRateSync: { subdivision: 'whole', curve: 'ease' },\r\n                radiusSync: { \r\n                    inhale: { onUpbeat: 1.6, onDownbeat: 1.6 },\r\n                    exhale: { onUpbeat: 0.2, onDownbeat: 0.2 }\r\n                }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics variations\r\n        dynamics: {\r\n            forte: {\r\n                // Powerful, deep breathing\r\n                radiusSync: { \r\n                    inhale: { multiplier: 1.8 },\r\n                    exhale: { multiplier: 0.5 }\r\n                },\r\n                spiralStrength: 0.004,  // More spiral motion\r\n                scaleAmount: 0.4\r\n            },\r\n            piano: {\r\n                // Gentle, subtle breathing\r\n                radiusSync: { \r\n                    inhale: { multiplier: 1.2 },\r\n                    exhale: { multiplier: 0.8 }\r\n                },\r\n                spiralStrength: 0.001,  // Minimal spiral\r\n                scaleAmount: 0.1\r\n            }\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize breathing data for a particle\r\n     * Stores particle's starting position and relationship to center\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        // Calculate particle's position relative to orb center\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        \r\n        particle.gestureData.breathe = {\r\n            startX: particle.x,                        // Original X position\r\n            startY: particle.y,                        // Original Y position\r\n            angle: Math.atan2(dy, dx),                // Direction from center\r\n            baseRadius: Math.sqrt(dx * dx + dy * dy), // Distance from center\r\n            phaseOffset: Math.random() * 0.2 - 0.1    // Slight timing variation for organic feel\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply breathing motion to particle\r\n     * Creates expansion/contraction movement synchronized with breath rhythm\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize particle data if needed\r\n        if (!particle.gestureData?.breathe) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.breathe;\r\n        const config = { ...this.config, ...motion };\r\n        \r\n        // Calculate breath phase - creates smooth sine wave between exhale and inhale\r\n        // Result oscillates smoothly between 0 (exhale) and 1 (inhale)\r\n        const breathPhase = (Math.sin(progress * Math.PI * 2 * config.breathRate) + 1) / 2;\r\n        \r\n        // Define breathing boundaries relative to orb size\r\n        // Scale boundaries based on particle's size factor for consistent appearance\r\n        const referenceRadius = 100 * (particle.scaleFactor || 1);\r\n        const inhaleRadius = config.inhaleRadius * referenceRadius;\r\n        const exhaleRadius = config.exhaleRadius * referenceRadius;\r\n        \r\n        // Interpolate target position between exhale and inhale boundaries\r\n        const targetRadius = exhaleRadius + (inhaleRadius - exhaleRadius) * breathPhase;\r\n        \r\n        // Calculate particle's current distance from center\r\n        const currentDx = particle.x - centerX;\r\n        const currentDy = particle.y - centerY;\r\n        const currentRadius = Math.sqrt(currentDx * currentDx + currentDy * currentDy);\r\n        \r\n        // Calculate radial movement needed to reach target breathing position\r\n        const radiusDiff = targetRadius - currentRadius;\r\n        const moveStrength = (motion.strength || 0.8) * 0.05 * dt;\r\n        \r\n        // Apply radial motion (move in/out from center)\r\n        if (currentRadius > 0) {\r\n            // Normalize direction and apply movement\r\n            const moveX = (currentDx / currentRadius) * radiusDiff * moveStrength;\r\n            const moveY = (currentDy / currentRadius) * radiusDiff * moveStrength;\r\n            \r\n            particle.vx += moveX;\r\n            particle.vy += moveY;\r\n            \r\n            // Add organic spiral motion for more natural breathing feel\r\n            // Creates slight circular drift during expansion/contraction\r\n            const spiralStrength = config.spiralStrength * dt * (motion.strength || 1);\r\n            const tangentX = -currentDy / currentRadius;  // Perpendicular to radial direction\r\n            const tangentY = currentDx / currentRadius;\r\n            \r\n            // Spiral motion stronger during inhale, creating expanding spiral\r\n            particle.vx += tangentX * spiralStrength * breathPhase;\r\n            particle.vy += tangentY * spiralStrength * breathPhase;\r\n        }\r\n        \r\n        // Apply velocity damping for smooth, controlled motion\r\n        // Prevents particles from overshooting or oscillating\r\n        particle.vx *= 0.98;\r\n        particle.vy *= 0.98;\r\n    },\r\n    \r\n    /**\r\n     * Clean up breathing data when gesture completes\r\n     * Removes stored data to free memory\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.breathe) {\r\n            delete particle.gestureData.breathe;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Expand Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Expand gesture - particles move outward from center\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/expand\r\n */\r\n\r\nexport default {\r\n    name: 'expand',\r\n    emoji: '💫',\r\n    type: 'blending',\r\n    description: 'Radial expansion from center',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 600,        // Gesture duration\r\n        scaleAmount: 3.0,     // Core scale expansion amount\r\n        scaleTarget: 3.0,     // Target expansion distance ratio\r\n        glowAmount: 0.5,      // Glow intensity increase\r\n        easing: 'back',       // Overshoot animation curve\r\n        strength: 3.0,        // Outward push force intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'pulse',\r\n            strength: 3.0,        // Particle push strength\r\n            direction: 'outward', // Movement away from center\r\n            persist: true         // Maintain expanded position\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - expansive growth synced to musical crescendos\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'crescendo',  // Expand during musical crescendos\r\n        \r\n        // Expansion strength follows dynamics\r\n        strengthSync: {\r\n            pianissimo: 1.5,      // Gentle expansion in quiet sections\r\n            fortissimo: 5.0,      // Massive expansion in loud sections\r\n            crescendo: 'build',   // Gradual build during crescendos\r\n            sforzando: 'burst'    // Sudden expansion on sforzandos\r\n        },\r\n        \r\n        // Scale target responds to musical intensity\r\n        scaleTargetSync: {\r\n            verse: 2.0,           // Moderate expansion in verses\r\n            chorus: 4.5,          // Large expansion in choruses\r\n            climax: 6.0,          // Maximum expansion at climax\r\n            curve: 'exponential'  // Exponential growth curve\r\n        },\r\n        \r\n        // Duration matches musical phrasing\r\n        durationSync: {\r\n            mode: 'phrases',\r\n            build: 1.2,           // Extended duration during builds\r\n            release: 0.8,         // Quick expansion on releases\r\n            sustain: 'hold'       // Hold expansion during sustains\r\n        },\r\n        \r\n        // Strong accent response\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 2.8,      // Massive expansion on accents\r\n            type: 'strength'      // Accent affects expansion force\r\n        },\r\n        \r\n        // Pattern-specific expansion styles\r\n        patternOverrides: {\r\n            'orchestral': {\r\n                // Epic, cinematic expansion\r\n                strengthSync: { \r\n                    pianissimo: 2.0, \r\n                    fortissimo: 6.5,\r\n                    crescendo: 'dramatic'\r\n                },\r\n                scaleTargetSync: { climax: 8.0 }\r\n            },\r\n            'rock': {\r\n                // Aggressive, powerful expansion\r\n                strengthSync: { \r\n                    pianissimo: 1.8, \r\n                    fortissimo: 5.5,\r\n                    curve: 'power'\r\n                },\r\n                accentResponse: { multiplier: 3.2 }\r\n            },\r\n            'ambient': {\r\n                // Gentle, organic expansion\r\n                strengthSync: { \r\n                    pianissimo: 1.2, \r\n                    fortissimo: 3.5,\r\n                    crescendo: 'organic'\r\n                },\r\n                durationSync: { build: 1.8, release: 1.2 }\r\n            },\r\n            'electronic': {\r\n                // Sharp, controlled expansion\r\n                strengthSync: { \r\n                    pianissimo: 1.6, \r\n                    fortissimo: 4.8,\r\n                    curve: 'digital'\r\n                },\r\n                scaleTargetSync: { curve: 'linear' }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics variations\r\n        dynamics: {\r\n            forte: {\r\n                // Powerful, overwhelming expansion\r\n                strengthSync: { \r\n                    pianissimo: { multiplier: 1.4 },\r\n                    fortissimo: { multiplier: 1.8 }\r\n                },\r\n                scaleTargetSync: { multiplier: 1.6 },\r\n                accentResponse: { multiplier: 3.5 }\r\n            },\r\n            piano: {\r\n                // Delicate, controlled expansion\r\n                strengthSync: { \r\n                    pianissimo: { multiplier: 0.8 },\r\n                    fortissimo: { multiplier: 1.2 }\r\n                },\r\n                scaleTargetSync: { multiplier: 0.7 },\r\n                accentResponse: { multiplier: 2.0 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        particle.gestureData.expand = {\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            angle: Math.atan2(dy, dx),\r\n            baseRadius: Math.sqrt(dx * dx + dy * dy),\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply expansion motion to particle\r\n     * Pushes particles outward from center with explosive force\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.expand?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.expand;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = config.strength || 1.0;\r\n        \r\n        // Calculate expansion amount based on progress\r\n        const expandFactor = 1 + (config.scaleTarget - 1) * progress * strength;\r\n        const targetRadius = data.baseRadius * expandFactor;\r\n        \r\n        // Calculate target position farther from center\r\n        const targetX = centerX + Math.cos(data.angle) * targetRadius;\r\n        const targetY = centerY + Math.sin(data.angle) * targetRadius;\r\n        \r\n        // Apply strong outward push forces\r\n        const dx = targetX - particle.x;\r\n        const dy = targetY - particle.y;\r\n        particle.vx += dx * 0.8 * dt;  // Strong explosive push\r\n        particle.vy += dy * 0.8 * dt;  // Strong explosive push\r\n        \r\n        // Apply velocity damping for controlled motion\r\n        particle.vx *= 0.95;\r\n        particle.vy *= 0.95;\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.expand) {\r\n            delete particle.gestureData.expand;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Contract Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Contract gesture - particles move inward toward center\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/contract\r\n */\r\n\r\nexport default {\r\n    name: 'contract',\r\n    emoji: '🌀',\r\n    type: 'blending',\r\n    description: 'Radial contraction toward center',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 600,        // Gesture duration\r\n        scaleAmount: 0.2,     // Core scale reduction amount\r\n        scaleTarget: 0.2,     // Target contraction distance ratio\r\n        glowAmount: -0.2,     // Glow intensity reduction\r\n        easing: 'cubic',      // Smooth acceleration curve\r\n        strength: 2.5,        // Inward pull force intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'pulse',\r\n            strength: 2.5,        // Particle pull strength\r\n            direction: 'inward',  // Movement toward center\r\n            persist: true         // Effect continues after gesture\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - magnetic contraction synced to musical tension\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'tension',  // Contract during musical tension builds\r\n        \r\n        // Contraction strength responds to musical intensity\r\n        strengthSync: {\r\n            onTension: 4.0,       // Strong pull during tension\r\n            onRelease: 1.5,       // Gentle pull during release\r\n            curve: 'magnetic'     // Smooth magnetic pull curve\r\n        },\r\n        \r\n        // Scale target changes with dynamics\r\n        scaleTargetSync: {\r\n            forte: 0.1,           // Tight contraction for loud sections\r\n            piano: 0.4,           // Gentle contraction for soft sections\r\n            crescendo: 'gradual', // Gradual tightening on crescendos\r\n            diminuendo: 'ease'    // Easy relaxation on diminuendos\r\n        },\r\n        \r\n        // Duration responds to phrase length\r\n        durationSync: {\r\n            mode: 'phrases',\r\n            shortPhrase: 0.8,     // Quick contraction for short phrases  \r\n            longPhrase: 1.5,      // Extended contraction for long phrases\r\n            hold: 'sustain'       // Maintain contraction during holds\r\n        },\r\n        \r\n        // Strong accent response\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 2.2,      // Sharp contraction on accents\r\n            type: 'strength'      // Accent affects pull force\r\n        },\r\n        \r\n        // Pattern-specific contraction styles\r\n        patternOverrides: {\r\n            'classical': {\r\n                // Elegant, controlled contraction\r\n                strengthSync: { onTension: 3.5, onRelease: 1.8 },\r\n                scaleTargetSync: { forte: 0.15, piano: 0.35 }\r\n            },\r\n            'metal': {\r\n                // Aggressive, tight contraction\r\n                strengthSync: { onTension: 5.0, onRelease: 2.0, curve: 'sharp' },\r\n                scaleTargetSync: { forte: 0.05, piano: 0.25 }\r\n            },\r\n            'ambient': {\r\n                // Slow, atmospheric contraction\r\n                strengthSync: { onTension: 2.8, onRelease: 1.2, curve: 'ease' },\r\n                durationSync: { shortPhrase: 1.2, longPhrase: 2.0 }\r\n            },\r\n            'trap': {\r\n                // Sudden, rhythmic contraction on drops\r\n                strengthSync: { \r\n                    onTension: 4.5, \r\n                    onRelease: 1.0,\r\n                    dropBeat: 6.0   // Massive contraction on trap drops\r\n                },\r\n                scaleTargetSync: { forte: 0.08, piano: 0.3 }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics variations\r\n        dynamics: {\r\n            forte: {\r\n                // Powerful, crushing contraction\r\n                strengthSync: { \r\n                    onTension: { multiplier: 1.8 },\r\n                    onRelease: { multiplier: 1.4 }\r\n                },\r\n                scaleTargetSync: { multiplier: 0.6 },  // Tighter contraction\r\n                accentResponse: { multiplier: 2.8 }\r\n            },\r\n            piano: {\r\n                // Gentle, subtle contraction\r\n                strengthSync: { \r\n                    onTension: { multiplier: 0.7 },\r\n                    onRelease: { multiplier: 0.8 }\r\n                },\r\n                scaleTargetSync: { multiplier: 1.4 },  // Looser contraction\r\n                accentResponse: { multiplier: 1.6 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        const dx = particle.x - centerX;\r\n        const dy = particle.y - centerY;\r\n        particle.gestureData.contract = {\r\n            startX: particle.x,\r\n            startY: particle.y,\r\n            angle: Math.atan2(dy, dx),\r\n            baseRadius: Math.sqrt(dx * dx + dy * dy),\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply contraction motion to particle\r\n     * Pulls particles toward center with magnetic-like force\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.contract?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n        \r\n        const data = particle.gestureData.contract;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = config.strength || 1.0;\r\n        \r\n        // Calculate contraction amount based on progress\r\n        const contractFactor = 1 - (1 - config.scaleTarget) * progress * strength;\r\n        const targetRadius = data.baseRadius * contractFactor;\r\n        \r\n        // Calculate target position closer to center\r\n        const targetX = centerX + Math.cos(data.angle) * targetRadius;\r\n        const targetY = centerY + Math.sin(data.angle) * targetRadius;\r\n        \r\n        // Apply strong inward pull forces\r\n        const dx = targetX - particle.x;\r\n        const dy = targetY - particle.y;\r\n        particle.vx += dx * 0.5 * dt;  // Strong magnetic pull\r\n        particle.vy += dy * 0.5 * dt;  // Strong magnetic pull\r\n        \r\n        // Apply velocity damping for controlled motion\r\n        particle.vx *= 0.95;\r\n        particle.vy *= 0.95;\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.contract) {\r\n            delete particle.gestureData.contract;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Flash Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Flash gesture - bright burst effect\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/flash\r\n */\r\n\r\nexport default {\r\n    name: 'flash',\r\n    emoji: '⚡',\r\n    type: 'blending',\r\n    description: 'Bright flash burst effect',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 400,       // Animation duration\r\n        glowAmount: 2.5,     // Overall brightness increase\r\n        glowPeak: 3.0,       // Maximum intensity level\r\n        scalePeak: 1.1,      // Size expansion at peak\r\n        easing: 'cubic',     // Animation curve type\r\n        strength: 1.0,       // Effect intensity\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'burst',\r\n            strength: 1.0,   // Burst force intensity\r\n            decay: 0.3       // Force reduction rate\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - flash on beats and accents\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'beat',  // Flash on beats\r\n        timingSync: 'immediate',    // Flash immediately (for impact)\r\n        interruptible: true,         // Can interrupt\r\n        priority: 8,                 // High priority\r\n        blendable: true,             // Can layer over other effects\r\n        \r\n        // Flash intensity syncs to beat strength\r\n        intensitySync: {\r\n            onBeat: 3.5,              // Bright flash on beat\r\n            offBeat: 1.0,             // Dim between beats\r\n            accent: 5.0,              // Blinding on accent\r\n            subdivision: 'quarter',    // Flash every quarter note\r\n            curve: 'exponential'      // Sharp flash attack\r\n        },\r\n        \r\n        // Duration varies with tempo\r\n        durationSync: {\r\n            mode: 'tempo',\r\n            baseDuration: 400,        // Base at 120 BPM\r\n            scaling: 'inverse'        // Faster tempo = shorter flash\r\n        },\r\n        \r\n        // Scale pulse with flash\r\n        scaleSync: {\r\n            onBeat: 1.2,              // Expand on beat\r\n            offBeat: 1.0,             // Normal size off beat\r\n            accent: 1.4,              // Big expansion on accent\r\n            curve: 'elastic'          // Bouncy scale\r\n        },\r\n        \r\n        // Strobe patterns\r\n        strobeSync: {\r\n            enabled: false,           // Enable for strobe effect\r\n            pattern: 'XXOX',          // X=flash, O=dark\r\n            subdivision: 'sixteenth'  // Strobe rate\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: { glowPeak: 4.0, scalePeak: 1.3, duration: 300 },\r\n            piano: { glowPeak: 2.0, scalePeak: 1.05, duration: 500 }\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle, motion) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        particle.gestureData.flash = {\r\n            originalOpacity: particle.opacity,\r\n            originalSize: particle.size,\r\n            initialized: true\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply flash effect to particle\r\n     * Creates bright burst with size expansion and outward motion\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.flash?.initialized) {\r\n            this.initialize(particle, motion);\r\n        }\r\n        \r\n        const data = particle.gestureData.flash;\r\n        const config = { ...this.config, ...motion };\r\n        const strength = config.strength || 1.0;\r\n        \r\n        // Calculate flash intensity curve\r\n        let flashIntensity;\r\n        if (progress < 0.3) {\r\n            // Quick rise to peak brightness\r\n            flashIntensity = (progress / 0.3) * config.glowPeak;\r\n        } else {\r\n            // Gradual fade from peak\r\n            flashIntensity = config.glowPeak * (1 - (progress - 0.3) / 0.7);\r\n        }\r\n        \r\n        // Apply brightness and size changes\r\n        particle.opacity = Math.min(1, data.originalOpacity * (1 + flashIntensity * strength));\r\n        particle.size = data.originalSize * (1 + (config.scalePeak - 1) * flashIntensity * strength * 0.1);\r\n        \r\n        // Initial burst motion - particles briefly explode outward\r\n        if (progress < 0.2) {\r\n            const burstStrength = (1 - progress / 0.2) * strength;\r\n            const angle = Math.atan2(particle.y - centerY, particle.x - centerX);\r\n            particle.vx += Math.cos(angle) * burstStrength * 2 * dt;\r\n            particle.vy += Math.sin(angle) * burstStrength * 2 * dt;\r\n        }\r\n\r\n        // Apply velocity decay for natural deceleration\r\n        particle.vx *= (1 - config.particleMotion.decay * 0.1);\r\n        particle.vy *= (1 - config.particleMotion.decay * 0.1);\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.flash) {\r\n            particle.opacity = particle.gestureData.flash.originalOpacity;\r\n            particle.size = particle.gestureData.flash.originalSize;\r\n            delete particle.gestureData.flash;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Glow Gesture\r\n *  └─○═╝\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Glow gesture - based on pulse but focused on luminosity without movement\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/glow\r\n *\r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE\r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Creates a pure luminous glow effect without particle movement.\r\n * ║ This is a BLENDING gesture that only modifies brightness/glow.\r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * VISUAL DIAGRAM:\r\n *      Dim            Bright           Dim\r\n *    · · · ·         ✨ ✨ ✨         · · · ·\r\n *    · · ⭐ · ·   →  ✨ 🌟 ✨    →   · · ⭐ · ·\r\n *    · · · ·         ✨ ✨ ✨         · · · ·\r\n *\r\n * USED BY:\r\n * - Emphasis effects\r\n * - Magic/mystical states\r\n * - Energy charging\r\n */\r\n\r\n/**\r\n * Glow gesture configuration and implementation\r\n */\r\nexport default {\r\n    name: 'glow',\r\n    emoji: '✨',\r\n    type: 'blending', // Adds to existing motion\r\n    description: 'Pure luminous glow without movement',\r\n\r\n    // Default configuration\r\n    config: {\r\n        duration: 1500,      // Animation duration (longer than pulse for sustained glow)\r\n        amplitude: 0,        // NO expansion distance (removed from pulse)\r\n        frequency: 1,        // Number of glow pulses\r\n        holdPeak: 0.3,       // Peak glow hold time (longer for sustained effect)\r\n        easing: 'sine',      // Animation curve type\r\n        scaleAmount: 0.1,    // Very subtle orb scale variation (reduced from pulse)\r\n        glowAmount: 0.8,     // Strong orb glow intensity change (increased from pulse)\r\n        strength: 0,         // NO particle motion strength (removed from pulse)\r\n        direction: 'none',   // No movement direction\r\n        // Particle motion configuration for AnimationController\r\n        particleMotion: {\r\n            type: 'glow',\r\n            strength: 0,     // No particle movement\r\n            direction: 'none',\r\n            frequency: 1\r\n        }\r\n    },\r\n\r\n    // Rhythm configuration - glow pulses with musical phrases\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'phrase',  // Glow on musical phrases\r\n\r\n        // Glow strength syncs to dynamics\r\n        amplitudeSync: {\r\n            onBeat: 2.0,      // Strong glow on beat\r\n            offBeat: 1.2,     // Sustained glow off beat\r\n            curve: 'smooth'   // Smooth transitions\r\n        },\r\n\r\n        // Frequency locks to phrase length\r\n        frequencySync: {\r\n            mode: 'phrase',\r\n            subdivision: 'bar'\r\n        },\r\n\r\n        // Duration in musical time\r\n        durationSync: {\r\n            mode: 'bars',\r\n            bars: 2           // Glow over 2 bars\r\n        },\r\n\r\n        // Stronger glow on accents\r\n        accentResponse: {\r\n            enabled: true,\r\n            multiplier: 2.5   // Bright glow on accent\r\n        },\r\n\r\n        // Pattern-specific glow styles\r\n        patternOverrides: {\r\n            'ambient': {\r\n                // Ethereal sustained glow\r\n                amplitudeSync: { onBeat: 2.5, offBeat: 1.8 },\r\n                durationSync: { bars: 4 }\r\n            },\r\n            'electronic': {\r\n                // Pulsing neon glow\r\n                amplitudeSync: { onBeat: 3.0, offBeat: 0.5, curve: 'sharp' },\r\n                frequencySync: { subdivision: 'quarter' }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Initialize gesture data for a particle\r\n     * @param {Particle} particle - The particle to initialize\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    initialize: function(particle, motion, centerX, centerY) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n\r\n        // Store initial state (no position data needed for glow)\r\n        particle.gestureData.glow = {\r\n            startOpacity: particle.opacity,\r\n            startGlow: particle.glowSizeMultiplier || 0,\r\n            initialized: true\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Apply glow effect to particle (no motion, just luminosity)\r\n     * @param {Particle} particle - The particle to animate\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {Object} motion - Gesture configuration\r\n     * @param {number} dt - Delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize on first frame\r\n        if (!particle.gestureData?.glow?.initialized) {\r\n            this.initialize(particle, motion, centerX, centerY);\r\n        }\r\n\r\n        const data = particle.gestureData.glow;\r\n        const config = { ...this.config, ...motion };\r\n\r\n        // Apply easing\r\n        const easeProgress = this.easeInOutSine(progress);\r\n\r\n        // Calculate glow pulse with peak hold\r\n        let glowValue;\r\n        let frequency = config.frequency;\r\n        let glowAmount = config.glowAmount;\r\n\r\n        // Apply rhythm modulation if present\r\n        if (motion.rhythmModulation) {\r\n            glowAmount *= (motion.rhythmModulation.amplitudeMultiplier || 1);\r\n            glowAmount *= (motion.rhythmModulation.accentMultiplier || 1);\r\n            if (motion.rhythmModulation.frequencyMultiplier) {\r\n                frequency *= motion.rhythmModulation.frequencyMultiplier;\r\n            }\r\n        }\r\n\r\n        const rawPulse = (easeProgress * frequency * 2) % 2;\r\n\r\n        if (config.holdPeak > 0 && rawPulse > (1 - config.holdPeak) && rawPulse < (1 + config.holdPeak)) {\r\n            // Hold at peak glow\r\n            glowValue = 1;\r\n        } else {\r\n            // Normal sine wave for glow\r\n            glowValue = Math.sin(easeProgress * Math.PI * 2 * frequency);\r\n        }\r\n\r\n        // NO PARTICLE MOVEMENT - just glow effects\r\n        // Unlike pulse, we don't calculate target positions or apply velocity\r\n\r\n        // Apply glow fade effect at the end\r\n        let glowMultiplier = 1;\r\n        if (progress > 0.9) {\r\n            const fadeFactor = 1 - ((progress - 0.9) * 10);\r\n            glowMultiplier = (0.5 + fadeFactor * 0.5);\r\n        }\r\n\r\n        // Modify particle glow properties (if your system supports it)\r\n        // This is where the actual glow effect happens\r\n        // Note: The actual visual implementation depends on your renderer\r\n        // Set glow intensity directly, don't multiply to prevent accumulation\r\n        particle.glowIntensity = 1 + glowValue * glowAmount * glowMultiplier;\r\n    },\r\n\r\n    /**\r\n     * Clean up gesture data when complete\r\n     * @param {Particle} particle - The particle to clean up\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.glow) {\r\n            // Reset any glow properties\r\n            particle.glowIntensity = 1;\r\n            delete particle.gestureData.glow;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Sine easing for smooth glow transitions\r\n     * @param {number} t - Progress (0-1)\r\n     * @returns {number} Eased value\r\n     */\r\n    easeInOutSine: function(t) {\r\n        return -(Math.cos(Math.PI * t) - 1) / 2;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Peek Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Quick peek/hide motion for suspicious checking behavior\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/peek\r\n * \r\n * GESTURE TYPE:\r\n * type: 'effect' - Visual effect without changing core position\r\n * \r\n * VISUAL EFFECT:\r\n * Particles quickly expand outward (peeking) then contract back (hiding),\r\n * like peeking around a corner or quickly checking surroundings.\r\n */\r\n\r\nexport default {\r\n    name: 'peek',\r\n    emoji: '👀',\r\n    type: 'effect',\r\n    description: 'Quick peek and hide motion',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        peekDistance: 40,       // How far to peek out\r\n        peekSpeed: 0.15,        // Speed of peek motion\r\n        holdDuration: 200,      // How long to hold peek position (ms)\r\n        hideSpeed: 0.25,        // Speed of hiding (faster than peeking)\r\n        stagger: true,          // Stagger particle peeks\r\n        duration: 1500          // Total animation duration\r\n    },\r\n    \r\n    // Rhythm configuration - quick glimpse movements synchronized to rhythmic accents\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'accent',  // Peek on rhythmic accents and syncopation\r\n        \r\n        // Peek distance responds to accent strength\r\n        distanceSync: {\r\n            onAccent: 60,         // Far peek on accents\r\n            offAccent: 25,        // Short peek off-accent\r\n            curve: 'quick'        // Sharp, sudden movement\r\n        },\r\n        \r\n        // Speed adapts to musical tempo\r\n        speedSync: {\r\n            mode: 'tempo',\r\n            fast: 0.25,           // Quick peeks for fast music\r\n            slow: 0.10,           // Slower peeks for slow music\r\n            hideMultiplier: 1.8   // Hide speed relative to peek speed\r\n        },\r\n        \r\n        // Duration matches rhythmic subdivisions\r\n        durationSync: {\r\n            mode: 'subdivision',\r\n            beats: 0.25,          // Quarter-beat peek duration\r\n            staggerBeats: 0.125,  // Eighth-beat stagger delay\r\n            sustain: false        // No sustain, quick action\r\n        },\r\n        \r\n        // Strong response to syncopated rhythms\r\n        syncopationResponse: {\r\n            enabled: true,\r\n            multiplier: 1.8,      // More dramatic peek on syncopation\r\n            type: 'distance'      // Affects peek distance\r\n        },\r\n        \r\n        // Style variations for different music types\r\n        patternOverrides: {\r\n            'funk': {\r\n                // Sharp, syncopated peeks\r\n                distanceSync: { onAccent: 70, offAccent: 35, curve: 'funky' },\r\n                syncopationResponse: { multiplier: 2.2 }\r\n            },\r\n            'latin': {\r\n                // Rhythmic, dance-like peeks\r\n                speedSync: { fast: 0.30, slow: 0.12 },\r\n                durationSync: { beats: 0.5, staggerBeats: 0.25 }\r\n            },\r\n            'breakbeat': {\r\n                // Erratic, complex peek patterns\r\n                distanceSync: { onAccent: 55, offAccent: 40 },\r\n                syncopationResponse: { multiplier: 2.5 }\r\n            },\r\n            'classical': {\r\n                // Subtle, expressive peeks\r\n                distanceSync: { onAccent: 45, offAccent: 20, curve: 'elegant' },\r\n                speedSync: { fast: 0.18, slow: 0.08 }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: {\r\n                // Bold, assertive peeks\r\n                distanceSync: { \r\n                    onAccent: { multiplier: 1.6 },\r\n                    offAccent: { multiplier: 1.3 }\r\n                },\r\n                speedSync: { multiplier: 1.4 },\r\n                syncopationResponse: { multiplier: 2.8 }\r\n            },\r\n            piano: {\r\n                // Cautious, subtle peeks\r\n                distanceSync: { \r\n                    onAccent: { multiplier: 0.6 },\r\n                    offAccent: { multiplier: 0.4 }\r\n                },\r\n                speedSync: { multiplier: 0.7 },\r\n                syncopationResponse: { multiplier: 1.2 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Initialize peek data if needed\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        \r\n        if (!particle.gestureData.peek) {\r\n            const dx = particle.x - centerX;\r\n            const dy = particle.y - centerY;\r\n            const angle = Math.atan2(dy, dx);\r\n            const distance = Math.sqrt(dx * dx + dy * dy);\r\n            \r\n            particle.gestureData.peek = {\r\n                originalX: particle.x,\r\n                originalY: particle.y,\r\n                peekAngle: angle,\r\n                originalDistance: distance,\r\n                staggerDelay: this.config.stagger ? Math.random() * 0.3 : 0,\r\n                phase: 'waiting',  // 'waiting', 'peeking', 'holding', 'hiding'\r\n                phaseTimer: 0,\r\n                peekOffset: { x: 0, y: 0 }\r\n            };\r\n        }\r\n        \r\n        const data = particle.gestureData.peek;\r\n        const config = this.config;\r\n        \r\n        // Adjust progress for stagger\r\n        const adjustedProgress = Math.max(0, Math.min(1, (progress - data.staggerDelay) / (1 - data.staggerDelay)));\r\n        \r\n        // Determine phase based on progress\r\n        if (adjustedProgress === 0) {\r\n            data.phase = 'waiting';\r\n        } else if (adjustedProgress < 0.3) {\r\n            data.phase = 'peeking';\r\n        } else if (adjustedProgress < 0.6) {\r\n            data.phase = 'holding';\r\n        } else if (adjustedProgress < 1) {\r\n            data.phase = 'hiding';\r\n        }\r\n        \r\n        // Calculate peek offset based on phase\r\n        let targetOffset = 0;\r\n        \r\n        switch (data.phase) {\r\n            case 'peeking':\r\n                // Smooth peek out\r\n                const peekProgress = adjustedProgress / 0.3;\r\n                targetOffset = this.easeOutCubic(peekProgress) * config.peekDistance;\r\n                break;\r\n                \r\n            case 'holding':\r\n                // Hold at peek position\r\n                targetOffset = config.peekDistance;\r\n                // Add slight tremor while holding\r\n                if (Math.random() < 0.1) {\r\n                    data.peekOffset.x += (Math.random() - 0.5) * 2;\r\n                    data.peekOffset.y += (Math.random() - 0.5) * 2;\r\n                }\r\n                break;\r\n                \r\n            case 'hiding':\r\n                // Quick hide back\r\n                const hideProgress = (adjustedProgress - 0.6) / 0.4;\r\n                targetOffset = (1 - this.easeInCubic(hideProgress)) * config.peekDistance;\r\n                break;\r\n        }\r\n        \r\n        // Apply the peek offset\r\n        if (data.phase !== 'waiting') {\r\n            const peekX = Math.cos(data.peekAngle) * targetOffset;\r\n            const peekY = Math.sin(data.peekAngle) * targetOffset;\r\n            \r\n            // Smooth transition to target position\r\n            data.peekOffset.x += (peekX - data.peekOffset.x) * config.peekSpeed;\r\n            data.peekOffset.y += (peekY - data.peekOffset.y) * config.peekSpeed;\r\n            \r\n            // Apply offset to particle\r\n            particle.x = data.originalX + data.peekOffset.x;\r\n            particle.y = data.originalY + data.peekOffset.y;\r\n        }\r\n        \r\n        // Add opacity effect - slightly fade during peek\r\n        if (particle.alpha !== undefined) {\r\n            if (data.phase === 'peeking' || data.phase === 'holding') {\r\n                particle.alpha = 0.7 + Math.random() * 0.3;  // Flickering visibility\r\n            } else {\r\n                particle.alpha = 1.0;\r\n            }\r\n        }\r\n    },\r\n    \r\n    // Easing functions\r\n    easeOutCubic: function(t) {\r\n        return 1 - Math.pow(1 - t, 3);\r\n    },\r\n    \r\n    easeInCubic: function(t) {\r\n        return t * t * t;\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.peek) {\r\n            // Restore original position\r\n            particle.x = particle.gestureData.peek.originalX;\r\n            particle.y = particle.gestureData.peek.originalY;\r\n            if (particle.alpha !== undefined) {\r\n                particle.alpha = 1.0;\r\n            }\r\n            delete particle.gestureData.peek;\r\n        }\r\n    }\r\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE v4.0 - Gesture Registry\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Central registry for all gesture animations with plugin support\n * @author Emotive Engine Team\n * @version 4.0.0\n * @module gestures\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Control center for all gestures with full plugin adapter integration.             \n * ║ • Three gesture types: blending (motions), override (transforms), effects        \n * ║ • Core gestures loaded synchronously at startup                                   \n * ║ • Plugin gestures registered dynamically via adapter                              \n * ║ • Value-agnostic configurations for easy tuning                                   \n * ║                                                                                    \n * ║ TO ADD A PLUGIN GESTURE:                                                          \n * ║ Use pluginAdapter.registerPluginGesture() from your plugin                        \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n */\n\nimport pluginAdapter from './plugin-adapter.js';\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ IMPORT MOTION GESTURES (Blending - add to existing motion)\n// └─────────────────────────────────────────────────────────────────────────────────────\nimport bounce from './motions/bounce.js';\nimport pulse from './motions/pulse.js';\nimport shake from './motions/shake.js';\nimport nod from './motions/nod.js';\nimport vibrate from './motions/vibrate.js';\nimport orbit from './motions/orbit.js';\nimport twitch from './motions/twitch.js';\nimport sway from './motions/sway.js';\nimport float from './motions/float.js';\nimport jitter from './motions/jitter.js';\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ IMPORT TRANSFORM GESTURES (Override - replace motion completely)\n// └─────────────────────────────────────────────────────────────────────────────────────\nimport spin from './transforms/spin.js';\nimport jump from './transforms/jump.js';\nimport morph from './transforms/morph.js';\nimport stretch from './transforms/stretch.js';\nimport tilt from './transforms/tilt.js';\nimport orbital from './transforms/orbital.js';\nimport hula from './transforms/hula.js';\nimport scan from './transforms/scan.js';\nimport twist from './transforms/twist.js';\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ IMPORT EFFECT GESTURES (Visual effects)\n// └─────────────────────────────────────────────────────────────────────────────────────\nimport wave from './effects/wave.js';\nimport drift from './effects/drift.js';\nimport flicker from './effects/flicker.js';\nimport burst from './effects/burst.js';\nimport directional from './effects/directional.js';\nimport settle from './effects/settle.js';\nimport fade from './effects/fade.js';\nimport hold from './effects/hold.js';\nimport breathe from './effects/breathe.js';\nimport expand from './effects/expand.js';\nimport contract from './effects/contract.js';\nimport flash from './effects/flash.js';\nimport glow from './effects/glow.js';\nimport peek from './effects/peek.js';\nimport runningman from './effects/runningman.js';\nimport charleston from './effects/charleston.js';\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ PLACEHOLDER GESTURES FOR NEW ANIMATIONS\n// └─────────────────────────────────────────────────────────────────────────────────────\n// These are handled by GestureAnimator but need registry entries for rhythm system\nconst createPlaceholderGesture = (name, emoji = '✨') => ({\n    name,\n    emoji,\n    type: 'blending', // Use blending type so they don't interfere\n    description: `${name} animation`,\n    config: {\n        duration: 1000, // Legacy fallback only\n        musicalDuration: { musical: true, beats: 2 } // Default: 2 beats\n    },\n    rhythm: {\n        enabled: true,\n        syncMode: 'beat',\n        timingSync: 'nextBeat',\n        durationSync: { mode: 'beats', beats: 2 }, // Musical duration\n        interruptible: true,\n        priority: 3,\n        blendable: true,\n        crossfadePoint: 'anyBeat',\n        maxQueue: 3\n    },\n    apply: (particle, progress, params) => {\n        // No-op - handled by GestureAnimator\n        return false;\n    },\n    blend: (particle, progress, params) => {\n        // No-op - handled by GestureAnimator\n        return false;\n    }\n});\n\nconst sparkle = createPlaceholderGesture('sparkle', '✨');\n\n// Shimmer gesture - makes particles shimmer with wave effect\nconst shimmer = {\n    name: 'shimmer',\n    emoji: '🌟',\n    type: 'particle',  // Particle type to affect particle behavior\n    description: 'Shimmer effect with sparkling particles',\n    config: {\n        duration: 2000,  // Legacy fallback\n        musicalDuration: { musical: true, bars: 1 }, // 1 bar (4 beats)\n        particleMotion: 'radiant'  // Use radiant behavior for shimmering effect\n    },\n    rhythm: {\n        enabled: true,\n        syncType: 'beat',\n        durationSync: { mode: 'bars', bars: 1 }, // Musical: 1 bar\n        intensity: 0.8\n    },\n    override: (particle, progress, params) => {\n        // Shimmer makes particles sparkle with wave effect\n        particle.shimmerEffect = true;\n        particle.shimmerProgress = progress;\n        return true;\n    },\n    blend: (particle, progress, params) => {\n        // Blend with other gestures\n        return false;\n    }\n};\nconst wiggle = createPlaceholderGesture('wiggle', '〰️');\nconst groove = createPlaceholderGesture('groove', '🎵');\nconst point = createPlaceholderGesture('point', '👉');\nconst lean = createPlaceholderGesture('lean', '↗️');\nconst reach = createPlaceholderGesture('reach', '🤚');\nconst headBob = createPlaceholderGesture('headBob', '🎧');\n\n// Rain gesture - applies doppler effect to particles\nconst rain = {\n    name: 'rain',\n    emoji: '🌧️',\n    type: 'particle',  // Particle type to affect particle behavior\n    description: 'Rain effect with falling particles',\n    config: {\n        duration: 3000,  // Legacy fallback\n        musicalDuration: { musical: true, bars: 2 }, // 2 bars (8 beats)\n        particleMotion: 'falling'  // Use the falling particle behavior\n    },\n    rhythm: {\n        enabled: true,\n        syncType: 'off-beat',\n        durationSync: { mode: 'bars', bars: 2 }, // Musical: 2 bars\n        intensity: 0.8\n    },\n    apply: (particle, progress, params) => {\n        // The doppler behavior is handled by the particle system\n        // This just marks particles as being affected by rain\n        particle.rainEffect = true;\n        particle.rainProgress = progress;\n        return true;\n    },\n    blend: (particle, progress, params) => {\n        // Blend with other gestures\n        return false;\n    }\n};\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ GESTURE COLLECTIONS\n// └─────────────────────────────────────────────────────────────────────────────────────\nconst MOTION_GESTURES = [\n    bounce,\n    pulse,\n    shake,\n    nod,\n    vibrate,\n    orbit,\n    twitch,\n    sway,\n    float,\n    jitter,\n    // New gestures\n    sparkle,\n    shimmer,\n    wiggle,\n    groove,\n    point,\n    lean,\n    reach,\n    headBob,\n    rain\n];\n\nconst TRANSFORM_GESTURES = [\n    spin,\n    jump,\n    morph,\n    stretch,\n    tilt,\n    orbital,\n    hula,\n    scan,\n    twist\n];\n\nconst EFFECT_GESTURES = [\n    wave,\n    drift,\n    flicker,\n    burst,\n    directional,\n    settle,\n    fade,\n    hold,\n    breathe,\n    expand,\n    contract,\n    flash,\n    glow,\n    peek,\n    runningman,\n    charleston\n];\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ GESTURE REGISTRY - Fast lookup by name\n// └─────────────────────────────────────────────────────────────────────────────────────\nexport const GESTURE_REGISTRY = {};\n\n// Build the registry from all gesture arrays - SYNCHRONOUSLY\n[...MOTION_GESTURES, ...TRANSFORM_GESTURES, ...EFFECT_GESTURES].forEach(gesture => {\n    GESTURE_REGISTRY[gesture.name] = gesture;\n});\n\n// ┌─────────────────────────────────────────────────────────────────────────────────────\n// │ GESTURE TYPE MAPPING - Quick type lookup\n// └─────────────────────────────────────────────────────────────────────────────────────\nexport const GESTURE_TYPES = {\n    blending: MOTION_GESTURES.map(g => g.name),\n    override: TRANSFORM_GESTURES.map(g => g.name),\n    effect: EFFECT_GESTURES.map(g => g.name)\n};\n\n/**\n * Get a gesture by name (checks both core and plugin gestures)\n * @param {string} name - Gesture name (e.g., 'bounce', 'spin')\n * @returns {Object|null} Gesture object or null if not found\n */\nexport function getGesture(name) {\n    // Check core gestures first\n    if (GESTURE_REGISTRY[name]) {\n        return GESTURE_REGISTRY[name];\n    }\n    \n    // Check plugin gestures\n    const pluginGesture = pluginAdapter.getPluginGesture(name);\n    if (pluginGesture) {\n        return pluginGesture;\n    }\n    \n    return null;\n}\n\n/**\n * Check if a gesture is a blending type\n * @param {string} name - Gesture name\n * @returns {boolean} True if gesture blends with existing motion\n */\nexport function isBlendingGesture(name) {\n    const gesture = getGesture(name);\n    return gesture ? gesture.type === 'blending' : false;\n}\n\n/**\n * Check if a gesture is an override type\n * @param {string} name - Gesture name\n * @returns {boolean} True if gesture overrides existing motion\n */\nexport function isOverrideGesture(name) {\n    const gesture = getGesture(name);\n    return gesture ? gesture.type === 'override' : false;\n}\n\n/**\n * Apply a gesture to a particle\n * @param {Particle} particle - The particle to animate\n * @param {string} gestureName - Name of the gesture\n * @param {number} progress - Animation progress (0-1)\n * @param {Object} motion - Motion configuration\n * @param {number} dt - Delta time\n * @param {number} centerX - Orb center X\n * @param {number} centerY - Orb center Y\n * @returns {boolean} True if gesture was applied\n */\nexport function applyGesture(particle, gestureName, progress, motion, dt, centerX, centerY) {\n    const gesture = getGesture(gestureName);\n    \n    if (!gesture) {\n        return false;\n    }\n    \n    // Apply the gesture\n    if (gesture.apply) {\n        gesture.apply(particle, progress, motion, dt, centerX, centerY);\n    }\n    \n    // Clean up if complete\n    if (progress >= 1 && gesture.cleanup) {\n        gesture.cleanup(particle);\n    }\n    \n    return true;\n}\n\n/**\n * Get list of all available gestures (core and plugin)\n * @returns {Array} Array of gesture info objects\n */\nexport function listGestures() {\n    const allGestures = [];\n    \n    // Add core gestures\n    Object.values(GESTURE_REGISTRY).forEach(gesture => {\n        allGestures.push({\n            name: gesture.name,\n            emoji: gesture.emoji || '🎭',\n            type: gesture.type,\n            description: gesture.description || 'No description',\n            source: 'core'\n        });\n    });\n    \n    // Add plugin gestures\n    const pluginGestureNames = pluginAdapter.getAllPluginGestures();\n    pluginGestureNames.forEach(name => {\n        const gesture = pluginAdapter.getPluginGesture(name);\n        allGestures.push({\n            name: gesture.name,\n            emoji: gesture.emoji || '🔌',\n            type: gesture.type,\n            description: gesture.description || 'Plugin gesture',\n            source: 'plugin'\n        });\n    });\n    \n    return allGestures;\n}\n\n// Debug utilities can be imported directly if needed\n// Export them instead of polluting global scope\n\n// Export plugin adapter for external use\nexport { pluginAdapter };\n\n// Export everything\nexport default {\n    GESTURE_REGISTRY,\n    GESTURE_TYPES,\n    getGesture,\n    isBlendingGesture,\n    isOverrideGesture,\n    applyGesture,\n    listGestures,\n    pluginAdapter\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Fade Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Fade gesture - opacity fade effect\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/fade\r\n */\r\n\r\nexport default {\r\n    name: 'fade',\r\n    emoji: '👻',\r\n    type: 'blending',\r\n    description: 'Fade particle opacity',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        fadeIn: false,      // Enable fade in effect\r\n        fadeOut: true,      // Enable fade out effect\r\n        minOpacity: 0,      // Minimum opacity level\r\n        maxOpacity: 1       // Maximum opacity level\r\n    },\r\n    \r\n    // Rhythm configuration - fades sync to musical dynamics\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'dynamic',  // Fade with volume/intensity changes\r\n        \r\n        // Opacity modulation with beat\r\n        opacitySync: {\r\n            onBeat: 0.9,              // Nearly visible on beat\r\n            offBeat: 0.3,             // Ghostly between beats\r\n            subdivision: 'eighth',     // Check every 8th note\r\n            curve: 'exponential'      // Sharp opacity changes\r\n        },\r\n        \r\n        // Fade timing with musical structure\r\n        fadePhaseSync: {\r\n            verse: { fadeIn: true, fadeOut: false },    // Build in verse\r\n            chorus: { fadeIn: false, fadeOut: false },  // Full visibility\r\n            bridge: { fadeIn: true, fadeOut: true },    // In and out\r\n            outro: { fadeIn: false, fadeOut: true }     // Fade to end\r\n        },\r\n        \r\n        // Pulse with rhythm\r\n        pulseSync: {\r\n            enabled: true,\r\n            frequency: 'quarter',     // Pulse every quarter note\r\n            intensity: 0.2,           // Pulse depth\r\n            onAccent: 0.4            // Deeper pulse on accents\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: { minOpacity: 0.5, maxOpacity: 1.0 },    // More visible when loud\r\n            piano: { minOpacity: 0.0, maxOpacity: 0.4 }     // Ghostly when quiet\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Initialize fade data\r\n     * Stores particle's original opacity\r\n     */\r\n    initialize: function(particle) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        particle.gestureData.fade = {\r\n            baseOpacity: particle.opacity || particle.life || 1\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply fade effect to particle\r\n     * Smoothly transitions opacity based on configuration\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.fade) {\r\n            this.initialize(particle);\r\n        }\r\n        \r\n        const data = particle.gestureData.fade;\r\n        const config = { ...this.config, ...motion };\r\n        \r\n        let targetOpacity;\r\n        if (config.fadeIn && !config.fadeOut) {\r\n            // Fade in only - opacity increases over time\r\n            targetOpacity = config.minOpacity + (config.maxOpacity - config.minOpacity) * progress;\r\n        } else if (config.fadeOut && !config.fadeIn) {\r\n            // Fade out only - opacity decreases over time\r\n            targetOpacity = config.maxOpacity - (config.maxOpacity - config.minOpacity) * progress;\r\n        } else {\r\n            // Fade in then out - peak opacity at midpoint\r\n            if (progress < 0.5) {\r\n                targetOpacity = config.minOpacity + (config.maxOpacity - config.minOpacity) * (progress * 2);\r\n            } else {\r\n                targetOpacity = config.maxOpacity - (config.maxOpacity - config.minOpacity) * ((progress - 0.5) * 2);\r\n            }\r\n        }\r\n        \r\n        // Apply calculated opacity\r\n        particle.opacity = data.baseOpacity * targetOpacity;\r\n        // Also update life property for particles that use it\r\n        if (particle.life !== undefined) {\r\n            particle.life = particle.opacity;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clean up fade effect\r\n     * Restores original opacity values\r\n     */\r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.fade) {\r\n            particle.opacity = particle.gestureData.fade.baseOpacity;\r\n            if (particle.life !== undefined) {\r\n                particle.life = particle.opacity;\r\n            }\r\n            delete particle.gestureData.fade;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Hold Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Hold gesture - freeze particles in place\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/hold\r\n */\r\n\r\nexport default {\r\n    name: 'hold',\r\n    emoji: '⏸️',\r\n    type: 'override',\r\n    description: 'Hold particles in current position',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        holdStrength: 0.95,  // Position retention strength\r\n        allowDrift: false    // Enable slight movement\r\n    },\r\n    \r\n    // Rhythm configuration - synchronized pause effects following musical structure\r\n    rhythm: {\r\n        enabled: true,\r\n        syncMode: 'rest',    // Hold particles during musical rests and pauses\r\n        \r\n        // Hold strength responds to musical silence\r\n        holdSync: {\r\n            onRest: 0.98,         // Very strong hold during rests\r\n            onSound: 0.80,        // Looser hold when music plays\r\n            curve: 'immediate'    // Instant response to silence/sound\r\n        },\r\n        \r\n        // Duration matches rest length\r\n        durationSync: {\r\n            mode: 'rests',\r\n            minBeats: 0.5,        // Minimum half-beat hold\r\n            maxBeats: 8,          // Maximum 8-beat hold\r\n            sustain: true         // Maintain hold through entire rest\r\n        },\r\n        \r\n        // Response to fermatas and caesuras\r\n        pauseResponse: {\r\n            enabled: true,\r\n            multiplier: 1.5,      // Stronger hold during marked pauses\r\n            type: 'strength'      // Affects hold strength\r\n        },\r\n        \r\n        // Style variations for different music types\r\n        patternOverrides: {\r\n            'classical': {\r\n                // Expressive holds for dramatic pauses\r\n                holdSync: { onRest: 0.99, onSound: 0.75, curve: 'dramatic' },\r\n                pauseResponse: { multiplier: 2.0 }\r\n            },\r\n            'minimal': {\r\n                // Extended, meditative holds\r\n                holdSync: { onRest: 0.95, onSound: 0.85 },\r\n                durationSync: { minBeats: 2, maxBeats: 16 }\r\n            },\r\n            'jazz': {\r\n                // Subtle holds that allow for swing\r\n                holdSync: { onRest: 0.90, onSound: 0.70 },\r\n                allowDrift: true  // Enable slight movement for swing feel\r\n            },\r\n            'electronic': {\r\n                // Precise, digital-style holds\r\n                holdSync: { onRest: 0.99, onSound: 0.60, curve: 'digital' },\r\n                pauseResponse: { multiplier: 1.2 }\r\n            }\r\n        },\r\n        \r\n        // Musical dynamics\r\n        dynamics: {\r\n            forte: {\r\n                // Strong, definitive holds\r\n                holdSync: { \r\n                    onRest: { multiplier: 1.02 },\r\n                    onSound: { multiplier: 0.9 }\r\n                },\r\n                pauseResponse: { multiplier: 2.2 }\r\n            },\r\n            piano: {\r\n                // Gentle, floating holds\r\n                holdSync: { \r\n                    onRest: { multiplier: 0.97 },\r\n                    onSound: { multiplier: 0.85 }\r\n                },\r\n                pauseResponse: { multiplier: 1.3 }\r\n            }\r\n        }\r\n    },\r\n    \r\n    initialize: function(particle) {\r\n        if (!particle.gestureData) {\r\n            particle.gestureData = {};\r\n        }\r\n        particle.gestureData.hold = {\r\n            holdX: particle.x,\r\n            holdY: particle.y,\r\n            originalVx: particle.vx,\r\n            originalVy: particle.vy\r\n        };\r\n    },\r\n    \r\n    /**\r\n     * Apply hold effect to particle\r\n     * Freezes or slows particle movement based on configuration\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        if (!particle.gestureData?.hold) {\r\n            this.initialize(particle);\r\n        }\r\n        \r\n        const data = particle.gestureData.hold;\r\n        const holdStrength = motion.holdStrength || this.config.holdStrength;\r\n        \r\n        if (motion.allowDrift) {\r\n            // Allow slight drift with velocity damping\r\n            particle.vx *= holdStrength;\r\n            particle.vy *= holdStrength;\r\n        } else {\r\n            // Hard hold - lock to position\r\n            particle.x += (data.holdX - particle.x) * (1 - holdStrength);\r\n            particle.y += (data.holdY - particle.y) * (1 - holdStrength);\r\n            particle.vx = 0;\r\n            particle.vy = 0;\r\n        }\r\n        \r\n        // Gradually restore velocity near end\r\n        if (progress > 0.9) {\r\n            const restoreFactor = (progress - 0.9) * 10;\r\n            particle.vx = particle.vx * (1 - restoreFactor) + data.originalVx * restoreFactor;\r\n            particle.vy = particle.vy * (1 - restoreFactor) + data.originalVy * restoreFactor;\r\n        }\r\n    },\r\n    \r\n    cleanup: function(particle) {\r\n        if (particle.gestureData?.hold) {\r\n            const data = particle.gestureData.hold;\r\n            particle.vx = data.originalVx;\r\n            particle.vy = data.originalVy;\r\n            delete particle.gestureData.hold;\r\n        }\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Running Man Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Running Man gesture - hip-hop shuffle dance move\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/runningman\r\n */\r\n\r\nexport default {\r\n    name: 'runningman',\r\n    emoji: '🏃',\r\n    type: 'effect',\r\n    description: 'Hip-hop running man shuffle',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 2000,        // Animation duration\r\n        slideDistance: 30,     // Horizontal slide distance\r\n        stepHeight: 15,        // Vertical step height\r\n        speed: 1.2,            // Animation speed multiplier\r\n        strength: 0.8,         // Overall effect intensity\r\n        // Particle motion configuration\r\n        particleMotion: {\r\n            type: 'runningman',\r\n            strength: 0.7\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - synchronized to beat\r\n    rhythm: {\r\n        enabled: true,\r\n        syncToBeat: true,      // Snap to beat grid\r\n        beatMultiplier: 1,     // Steps per beat\r\n        accentBeats: [1, 3]    // Emphasized steps\r\n    },\r\n    \r\n    /**\r\n     * Apply running man motion - handled by GestureAnimator\r\n     * This is a placeholder for the gesture system\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Motion is handled by GestureAnimator.applyRunningMan()\r\n        return false;\r\n    },\r\n    \r\n    /**\r\n     * Blend with existing motion\r\n     */\r\n    blend: function(particle, progress, motion) {\r\n        // Allow blending with other gestures\r\n        return false;\r\n    }\r\n}","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Charleston Gesture\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Charleston gesture - classic hip-hop shuffle with modern twist\r\n * @author Emotive Engine Team\r\n * @module gestures/effects/charleston\r\n */\r\n\r\nexport default {\r\n    name: 'charleston',\r\n    emoji: '🕺',\r\n    type: 'effect',\r\n    description: 'Hip-hop Charleston shuffle with crisscross',\r\n    \r\n    // Default configuration\r\n    config: {\r\n        duration: 2500,        // Animation duration\r\n        kickDistance: 35,      // Kick extension distance\r\n        swivelRange: 40,       // Hip swivel range\r\n        bounceHeight: 12,      // Vertical bounce\r\n        strength: 0.9,         // Overall effect intensity\r\n        // Particle motion configuration\r\n        particleMotion: {\r\n            type: 'charleston',\r\n            strength: 0.8\r\n        }\r\n    },\r\n    \r\n    // Rhythm configuration - tight sync with beat\r\n    rhythm: {\r\n        enabled: true,\r\n        syncToBeat: true,      // Lock to beat grid\r\n        beatMultiplier: 2,     // Double-time feel\r\n        accentBeats: [1, 2.5, 3, 4.5]  // Syncopated accents\r\n    },\r\n    \r\n    /**\r\n     * Apply charleston motion - handled by GestureAnimator\r\n     * This is a placeholder for the gesture system\r\n     */\r\n    apply: function(particle, progress, motion, dt, centerX, centerY) {\r\n        // Motion is handled by GestureAnimator.applyCharleston()\r\n        return false;\r\n    },\r\n    \r\n    /**\r\n     * Blend with existing motion\r\n     */\r\n    blend: function(particle, progress, motion) {\r\n        // Allow blending with other gestures\r\n        return false;\r\n    }\r\n}","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Rhythm Core\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n * \r\n * @fileoverview Core rhythm timing engine for musical synchronization\r\n * @author Emotive Engine Team\r\n * @module core/rhythm\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ CONCEPT                                                                           \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Central timing engine that provides musical time references to all subsystems.    \r\n * ║ Does NOT dictate what animations do - only provides timing information.           \r\n * ║ Each subsystem maintains its own rhythm configuration in its files.              \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n * \r\n * ARCHITECTURE:\r\n * • Provides beat events and musical time references\r\n * • Supports multiple time signatures and tempo changes\r\n * • Enables audio synchronization from external sources\r\n * • Each gesture/emotion/behavior defines its own rhythm response\r\n * \r\n * ┌──────────────────────────────────────────────────────────────────────────────────┐\r\n * │  TIMING FLOW                                                                      │\r\n * │                                                                                   │\r\n * │  Audio Input ──┐                                                                 │\r\n * │                ↓                                                                  │\r\n * │  [Rhythm Engine] ← Internal Clock                                                │\r\n * │        ↓                                                                          │\r\n * │   Beat Events → Subsystems (each with own rhythm config)                        │\r\n * │                                                                                   │\r\n * └──────────────────────────────────────────────────────────────────────────────────┘\r\n */\r\n\r\nclass RhythmEngine {\r\n    constructor() {\r\n        // Core timing properties\r\n        this.bpm = 120;                    // Default BPM (beats per minute)\r\n        this.timeSignature = [4, 4];       // Default 4/4 time\r\n        this.isPlaying = false;            // Whether rhythm is active\r\n        \r\n        // Musical time tracking\r\n        this.startTime = 0;                // When rhythm started\r\n        this.currentBeat = 0;              // Current beat number\r\n        this.currentBar = 0;               // Current bar/measure number\r\n        this.beatProgress = 0;             // Progress within current beat (0-1)\r\n        this.barProgress = 0;              // Progress within current bar (0-1)\r\n        \r\n        // Timing calculations\r\n        this.beatDuration = 60000 / this.bpm;  // Milliseconds per beat\r\n        this.barDuration = this.beatDuration * this.timeSignature[0];\r\n        this.lastBeatTime = 0;             // Timestamp of last beat\r\n        this.nextBeatTime = 0;             // Timestamp of next beat\r\n        \r\n        // Event listeners\r\n        this.listeners = new Map();        // Event type -> Set of callbacks\r\n        this.beatCallbacks = new Set();    // Callbacks for every beat\r\n        this.barCallbacks = new Set();     // Callbacks for every bar\r\n        \r\n        // Subdivisions for finer timing\r\n        this.subdivisions = {\r\n            sixteenth: 0,    // 16th note position\r\n            eighth: 0,       // 8th note position\r\n            triplet: 0,      // Triplet position\r\n            swing: 0         // Swing timing offset\r\n        };\r\n        \r\n        // Sync state\r\n        this.audioSync = null;             // External audio sync source\r\n        this.syncOffset = 0;               // Timing offset for sync\r\n        this.autoSync = false;             // Auto-detect tempo from audio\r\n        \r\n        // Musical dynamics\r\n        this.intensity = 1.0;              // Current musical intensity (0-1)\r\n        this.groove = 0;                   // Groove/swing amount (0-1)\r\n        this.humanize = 0.05;              // Timing humanization factor\r\n        \r\n        // Pattern tracking\r\n        this.patterns = new Map();         // Named rhythm patterns\r\n        this.currentPattern = null;        // Active rhythm pattern\r\n        \r\n        // Initialize default patterns\r\n        this.initializePatterns();\r\n    }\r\n    \r\n    /**\r\n     * Initialize default rhythm patterns\r\n     */\r\n    initializePatterns() {\r\n        // Basic patterns - these are just timing references\r\n        // Actual animations define their own responses to these patterns\r\n        \r\n        // Common time signatures\r\n        this.patterns.set('4/4', {\r\n            name: '4/4',\r\n            description: 'Common time - 4 beats per bar',\r\n            timeSignature: [4, 4],\r\n            groove: 0,\r\n            accents: [1, 0.5, 0.7, 0.5]  // Beat emphasis pattern\r\n        });\r\n        \r\n        this.patterns.set('straight', {\r\n            name: 'straight',\r\n            description: 'Straight, even timing',\r\n            groove: 0,\r\n            accents: [1, 0.5, 0.7, 0.5]  // Beat emphasis pattern\r\n        });\r\n        \r\n        this.patterns.set('swing', {\r\n            name: 'swing',\r\n            description: 'Swing/shuffle timing',\r\n            groove: 0.67,  // 2:1 swing ratio\r\n            accents: [1, 0.3, 0.8, 0.3]\r\n        });\r\n        \r\n        this.patterns.set('3/4', {\r\n            name: '3/4',\r\n            description: 'Waltz time - 3 beats per bar',\r\n            timeSignature: [3, 4],\r\n            accents: [1, 0.5, 0.5]\r\n        });\r\n        \r\n        this.patterns.set('waltz', {\r\n            name: 'waltz',\r\n            description: '3/4 waltz timing',\r\n            timeSignature: [3, 4],\r\n            accents: [1, 0.5, 0.5]\r\n        });\r\n        \r\n        this.patterns.set('6/8', {\r\n            name: '6/8',\r\n            description: 'Compound duple time',\r\n            timeSignature: [6, 8],\r\n            accents: [1, 0.3, 0.3, 0.7, 0.3, 0.3]\r\n        });\r\n        \r\n        this.patterns.set('5/4', {\r\n            name: '5/4',\r\n            description: 'Complex meter - 5 beats per bar',\r\n            timeSignature: [5, 4],\r\n            accents: [1, 0.5, 0.6, 0.5, 0.7]\r\n        });\r\n        \r\n        this.patterns.set('7/8', {\r\n            name: '7/8',\r\n            description: 'Irregular meter',\r\n            timeSignature: [7, 8],\r\n            accents: [1, 0.5, 0.5, 0.7, 0.5, 0.5, 0.6]\r\n        });\r\n        \r\n        this.patterns.set('dubstep', {\r\n            name: 'dubstep',\r\n            description: 'Dubstep half-time feel',\r\n            accents: [0.2, 0.2, 1, 0.2],  // Heavy on beat 3\r\n            subdivisions: { wobble: true }\r\n        });\r\n        \r\n        this.patterns.set('breakbeat', {\r\n            name: 'breakbeat',\r\n            description: 'Broken beat pattern',\r\n            accents: [1, 0.2, 0.7, 0.9, 0.2, 0.8, 0.4, 0.2]\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Start the rhythm engine\r\n     */\r\n    start() {\r\n        if (this.isPlaying) return;\r\n\r\n        this.isPlaying = true;\r\n        this.isRunning = true; // Add explicit running flag\r\n        this.startTime = performance.now();\r\n        this.lastBeatTime = this.startTime;\r\n        this.nextBeatTime = this.startTime + this.beatDuration;\r\n        this.currentBeat = 0;\r\n        this.currentBar = 0;\r\n\r\n        // Emit start event\r\n        this.emit('start', {\r\n            bpm: this.bpm,\r\n            timeSignature: this.timeSignature,\r\n            pattern: this.currentPattern\r\n        });\r\n\r\n        // Start update loop\r\n        this.update();\r\n    }\r\n    \r\n    /**\r\n     * Stop the rhythm engine\r\n     */\r\n    stop() {\r\n        if (!this.isPlaying) return;\r\n        \r\n        this.isPlaying = false;\r\n        this.emit('stop', {\r\n            totalBeats: this.currentBeat,\r\n            totalBars: this.currentBar\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Main update loop\r\n     */\r\n    update() {\r\n        if (!this.isPlaying) return;\r\n        \r\n        const now = performance.now();\r\n        const elapsed = now - this.startTime;\r\n        \r\n        // Calculate musical time positions\r\n        const beatsSinceStart = elapsed / this.beatDuration;\r\n        const newBeat = Math.floor(beatsSinceStart);\r\n        this.beatProgress = beatsSinceStart % 1;\r\n        \r\n        // Check for beat change\r\n        if (newBeat > this.currentBeat) {\r\n            this.onBeat(newBeat);\r\n        }\r\n        \r\n        // Calculate bar position\r\n        const newBar = Math.floor(newBeat / this.timeSignature[0]);\r\n        if (newBar > this.currentBar) {\r\n            this.onBar(newBar);\r\n        }\r\n        \r\n        this.currentBeat = newBeat;\r\n        this.currentBar = newBar;\r\n        this.barProgress = (newBeat % this.timeSignature[0]) / this.timeSignature[0];\r\n        \r\n        // Calculate subdivisions\r\n        this.updateSubdivisions();\r\n        \r\n        // Emit continuous update\r\n        this.emit('update', this.getTimeInfo());\r\n        \r\n        // Continue loop only if still playing\r\n        if (this.isPlaying) {\r\n            requestAnimationFrame(() => this.update());\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle beat event\r\n     */\r\n    onBeat(beatNumber) {\r\n        const beatInBar = beatNumber % this.timeSignature[0];\r\n        const accent = this.getAccent(beatInBar);\r\n        \r\n        // Add humanization\r\n        const humanTiming = this.humanize * (Math.random() - 0.5) * this.beatDuration;\r\n        \r\n        const beatInfo = {\r\n            beat: beatNumber,\r\n            beatInBar: beatInBar,\r\n            bar: this.currentBar,\r\n            accent: accent,\r\n            intensity: this.intensity * accent,\r\n            humanTiming: humanTiming,\r\n            timestamp: performance.now()\r\n        };\r\n        \r\n        // Emit beat event\r\n        this.emit('beat', beatInfo);\r\n        \r\n        // Call beat callbacks\r\n        this.beatCallbacks.forEach(callback => callback(beatInfo));\r\n        \r\n        // Update timing\r\n        this.lastBeatTime = performance.now();\r\n        this.nextBeatTime = this.lastBeatTime + this.beatDuration;\r\n    }\r\n    \r\n    /**\r\n     * Handle bar event\r\n     */\r\n    onBar(barNumber) {\r\n        const barInfo = {\r\n            bar: barNumber,\r\n            timeSignature: this.timeSignature,\r\n            pattern: this.currentPattern,\r\n            timestamp: performance.now()\r\n        };\r\n        \r\n        // Emit bar event\r\n        this.emit('bar', barInfo);\r\n        \r\n        // Call bar callbacks\r\n        this.barCallbacks.forEach(callback => callback(barInfo));\r\n    }\r\n    \r\n    /**\r\n     * Update subdivision timings\r\n     */\r\n    updateSubdivisions() {\r\n        // Calculate subdivision positions within beat\r\n        this.subdivisions.sixteenth = (this.beatProgress * 4) % 1;\r\n        this.subdivisions.eighth = (this.beatProgress * 2) % 1;\r\n        this.subdivisions.triplet = (this.beatProgress * 3) % 1;\r\n        \r\n        // Apply swing/groove\r\n        if (this.groove > 0) {\r\n            const swingRatio = 0.5 + this.groove * 0.17; // Max 67% swing\r\n            if (this.subdivisions.eighth < 0.5) {\r\n                this.subdivisions.swing = this.subdivisions.eighth / swingRatio;\r\n            } else {\r\n                this.subdivisions.swing = 0.5 + (this.subdivisions.eighth - 0.5) / (1 - swingRatio);\r\n            }\r\n        } else {\r\n            this.subdivisions.swing = this.subdivisions.eighth;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get accent level for beat position\r\n     */\r\n    getAccent(beatInBar) {\r\n        if (this.currentPattern && this.patterns.has(this.currentPattern)) {\r\n            const pattern = this.patterns.get(this.currentPattern);\r\n            if (pattern.accents && pattern.accents[beatInBar] !== undefined) {\r\n                return pattern.accents[beatInBar];\r\n            }\r\n        }\r\n        \r\n        // Default accent pattern (strong on 1, medium on 3 in 4/4)\r\n        if (beatInBar === 0) return 1.0;\r\n        if (beatInBar === 2 && this.timeSignature[0] === 4) return 0.7;\r\n        return 0.5;\r\n    }\r\n    \r\n    /**\r\n     * Get current time information\r\n     */\r\n    getTimeInfo() {\r\n        return {\r\n            // Absolute time\r\n            elapsed: performance.now() - this.startTime,\r\n            \r\n            // Musical time\r\n            beat: this.currentBeat,\r\n            bar: this.currentBar,\r\n            beatInBar: this.currentBeat % this.timeSignature[0],\r\n            \r\n            // Progress values (0-1)\r\n            beatProgress: this.beatProgress,\r\n            barProgress: this.barProgress,\r\n            \r\n            // Subdivisions\r\n            subdivisions: { ...this.subdivisions },\r\n            \r\n            // Timing info\r\n            bpm: this.bpm,\r\n            beatDuration: this.beatDuration,\r\n            timeSignature: [...this.timeSignature],\r\n            \r\n            // Musical properties\r\n            intensity: this.intensity,\r\n            groove: this.groove,\r\n            pattern: this.currentPattern,\r\n            \r\n            // Next beat timing\r\n            nextBeatIn: this.nextBeatTime - performance.now(),\r\n            \r\n            // Accent for current beat\r\n            accent: this.getAccent(this.currentBeat % this.timeSignature[0])\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Set BPM (beats per minute)\r\n     */\r\n    setBPM(bpm) {\r\n        this.bpm = Math.max(20, Math.min(360, bpm));\r\n        this.beatDuration = 60000 / this.bpm;\r\n        this.barDuration = this.beatDuration * this.timeSignature[0];\r\n        \r\n        this.emit('tempoChange', { bpm: this.bpm });\r\n    }\r\n    \r\n    /**\r\n     * Set time signature\r\n     */\r\n    setTimeSignature(numerator, denominator) {\r\n        this.timeSignature = [numerator, denominator];\r\n        this.barDuration = this.beatDuration * numerator;\r\n        \r\n        this.emit('timeSignatureChange', { \r\n            timeSignature: this.timeSignature \r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Set rhythm pattern\r\n     */\r\n    setPattern(patternName) {\r\n        if (!this.patterns.has(patternName)) {\r\n            return;\r\n        }\r\n        \r\n        const pattern = this.patterns.get(patternName);\r\n        this.currentPattern = patternName;\r\n        \r\n        // Apply pattern settings\r\n        if (pattern.timeSignature) {\r\n            this.setTimeSignature(...pattern.timeSignature);\r\n        }\r\n        if (pattern.groove !== undefined) {\r\n            this.groove = pattern.groove;\r\n        }\r\n        \r\n        this.emit('patternChange', { pattern: patternName });\r\n    }\r\n    \r\n    /**\r\n     * Register for beat events\r\n     */\r\n    onBeatCallback(callback) {\r\n        this.beatCallbacks.add(callback);\r\n        return () => this.beatCallbacks.delete(callback);\r\n    }\r\n    \r\n    /**\r\n     * Register for bar events\r\n     */\r\n    onBarCallback(callback) {\r\n        this.barCallbacks.add(callback);\r\n        return () => this.barCallbacks.delete(callback);\r\n    }\r\n    \r\n    /**\r\n     * Emit event to listeners\r\n     */\r\n    emit(event, data) {\r\n        if (this.listeners.has(event)) {\r\n            this.listeners.get(event).forEach(callback => callback(data));\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Listen for events\r\n     */\r\n    on(event, callback) {\r\n        if (!this.listeners.has(event)) {\r\n            this.listeners.set(event, new Set());\r\n        }\r\n        this.listeners.get(event).add(callback);\r\n        \r\n        // Return unsubscribe function\r\n        return () => {\r\n            if (this.listeners.has(event)) {\r\n                this.listeners.get(event).delete(callback);\r\n            }\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Sync to audio source (stub for future implementation)\r\n     */\r\n    syncToAudio(audioContext, audioSource) {\r\n        this.audioSync = { context: audioContext, source: audioSource };\r\n        // Future: Implement beat detection and tempo extraction\r\n    }\r\n    \r\n    /**\r\n     * Get rhythm adapter for subsystems\r\n     * Returns timing info and utilities for rhythm-aware animations\r\n     */\r\n    getAdapter() {\r\n        return {\r\n            // Current time info\r\n            getTimeInfo: () => this.getTimeInfo(),\r\n            \r\n            // Check if on beat (with tolerance)\r\n            isOnBeat: (tolerance = 0.1) => {\r\n                return this.beatProgress < tolerance || this.beatProgress > (1 - tolerance);\r\n            },\r\n            \r\n            // Check if on specific subdivision\r\n            isOnSubdivision: (subdivision, tolerance = 0.1) => {\r\n                const value = this.subdivisions[subdivision] || 0;\r\n                return value < tolerance || value > (1 - tolerance);\r\n            },\r\n            \r\n            // Get interpolated value synced to beat\r\n            getBeatSync: (min = 0, max = 1, curve = 'linear') => {\r\n                let progress = this.beatProgress;\r\n                \r\n                // Apply curve\r\n                switch(curve) {\r\n                    case 'ease':\r\n                        progress = 0.5 - Math.cos(progress * Math.PI) / 2;\r\n                        break;\r\n                    case 'bounce':\r\n                        progress = Math.abs(Math.sin(progress * Math.PI));\r\n                        break;\r\n                    case 'pulse':\r\n                        progress = Math.pow(Math.sin(progress * Math.PI), 2);\r\n                        break;\r\n                }\r\n                \r\n                return min + (max - min) * progress;\r\n            },\r\n            \r\n            // Get value with musical accent\r\n            getAccentedValue: (baseValue, accentMultiplier = 2) => {\r\n                const accent = this.getAccent(this.currentBeat % this.timeSignature[0]);\r\n                return baseValue * (1 + (accent - 0.5) * accentMultiplier);\r\n            },\r\n            \r\n            // Subscribe to beat events\r\n            onBeat: (callback) => this.onBeatCallback(callback),\r\n            onBar: (callback) => this.onBarCallback(callback),\r\n            \r\n            // Musical time utilities\r\n            beatsToMs: (beats) => beats * this.beatDuration,\r\n            msToBeats: (ms) => ms / this.beatDuration,\r\n            \r\n            // Current musical state\r\n            isPlaying: () => this.isPlaying,\r\n            getBPM: () => this.bpm,\r\n            getPattern: () => this.currentPattern\r\n        };\r\n    }\r\n}\r\n\r\n// Create singleton instance\r\nconst rhythmEngine = new RhythmEngine();\r\n\r\n// Export both the engine and the class\r\nexport { rhythmEngine, RhythmEngine };\r\nexport default rhythmEngine;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Rhythm Integration Module\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n * \r\n * @fileoverview Integration layer between rhythm engine and existing subsystems\r\n * @author Emotive Engine Team\r\n * @module core/rhythmIntegration\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ CONCEPT                                                                           \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ This module connects the rhythm engine to existing subsystems without modifying   \r\n * ║ their core behavior. It reads rhythm configurations from individual files and     \r\n * ║ applies timing modulations based on musical events.                              \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n * \r\n * INTEGRATION POINTS:\r\n * • Particle System - Emission timing, behavior modulation\r\n * • Gesture System - Animation sync, duration adjustment\r\n * • Emotion System - Intensity mapping, transition timing\r\n * • Renderer - Glow pulsing, visual effects sync\r\n * \r\n * ┌──────────────────────────────────────────────────────────────────────────────────┐\r\n * │  MODULAR RHYTHM FLOW                                                             │\r\n * │                                                                                   │\r\n * │  gesture.js ──┐                                                                  │\r\n * │  emotion.js ──┼→ [Integration] ← [Rhythm Engine]                                │\r\n * │  behavior.js ─┘         ↓                                                        │\r\n * │                   Apply Timing                                                   │\r\n * │                                                                                   │\r\n * └──────────────────────────────────────────────────────────────────────────────────┘\r\n */\r\n\r\nimport rhythmEngine from './rhythm.js';\r\n\r\nclass RhythmIntegration {\r\n    constructor() {\r\n        this.enabled = false;\r\n        this.adapter = null;\r\n        this.subsystemConfigs = new Map();\r\n        this.activeModulations = new Map();\r\n    }\r\n    \r\n    /**\r\n     * Initialize rhythm integration\r\n     */\r\n    initialize() {\r\n        this.adapter = rhythmEngine.getAdapter();\r\n        this.enabled = true;\r\n        \r\n        // Subscribe to rhythm events\r\n        this.adapter.onBeat(this.handleBeat.bind(this));\r\n        this.adapter.onBar(this.handleBar.bind(this));\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Update BPM from detected audio\r\n     * @param {number} newBPM - Detected BPM from audio analysis\r\n     */\r\n    updateBPM(newBPM) {\r\n        if (newBPM >= 60 && newBPM <= 220) {\r\n            // Check if rhythm was manually stopped\r\n            if (window.rhythmManuallyStoppedForCurrentAudio) {\r\n                return; // Don't auto-update if manually stopped\r\n            }\r\n\r\n            // Auto-start rhythm engine if not running\r\n            if (!rhythmEngine.isRunning) {\r\n\r\n                // Auto-start the rhythm engine for gesture sync\r\n                this.start(newBPM, 'straight');\r\n\r\n                // Trigger the rhythm sync visualizer to show BPM\r\n                if (window.rhythmSyncVisualizer && !window.rhythmSyncVisualizer.state.active) {\r\n                    console.log('RhythmIntegration: Auto-starting rhythm sync visualizer with BPM:', newBPM);\r\n                    window.rhythmSyncVisualizer.start();\r\n                }\r\n\r\n                return;\r\n            }\r\n            \r\n            // If running, always update BPM regardless of whether it changed\r\n            // This ensures new tracks get their correct BPM\r\n            rhythmEngine.setBPM(newBPM);\r\n            \r\n            // BPM is now shown visually through the beat histogram bars\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Register a subsystem's rhythm configuration\r\n     * Called when loading gestures, emotions, behaviors, etc.\r\n     */\r\n    registerConfig(type, name, config) {\r\n        if (!config.rhythm || !config.rhythm.enabled) return;\r\n        \r\n        const key = `${type}:${name}`;\r\n        this.subsystemConfigs.set(key, {\r\n            type,\r\n            name,\r\n            rhythmConfig: config.rhythm,\r\n            originalConfig: config\r\n        });\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Apply rhythm modulation to a gesture\r\n     */\r\n    applyGestureRhythm(gesture, particle, progress, dt) {\r\n        if (!this.enabled || !gesture.rhythm?.enabled) return {};\r\n        \r\n        const timeInfo = this.adapter.getTimeInfo();\r\n        const rhythmConfig = gesture.rhythm;\r\n        const modulation = {};\r\n        \r\n        // Apply amplitude sync\r\n        if (rhythmConfig.amplitudeSync) {\r\n            const sync = rhythmConfig.amplitudeSync;\r\n            const beatSync = this.adapter.getBeatSync(\r\n                sync.offBeat || 0.8,\r\n                sync.onBeat || 1.5,\r\n                sync.curve || 'linear'\r\n            );\r\n            modulation.amplitudeMultiplier = beatSync;\r\n        }\r\n        \r\n        // Apply wobble sync\r\n        if (rhythmConfig.wobbleSync) {\r\n            const sync = rhythmConfig.wobbleSync;\r\n            if (this.adapter.isOnSubdivision(sync.subdivision, 0.1)) {\r\n                modulation.wobbleMultiplier = 1 + sync.intensity;\r\n            } else {\r\n                modulation.wobbleMultiplier = 1;\r\n            }\r\n        }\r\n        \r\n        // Apply accent response\r\n        if (rhythmConfig.accentResponse?.enabled) {\r\n            const accentedValue = this.adapter.getAccentedValue(\r\n                1,\r\n                rhythmConfig.accentResponse.multiplier || 1.5\r\n            );\r\n            modulation.accentMultiplier = accentedValue;\r\n        }\r\n        \r\n        // Apply pattern overrides\r\n        const currentPattern = this.adapter.getPattern();\r\n        if (currentPattern && rhythmConfig.patternOverrides?.[currentPattern]) {\r\n            Object.assign(modulation, rhythmConfig.patternOverrides[currentPattern]);\r\n        }\r\n        \r\n        return modulation;\r\n    }\r\n    \r\n    /**\r\n     * Apply rhythm modulation to particle emission\r\n     */\r\n    applyParticleRhythm(emotionState, particleSystem) {\r\n        if (!this.enabled || !emotionState.rhythm?.enabled) return {};\r\n        \r\n        const timeInfo = this.adapter.getTimeInfo();\r\n        const rhythmConfig = emotionState.rhythm;\r\n        const modulation = {};\r\n        \r\n        // Particle emission sync\r\n        if (rhythmConfig.particleEmission) {\r\n            const emission = rhythmConfig.particleEmission;\r\n            \r\n            if (emission.syncMode === 'beat' && this.adapter.isOnBeat(0.1)) {\r\n                // Emit burst on beat\r\n                modulation.emitBurst = emission.burstSize || 3;\r\n            } else if (emission.offBeatRate !== undefined) {\r\n                // Reduce emission between beats\r\n                modulation.emissionRate = emission.offBeatRate;\r\n            }\r\n        }\r\n        \r\n        // Glow sync\r\n        if (rhythmConfig.glowSync) {\r\n            const glow = rhythmConfig.glowSync;\r\n            const glowIntensity = this.adapter.getBeatSync(\r\n                glow.intensityRange[0] || 1.0,\r\n                glow.intensityRange[1] || 2.0,\r\n                'pulse'\r\n            );\r\n            modulation.glowIntensity = glowIntensity;\r\n        }\r\n        \r\n        // Breathing sync\r\n        if (rhythmConfig.breathSync?.mode === 'bars') {\r\n            const breath = rhythmConfig.breathSync;\r\n            const barsElapsed = timeInfo.bar % breath.barsPerBreath;\r\n            const breathProgress = barsElapsed / breath.barsPerBreath;\r\n            modulation.breathPhase = breathProgress * Math.PI * 2;\r\n        }\r\n        \r\n        return modulation;\r\n    }\r\n    \r\n    /**\r\n     * Apply rhythm to particle behavior\r\n     */\r\n    applyBehaviorRhythm(behavior, particle, dt) {\r\n        if (!this.enabled || !behavior.rhythm?.enabled) return {};\r\n        \r\n        const timeInfo = this.adapter.getTimeInfo();\r\n        const rhythmConfig = behavior.rhythm;\r\n        const modulation = {};\r\n        \r\n        // Glitch timing for glitchy behavior\r\n        if (rhythmConfig.glitchTiming) {\r\n            const glitch = rhythmConfig.glitchTiming;\r\n            const isOnSubdivision = this.adapter.isOnSubdivision(glitch.subdivision, 0.05);\r\n            \r\n            if (isOnSubdivision && Math.random() < glitch.probability) {\r\n                const intensity = this.adapter.isOnBeat() \r\n                    ? glitch.intensityOnBeat \r\n                    : glitch.intensityOffBeat;\r\n                modulation.triggerGlitch = true;\r\n                modulation.glitchIntensity = intensity;\r\n            }\r\n        }\r\n        \r\n        // Orbital rhythm\r\n        if (rhythmConfig.orbitRhythm) {\r\n            const orbit = rhythmConfig.orbitRhythm;\r\n            \r\n            if (orbit.baseSpeed === 'tempo') {\r\n                modulation.speedMultiplier = this.adapter.getBPM() / 120; // Normalize to 120 BPM\r\n            }\r\n            \r\n            if (orbit.beatAcceleration && this.adapter.isOnBeat(0.1)) {\r\n                modulation.speedBoost = orbit.beatAcceleration;\r\n            }\r\n            \r\n            if (orbit.barReset && timeInfo.beatInBar === 0) {\r\n                modulation.resetOrbit = true;\r\n            }\r\n        }\r\n        \r\n        // Stutter sync\r\n        if (rhythmConfig.stutterSync) {\r\n            const stutter = rhythmConfig.stutterSync;\r\n            const pattern = this.adapter.getPattern();\r\n            \r\n            if (pattern && stutter.patterns?.[pattern]) {\r\n                const patternConfig = stutter.patterns[pattern];\r\n                \r\n                if (patternConfig.freezeOnDrop && timeInfo.beatInBar === 2) {\r\n                    modulation.freeze = true;\r\n                    modulation.freezeDuration = patternConfig.dropDuration;\r\n                } else if (patternConfig.randomFreeze && Math.random() < patternConfig.randomFreeze) {\r\n                    modulation.freeze = true;\r\n                    modulation.freezeDuration = patternConfig.duration;\r\n                }\r\n            }\r\n        }\r\n        \r\n        return modulation;\r\n    }\r\n    \r\n    /**\r\n     * Handle beat event\r\n     */\r\n    handleBeat(beatInfo) {\r\n        // Store beat info for subsystems to access\r\n        this.lastBeatInfo = beatInfo;\r\n        \r\n        // Could trigger specific effects here if needed\r\n        // But mainly subsystems will query rhythm state during their update\r\n    }\r\n    \r\n    /**\r\n     * Handle bar event\r\n     */\r\n    handleBar(barInfo) {\r\n        // Store bar info for subsystems to access\r\n        this.lastBarInfo = barInfo;\r\n    }\r\n    \r\n    /**\r\n     * Get duration adjusted for musical time\r\n     */\r\n    getMusicalDuration(rhythmConfig, originalDuration) {\r\n        if (!this.enabled || !rhythmConfig?.durationSync) return originalDuration;\r\n        \r\n        const sync = rhythmConfig.durationSync;\r\n        \r\n        if (sync.mode === 'bars') {\r\n            return this.adapter.beatsToMs(sync.bars * 4); // Assuming 4/4 time\r\n        } else if (sync.mode === 'beats') {\r\n            return this.adapter.beatsToMs(sync.beats);\r\n        }\r\n        \r\n        return originalDuration;\r\n    }\r\n    \r\n    /**\r\n     * Check if rhythm is enabled globally\r\n     */\r\n    isEnabled() {\r\n        return this.enabled && this.adapter.isPlaying();\r\n    }\r\n    \r\n    /**\r\n     * Start rhythm playback\r\n     */\r\n    start(bpm = 120, pattern = 'straight') {\r\n        if (bpm) rhythmEngine.setBPM(bpm);\r\n        if (pattern) rhythmEngine.setPattern(pattern);\r\n        rhythmEngine.start();\r\n        this.enabled = true;\r\n    }\r\n    \r\n    /**\r\n     * Stop rhythm playback\r\n     */\r\n    stop() {\r\n        rhythmEngine.stop();\r\n        this.enabled = false;\r\n        // Unlock BPM when stopping\r\n        this.bpmLocked = false;\r\n        this.lockedBPM = null;\r\n    }\r\n    \r\n    /**\r\n     * Set rhythm pattern\r\n     */\r\n    setPattern(pattern) {\r\n        rhythmEngine.setPattern(pattern);\r\n    }\r\n    \r\n    /**\r\n     * Set BPM\r\n     */\r\n    setBPM(bpm) {\r\n        rhythmEngine.setBPM(bpm);\r\n        // Update the locked BPM if manually changed\r\n        if (this.bpmLocked) {\r\n            this.lockedBPM = bpm;\r\n            console.log('🔒 BPM manually updated to:', bpm);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Resample BPM - unlocks detection for one update\r\n     */\r\n    resampleBPM() {\r\n        console.log('🔓 Unlocking BPM for resampling');\r\n        this.bpmLocked = false;\r\n        this.lockedBPM = null;\r\n    }\r\n    \r\n    /**\r\n     * Set time signature from detected pattern\r\n     */\r\n    setTimeSignature(signature) {\r\n        this.timeSignature = signature;\r\n        \r\n        // Update UI if available\r\n        const timeSigDisplay = document.getElementById('time-sig-display');\r\n        if (timeSigDisplay) {\r\n            timeSigDisplay.textContent = signature;\r\n        }\r\n        \r\n        // Could update rhythm patterns based on time signature here\r\n        // For example, switch to waltz pattern for 3/4\r\n        if (signature === '3/4' && rhythmEngine.getPattern() !== 'waltz') {\r\n            // Could auto-switch to waltz pattern\r\n            // rhythmEngine.setPattern('waltz');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Sync to external audio\r\n     */\r\n    syncToAudio(audioContext, audioSource) {\r\n        rhythmEngine.syncToAudio(audioContext, audioSource);\r\n    }\r\n}\r\n\r\n// Create singleton instance\r\nconst rhythmIntegration = new RhythmIntegration();\r\n\r\nexport { rhythmIntegration, RhythmIntegration };\r\nexport default rhythmIntegration;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Modular Particle System with 3D Depth\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Orchestrator for the modular particle system with z-coordinate depth\r\n * @author Emotive Engine Team\r\n * @module core/Particle-modular\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                               MODULAR ARCHITECTURE                                \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ This is a drop-in replacement for the original Particle.js                        \r\n * ║ Same API, but with modular architecture for easier maintenance                    \r\n * ║                                                                                    \r\n * ║ STRUCTURE:                                                                         \r\n * ║ - Particle class (this file) - orchestrates everything                            \r\n * ║ - particles/behaviors/* - behavior modules                                     \r\n * ║ - particles/config/* - configuration constants                                    \r\n * ║ - particles/utils/* - utility functions                                           \r\n * ║ - gestures/* - modular gesture system                                             \r\n * ║                                                                                    \r\n * ║ 3D DEPTH SYSTEM:                                                                   \r\n * ║ - Z-coordinate ranges from -1 (behind orb) to +1 (in front)                       \r\n * ║ - 1/13 particles spawn in foreground, 12/13 in background                         \r\n * ║ - Depth affects visual size (20% scaling based on z)                              \r\n * ║ - Foreground particles spawn with offset to prevent stacking                      \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\n// Import behaviors\r\nimport { initializeBehavior, updateBehavior } from './particles/behaviors/index.js';\r\n\r\n// Import utilities\r\nimport { selectWeightedColor } from './particles/utils/colorUtils.js';\r\n\r\n// Import config\r\nimport { PHYSICS } from './particles/config/physics.js';\r\n\r\n// Import gesture system - NOW USING MODULAR GESTURES!\r\nimport { \r\n    applyGestureMotion as applyFullGestureMotion,\r\n    isGestureOverriding,\r\n    isGestureBlending \r\n} from './gestures/GestureMotion.js';\r\n\r\n/**\r\n * Particle class - Individual particle with behavior and rendering\r\n * \r\n * LIFECYCLE:\r\n * 1. Created by ParticleSystem with position and behavior\r\n * 2. Initialized with behavior-specific properties\r\n * 3. Updated each frame (position, behavior, lifecycle)\r\n * 4. Rendered to canvas\r\n * 5. Removed when life reaches 0\r\n */\r\nclass Particle {\r\n    /**\r\n     * Creates a new particle with specific behavior and appearance\r\n     * \r\n     * @param {number} x - Starting X position on canvas\r\n     * @param {number} y - Starting Y position on canvas\r\n     * @param {string} behavior - Behavior type (ambient, rising, falling, etc.)\r\n     * @param {number} scaleFactor - Global scale multiplier (affects size/distance)\r\n     * @param {number} particleSizeMultiplier - Additional size multiplier\r\n     * @param {Array} emotionColors - Array of color options with weights\r\n     */\r\n    constructor(x, y, behavior = 'ambient', scaleFactor = 1, particleSizeMultiplier = 1, emotionColors = null) {\r\n        // Position and movement (now with z-coordinate for depth)\r\n        // 1/13 chance of being in front (z > 0), 12/13 chance of being behind (z < 0)\r\n        const zRoll = Math.random();\r\n        this.z = zRoll < (1/13) ? 0.5 + Math.random() * 0.5 : -1 + Math.random() * 0.9;\r\n        \r\n        // Add spawn offset to prevent stacking\r\n        // Much larger offset for foreground particles to completely avoid visual stacking\r\n        const spawnRadius = this.z > 0 ? (20 + Math.random() * 20) * scaleFactor : 3 * scaleFactor;\r\n        const angle = Math.random() * Math.PI * 2;\r\n        this.x = x + Math.cos(angle) * spawnRadius;\r\n        this.y = y + Math.sin(angle) * spawnRadius;\r\n        this.vx = 0;\r\n        this.vy = 0;\r\n        this.vz = 0; // For future 3D motion effects\r\n        \r\n        // Lifecycle\r\n        this.life = 0.0; // Start at 0 for fade-in\r\n        this.maxLife = 1.0;\r\n        this.lifeDecay = 0.01; // Life lost per frame\r\n        this.fadeInTime = 0.15; // 15% of life for fade-in\r\n        this.fadeOutTime = 0.3; // Last 30% of life for fade-out\r\n        this.isFadingOut = false; // Track if particle is in fade-out phase\r\n        this.age = 0; // Track particle age for smooth fading\r\n        \r\n        // Visual properties - matching original Emotive scale\r\n        this.scaleFactor = scaleFactor;\r\n        this.particleSizeMultiplier = particleSizeMultiplier;\r\n        this.size = (4 + Math.random() * 6) * scaleFactor * particleSizeMultiplier; // 4-10 pixels scaled\r\n        this.baseSize = this.size;\r\n        this.emotionColors = emotionColors; // Store emotion colors for use in behaviors\r\n        this.color = '#ffffff';\r\n        this.opacity = 1.0;\r\n        \r\n        // Glow properties - 1/3 of particles have glow with varying sizes\r\n        this.hasGlow = Math.random() < 0.333;  // 1/3 chance of glow\r\n        this.glowSizeMultiplier = this.hasGlow ? (1.33 + Math.random() * 0.33) : 0;  // 1.33x to 1.66x particle size\r\n        \r\n        // Cell shading - 1/3 of particles are cell shaded (cartoon style)\r\n        this.isCellShaded = Math.random() < 0.333;  // 1/3 chance of cell shading\r\n        \r\n        // Make particles more ephemeral\r\n        this.baseOpacity = 0.3 + Math.random() * 0.4;  // 30-70% max opacity for ethereal look\r\n        \r\n        // Color caching for performance\r\n        this.cachedColors = new Map(); // Cache RGBA strings\r\n        this.lastColor = null;\r\n        this.lastOpacity = -1;\r\n        \r\n        // Behavior properties\r\n        this.behavior = behavior;\r\n        this.behaviorData = {}; // Behavior-specific data\r\n        \r\n        // Gesture properties for motion system\r\n        this.gestureData = {\r\n            initialX: x,\r\n            initialY: y\r\n        };\r\n        \r\n        // Initialize behavior-specific properties\r\n        initializeBehavior(this, behavior);\r\n    }\r\n\r\n    /**\r\n     * Updates particle position and behavior\r\n     * @param {number} deltaTime - Time since last update in milliseconds\r\n     * @param {number} centerX - Center X coordinate for behavior calculations\r\n     * @param {number} centerY - Center Y coordinate for behavior calculations\r\n     * @param {Object} undertoneModifier - Optional undertone modifications\r\n     * @param {Object} gestureMotion - Optional gesture motion to apply\r\n     * @param {number} gestureProgress - Progress of the gesture (0-1)\r\n     */\r\n    update(deltaTime, centerX, centerY, undertoneModifier = null, gestureMotion = null, gestureProgress = 0) {\r\n        // Cap deltaTime to prevent huge jumps\r\n        const cappedDeltaTime = Math.min(deltaTime, 50);\r\n        // Normalize to 60 FPS equivalent for consistent physics\r\n        const dt = cappedDeltaTime / 16.67; // 16.67ms = 60 FPS frame time\r\n        \r\n        // Universal law: Gestures override state behavior based on their motion type\r\n        // Use the modular gesture system to determine gesture behavior\r\n        const gestureIsOverriding = gestureMotion && gestureMotion.type && gestureProgress > 0 && \r\n            isGestureOverriding(gestureMotion.type);\r\n        \r\n        if (gestureIsOverriding) {\r\n            // Gesture completely controls particle - skip normal behavior\r\n            this.applyGestureMotion(gestureMotion, gestureProgress, dt, centerX, centerY);\r\n        } else if (this.gestureBehavior === 'falling') {\r\n            // Rain gesture is active - use falling behavior instead of normal behavior\r\n            updateBehavior(this, 'falling', dt, centerX, centerY);\r\n        } else if (this.gestureBehavior === 'radiant') {\r\n            // Shimmer gesture is active - use radiant behavior for shimmering effect\r\n            updateBehavior(this, 'radiant', dt, centerX, centerY);\r\n        } else {\r\n            // Normal behavior update\r\n            updateBehavior(this, this.behavior, dt, centerX, centerY);\r\n            \r\n            // Don't apply undertone modifications to particle motion\r\n            // Undertones only affect color saturation and core behaviors\r\n            \r\n            // Apply non-overriding gesture motion if present\r\n            if (gestureMotion && gestureProgress > 0) {\r\n                this.applyGestureMotion(gestureMotion, gestureProgress, dt, centerX, centerY);\r\n            }\r\n        }\r\n        \r\n        // Apply velocity to position (unless gesture is directly controlling position)\r\n        if (!gestureIsOverriding) {\r\n            this.x += this.vx * dt;\r\n            this.y += this.vy * dt;\r\n        }\r\n        \r\n        // HARD BOUNDARY CONSTRAINTS - particles NEVER leave canvas\r\n        const canvasWidth = centerX * 2;\r\n        const canvasHeight = centerY * 2;\r\n        const margin = 20;\r\n        \r\n        // Bounce off boundaries\r\n        if (this.x - this.size < margin) {\r\n            this.x = margin + this.size;\r\n            this.vx = Math.abs(this.vx) * 0.5;\r\n        } else if (this.x + this.size > canvasWidth - margin) {\r\n            this.x = canvasWidth - margin - this.size;\r\n            this.vx = -Math.abs(this.vx) * 0.5;\r\n        }\r\n        \r\n        if (this.y - this.size < margin) {\r\n            this.y = margin + this.size;\r\n            this.vy = Math.abs(this.vy) * 0.5;\r\n        } else if (this.y + this.size > canvasHeight - margin) {\r\n            this.y = canvasHeight - margin - this.size;\r\n            this.vy = -Math.abs(this.vy) * 0.5;\r\n        }\r\n        \r\n        // Update age and life (EXACT COPY FROM ORIGINAL)\r\n        this.age += this.lifeDecay * dt;\r\n        \r\n        // Smooth fade-in at birth\r\n        if (this.age < this.fadeInTime) {\r\n            this.life = this.age / this.fadeInTime;\r\n        }\r\n        // Full opacity in middle of life\r\n        else if (this.age < (1.0 - this.fadeOutTime)) {\r\n            this.life = 1.0;\r\n        }\r\n        // Smooth fade-out at death\r\n        else {\r\n            this.life = (1.0 - this.age) / this.fadeOutTime;\r\n            this.isFadingOut = true;\r\n            \r\n            // Dynamic size reduction for popcorn during fade-out\r\n            if (this.behavior === 'popcorn') {\r\n                this.size = this.baseSize * (0.5 + 0.5 * this.life);\r\n            }\r\n        }\r\n        \r\n        this.life = Math.max(0, Math.min(1, this.life));\r\n        \r\n        // Update opacity with easing for extra smoothness\r\n        this.opacity = this.easeInOutCubic(this.life);\r\n        \r\n        // Update size based on life for some behaviors\r\n        if (this.behavior === 'burst' && this.behaviorData && this.life < this.behaviorData.fadeStart) {\r\n            this.size = this.baseSize * (this.life / this.behaviorData.fadeStart);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * DEPRECATED - Undertones no longer affect particle motion\r\n     * Kept for compatibility but does nothing\r\n     * @param {number} dt - Normalized delta time\r\n     * @param {Object} modifier - Undertone modifier settings\r\n     */\r\n    applyUndertoneModifier(dt, modifier) {\r\n        // Undertones no longer affect particles\r\n        // They only affect color saturation and core behaviors\r\n        return;\r\n    }\r\n\r\n    /**\r\n     * Apply gesture motion to particle\r\n     * @param {Object} motion - Gesture motion configuration\r\n     * @param {number} progress - Gesture progress (0-1)\r\n     * @param {number} dt - Normalized delta time\r\n     * @param {number} centerX - Orb center X\r\n     * @param {number} centerY - Orb center Y\r\n     */\r\n    applyGestureMotion(motion, progress, dt, centerX, centerY) {\r\n        // Use the full gesture system from the original\r\n        applyFullGestureMotion(this, dt, motion, progress, centerX, centerY);\r\n    }\r\n\r\n    /**\r\n     * Check if particle is out of bounds\r\n     * @param {number} width - Canvas width\r\n     * @param {number} height - Canvas height\r\n     * @returns {boolean} True if particle is out of bounds\r\n     */\r\n    isOutOfBounds(width, height) {\r\n        const margin = 50; // Allow some margin for particles to re-enter\r\n        return this.x < -margin || this.x > width + margin || \r\n               this.y < -margin || this.y > height + margin;\r\n    }\r\n\r\n    /**\r\n     * Check if particle is still alive\r\n     * @returns {boolean} True if particle life > 0\r\n     */\r\n    isAlive() {\r\n        return this.life > 0;\r\n    }\r\n\r\n    /**\r\n     * Set outward velocity for gesture effects\r\n     * @param {number} angle - Direction angle in radians\r\n     */\r\n    setOutwardVelocity(angle) {\r\n        if (this.behaviorData && this.behaviorData.outwardSpeed !== undefined) {\r\n            const speed = this.behaviorData.outwardSpeed;\r\n            this.vx = Math.cos(angle) * speed;\r\n            this.vy = Math.sin(angle) * speed + (this.behaviorData.upwardBias || 0);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get depth-adjusted size for 3D effect\r\n     * Particles farther away (negative z) appear smaller for depth perception\r\n     * \r\n     * @returns {number} Adjusted size based on z-depth\r\n     * \r\n     * DEPTH SCALING:\r\n     * - z = -1.0: 80% size (farthest back)\r\n     * - z =  0.0: 100% size (orb plane)\r\n     * - z = +1.0: 120% size (closest to viewer)\r\n     */\r\n    getDepthAdjustedSize() {\r\n        // Map z from [-1, 1] to scale [0.8, 1.2]\r\n        // Negative z (behind) = smaller, positive z (front) = larger\r\n        const depthScale = 1 + (this.z * 0.2);\r\n        return this.size * depthScale;\r\n    }\r\n    \r\n    /**\r\n     * Get particle state for debugging\r\n     * @returns {Object} Current particle state\r\n     */\r\n    getState() {\r\n        return {\r\n            position: { x: this.x, y: this.y, z: this.z },\r\n            velocity: { x: this.vx, y: this.vy, z: this.vz },\r\n            life: this.life,\r\n            behavior: this.behavior,\r\n            size: this.size,\r\n            opacity: this.opacity\r\n        };\r\n    }\r\n\r\n\r\n    /**\r\n     * Reset particle for reuse from pool\r\n     * @param {number} x - New X position\r\n     * @param {number} y - New Y position\r\n     * @param {string} behavior - New behavior type\r\n     * @param {number} scaleFactor - Scale factor\r\n     * @param {number} particleSizeMultiplier - Size multiplier\r\n     * @param {Array} emotionColors - Emotion colors\r\n     */\r\n    reset(x, y, behavior = 'ambient', scaleFactor = 1, particleSizeMultiplier = 1, emotionColors = null) {\r\n        // 1/13 chance of being in front (z > 0), 12/13 chance of being behind (z < 0)\r\n        const zRoll = Math.random();\r\n        this.z = zRoll < (1/13) ? 0.5 + Math.random() * 0.5 : -1 + Math.random() * 0.9;\r\n        \r\n        // Add spawn offset to prevent stacking\r\n        // Much larger offset for foreground particles to completely avoid visual stacking\r\n        const spawnRadius = this.z > 0 ? (20 + Math.random() * 20) * scaleFactor : 3 * scaleFactor;\r\n        const angle = Math.random() * Math.PI * 2;\r\n        this.x = x + Math.cos(angle) * spawnRadius;\r\n        this.y = y + Math.sin(angle) * spawnRadius;\r\n        this.vx = 0;\r\n        this.vy = 0;\r\n        this.vz = 0;\r\n        this.life = 0.0;  // Start at 0 for fade-in\r\n        this.age = 0;  // Reset age\r\n        this.scaleFactor = scaleFactor;\r\n        this.particleSizeMultiplier = particleSizeMultiplier;\r\n        this.size = (4 + Math.random() * 6) * scaleFactor * particleSizeMultiplier;  // Scaled size\r\n        this.baseSize = this.size;\r\n        this.emotionColors = emotionColors;  // Store emotion colors\r\n        \r\n        // Clear cached colors for reuse\r\n        this.cachedColors.clear();\r\n        this.opacity = 0.0;  // Start invisible\r\n        this.isFadingOut = false;\r\n        this.baseOpacity = 0.3 + Math.random() * 0.4;  // Reset base opacity\r\n        this.color = '#ffffff';  // Reset color to white before reinitializing\r\n        this.behavior = behavior;\r\n        \r\n        // Clear gesture data if it exists\r\n        this.gestureData = null;\r\n        \r\n        // Reset behavior data\r\n        if (!this.behaviorData) {\r\n            this.behaviorData = {};\r\n        } else {\r\n            // Clear existing properties\r\n            for (let key in this.behaviorData) {\r\n                delete this.behaviorData[key];\r\n            }\r\n        }\r\n        \r\n        // Reinitialize behavior\r\n        initializeBehavior(this, behavior);\r\n    }\r\n\r\n    /**\r\n     * Get cached color string for performance\r\n     * @param {string} hexColor - Hex color code\r\n     * @param {number} opacity - Opacity value (0-1)\r\n     * @returns {string} RGBA color string\r\n     */\r\n    getCachedColor(hexColor, opacity) {\r\n        // Round opacity to reduce cache entries\r\n        const roundedOpacity = Math.round(opacity * 100) / 100;\r\n        const cacheKey = `${hexColor}_${roundedOpacity}`;\r\n        \r\n        if (!this.cachedColors.has(cacheKey)) {\r\n            this.cachedColors.set(cacheKey, this.hexToRgba(hexColor, roundedOpacity));\r\n        }\r\n        \r\n        return this.cachedColors.get(cacheKey);\r\n    }\r\n\r\n    /**\r\n     * Convert hex color to RGBA string\r\n     * @param {string} hex - Hex color code\r\n     * @param {number} alpha - Alpha value (0-1)\r\n     * @returns {string} RGBA color string\r\n     */\r\n    hexToRgba(hex, alpha) {\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        if (!result) return `rgba(255, 255, 255, ${alpha})`;\r\n        \r\n        return `rgba(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}, ${alpha})`;\r\n    }\r\n\r\n    /**\r\n     * Cubic ease in/out function for smooth animations\r\n     * @param {number} t - Progress value (0-1)\r\n     * @returns {number} Eased value (0-1)\r\n     */\r\n    easeInOutCubic(t) {\r\n        return t < 0.5 \r\n            ? 4 * t * t * t \r\n            : 1 - Math.pow(-2 * t + 2, 3) / 2;\r\n    }\r\n\r\n    /**\r\n     * Render the particle to canvas\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {string} emotionColor - Color to use for rendering\r\n     */\r\n    render(ctx, emotionColor = '#ffffff') {\r\n        if (this.life <= 0) return;\r\n        \r\n        // Validate position values to prevent rendering errors\r\n        if (!isFinite(this.x) || !isFinite(this.y)) {\r\n            return;\r\n        }\r\n        \r\n        // Use sub-pixel accurate coordinates for smooth rendering\r\n        const renderX = this.x;\r\n        const renderY = this.y;\r\n        \r\n        // Ensure size is never negative\r\n        const safeSize = Math.max(0.1, this.size);\r\n        \r\n        // Use the particle's own color if set, otherwise fall back to emotion color\r\n        const particleColor = this.tempColor || this.color || emotionColor;\r\n        \r\n        ctx.save();\r\n        \r\n        if (this.isCellShaded) {\r\n            // Cell shaded style - hard edges, no gradients\r\n            \r\n            // Draw outline (darker color)\r\n            ctx.strokeStyle = this.getCachedColor(particleColor, this.opacity * 0.9);\r\n            ctx.lineWidth = 2;\r\n            ctx.beginPath();\r\n            ctx.arc(renderX, renderY, safeSize, 0, Math.PI * 2);\r\n            ctx.stroke();\r\n            \r\n            // Draw flat color fill with discrete opacity levels\r\n            const discreteOpacity = Math.floor(this.opacity * 3) / 3;\r\n            ctx.fillStyle = this.getCachedColor(particleColor, discreteOpacity * (this.baseOpacity || 0.5) * 0.5);\r\n            ctx.beginPath();\r\n            ctx.arc(renderX, renderY, Math.max(0.1, safeSize - 1), 0, Math.PI * 2);\r\n            ctx.fill();\r\n            \r\n            // Add hard-edged highlight\r\n            if (discreteOpacity > 0.5) {\r\n                ctx.fillStyle = this.getCachedColor('#FFFFFF', 0.3);\r\n                ctx.beginPath();\r\n                ctx.arc(renderX - safeSize * 0.3, renderY - safeSize * 0.3, safeSize * 0.3, 0, Math.PI * 2);\r\n                ctx.fill();\r\n            }\r\n        } else {\r\n            // Standard gradient style\r\n            \r\n            // Create radial gradient for soft particle\r\n            const gradient = ctx.createRadialGradient(renderX, renderY, 0, renderX, renderY, safeSize);\r\n            \r\n            // Core is full opacity with base opacity applied\r\n            gradient.addColorStop(0, this.getCachedColor(particleColor, this.opacity * (this.baseOpacity || 0.5)));\r\n            // Mid fade\r\n            gradient.addColorStop(0.5, this.getCachedColor(particleColor, this.opacity * (this.baseOpacity || 0.5) * 0.5));\r\n            // Edge is transparent\r\n            gradient.addColorStop(1, this.getCachedColor(particleColor, 0));\r\n            \r\n            ctx.fillStyle = gradient;\r\n            ctx.beginPath();\r\n            ctx.arc(renderX, renderY, safeSize, 0, Math.PI * 2);\r\n            ctx.fill();\r\n            \r\n            // Add glow effect if enabled\r\n            if (this.hasGlow && this.glowSizeMultiplier > 0) {\r\n                const glowSize = safeSize * this.glowSizeMultiplier;\r\n                const glowGradient = ctx.createRadialGradient(renderX, renderY, safeSize * 0.5, renderX, renderY, glowSize);\r\n\r\n                // Make glow visible even when particles are subdued\r\n                // Use a minimum opacity for glow to ensure visibility\r\n                const minGlowOpacity = 0.3; // Minimum glow visibility\r\n                const particleOpacity = Math.max(minGlowOpacity, this.opacity);\r\n\r\n                // Scale glow intensity based on glowSizeMultiplier\r\n                // Higher multiplier = more intense glow (especially for gesture effects)\r\n                const glowIntensity = Math.min(1.0, this.glowSizeMultiplier / 3); // More aggressive scaling\r\n\r\n                // Create bright, visible glow with minimum opacity thresholds\r\n                glowGradient.addColorStop(0, this.getCachedColor(particleColor, Math.max(0.5, particleOpacity * 0.8) * glowIntensity));\r\n                glowGradient.addColorStop(0.25, this.getCachedColor(particleColor, Math.max(0.3, particleOpacity * 0.6) * glowIntensity));\r\n                glowGradient.addColorStop(0.5, this.getCachedColor(particleColor, Math.max(0.2, particleOpacity * 0.4) * glowIntensity));\r\n                glowGradient.addColorStop(0.75, this.getCachedColor(particleColor, Math.max(0.1, particleOpacity * 0.2) * glowIntensity));\r\n                glowGradient.addColorStop(1, this.getCachedColor(particleColor, 0));\r\n\r\n                // Use additive blending for brighter glow effect\r\n                ctx.save();\r\n                ctx.globalCompositeOperation = 'screen';\r\n                ctx.fillStyle = glowGradient;\r\n                ctx.beginPath();\r\n                ctx.arc(renderX, renderY, glowSize, 0, Math.PI * 2);\r\n                ctx.fill();\r\n                ctx.restore();\r\n            }\r\n        }\r\n        \r\n        ctx.restore();\r\n    }\r\n}\r\n\r\n// Export the Particle class as default\r\nexport default Particle;","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Gesture Motion Orchestrator\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Orchestrator for modular gesture system - replaces monolithic switch\n * @author Emotive Engine Team\n * @module gestures/GestureMotion\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ This orchestrator manages gesture application using the modular gesture system.   \n * ║ It replaces the old 538-line switch statement with clean, modular lookups.        \n * ║ Drop-in replacement for the old applyGestureMotion function.                      \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n */\n\nimport { getGesture, isBlendingGesture, isOverrideGesture } from './index.js';\nimport rhythmIntegration from '../rhythmIntegration.js';\n\n/**\n * Apply gesture motion to a particle using the modular system\n * This is a drop-in replacement for the old applyGestureMotion function\n * \n * @param {Particle} particle - The particle to animate\n * @param {number} dt - Delta time (normalized to 60fps)\n * @param {Object} motion - Gesture motion configuration\n * @param {number} progress - Gesture progress (0-1)\n * @param {number} centerX - Orb center X position\n * @param {number} centerY - Orb center Y position\n */\nexport function applyGestureMotion(particle, dt, motion, progress, centerX, centerY) {\n    // Validate inputs\n    if (!motion || !motion.type || progress >= 1) {\n        return;\n    }\n    \n    // Initialize gesture data if needed\n    if (!particle.gestureData) {\n        particle.gestureData = {\n            originalVx: particle.vx,\n            originalVy: particle.vy,\n            initialX: particle.x,\n            initialY: particle.y,\n            // For compatibility with gestures that expect these\n            startAngle: Math.atan2(particle.y - centerY, particle.x - centerX),\n            startRadius: Math.sqrt(Math.pow(particle.x - centerX, 2) + Math.pow(particle.y - centerY, 2))\n        };\n    }\n    \n    // Look up the gesture from registry\n    const gesture = getGesture(motion.type);\n    \n    if (!gesture) {\n        return;\n    }\n    \n    // Apply rhythm modulation if enabled\n    let rhythmModifiedMotion = motion;\n    if (rhythmIntegration.isEnabled() && gesture.rhythm?.enabled) {\n        const modulation = rhythmIntegration.applyGestureRhythm(gesture, particle, progress, dt);\n        \n        // Create modified motion with rhythm adjustments\n        rhythmModifiedMotion = {\n            ...motion,\n            amplitude: (motion.amplitude || 1) * (modulation.amplitudeMultiplier || 1) * (modulation.accentMultiplier || 1),\n            wobbleAmount: (motion.wobbleAmount || 0) * (modulation.wobbleMultiplier || 1),\n            // Allow rhythm to affect other parameters as needed\n            rhythmModulation: modulation\n        };\n    }\n    \n    // Apply the gesture using its modular implementation\n    if (gesture.apply) {\n        gesture.apply(particle, progress, rhythmModifiedMotion, dt, centerX, centerY);\n    }\n    \n    // Handle cleanup when gesture completes\n    if (progress >= 0.99 && gesture.cleanup) {\n        gesture.cleanup(particle);\n        // Reset gesture data for next gesture\n        particle.gestureData = null;\n    }\n}\n\n/**\n * Helper function to check if a gesture should override particle behavior\n * Used by Particle.js to determine update flow\n * \n * @param {string} gestureType - The gesture type name\n * @returns {boolean} True if gesture completely overrides particle motion\n */\nexport function isGestureOverriding(gestureType) {\n    return isOverrideGesture(gestureType);\n}\n\n/**\n * Helper function to check if a gesture blends with existing motion\n * Used by Particle.js to determine update flow\n * \n * @param {string} gestureType - The gesture type name\n * @returns {boolean} True if gesture blends with existing motion\n */\nexport function isGestureBlending(gestureType) {\n    return isBlendingGesture(gestureType);\n}\n\n/**\n * Get list of all available gesture types\n * Useful for debugging and UI generation\n * \n * @returns {Array<string>} Array of gesture type names\n */\nexport function getAvailableGestures() {\n    const gestures = [];\n    \n    // Import the registry to get all gestures\n    import('./index.js').then(module => {\n        const allGestures = module.listGestures();\n        allGestures.forEach(g => gestures.push(g.name));\n    });\n    \n    return gestures;\n}\n\n/**\n * Legacy compatibility layer\n * Maps old gesture motion configurations to new system\n * \n * @param {Object} motion - Old-style motion object\n * @returns {Object} Normalized motion object\n */\nfunction normalizeMotion(motion) {\n    // Handle legacy motion properties\n    const normalized = { ...motion };\n    \n    // Map legacy aliases to their primary gestures\n    if (motion.type === 'radial') {\n        normalized.type = 'pulse';\n    }\n    \n    if (motion.type === 'oscillate') {\n        normalized.type = 'bounce';\n        normalized.axis = motion.axis || 'vertical';\n    }\n    \n    if (motion.type === 'jitter') {\n        normalized.type = 'shake';\n    }\n    \n    return normalized;\n}\n\n/**\n * Main export - drop-in replacement for old applyGestureMotion\n * Includes legacy compatibility\n */\nexport default function(particle, dt, motion, progress, centerX, centerY) {\n    // Normalize motion for legacy compatibility\n    const normalizedMotion = normalizeMotion(motion);\n    \n    // Apply using modular system\n    applyGestureMotion(particle, dt, normalizedMotion, progress, centerX, centerY);\n}\n\n// Also export named function for clarity\nexport { applyGestureMotion as applyModularGestureMotion };","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                     ◐ ◑ ◒ ◓  PARTICLE SYSTEM  ◓ ◒ ◑ ◐                     \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Particle System - Orchestrator of Emotional Atmosphere with 3D Depth\r\n * @author Emotive Engine Team\r\n * @version 2.4.0\r\n * @module ParticleSystem\r\n * @changelog 2.4.0 - Added z-coordinate depth system with split rendering layers\r\n * @changelog 2.3.0 - Batch rendering optimization for reduced state changes\r\n * @changelog 2.2.0 - Added undertone saturation system for dynamic particle depth\r\n * @changelog 2.1.0 - Added support for passing emotion colors to individual particles\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The CONDUCTOR of particle chaos. Manages the lifecycle, behavior, and             \r\n * ║ performance of all particles. Uses object pooling to prevent memory leaks         \r\n * ║ and coordinates particles to create emotional atmospheres around the orb.         \r\n * ║                                                                                    \r\n * ║ NEW: Undertone saturation dynamically adjusts particle colors based on emotional  \r\n * ║ intensity, creating visual depth through saturation levels.                       \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎭 SYSTEM FEATURES                                                                \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Object pooling for performance (reuse dead particles)                           \r\n * │ • Time-based spawning with accumulator                                            \r\n * │ • Automatic cleanup every 5 seconds                                               \r\n * │ • Memory leak detection and prevention                                            \r\n * │ • Dynamic particle limits based on emotion                                        \r\n * │ • 13 different particle behaviors                                                 \r\n * │ • Undertone-based saturation adjustments for particle colors                      \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🔄 OBJECT POOL STRATEGY                                                           \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Lazy initialization (create as needed)                                          \r\n * │ • Max pool size: 50 particles                                                     \r\n * │ • Reuse dead particles before creating new                                        \r\n * │ • Track pool hits/misses for optimization                                         \r\n * │ • Absolute max: 2x configured limit (prevents runaway)                            \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 📊 PERFORMANCE LIMITS                                                             \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Default max particles  : 50                                                     \r\n * │ • Absolute max particles : 100 (2x default)                                       \r\n * │ • Pool size             : Min(maxParticles, 50)                                  \r\n * │ • Cleanup interval      : 5000ms                                                 \r\n * │ • Spawn rate            : Based on emotion config                                \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                              MEMORY MANAGEMENT                                    \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Critical for preventing memory leaks:                                             \r\n * ║ 1. Reuse particles from pool when available                                       \r\n * ║ 2. Clear references when returning to pool                                        \r\n * ║ 3. Periodic cleanup of excess particles                                           \r\n * ║ 4. Track creation/destruction for leak detection                                  \r\n * ║ 5. Hard limits prevent runaway particle creation                                  \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nimport Particle from './Particle.js';\r\nimport { applyUndertoneSaturationToArray } from '../utils/colorUtils.js';\r\nimport rhythmIntegration from './rhythmIntegration.js';\r\nimport { getEmotion } from './emotions/index.js';\r\n\r\nclass ParticleSystem {\r\n    constructor(maxParticles = 50, errorBoundary = null) {\r\n        this.errorBoundary = errorBoundary;\r\n        this.maxParticles = maxParticles;\r\n        this.absoluteMaxParticles = maxParticles * 2; // Hard limit to prevent leaks\r\n        \r\n        // Active particles\r\n        this.particles = [];\r\n        \r\n        // Object pool for performance - reduced to prevent memory buildup\r\n        this.pool = [];\r\n        this.poolSize = Math.min(maxParticles, 50); // Limit pool to max 50 particles\r\n        \r\n        // Memory leak detection\r\n        this.totalParticlesCreated = 0;\r\n        this.totalParticlesDestroyed = 0;\r\n        this.stateChangeCount = 0;\r\n        this.lastMemoryCheck = Date.now();\r\n        this.lastLeakedCount = 0;\r\n        \r\n        // TIME-BASED spawning using accumulation for smooth, consistent particle creation\r\n        this.spawnAccumulator = 0; // Accumulates time to spawn particles\r\n        \r\n        // Performance tracking\r\n        this.particleCount = 0;\r\n        this.poolHits = 0;\r\n        this.poolMisses = 0;\r\n        \r\n        // Cleanup timer to prevent memory buildup\r\n        this.cleanupTimer = 0;\r\n        this.cleanupInterval = 5000; // Clean up every 5 seconds\r\n        \r\n        // Initialize object pool\r\n        this.initializePool();\r\n        \r\n        // ParticleSystem initialized\r\n    }\r\n\r\n    /**\r\n     * Initialize the object pool with pre-created particles\r\n     */\r\n    initializePool() {\r\n        // Don't pre-create particles - create them lazily as needed\r\n        // This prevents memory buildup on initialization\r\n        this.pool = [];\r\n    }\r\n\r\n    /**\r\n     * Gets a particle from the pool or creates a new one\r\n     * @param {number} x - X position\r\n     * @param {number} y - Y position\r\n     * @param {string} behavior - Particle behavior type\r\n     * @returns {Particle} Particle instance\r\n     */\r\n    getParticleFromPool(x, y, behavior) {\r\n        let particle;\r\n        \r\n        if (this.pool.length > 0) {\r\n            // Reuse from pool\r\n            particle = this.pool.pop();\r\n            particle.reset(x, y, behavior, this.scaleFactor || 1, this.particleSizeMultiplier || 1, this.currentEmotionColors);\r\n            this.poolHits++;\r\n        } else {\r\n            // Create new particle\r\n            particle = new Particle(x, y, behavior, this.scaleFactor || 1, this.particleSizeMultiplier || 1, this.currentEmotionColors);\r\n            this.poolMisses++;\r\n            this.totalParticlesCreated++;\r\n        }\r\n        \r\n        // Set the emotion for behavior customization\r\n        particle.emotion = this.currentEmotion;\r\n        \r\n        // Apply gesture behavior if active (e.g., doppler for rain)\r\n        if (this.gestureBehavior) {\r\n            particle.gestureBehavior = this.gestureBehavior;\r\n        }\r\n        \r\n        return particle;\r\n    }\r\n\r\n    /**\r\n     * Returns a particle to the pool for reuse\r\n     * @param {Particle} particle - Particle to return to pool\r\n     */\r\n    returnParticleToPool(particle) {\r\n        if (this.pool.length < this.poolSize) {\r\n            // Clear references before pooling\r\n            particle.cachedGradient = null;\r\n            particle.cachedGradientKey = null;\r\n            // Clear behaviorData properties but keep the object\r\n            if (particle.behaviorData) {\r\n                for (let key in particle.behaviorData) {\r\n                    delete particle.behaviorData[key];\r\n                }\r\n            }\r\n            this.pool.push(particle);\r\n        } else {\r\n            // If pool is full, count as destroyed since it will be GC'd\r\n            this.totalParticlesDestroyed++;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Spawns particles based on emotional state and particle rate\r\n     * NEW APPROACH: Fixed timestep - only spawn at specific intervals\r\n     * \r\n     * @param {string} behavior - Particle behavior type (ambient, rising, falling, etc.)\r\n     * @param {string} emotion - Current emotional state\r\n     * @param {number} particleRate - Rate of particle spawning (particles per second at 60fps)\r\n     * @param {number} centerX - X coordinate of spawn center\r\n     * @param {number} centerY - Y coordinate of spawn center\r\n     * @param {number} deltaTime - Time since last frame in milliseconds\r\n     * @param {number|null} count - Force spawn this many particles (null for rate-based)\r\n     * @param {number} minParticles - Minimum particles to maintain\r\n     * @param {number} maxParticles - Maximum particles allowed\r\n     * @param {number} scaleFactor - Scale multiplier for particle sizes\r\n     * @param {number} particleSizeMultiplier - Additional size multiplier\r\n     * @param {Array|null} emotionColors - Array of color strings or weighted color objects\r\n     * @param {string|null} undertone - Emotional undertone for saturation adjustment\r\n     *                                   (intense, confident, nervous, clear, tired, subdued)\r\n     *                                   Affects particle color saturation to create depth\r\n     */\r\n    spawn(behavior, emotion, particleRate, centerX, centerY, deltaTime, count = null, minParticles = 0, maxParticles = 10, scaleFactor = 1, particleSizeMultiplier = 1, emotionColors = null, undertone = null) {\r\n        this.scaleFactor = scaleFactor; // Store for particle creation\r\n        this.particleSizeMultiplier = particleSizeMultiplier; // Store for particle sizing\r\n        if (this.errorBoundary) {\r\n            return this.errorBoundary.wrap(() => {\r\n                this._spawn(behavior, emotion, particleRate, centerX, centerY, deltaTime, count, minParticles, maxParticles, emotionColors, undertone);\r\n            }, 'particle-spawn')();\r\n        } else {\r\n            this._spawn(behavior, emotion, particleRate, centerX, centerY, deltaTime, count, minParticles, maxParticles, emotionColors, undertone);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Resets the spawn accumulator (for tab switches)\r\n     */\r\n    resetAccumulator() {\r\n        this.spawnAccumulator = 0;\r\n    }\r\n\r\n    /**\r\n     * Internal spawn implementation - TIME-BASED accumulation for smooth spawning\r\n     * \r\n     * Applies undertone saturation adjustments to particle colors before spawning.\r\n     * The saturation system creates visual depth:\r\n     * - Intense/Confident: Oversaturated colors appear to pop forward\r\n     * - Clear: Normal midtone colors sit in the middle ground  \r\n     * - Tired/Subdued: Desaturated colors recede into background\r\n     * \r\n     * This creates a natural transition as particles cycle through their lifecycle,\r\n     * with new particles spawning with current undertone saturation while existing\r\n     * particles maintain their original colors until expiration.\r\n     */\r\n    _spawn(behavior, emotion, particleRate, centerX, centerY, deltaTime, count, minParticles = 0, maxParticles = 10, emotionColors = null, undertone = null) {\r\n        // Store emotion for particle initialization\r\n        this.currentEmotion = emotion;\r\n        \r\n        // Debug logging for excited emotion\r\n        if (emotion === 'excited' && !this._excitedDebugLogged) {\r\n            console.log('[ParticleSystem] Excited emotion spawn:', {\r\n                behavior,\r\n                emotion,\r\n                particleRate,\r\n                minParticles,\r\n                maxParticles,\r\n                emotionColors,\r\n                currentParticleCount: this.particles.length\r\n            });\r\n            this._excitedDebugLogged = true;\r\n            setTimeout(() => { this._excitedDebugLogged = false; }, 5000); // Reset after 5 seconds\r\n        }\r\n        \r\n        // Store base colors and undertone separately to ensure consistent application\r\n        this.baseEmotionColors = emotionColors;\r\n        this.currentUndertone = undertone;\r\n        \r\n        // Apply undertone saturation to emotion colors for all particles\r\n        // This adjustment persists for the lifetime of each particle, creating\r\n        // smooth visual transitions as particles naturally cycle\r\n        this.currentEmotionColors = emotionColors && undertone ? \r\n            applyUndertoneSaturationToArray(emotionColors, undertone) : \r\n            emotionColors;\r\n        \r\n        // Apply rhythm modulation if enabled\r\n        let rhythmModulatedRate = particleRate;\r\n        if (rhythmIntegration.isEnabled()) {\r\n            const emotionConfig = getEmotion(emotion);\r\n            if (emotionConfig) {\r\n                const modulation = rhythmIntegration.applyParticleRhythm(emotionConfig, this);\r\n                \r\n                // Apply emission burst on beat\r\n                if (modulation.emitBurst) {\r\n                    for (let i = 0; i < modulation.emitBurst && this.particles.length < maxParticles; i++) {\r\n                        this.spawnSingleParticle(behavior, centerX, centerY);\r\n                    }\r\n                }\r\n                \r\n                // Modulate emission rate\r\n                if (modulation.emissionRate !== undefined) {\r\n                    rhythmModulatedRate *= modulation.emissionRate;\r\n                }\r\n            }\r\n        }\r\n        \r\n        \r\n        // If specific count is provided, spawn that many\r\n        if (count !== null) {\r\n            for (let i = 0; i < count && this.particles.length < this.maxParticles; i++) {\r\n                this.spawnSingleParticle(behavior, centerX, centerY);\r\n            }\r\n            return;\r\n        }\r\n        \r\n        // Skip spawning if frame rate is too low (performance optimization)\r\n        if (this.skipSpawnThisFrame) {\r\n            return;\r\n        }\r\n        \r\n        // Always maintain minimum particles\r\n        while (this.particles.length < minParticles && this.particles.length < this.maxParticles) {\r\n            this.spawnSingleParticle(behavior, centerX, centerY);\r\n        }\r\n        \r\n        // If we're at or above max for this emotion, don't spawn more\r\n        if (this.particles.length >= maxParticles) {\r\n            return;\r\n        }\r\n        \r\n        // Don't spawn if rate is 0\r\n        if (rhythmModulatedRate <= 0) return;\r\n        \r\n        // TIME-BASED SPAWNING using accumulation\r\n        // rhythmModulatedRate represents desired particles at 60 FPS\r\n        // So rate of 1 = 1 particle per 60 frames = 1 particle per second at 60fps\r\n        // Cap deltaTime to prevent huge accumulation spikes\r\n        const cappedDeltaTime = Math.min(deltaTime, 50);\r\n        const particlesPerSecond = rhythmModulatedRate; // Direct mapping: rate = particles/second\r\n        const particlesPerMs = particlesPerSecond / 1000;\r\n        \r\n        // Accumulate spawn time with capped delta\r\n        this.spawnAccumulator += particlesPerMs * cappedDeltaTime;\r\n        \r\n        // Cap accumulator to prevent excessive spawning after long pauses\r\n        this.spawnAccumulator = Math.min(this.spawnAccumulator, 3.0);\r\n        \r\n        // Spawn accumulated particles smoothly\r\n        while (this.spawnAccumulator >= 1.0 && this.particles.length < maxParticles) {\r\n            this.spawnSingleParticle(behavior, centerX, centerY);\r\n            this.spawnAccumulator -= 1.0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Spawns a single particle with the specified behavior\r\n     * @param {string} behavior - Particle behavior type\r\n     * @param {number} centerX - Center X coordinate\r\n     * @param {number} centerY - Center Y coordinate\r\n     */\r\n    spawnSingleParticle(behavior, centerX, centerY) {\r\n        // Hard limit check to prevent memory leaks\r\n        if (this.particles.length >= this.absoluteMaxParticles) {\r\n            return;\r\n        }\r\n        \r\n        // Calculate spawn position based on behavior\r\n        let spawnPos = this.getSpawnPosition(behavior, centerX, centerY);\r\n        \r\n        // CLAMP spawn position to canvas boundaries\r\n        const clampedPos = this.clampToCanvas(spawnPos.x, spawnPos.y, centerX, centerY);\r\n        spawnPos.x = clampedPos.x;\r\n        spawnPos.y = clampedPos.y;\r\n        \r\n        // Get particle from pool\r\n        const particle = this.getParticleFromPool(spawnPos.x, spawnPos.y, behavior);\r\n        \r\n        // Pass additional data for meditation_swirl\r\n        if (behavior === 'meditation_swirl' && spawnPos.palmCenter) {\r\n            particle.palmCenter = spawnPos.palmCenter;\r\n            particle.swirlAngle = spawnPos.swirlAngle;\r\n        }\r\n        \r\n        // Add to active particles\r\n        this.particles.push(particle);\r\n        this.particleCount++;\r\n        \r\n        // Debug logging disabled to prevent console spam\r\n        // Only uncomment for debugging particle spawning issues\r\n        // if (this.particleCount <= 3) {\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * Calculates spawn position based on behavior type\r\n     * @param {string} behavior - Particle behavior type\r\n     * @param {number} centerX - Center X coordinate\r\n     * @param {number} centerY - Center Y coordinate\r\n     * @returns {Object} Spawn position {x, y}\r\n     */\r\n    getSpawnPosition(behavior, centerX, centerY) {\r\n        // Calculate orb radius based on canvas size (matching EmotiveRenderer)\r\n        const canvasSize = Math.min(centerX * 2, centerY * 2);\r\n        const orbRadius = canvasSize / 12;  // Core radius\r\n        const glowRadius = orbRadius * 2.5; // Glow extends this far\r\n        \r\n        // CONSTRAIN spawn positions to stay within canvas boundaries\r\n        const canvasWidth = centerX * 2;\r\n        const canvasHeight = centerY * 2;\r\n        const margin = 30; // Keep spawns away from edges\r\n        \r\n        // Spawn particles outside the glow radius so they're visible\r\n        const minSpawnRadius = glowRadius * 1.1; // 10% beyond glow edge\r\n        const maxSpawnRadius = Math.min(glowRadius * 1.5, \r\n            centerX - margin, centerY - margin); // Constrain to canvas\r\n        \r\n        switch (behavior) {\r\n            case 'ambient':\r\n            case 'resting':\r\n                // Spawn at edge of glow where particles become visible\r\n                // They'll move outward to create \"emanating from center\" effect\r\n                const ambientAngle = Math.random() * Math.PI * 2;\r\n                const ambientRadius = glowRadius * 0.9; // Just at glow edge\r\n                return {\r\n                    x: centerX + Math.cos(ambientAngle) * ambientRadius,\r\n                    y: centerY + Math.sin(ambientAngle) * ambientRadius,\r\n                    angle: ambientAngle  // Pass angle for outward velocity\r\n                };\r\n                \r\n            case 'rising':\r\n            case 'falling':\r\n                // These can spawn from outside for visibility\r\n                const angle = Math.random() * Math.PI * 2;\r\n                const radius = minSpawnRadius + Math.random() * (maxSpawnRadius - minSpawnRadius);\r\n                return {\r\n                    x: centerX + Math.cos(angle) * radius,\r\n                    y: centerY + Math.sin(angle) * radius\r\n                };\r\n                \r\n            case 'aggressive':\r\n                // Spawn just outside the glow for aggressive burst effect\r\n                const aggressiveAngle = Math.random() * Math.PI * 2;\r\n                const aggressiveRadius = glowRadius + Math.random() * orbRadius;\r\n                return {\r\n                    x: centerX + Math.cos(aggressiveAngle) * aggressiveRadius,\r\n                    y: centerY + Math.sin(aggressiveAngle) * aggressiveRadius\r\n                };\r\n                \r\n            case 'scattering':\r\n                // Spawn at center for outward movement (scattering needs this)\r\n                return { x: centerX, y: centerY };\r\n                \r\n            case 'burst':\r\n                // Spawn at edge of orb so particles are visible\r\n                const burstAngle = Math.random() * Math.PI * 2;\r\n                if (this.currentEmotion === 'suspicion') {\r\n                    const burstRadius = orbRadius * 1.5; // Further outside for suspicion\r\n                    return {\r\n                        x: centerX + Math.cos(burstAngle) * burstRadius,\r\n                        y: centerY + Math.sin(burstAngle) * burstRadius\r\n                    };\r\n                } else if (this.currentEmotion === 'surprise') {\r\n                    // Surprise spawns around the orb edge for visibility\r\n                    const burstRadius = orbRadius * 1.2; // Just outside the orb\r\n                    return {\r\n                        x: centerX + Math.cos(burstAngle) * burstRadius,\r\n                        y: centerY + Math.sin(burstAngle) * burstRadius\r\n                    };\r\n                } else {\r\n                    // Other emotions spawn at center\r\n                    return { x: centerX, y: centerY };\r\n                }\r\n                \r\n            case 'repelling':\r\n                // Spawn at edge of glow so particles are visible\r\n                const repelAngle = Math.random() * Math.PI * 2;\r\n                const repelRadius = glowRadius * 0.9; // Just at glow edge\r\n                return {\r\n                    x: centerX + Math.cos(repelAngle) * repelRadius,\r\n                    y: centerY + Math.sin(repelAngle) * repelRadius\r\n                };\r\n                \r\n            case 'orbiting':\r\n                // Spawn at orbital distance outside the glow\r\n                const orbitAngle = Math.random() * Math.PI * 2;\r\n                const orbitRadius = glowRadius * 1.2 + Math.random() * glowRadius * 0.5;\r\n                return {\r\n                    x: centerX + Math.cos(orbitAngle) * orbitRadius,\r\n                    y: centerY + Math.sin(orbitAngle) * orbitRadius\r\n                };\r\n                \r\n            default:\r\n                return { x: centerX, y: centerY };\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clamps a position to stay within canvas boundaries\r\n     */\r\n    clampToCanvas(x, y, centerX, centerY, margin = 30) {\r\n        const canvasWidth = centerX * 2;\r\n        const canvasHeight = centerY * 2;\r\n        return {\r\n            x: Math.max(margin, Math.min(canvasWidth - margin, x)),\r\n            y: Math.max(margin, Math.min(canvasHeight - margin, y))\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Updates all particles and manages lifecycle\r\n     * @param {number} deltaTime - Time since last update in milliseconds\r\n     * @param {number} centerX - Center X coordinate for behavior calculations\r\n     * @param {number} centerY - Center Y coordinate for behavior calculations\r\n     * @param {Object} gestureMotion - Optional gesture motion to apply\r\n     * @param {number} gestureProgress - Progress of gesture (0-1)\r\n     * @param {Object} undertoneModifier - Optional undertone modifications\r\n     */\r\n    update(deltaTime, centerX, centerY, gestureMotion = null, gestureProgress = 0, undertoneModifier = null) {\r\n        if (this.errorBoundary) {\r\n            const wrappedUpdate = this.errorBoundary.wrap(\r\n                (dt, cx, cy, gm, gp, um) => this._update(dt, cx, cy, gm, gp, um), \r\n                'particle-update'\r\n            );\r\n            return wrappedUpdate(deltaTime, centerX, centerY, gestureMotion, gestureProgress, undertoneModifier);\r\n        } else {\r\n            this._update(deltaTime, centerX, centerY, gestureMotion, gestureProgress, undertoneModifier);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Internal update implementation\r\n     */\r\n    _update(deltaTime, centerX, centerY, gestureMotion = null, gestureProgress = 0, undertoneModifier = null) {\r\n        // Update cleanup timer\r\n        this.cleanupTimer += deltaTime;\r\n        \r\n        // Periodic cleanup to prevent memory buildup\r\n        if (this.cleanupTimer >= this.cleanupInterval) { // Clean up every 5 seconds\r\n            this.performCleanup();\r\n            this.cleanupTimer = 0;\r\n        }\r\n        \r\n        // Memory leak detection - log every 30 seconds (reduced frequency)\r\n        if (Date.now() - this.lastMemoryCheck > 30000) {\r\n            const leaked = this.totalParticlesCreated - this.totalParticlesDestroyed;\r\n            // Only warn if leak is significant and growing\r\n            if (leaked > 200 && leaked > this.lastLeakedCount + 50) {\r\n                this.lastLeakedCount = leaked;\r\n            }\r\n            this.lastMemoryCheck = Date.now();\r\n        }\r\n        \r\n        // Update all particles\r\n        for (let i = this.particles.length - 1; i >= 0; i--) {\r\n            const particle = this.particles[i];\r\n            \r\n            // Update particle with gesture motion and undertone modifier\r\n            particle.update(deltaTime, centerX, centerY, undertoneModifier, gestureMotion, gestureProgress);\r\n            \r\n            // Remove dead particles\r\n            if (!particle.isAlive()) {\r\n                this.removeParticle(i);\r\n            }\r\n        }\r\n        \r\n        // Enforce particle limit by removing oldest if necessary\r\n        while (this.particles.length > this.maxParticles) {\r\n            this.removeParticle(0); // Remove oldest (first in array)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set a temporary gesture behavior for particles\r\n     * @param {string} behaviorName - Name of the behavior (e.g., 'doppler')\r\n     * @param {boolean} active - Whether the behavior is active\r\n     */\r\n    setGestureBehavior(behaviorName, active) {\r\n        this.gestureBehavior = active ? behaviorName : null;\r\n        \r\n        // Apply gesture behavior to existing particles\r\n        if (active) {\r\n            this.particles.forEach(particle => {\r\n                particle.gestureBehavior = behaviorName;\r\n            });\r\n        } else {\r\n            // Clear gesture behavior from particles\r\n            this.particles.forEach(particle => {\r\n                particle.gestureBehavior = null;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes a particle at the specified index\r\n     * @param {number} index - Index of particle to remove\r\n     */\r\n    removeParticle(index) {\r\n        if (index >= 0 && index < this.particles.length) {\r\n            const particle = this.particles.splice(index, 1)[0];\r\n            // Clear any cached data before returning to pool\r\n            particle.cachedGradient = null;\r\n            particle.cachedGradientKey = null;\r\n            // Don't set behaviorData to null - let reset handle it properly\r\n            this.returnParticleToPool(particle);\r\n            this.particleCount = Math.max(0, this.particleCount - 1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders all particles to the canvas context\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas rendering context\r\n     * @param {string} emotionColor - Color to use for particle rendering\r\n     * @param {Object} gestureTransform - Optional gesture transform data\r\n     */\r\n    render(ctx, emotionColor = '#ffffff', gestureTransform = null) {\r\n        if (this.errorBoundary) {\r\n            return this.errorBoundary.wrap(() => {\r\n                this._render(ctx, emotionColor, gestureTransform);\r\n            }, 'particle-render')();\r\n        } else {\r\n            this._render(ctx, emotionColor, gestureTransform);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Renders particles in the background layer (behind orb)\r\n     * Particles with z < 0 are rendered, appearing smaller based on depth\r\n     * \r\n     * @param {CanvasRenderingContext2D} ctx - Canvas rendering context\r\n     * @param {string} emotionColor - Color to use for particle rendering\r\n     * \r\n     * LAYER DISTRIBUTION:\r\n     * - ~92% of particles render in background (z < 0)\r\n     * - Particles scale from 80% to 100% size based on z-depth\r\n     */\r\n    renderBackground(ctx, emotionColor = '#ffffff', gestureTransform = null) {\r\n        if (this.errorBoundary) {\r\n            return this.errorBoundary.wrap(() => {\r\n                this._renderLayer(ctx, emotionColor, false, gestureTransform); // false = background (z < 0)\r\n            }, 'particle-render-bg')();\r\n        } else {\r\n            this._renderLayer(ctx, emotionColor, false, gestureTransform);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Renders particles in the foreground layer (in front of orb)\r\n     * Particles with z >= 0 are rendered, appearing larger based on depth\r\n     * \r\n     * @param {CanvasRenderingContext2D} ctx - Canvas rendering context\r\n     * @param {string} emotionColor - Color to use for particle rendering\r\n     * \r\n     * LAYER DISTRIBUTION:\r\n     * - ~8% of particles render in foreground (z >= 0) \r\n     * - Particles scale from 100% to 120% size based on z-depth\r\n     * - Spawn with offset to prevent visual stacking\r\n     */\r\n    renderForeground(ctx, emotionColor = '#ffffff', gestureTransform = null) {\r\n        if (this.errorBoundary) {\r\n            return this.errorBoundary.wrap(() => {\r\n                this._renderLayer(ctx, emotionColor, true, gestureTransform); // true = foreground (z >= 0)\r\n            }, 'particle-render-fg')();\r\n        } else {\r\n            this._renderLayer(ctx, emotionColor, true, gestureTransform);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Internal render implementation for a specific layer\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas rendering context\r\n     * @param {string} emotionColor - Color to use for particle rendering\r\n     * @param {boolean} isForeground - true for foreground (z >= 0), false for background (z < 0)\r\n     */\r\n    _renderLayer(ctx, emotionColor, isForeground, gestureTransform = null) {\r\n        // Sort particles by rendering properties to minimize state changes\r\n        const visibleParticles = [];\r\n        \r\n        // First pass: cull off-screen, dead, and wrong-layer particles\r\n        const margin = 50;\r\n        const canvasWidth = ctx.canvas.width;\r\n        const canvasHeight = ctx.canvas.height;\r\n        \r\n        for (const particle of this.particles) {\r\n            // Filter by z-layer\r\n            const particleInForeground = particle.z >= 0;\r\n            if (particleInForeground !== isForeground) {\r\n                continue; // Skip particles in wrong layer\r\n            }\r\n            \r\n            // Skip off-screen particles (culling)\r\n            if (particle.x < -margin || particle.x > canvasWidth + margin ||\r\n                particle.y < -margin || particle.y > canvasHeight + margin) {\r\n                continue;\r\n            }\r\n            \r\n            // Skip dead particles\r\n            if (particle.life <= 0) continue;\r\n            \r\n            visibleParticles.push(particle);\r\n        }\r\n        \r\n        // Sort by render type to minimize state changes\r\n        visibleParticles.sort((a, b) => {\r\n            if (a.isCellShaded !== b.isCellShaded) {\r\n                return a.isCellShaded ? -1 : 1;\r\n            }\r\n            if (a.hasGlow !== b.hasGlow) {\r\n                return a.hasGlow ? -1 : 1;\r\n            }\r\n            return 0;\r\n        });\r\n        \r\n        // Actually render the particles\r\n        this._renderParticles(ctx, visibleParticles, emotionColor, gestureTransform);\r\n    }\r\n    \r\n    /**\r\n     * Internal render implementation - batch optimized rendering (legacy, renders all)\r\n     */\r\n    _render(ctx, emotionColor, gestureTransform = null) {\r\n        // Sort particles by rendering properties to minimize state changes\r\n        const visibleParticles = [];\r\n        \r\n        // First pass: cull off-screen and dead particles\r\n        const margin = 50;\r\n        const canvasWidth = ctx.canvas.width;\r\n        const canvasHeight = ctx.canvas.height;\r\n        \r\n        for (const particle of this.particles) {\r\n            // Skip off-screen particles (culling)\r\n            if (particle.x < -margin || particle.x > canvasWidth + margin ||\r\n                particle.y < -margin || particle.y > canvasHeight + margin) {\r\n                continue;\r\n            }\r\n            \r\n            // Skip dead particles\r\n            if (particle.life <= 0) continue;\r\n            \r\n            visibleParticles.push(particle);\r\n        }\r\n        \r\n        // Sort by render type to minimize state changes\r\n        // Group: cellShaded first, then by hasGlow, then by color\r\n        visibleParticles.sort((a, b) => {\r\n            if (a.isCellShaded !== b.isCellShaded) {\r\n                return a.isCellShaded ? -1 : 1;\r\n            }\r\n            if (a.hasGlow !== b.hasGlow) {\r\n                return a.hasGlow ? -1 : 1;\r\n            }\r\n            // Group by color to reduce fillStyle changes\r\n            const colorA = a.color || emotionColor;\r\n            const colorB = b.color || emotionColor;\r\n            if (colorA !== colorB) {\r\n                return colorA < colorB ? -1 : 1;\r\n            }\r\n            return 0;\r\n        });\r\n        \r\n        // Actually render the particles\r\n        this._renderParticles(ctx, visibleParticles, emotionColor, gestureTransform);\r\n    }\r\n    \r\n    /**\r\n     * Render a list of particles with batch optimization\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas rendering context\r\n     * @param {Array} visibleParticles - Array of particles to render\r\n     * @param {string} emotionColor - Color to use for particle rendering\r\n     * @param {Object} gestureTransform - Optional gesture transform data\r\n     */\r\n    _renderParticles(ctx, visibleParticles, emotionColor, gestureTransform = null) {\r\n        // Batch render with minimized state changes\r\n        ctx.save();\r\n        let lastFillStyle = null;\r\n        let lastStrokeStyle = null;\r\n        let lastLineWidth = null;\r\n\r\n        for (const particle of visibleParticles) {\r\n            // For cell-shaded, use original render (they need complex stroke/fill combos)\r\n            if (particle.isCellShaded) {\r\n                particle.render(ctx, emotionColor);\r\n                // Reset cached values since particle.render may have changed them\r\n                lastFillStyle = null;\r\n                lastStrokeStyle = null;\r\n                lastLineWidth = null;\r\n            } else {\r\n                // Batch-optimized rendering for regular particles\r\n                const particleColor = particle.color || emotionColor;\r\n                \r\n                // Only set fillStyle if it changed\r\n                if (particleColor !== lastFillStyle) {\r\n                    ctx.fillStyle = particleColor;\r\n                    lastFillStyle = particleColor;\r\n                }\r\n                \r\n                // Validate position once\r\n                if (!isFinite(particle.x) || !isFinite(particle.y)) continue;\r\n                \r\n                // Use depth-adjusted size if particle has the method\r\n                const depthSize = particle.getDepthAdjustedSize ? particle.getDepthAdjustedSize() : particle.size;\r\n                const safeSize = Math.max(0.1, depthSize);\r\n                \r\n                // Apply firefly effect if sparkle gesture is active\r\n                let fireflyGlow = 1.0;\r\n                if (gestureTransform && gestureTransform.fireflyEffect) {\r\n                    // Each particle gets unique phase for async firefly blinking\r\n                    const particlePhase = (particle.x * 0.01 + particle.y * 0.01 + particle.size * 0.1) % (Math.PI * 2);\r\n                    const time = gestureTransform.fireflyTime || (Date.now() * 0.001);\r\n                    const intensity = gestureTransform.particleGlow || 2.0;\r\n                    \r\n                    // Create firefly pulse pattern\r\n                    fireflyGlow = 0.3 + Math.max(0, Math.sin(time * 3 + particlePhase)) * intensity;\r\n                }\r\n                \r\n                // Apply flicker effect if flicker gesture is active (now does particle shimmer)\r\n                if (gestureTransform && gestureTransform.flickerEffect) {\r\n                    // Each particle shimmers with a wave pattern\r\n                    const particlePhase = (particle.x * 0.02 + particle.y * 0.02) % (Math.PI * 2);\r\n                    const time = gestureTransform.flickerTime || (Date.now() * 0.001);\r\n                    const intensity = gestureTransform.particleGlow || 2.0;\r\n                    \r\n                    // Create shimmer wave pattern - faster oscillation\r\n                    fireflyGlow = 0.5 + Math.sin(time * 12 + particlePhase) * intensity * 0.5;\r\n                }\r\n                \r\n                // Apply shimmer effect if shimmer gesture is active (subtle glow)\r\n                if (gestureTransform && gestureTransform.shimmerEffect) {\r\n                    // Each particle gets a subtle brightness variation based on distance from center\r\n                    const dx = particle.x - (ctx.canvas.width / 2);\r\n                    const dy = particle.y - (ctx.canvas.height / 2);\r\n                    const distance = Math.sqrt(dx * dx + dy * dy);\r\n                    const normalizedDistance = distance / 200; // Normalize to reasonable range\r\n                    \r\n                    const time = gestureTransform.shimmerTime || (Date.now() * 0.001);\r\n                    const wave = gestureTransform.shimmerWave || 0;\r\n                    const intensity = gestureTransform.particleGlow || 1.2;\r\n                    \r\n                    // Subtle traveling wave from center outward\r\n                    const travelingWave = Math.sin(time * 3 - normalizedDistance + wave);\r\n                    \r\n                    // Very subtle glow modulation\r\n                    fireflyGlow = 1 + travelingWave * 0.15 * intensity;\r\n                }\r\n                \r\n                // Apply glow effect if glow gesture is active (radiant burst)\r\n                if (gestureTransform && gestureTransform.glowEffect) {\r\n                    const envelope = gestureTransform.glowEnvelope || 0;\r\n                    const progress = gestureTransform.glowProgress || 0;\r\n                    const intensity = gestureTransform.particleGlow || 2.0;\r\n\r\n                    // Particles brighten based on distance - closer particles glow first\r\n                    const dx = particle.x - (ctx.canvas.width / 2);\r\n                    const dy = particle.y - (ctx.canvas.height / 2);\r\n                    const distance = Math.sqrt(dx * dx + dy * dy);\r\n                    const normalizedDistance = distance / 300;\r\n\r\n                    // Glow radiates outward\r\n                    const radiateDelay = Math.min(normalizedDistance * 0.3, 0.5);\r\n                    const localProgress = Math.max(0, (progress - radiateDelay) / (1 - radiateDelay));\r\n                    const localEnvelope = Math.sin(localProgress * Math.PI);\r\n\r\n                    // ACTUALLY MAKE PARTICLES GLOW by temporarily setting glow properties\r\n                    // Store original values if not already stored\r\n                    if (!particle._originalGlow) {\r\n                        particle._originalGlow = {\r\n                            hasGlow: particle.hasGlow,\r\n                            glowSizeMultiplier: particle.glowSizeMultiplier || 0\r\n                        };\r\n                    }\r\n\r\n                    // Enable glow and set a large multiplier for visibility\r\n                    particle.hasGlow = true;\r\n                    particle.glowSizeMultiplier = Math.max(3.0, particle._originalGlow.glowSizeMultiplier) + localEnvelope * intensity * 3;\r\n\r\n                    // Also boost particle size slightly\r\n                    const glowSizeBoost = 1 + localEnvelope * 0.3;\r\n                    safeSize = safeSize * glowSizeBoost;\r\n\r\n                    // Cleanup flag - restore original values when effect ends\r\n                    if (progress >= 0.99 && particle._originalGlow) {\r\n                        particle.hasGlow = particle._originalGlow.hasGlow;\r\n                        particle.glowSizeMultiplier = particle._originalGlow.glowSizeMultiplier;\r\n                        delete particle._originalGlow;\r\n                    }\r\n                }\r\n                \r\n                // Draw glow layers if needed\r\n                if (particle.hasGlow || fireflyGlow > 1.0) {\r\n                    const glowRadius = Math.max(0.1, safeSize * (particle.glowSizeMultiplier || 1.5) * fireflyGlow);\r\n                    \r\n                    // Outer glow (enhanced by firefly effect)\r\n                    ctx.globalAlpha = particle.opacity * 0.15 * fireflyGlow;\r\n                    ctx.beginPath();\r\n                    ctx.arc(particle.x, particle.y, glowRadius, 0, Math.PI * 2);\r\n                    ctx.fill();\r\n                    \r\n                    // Inner glow (enhanced by firefly effect)\r\n                    ctx.globalAlpha = particle.opacity * 0.25 * fireflyGlow;\r\n                    ctx.beginPath();\r\n                    ctx.arc(particle.x, particle.y, glowRadius * 0.6, 0, Math.PI * 2);\r\n                    ctx.fill();\r\n                }\r\n                \r\n                // Draw core (also brightened by firefly effect)\r\n                ctx.globalAlpha = particle.opacity * (particle.baseOpacity || 0.5) * 0.6 * Math.min(2.0, fireflyGlow);\r\n                ctx.beginPath();\r\n                ctx.arc(particle.x, particle.y, safeSize, 0, Math.PI * 2);\r\n                ctx.fill();\r\n            }\r\n        }\r\n        \r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Clears all particles and returns them to the pool\r\n     */\r\n    clear() {\r\n        this.stateChangeCount++;\r\n        \r\n        // Return all particles to pool but avoid duplicates\r\n        while (this.particles.length > 0) {\r\n            const particle = this.particles.pop();\r\n            // Clear cached data before returning\r\n            if (particle.cachedColors) {\r\n                particle.cachedColors.clear();\r\n            }\r\n            // Clear behaviorData properties but keep the object\r\n            if (particle.behaviorData) {\r\n                for (let key in particle.behaviorData) {\r\n                    delete particle.behaviorData[key];\r\n                }\r\n            }\r\n            // Only add to pool if it's not already there and pool has space\r\n            if (this.pool.length < this.poolSize && !this.pool.includes(particle)) {\r\n                this.pool.push(particle);\r\n            }\r\n        }\r\n        \r\n        this.particles.length = 0;\r\n        this.particleCount = 0;\r\n        this.spawnAccumulator = 0; // Reset accumulator when clearing\r\n        \r\n        // Trim pool if it's grown too large\r\n        if (this.pool.length > this.poolSize) {\r\n            // Actually remove excess particles from pool\r\n            const excess = this.pool.length - this.poolSize;\r\n            this.pool.splice(this.poolSize, excess);\r\n        }\r\n        \r\n    }\r\n\r\n    /**\r\n     * Triggers a burst of particles for gesture effects\r\n     * @param {number} count - Number of particles to burst\r\n     * @param {string} behavior - Behavior type for burst particles\r\n     * @param {number} centerX - Center X coordinate\r\n     * @param {number} centerY - Center Y coordinate\r\n     */\r\n    burst(count, behavior, centerX, centerY) {\r\n        if (this.errorBoundary) {\r\n            return this.errorBoundary.wrap(() => {\r\n                this._burst(count, behavior, centerX, centerY);\r\n            }, 'particle-burst')();\r\n        } else {\r\n            this._burst(count, behavior, centerX, centerY);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Internal burst implementation\r\n     */\r\n    _burst(count, behavior, centerX, centerY) {\r\n        const actualCount = Math.min(count, this.maxParticles - this.particles.length);\r\n        \r\n        for (let i = 0; i < actualCount; i++) {\r\n            this.spawnSingleParticle(behavior, centerX, centerY);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Performs periodic cleanup to prevent memory buildup\r\n     */\r\n    performCleanup() {\r\n        // Trim pool if it's grown too large\r\n        if (this.pool.length > this.poolSize) {\r\n            // Clear excess particles from pool\r\n            const excess = this.pool.length - this.poolSize;\r\n            for (let i = 0; i < excess; i++) {\r\n                const particle = this.pool.pop();\r\n                // Ensure all references are cleared\r\n                if (particle) {\r\n                    particle.cachedGradient = null;\r\n                    particle.cachedGradientKey = null;\r\n                    particle.behaviorData = null;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Clear any cached data from active particles\r\n        for (const particle of this.particles) {\r\n            if (particle.cachedGradient && particle.life < 0.5) {\r\n                // Clear gradient cache for fading particles\r\n                particle.cachedGradient = null;\r\n                particle.cachedGradientKey = null;\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Gets current particle system statistics\r\n     * @returns {Object} Performance and state information\r\n     */\r\n    getStats() {\r\n        return {\r\n            activeParticles: this.particles.length,\r\n            maxParticles: this.maxParticles,\r\n            poolSize: this.pool.length,\r\n            poolHits: this.poolHits,\r\n            poolMisses: this.poolMisses,\r\n            poolEfficiency: this.poolHits / Math.max(1, this.poolHits + this.poolMisses),\r\n            spawnAccumulator: this.spawnAccumulator\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Sets the maximum number of particles\r\n     * @param {number} maxParticles - New maximum particle count\r\n     */\r\n    setMaxParticles(maxParticles) {\r\n        this.originalMaxParticles = this.originalMaxParticles || this.maxParticles;\r\n        this.maxParticles = Math.max(1, maxParticles);\r\n        \r\n        // Remove excess particles if new limit is lower\r\n        while (this.particles.length > this.maxParticles) {\r\n            this.removeParticle(0);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Cleans up dead particles and optimizes the pool\r\n     */\r\n    cleanupDeadParticles() {\r\n        // Remove any dead particles that shouldn't be there\r\n        const beforeCount = this.particles.length;\r\n        this.particles = this.particles.filter(particle => particle.isAlive());\r\n        const removed = beforeCount - this.particles.length;\r\n        \r\n        // Clear excess items from the pool to free memory\r\n        if (this.pool.length > 20) {\r\n            this.pool.length = 20;\r\n        }\r\n        \r\n        return removed;\r\n    }\r\n\r\n    /**\r\n     * Gets particles by behavior type for debugging\r\n     * @param {string} behavior - Behavior type to filter by\r\n     * @returns {Array} Particles with matching behavior\r\n     */\r\n    getParticlesByBehavior(behavior) {\r\n        return this.particles.filter(particle => particle.behavior === behavior);\r\n    }\r\n\r\n    /**\r\n     * Validates that all particles are in valid state\r\n     * @returns {boolean} True if all particles are valid\r\n     */\r\n    validateParticles() {\r\n        for (const particle of this.particles) {\r\n            if (!particle.isAlive() || particle.life < 0 || particle.life > 1) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Forces cleanup of dead particles (for testing)\r\n     */\r\n    cleanup() {\r\n        for (let i = this.particles.length - 1; i >= 0; i--) {\r\n            if (!this.particles[i].isAlive()) {\r\n                this.removeParticle(i);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Destroys the particle system and cleans up resources\r\n     */\r\n    destroy() {\r\n        this.clear();\r\n        this.pool.length = 0;\r\n        this.poolHits = 0;\r\n        this.poolMisses = 0;\r\n        // ParticleSystem destroyed\r\n    }\r\n}\r\n\r\nexport default ParticleSystem;","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                      ◐ ◑ ◒ ◓  UNDERTONE MODIFIERS  ◓ ◒ ◑ ◐                      \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Undertone Modifiers - Subtle Emotion Variations\n * @author Emotive Engine Team\n * @version 2.0.0\n * @module UndertoneModifiers\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Undertones add NUANCE to emotions - like being \"nervously happy\" or              \n * ║ \"confidently angry\". These modifiers STACK on top of emotion modifiers            \n * ║ to create more complex, realistic emotional expressions.                          \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🎨 MULTIPLIER EFFECTS (Applied to Base Gesture)                                   \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • speed        : Animation speed (0.5=half speed, 2.0=double speed)               \n * │ • amplitude    : Movement size (0.5=smaller, 2.0=bigger)                          \n * │ • intensity    : Effect strength (0.5=subtle, 2.0=extreme)                        \n * │ • smoothness   : Animation smoothing (0.5=jerky, 1.5=very smooth)                 \n * │ • regularity   : Pattern consistency (0.5=chaotic, 1.0=regular)                   \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ ⚡ SPECIAL EFFECTS (Boolean Flags)                                                \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • addFlutter      : Butterfly-like motion (nervous)                               \n * │ • addMicroShake   : Tiny trembling (nervous, tired)                               \n * │ • addPower        : Strong, decisive motion (confident)                           \n * │ • addDrag         : Sluggish, heavy motion (tired)                                \n * │ • addTension      : Tight, controlled motion (intense)                            \n * │ • addSoftness     : Gentle, flowing motion (subdued)                              \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ ❌ DO NOT ADD HERE (Belongs in Other Files)                                       \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ ✗ Base gesture definitions   → use gestureConfig.js                              \n * │ ✗ Emotion modifiers         → use emotionModifiers.js                            \n * │ ✗ Visual properties         → use emotionMap.js                                  \n * │ ✗ Particle behaviors        → use Particle.js                                    \n * │ ✗ State logic              → use EmotiveStateMachine.js                          \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                           ADDING NEW UNDERTONES                                   \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ 1. Create new undertone object with all base multipliers (default to 1.0)         \n * ║ 2. Add special effect flags as needed (addXXX properties)                         \n * ║ 3. Test combinations with ALL emotions for unexpected interactions                \n * ║ 4. Document the intended \"feel\" and use cases                                     \n * ║ 5. Add to valid undertones in ErrorBoundary.js                                    \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\n\nexport const UNDERTONE_MODIFIERS = {\n    // No undertone - neutral multipliers\n    none: {\n        speed: 1.0,\n        amplitude: 1.0,\n        intensity: 1.0,\n        smoothness: 1.0,\n        regularity: 1.0\n    },\n    \n    nervous: {\n        speed: 1.2,        // 20% faster\n        amplitude: 0.9,    // 10% smaller (contained)\n        intensity: 1.1,    // 10% more intense\n        smoothness: 0.7,   // 30% less smooth (fluttery)\n        regularity: 0.6,   // Irregular (butterflies)\n        addFlutter: true,  // Butterfly-like flutter\n        addMicroShake: true // Subtle tremor\n    },\n    \n    confident: {\n        speed: 0.9,        // 10% slower (deliberate)\n        amplitude: 1.3,    // 30% bigger (bold)\n        intensity: 1.2,    // 20% more intense\n        smoothness: 1.1,   // 10% smoother (controlled)\n        regularity: 1.2,   // Very regular (assured)\n        addPower: true,    // Strong, decisive motion\n        addHold: true      // Brief pause at peaks\n    },\n    \n    tired: {\n        speed: 0.7,        // 30% slower\n        amplitude: 0.7,    // 30% smaller\n        intensity: 0.8,    // 20% less intense\n        smoothness: 1.3,   // 30% smoother (sluggish)\n        regularity: 0.8,   // Slightly irregular (drowsy)\n        addDroop: true,    // Downward tendency\n        addPause: true     // Occasional hesitation\n    },\n    \n    intense: {\n        speed: 1.3,        // 30% faster\n        amplitude: 1.2,    // 20% bigger\n        intensity: 1.4,    // 40% more intense\n        smoothness: 0.6,   // 40% less smooth (sharp)\n        regularity: 0.9,   // Slightly irregular\n        addPulse: true,    // Pulsing intensity\n        addFocus: true     // Concentrated motion\n    },\n    \n    subdued: {\n        speed: 0.8,        // 20% slower\n        amplitude: 0.8,    // 20% smaller\n        intensity: 0.7,    // 30% less intense\n        smoothness: 1.2,   // 20% smoother\n        regularity: 1.1,   // Regular (restrained)\n        addSoftness: true, // Gentle, muted motion\n        addFade: true      // Fading at edges\n    }\n};\n\n/**\n * Get undertone modifier\n * @param {string} undertone - Name of the undertone\n * @returns {Object} Modifier object with default values if undertone not found\n */\nexport function getUndertoneModifier(undertone) {\n    if (!undertone || undertone === '') {\n        return UNDERTONE_MODIFIERS.none;\n    }\n    return UNDERTONE_MODIFIERS[undertone] || UNDERTONE_MODIFIERS.none;\n}","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                   ◐ ◑ ◒ ◓  GESTURE COMPOSITOR  ◓ ◒ ◑ ◐                   \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Gesture Compositor - Emotion-Modified Animation Synthesis\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module GestureCompositor\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The ANIMATOR'S MIXER. Takes base gestures (bounce, pulse, etc.) and blends        \r\n * ║ them with emotional modifiers and undertones to create nuanced animations.        \r\n * ║ A happy bounce is different from a sad bounce - this is where that happens!       \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎭 COMPOSITION FORMULA                                                             \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ Final Animation = Base Gesture × Emotion Modifier × Undertone Modifier            \r\n * │                                                                                    \r\n * │ Example: Bounce + Joy + Confident                                                 \r\n * │   = Fast, big, springy bounce with extra confidence                               \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🔗 DEPENDENCIES                                                                    \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • gestures/index.js     : Modular gesture system with base configs                \r\n * │ • emotionModifiers.js   : How emotions affect movement                            \r\n * │ • undertoneModifiers.js : Subtle variations in expression                         \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nimport { getGesture } from './gestures/index.js';\r\nimport { getEmotionModifiers } from './emotions/index.js';\r\nimport { getUndertoneModifier } from '../config/undertoneModifiers.js';\r\n\r\nclass GestureCompositor {\r\n    constructor() {\r\n        // Cache for computed parameters\r\n        this.cache = new Map();\r\n        \r\n        // Pre-calculate common easing curves for performance\r\n        this.easingCache = new Map();\r\n        this.preCalculateEasingCurves();\r\n    }\r\n    \r\n    /**\r\n     * Pre-calculate common easing curves to avoid repeated calculations\r\n     */\r\n    preCalculateEasingCurves() {\r\n        const steps = 100;\r\n        const easingTypes = ['linear', 'ease-in', 'ease-out', 'ease-in-out', 'bounce'];\r\n        \r\n        for (const type of easingTypes) {\r\n            const curve = new Float32Array(steps + 1);\r\n            for (let i = 0; i <= steps; i++) {\r\n                const t = i / steps;\r\n                curve[i] = this.calculateEasing(t, type);\r\n            }\r\n            this.easingCache.set(type, curve);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Calculate easing value\r\n     */\r\n    calculateEasing(t, type) {\r\n        switch(type) {\r\n            case 'ease-in':\r\n                return t * t;\r\n            case 'ease-out':\r\n                return t * (2 - t);\r\n            case 'ease-in-out':\r\n                return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\r\n            case 'bounce':\r\n                if (t < 0.363636) return 7.5625 * t * t;\r\n                if (t < 0.727272) return 7.5625 * (t -= 0.545454) * t + 0.75;\r\n                if (t < 0.909090) return 7.5625 * (t -= 0.818181) * t + 0.9375;\r\n                return 7.5625 * (t -= 0.954545) * t + 0.984375;\r\n            default:\r\n                return t; // linear\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get easing value from cache\r\n     */\r\n    getEasingValue(progress, type) {\r\n        const curve = this.easingCache.get(type);\r\n        if (!curve) return progress; // Fallback to linear\r\n        \r\n        const index = Math.min(Math.floor(progress * 100), 100);\r\n        return curve[index];\r\n    }\r\n    \r\n    /**\r\n     * Compose final gesture parameters\r\n     * @param {string} gesture - Name of the gesture\r\n     * @param {string} emotion - Current emotion state\r\n     * @param {string} undertone - Current undertone (optional)\r\n     * @returns {Object} Final composed parameters for the gesture\r\n     */\r\n    compose(gesture, emotion, undertone = null) {\r\n        // Check cache first\r\n        const cacheKey = `${gesture}-${emotion}-${undertone || 'none'}`;\r\n        if (this.cache.has(cacheKey)) {\r\n            return this.cache.get(cacheKey);\r\n        }\r\n        \r\n        // Get base configuration from modular gesture system\r\n        const gestureModule = getGesture(gesture);\r\n        const base = gestureModule ? gestureModule.config : {\r\n            duration: 500,\r\n            amplitude: 20,\r\n            easing: 'sine'\r\n        };\r\n        const emotionMod = getEmotionModifiers(emotion);\r\n        const undertoneMod = getUndertoneModifier(undertone);\r\n        \r\n        // Compose the final parameters\r\n        const composed = this.applyModifiers(base, emotionMod, undertoneMod, gesture);\r\n        \r\n        // Cache the result with size limit\r\n        if (this.cache.size > 100) {\r\n            // Clear cache if it gets too large\r\n            this.cache.clear();\r\n        }\r\n        this.cache.set(cacheKey, composed);\r\n        \r\n        return composed;\r\n    }\r\n    \r\n    /**\r\n     * Apply modifiers to base parameters\r\n     * @param {Object} base - Base gesture configuration\r\n     * @param {Object} emotionMod - Emotion modifiers\r\n     * @param {Object} undertoneMod - Undertone modifiers\r\n     * @param {string} gesture - Gesture name for special handling\r\n     * @returns {Object} Modified parameters\r\n     */\r\n    applyModifiers(base, emotionMod, undertoneMod, gesture) {\r\n        const result = { ...base };\r\n        \r\n        // Apply speed modifiers (affects duration inversely)\r\n        const speedMultiplier = emotionMod.speed * undertoneMod.speed;\r\n        result.duration = Math.round(base.duration / speedMultiplier);\r\n        \r\n        // Apply amplitude modifiers\r\n        if (result.amplitude !== undefined) {\r\n            result.amplitude = base.amplitude * emotionMod.amplitude * undertoneMod.amplitude;\r\n        }\r\n        \r\n        // Apply scale modifiers\r\n        if (result.scaleAmount !== undefined) {\r\n            result.scaleAmount = base.scaleAmount * emotionMod.intensity * undertoneMod.intensity;\r\n        }\r\n        if (result.scaleTarget !== undefined) {\r\n            const scaleModifier = emotionMod.amplitude * undertoneMod.amplitude;\r\n            result.scaleTarget = 1 + (base.scaleTarget - 1) * scaleModifier;\r\n        }\r\n        \r\n        // Apply glow modifiers\r\n        if (result.glowAmount !== undefined) {\r\n            result.glowAmount = base.glowAmount * emotionMod.intensity * undertoneMod.intensity;\r\n        }\r\n        if (result.glowPeak !== undefined) {\r\n            result.glowPeak = 1 + (base.glowPeak - 1) * emotionMod.intensity * undertoneMod.intensity;\r\n        }\r\n        \r\n        // Apply rotation modifiers\r\n        if (result.rotations !== undefined) {\r\n            result.rotations = base.rotations * emotionMod.amplitude * undertoneMod.amplitude;\r\n        }\r\n        if (result.angle !== undefined) {\r\n            result.angle = base.angle * emotionMod.amplitude * undertoneMod.amplitude;\r\n        }\r\n        \r\n        // Apply distance modifiers (for drift)\r\n        if (result.distance !== undefined) {\r\n            result.distance = base.distance * emotionMod.amplitude * undertoneMod.amplitude;\r\n        }\r\n        \r\n        // Apply smoothness (affects easing)\r\n        const smoothness = emotionMod.smoothness * undertoneMod.smoothness;\r\n        result.smoothness = smoothness;\r\n        result.easing = this.selectEasing(base.easing, smoothness);\r\n        \r\n        // Apply regularity (affects patterns)\r\n        result.regularity = emotionMod.regularity * undertoneMod.regularity;\r\n        \r\n        // Add special effects based on emotion\r\n        result.effects = [];\r\n        if (emotionMod.addBounce) result.effects.push('bounce');\r\n        if (emotionMod.addGravity) result.effects.push('gravity');\r\n        if (emotionMod.addShake) result.effects.push('shake');\r\n        if (emotionMod.addJitter) result.effects.push('shake');\r\n        if (emotionMod.addPop) result.effects.push('pop');\r\n        if (emotionMod.addRecoil) result.effects.push('recoil');\r\n        if (emotionMod.addWarmth) result.effects.push('warmth');\r\n        if (emotionMod.addFlow) result.effects.push('flow');\r\n        if (emotionMod.addWobble) result.effects.push('wobble');\r\n        if (emotionMod.addVibration) result.effects.push('vibration');\r\n        if (emotionMod.addDrag) result.effects.push('drag');\r\n        if (emotionMod.addWeight) result.effects.push('weight');\r\n        if (emotionMod.addTension) result.effects.push('tension');\r\n        if (emotionMod.addPrecision) result.effects.push('precision');\r\n        \r\n        // Add undertone effects\r\n        if (undertoneMod.addFlutter) result.effects.push('flutter');\r\n        if (undertoneMod.addMicroShake) result.effects.push('microShake');\r\n        if (undertoneMod.addPower) result.effects.push('power');\r\n        if (undertoneMod.addHold) result.effects.push('hold');\r\n        if (undertoneMod.addDroop) result.effects.push('droop');\r\n        if (undertoneMod.addPause) result.effects.push('pause');\r\n        if (undertoneMod.addPulse) result.effects.push('pulse');\r\n        if (undertoneMod.addFocus) result.effects.push('focus');\r\n        if (undertoneMod.addSoftness) result.effects.push('softness');\r\n        if (undertoneMod.addFade) result.effects.push('fade');\r\n        \r\n        // Apply gesture-specific modifications\r\n        this.applyGestureSpecificMods(result, gesture, emotionMod, undertoneMod);\r\n        \r\n        // Include particleMotion if it exists in base config\r\n        if (base.particleMotion) {\r\n            result.particleMotion = { ...base.particleMotion };\r\n            \r\n            // Apply modifiers to particle motion strength\r\n            if (result.particleMotion.strength !== undefined) {\r\n                result.particleMotion.strength *= emotionMod.intensity * undertoneMod.intensity;\r\n            }\r\n            \r\n            // Apply speed modifiers to particle motion frequency\r\n            if (result.particleMotion.frequency !== undefined) {\r\n                result.particleMotion.frequency *= speedMultiplier;\r\n            }\r\n            \r\n            // Apply amplitude modifiers to particle motion amplitude\r\n            if (result.particleMotion.amplitude !== undefined) {\r\n                result.particleMotion.amplitude *= emotionMod.amplitude * undertoneMod.amplitude;\r\n            }\r\n        }\r\n        \r\n        return result;\r\n    }\r\n    \r\n    /**\r\n     * Select easing function based on smoothness\r\n     * @param {string} baseEasing - Base easing type\r\n     * @param {number} smoothness - Smoothness multiplier\r\n     * @returns {string} Selected easing function\r\n     */\r\n    selectEasing(baseEasing, smoothness) {\r\n        if (smoothness < 0.5) {\r\n            return 'linear'; // Very sharp\r\n        } else if (smoothness < 0.8) {\r\n            return 'quad'; // Somewhat sharp\r\n        } else if (smoothness < 1.2) {\r\n            return baseEasing; // Normal\r\n        } else if (smoothness < 1.5) {\r\n            return 'cubic'; // Smooth\r\n        } else {\r\n            return 'sine'; // Very smooth\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Apply gesture-specific modifications\r\n     * @param {Object} result - Current parameters\r\n     * @param {string} gesture - Gesture name\r\n     * @param {Object} emotionMod - Emotion modifiers\r\n     * @param {Object} undertoneMod - Undertone modifiers\r\n     */\r\n    applyGestureSpecificMods(result, gesture, emotionMod, undertoneMod) {\r\n        switch(gesture) {\r\n            case 'bounce':\r\n                // Angry bounce is more violent\r\n                if (emotionMod.addShake) {\r\n                    result.frequency = Math.floor(result.frequency * 1.5);\r\n                }\r\n                // Sad bounce barely leaves ground\r\n                if (emotionMod.addGravity) {\r\n                    result.amplitude *= 0.6;\r\n                    result.frequency = 1;\r\n                }\r\n                break;\r\n                \r\n            case 'pulse':\r\n                // Love pulse is like a heartbeat\r\n                if (emotionMod.addWarmth) {\r\n                    result.frequency = 2; // Double beat\r\n                    result.glowAmount *= 1.5;\r\n                }\r\n                // Nervous pulse is irregular\r\n                if (undertoneMod.addFlutter) {\r\n                    result.irregular = true;\r\n                }\r\n                break;\r\n                \r\n            case 'shake':\r\n                // Fear shake is more intense\r\n                if (emotionMod.addJitter) {\r\n                    result.frequency *= 1.5;\r\n                    result.amplitude *= 1.2;\r\n                }\r\n                // Anger shake is violent\r\n                if (emotionMod.addShake) {\r\n                    result.amplitude *= 1.5;\r\n                    result.decay = false; // Sustained shaking\r\n                }\r\n                break;\r\n                \r\n            case 'spin':\r\n                // Joy spin has extra rotations\r\n                if (emotionMod.addBounce) {\r\n                    result.rotations *= 1.5;\r\n                }\r\n                // Confused spin reverses direction\r\n                if (emotionMod.addWobble) {\r\n                    result.wobble = true;\r\n                }\r\n                break;\r\n                \r\n            // Add more gesture-specific modifications as needed\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clear the cache (useful when configs change)\r\n     */\r\n    clearCache() {\r\n        this.cache.clear();\r\n    }\r\n}\r\n\r\nexport default GestureCompositor;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Zen Vortex Effect\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Zen meditation vortex visual effect\r\n * @author Emotive Engine Team\r\n * @module effects/zen-vortex\r\n */\r\n\r\nexport default {\r\n    name: 'zen-vortex',\r\n    emoji: '🌀',\r\n    description: 'Swirling meditation vortex effect',\r\n    \r\n    // Configuration\r\n    config: {\r\n        vortexSpeed: 0.02,\r\n        spiralTightness: 0.15,\r\n        maxRadius: 1.5,\r\n        lineWidth: 2,\r\n        segments: 50,\r\n        arms: 3,\r\n        fadeStart: 0.7,\r\n        baseOpacity: 0.3,\r\n        pulseSpeed: 0.01\r\n    },\r\n    \r\n    // State for animation\r\n    state: {\r\n        rotation: 0,\r\n        pulsePhase: 0,\r\n        intensity: 0\r\n    },\r\n    \r\n    /**\r\n     * Check if effect should be active\r\n     * @param {Object} state - Renderer state\r\n     * @returns {boolean}\r\n     */\r\n    shouldActivate: function(state) {\r\n        return state.emotion === 'zen' || state.zenTransition?.active;\r\n    },\r\n    \r\n    /**\r\n     * Apply the zen vortex effect\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {Object} params - Effect parameters\r\n     */\r\n    apply: function(ctx, params) {\r\n        const { x, y, radius, intensity = 1.0, deltaTime = 16.67 } = params;\r\n        \r\n        // Update animation state\r\n        this.state.rotation += this.config.vortexSpeed * (deltaTime / 16.67);\r\n        this.state.pulsePhase += this.config.pulseSpeed * (deltaTime / 16.67);\r\n        this.state.intensity = intensity;\r\n        \r\n        ctx.save();\r\n        \r\n        // Draw multiple spiral arms\r\n        for (let arm = 0; arm < this.config.arms; arm++) {\r\n            const armOffset = (Math.PI * 2 / this.config.arms) * arm;\r\n            this.drawSpiralArm(ctx, x, y, radius, armOffset);\r\n        }\r\n        \r\n        // Draw meditation circle (∩∩ shape)\r\n        this.drawMeditationEyes(ctx, x, y, radius * 0.6, intensity);\r\n        \r\n        ctx.restore();\r\n    },\r\n    \r\n    /**\r\n     * Draw a single spiral arm\r\n     */\r\n    drawSpiralArm: function(ctx, centerX, centerY, baseRadius, offset) {\r\n        ctx.beginPath();\r\n        \r\n        const pulseMod = 1 + Math.sin(this.state.pulsePhase) * 0.1;\r\n        \r\n        for (let i = 0; i <= this.config.segments; i++) {\r\n            const t = i / this.config.segments;\r\n            const angle = this.state.rotation + offset + t * Math.PI * 4;\r\n            const spiralRadius = t * baseRadius * this.config.maxRadius * pulseMod;\r\n            \r\n            // Spiral equation\r\n            const x = centerX + Math.cos(angle) * spiralRadius;\r\n            const y = centerY + Math.sin(angle) * spiralRadius;\r\n            \r\n            if (i === 0) {\r\n                ctx.moveTo(x, y);\r\n            } else {\r\n                ctx.lineTo(x, y);\r\n            }\r\n        }\r\n        \r\n        // Create gradient for fade effect\r\n        const gradient = ctx.createLinearGradient(\r\n            centerX - baseRadius, centerY,\r\n            centerX + baseRadius, centerY\r\n        );\r\n        \r\n        const opacity = this.config.baseOpacity * this.state.intensity;\r\n        gradient.addColorStop(0, `rgba(147, 112, 219, 0)`);\r\n        gradient.addColorStop(0.3, `rgba(147, 112, 219, ${opacity * 0.5})`);\r\n        gradient.addColorStop(this.config.fadeStart, `rgba(147, 112, 219, ${opacity})`);\r\n        gradient.addColorStop(1, `rgba(147, 112, 219, 0)`);\r\n        \r\n        ctx.strokeStyle = gradient;\r\n        ctx.lineWidth = this.config.lineWidth;\r\n        ctx.stroke();\r\n    },\r\n    \r\n    /**\r\n     * Draw meditation eyes (∩∩)\r\n     */\r\n    drawMeditationEyes: function(ctx, x, y, radius, intensity) {\r\n        ctx.save();\r\n        \r\n        const eyeWidth = radius * 0.4;\r\n        const eyeHeight = radius * 0.3;\r\n        const eyeSpacing = radius * 0.3;\r\n        \r\n        ctx.strokeStyle = `rgba(255, 255, 255, ${0.8 * intensity})`;\r\n        ctx.lineWidth = 2;\r\n        \r\n        // Left eye (∩)\r\n        ctx.beginPath();\r\n        ctx.arc(x - eyeSpacing, y, eyeWidth, Math.PI, 0, true);\r\n        ctx.stroke();\r\n        \r\n        // Right eye (∩)\r\n        ctx.beginPath();\r\n        ctx.arc(x + eyeSpacing, y, eyeWidth, Math.PI, 0, true);\r\n        ctx.stroke();\r\n        \r\n        ctx.restore();\r\n    },\r\n    \r\n    /**\r\n     * Reset the effect state\r\n     */\r\n    reset: function() {\r\n        this.state.rotation = 0;\r\n        this.state.pulsePhase = 0;\r\n        this.state.intensity = 0;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Recording Glow Effect\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Pulsating red glow for recording state\r\n * @author Emotive Engine Team\r\n * @module effects/recording-glow\r\n */\r\n\r\nexport default {\r\n    name: 'recording-glow',\r\n    emoji: '🔴',\r\n    description: 'Pulsating red recording indicator',\r\n    \r\n    // Configuration\r\n    config: {\r\n        color: '#FF0000',\r\n        pulseSpeed: 0.08,\r\n        minIntensity: 0.6,\r\n        maxIntensity: 1.0,\r\n        radiusMultiplier: 2.0,\r\n        gradientStops: [\r\n            { position: 0, opacity: 1.0 },\r\n            { position: 0.3, opacity: 0.7 },\r\n            { position: 0.6, opacity: 0.4 },\r\n            { position: 0.85, opacity: 0.2 },\r\n            { position: 1, opacity: 0 }\r\n        ]\r\n    },\r\n    \r\n    // State for animation\r\n    state: {\r\n        pulsePhase: 0,\r\n        intensity: 0.8  // Start with visible intensity\r\n    },\r\n    \r\n    /**\r\n     * Check if effect should be active\r\n     * @param {Object} state - Renderer state\r\n     * @returns {boolean}\r\n     */\r\n    shouldActivate: function(state) {\r\n        return state.recording === true;\r\n    },\r\n    \r\n    /**\r\n     * Apply the recording glow effect\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {Object} params - Effect parameters\r\n     */\r\n    apply: function(ctx, params) {\r\n        const { deltaTime = 16.67 } = params;\r\n        \r\n        // Update pulse animation for the indicator only\r\n        this.state.pulsePhase += this.config.pulseSpeed * (deltaTime / 16.67);\r\n        \r\n        // Calculate pulsating intensity\r\n        const pulse = (Math.sin(this.state.pulsePhase) + 1) / 2;\r\n        this.state.intensity = this.config.minIntensity + \r\n            (this.config.maxIntensity - this.config.minIntensity) * pulse;\r\n        \r\n        // Don't draw any glow on the mascot - only update the animation state\r\n        // The REC indicator will be drawn separately in drawRecordingIndicator\r\n        return true; // Return true to indicate effect was applied\r\n    },\r\n    \r\n    /**\r\n     * Draw recording indicator text only\r\n     */\r\n    drawRecordingIndicator: function(ctx, canvasWidth, canvasHeight) {\r\n        ctx.save();\r\n        \r\n        // Dynamic text size\r\n        const baseSize = Math.min(canvasWidth, canvasHeight);\r\n        const textSize = Math.floor(baseSize * 0.08);  // 8% of smallest dimension (bigger)\r\n        \r\n        // Position in upper-left corner with padding\r\n        const x = textSize * 1.5;\r\n        const y = textSize * 1.5;\r\n        \r\n        // Draw red recording dot\r\n        const dotRadius = textSize * 0.3;\r\n        ctx.fillStyle = this.hexToRgba('#FF0000', this.state.intensity);\r\n        ctx.beginPath();\r\n        ctx.arc(x - textSize, y, dotRadius, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        \r\n        // Add white outline for visibility\r\n        ctx.strokeStyle = this.hexToRgba('#FFFFFF', this.state.intensity * 0.8);\r\n        ctx.lineWidth = 3;\r\n        ctx.font = `bold ${textSize}px 'Arial', sans-serif`;\r\n        ctx.textAlign = 'left';\r\n        ctx.textBaseline = 'middle';\r\n        ctx.strokeText('REC', x, y);\r\n        \r\n        // Draw \"REC\" text on top\r\n        ctx.fillStyle = this.hexToRgba('#FF0000', this.state.intensity);\r\n        ctx.fillText('REC', x, y);\r\n        \r\n        ctx.restore();\r\n    },\r\n    \r\n    /**\r\n     * Convert hex to rgba\r\n     */\r\n    hexToRgba: function(hex, alpha) {\r\n        const r = parseInt(hex.slice(1, 3), 16);\r\n        const g = parseInt(hex.slice(3, 5), 16);\r\n        const b = parseInt(hex.slice(5, 7), 16);\r\n        return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    },\r\n    \r\n    /**\r\n     * Reset the effect state\r\n     */\r\n    reset: function() {\r\n        this.state.pulsePhase = 0;\r\n        this.state.intensity = 0;\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Speaking Pulse Effect\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'speaking-pulse',\r\n    emoji: '🗣️',\r\n    description: 'Audio-reactive pulse when speaking',\r\n    \r\n    config: {\r\n        scaleMultiplier: 0.15,  // Max scale increase when speaking\r\n        smoothing: 0.1,         // Smoothing factor for audio levels\r\n        minPulse: 0.02,         // Minimum pulse even when quiet\r\n        colorShift: true,       // Shift glow color when speaking\r\n        ringEffect: true        // Show expanding rings\r\n    },\r\n    \r\n    state: {\r\n        audioLevel: 0,\r\n        smoothedLevel: 0,\r\n        rings: []  // Array of expanding rings\r\n    },\r\n    \r\n    shouldActivate: function(state) {\r\n        return state.speaking === true;\r\n    },\r\n    \r\n    apply: function(ctx, params) {\r\n        const { x, y, radius, audioLevel = 0, deltaTime = 16.67 } = params;\r\n        \r\n        // Smooth audio level\r\n        this.state.smoothedLevel += (audioLevel - this.state.smoothedLevel) * this.config.smoothing;\r\n        \r\n        // Create expanding rings on audio peaks\r\n        if (audioLevel > 0.5 && this.state.audioLevel <= 0.5) {\r\n            this.state.rings.push({\r\n                radius: radius,\r\n                opacity: 0.5,\r\n                speed: 2\r\n            });\r\n        }\r\n        \r\n        // Update and draw rings\r\n        if (this.config.ringEffect) {\r\n            this.drawRings(ctx, x, y, deltaTime);\r\n        }\r\n        \r\n        // Store for next frame\r\n        this.state.audioLevel = audioLevel;\r\n    },\r\n    \r\n    drawRings: function(ctx, x, y, deltaTime) {\r\n        ctx.save();\r\n        ctx.strokeStyle = 'rgba(100, 200, 255, 0.5)';\r\n        ctx.lineWidth = 2;\r\n        \r\n        // Update and draw each ring\r\n        for (let i = this.state.rings.length - 1; i >= 0; i--) {\r\n            const ring = this.state.rings[i];\r\n            \r\n            // Update ring\r\n            ring.radius += ring.speed * (deltaTime / 16.67);\r\n            ring.opacity -= 0.02 * (deltaTime / 16.67);\r\n            \r\n            // Remove if faded\r\n            if (ring.opacity <= 0) {\r\n                this.state.rings.splice(i, 1);\r\n                continue;\r\n            }\r\n            \r\n            // Draw ring\r\n            ctx.globalAlpha = ring.opacity;\r\n            ctx.beginPath();\r\n            ctx.arc(x, y, ring.radius, 0, Math.PI * 2);\r\n            ctx.stroke();\r\n        }\r\n        \r\n        ctx.restore();\r\n    },\r\n    \r\n    getScaleModifier: function() {\r\n        return 1 + (this.state.smoothedLevel * this.config.scaleMultiplier);\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Sleeping Effect\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'sleeping',\r\n    emoji: '😴',\r\n    description: 'Sleeping with closed eyes and Z particles',\r\n    \r\n    config: {\r\n        eyeClosedScale: 0.1,    // How closed the eyes are (0.1 = 90% closed)\r\n        breathingDepth: 0.15,    // Deeper breathing when sleeping\r\n        breathingRate: 0.8,      // Slower breathing\r\n        zParticleInterval: 2000, // Spawn Z every 2 seconds\r\n        zDriftSpeed: 1,          // Speed of Z particles floating up\r\n        zFadeSpeed: 0.01,        // How fast Z's fade out\r\n        orbDimming: 0.3,         // Dim orb to 30% brightness when sleeping\r\n        glowDimming: 0.2         // Dim glow even more (20% brightness)\r\n    },\r\n    \r\n    state: {\r\n        lastZSpawn: 0,\r\n        zParticles: []\r\n    },\r\n    \r\n    shouldActivate: function(state) {\r\n        return state.sleeping === true || state.emotion === 'resting';\r\n    },\r\n    \r\n    apply: function(ctx, params) {\r\n        const { x, y, radius, deltaTime = 16.67 } = params;\r\n        const now = Date.now();\r\n        \r\n        // Spawn new Z particle\r\n        if (now - this.state.lastZSpawn > this.config.zParticleInterval) {\r\n            // Random Poppins font weights: 100-900\r\n            const weights = [100, 200, 300, 400, 500, 600, 700, 800, 900];\r\n            const randomWeight = weights[Math.floor(Math.random() * weights.length)];\r\n            \r\n            this.state.zParticles.push({\r\n                x: x + radius,\r\n                y: y - radius,\r\n                opacity: 1.0,\r\n                size: 12 + Math.random() * 8, // Random size 12-20px\r\n                drift: Math.random() * 0.5 - 0.25, // Slight random drift\r\n                weight: randomWeight, // Random font weight\r\n                rotation: Math.random() * 30 - 15 // Random rotation -15 to 15 degrees\r\n            });\r\n            this.state.lastZSpawn = now;\r\n        }\r\n        \r\n        // Update and draw Z particles\r\n        this.drawZParticles(ctx, deltaTime);\r\n    },\r\n    \r\n    drawZParticles: function(ctx, deltaTime) {\r\n        ctx.save();\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'middle';\r\n        \r\n        for (let i = this.state.zParticles.length - 1; i >= 0; i--) {\r\n            const z = this.state.zParticles[i];\r\n            \r\n            // Update position\r\n            z.y -= this.config.zDriftSpeed * (deltaTime / 16.67);\r\n            z.x += z.drift * (deltaTime / 16.67);\r\n            z.opacity -= this.config.zFadeSpeed * (deltaTime / 16.67);\r\n            z.rotation += 0.5 * (deltaTime / 16.67); // Slow rotation\r\n            \r\n            // Remove if faded\r\n            if (z.opacity <= 0) {\r\n                this.state.zParticles.splice(i, 1);\r\n                continue;\r\n            }\r\n            \r\n            // Draw Z with random Poppins weight\r\n            ctx.save();\r\n            ctx.translate(z.x, z.y);\r\n            ctx.rotate(z.rotation * Math.PI / 180);\r\n            ctx.globalAlpha = z.opacity * 0.7; // Slightly transparent\r\n            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n            ctx.font = `${z.weight} ${z.size}px 'Poppins', sans-serif`;\r\n            ctx.fillText('Z', 0, 0);\r\n            \r\n            // Add a subtle shadow for depth\r\n            ctx.shadowBlur = 3;\r\n            ctx.shadowColor = 'rgba(147, 112, 219, 0.5)'; // Purple shadow for dreamy effect\r\n            ctx.fillText('Z', 0, 0);\r\n            ctx.restore();\r\n        }\r\n        \r\n        ctx.restore();\r\n    },\r\n    \r\n    getEyeOpenness: function() {\r\n        return this.config.eyeClosedScale;\r\n    },\r\n    \r\n    getBreathingModifiers: function() {\r\n        return {\r\n            rate: this.config.breathingRate,\r\n            depth: this.config.breathingDepth\r\n        };\r\n    },\r\n    \r\n    getDimmingValues: function() {\r\n        return {\r\n            orbDimming: this.config.orbDimming,\r\n            glowDimming: this.config.glowDimming\r\n        };\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Suspicion Scan Effect\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'suspicion-scan',\r\n    emoji: '🔍',\r\n    description: 'Suspicious scanning and squinting',\r\n    \r\n    config: {\r\n        squintAmount: 0.4,      // 40% eye narrowing\r\n        scanInterval: 5000,     // Scan every 5 seconds\r\n        scanDuration: 800,      // Each scan takes 800ms\r\n        scanAngle: 45,          // Degrees to look left/right\r\n        squintSpeed: 0.02,      // Animation speed for squinting\r\n        pupilShift: 0.3         // How much the pupil shifts when scanning\r\n    },\r\n    \r\n    state: {\r\n        currentSquint: 0,\r\n        targetSquint: 0,\r\n        lastScanTime: 0,\r\n        scanPhase: 0,  // 0 = center, -1 = left, 1 = right\r\n        scanning: false\r\n    },\r\n    \r\n    shouldActivate: function(state) {\r\n        return state.emotion === 'suspicion' || state.suspicious === true;\r\n    },\r\n    \r\n    apply: function(ctx, params) {\r\n        const { x, y, radius, deltaTime = 16.67 } = params;\r\n        const now = Date.now();\r\n        \r\n        // Update squint amount\r\n        this.updateSquint(deltaTime);\r\n        \r\n        // Handle scanning motion\r\n        if (now - this.state.lastScanTime > this.config.scanInterval) {\r\n            this.startScan();\r\n            this.state.lastScanTime = now;\r\n        }\r\n        \r\n        if (this.state.scanning) {\r\n            this.updateScan(now, deltaTime);\r\n        }\r\n    },\r\n    \r\n    updateSquint: function(deltaTime) {\r\n        // Set target squint when suspicious\r\n        this.state.targetSquint = this.config.squintAmount;\r\n        \r\n        // Animate toward target\r\n        const diff = this.state.targetSquint - this.state.currentSquint;\r\n        if (Math.abs(diff) > 0.01) {\r\n            this.state.currentSquint += diff * this.config.squintSpeed * (deltaTime / 16.67);\r\n        } else {\r\n            this.state.currentSquint = this.state.targetSquint;\r\n        }\r\n    },\r\n    \r\n    startScan: function() {\r\n        this.state.scanning = true;\r\n        this.state.scanStartTime = Date.now();\r\n        this.state.scanPhase = -1; // Start by looking left\r\n    },\r\n    \r\n    updateScan: function(now, deltaTime) {\r\n        const elapsed = now - this.state.scanStartTime;\r\n        const progress = elapsed / this.config.scanDuration;\r\n        \r\n        if (progress < 0.33) {\r\n            // Look left\r\n            this.state.scanPhase = -1;\r\n        } else if (progress < 0.66) {\r\n            // Look right\r\n            this.state.scanPhase = 1;\r\n        } else if (progress < 1) {\r\n            // Return to center\r\n            this.state.scanPhase = 0;\r\n        } else {\r\n            // Scan complete\r\n            this.state.scanning = false;\r\n            this.state.scanPhase = 0;\r\n        }\r\n    },\r\n    \r\n    getEyeModifiers: function() {\r\n        return {\r\n            scaleY: 1 - this.state.currentSquint,  // Narrow vertically\r\n            scaleX: 1 + this.state.currentSquint * 0.3,  // Widen horizontally slightly\r\n            offsetX: this.state.scanPhase * this.config.pupilShift\r\n        };\r\n    },\r\n    \r\n    drawScanLines: function(ctx, x, y, radius) {\r\n        if (!this.state.scanning) return;\r\n        \r\n        ctx.save();\r\n        ctx.strokeStyle = 'rgba(255, 165, 0, 0.3)'; // Orange scan lines\r\n        ctx.lineWidth = 1;\r\n        ctx.setLineDash([5, 5]);\r\n        \r\n        // Draw scanning beam\r\n        const angle = this.state.scanPhase * (this.config.scanAngle * Math.PI / 180);\r\n        const endX = x + Math.cos(angle) * radius * 2;\r\n        const endY = y + Math.sin(angle) * radius * 0.5;\r\n        \r\n        ctx.beginPath();\r\n        ctx.moveTo(x, y);\r\n        ctx.lineTo(endX, endY);\r\n        ctx.stroke();\r\n        \r\n        ctx.restore();\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Gaze Narrowing Effect\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport default {\r\n    name: 'gaze-narrowing',\r\n    emoji: '👁️',\r\n    description: 'Eye narrowing based on gaze proximity',\r\n    \r\n    config: {\r\n        maxHorizontalScale: 1.3,  // Max horizontal widening (30%)\r\n        maxVerticalScale: 0.5,    // Max vertical narrowing (50%)\r\n        smoothing: 0.1,           // Smoothing factor for transitions\r\n        focusThreshold: 0.3       // Intensity threshold to start narrowing\r\n    },\r\n    \r\n    state: {\r\n        currentScaleX: 1,\r\n        currentScaleY: 1,\r\n        targetScaleX: 1,\r\n        targetScaleY: 1\r\n    },\r\n    \r\n    shouldActivate: function(state) {\r\n        return state.gazeIntensity > 0 || state.gazeLocked;\r\n    },\r\n    \r\n    apply: function(ctx, params) {\r\n        const { gazeIntensity = 0, deltaTime = 16.67 } = params;\r\n        \r\n        // Calculate target scales based on gaze intensity\r\n        if (gazeIntensity > this.config.focusThreshold) {\r\n            const narrowFactor = (gazeIntensity - this.config.focusThreshold) / \r\n                                (1 - this.config.focusThreshold);\r\n            \r\n            this.state.targetScaleX = 1 + (this.config.maxHorizontalScale - 1) * narrowFactor;\r\n            this.state.targetScaleY = 1 - (1 - this.config.maxVerticalScale) * narrowFactor;\r\n        } else {\r\n            this.state.targetScaleX = 1;\r\n            this.state.targetScaleY = 1;\r\n        }\r\n        \r\n        // Smooth transitions\r\n        this.animateScales(deltaTime);\r\n    },\r\n    \r\n    animateScales: function(deltaTime) {\r\n        const speed = this.config.smoothing * (deltaTime / 16.67);\r\n        \r\n        // Animate X scale\r\n        const diffX = this.state.targetScaleX - this.state.currentScaleX;\r\n        if (Math.abs(diffX) > 0.001) {\r\n            this.state.currentScaleX += diffX * speed;\r\n        }\r\n        \r\n        // Animate Y scale\r\n        const diffY = this.state.targetScaleY - this.state.currentScaleY;\r\n        if (Math.abs(diffY) > 0.001) {\r\n            this.state.currentScaleY += diffY * speed;\r\n        }\r\n    },\r\n    \r\n    getEyeScales: function() {\r\n        return {\r\n            scaleX: this.state.currentScaleX,\r\n            scaleY: this.state.currentScaleY\r\n        };\r\n    },\r\n    \r\n    drawFocusIndicator: function(ctx, x, y, radius, intensity) {\r\n        if (intensity < this.config.focusThreshold) return;\r\n        \r\n        ctx.save();\r\n        \r\n        // Draw focus lines converging on target\r\n        const alpha = (intensity - this.config.focusThreshold) * 0.5;\r\n        ctx.strokeStyle = `rgba(100, 200, 255, ${alpha})`;\r\n        ctx.lineWidth = 1;\r\n        ctx.setLineDash([2, 4]);\r\n        \r\n        // Draw converging lines\r\n        const angles = [0, 60, 120, 180, 240, 300];\r\n        for (const angle of angles) {\r\n            const rad = angle * Math.PI / 180;\r\n            const startDist = radius * 2;\r\n            const endDist = radius * 1.2;\r\n            \r\n            ctx.beginPath();\r\n            ctx.moveTo(\r\n                x + Math.cos(rad) * startDist,\r\n                y + Math.sin(rad) * startDist\r\n            );\r\n            ctx.lineTo(\r\n                x + Math.cos(rad) * endDist,\r\n                y + Math.sin(rad) * endDist\r\n            );\r\n            ctx.stroke();\r\n        }\r\n        \r\n        ctx.restore();\r\n    }\r\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Fingerprint Effect\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Biometric fingerprint pattern effect\r\n * @author Emotive Engine Team\r\n * @module effects/fingerprint\r\n * \r\n * Created from a happy accident in the resting state that produced\r\n * concentric circles resembling a fingerprint pattern!\r\n */\r\n\r\nexport default {\r\n    name: 'fingerprint',\r\n    emoji: '👆',\r\n    description: 'Biometric fingerprint pattern for authentication UI',\r\n    \r\n    // Configuration\r\n    config: {\r\n        rings: 8,                  // Number of concentric rings\r\n        ringSpacing: 15,           // Pixels between rings\r\n        lineWidth: 1.5,           // Width of fingerprint lines\r\n        rotationSpeed: 0.001,     // Slow rotation for scanning effect\r\n        pulseSpeed: 0.02,         // Breathing/pulse speed\r\n        waveAmplitude: 3,         // Waviness of lines (realistic fingerprint)\r\n        waveFrequency: 8,         // How many waves per ring\r\n        breakPoints: 5,           // Random breaks in lines (like real fingerprints)\r\n        opacity: 0.4,             // Base opacity\r\n        scanLineSpeed: 0.01,      // Speed of scanning line\r\n        scanLineWidth: 3,         // Width of scanning beam\r\n        color: '#00CED1',         // Cyan for tech/biometric feel\r\n        glowColor: '#00FFFF',     // Bright cyan for scan\r\n        successColor: '#00FF00',  // Green for successful scan\r\n        failColor: '#FF0000'      // Red for failed scan\r\n    },\r\n    \r\n    // State for animation\r\n    state: {\r\n        rotation: 0,\r\n        pulsePhase: 0,\r\n        scanPosition: 0,\r\n        scanDirection: 1,\r\n        isScanning: false,\r\n        scanResult: null,  // 'success', 'fail', or null\r\n        breaks: [],        // Random break positions in rings\r\n        whorls: []         // Whorl patterns for realism\r\n    },\r\n    \r\n    /**\r\n     * Check if effect should be active\r\n     * @param {Object} state - Renderer state\r\n     * @returns {boolean}\r\n     */\r\n    shouldActivate: function(state) {\r\n        return state.biometric === true || state.fingerprint === true || state.authenticating === true;\r\n    },\r\n    \r\n    /**\r\n     * Initialize fingerprint pattern\r\n     */\r\n    initialize: function() {\r\n        // Generate random breaks for each ring\r\n        this.state.breaks = [];\r\n        for (let i = 0; i < this.config.rings; i++) {\r\n            const ringBreaks = [];\r\n            for (let j = 0; j < this.config.breakPoints; j++) {\r\n                ringBreaks.push(Math.random() * Math.PI * 2);\r\n            }\r\n            this.state.breaks.push(ringBreaks);\r\n        }\r\n        \r\n        // Generate whorl centers for realistic pattern\r\n        this.state.whorls = [\r\n            { x: 0.2, y: -0.1, strength: 0.3 },\r\n            { x: -0.15, y: 0.2, strength: 0.25 },\r\n            { x: 0, y: 0, strength: 0.5 }  // Central whorl\r\n        ];\r\n    },\r\n    \r\n    /**\r\n     * Apply the fingerprint effect\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {Object} params - Effect parameters\r\n     */\r\n    apply: function(ctx, params) {\r\n        const { x, y, radius, deltaTime = 16.67, scanning = false, authResult = null } = params;\r\n        \r\n        // Initialize on first run\r\n        if (this.state.breaks.length === 0) {\r\n            this.initialize();\r\n        }\r\n        \r\n        // Update animation state\r\n        this.state.rotation += this.config.rotationSpeed * (deltaTime / 16.67);\r\n        this.state.pulsePhase += this.config.pulseSpeed * (deltaTime / 16.67);\r\n        \r\n        // Update scan position\r\n        if (scanning || this.state.isScanning) {\r\n            this.state.isScanning = true;\r\n            this.state.scanPosition += this.config.scanLineSpeed * this.state.scanDirection * (deltaTime / 16.67);\r\n            \r\n            // Reverse at bounds\r\n            if (this.state.scanPosition > 1) {\r\n                this.state.scanPosition = 1;\r\n                this.state.scanDirection = -1;\r\n            } else if (this.state.scanPosition < -1) {\r\n                this.state.scanPosition = -1;\r\n                this.state.scanDirection = 1;\r\n            }\r\n        }\r\n        \r\n        ctx.save();\r\n        \r\n        // Draw fingerprint rings\r\n        this.drawFingerprintPattern(ctx, x, y, radius);\r\n        \r\n        // Draw scanning line if active\r\n        if (this.state.isScanning) {\r\n            this.drawScanLine(ctx, x, y, radius);\r\n        }\r\n        \r\n        // Show auth result\r\n        if (authResult) {\r\n            this.showAuthResult(ctx, x, y, radius, authResult);\r\n        }\r\n        \r\n        ctx.restore();\r\n    },\r\n    \r\n    /**\r\n     * Draw the fingerprint pattern\r\n     */\r\n    drawFingerprintPattern: function(ctx, centerX, centerY, baseRadius) {\r\n        const pulse = Math.sin(this.state.pulsePhase) * 0.1 + 1;\r\n        \r\n        for (let ring = 0; ring < this.config.rings; ring++) {\r\n            const ringRadius = (ring + 1) * this.config.ringSpacing * pulse;\r\n            \r\n            // Skip if ring is outside visible area\r\n            if (ringRadius > baseRadius * 2) continue;\r\n            \r\n            ctx.beginPath();\r\n            ctx.strokeStyle = this.config.color;\r\n            ctx.lineWidth = this.config.lineWidth;\r\n            ctx.globalAlpha = this.config.opacity * (1 - ring / this.config.rings * 0.5);\r\n            \r\n            // Draw ring with breaks and distortions\r\n            for (let angle = 0; angle < Math.PI * 2; angle += 0.05) {\r\n                // Check for breaks\r\n                let shouldBreak = false;\r\n                for (const breakAngle of this.state.breaks[ring] || []) {\r\n                    if (Math.abs(angle - breakAngle) < 0.1) {\r\n                        shouldBreak = true;\r\n                        break;\r\n                    }\r\n                }\r\n                \r\n                if (shouldBreak) {\r\n                    ctx.stroke();\r\n                    ctx.beginPath();\r\n                    continue;\r\n                }\r\n                \r\n                // Apply whorl distortions\r\n                let distortedRadius = ringRadius;\r\n                let distortedAngle = angle + this.state.rotation;\r\n                \r\n                for (const whorl of this.state.whorls) {\r\n                    const whorldX = centerX + whorl.x * baseRadius;\r\n                    const whorldY = centerY + whorl.y * baseRadius;\r\n                    const pointX = centerX + Math.cos(distortedAngle) * distortedRadius;\r\n                    const pointY = centerY + Math.sin(distortedAngle) * distortedRadius;\r\n                    \r\n                    const distance = Math.sqrt(\r\n                        Math.pow(pointX - whorldX, 2) + \r\n                        Math.pow(pointY - whorldY, 2)\r\n                    );\r\n                    \r\n                    const influence = Math.exp(-distance / (baseRadius * 0.5)) * whorl.strength;\r\n                    distortedAngle += influence * 0.5;\r\n                }\r\n                \r\n                // Add wave pattern\r\n                const wave = Math.sin(angle * this.config.waveFrequency) * this.config.waveAmplitude;\r\n                distortedRadius += wave;\r\n                \r\n                // Draw point\r\n                const px = centerX + Math.cos(distortedAngle) * distortedRadius;\r\n                const py = centerY + Math.sin(distortedAngle) * distortedRadius;\r\n                \r\n                if (angle === 0) {\r\n                    ctx.moveTo(px, py);\r\n                } else {\r\n                    ctx.lineTo(px, py);\r\n                }\r\n            }\r\n            \r\n            ctx.stroke();\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Draw scanning line\r\n     */\r\n    drawScanLine: function(ctx, x, y, radius) {\r\n        const scanY = y + this.state.scanPosition * radius;\r\n        \r\n        // Create gradient for scan line\r\n        const gradient = ctx.createLinearGradient(x - radius, scanY, x + radius, scanY);\r\n        gradient.addColorStop(0, 'rgba(0, 255, 255, 0)');\r\n        gradient.addColorStop(0.5, this.config.glowColor);\r\n        gradient.addColorStop(1, 'rgba(0, 255, 255, 0)');\r\n        \r\n        ctx.strokeStyle = gradient;\r\n        ctx.lineWidth = this.config.scanLineWidth;\r\n        ctx.globalAlpha = 0.8;\r\n        ctx.shadowBlur = 10;\r\n        ctx.shadowColor = this.config.glowColor;\r\n        \r\n        ctx.beginPath();\r\n        ctx.moveTo(x - radius, scanY);\r\n        ctx.lineTo(x + radius, scanY);\r\n        ctx.stroke();\r\n        \r\n        ctx.shadowBlur = 0;\r\n    },\r\n    \r\n    /**\r\n     * Show authentication result\r\n     */\r\n    showAuthResult: function(ctx, x, y, radius, result) {\r\n        const color = result === 'success' ? this.config.successColor : this.config.failColor;\r\n        const text = result === 'success' ? '✓ AUTHENTICATED' : '✗ ACCESS DENIED';\r\n        \r\n        ctx.fillStyle = color;\r\n        ctx.font = `bold ${radius * 0.15}px monospace`;\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'middle';\r\n        ctx.globalAlpha = 0.9;\r\n        \r\n        ctx.fillText(text, x, y + radius * 1.3);\r\n        \r\n        // Draw result ring\r\n        ctx.strokeStyle = color;\r\n        ctx.lineWidth = 3;\r\n        ctx.globalAlpha = 0.5;\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, radius * 1.1, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n    },\r\n    \r\n    /**\r\n     * Start authentication scan\r\n     */\r\n    startScan: function() {\r\n        this.state.isScanning = true;\r\n        this.state.scanPosition = -1;\r\n        this.state.scanDirection = 1;\r\n        this.state.scanResult = null;\r\n    },\r\n    \r\n    /**\r\n     * Complete authentication scan\r\n     */\r\n    completeScan: function(success = true) {\r\n        this.state.isScanning = false;\r\n        this.state.scanResult = success ? 'success' : 'fail';\r\n        \r\n        // Clear result after 2 seconds\r\n        setTimeout(() => {\r\n            this.state.scanResult = null;\r\n        }, 2000);\r\n    },\r\n    \r\n    /**\r\n     * Reset the effect state\r\n     */\r\n    reset: function() {\r\n        this.state.rotation = 0;\r\n        this.state.pulsePhase = 0;\r\n        this.state.scanPosition = 0;\r\n        this.state.scanDirection = 1;\r\n        this.state.isScanning = false;\r\n        this.state.scanResult = null;\r\n    }\r\n};","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE - Visual Effects Registry\n *  └─○═╝                                                                             \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Central registry for visual effects like zen vortex, recording glow, etc.\n * @author Emotive Engine Team\n * @module effects\n */\n\n// Import all effect modules\nimport zenVortex from './zen-vortex.js';\nimport recordingGlow from './recording-glow.js';\nimport speakingPulse from './speaking-pulse.js';\nimport sleepingEffect from './sleeping-effect.js';\nimport suspicionScan from './suspicion-scan.js';\nimport gazeNarrowing from './gaze-narrowing.js';\nimport fingerprint from './fingerprint.js';\n\n// Registry to store all visual effects\nconst effectRegistry = new Map();\n\n/**\n * Register a visual effect module\n * @param {Object} effectModule - The effect module to register\n */\nexport function registerEffect(effectModule) {\n    if (!effectModule.name) {\n        return;\n    }\n    effectRegistry.set(effectModule.name, effectModule);\n}\n\n/**\n * Get effect by name\n * @param {string} effectName - Name of the effect\n * @returns {Object|null} The effect module or null\n */\nexport function getEffect(effectName) {\n    return effectRegistry.get(effectName) || null;\n}\n\n/**\n * Apply a visual effect\n * @param {string} effectName - Name of the effect to apply\n * @param {CanvasRenderingContext2D} ctx - Canvas context\n * @param {Object} params - Effect parameters\n * @returns {boolean} True if effect was applied\n */\nexport function applyEffect(effectName, ctx, params) {\n    const effect = getEffect(effectName);\n    if (!effect) {\n        return false;\n    }\n    \n    if (effect.apply) {\n        effect.apply(ctx, params);\n        return true;\n    }\n    \n    return false;\n}\n\n/**\n * Check if effect should be active\n * @param {string} effectName - Name of the effect\n * @param {Object} state - Current state\n * @returns {boolean} True if effect should be active\n */\nexport function isEffectActive(effectName, state) {\n    const effect = getEffect(effectName);\n    if (!effect || !effect.shouldActivate) {\n        return false;\n    }\n    return effect.shouldActivate(state);\n}\n\n/**\n * Get all registered effect names\n * @returns {Array} Array of effect names\n */\nexport function getAllEffects() {\n    return Array.from(effectRegistry.keys());\n}\n\n// Register all built-in effects\nregisterEffect(zenVortex);\nregisterEffect(recordingGlow);\nregisterEffect(speakingPulse);\nregisterEffect(sleepingEffect);\nregisterEffect(suspicionScan);\nregisterEffect(gazeNarrowing);\nregisterEffect(fingerprint);\n\nexport default {\n    registerEffect,\n    getEffect,\n    applyEffect,\n    isEffectActive,\n    getAllEffects\n};","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Musical Duration System\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Musical time calculation for tempo-aware gesture durations\r\n * @author Emotive Engine Team\r\n * @module core/MusicalDuration\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Converts between musical time (beats/bars) and clock time (milliseconds).        \r\n * ║ Ensures all gesture durations are perfect subdivisions of the beat, making        \r\n * ║ animations musically coherent at any tempo.                                      \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nimport rhythmEngine from './rhythm.js';\r\n\r\nclass MusicalDuration {\r\n    constructor() {\r\n        // Standard note durations in beats (4/4 time)\r\n        this.noteDurations = {\r\n            'whole': 4,\r\n            'half': 2,\r\n            'quarter': 1,\r\n            'eighth': 0.5,\r\n            'sixteenth': 0.25,\r\n            'triplet': 0.333,\r\n            'dotted-quarter': 1.5,\r\n            'dotted-half': 3\r\n        };\r\n        \r\n        // Cache for performance\r\n        this.cache = new Map();\r\n        this.lastBPM = 0;\r\n        \r\n        // Pre-warm cache with common BPMs and durations\r\n        this.prewarmCache();\r\n    }\r\n    \r\n    /**\r\n     * Pre-calculate common durations to prevent first-run lag\r\n     */\r\n    prewarmCache() {\r\n        const commonBPMs = [60, 90, 120, 140, 160, 180];\r\n        const commonDurations = [\r\n            { musical: true, beats: 1 },      // 1 beat\r\n            { musical: true, bars: 1 },       // 1 bar\r\n            { musical: true, beats: 0.5 },    // Half beat\r\n            { musical: true, beats: 2 }       // 2 beats\r\n        ];\r\n        \r\n        commonBPMs.forEach(bpm => {\r\n            commonDurations.forEach(duration => {\r\n                const key = `${bpm}_${JSON.stringify(duration)}`;\r\n                const ms = this.toMilliseconds(duration, bpm);\r\n                this.cache.set(key, ms);\r\n            });\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Convert musical duration to milliseconds\r\n     * @param {Object} duration - Musical duration config\r\n     * @param {number} [bpm] - Optional BPM override\r\n     * @returns {number} Duration in milliseconds\r\n     */\r\n    toMilliseconds(duration, bpm = null) {\r\n        const currentBPM = bpm || rhythmEngine.bpm || 120;\r\n        \r\n        // Handle different duration formats\r\n        if (typeof duration === 'number') {\r\n            // Already in milliseconds\r\n            return duration;\r\n        }\r\n        \r\n        if (typeof duration === 'object' && duration.musical) {\r\n            const beatDuration = 60000 / currentBPM;\r\n            \r\n            if (duration.beats !== undefined) {\r\n                // Specified in beats\r\n                return duration.beats * beatDuration;\r\n            } else if (duration.bars !== undefined) {\r\n                // Specified in bars (assume 4/4)\r\n                const timeSignature = rhythmEngine.timeSignature || [4, 4];\r\n                return duration.bars * timeSignature[0] * beatDuration;\r\n            } else if (duration.subdivision !== undefined) {\r\n                // Specified as note value\r\n                const beats = this.noteDurations[duration.subdivision] || 1;\r\n                return beats * beatDuration;\r\n            }\r\n        }\r\n        \r\n        // Default fallback\r\n        return 1000;\r\n    }\r\n    \r\n    /**\r\n     * Convert milliseconds to musical duration\r\n     * @param {number} ms - Duration in milliseconds\r\n     * @param {number} [bpm] - Optional BPM override\r\n     * @returns {Object} Musical duration\r\n     */\r\n    toMusical(ms, bpm = null) {\r\n        const currentBPM = bpm || rhythmEngine.bpm || 120;\r\n        const beatDuration = 60000 / currentBPM;\r\n        const beats = ms / beatDuration;\r\n        \r\n        // Find closest standard duration\r\n        let closestNote = 'quarter';\r\n        let closestDiff = Math.abs(beats - 1);\r\n        \r\n        for (const [note, duration] of Object.entries(this.noteDurations)) {\r\n            const diff = Math.abs(beats - duration);\r\n            if (diff < closestDiff) {\r\n                closestDiff = diff;\r\n                closestNote = note;\r\n            }\r\n        }\r\n        \r\n        return {\r\n            musical: true,\r\n            beats: beats,\r\n            bars: beats / 4,\r\n            closestSubdivision: closestNote,\r\n            exact: closestDiff < 0.01\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Calculate gesture phases with musical timing\r\n     * @param {Array} phases - Array of phase configurations\r\n     * @param {number} totalBeats - Total duration in beats\r\n     * @returns {Array} Phases with calculated timings\r\n     */\r\n    calculatePhases(phases, totalBeats) {\r\n        if (!phases || phases.length === 0) {\r\n            return [{ name: 'main', beats: totalBeats, start: 0, end: 1 }];\r\n        }\r\n        \r\n        // Calculate total beats from phases\r\n        const phaseBeats = phases.reduce((sum, phase) => sum + (phase.beats || 1), 0);\r\n        const scaleFactor = totalBeats / phaseBeats;\r\n        \r\n        let cumulativeBeats = 0;\r\n        return phases.map(phase => {\r\n            const beats = (phase.beats || 1) * scaleFactor;\r\n            const start = cumulativeBeats / totalBeats;\r\n            cumulativeBeats += beats;\r\n            const end = cumulativeBeats / totalBeats;\r\n            \r\n            return {\r\n                name: phase.name,\r\n                beats: beats,\r\n                start: start,\r\n                end: end,\r\n                duration: this.toMilliseconds({ musical: true, beats })\r\n            };\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Get progress through current beat\r\n     * @returns {number} Progress 0-1 through current beat\r\n     */\r\n    getBeatProgress() {\r\n        const timeInfo = rhythmEngine.getTimeInfo();\r\n        return timeInfo ? timeInfo.beatProgress : 0;\r\n    }\r\n    \r\n    /**\r\n     * Get progress through current bar\r\n     * @returns {number} Progress 0-1 through current bar\r\n     */\r\n    getBarProgress() {\r\n        const timeInfo = rhythmEngine.getTimeInfo();\r\n        return timeInfo ? timeInfo.barProgress : 0;\r\n    }\r\n    \r\n    /**\r\n     * Calculate when next musical boundary occurs\r\n     * @param {string} boundary - 'beat', 'bar', 'phrase'\r\n     * @returns {number} Milliseconds until boundary\r\n     */\r\n    timeToNextBoundary(boundary = 'beat') {\r\n        const timeInfo = rhythmEngine.getTimeInfo();\r\n        if (!timeInfo) return 100;\r\n        \r\n        switch (boundary) {\r\n            case 'beat':\r\n                return timeInfo.nextBeatIn;\r\n            case 'bar':\r\n                const beatsInBar = timeInfo.timeSignature[0];\r\n                const beatsToBar = beatsInBar - timeInfo.beatInBar;\r\n                return beatsToBar * timeInfo.beatDuration;\r\n            case 'phrase':\r\n                // Assume 4-bar phrases\r\n                const barsInPhrase = 4;\r\n                const currentBar = timeInfo.bar || 0;\r\n                const barsToPhrase = barsInPhrase - (currentBar % barsInPhrase);\r\n                return barsToPhrase * beatsInBar * timeInfo.beatDuration;\r\n            default:\r\n                return timeInfo.nextBeatIn;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Quantize a duration to nearest musical subdivision\r\n     * @param {number} ms - Duration in milliseconds\r\n     * @param {string} subdivision - Target subdivision\r\n     * @returns {number} Quantized duration in ms\r\n     */\r\n    quantize(ms, subdivision = 'eighth') {\r\n        const bpm = rhythmEngine.bpm || 120;\r\n        const beatDuration = 60000 / bpm;\r\n        const targetBeats = this.noteDurations[subdivision] || 1;\r\n        const targetMs = targetBeats * beatDuration;\r\n        \r\n        // Round to nearest multiple of target\r\n        const multiple = Math.round(ms / targetMs);\r\n        return multiple * targetMs;\r\n    }\r\n    \r\n    /**\r\n     * Check if we're on a musical boundary\r\n     * @param {string} boundary - 'beat', 'bar', 'phrase'\r\n     * @param {number} tolerance - Tolerance in ms\r\n     * @returns {boolean}\r\n     */\r\n    isOnBoundary(boundary = 'beat', tolerance = 50) {\r\n        const timeToNext = this.timeToNextBoundary(boundary);\r\n        const timeInfo = rhythmEngine.getTimeInfo();\r\n        \r\n        if (!timeInfo) return false;\r\n        \r\n        // Check if we just passed or are about to hit boundary\r\n        return timeToNext < tolerance || \r\n               (timeInfo.beatDuration - timeToNext) < tolerance;\r\n    }\r\n    \r\n    /**\r\n     * Get tempo-adaptive animation parameters\r\n     * @param {number} baseTempo - Reference tempo\r\n     * @returns {Object} Animation adjustment factors\r\n     */\r\n    getTempoAdaptation(baseTempo = 120) {\r\n        const currentTempo = rhythmEngine.bpm || 120;\r\n        const tempoRatio = currentTempo / baseTempo;\r\n        \r\n        return {\r\n            speed: tempoRatio,\r\n            energy: Math.min(2, Math.max(0.5, tempoRatio)),\r\n            smoothness: tempoRatio < 0.8 ? 1.2 : tempoRatio > 1.5 ? 0.8 : 1,\r\n            intensity: tempoRatio > 1.3 ? 1.2 : tempoRatio < 0.7 ? 0.8 : 1\r\n        };\r\n    }\r\n}\r\n\r\n// Create singleton instance\r\nconst musicalDuration = new MusicalDuration();\r\n\r\nexport { musicalDuration, MusicalDuration };\r\nexport default musicalDuration;","/**\r\n * GestureAnimator - Handles all gesture animations for EmotiveRenderer\r\n * @module core/renderer/GestureAnimator\r\n */\r\n\r\nimport { getGesture } from '../gestures/index.js';\r\nimport musicalDuration from '../MusicalDuration.js';\r\n\r\nexport class GestureAnimator {\r\n    constructor(renderer) {\r\n        this.renderer = renderer;\r\n        this.activeGestures = new Map();\r\n        this.scaleFactor = renderer.scaleFactor || 1;\r\n        \r\n        // Gesture animations state\r\n        this.gestureAnimations = {\r\n            bounce: { active: false, progress: 0, params: {} },\r\n            pulse: { active: false, progress: 0, params: {} },\r\n            shake: { active: false, progress: 0, params: {} },\r\n            spin: { active: false, progress: 0, params: {} },\r\n            nod: { active: false, progress: 0, params: {} },\r\n            tilt: { active: false, progress: 0, params: {} },\r\n            expand: { active: false, progress: 0, params: {} },\r\n            contract: { active: false, progress: 0, params: {} },\r\n            flash: { active: false, progress: 0, params: {} },\r\n            drift: { active: false, progress: 0, params: {} },\r\n            stretch: { active: false, progress: 0, params: {} },\r\n            glow: { active: false, progress: 0, params: {} },\r\n            flicker: { active: false, progress: 0, params: {} },\r\n            vibrate: { active: false, progress: 0, params: {} },\r\n            orbital: { active: false, progress: 0, params: {} },  // ADDED\r\n            hula: { active: false, progress: 0, params: {} },     // ADDED\r\n            wave: { active: false, progress: 0, params: {} },\r\n            breathe: { active: false, progress: 0, params: {} },\r\n            morph: { active: false, progress: 0, params: {} },\r\n            slowBlink: { active: false, progress: 0, params: {} },\r\n            look: { active: false, progress: 0, params: {} },\r\n            settle: { active: false, progress: 0, params: {} },\r\n            breathIn: { active: false, progress: 0, params: {} },\r\n            breathOut: { active: false, progress: 0, params: {} },\r\n            breathHold: { active: false, progress: 0, params: {} },\r\n            breathHoldEmpty: { active: false, progress: 0, params: {} },\r\n            jump: { active: false, progress: 0, params: {} },\r\n            sway: { active: false, progress: 0, params: {} },\r\n            float: { active: false, progress: 0, params: {} },\r\n            sparkle: { active: false, progress: 0, params: {} },\r\n            shimmer: { active: false, progress: 0, params: {} },\r\n            wiggle: { active: false, progress: 0, params: {} },\r\n            groove: { active: false, progress: 0, params: {} },\r\n            point: { active: false, progress: 0, params: {} },\r\n            lean: { active: false, progress: 0, params: {} },\r\n            reach: { active: false, progress: 0, params: {} },\r\n            headBob: { active: false, progress: 0, params: {} },\r\n            orbit: { active: false, progress: 0, params: {} },\r\n            rain: { active: false, progress: 0, params: {} },\r\n            runningman: { active: false, progress: 0, params: {} },\r\n            charleston: { active: false, progress: 0, params: {} }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Start a gesture animation\r\n     * @param {string} gestureName - Name of the gesture to start\r\n     */\r\n    startGesture(gestureName) {\r\n        \r\n        // Get the gesture configuration\r\n        const gesture = getGesture(gestureName);\r\n        \r\n        // Trigger chromatic aberration for impact gestures\r\n        const impactGestures = ['bounce', 'shake', 'pulse', 'flash', 'jump', 'slam', 'spin', 'flicker'];\r\n        if (impactGestures.includes(gestureName) && this.renderer.specialEffects) {\r\n            // Vary intensity based on gesture - all high for testing\r\n            const intensities = {\r\n                'flash': 1.0,\r\n                'jump': 1.0,\r\n                'shake': 0.9,\r\n                'bounce': 0.8,\r\n                'pulse': 0.7,\r\n                'slam': 1.0,\r\n                'spin': 0.8,\r\n                'flicker': 1.0\r\n            };\r\n            const intensity = intensities[gestureName] || 0.8;\r\n            this.renderer.specialEffects.triggerChromaticAberration(intensity);\r\n            console.log(`[Chromatic Aberration] Triggered for ${gestureName} with intensity ${intensity}`);\r\n        }\r\n        \r\n        // Get composed parameters based on current emotion and undertone\r\n        // Use the renderer's gestureCompositor if available\r\n        let params;\r\n        if (this.renderer.gestureCompositor) {\r\n            params = this.renderer.gestureCompositor.compose(\r\n                gestureName,\r\n                this.renderer.state.emotion,\r\n                this.renderer.currentUndertone\r\n            );\r\n        } else {\r\n            // Fallback to gesture's default config if no compositor\r\n            params = gesture?.config || {\r\n                amplitude: 20,\r\n                frequency: 2,\r\n                duration: 1000,\r\n                scaleAmount: 0.2,\r\n                glowAmount: 0.3,\r\n                rotations: 1,\r\n                distance: 50,\r\n                angle: 15,\r\n                scaleTarget: 1.5,\r\n                glowPeak: 2.0,\r\n                scalePeak: 1.1,\r\n                scaleX: 1.2,\r\n                scaleY: 0.8,\r\n                maxOpacity: 1,\r\n                minOpacity: 0.5,\r\n                lookDirection: 'random',\r\n                lookDistance: 1,\r\n                wobbleFreq: 4,\r\n                squashAmount: 0.8,\r\n                stretchAmount: 1.2,\r\n                jumpHeight: 100,\r\n                decay: true,\r\n                easing: 'sine',\r\n                effects: []\r\n            };\r\n        }\r\n        \r\n        // Calculate duration from gesture config\r\n        let duration = 1000; // Default fallback\r\n        if (gesture && gesture.config) {\r\n            if (gesture.config.musicalDuration) {\r\n                // Use musical duration system\r\n                duration = musicalDuration.toMilliseconds(gesture.config.musicalDuration);\r\n            } else if (gesture.config.duration) {\r\n                // Use fixed duration\r\n                duration = gesture.config.duration;\r\n            }\r\n        }\r\n        \r\n        // Set up the animation\r\n        const anim = this.gestureAnimations[gestureName];\r\n        if (anim) {\r\n            anim.active = true;\r\n            anim.startTime = performance.now();\r\n            anim.progress = 0;\r\n            anim.params = params;\r\n            anim.duration = duration; // Store calculated duration\r\n            \r\n            // Reset random values for gestures that use them\r\n            if (gestureName === 'shake') {\r\n                anim.randomAngle = undefined; // Will be regenerated\r\n            } else if (gestureName === 'drift') {\r\n                anim.startX = undefined;\r\n                anim.startY = undefined;\r\n                anim.currentDriftAngle = undefined; // Reset the angle for new random direction\r\n            } else if (gestureName === 'tilt') {\r\n                anim.tiltDirection = undefined; // Reset for new random direction\r\n            } else if (gestureName === 'vibrate') {\r\n                anim.vibrateAngles = undefined;\r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply all active gesture animations\r\n     * @returns {Object} Combined transformation values\r\n     */\r\n    applyGestureAnimations() {\r\n        const now = performance.now();\r\n        const transform = {\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n            scale: 1,\r\n            rotation: 0,\r\n            glow: 1\r\n        };\r\n        \r\n        // Process each gesture animation\r\n        for (const [gestureName, anim] of Object.entries(this.gestureAnimations)) {\r\n            if (!anim.active) continue;\r\n            \r\n            const elapsed = now - anim.startTime;\r\n            // Use stored duration or fallback to params duration\r\n            const duration = anim.duration || (anim.params ? anim.params.duration : 1000);\r\n            anim.progress = Math.min(elapsed / duration, 1);\r\n            \r\n            // Apply easing\r\n            const easedProgress = this.applyEasing(anim.progress, anim.params.easing);\r\n            \r\n            // Apply gesture-specific transformations\r\n            let gestureTransform = {};\r\n            switch (gestureName) {\r\n                case 'bounce':\r\n                    gestureTransform = this.applyBounce(anim, easedProgress);\r\n                    break;\r\n                case 'pulse':\r\n                    gestureTransform = this.applyPulse(anim, easedProgress);\r\n                    break;\r\n                case 'shake':\r\n                    gestureTransform = this.applyShake(anim, easedProgress);\r\n                    break;\r\n                case 'spin':\r\n                    gestureTransform = this.applySpin(anim, easedProgress);\r\n                    break;\r\n                case 'nod':\r\n                    gestureTransform = this.applyNod(anim, easedProgress);\r\n                    break;\r\n                case 'tilt':\r\n                    gestureTransform = this.applyTilt(anim, easedProgress);\r\n                    break;\r\n                case 'expand':\r\n                    gestureTransform = this.applyExpand(anim, easedProgress);\r\n                    break;\r\n                case 'contract':\r\n                    gestureTransform = this.applyContract(anim, easedProgress);\r\n                    break;\r\n                case 'flash':\r\n                    gestureTransform = this.applyFlash(anim, easedProgress);\r\n                    break;\r\n                case 'drift':\r\n                    gestureTransform = this.applyDrift(anim, easedProgress);\r\n                    break;\r\n                case 'stretch':\r\n                    gestureTransform = this.applyStretch(anim, easedProgress);\r\n                    break;\r\n                case 'glow':\r\n                    gestureTransform = this.applyGlow(anim, easedProgress);\r\n                    break;\r\n                case 'flicker':\r\n                    gestureTransform = this.applyFlicker(anim, easedProgress);\r\n                    break;\r\n                case 'vibrate':\r\n                    gestureTransform = this.applyVibrate(anim, easedProgress);\r\n                    break;\r\n                case 'orbital':\r\n                    gestureTransform = this.applyOrbital(anim, easedProgress);\r\n                    break;\r\n                case 'hula':\r\n                    gestureTransform = this.applyHula(anim, easedProgress);\r\n                    break;\r\n                case 'wave':\r\n                    gestureTransform = this.applyWave(anim, easedProgress);\r\n                    break;\r\n                case 'breathe':\r\n                    gestureTransform = this.applyBreathe(anim, easedProgress);\r\n                    break;\r\n                case 'morph':\r\n                    gestureTransform = this.applyMorph(anim, easedProgress);\r\n                    break;\r\n                case 'slowBlink':\r\n                    gestureTransform = this.applySlowBlink(anim, easedProgress);\r\n                    break;\r\n                case 'look':\r\n                    gestureTransform = this.applyLook(anim, easedProgress);\r\n                    break;\r\n                case 'settle':\r\n                    gestureTransform = this.applySettle(anim, easedProgress);\r\n                    break;\r\n                case 'breathIn':\r\n                    gestureTransform = this.applyBreathIn(anim, easedProgress);\r\n                    break;\r\n                case 'breathOut':\r\n                    gestureTransform = this.applyBreathOut(anim, easedProgress);\r\n                    break;\r\n                case 'breathHold':\r\n                    gestureTransform = this.applyBreathHold(anim, easedProgress);\r\n                    break;\r\n                case 'breathHoldEmpty':\r\n                    gestureTransform = this.applyBreathHoldEmpty(anim, easedProgress);\r\n                    break;\r\n                case 'jump':\r\n                    gestureTransform = this.applyJump(anim, easedProgress);\r\n                    break;\r\n                case 'sway':\r\n                    gestureTransform = this.applySway(anim, easedProgress);\r\n                    break;\r\n                case 'float':\r\n                    gestureTransform = this.applyFloat(anim, easedProgress);\r\n                    break;\r\n                case 'rain':\r\n                    gestureTransform = this.applyRain(anim, easedProgress);\r\n                    break;\r\n                case 'runningman':\r\n                    gestureTransform = this.applyRunningMan(anim, easedProgress);\r\n                    break;\r\n                case 'charleston':\r\n                    gestureTransform = this.applyCharleston(anim, easedProgress);\r\n                    break;\r\n                case 'sparkle':\r\n                    gestureTransform = this.applySparkle(anim, easedProgress);\r\n                    break;\r\n                case 'shimmer':\r\n                    gestureTransform = this.applyShimmer(anim, easedProgress);\r\n                    break;\r\n                case 'wiggle':\r\n                    gestureTransform = this.applyWiggle(anim, easedProgress);\r\n                    break;\r\n                case 'groove':\r\n                    gestureTransform = this.applyGroove(anim, easedProgress);\r\n                    break;\r\n                case 'point':\r\n                    gestureTransform = this.applyPoint(anim, easedProgress);\r\n                    break;\r\n                case 'lean':\r\n                    gestureTransform = this.applyLean(anim, easedProgress);\r\n                    break;\r\n                case 'reach':\r\n                    gestureTransform = this.applyReach(anim, easedProgress);\r\n                    break;\r\n                case 'headBob':\r\n                    gestureTransform = this.applyHeadBob(anim, easedProgress);\r\n                    break;\r\n                case 'orbit':\r\n                    gestureTransform = this.applyOrbit(anim, easedProgress);\r\n                    break;\r\n            }\r\n            \r\n            // Combine transforms\r\n            transform.offsetX += gestureTransform.offsetX || 0;\r\n            transform.offsetY += gestureTransform.offsetY || 0;\r\n            transform.scale *= gestureTransform.scale || 1;\r\n            transform.rotation += gestureTransform.rotation || 0;\r\n            // Use MAX for glow instead of multiplying to prevent accumulation\r\n            transform.glow = Math.max(transform.glow, gestureTransform.glow || 1);\r\n            \r\n            // Pass flash wave data if present\r\n            if (gestureTransform.flashWave) {\r\n                transform.flashWave = gestureTransform.flashWave;\r\n            }\r\n            \r\n            // Pass firefly effect data if present (for sparkle gesture)\r\n            if (gestureTransform.fireflyEffect) {\r\n                transform.fireflyEffect = gestureTransform.fireflyEffect;\r\n                transform.particleGlow = gestureTransform.particleGlow;\r\n                transform.fireflyTime = gestureTransform.fireflyTime;\r\n            }\r\n            \r\n            // Pass flicker effect data if present (for flicker gesture - now does particle shimmer)\r\n            if (gestureTransform.flickerEffect) {\r\n                transform.flickerEffect = gestureTransform.flickerEffect;\r\n                transform.particleGlow = gestureTransform.particleGlow;\r\n                transform.flickerTime = gestureTransform.flickerTime;\r\n            }\r\n            \r\n            // Pass shimmer effect data if present (for shimmer gesture - subtle glow)\r\n            if (gestureTransform.shimmerEffect) {\r\n                transform.shimmerEffect = gestureTransform.shimmerEffect;\r\n                transform.particleGlow = gestureTransform.particleGlow;\r\n                transform.shimmerTime = gestureTransform.shimmerTime;\r\n                transform.shimmerWave = gestureTransform.shimmerWave;\r\n            }\r\n            \r\n            // Pass glow effect data if present (for glow gesture)\r\n            if (gestureTransform.glowEffect) {\r\n                transform.glowEffect = gestureTransform.glowEffect;\r\n                transform.particleGlow = gestureTransform.particleGlow;\r\n                transform.glowTime = gestureTransform.glowTime;\r\n                transform.glowProgress = gestureTransform.glowProgress;\r\n                transform.glowEnvelope = gestureTransform.glowEnvelope;\r\n            }\r\n            \r\n            // Check if animation is complete\r\n            if (anim.progress >= 1) {\r\n                anim.active = false;\r\n                anim.progress = 0;\r\n                anim.startTime = 0;\r\n                // Clean up flash wave data\r\n                if (gestureName === 'flash') {\r\n                    anim.flashWave = null;\r\n                    anim.flashWaveData = null;\r\n                }\r\n            }\r\n        }\r\n        \r\n        return transform;\r\n    }\r\n\r\n    /**\r\n     * Update active gestures\r\n     * @param {number} deltaTime - Time since last frame\r\n     */\r\n    update(deltaTime) {\r\n        // Update logic moved to applyGestureAnimations\r\n        return this.applyGestureAnimations();\r\n    }\r\n\r\n    /**\r\n     * Stop all active gestures\r\n     */\r\n    stopAllGestures() {\r\n        // Reset all gesture animations\r\n        Object.keys(this.gestureAnimations).forEach(key => {\r\n            this.gestureAnimations[key].active = false;\r\n            this.gestureAnimations[key].startTime = 0;\r\n            this.gestureAnimations[key].progress = 0;\r\n            this.gestureAnimations[key].params = null;\r\n        });\r\n        this.activeGestures.clear();\r\n    }\r\n    \r\n    /**\r\n     * Get current active gesture information for particle system\r\n     * @returns {Object|null} Current gesture with particleMotion and progress, or null\r\n     */\r\n    getCurrentGesture() {\r\n        // Priority: Find override gestures first (like orbital, hula), then other gestures\r\n        const overrideGestures = ['orbital', 'hula', 'wave', 'spin'];\r\n        \r\n        // Check override gestures first\r\n        for (const gestureName of overrideGestures) {\r\n            const anim = this.gestureAnimations[gestureName];\r\n            if (anim && anim.active) {\r\n                // Get the actual gesture configuration\r\n                const gesture = getGesture(gestureName);\r\n                \r\n                // Use the gesture's config for particleMotion, or create one from gesture type\r\n                const particleMotion = gesture?.config?.particleMotion || {\r\n                    type: gestureName,  // This ensures the modular gesture system will find it\r\n                    strength: anim.params?.strength || 1.0\r\n                };\r\n                \r\n                const gestureInfo = {\r\n                    name: gestureName,\r\n                    particleMotion: particleMotion,\r\n                    progress: anim.progress || 0,\r\n                    params: anim.params\r\n                };\r\n                \r\n                return gestureInfo;\r\n            }\r\n        }\r\n        \r\n        // Then check all other gestures\r\n        for (const [gestureName, anim] of Object.entries(this.gestureAnimations)) {\r\n            if (anim.active) {\r\n                // Get the actual gesture configuration\r\n                const gesture = getGesture(gestureName);\r\n                \r\n                // Use the gesture's config for particleMotion, or params if available\r\n                const particleMotion = gesture?.config?.particleMotion || \r\n                                      anim.params?.particleMotion || \r\n                                      { type: gestureName, strength: anim.params?.strength || 1.0 };\r\n                \r\n                const gestureInfo = {\r\n                    name: gestureName,\r\n                    particleMotion: particleMotion,\r\n                    progress: anim.progress || 0,\r\n                    params: anim.params\r\n                };\r\n                \r\n                // Include breathPhase for breathe gesture\r\n                if (gestureName === 'breathe' && anim.breathPhase !== undefined) {\r\n                    gestureInfo.breathPhase = anim.breathPhase;\r\n                }\r\n                \r\n                return gestureInfo;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    /**\r\n     * Apply easing function to progress\r\n     */\r\n    applyEasing(progress, easing) {\r\n        switch (easing) {\r\n            case 'linear':\r\n                return progress;\r\n            case 'quad':\r\n                return progress * progress;\r\n            case 'cubic':\r\n                return progress * progress * progress;\r\n            case 'sine':\r\n                return Math.sin(progress * Math.PI / 2);\r\n            case 'back':\r\n                return progress * progress * (2.7 * progress - 1.7);\r\n            default:\r\n                return progress;\r\n        }\r\n    }\r\n    \r\n    // Individual gesture application methods\r\n    applyBounce(anim, progress) {\r\n        const bounce = Math.abs(Math.sin(progress * Math.PI * anim.params.frequency)) * anim.params.amplitude * this.scaleFactor;\r\n        // Apply effects\r\n        const multiplier = anim.params.effects && anim.params.effects.includes('gravity') ? 0.6 : 1;\r\n        return { offsetY: -bounce * multiplier };\r\n    }\r\n    \r\n    applyPulse(anim, progress) {\r\n        const pulse = Math.sin(progress * Math.PI * anim.params.frequency);\r\n        return {\r\n            scale: 1 + pulse * anim.params.scaleAmount,\r\n            glow: 1 + pulse * anim.params.glowAmount\r\n        };\r\n    }\r\n    \r\n    applyShake(anim, progress) {\r\n        // Initialize random direction for this shake if not set\r\n        if (!anim.randomAngle) {\r\n            anim.randomAngle = Math.random() * Math.PI * 2; // Random angle in radians\r\n        }\r\n        const decay = anim.params.decay ? (1 - progress) : 1;\r\n        const shake = Math.sin(progress * Math.PI * anim.params.frequency) * anim.params.amplitude * decay * this.scaleFactor;\r\n        return {\r\n            offsetX: shake * Math.cos(anim.randomAngle),\r\n            offsetY: shake * Math.sin(anim.randomAngle)\r\n        };\r\n    }\r\n    \r\n    applySpin(anim, progress) {\r\n        // Ensure full rotation even if progress doesn't quite reach 1.0\r\n        const actualProgress = Math.min(progress * 1.05, 1.0); // Slight overshoot to ensure completion\r\n        return {\r\n            rotation: actualProgress * anim.params.rotations * 360,\r\n            scale: 1 + Math.sin(progress * Math.PI) * anim.params.scaleAmount\r\n        };\r\n    }\r\n    \r\n    applyNod(anim, progress) {\r\n        const nod = Math.sin(progress * Math.PI * anim.params.frequency) * anim.params.amplitude * this.scaleFactor;\r\n        return { offsetY: nod };\r\n    }\r\n    \r\n    applyTilt(anim, progress) {\r\n        if (!anim.tiltDirection) {\r\n            // Randomly choose left (-1) or right (1) tilt\r\n            anim.tiltDirection = Math.random() < 0.5 ? -1 : 1;\r\n        }\r\n        const frequency = anim.params.frequency || 2;\r\n        const angle = (anim.params.angle || 15) * Math.PI / 180; // Convert to radians\r\n        const tiltProgress = Math.sin(progress * Math.PI * frequency) * anim.tiltDirection;\r\n        \r\n        // Apply both rotation and skew to make tilt visible on circular orb\r\n        return { \r\n            rotation: tiltProgress * angle,\r\n            // Skew the orb slightly to show tilt motion\r\n            scaleX: 1 + Math.abs(tiltProgress) * 0.1,  // Widen when tilted\r\n            scaleY: 1 - Math.abs(tiltProgress) * 0.05, // Compress slightly\r\n            // Move slightly with tilt\r\n            offsetX: tiltProgress * 10,\r\n            offsetY: Math.abs(tiltProgress) * -5  // Lift slightly when tilted\r\n        };\r\n    }\r\n    \r\n    applyExpand(anim, progress) {\r\n        // Use scaleAmount or scaleTarget (handle both config formats)\r\n        // Make sure we're expanding, not contracting\r\n        const targetScale = Math.max(anim.params.scaleAmount || anim.params.scaleTarget || 1.5, 1.0);\r\n        const easedProgress = Math.sin(progress * Math.PI / 2); // Smooth ease-out\r\n        const scale = 1 + (targetScale - 1) * easedProgress;\r\n        return {\r\n            scale: scale,\r\n            glow: 1 + Math.abs(anim.params.glowAmount || 0.2) * easedProgress\r\n        };\r\n    }\r\n    \r\n    applyContract(anim, progress) {\r\n        // Use scaleAmount or scaleTarget (handle both config formats)\r\n        const targetScale = anim.params.scaleAmount || anim.params.scaleTarget || 0.7;\r\n        const easedProgress = Math.sin(progress * Math.PI / 2); // Smooth ease-out\r\n        const scale = 1 + (targetScale - 1) * easedProgress;\r\n        return {\r\n            scale: scale,\r\n            glow: 1 + (anim.params.glowAmount || -0.2) * easedProgress\r\n        };\r\n    }\r\n    \r\n    applyFlash(anim, progress) {\r\n        const flash = Math.sin(progress * Math.PI); // Quick up and down\r\n        const glowPeak = anim.params.glowPeak || 2.0;  // Default if not defined\r\n        const scalePeak = anim.params.scalePeak || 1.1; // Default if not defined\r\n        return {\r\n            glow: 1 + (glowPeak - 1) * flash,\r\n            scale: 1 + (scalePeak - 1) * flash\r\n        };\r\n    }\r\n    \r\n    applyDrift(anim, progress) {\r\n        // Initialize drift angle when starting (progress near 0)\r\n        if (progress <= 0.01 && !anim.currentDriftAngle) {\r\n            // Always pick a random angle for drift\r\n            anim.currentDriftAngle = Math.random() * Math.PI * 2; // Random direction in radians\r\n        }\r\n        \r\n        const distance = anim.params.distance * Math.sin(progress * Math.PI) * this.scaleFactor;\r\n        const angle = anim.currentDriftAngle || 0;\r\n        \r\n        // Clear the angle when animation completes\r\n        if (progress >= 0.99) {\r\n            anim.currentDriftAngle = null;\r\n        }\r\n        \r\n        return {\r\n            offsetX: Math.cos(angle) * distance,\r\n            offsetY: Math.sin(angle) * distance\r\n        };\r\n    }\r\n    \r\n    applyStretch(anim, progress) {\r\n        const stretch = Math.sin(progress * Math.PI * anim.params.frequency);\r\n        // Note: We'd need to handle scaleX/scaleY separately for proper stretch\r\n        // For now, average them\r\n        const avgScale = (anim.params.scaleX + anim.params.scaleY) / 2;\r\n        return { scale: 1 + (avgScale - 1) * stretch };\r\n    }\r\n    \r\n    applyGlow(anim, progress) {\r\n        // Glow effect - pure luminosity like pulse but without movement\r\n        // Copy of pulse logic but focused only on glow\r\n\r\n        const glowPulse = Math.sin(progress * Math.PI * anim.params.frequency);\r\n\r\n        return {\r\n            scale: 1 + glowPulse * (anim.params.scaleAmount || 0.1), // Very subtle scale like new glow config\r\n            glow: 1 + glowPulse * (anim.params.glowAmount || 0.8)    // Strong glow like new glow config\r\n        };\r\n    }\r\n    \r\n    applyFlash(anim, progress) {\r\n        // Wave-like flash that emanates outward\r\n        // Store wave state in the animation object\r\n        if (!anim.flashWave) {\r\n            anim.flashWave = {\r\n                innerRadius: 0,\r\n                outerRadius: 0,\r\n                maxRadius: 3.0 // How far the wave travels (relative to core)\r\n            };\r\n        }\r\n        \r\n        // Update wave radius based on progress\r\n        anim.flashWave.outerRadius = progress * anim.flashWave.maxRadius;\r\n        anim.flashWave.innerRadius = Math.max(0, (progress - 0.1) * anim.flashWave.maxRadius);\r\n        \r\n        // Fade intensity as wave travels outward\r\n        const waveIntensity = Math.max(0, 1 - progress * 0.7);\r\n        \r\n        // Store wave data for renderer to use\r\n        anim.flashWaveData = {\r\n            innerRadius: anim.flashWave.innerRadius,\r\n            outerRadius: anim.flashWave.outerRadius,\r\n            intensity: waveIntensity\r\n        };\r\n        \r\n        // Return a very subtle glow increase at the core\r\n        return {\r\n            glow: 1 + waveIntensity * 0.3, // Very subtle core glow\r\n            flashWave: anim.flashWaveData // Pass wave data to renderer\r\n        };\r\n    }\r\n    \r\n    applyFlicker(anim, progress) {\r\n        // Flicker effect - particles shimmer with wave-like pulsing\r\n        const intensity = anim.params?.intensity || 2.0;\r\n        const shimmerSpeed = anim.params?.speed || 3;\r\n        \r\n        // Smooth sine wave for shimmer\r\n        const glow = 1 + Math.sin(progress * Math.PI * 2 * shimmerSpeed) * intensity * 0.3;\r\n        \r\n        // Slight horizontal wave motion\r\n        const waveX = Math.sin(progress * Math.PI * 4) * 5 * this.scaleFactor;\r\n        \r\n        // Create time-based shimmer for particles\r\n        const time = Date.now() * 0.001; // Convert to seconds\r\n        \r\n        // Main shimmer pulse\r\n        const mainPulse = Math.sin(progress * Math.PI * shimmerSpeed * 2) * 0.5 + 0.5;\r\n        \r\n        return {\r\n            offsetX: waveX,\r\n            glow: glow,\r\n            particleGlow: intensity * mainPulse, // Intensity for particles\r\n            flickerTime: time, // Pass time for particle calculations\r\n            flickerEffect: true // Flag to enable flicker effect on particles (shimmer-like)\r\n        };\r\n    }\r\n    \r\n    applyVibrate(anim, progress) {\r\n        // Initialize random vibration pattern if not set\r\n        if (!anim.vibrateAngles) {\r\n            anim.vibrateAngles = {\r\n                x: Math.random() * 2 - 1, // Random factor between -1 and 1\r\n                y: Math.random() * 2 - 1\r\n            };\r\n            // Normalize to unit vector\r\n            const mag = Math.sqrt(anim.vibrateAngles.x ** 2 + anim.vibrateAngles.y ** 2);\r\n            anim.vibrateAngles.x /= mag;\r\n            anim.vibrateAngles.y /= mag;\r\n        }\r\n        const vibration = Math.sin(progress * Math.PI * 2 * anim.params.frequency) * anim.params.amplitude * this.scaleFactor;\r\n        return {\r\n            offsetX: vibration * anim.vibrateAngles.x,\r\n            offsetY: vibration * anim.vibrateAngles.y\r\n        };\r\n    }\r\n    \r\n    applyWave(anim, progress) {\r\n        // Completely rewritten wave - a graceful, flowing infinity symbol motion\r\n        const amp = (anim.params.amplitude || 40) * this.scaleFactor;\r\n        \r\n        // Create a smooth infinity symbol (∞) pattern\r\n        // This feels more like a natural greeting wave\r\n        const t = progress * Math.PI * 2;\r\n        \r\n        // Infinity symbol parametric equations\r\n        // X: figure-8 horizontal motion\r\n        const infinityX = Math.sin(t) * amp;\r\n        \r\n        // Y: gentle vertical bob that rises during the wave\r\n        // Creates a \"lifting\" feeling like a real wave hello\r\n        const liftAmount = -Math.sin(progress * Math.PI) * amp * 0.3; // Lift up during wave\r\n        const infinityY = Math.sin(t * 2) * amp * 0.2 + liftAmount;\r\n        \r\n        // Add a subtle tilt that follows the wave direction\r\n        // Makes the orb \"lean into\" the wave\r\n        const tilt = Math.sin(t) * 5; // ±5 degrees of tilt\r\n        \r\n        // Gentle scale pulse for emphasis\r\n        const scalePulse = 1 + Math.sin(progress * Math.PI * 2) * 0.05; // 5% scale variation\r\n        \r\n        // Glow brightens slightly during wave\r\n        const glowPulse = 1 + Math.sin(progress * Math.PI) * 0.2; // 20% glow increase\r\n        \r\n        return {\r\n            offsetX: infinityX,\r\n            offsetY: infinityY,\r\n            rotation: tilt,\r\n            scale: scalePulse,\r\n            glow: glowPulse\r\n        };\r\n    }\r\n    \r\n    applyBreathe(anim, progress) {\r\n        // Deliberate, mindful breathing animation\r\n        const params = anim.params;\r\n        const holdPercent = params.particleMotion?.holdPercent || 0.1;\r\n        \r\n        // Create a breathing curve with holds at peaks\r\n        let breathPhase;\r\n        if (progress < 0.4) {\r\n            // Inhale phase (0-40%)\r\n            breathPhase = Math.sin((progress / 0.4) * Math.PI / 2);\r\n        } else if (progress < 0.4 + holdPercent) {\r\n            // Hold at full inhale\r\n            breathPhase = 1.0;\r\n        } else if (progress < 0.9) {\r\n            // Exhale phase  \r\n            const exhaleProgress = (progress - 0.4 - holdPercent) / (0.5 - holdPercent);\r\n            breathPhase = Math.cos(exhaleProgress * Math.PI / 2);\r\n        } else {\r\n            // Hold at full exhale\r\n            breathPhase = 0;\r\n        }\r\n        \r\n        // Apply scale changes - expand on inhale\r\n        const scaleAmount = params.scaleAmount || 0.25;\r\n        const scale = 1 + breathPhase * scaleAmount;\r\n        \r\n        // Apply glow changes - brighten on inhale\r\n        const glowAmount = params.glowAmount || 0.4;\r\n        const glow = 1 + breathPhase * glowAmount;\r\n        \r\n        // Store breath phase for particle system\r\n        anim.breathPhase = breathPhase;\r\n        \r\n        return {\r\n            scale: scale,\r\n            glow: glow,\r\n            breathPhase: breathPhase // Pass to particles for synchronized motion\r\n        };\r\n    }\r\n    \r\n    applyMorph(anim, progress) {\r\n        // Fluid morphing effect\r\n        const morph = Math.sin(progress * Math.PI * 2);\r\n        return {\r\n            scale: 1 + morph * 0.1,\r\n            rotation: morph * 10\r\n        };\r\n    }\r\n    \r\n    applySlowBlink(anim, progress) {\r\n        // Simulate blinking by scaling vertically\r\n        let scaleY = 1;\r\n        if (progress < 0.3) {\r\n            // Closing\r\n            scaleY = 1 - (progress / 0.3);\r\n        } else if (progress < 0.5) {\r\n            // Closed\r\n            scaleY = 0;\r\n        } else if (progress < 0.8) {\r\n            // Opening\r\n            scaleY = (progress - 0.5) / 0.3;\r\n        } else {\r\n            // Open\r\n            scaleY = 1;\r\n        }\r\n        \r\n        // Since we can't do scaleY separately, dim the orb instead\r\n        return {\r\n            glow: scaleY\r\n        };\r\n    }\r\n    \r\n    applyLook(anim, progress) {\r\n        // Initialize target position if not set\r\n        if (!anim.targetX) {\r\n            const direction = anim.params.lookDirection;\r\n            const distance = anim.params.lookDistance * 50 * this.scaleFactor; // Convert to pixels and scale\r\n            \r\n            switch(direction) {\r\n                case 'left':\r\n                    anim.targetX = -distance;\r\n                    anim.targetY = 0;\r\n                    break;\r\n                case 'right':\r\n                    anim.targetX = distance;\r\n                    anim.targetY = 0;\r\n                    break;\r\n                case 'up':\r\n                    anim.targetX = 0;\r\n                    anim.targetY = -distance;\r\n                    break;\r\n                case 'down':\r\n                    anim.targetX = 0;\r\n                    anim.targetY = distance;\r\n                    break;\r\n                default: // random\r\n                    const angle = Math.random() * Math.PI * 2;\r\n                    anim.targetX = Math.cos(angle) * distance;\r\n                    anim.targetY = Math.sin(angle) * distance;\r\n            }\r\n        }\r\n        \r\n        // Smooth look with hold\r\n        let lookProgress = progress;\r\n        if (progress < 0.3) {\r\n            // Move to target\r\n            lookProgress = progress / 0.3;\r\n        } else if (progress < 0.7) {\r\n            // Hold\r\n            lookProgress = 1;\r\n        } else {\r\n            // Return\r\n            lookProgress = 1 - (progress - 0.7) / 0.3;\r\n        }\r\n        \r\n        return {\r\n            offsetX: anim.targetX * lookProgress,\r\n            offsetY: anim.targetY * lookProgress\r\n        };\r\n    }\r\n    \r\n    applySettle(anim, progress) {\r\n        // Damped oscillation\r\n        const wobble = Math.sin(progress * Math.PI * anim.params.wobbleFreq) * \r\n                      Math.exp(-progress * 3) * 20 * this.scaleFactor;\r\n        return {\r\n            offsetY: wobble,\r\n            scale: 1 + wobble * 0.01\r\n        };\r\n    }\r\n    \r\n    applyBreathIn(anim, progress) {\r\n        const breathScale = 1 + (anim.params.scaleAmount - 1) * Math.sin(progress * Math.PI / 2);\r\n        return {\r\n            scale: breathScale\r\n        };\r\n    }\r\n    \r\n    applyBreathOut(anim, progress) {\r\n        const breathScale = 1 - (1 - anim.params.scaleAmount) * Math.sin(progress * Math.PI / 2);\r\n        return {\r\n            scale: breathScale\r\n        };\r\n    }\r\n    \r\n    applyBreathHold(anim, progress) {\r\n        // Hold at expanded state\r\n        return {\r\n            scale: anim.params.scaleAmount\r\n        };\r\n    }\r\n    \r\n    applyBreathHoldEmpty(anim, progress) {\r\n        // Hold at contracted state\r\n        return {\r\n            scale: anim.params.scaleAmount\r\n        };\r\n    }\r\n    \r\n    applyJump(anim, progress) {\r\n        let yOffset = 0;\r\n        let scale = 1;\r\n        \r\n        if (progress < 0.2) {\r\n            // Squash phase\r\n            const squashProgress = progress / 0.2;\r\n            scale = 1 - (1 - anim.params.squashAmount) * squashProgress;\r\n        } else if (progress < 0.7) {\r\n            // Jump phase\r\n            const jumpProgress = (progress - 0.2) / 0.5;\r\n            const jumpCurve = Math.sin(jumpProgress * Math.PI);\r\n            yOffset = -anim.params.jumpHeight * jumpCurve * this.scaleFactor;\r\n            scale = anim.params.squashAmount + \r\n                   (anim.params.stretchAmount - anim.params.squashAmount) * jumpCurve;\r\n        } else {\r\n            // Landing phase\r\n            const landProgress = (progress - 0.7) / 0.3;\r\n            scale = anim.params.stretchAmount - \r\n                   (anim.params.stretchAmount - 1) * landProgress;\r\n        }\r\n        \r\n        return {\r\n            offsetY: yOffset,\r\n            scale: scale\r\n        };\r\n    }\r\n    \r\n    applySway(anim, progress) {\r\n        // Gentle pendulum-like swaying motion for the core\r\n        const swayAmplitude = (anim.params?.amplitude || 30) * this.scaleFactor;\r\n        const swayFrequency = anim.params?.frequency || 1;\r\n        \r\n        // Sway side to side with a gentle ease\r\n        const swayX = Math.sin(progress * Math.PI * 2 * swayFrequency) * swayAmplitude;\r\n        \r\n        // Slight vertical bob for realism\r\n        const bobY = Math.sin(progress * Math.PI * 4 * swayFrequency) * swayAmplitude * 0.1;\r\n        \r\n        // Slight rotation to match the sway\r\n        const rotation = Math.sin(progress * Math.PI * 2 * swayFrequency) * 5; // 5 degrees max\r\n        \r\n        return {\r\n            offsetX: swayX,\r\n            offsetY: bobY,\r\n            rotation: rotation\r\n        };\r\n    }\r\n    \r\n    applyRain(anim, progress) {\r\n        // Rain effect - triggers falling particle behavior\r\n        // The actual particle motion is handled by the particle system\r\n        // This just adds a subtle downward drift to the core\r\n        \r\n        const rainIntensity = anim.params?.intensity || 1.0;\r\n        \r\n        // Gentle downward drift\r\n        const driftY = progress * 10 * this.scaleFactor * rainIntensity;\r\n        \r\n        // Slight sway as if affected by wind\r\n        const swayX = Math.sin(progress * Math.PI * 4) * 5 * this.scaleFactor;\r\n        \r\n        // Trigger particle falling effect through the renderer\r\n        if (this.renderer && this.renderer.particleSystem) {\r\n            // Enable falling behavior for particles during rain\r\n            this.renderer.particleSystem.setGestureBehavior('falling', progress > 0 && progress < 1);\r\n        }\r\n        \r\n        return {\r\n            offsetX: swayX,\r\n            offsetY: driftY,\r\n            particleEffect: 'falling'  // Signal to particle system\r\n        };\r\n    }\r\n    \r\n    applyFloat(anim, progress) {\r\n        // Ethereal floating motion with both vertical and horizontal drift\r\n        const floatAmplitude = (anim.params?.amplitude || 20) * this.scaleFactor;\r\n        const floatSpeed = anim.params?.speed || 1;\r\n        \r\n        // Primary vertical float with sine wave\r\n        const floatY = Math.sin(progress * Math.PI * 2 * floatSpeed) * floatAmplitude;\r\n        \r\n        // Secondary horizontal drift for natural movement\r\n        const driftX = Math.sin(progress * Math.PI * 3 * floatSpeed) * floatAmplitude * 0.3;\r\n        \r\n        // Slight scale pulsation for breathing effect\r\n        const scalePulse = 1 + Math.sin(progress * Math.PI * 4 * floatSpeed) * 0.02;\r\n        \r\n        return {\r\n            offsetX: driftX,\r\n            offsetY: floatY,\r\n            scale: scalePulse\r\n        };\r\n    }\r\n    \r\n    applyOrbital(anim, progress) {\r\n        // Orbital motion - particles orbit around core, core stays still\r\n        // This gesture is for particle motion only, not core movement\r\n        return {\r\n            // No core movement - orbital is a particle-only effect\r\n            offsetX: 0,\r\n            offsetY: 0\r\n        };\r\n    }\r\n    \r\n    applyHula(anim, progress) {\r\n        // Hula motion - horizontal figure-8 pattern\r\n        const amplitude = (anim.params?.amplitude || 40) * this.scaleFactor;\r\n        const t = progress * Math.PI * 2;\r\n        \r\n        // Figure-8 parametric equations\r\n        const x = Math.sin(t) * amplitude;\r\n        const y = Math.sin(t * 2) * amplitude * 0.5;\r\n        \r\n        return {\r\n            offsetX: x,\r\n            offsetY: y\r\n        };\r\n    }\r\n    \r\n    applySparkle(anim, progress) {\r\n        // Sparkle effect - make particles glow like fireflies\r\n        // Each particle gets its own random phase for async blinking\r\n        const intensity = anim.params?.intensity || 2.0;\r\n        const baseGlow = 0.8;\r\n        \r\n        // Create firefly-like glow pattern for particles\r\n        // Using time-based phase shifting for each particle\r\n        const time = Date.now() * 0.001; // Convert to seconds\r\n        \r\n        // Main glow pulse for the effect\r\n        const mainPulse = Math.sin(progress * Math.PI * 4) * 0.3 + 0.7;\r\n        \r\n        // This will be used by particles to create firefly effect\r\n        // Each particle will add its own random offset to this\r\n        return {\r\n            particleGlow: intensity, // Intensity for individual particles\r\n            glow: mainPulse, // Gentle overall glow\r\n            fireflyTime: time, // Pass time for particle calculations\r\n            fireflyEffect: true // Flag to enable firefly effect on particles\r\n        };\r\n    }\r\n    \r\n    applyShimmer(anim, progress) {\r\n        // Shimmer effect - subtle, ethereal glow that travels across surface\r\n        // Like moonlight on calm water\r\n        \r\n        const time = Date.now() * 0.001; // Current time in seconds\r\n        const intensity = anim.params?.intensity || 0.3; // Very subtle\r\n        \r\n        // Single slow wave for gentle shimmer\r\n        const wave = Math.sin(time * 2 + progress * Math.PI * 2);\r\n        \r\n        // Very subtle glow variation\r\n        const glowEffect = 1 + wave * intensity;\r\n        \r\n        // Tiny breathing effect\r\n        const scaleEffect = 1 + wave * 0.01; // Just 1% variation\r\n        \r\n        return {\r\n            offsetX: 0, // No movement\r\n            offsetY: 0, // No movement\r\n            glow: glowEffect,\r\n            scale: scaleEffect,\r\n            // Particle-specific data\r\n            particleGlow: 1 + wave * 0.2, // Very subtle particle effect\r\n            shimmerTime: time,\r\n            shimmerWave: wave,\r\n            shimmerEffect: true // Flag to enable shimmer effect on particles\r\n        };\r\n    }\r\n    \r\n    applyWiggle(anim, progress) {\r\n        // Hip-hop wiggle - 4 phase: center -> side -> opposite -> side -> center\r\n        const amplitude = (anim.params?.amplitude || 15) * this.scaleFactor;\r\n        \r\n        // Random starting direction (1 for right, -1 for left)\r\n        if (anim.wiggleDirection === undefined) {\r\n            anim.wiggleDirection = Math.random() < 0.5 ? 1 : -1;\r\n        }\r\n        const direction = anim.wiggleDirection;\r\n        \r\n        // 4-phase movement pattern\r\n        let wiggleX = 0;\r\n        let rotation = 0;\r\n        \r\n        if (progress < 0.25) {\r\n            // Phase 1: Center to first side (0-25%)\r\n            const phase = progress / 0.25;\r\n            wiggleX = amplitude * direction * phase;\r\n            rotation = 3 * direction * phase;\r\n        } else if (progress < 0.5) {\r\n            // Phase 2: First side to opposite side (25-50%)\r\n            const phase = (progress - 0.25) / 0.25;\r\n            wiggleX = amplitude * direction * (1 - 2 * phase);\r\n            rotation = 3 * direction * (1 - 2 * phase);\r\n        } else if (progress < 0.75) {\r\n            // Phase 3: Opposite side back to first side (50-75%)\r\n            const phase = (progress - 0.5) / 0.25;\r\n            wiggleX = amplitude * -direction * (1 - 2 * phase);\r\n            rotation = 3 * -direction * (1 - 2 * phase);\r\n        } else {\r\n            // Phase 4: First side back to center (75-100%)\r\n            const phase = (progress - 0.75) / 0.25;\r\n            wiggleX = amplitude * direction * (1 - phase);\r\n            rotation = 3 * direction * (1 - phase);\r\n        }\r\n        \r\n        // Subtle bounce synced with movement\r\n        const bounceY = Math.abs(Math.sin(progress * Math.PI * 4)) * amplitude * 0.15;\r\n        \r\n        return {\r\n            offsetX: wiggleX,\r\n            offsetY: -bounceY,\r\n            rotation: rotation\r\n        };\r\n    }\r\n    \r\n    applyGroove(anim, progress) {\r\n        // Groove motion - smooth, flowing dance movement\r\n        const amplitude = (anim.params?.amplitude || 25) * this.scaleFactor;\r\n        \r\n        // Smoother wave pattern with organic flow\r\n        const wave1 = Math.sin(progress * Math.PI * 2) * amplitude;\r\n        const wave2 = Math.sin(progress * Math.PI * 3 + 0.5) * amplitude * 0.4;\r\n        const grooveX = wave1 + wave2;\r\n        \r\n        // Gentle vertical bob with offset timing\r\n        const grooveY = Math.sin(progress * Math.PI * 4 + 0.3) * amplitude * 0.25;\r\n        \r\n        // Subtle pulse that breathes naturally\r\n        const scale = 1 + Math.sin(progress * Math.PI * 3 + 0.7) * 0.03;\r\n        \r\n        // Slight rotation for more natural movement\r\n        const rotation = Math.sin(progress * Math.PI * 2 + 0.2) * 8;\r\n        \r\n        return {\r\n            offsetX: grooveX,\r\n            offsetY: grooveY,\r\n            scale: scale,\r\n            rotation: rotation\r\n        };\r\n    }\r\n    \r\n    applyPoint(anim, progress) {\r\n        // Point gesture - directional lean/stretch with return to center\r\n        \r\n        // Random direction if not specified - only left or right\r\n        if (anim.pointDirection === undefined) {\r\n            // Randomly choose left (1) or right (-1)\r\n            anim.pointDirection = Math.random() < 0.5 ? -1 : 1;\r\n        }\r\n        \r\n        const direction = anim.params?.direction !== undefined ? anim.params.direction : anim.pointDirection;\r\n        const distance = (anim.params?.distance || 40) * this.scaleFactor;\r\n        \r\n        // Three-phase animation:\r\n        // 0.0-0.4: Move to point position\r\n        // 0.4-0.6: Hold at point\r\n        // 0.6-1.0: Return to center\r\n        let motionProgress;\r\n        let scaleProgress;\r\n        \r\n        if (progress < 0.4) {\r\n            // Phase 1: Move to point (ease out)\r\n            motionProgress = 1 - Math.pow(1 - (progress / 0.4), 3);\r\n            scaleProgress = motionProgress;\r\n        } else if (progress < 0.6) {\r\n            // Phase 2: Hold at point\r\n            motionProgress = 1.0;\r\n            scaleProgress = 1.0;\r\n        } else {\r\n            // Phase 3: Return to center (ease in)\r\n            motionProgress = Math.pow(1 - ((progress - 0.6) / 0.4), 3);\r\n            scaleProgress = motionProgress;\r\n        }\r\n        \r\n        // Move in direction (direction is -1 for left, 1 for right)\r\n        const offsetX = direction * distance * motionProgress;\r\n        const offsetY = -Math.abs(distance * 0.15 * motionProgress); // Slight upward movement when pointing\r\n        \r\n        // Stretch effect in pointing direction\r\n        const scale = 1 + 0.15 * scaleProgress; // 15% stretch\r\n        \r\n        // Add slight tilt when pointing\r\n        const rotation = direction * 5 * scaleProgress; // Tilt 5 degrees in pointing direction\r\n        \r\n        return {\r\n            offsetX: offsetX,\r\n            offsetY: offsetY,\r\n            scale: scale,\r\n            rotation: rotation\r\n        };\r\n    }\r\n    \r\n    applyLean(anim, progress) {\r\n        // Lean gesture - tilt to one side\r\n        const angle = anim.params?.angle || 15; // Degrees\r\n        const side = anim.params?.side || 1; // 1 for right, -1 for left\r\n        \r\n        // Smooth ease in-out\r\n        const easedProgress = Math.sin(progress * Math.PI);\r\n        \r\n        // Apply rotation and slight offset\r\n        const rotation = angle * side * easedProgress;\r\n        const offsetX = side * 10 * this.scaleFactor * easedProgress;\r\n        \r\n        return {\r\n            offsetX: offsetX,\r\n            rotation: rotation\r\n        };\r\n    }\r\n    \r\n    applyReach(anim, progress) {\r\n        // Reach gesture - stretch upward or outward\r\n        const direction = anim.params?.direction || -Math.PI/2; // Default upward\r\n        const distance = (anim.params?.distance || 40) * this.scaleFactor;\r\n        \r\n        // Two-phase motion: reach out, then return\r\n        let motionProgress;\r\n        if (progress < 0.4) {\r\n            // Reaching phase\r\n            motionProgress = progress / 0.4;\r\n        } else if (progress < 0.6) {\r\n            // Hold phase\r\n            motionProgress = 1;\r\n        } else {\r\n            // Return phase\r\n            motionProgress = 1 - (progress - 0.6) / 0.4;\r\n        }\r\n        \r\n        // Apply easing\r\n        motionProgress = motionProgress * motionProgress * (3 - 2 * motionProgress);\r\n        \r\n        const offsetX = Math.cos(direction) * distance * motionProgress;\r\n        const offsetY = Math.sin(direction) * distance * motionProgress;\r\n        \r\n        // Stretch slightly when reaching\r\n        const scale = 1 + motionProgress * 0.15;\r\n        \r\n        return {\r\n            offsetX: offsetX,\r\n            offsetY: offsetY,\r\n            scale: scale\r\n        };\r\n    }\r\n    \r\n    applyHeadBob(anim, progress) {\r\n        // Head bob motion - rhythmic vertical movement\r\n        const amplitude = (anim.params?.amplitude || 20) * this.scaleFactor;\r\n        const frequency = anim.params?.frequency || 2;\r\n        \r\n        // Vertical bob with sharp down, smooth up\r\n        const bobPhase = (progress * frequency) % 1;\r\n        let bobY;\r\n        if (bobPhase < 0.3) {\r\n            // Quick down\r\n            bobY = -amplitude * (bobPhase / 0.3);\r\n        } else {\r\n            // Smooth up\r\n            bobY = -amplitude * (1 - (bobPhase - 0.3) / 0.7);\r\n        }\r\n        \r\n        // Slight forward tilt on the down beat\r\n        const rotation = bobPhase < 0.3 ? -3 : 0;\r\n        \r\n        return {\r\n            offsetY: bobY,\r\n            rotation: rotation\r\n        };\r\n    }\r\n    \r\n    applyOrbit(anim, progress) {\r\n        // Orbit motion - circular path around center\r\n        const radius = (anim.params?.radius || 30) * this.scaleFactor;\r\n        const speed = anim.params?.speed || 1;\r\n        \r\n        // Circular motion\r\n        const angle = progress * Math.PI * 2 * speed;\r\n        const offsetX = Math.cos(angle) * radius;\r\n        const offsetY = Math.sin(angle) * radius;\r\n        \r\n        return {\r\n            offsetX: offsetX,\r\n            offsetY: offsetY\r\n        };\r\n    }\r\n\r\n    // Individual gesture methods - these will be moved from EmotiveRenderer\r\n    startBounce() { this.startGesture('bounce'); }\r\n    startPulse() { this.startGesture('pulse'); }\r\n    startShake() { this.startGesture('shake'); }\r\n    startSpin() { this.startGesture('spin'); }\r\n    startNod() { this.startGesture('nod'); }\r\n    startTilt() { this.startGesture('tilt'); }\r\n    startExpand() { this.startGesture('expand'); }\r\n    startContract() { this.startGesture('contract'); }\r\n    startFlash() { this.startGesture('flash'); }\r\n    startDrift() { this.startGesture('drift'); }\r\n    startStretch() { this.startGesture('stretch'); }\r\n    startGlow() { this.startGesture('glow'); }\r\n    startFlicker() { this.startGesture('flicker'); }\r\n    startVibrate() { this.startGesture('vibrate'); }\r\n    startOrbital() { this.startGesture('orbital'); }\r\n    startHula() { this.startGesture('hula'); }\r\n    startWave() { this.startGesture('wave'); }\r\n    startBreathe() { this.startGesture('breathe'); }\r\n    startMorph() { this.startGesture('morph'); }\r\n    startSlowBlink() { this.startGesture('slowBlink'); }\r\n    startLook() { this.startGesture('look'); }\r\n    startSettle() { this.startGesture('settle'); }\r\n    startBreathIn() { this.startGesture('breathIn'); }\r\n    startBreathOut() { this.startGesture('breathOut'); }\r\n    startBreathHold() { this.startGesture('breathHold'); }\r\n    startBreathHoldEmpty() { this.startGesture('breathHoldEmpty'); }\r\n    startJump() { this.startGesture('jump'); }\r\n    startSway() { this.startGesture('sway'); }\r\n    startFloat() { this.startGesture('float'); }\r\n    startRain() { this.startGesture('rain'); }\r\n    startRunningMan() { this.startGesture('runningman'); }\r\n    startCharleston() { this.startGesture('charleston'); }\r\n    startSparkle() { this.startGesture('sparkle'); }\r\n    startShimmer() { this.startGesture('shimmer'); }\r\n    startWiggle() { this.startGesture('wiggle'); }\r\n    startGroove() { this.startGesture('groove'); }\r\n    startPoint() { this.startGesture('point'); }\r\n    startLean() { this.startGesture('lean'); }\r\n    startReach() { this.startGesture('reach'); }\r\n    startHeadBob() { this.startGesture('headBob'); }\r\n    startOrbit() { this.startGesture('orbit'); }\r\n    \r\n    applyRunningMan(anim, progress) {\r\n        // Simple running shuffle - quick slide and step\r\n        const slide = Math.sin(progress * Math.PI * 4) * 20 * this.scaleFactor;\r\n        const step = -Math.abs(Math.sin(progress * Math.PI * 8)) * 10 * this.scaleFactor;\r\n        \r\n        return {\r\n            offsetX: slide,\r\n            offsetY: step,\r\n            rotation: slide * 0.3,\r\n            scaleY: 1 - Math.abs(Math.sin(progress * Math.PI * 8)) * 0.05\r\n        };\r\n    }\r\n    \r\n    applyCharleston(anim, progress) {\r\n        // Charleston - crisscross kicks\r\n        const kick = Math.sin(progress * Math.PI * 8) * 25 * this.scaleFactor;\r\n        const hop = -Math.abs(Math.sin(progress * Math.PI * 8)) * 10 * this.scaleFactor;\r\n        \r\n        return {\r\n            offsetX: kick,\r\n            offsetY: hop,\r\n            rotation: kick * 0.6,\r\n            scaleY: 1 - Math.abs(Math.sin(progress * Math.PI * 8)) * 0.06\r\n        };\r\n    }\r\n    \r\n    startRunningMan() { this.startGesture('runningman'); }\r\n    startCharleston() { this.startGesture('charleston'); }\r\n\r\n    /**\r\n     * Pause current animation (called on tab switch)\r\n     */\r\n    pauseCurrentAnimation() {\r\n        // Store pause time for all active animations\r\n        const now = performance.now();\r\n        for (const [type, anim] of Object.entries(this.gestureAnimations)) {\r\n            if (anim.active) {\r\n                anim.pausedAt = now;\r\n                anim.pausedProgress = anim.progress;\r\n            }\r\n        }\r\n        this.isPaused = true;\r\n    }\r\n\r\n    /**\r\n     * Resume animations after pause\r\n     */\r\n    resumeAnimation() {\r\n        if (!this.isPaused) return;\r\n\r\n        const now = performance.now();\r\n        for (const [type, anim] of Object.entries(this.gestureAnimations)) {\r\n            if (anim.active && anim.pausedAt) {\r\n                // Adjust start time to account for pause\r\n                const pauseDuration = now - anim.pausedAt;\r\n                if (anim.startTime) {\r\n                    anim.startTime += pauseDuration;\r\n                }\r\n                // Clear pause state\r\n                delete anim.pausedAt;\r\n                delete anim.pausedProgress;\r\n            }\r\n        }\r\n        this.isPaused = false;\r\n    }\r\n\r\n    /**\r\n     * Reset all gesture animations\r\n     */\r\n    reset() {\r\n        // Clear all active animations\r\n        for (const [type, anim] of Object.entries(this.gestureAnimations)) {\r\n            anim.active = false;\r\n            anim.progress = 0;\r\n            anim.params = {};\r\n            delete anim.startTime;\r\n            delete anim.pausedAt;\r\n            delete anim.pausedProgress;\r\n        }\r\n        this.activeGestures.clear();\r\n        this.isPaused = false;\r\n    }\r\n}\r\n\r\nexport default GestureAnimator;","/**\r\n * ColorUtilities - Color manipulation and transition utilities for EmotiveRenderer\r\n * @module core/renderer/ColorUtilities\r\n */\r\n\r\nexport class ColorUtilities {\r\n    constructor() {\r\n        this.colorTransition = null;\r\n    }\r\n\r\n    /**\r\n     * Apply undertone modifiers to current visual properties\r\n     * Will be moved from EmotiveRenderer\r\n     */\r\n    applyUndertoneModifiers(undertone, visualProperties) {\r\n        // Implementation will be moved here\r\n        return visualProperties;\r\n    }\r\n\r\n    /**\r\n     * Apply undertone to a color\r\n     * @param {string} baseColor - Base hex color\r\n     * @param {string|Object} undertone - Undertone modifier or weighted object\r\n     * @returns {string} Modified hex color\r\n     */\r\n    applyUndertoneToColor(baseColor, undertone) {\r\n        // Handle weighted modifier for smooth transitions\r\n        if (undertone && typeof undertone === 'object' && undertone.weight !== undefined) {\r\n            const weight = undertone.weight;\r\n            const undertoneType = undertone.type || 'clear';\r\n            \r\n            if (undertoneType === 'clear' || weight === 0) {\r\n                return baseColor;\r\n            }\r\n            \r\n            // Get full saturation adjustment for this undertone\r\n            const fullySaturated = this.applyUndertoneSaturation(baseColor, undertoneType);\r\n            \r\n            // Interpolate between base and fully saturated based on weight\r\n            const rgb1 = this.hexToRgb(baseColor);\r\n            const rgb2 = this.hexToRgb(fullySaturated);\r\n            \r\n            const r = Math.round(rgb1.r + (rgb2.r - rgb1.r) * weight);\r\n            const g = Math.round(rgb1.g + (rgb2.g - rgb1.g) * weight);\r\n            const b = Math.round(rgb1.b + (rgb2.b - rgb1.b) * weight);\r\n            \r\n            return this.rgbToHex(r, g, b);\r\n        }\r\n        \r\n        // Direct string-based undertone - use saturation system\r\n        if (!undertone || undertone === 'clear') return baseColor;\r\n        \r\n        return this.applyUndertoneSaturation(baseColor, undertone);\r\n    }\r\n\r\n    /**\r\n     * Convert hex color to RGB\r\n     * @param {string} hex - Hex color string\r\n     * @returns {Object} RGB values\r\n     */\r\n    hexToRgb(hex) {\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        return result ? {\r\n            r: parseInt(result[1], 16),\r\n            g: parseInt(result[2], 16),\r\n            b: parseInt(result[3], 16)\r\n        } : null;\r\n    }\r\n\r\n    /**\r\n     * Convert RGB to HSL\r\n     */\r\n    rgbToHsl(r, g, b) {\r\n        r /= 255;\r\n        g /= 255;\r\n        b /= 255;\r\n\r\n        const max = Math.max(r, g, b);\r\n        const min = Math.min(r, g, b);\r\n        let h, s, l = (max + min) / 2;\r\n\r\n        if (max === min) {\r\n            h = s = 0; // achromatic\r\n        } else {\r\n            const d = max - min;\r\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n            \r\n            switch (max) {\r\n                case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;\r\n                case g: h = ((b - r) / d + 2) / 6; break;\r\n                case b: h = ((r - g) / d + 4) / 6; break;\r\n            }\r\n        }\r\n\r\n        return { h: h * 360, s: s * 100, l: l * 100 }; // Convert s and l to percentages\r\n    }\r\n\r\n    /**\r\n     * Convert HSL to hex color\r\n     */\r\n    hslToHex(h, s, l) {\r\n        h = h / 360;\r\n        s = s / 100;\r\n        l = l / 100;\r\n\r\n        let r, g, b;\r\n\r\n        if (s === 0) {\r\n            r = g = b = l; // achromatic\r\n        } else {\r\n            const hue2rgb = (p, q, t) => {\r\n                if (t < 0) t += 1;\r\n                if (t > 1) t -= 1;\r\n                if (t < 1/6) return p + (q - p) * 6 * t;\r\n                if (t < 1/2) return q;\r\n                if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;\r\n                return p;\r\n            };\r\n\r\n            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n            const p = 2 * l - q;\r\n            r = hue2rgb(p, q, h + 1/3);\r\n            g = hue2rgb(p, q, h);\r\n            b = hue2rgb(p, q, h - 1/3);\r\n        }\r\n\r\n        const toHex = x => {\r\n            const hex = Math.round(x * 255).toString(16);\r\n            return hex.length === 1 ? '0' + hex : hex;\r\n        };\r\n\r\n        return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\r\n    }\r\n\r\n    /**\r\n     * Apply undertone saturation adjustment\r\n     */\r\n    applyUndertoneSaturation(baseColor, undertone) {\r\n        const rgb = this.hexToRgb(baseColor);\r\n        const hsl = this.rgbToHsl(rgb.r, rgb.g, rgb.b);\r\n        \r\n        // Saturation adjustments by undertone\r\n        const saturationModifiers = {\r\n            // Positive undertones (higher saturation)\r\n            'intense': 1.5,      // +50% saturation (very vivid)\r\n            'confident': 1.3,    // +30% saturation (bold)\r\n            'energetic': 1.2,    // +20% saturation (vibrant)\r\n            'upbeat': 1.2,       // +20% saturation\r\n            // Neutral/slightly nervous\r\n            'nervous': 1.15,     // +15% saturation (slightly heightened)\r\n            // Negative undertones (lower saturation)\r\n            'mellow': 0.8,       // -20% saturation  \r\n            'tired': 0.8,        // -20% saturation (washed out)\r\n            'subdued': 0.5       // -50% saturation (ghostly)\r\n        };\r\n        \r\n        const modifier = saturationModifiers[undertone] || 1.0;\r\n        hsl.s = Math.min(100, hsl.s * modifier);\r\n        \r\n        return this.hslToHex(hsl.h, hsl.s, hsl.l);\r\n    }\r\n    \r\n    /**\r\n     * Convert RGB values to hex\r\n     */\r\n    rgbToHex(r, g, b) {\r\n        const toHex = x => {\r\n            const hex = Math.round(x).toString(16);\r\n            return hex.length === 1 ? '0' + hex : hex;\r\n        };\r\n        return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\r\n    }\r\n    \r\n    /**\r\n     * Start a color transition\r\n     */\r\n    startColorTransition(targetColor, targetIntensity, duration = 1500) {\r\n        // Don't start a new transition if we're already at the target\r\n        if (this.currentColor === targetColor && \r\n            this.currentIntensity === targetIntensity) {\r\n            return;\r\n        }\r\n        \r\n        this.colorTransition = {\r\n            active: true,\r\n            fromColor: this.currentColor || '#ffffff',\r\n            toColor: targetColor,\r\n            fromIntensity: this.currentIntensity || 1.0,\r\n            toIntensity: targetIntensity,\r\n            progress: 0,\r\n            startTime: performance.now(),\r\n            duration: duration\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Update color transition\r\n     */\r\n    updateColorTransition(deltaTime) {\r\n        if (!this.colorTransition || !this.colorTransition.active) return null;\r\n        \r\n        const elapsed = performance.now() - this.colorTransition.startTime;\r\n        const progress = Math.min(elapsed / this.colorTransition.duration, 1);\r\n        \r\n        // Use ease-out-quad for smooth deceleration\r\n        const eased = 1 - Math.pow(1 - progress, 2);\r\n        \r\n        // Interpolate color\r\n        const from = this.hexToRgb(this.colorTransition.fromColor);\r\n        const to = this.hexToRgb(this.colorTransition.toColor);\r\n        \r\n        const r = Math.round(from.r + (to.r - from.r) * eased);\r\n        const g = Math.round(from.g + (to.g - from.g) * eased);\r\n        const b = Math.round(from.b + (to.b - from.b) * eased);\r\n        \r\n        const currentColor = this.rgbToHex(r, g, b);\r\n        const currentIntensity = this.colorTransition.fromIntensity + \r\n            (this.colorTransition.toIntensity - this.colorTransition.fromIntensity) * eased;\r\n        \r\n        // Store current values\r\n        this.currentColor = currentColor;\r\n        this.currentIntensity = currentIntensity;\r\n        \r\n        // Complete transition if done\r\n        if (progress >= 1) {\r\n            this.colorTransition.active = false;\r\n        }\r\n        \r\n        return {\r\n            color: currentColor,\r\n            intensity: currentIntensity\r\n        };\r\n    }\r\n}\r\n\r\nexport default ColorUtilities;","/**\r\n * SpecialEffects - Special visual effects for EmotiveRenderer\r\n * @module core/renderer/SpecialEffects\r\n */\r\n\r\nexport class SpecialEffects {\r\n    constructor(renderer) {\r\n        this.renderer = renderer;\r\n        this.ctx = renderer.ctx;\r\n        this.canvas = renderer.canvasManager?.canvas || renderer.canvas;\r\n        \r\n        // Effect states\r\n        this.recordingActive = false;\r\n        this.sleepMode = false;\r\n        this.speakingActive = false;\r\n        this.zenModeActive = false;\r\n        \r\n        // Speaking rings\r\n        this.speakingRings = [];\r\n        this.ringSpawnTimer = 0;\r\n        this.ringSpawnInterval = 300;\r\n        this.maxRings = 3;\r\n        \r\n        // Sleep Z's\r\n        this.sleepZ = [];\r\n        \r\n        // Sparkle particles\r\n        this.sparkles = [];\r\n        \r\n        // Chromatic aberration effect\r\n        this.chromaticAberration = {\r\n            active: false,\r\n            intensity: 0,\r\n            targetIntensity: 0,\r\n            fadeSpeed: 0.01, // Very slow fade for testing\r\n            maxOffset: 30 // Much larger offset for testing\r\n        };\r\n        \r\n        // Helper method references\r\n        this.scaleValue = (value) => renderer.scaleValue(value);\r\n        this.hexToRgba = (hex, alpha) => renderer.hexToRgba(hex, alpha);\r\n    }\r\n\r\n    /**\r\n     * Render recording glow effect\r\n     */\r\n    renderRecordingGlow(x, y, radius, intensity) {\r\n        const ctx = this.ctx;\r\n        const glowSize = radius * 2.5;\r\n        const gradient = ctx.createRadialGradient(x, y, 0, x, y, glowSize);\r\n        \r\n        gradient.addColorStop(0, `rgba(255, 0, 0, ${0.3 * intensity})`);\r\n        gradient.addColorStop(0.5, `rgba(255, 0, 0, ${0.15 * intensity})`);\r\n        gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');\r\n        \r\n        ctx.save();\r\n        ctx.globalCompositeOperation = 'screen';\r\n        ctx.fillStyle = gradient;\r\n        ctx.fillRect(x - glowSize, y - glowSize, glowSize * 2, glowSize * 2);\r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Render recording indicator\r\n     */\r\n    renderRecordingIndicator(x, y) {\r\n        const time = Date.now() / 1000;\r\n        const pulse = 0.8 + Math.sin(time * 2) * 0.2;\r\n        \r\n        this.ctx.save();\r\n        this.ctx.translate(x, y);\r\n        \r\n        // Outer glow for text\r\n        this.ctx.shadowBlur = this.scaleValue(15);\r\n        this.ctx.shadowColor = `rgba(255, 0, 0, ${pulse * 0.8})`;\r\n        \r\n        // Main REC text\r\n        const recSize = this.scaleValue(80);\r\n        this.ctx.font = `italic 900 ${recSize}px \"Poppins\", sans-serif`;\r\n        this.ctx.fillStyle = `rgba(255, 0, 0, ${pulse})`;\r\n        this.ctx.textAlign = 'center';\r\n        this.ctx.textBaseline = 'middle';\r\n        this.ctx.fillText('REC', 0, 0);\r\n        \r\n        // Inner highlight\r\n        this.ctx.shadowBlur = 0;\r\n        this.ctx.font = `italic 900 ${recSize - 1}px \"Poppins\", sans-serif`;\r\n        this.ctx.fillStyle = `rgba(255, 255, 255, ${pulse * 0.3})`;\r\n        this.ctx.fillText('REC', -0.5, -0.5);\r\n        \r\n        this.ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Render sleep indicator with Z's\r\n     */\r\n    renderSleepIndicator(x, y, deltaTime) {\r\n        // Spawn new Z periodically\r\n        this.ringSpawnTimer += deltaTime;\r\n        if (this.ringSpawnTimer >= 2000 && this.sleepZ.length < 3) {\r\n            const weights = ['300', '500', '700', '900'];\r\n            const randomWeight = weights[Math.floor(Math.random() * weights.length)];\r\n            const randomCase = Math.random() > 0.5 ? 'Z' : 'z';\r\n            \r\n            this.sleepZ.push({\r\n                x: x + Math.random() * this.scaleValue(30) - this.scaleValue(15),\r\n                y: y + this.scaleValue(80),\r\n                size: this.scaleValue((24 + Math.random() * 8) * 3),\r\n                opacity: 1.0,\r\n                speed: -0.025,\r\n                drift: Math.random() * this.scaleValue(20) - this.scaleValue(10),\r\n                lifetime: 0,\r\n                rotation: Math.random() * 30 - 15,\r\n                text: randomCase,\r\n                weight: randomWeight\r\n            });\r\n            this.ringSpawnTimer = 0;\r\n        }\r\n        \r\n        // Update and render Z's\r\n        this.sleepZ = this.sleepZ.filter(z => {\r\n            z.lifetime += deltaTime;\r\n            z.y += z.speed * deltaTime;\r\n            z.x += Math.sin(z.lifetime * 0.0008) * z.drift * 0.008;\r\n            z.rotation += deltaTime * 0.01;\r\n            \r\n            // Gradient fade out\r\n            const fadeStart = 2000;\r\n            const fadeEnd = 4000;\r\n            if (z.lifetime < fadeStart) {\r\n                z.opacity = 1.0;\r\n            } else if (z.lifetime < fadeEnd) {\r\n                z.opacity = 1.0 - ((z.lifetime - fadeStart) / (fadeEnd - fadeStart));\r\n            } else {\r\n                z.opacity = 0;\r\n            }\r\n            \r\n            if (z.opacity > 0.01) {\r\n                this.ctx.save();\r\n                this.ctx.translate(z.x, z.y);\r\n                this.ctx.rotate(z.rotation * Math.PI / 180);\r\n                \r\n                const baseColor = this.renderer.state.glowColor || '#4a90e2';\r\n                \r\n                // Outer glow\r\n                this.ctx.shadowBlur = this.scaleValue(15);\r\n                this.ctx.shadowColor = this.hexToRgba(baseColor, z.opacity * 0.5);\r\n                \r\n                // Main Z with gradient\r\n                const gradient = this.ctx.createLinearGradient(-z.size/2, -z.size/2, z.size/2, z.size/2);\r\n                gradient.addColorStop(0, this.hexToRgba(baseColor, z.opacity));\r\n                gradient.addColorStop(0.5, this.hexToRgba('#ffffff', z.opacity * 0.9));\r\n                gradient.addColorStop(1, this.hexToRgba(baseColor, z.opacity * 0.7));\r\n                \r\n                this.ctx.font = `italic ${z.weight || '900'} ${z.size}px 'Poppins', sans-serif`;\r\n                this.ctx.fillStyle = gradient;\r\n                this.ctx.textAlign = 'center';\r\n                this.ctx.textBaseline = 'middle';\r\n                this.ctx.fillText(z.text || 'Z', 0, 0);\r\n                \r\n                // Inner highlight\r\n                this.ctx.shadowBlur = 0;\r\n                this.ctx.font = `italic ${z.weight || '900'} ${z.size * 0.9}px 'Poppins', sans-serif`;\r\n                this.ctx.fillStyle = this.hexToRgba('#ffffff', z.opacity * 0.3);\r\n                this.ctx.fillText(z.text || 'Z', -1, -1);\r\n                \r\n                this.ctx.restore();\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Render speaking rings effect\r\n     */\r\n    renderSpeakingRings(centerX, centerY, coreRadius, deltaTime) {\r\n        // Spawn new rings periodically\r\n        this.ringSpawnTimer += deltaTime;\r\n        if (this.ringSpawnTimer >= this.ringSpawnInterval && this.speakingRings.length < this.maxRings) {\r\n            this.speakingRings.push({\r\n                radius: coreRadius,\r\n                opacity: 0.8,\r\n                speed: 0.15\r\n            });\r\n            this.ringSpawnTimer = 0;\r\n        }\r\n        \r\n        // Update and render existing rings\r\n        this.speakingRings = this.speakingRings.filter(ring => {\r\n            ring.radius += ring.speed * deltaTime;\r\n            ring.opacity = Math.max(0, 0.8 * (1 - (ring.radius - coreRadius) / (coreRadius * 2)));\r\n            \r\n            if (ring.opacity > 0.01) {\r\n                this.ctx.strokeStyle = this.hexToRgba(this.renderer.state.glowColor, ring.opacity);\r\n                this.ctx.lineWidth = this.scaleValue(2);\r\n                this.ctx.beginPath();\r\n                this.ctx.arc(centerX, centerY, ring.radius, 0, Math.PI * 2);\r\n                this.ctx.stroke();\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Render zen core effect\r\n     */\r\n    renderZenCore(x, y, radius, time) {\r\n        const ctx = this.ctx;\r\n        const breathPhase = Math.sin(time * 0.001) * 0.5 + 0.5;\r\n        const zenRadius = radius * (0.9 + breathPhase * 0.1);\r\n        \r\n        // Inner glow\r\n        const gradient = ctx.createRadialGradient(x, y, 0, x, y, zenRadius);\r\n        gradient.addColorStop(0, 'rgba(147, 112, 219, 0.8)');\r\n        gradient.addColorStop(0.7, 'rgba(147, 112, 219, 0.3)');\r\n        gradient.addColorStop(1, 'rgba(147, 112, 219, 0)');\r\n        \r\n        ctx.save();\r\n        ctx.globalCompositeOperation = 'screen';\r\n        ctx.fillStyle = gradient;\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, zenRadius * 1.5, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Start recording effect\r\n     */\r\n    startRecording() {\r\n        this.recordingActive = true;\r\n    }\r\n\r\n    /**\r\n     * Stop recording effect\r\n     */\r\n    stopRecording() {\r\n        this.recordingActive = false;\r\n    }\r\n\r\n    /**\r\n     * Enter sleep mode\r\n     */\r\n    enterSleepMode() {\r\n        this.sleepMode = true;\r\n    }\r\n\r\n    /**\r\n     * Wake up from sleep\r\n     */\r\n    wakeUp() {\r\n        this.sleepMode = false;\r\n    }\r\n\r\n    /**\r\n     * Start speaking effect\r\n     */\r\n    startSpeaking() {\r\n        this.speakingActive = true;\r\n    }\r\n\r\n    /**\r\n     * Stop speaking effect\r\n     */\r\n    stopSpeaking() {\r\n        this.speakingActive = false;\r\n    }\r\n\r\n    /**\r\n     * Create a sparkle particle\r\n     */\r\n    createSparkle(x, y, options = {}) {\r\n        this.sparkles.push({\r\n            x,\r\n            y,\r\n            vx: options.velocity?.x || 0,\r\n            vy: options.velocity?.y || 0,\r\n            size: options.size || 3,\r\n            color: options.color || 'hsl(50, 100%, 70%)',\r\n            lifetime: options.lifetime || 1000,\r\n            maxLifetime: options.lifetime || 1000,\r\n            rotation: Math.random() * Math.PI * 2,\r\n            rotationSpeed: (Math.random() - 0.5) * 0.2\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Render all sparkles\r\n     */\r\n    renderSparkles() {\r\n        const ctx = this.ctx;\r\n        \r\n        this.sparkles.forEach(sparkle => {\r\n            const progress = 1 - (sparkle.lifetime / sparkle.maxLifetime);\r\n            const opacity = 1 - progress; // Fade out over time\r\n            \r\n            ctx.save();\r\n            ctx.translate(sparkle.x, sparkle.y);\r\n            ctx.rotate(sparkle.rotation);\r\n            \r\n            // Draw sparkle as a star shape\r\n            const size = this.scaleValue(sparkle.size * (1 - progress * 0.5));\r\n            \r\n            // Draw a 5-pointed star with smoother interior angles\r\n            ctx.beginPath();\r\n            const points = 5;\r\n            const outerRadius = size;\r\n            const innerRadius = size * 0.38; // Golden ratio-ish for smoother interior angles\r\n            \r\n            for (let i = 0; i < points * 2; i++) {\r\n                const angle = (i * Math.PI / points) - Math.PI / 2; // Start from top\r\n                const radius = i % 2 === 0 ? outerRadius : innerRadius;\r\n                \r\n                if (i === 0) {\r\n                    ctx.moveTo(\r\n                        Math.cos(angle) * radius,\r\n                        Math.sin(angle) * radius\r\n                    );\r\n                } else {\r\n                    ctx.lineTo(\r\n                        Math.cos(angle) * radius,\r\n                        Math.sin(angle) * radius\r\n                    );\r\n                }\r\n            }\r\n            ctx.closePath();\r\n            \r\n            // Add glow effect\r\n            ctx.shadowBlur = this.scaleValue(10);\r\n            ctx.shadowColor = sparkle.color;\r\n            \r\n            ctx.fillStyle = sparkle.color.replace('70%', `${70 + progress * 30}%`).replace(')', `, ${opacity})`).replace('hsl', 'hsla');\r\n            ctx.fill();\r\n            \r\n            ctx.restore();\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Trigger chromatic aberration effect\r\n     * @param {number} intensity - Effect intensity (0-1)\r\n     */\r\n    triggerChromaticAberration(intensity = 0.8) {\r\n        this.chromaticAberration.active = true;\r\n        this.chromaticAberration.targetIntensity = Math.min(1, intensity);\r\n        this.chromaticAberration.intensity = this.chromaticAberration.targetIntensity;\r\n        \r\n        // Get the actual visible canvas from the document\r\n        const visibleCanvas = document.getElementById('emotive-canvas') || \r\n                            document.querySelector('canvas') || \r\n                            this.canvas;\r\n        \r\n        console.log('[Chromatic] Visible canvas element:', visibleCanvas);\r\n        console.log('[Chromatic] Canvas ID:', visibleCanvas?.id);\r\n        \r\n        if (visibleCanvas) {\r\n            // Remove any existing animation\r\n            visibleCanvas.style.animation = 'none';\r\n            \r\n            // Force reflow to reset animation\r\n            void visibleCanvas.offsetHeight;\r\n            \r\n            // Add CSS styles if not already present\r\n            if (!document.getElementById('chromatic-styles')) {\r\n                const style = document.createElement('style');\r\n                style.id = 'chromatic-styles';\r\n                style.textContent = `\r\n                    @keyframes chromaticGlitch {\r\n                        0% {\r\n                            filter: none;\r\n                            transform: translateX(0);\r\n                        }\r\n                        15% {\r\n                            filter: drop-shadow(-2px 0 0 rgba(255,0,0,0.7)) drop-shadow(2px 0 0 rgba(0,255,255,0.7));\r\n                            transform: translateX(-0.5px);\r\n                        }\r\n                        30% {\r\n                            filter: drop-shadow(-3px 0 0 rgba(255,0,0,0.8)) drop-shadow(3px 0 0 rgba(0,255,255,0.8));\r\n                            transform: translateX(0.5px);\r\n                        }\r\n                        45% {\r\n                            filter: drop-shadow(-2px 0 0 rgba(255,0,0,0.6)) drop-shadow(2px 0 0 rgba(0,255,255,0.6));\r\n                            transform: translateX(-0.3px);\r\n                        }\r\n                        60% {\r\n                            filter: drop-shadow(-1px 0 0 rgba(255,0,0,0.4)) drop-shadow(1px 0 0 rgba(0,255,255,0.4));\r\n                            transform: translateX(0.2px);\r\n                        }\r\n                        100% {\r\n                            filter: none;\r\n                            transform: translateX(0);\r\n                        }\r\n                    }\r\n                `;\r\n                document.head.appendChild(style);\r\n            }\r\n            \r\n            // Apply animation - shorter duration (300-500ms based on intensity)\r\n            visibleCanvas.style.animation = `chromaticGlitch ${300 + 200 * intensity}ms ease-out`;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Apply chromatic aberration effect to canvas\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {HTMLCanvasElement} sourceCanvas - Source canvas to apply effect to\r\n     */\r\n    applyChromaticAberration(ctx, sourceCanvas) {\r\n        if (!this.chromaticAberration.active || this.chromaticAberration.intensity <= 0) {\r\n            return;\r\n        }\r\n        \r\n        const intensity = this.chromaticAberration.intensity;\r\n        const offset = this.scaleValue(this.chromaticAberration.maxOffset * intensity);\r\n        \r\n        // Store current composite operation\r\n        const prevComposite = ctx.globalCompositeOperation;\r\n        \r\n        // Clear the canvas first\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        \r\n        // Draw red channel (shifted left)\r\n        ctx.globalCompositeOperation = 'source-over';\r\n        ctx.filter = 'url(#red-channel)'; // Will use CSS filter fallback\r\n        ctx.drawImage(sourceCanvas, -offset, 0);\r\n        \r\n        // Draw green channel (center)\r\n        ctx.globalCompositeOperation = 'screen';\r\n        ctx.filter = 'url(#green-channel)';\r\n        ctx.drawImage(sourceCanvas, 0, 0);\r\n        \r\n        // Draw blue channel (shifted right)\r\n        ctx.globalCompositeOperation = 'screen';\r\n        ctx.filter = 'url(#blue-channel)';\r\n        ctx.drawImage(sourceCanvas, offset, 0);\r\n        \r\n        // Reset\r\n        ctx.filter = 'none';\r\n        ctx.globalCompositeOperation = prevComposite;\r\n        ctx.restore();\r\n    }\r\n    \r\n    /**\r\n     * Simple chromatic aberration using multiple draws\r\n     * (Fallback method that doesn't require filters)\r\n     */\r\n    applyChromaticAberrationSimple(ctx, centerX, centerY, radius, drawFunction) {\r\n        if (!this.chromaticAberration.active || this.chromaticAberration.intensity <= 0) {\r\n            drawFunction();\r\n            return;\r\n        }\r\n        \r\n        const intensity = this.chromaticAberration.intensity;\r\n        const offset = this.scaleValue(this.chromaticAberration.maxOffset * intensity);\r\n        \r\n        ctx.save();\r\n        \r\n        // Draw red channel (shifted left)\r\n        ctx.globalCompositeOperation = 'source-over';\r\n        ctx.translate(-offset, 0);\r\n        ctx.globalAlpha = 0.33;\r\n        ctx.fillStyle = '#ff0000';\r\n        ctx.filter = 'brightness(3)';\r\n        drawFunction();\r\n        ctx.translate(offset, 0);\r\n        \r\n        // Draw green channel (center)\r\n        ctx.globalCompositeOperation = 'screen';\r\n        ctx.globalAlpha = 0.33;\r\n        ctx.fillStyle = '#00ff00';\r\n        drawFunction();\r\n        \r\n        // Draw blue channel (shifted right)\r\n        ctx.translate(offset, 0);\r\n        ctx.globalAlpha = 0.33;\r\n        ctx.fillStyle = '#0000ff';\r\n        drawFunction();\r\n        \r\n        ctx.restore();\r\n    }\r\n    \r\n    /**\r\n     * Update all active effects\r\n     */\r\n    update(deltaTime) {\r\n        // Update sparkles\r\n        this.sparkles = this.sparkles.filter(sparkle => {\r\n            sparkle.x += sparkle.vx;\r\n            sparkle.y += sparkle.vy;\r\n            sparkle.rotation += sparkle.rotationSpeed;\r\n            sparkle.lifetime -= deltaTime;\r\n            sparkle.vy += 0.1; // Gravity\r\n            \r\n            return sparkle.lifetime > 0;\r\n        });\r\n        \r\n        // Update chromatic aberration fade\r\n        if (this.chromaticAberration.active) {\r\n            // Fade out the effect\r\n            this.chromaticAberration.intensity -= this.chromaticAberration.fadeSpeed;\r\n            \r\n            if (this.chromaticAberration.intensity <= 0) {\r\n                this.chromaticAberration.intensity = 0;\r\n                this.chromaticAberration.active = false;\r\n                this.chromaticAberration.targetIntensity = 0;\r\n                console.log('[CSS Chromatic] Effect completed');\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default SpecialEffects;","/**\r\n * EyeRenderer - Handles eye expressions and blinking for EmotiveRenderer\r\n * @module core/renderer/EyeRenderer\r\n */\r\n\r\nexport class EyeRenderer {\r\n    constructor(renderer) {\r\n        this.renderer = renderer;\r\n        this.ctx = renderer.ctx;\r\n        this.canvas = renderer.canvas;\r\n        \r\n        // Eye state\r\n        this.blinking = false;\r\n        this.blinkingEnabled = true;\r\n        this.blinkTimer = 0;\r\n        this.nextBlinkTime = this.getRandomBlinkTime();\r\n        \r\n        // Eye parameters\r\n        this.squintAmount = 0;\r\n        this.eyeClose = null;\r\n        this.eyeOpen = null;\r\n        \r\n        // Helper method references\r\n        this.scaleValue = (value) => renderer.scaleValue(value);\r\n        this.hexToRgba = (hex, alpha) => renderer.hexToRgba(hex, alpha);\r\n    }\r\n\r\n    /**\r\n     * Update blinking and eye animations\r\n     * @param {number} deltaTime - Time since last frame\r\n     */\r\n    update(deltaTime) {\r\n        // Update blink timer\r\n        if (this.blinking) {\r\n            this.blinkTimer += deltaTime;\r\n            if (this.blinkTimer >= 150) {\r\n                this.blinking = false;\r\n                this.blinkTimer = 0;\r\n                this.nextBlinkTime = Date.now() + this.getRandomBlinkTime();\r\n            }\r\n        }\r\n        \r\n        // Check for natural blink\r\n        if (this.blinkingEnabled && !this.blinking && Date.now() >= this.nextBlinkTime) {\r\n            this.startBlink();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Start a blink animation\r\n     */\r\n    startBlink() {\r\n        if (!this.blinkingEnabled) return;\r\n        this.blinking = true;\r\n        this.blinkTimer = 0;\r\n    }\r\n\r\n    /**\r\n     * Get random time until next blink (3-7 seconds)\r\n     * @returns {number} Time in milliseconds\r\n     */\r\n    getRandomBlinkTime() {\r\n        return 3000 + Math.random() * 4000;\r\n    }\r\n\r\n    /**\r\n     * Calculate blink scale for core\r\n     * @returns {number} Scale factor for blinking\r\n     */\r\n    getBlinkScale() {\r\n        if (!this.blinking) return 1;\r\n        \r\n        const blinkProgress = Math.min(this.blinkTimer / 150, 1);\r\n        const blinkCurve = Math.sin(blinkProgress * Math.PI);\r\n        return 1 - blinkCurve * 0.7; // Squish vertically by 70%\r\n    }\r\n\r\n    /**\r\n     * Draw eye expression\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     * @param {string} emotion - Current emotion\r\n     * @param {Object} params - Eye parameters\r\n     */\r\n    drawEyes(x, y, radius, emotion, params = {}) {\r\n        const ctx = this.ctx;\r\n        \r\n        // Get eye parameters\r\n        const eyeOpenness = params.eyeOpenness || 1;\r\n        const eyeExpression = params.eyeExpression || 'neutral';\r\n        \r\n        // Don't draw eyes for certain states\r\n        if (emotion === 'zen' || emotion === 'neutral' || eyeOpenness <= 0) {\r\n            return;\r\n        }\r\n        \r\n        ctx.save();\r\n        \r\n        // Eye color (slightly darker than core)\r\n        ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';\r\n        ctx.lineWidth = this.scaleValue(2);\r\n        ctx.lineCap = 'round';\r\n        \r\n        // Calculate eye positions\r\n        const eyeSpacing = radius * 0.4;\r\n        const eyeY = y - radius * 0.1;\r\n        const eyeSize = radius * 0.25;\r\n        \r\n        // Draw based on expression\r\n        switch (eyeExpression) {\r\n            case 'happy':\r\n                this.drawHappyEyes(ctx, x, eyeY, eyeSpacing, eyeSize, eyeOpenness);\r\n                break;\r\n            case 'sad':\r\n                this.drawSadEyes(ctx, x, eyeY, eyeSpacing, eyeSize, eyeOpenness);\r\n                break;\r\n            case 'angry':\r\n                this.drawAngryEyes(ctx, x, eyeY, eyeSpacing, eyeSize, eyeOpenness);\r\n                break;\r\n            case 'surprised':\r\n                this.drawSurprisedEyes(ctx, x, eyeY, eyeSpacing, eyeSize, eyeOpenness);\r\n                break;\r\n            case 'focused':\r\n                this.drawFocusedEyes(ctx, x, eyeY, eyeSpacing, eyeSize, eyeOpenness);\r\n                break;\r\n            case 'sleepy':\r\n                this.drawSleepyEyes(ctx, x, eyeY, eyeSpacing, eyeSize, eyeOpenness);\r\n                break;\r\n            case 'suspicious':\r\n                this.drawSuspiciousEyes(ctx, x, eyeY, eyeSpacing, eyeSize, eyeOpenness);\r\n                break;\r\n            default:\r\n                // No eyes for neutral\r\n                break;\r\n        }\r\n        \r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Draw happy eyes (upward curves)\r\n     */\r\n    drawHappyEyes(ctx, x, y, spacing, size, openness) {\r\n        // Left eye\r\n        ctx.beginPath();\r\n        ctx.arc(x - spacing, y, size, Math.PI * 0.2, Math.PI * 0.8, false);\r\n        ctx.stroke();\r\n        \r\n        // Right eye\r\n        ctx.beginPath();\r\n        ctx.arc(x + spacing, y, size, Math.PI * 0.2, Math.PI * 0.8, false);\r\n        ctx.stroke();\r\n    }\r\n\r\n    /**\r\n     * Draw sad eyes (downward curves)\r\n     */\r\n    drawSadEyes(ctx, x, y, spacing, size, openness) {\r\n        // Left eye\r\n        ctx.beginPath();\r\n        ctx.arc(x - spacing, y + size * 0.5, size, Math.PI * 1.2, Math.PI * 1.8, false);\r\n        ctx.stroke();\r\n        \r\n        // Right eye\r\n        ctx.beginPath();\r\n        ctx.arc(x + spacing, y + size * 0.5, size, Math.PI * 1.2, Math.PI * 1.8, false);\r\n        ctx.stroke();\r\n    }\r\n\r\n    /**\r\n     * Draw angry eyes (angled lines)\r\n     */\r\n    drawAngryEyes(ctx, x, y, spacing, size, openness) {\r\n        // Left eye\r\n        ctx.beginPath();\r\n        ctx.moveTo(x - spacing - size, y - size * 0.3);\r\n        ctx.lineTo(x - spacing + size * 0.5, y + size * 0.3);\r\n        ctx.stroke();\r\n        \r\n        // Right eye\r\n        ctx.beginPath();\r\n        ctx.moveTo(x + spacing + size, y - size * 0.3);\r\n        ctx.lineTo(x + spacing - size * 0.5, y + size * 0.3);\r\n        ctx.stroke();\r\n    }\r\n\r\n    /**\r\n     * Draw surprised eyes (wide circles)\r\n     */\r\n    drawSurprisedEyes(ctx, x, y, spacing, size, openness) {\r\n        // Left eye\r\n        ctx.beginPath();\r\n        ctx.arc(x - spacing, y, size * 1.2, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n        \r\n        // Right eye\r\n        ctx.beginPath();\r\n        ctx.arc(x + spacing, y, size * 1.2, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n    }\r\n\r\n    /**\r\n     * Draw focused eyes (dots)\r\n     */\r\n    drawFocusedEyes(ctx, x, y, spacing, size, openness) {\r\n        ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';\r\n        \r\n        // Left eye\r\n        ctx.beginPath();\r\n        ctx.arc(x - spacing, y, size * 0.3, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        \r\n        // Right eye\r\n        ctx.beginPath();\r\n        ctx.arc(x + spacing, y, size * 0.3, 0, Math.PI * 2);\r\n        ctx.fill();\r\n    }\r\n\r\n    /**\r\n     * Draw sleepy eyes (half-closed)\r\n     */\r\n    drawSleepyEyes(ctx, x, y, spacing, size, openness) {\r\n        // Left eye\r\n        ctx.beginPath();\r\n        ctx.moveTo(x - spacing - size, y);\r\n        ctx.lineTo(x - spacing + size, y);\r\n        ctx.stroke();\r\n        \r\n        // Right eye\r\n        ctx.beginPath();\r\n        ctx.moveTo(x + spacing - size, y);\r\n        ctx.lineTo(x + spacing + size, y);\r\n        ctx.stroke();\r\n    }\r\n\r\n    /**\r\n     * Draw suspicious eyes (narrowed)\r\n     */\r\n    drawSuspiciousEyes(ctx, x, y, spacing, size, openness) {\r\n        // Left eye - narrowed\r\n        ctx.beginPath();\r\n        ctx.moveTo(x - spacing - size, y);\r\n        ctx.lineTo(x - spacing + size * 0.7, y);\r\n        ctx.stroke();\r\n        \r\n        // Right eye - more open\r\n        ctx.beginPath();\r\n        ctx.arc(x + spacing, y, size * 0.8, Math.PI * 0.1, Math.PI * 0.9, false);\r\n        ctx.stroke();\r\n    }\r\n\r\n    /**\r\n     * Enable or disable blinking\r\n     * @param {boolean} enabled - Whether blinking is enabled\r\n     */\r\n    setBlinkingEnabled(enabled) {\r\n        this.blinkingEnabled = enabled;\r\n        if (!enabled) {\r\n            this.blinking = false;\r\n            this.blinkTimer = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set squint amount for eye narrowing\r\n     * @param {number} amount - Squint amount (0-1)\r\n     */\r\n    setSquintAmount(amount) {\r\n        this.squintAmount = Math.max(0, Math.min(1, amount));\r\n    }\r\n\r\n    /**\r\n     * Force a blink\r\n     */\r\n    forceBlink() {\r\n        this.startBlink();\r\n    }\r\n}\r\n\r\nexport default EyeRenderer;","/**\n * BreathingAnimator - Handles breathing animations for EmotiveRenderer\n * @module core/renderer/BreathingAnimator\n */\n\nexport class BreathingAnimator {\n    constructor(renderer) {\n        this.renderer = renderer;\n        \n        // Breathing configuration\n        this.breathingSpeed = 0.42; // 16 breaths/min (0.42 rad/s = 4 sec/cycle = 15-16 bpm)\n        this.breathingDepth = 0.08; // 8% size variation for visible breathing\n        \n        // Breathing state\n        this.breathingPhase = 0;\n        this.breathRate = 1.0;\n        this.breathDepth = this.breathingDepth;\n        this.breathRateMult = 1.0;\n        this.breathDepthMult = 1.0;\n        this.breathIrregular = false;\n        \n        // Custom scale override\n        this.customScale = null;\n        \n        // Emotion-specific breathing patterns\n        this.emotionBreathPatterns = {\n            happy: { rate: 1.1, depth: 1.2 },\n            sad: { rate: 0.8, depth: 0.7 },\n            angry: { rate: 1.4, depth: 1.3 },\n            calm: { rate: 0.7, depth: 0.9 },\n            excited: { rate: 1.5, depth: 1.4 },\n            focused: { rate: 0.9, depth: 0.6 },\n            neutral: { rate: 1.0, depth: 1.0 },\n            love: { rate: 1.2, depth: 1.3 },\n            surprised: { rate: 1.3, depth: 1.1 },\n            confused: { rate: 1.1, depth: 0.9 },\n            amused: { rate: 1.2, depth: 1.1 },\n            bored: { rate: 0.6, depth: 0.8 },\n            tired: { rate: 0.5, depth: 1.2 },\n            anxious: { rate: 1.6, depth: 0.9 },\n            determined: { rate: 1.1, depth: 1.0 },\n            proud: { rate: 0.9, depth: 1.3 },\n            content: { rate: 0.8, depth: 1.0 },\n            hopeful: { rate: 1.0, depth: 1.1 },\n            zen: { rate: 0.4, depth: 1.5 },\n            intrigued: { rate: 1.1, depth: 0.8 },\n            embarrassed: { rate: 1.3, depth: 0.7 },\n            grateful: { rate: 0.9, depth: 1.1 },\n            inspired: { rate: 1.0, depth: 1.3 },\n            silly: { rate: 1.4, depth: 1.2 },\n            sleepy: { rate: 0.3, depth: 1.4 }\n        };\n    }\n\n    /**\n     * Update breathing animation\n     * @param {number} deltaTime - Time since last frame in ms\n     * @param {string} emotion - Current emotion\n     * @param {Object} undertone - Current undertone modifiers\n     */\n    update(deltaTime, emotion, undertone = {}) {\n        // Ensure undertone is not null\n        undertone = undertone || {};\n        \n        // Apply emotion-specific breathing pattern\n        const pattern = this.emotionBreathPatterns[emotion] || { rate: 1.0, depth: 1.0 };\n        \n        // Apply undertone modifiers (safe access with null check)\n        const undertoneRateMult = undertone?.breathRateMult || 1.0;\n        const undertoneDepthMult = undertone?.breathDepthMult || 1.0;\n        \n        // Calculate final breathing parameters\n        this.breathRate = pattern.rate * this.breathRateMult * undertoneRateMult;\n        this.breathDepth = this.breathingDepth * pattern.depth * this.breathDepthMult * undertoneDepthMult;\n        \n        // Add irregularity if needed\n        let phaseIncrement = this.breathingSpeed * this.breathRate * (deltaTime / 1000);\n        if (this.breathIrregular && undertone?.breathIrregular) {\n            phaseIncrement *= 0.8 + Math.sin(Date.now() * 0.0003) * 0.4;\n        }\n        \n        // Update breathing phase\n        this.breathingPhase += phaseIncrement;\n        if (this.breathingPhase > Math.PI * 2) {\n            this.breathingPhase -= Math.PI * 2;\n        }\n    }\n\n    /**\n     * Get current breathing scale\n     * @returns {number} Scale factor for breathing\n     */\n    getBreathingScale() {\n        // Return custom scale if set\n        if (this.customScale !== null) {\n            return this.customScale;\n        }\n        \n        // Calculate breathing scale\n        const breathAmount = Math.sin(this.breathingPhase);\n        return 1 + breathAmount * this.breathDepth;\n    }\n\n    /**\n     * Set custom breathing scale (overrides normal breathing)\n     * @param {number} scale - Custom scale value, or null to use normal breathing\n     */\n    setCustomScale(scale) {\n        this.customScale = scale;\n    }\n\n    /**\n     * Set breathing speed\n     * @param {number} speed - Breathing speed in radians per second\n     */\n    setBreathingSpeed(speed) {\n        this.breathingSpeed = speed;\n    }\n\n    /**\n     * Set breathing depth\n     * @param {number} depth - Breathing depth as percentage (0-1)\n     */\n    setBreathingDepth(depth) {\n        this.breathingDepth = Math.max(0, Math.min(1, depth));\n    }\n\n    /**\n     * Set breathing rate multiplier\n     * @param {number} mult - Rate multiplier\n     */\n    setBreathRateMultiplier(mult) {\n        this.breathRateMult = mult;\n    }\n\n    /**\n     * Set breathing depth multiplier\n     * @param {number} mult - Depth multiplier\n     */\n    setBreathDepthMultiplier(mult) {\n        this.breathDepthMult = mult;\n    }\n\n    /**\n     * Enable/disable irregular breathing\n     * @param {boolean} irregular - Whether breathing should be irregular\n     */\n    setIrregularBreathing(irregular) {\n        this.breathIrregular = irregular;\n    }\n\n    /**\n     * Reset breathing to default state\n     */\n    reset() {\n        this.breathingPhase = 0;\n        this.breathRate = 1.0;\n        this.breathDepth = this.breathingDepth;\n        this.breathRateMult = 1.0;\n        this.breathDepthMult = 1.0;\n        this.breathIrregular = false;\n        this.customScale = null;\n    }\n\n    /**\n     * Apply breath hold effect\n     * @param {boolean} empty - Whether lungs are empty (true) or full (false)\n     */\n    holdBreath(empty = false) {\n        // Set custom scale based on breath hold type\n        this.customScale = empty ? 0.92 : 1.08;\n    }\n\n    /**\n     * Release breath hold\n     */\n    releaseBreath() {\n        this.customScale = null;\n    }\n\n    /**\n     * Get breathing info for debugging\n     * @returns {Object} Breathing state info\n     */\n    getBreathingInfo() {\n        return {\n            phase: this.breathingPhase,\n            rate: this.breathRate,\n            depth: this.breathDepth,\n            scale: this.getBreathingScale(),\n            isCustom: this.customScale !== null,\n            isIrregular: this.breathIrregular\n        };\n    }\n}\n\nexport default BreathingAnimator;","/**\n * Gradient Cache System\n * Caches canvas gradients to avoid recreating them every frame\n *\n * @module core/renderer/GradientCache\n * @version 1.0.0\n */\n\n/**\n * Cache for canvas gradients to improve rendering performance\n */\nexport class GradientCache {\n    constructor() {\n        // Cache storage with Map for efficient lookups\n        this.cache = new Map();\n\n        // Stats for monitoring\n        this.stats = {\n            hits: 0,\n            misses: 0,\n            evictions: 0\n        };\n\n        // Cache configuration\n        this.maxSize = 100; // Maximum number of cached gradients\n        this.ttl = 60000; // Time to live in milliseconds (1 minute)\n\n        // LRU tracking\n        this.accessOrder = [];\n    }\n\n    /**\n     * Generate a unique key for gradient parameters\n     * @private\n     */\n    generateKey(type, params) {\n        if (type === 'radial') {\n            const { x0, y0, r0, x1, y1, r1, stops } = params;\n            const stopKey = stops.map(s => `${s.offset}:${s.color}`).join('|');\n            return `radial:${x0},${y0},${r0},${x1},${y1},${r1}:${stopKey}`;\n        } else if (type === 'linear') {\n            const { x0, y0, x1, y1, stops } = params;\n            const stopKey = stops.map(s => `${s.offset}:${s.color}`).join('|');\n            return `linear:${x0},${y0},${x1},${y1}:${stopKey}`;\n        }\n        return null;\n    }\n\n    /**\n     * Get or create a radial gradient\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\n     * @param {number} x0 - Start circle center x\n     * @param {number} y0 - Start circle center y\n     * @param {number} r0 - Start circle radius\n     * @param {number} x1 - End circle center x\n     * @param {number} y1 - End circle center y\n     * @param {number} r1 - End circle radius\n     * @param {Array} stops - Color stops [{offset, color}]\n     * @returns {CanvasGradient} Cached or new gradient\n     */\n    getRadialGradient(ctx, x0, y0, r0, x1, y1, r1, stops) {\n        const key = this.generateKey('radial', { x0, y0, r0, x1, y1, r1, stops });\n\n        // Check cache\n        const cached = this.cache.get(key);\n        if (cached && Date.now() - cached.timestamp < this.ttl) {\n            this.stats.hits++;\n            this.updateAccessOrder(key);\n            return cached.gradient;\n        }\n\n        // Create new gradient\n        this.stats.misses++;\n        const gradient = ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);\n\n        // Add color stops\n        stops.forEach(stop => {\n            gradient.addColorStop(stop.offset, stop.color);\n        });\n\n        // Cache it\n        this.set(key, gradient);\n\n        return gradient;\n    }\n\n    /**\n     * Get or create a linear gradient\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\n     * @param {number} x0 - Start point x\n     * @param {number} y0 - Start point y\n     * @param {number} x1 - End point x\n     * @param {number} y1 - End point y\n     * @param {Array} stops - Color stops [{offset, color}]\n     * @returns {CanvasGradient} Cached or new gradient\n     */\n    getLinearGradient(ctx, x0, y0, x1, y1, stops) {\n        const key = this.generateKey('linear', { x0, y0, x1, y1, stops });\n\n        // Check cache\n        const cached = this.cache.get(key);\n        if (cached && Date.now() - cached.timestamp < this.ttl) {\n            this.stats.hits++;\n            this.updateAccessOrder(key);\n            return cached.gradient;\n        }\n\n        // Create new gradient\n        this.stats.misses++;\n        const gradient = ctx.createLinearGradient(x0, y0, x1, y1);\n\n        // Add color stops\n        stops.forEach(stop => {\n            gradient.addColorStop(stop.offset, stop.color);\n        });\n\n        // Cache it\n        this.set(key, gradient);\n\n        return gradient;\n    }\n\n    /**\n     * Store gradient in cache with LRU eviction\n     * @private\n     */\n    set(key, gradient) {\n        // Check if we need to evict\n        if (this.cache.size >= this.maxSize && !this.cache.has(key)) {\n            this.evictLRU();\n        }\n\n        // Store with timestamp\n        this.cache.set(key, {\n            gradient,\n            timestamp: Date.now()\n        });\n\n        this.updateAccessOrder(key);\n    }\n\n    /**\n     * Update access order for LRU tracking\n     * @private\n     */\n    updateAccessOrder(key) {\n        // Remove from current position\n        const index = this.accessOrder.indexOf(key);\n        if (index > -1) {\n            this.accessOrder.splice(index, 1);\n        }\n        // Add to end (most recently used)\n        this.accessOrder.push(key);\n    }\n\n    /**\n     * Evict least recently used item\n     * @private\n     */\n    evictLRU() {\n        if (this.accessOrder.length > 0) {\n            const keyToEvict = this.accessOrder.shift();\n            this.cache.delete(keyToEvict);\n            this.stats.evictions++;\n        }\n    }\n\n    /**\n     * Clear all cached gradients\n     */\n    clear() {\n        this.cache.clear();\n        this.accessOrder = [];\n    }\n\n    /**\n     * Clear expired entries\n     */\n    clearExpired() {\n        const now = Date.now();\n        const keysToDelete = [];\n\n        for (const [key, value] of this.cache.entries()) {\n            if (now - value.timestamp >= this.ttl) {\n                keysToDelete.push(key);\n            }\n        }\n\n        keysToDelete.forEach(key => {\n            this.cache.delete(key);\n            const index = this.accessOrder.indexOf(key);\n            if (index > -1) {\n                this.accessOrder.splice(index, 1);\n            }\n        });\n    }\n\n    /**\n     * Get cache statistics\n     * @returns {Object} Cache stats\n     */\n    getStats() {\n        const hitRate = this.stats.hits + this.stats.misses > 0\n            ? (this.stats.hits / (this.stats.hits + this.stats.misses) * 100).toFixed(2)\n            : 0;\n\n        return {\n            size: this.cache.size,\n            maxSize: this.maxSize,\n            hits: this.stats.hits,\n            misses: this.stats.misses,\n            evictions: this.stats.evictions,\n            hitRate: `${hitRate}%`\n        };\n    }\n\n    /**\n     * Create a gradient helper that automatically caches\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\n     * @returns {Object} Helper object with gradient methods\n     */\n    createHelper(ctx) {\n        return {\n            radial: (x0, y0, r0, x1, y1, r1, stops) =>\n                this.getRadialGradient(ctx, x0, y0, r0, x1, y1, r1, stops),\n            linear: (x0, y0, x1, y1, stops) =>\n                this.getLinearGradient(ctx, x0, y0, x1, y1, stops)\n        };\n    }\n}\n\n// Create singleton instance\nexport const gradientCache = new GradientCache();\n\n// Export for convenience\nexport default gradientCache;","/**\r\n * GlowRenderer - Handles glow effects rendering for EmotiveRenderer\r\n * @module core/renderer/GlowRenderer\r\n */\r\n\r\nimport { gradientCache } from './GradientCache.js';\r\n\r\nexport class GlowRenderer {\r\n    constructor(renderer) {\r\n        this.renderer = renderer;\r\n        this.ctx = renderer.ctx;\r\n        this.canvas = renderer.canvas;\r\n        \r\n        // Glow state\r\n        this.glowIntensity = 1.0;\r\n        this.glowColor = '#4a90e2';\r\n        this.targetGlowColor = '#4a90e2';\r\n        this.glowColorTransition = 0;\r\n        this.glowColorTransitionSpeed = 0.05;\r\n        \r\n        // Offscreen canvas for caching glow gradients\r\n        this.offscreenCanvas = null;\r\n        this.offscreenCtx = null;\r\n        this.cachedGlowColor = null;\r\n        this.cachedGlowRadius = 0;\r\n        \r\n        // Helper method references\r\n        this.scaleValue = (value) => renderer.scaleValue(value);\r\n        this.hexToRgba = (hex, alpha) => renderer.hexToRgba(hex, alpha);\r\n        \r\n        this.initOffscreenCanvas();\r\n    }\r\n\r\n    /**\r\n     * Initialize offscreen canvas for gradient caching\r\n     */\r\n    initOffscreenCanvas() {\r\n        this.offscreenCanvas = document.createElement('canvas');\r\n        this.offscreenCtx = this.offscreenCanvas.getContext('2d');\r\n    }\r\n\r\n    /**\r\n     * Update offscreen canvas size\r\n     * @param {number} size - Size for the offscreen canvas\r\n     */\r\n    updateOffscreenSize(size) {\r\n        if (this.offscreenCanvas.width !== size || this.offscreenCanvas.height !== size) {\r\n            this.offscreenCanvas.width = size;\r\n            this.offscreenCanvas.height = size;\r\n            this.cachedGlowColor = null; // Invalidate cache\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Render main glow effect\r\n     * @param {number} x - Center X position\r\n     * @param {number} y - Center Y position\r\n     * @param {number} radius - Core radius\r\n     * @param {Object} params - Additional parameters\r\n     */\r\n    renderGlow(x, y, radius, params = {}) {\r\n        const ctx = this.ctx;\r\n        const color = params.color || this.glowColor;\r\n        const intensity = params.intensity !== undefined ? params.intensity : this.glowIntensity;\r\n        \r\n        // Skip if intensity is too low\r\n        if (intensity < 0.01) return;\r\n        \r\n        // Outer glow size\r\n        const glowSize = this.scaleValue(200);\r\n        \r\n        // Always use direct rendering for consistent brightness\r\n        this.renderGlowDirect(ctx, x, y, radius, color, intensity);\r\n        return;\r\n        \r\n        // Check if we need to update the cached gradient\r\n        if (this.cachedGlowColor !== color || this.cachedGlowRadius !== glowSize) {\r\n            this.cacheGlowGradient(color, glowSize);\r\n        }\r\n        \r\n        // Draw cached gradient for normal intensity\r\n        if (this.offscreenCanvas && this.cachedGlowColor === color) {\r\n            ctx.save();\r\n            ctx.globalAlpha = Math.min(1, intensity);\r\n            ctx.globalCompositeOperation = 'screen';\r\n            \r\n            // Draw from offscreen canvas\r\n            const drawX = x - glowSize;\r\n            const drawY = y - glowSize;\r\n            ctx.drawImage(this.offscreenCanvas, drawX, drawY);\r\n            \r\n            ctx.restore();\r\n        } else {\r\n            // Fallback to direct rendering if cache fails\r\n            this.renderGlowDirect(ctx, x, y, radius, color, intensity);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Cache glow gradient to offscreen canvas\r\n     * @param {string} color - Glow color\r\n     * @param {number} size - Glow size\r\n     */\r\n    cacheGlowGradient(color, size) {\r\n        const offCtx = this.offscreenCtx;\r\n        const center = size;\r\n        \r\n        // Update offscreen canvas size\r\n        this.updateOffscreenSize(size * 2);\r\n        \r\n        // Clear offscreen canvas\r\n        offCtx.clearRect(0, 0, this.offscreenCanvas.width, this.offscreenCanvas.height);\r\n        \r\n        // Use cached gradient - higher opacity to match original brightness\r\n        const gradient = gradientCache.getRadialGradient(\r\n            offCtx, center, center, 0, center, center, size,\r\n            [\r\n                { offset: 0, color: this.hexToRgba(color, 0.4) },\r\n                { offset: 0.3, color: this.hexToRgba(color, 0.2) },\r\n                { offset: 0.6, color: this.hexToRgba(color, 0.1) },\r\n                { offset: 1, color: this.hexToRgba(color, 0) }\r\n            ]\r\n        );\r\n\r\n        // Draw gradient to offscreen canvas\r\n        offCtx.fillStyle = gradient;\r\n        offCtx.fillRect(0, 0, size * 2, size * 2);\r\n        \r\n        // Update cache info\r\n        this.cachedGlowColor = color;\r\n        this.cachedGlowRadius = size;\r\n    }\r\n\r\n    /**\r\n     * Direct glow rendering (fallback)\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     * @param {string} color - Glow color\r\n     * @param {number} intensity - Glow intensity\r\n     */\r\n    renderGlowDirect(ctx, x, y, radius, color, intensity) {\r\n        // Use the EXACT original formula for consistent brightness\r\n        ctx.save();\r\n        \r\n        // Build gradient stops array\r\n        const stops = 20;\r\n        const gradientStops = [];\r\n        for (let i = 0; i <= stops; i++) {\r\n            const position = i / stops;\r\n            const baseOpacity = 0.6 * Math.pow(1 - position, 2.2);\r\n            const opacity = baseOpacity * intensity;\r\n            gradientStops.push({ offset: position, color: this.hexToRgba(color, opacity) });\r\n        }\r\n\r\n        // Use cached gradient\r\n        const gradient = gradientCache.getRadialGradient(\r\n            ctx, x, y, 0, x, y, radius, gradientStops\r\n        );\r\n        \r\n        ctx.fillStyle = gradient;\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        \r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Render recording glow effect\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     * @param {number} intensity - Glow intensity\r\n     */\r\n    renderRecordingGlow(x, y, radius, intensity) {\r\n        const ctx = this.ctx;\r\n        const glowSize = radius * 2.5;\r\n        const gradient = gradientCache.getRadialGradient(\r\n            ctx, x, y, 0, x, y, glowSize,\r\n            [\r\n                { offset: 0, color: `rgba(255, 0, 0, ${0.3 * intensity})` },\r\n                { offset: 0.5, color: `rgba(255, 0, 0, ${0.15 * intensity})` },\r\n                { offset: 1, color: 'rgba(255, 0, 0, 0)' }\r\n            ]\r\n        );\r\n        \r\n        ctx.save();\r\n        ctx.globalCompositeOperation = 'screen';\r\n        ctx.fillStyle = gradient;\r\n        ctx.fillRect(x - glowSize, y - glowSize, glowSize * 2, glowSize * 2);\r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Render zen glow effect\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     * @param {number} time - Current time for animation\r\n     */\r\n    renderZenGlow(x, y, radius, time) {\r\n        const ctx = this.ctx;\r\n        const breathPhase = Math.sin(time * 0.001) * 0.5 + 0.5;\r\n        const zenRadius = radius * (0.9 + breathPhase * 0.1);\r\n        \r\n        // Inner glow\r\n        const gradient = gradientCache.getRadialGradient(\r\n            ctx, x, y, 0, x, y, zenRadius,\r\n            [\r\n                { offset: 0, color: 'rgba(147, 112, 219, 0.8)' },\r\n                { offset: 0.7, color: 'rgba(147, 112, 219, 0.3)' },\r\n                { offset: 1, color: 'rgba(147, 112, 219, 0)' }\r\n            ]\r\n        );\r\n        \r\n        ctx.save();\r\n        ctx.globalCompositeOperation = 'screen';\r\n        ctx.fillStyle = gradient;\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, zenRadius * 1.5, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Update glow color with transition\r\n     * @param {string} targetColor - Target glow color\r\n     * @param {number} deltaTime - Time since last frame\r\n     */\r\n    updateGlowColor(targetColor, deltaTime) {\r\n        if (this.targetGlowColor !== targetColor) {\r\n            this.targetGlowColor = targetColor;\r\n            this.glowColorTransition = 0;\r\n        }\r\n        \r\n        // Animate color transition\r\n        if (this.glowColorTransition < 1) {\r\n            this.glowColorTransition = Math.min(1, this.glowColorTransition + this.glowColorTransitionSpeed);\r\n            this.glowColor = this.lerpColor(this.glowColor, this.targetGlowColor, this.glowColorTransition);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Lerp between two colors\r\n     * @param {string} color1 - Start color\r\n     * @param {string} color2 - End color\r\n     * @param {number} t - Interpolation value (0-1)\r\n     * @returns {string} Interpolated color\r\n     */\r\n    lerpColor(color1, color2, t) {\r\n        // Convert hex to RGB\r\n        const rgb1 = this.hexToRgb(color1);\r\n        const rgb2 = this.hexToRgb(color2);\r\n        \r\n        // Interpolate\r\n        const r = Math.round(rgb1.r + (rgb2.r - rgb1.r) * t);\r\n        const g = Math.round(rgb1.g + (rgb2.g - rgb1.g) * t);\r\n        const b = Math.round(rgb1.b + (rgb2.b - rgb1.b) * t);\r\n        \r\n        // Convert back to hex\r\n        return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;\r\n    }\r\n\r\n    /**\r\n     * Convert hex color to RGB\r\n     * @param {string} hex - Hex color\r\n     * @returns {Object} RGB values\r\n     */\r\n    hexToRgb(hex) {\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        return result ? {\r\n            r: parseInt(result[1], 16),\r\n            g: parseInt(result[2], 16),\r\n            b: parseInt(result[3], 16)\r\n        } : { r: 0, g: 0, b: 0 };\r\n    }\r\n\r\n    /**\r\n     * Set glow intensity\r\n     * @param {number} intensity - Glow intensity (0-1)\r\n     */\r\n    setGlowIntensity(intensity) {\r\n        this.glowIntensity = Math.max(0, Math.min(1, intensity));\r\n    }\r\n\r\n    /**\r\n     * Set glow color instantly\r\n     * @param {string} color - Glow color\r\n     */\r\n    setGlowColor(color) {\r\n        this.glowColor = color;\r\n        this.targetGlowColor = color;\r\n        this.glowColorTransition = 1;\r\n    }\r\n\r\n    /**\r\n     * Clean up resources\r\n     */\r\n    destroy() {\r\n        this.offscreenCanvas = null;\r\n        this.offscreenCtx = null;\r\n        this.cachedGlowColor = null;\r\n    }\r\n}\r\n\r\nexport default GlowRenderer;","/**\r\n * CoreRenderer - Handles core shape rendering for EmotiveRenderer\r\n * @module core/renderer/CoreRenderer\r\n */\r\n\r\nimport { gradientCache } from './GradientCache.js';\r\n\r\nexport class CoreRenderer {\r\n    constructor(renderer) {\r\n        this.renderer = renderer;\r\n        this.ctx = renderer.ctx;\r\n        this.canvas = renderer.canvas;\r\n        \r\n        // Core appearance\r\n        this.coreColor = '#FFFFFF';\r\n        this.coreOpacity = 1.0;\r\n        this.coreBorderWidth = 0;\r\n        this.coreBorderColor = null;\r\n        \r\n        // Shape state\r\n        this.shapePoints = null;\r\n        this.isMorphing = false;\r\n        \r\n        // Helper method references\r\n        this.scaleValue = (value) => renderer.scaleValue(value);\r\n        this.hexToRgba = (hex, alpha) => renderer.hexToRgba(hex, alpha);\r\n    }\r\n\r\n    /**\r\n     * Render the main core shape\r\n     * @param {number} x - Center X position\r\n     * @param {number} y - Center Y position\r\n     * @param {number} radius - Core radius\r\n     * @param {Object} params - Rendering parameters\r\n     */\r\n    renderCore(x, y, radius, params = {}) {\r\n        const ctx = this.ctx;\r\n        \r\n        // Extract parameters\r\n        const scaleX = params.scaleX || 1;\r\n        const scaleY = params.scaleY || 1;\r\n        const rotation = params.rotation || 0;\r\n        const opacity = params.opacity !== undefined ? params.opacity : this.coreOpacity;\r\n        const color = params.color || this.coreColor;\r\n        const shapePoints = params.shapePoints || this.shapePoints;\r\n        \r\n        ctx.save();\r\n        \r\n        // Apply transformations\r\n        ctx.translate(x, y);\r\n        if (rotation !== 0) {\r\n            ctx.rotate(rotation);\r\n        }\r\n        ctx.scale(scaleX, scaleY);\r\n        \r\n        // Set core style\r\n        ctx.fillStyle = this.hexToRgba(color, opacity);\r\n        \r\n        // Draw shape based on points or default circle\r\n        if (shapePoints && shapePoints.length > 0) {\r\n            this.drawMorphedShape(ctx, shapePoints, radius);\r\n        } else {\r\n            this.drawCircle(ctx, radius);\r\n        }\r\n        \r\n        // Draw border if needed\r\n        if (this.coreBorderWidth > 0 && this.coreBorderColor) {\r\n            ctx.strokeStyle = this.coreBorderColor;\r\n            ctx.lineWidth = this.scaleValue(this.coreBorderWidth);\r\n            ctx.stroke();\r\n        }\r\n        \r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Draw drop shadow for depth\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {number} radius - Shape radius\r\n     * @param {Array} shapePoints - Shape points\r\n     */\r\n    drawDropShadow(ctx, radius, shapePoints) {\r\n        ctx.save();\r\n        \r\n        const shadowOffset = this.scaleValue(2);\r\n        ctx.translate(0, shadowOffset);\r\n        \r\n        // Use simpler shadow for complex deformed shapes\r\n        if (shapePoints && shapePoints.length > 32) {\r\n            // Simple dark circle shadow when shape is complex\r\n            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';\r\n            ctx.beginPath();\r\n            ctx.arc(0, 0, radius * 1.05, 0, Math.PI * 2);\r\n            ctx.fill();\r\n        } else {\r\n            // Shadow gradient - dark center fading to transparent\r\n            const shadowGradient = gradientCache.getRadialGradient(\r\n                ctx, 0, 0, radius * 0.7, 0, 0, radius * 1.2,\r\n                [\r\n                    { offset: 0, color: 'rgba(0, 0, 0, 0.2)' },\r\n                    { offset: 0.8, color: 'rgba(0, 0, 0, 0.1)' },\r\n                    { offset: 1, color: 'rgba(0, 0, 0, 0)' }\r\n                ]\r\n            );\r\n\r\n            ctx.fillStyle = shadowGradient;\r\n            ctx.beginPath();\r\n            if (shapePoints) {\r\n                // Scale points for shadow\r\n                const scale = 1.1;\r\n                const step = shapePoints.length > 20 ? 2 : 1;\r\n                ctx.moveTo(shapePoints[0].x * scale, shapePoints[0].y * scale);\r\n                for (let i = step; i < shapePoints.length; i += step) {\r\n                    ctx.lineTo(shapePoints[i].x * scale, shapePoints[i].y * scale);\r\n                }\r\n                ctx.closePath();\r\n            } else {\r\n                ctx.arc(0, 0, radius * 1.1, 0, Math.PI * 2);\r\n            }\r\n            ctx.fill();\r\n        }\r\n        \r\n        ctx.restore();\r\n    }\r\n    \r\n    /**\r\n     * Draw a simple circle\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {number} radius - Circle radius\r\n     */\r\n    drawCircle(ctx, radius) {\r\n        ctx.beginPath();\r\n        ctx.arc(0, 0, radius, 0, Math.PI * 2);\r\n        ctx.fill();\r\n    }\r\n\r\n    /**\r\n     * Draw a morphed shape from points\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {Array} points - Shape points\r\n     * @param {number} baseRadius - Base radius for scaling\r\n     */\r\n    drawMorphedShape(ctx, points, baseRadius) {\r\n        if (!points || points.length < 3) {\r\n            // Fallback to circle if not enough points\r\n            this.drawCircle(ctx, baseRadius);\r\n            return;\r\n        }\r\n        \r\n        ctx.beginPath();\r\n        \r\n        // Points from getCanvasPoints are already in canvas coordinates\r\n        // relative to the center (0,0) after translation\r\n        points.forEach((point, i) => {\r\n            if (i === 0) {\r\n                ctx.moveTo(point.x, point.y);\r\n            } else {\r\n                ctx.lineTo(point.x, point.y);\r\n            }\r\n        });\r\n        \r\n        ctx.closePath();\r\n        ctx.fill();\r\n    }\r\n\r\n    /**\r\n     * Render zen core effect\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     * @param {number} time - Current time for animation\r\n     */\r\n    renderZenCore(x, y, radius, time) {\r\n        const ctx = this.ctx;\r\n        \r\n        // Zen breathing effect\r\n        const breathPhase = Math.sin(time * 0.001) * 0.5 + 0.5;\r\n        const zenRadius = radius * (0.95 + breathPhase * 0.05);\r\n        \r\n        // Draw zen core with subtle inner glow\r\n        ctx.save();\r\n        \r\n        // Inner shadow for depth\r\n        ctx.shadowBlur = this.scaleValue(10);\r\n        ctx.shadowColor = 'rgba(147, 112, 219, 0.3)';\r\n        ctx.shadowOffsetX = 0;\r\n        ctx.shadowOffsetY = 0;\r\n        \r\n        // Main core\r\n        ctx.fillStyle = '#FFFFFF';\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, zenRadius, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        \r\n        // Inner ring\r\n        ctx.strokeStyle = 'rgba(147, 112, 219, 0.2)';\r\n        ctx.lineWidth = this.scaleValue(1);\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, zenRadius * 0.9, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n        \r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Render sleepy core effect\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     */\r\n    renderSleepyCore(x, y, radius) {\r\n        const ctx = this.ctx;\r\n        \r\n        // Slightly squished for sleepy look\r\n        ctx.save();\r\n        ctx.translate(x, y);\r\n        ctx.scale(1, 0.85);\r\n        \r\n        ctx.fillStyle = '#FFFFFF';\r\n        ctx.beginPath();\r\n        ctx.arc(0, 0, radius, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        \r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Render glitched core effect\r\n     * @param {number} x - Center X\r\n     * @param {number} y - Center Y\r\n     * @param {number} radius - Core radius\r\n     * @param {number} glitchIntensity - Glitch intensity (0-1)\r\n     */\r\n    renderGlitchedCore(x, y, radius, glitchIntensity) {\r\n        const ctx = this.ctx;\r\n        \r\n        // Draw multiple offset cores for glitch effect\r\n        const offsets = [\r\n            { x: -2, y: 0, alpha: 0.3 },\r\n            { x: 2, y: 0, alpha: 0.3 },\r\n            { x: 0, y: -1, alpha: 0.2 }\r\n        ];\r\n        \r\n        ctx.save();\r\n        \r\n        offsets.forEach(offset => {\r\n            ctx.fillStyle = this.hexToRgba('#FFFFFF', offset.alpha * glitchIntensity);\r\n            ctx.beginPath();\r\n            ctx.arc(\r\n                x + offset.x * glitchIntensity * this.scaleValue(5),\r\n                y + offset.y * glitchIntensity * this.scaleValue(5),\r\n                radius,\r\n                0,\r\n                Math.PI * 2\r\n            );\r\n            ctx.fill();\r\n        });\r\n        \r\n        // Main core\r\n        ctx.fillStyle = '#FFFFFF';\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        \r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Set shape points for morphing\r\n     * @param {Array} points - Array of normalized points\r\n     */\r\n    setShapePoints(points) {\r\n        this.shapePoints = points;\r\n        this.isMorphing = points && points.length > 0;\r\n    }\r\n\r\n    /**\r\n     * Clear shape points (return to circle)\r\n     */\r\n    clearShapePoints() {\r\n        this.shapePoints = null;\r\n        this.isMorphing = false;\r\n    }\r\n\r\n    /**\r\n     * Set core color\r\n     * @param {string} color - Core color\r\n     */\r\n    setCoreColor(color) {\r\n        this.coreColor = color;\r\n    }\r\n\r\n    /**\r\n     * Set core opacity\r\n     * @param {number} opacity - Core opacity (0-1)\r\n     */\r\n    setCoreOpacity(opacity) {\r\n        this.coreOpacity = Math.max(0, Math.min(1, opacity));\r\n    }\r\n\r\n    /**\r\n     * Set core border\r\n     * @param {number} width - Border width\r\n     * @param {string} color - Border color\r\n     */\r\n    setCoreBorder(width, color) {\r\n        this.coreBorderWidth = width;\r\n        this.coreBorderColor = color;\r\n    }\r\n\r\n    /**\r\n     * Get core rendering info\r\n     * @returns {Object} Core state info\r\n     */\r\n    getCoreInfo() {\r\n        return {\r\n            color: this.coreColor,\r\n            opacity: this.coreOpacity,\r\n            hasBorder: this.coreBorderWidth > 0,\r\n            isMorphing: this.isMorphing,\r\n            shapePointCount: this.shapePoints ? this.shapePoints.length : 0\r\n        };\r\n    }\r\n}\r\n\r\nexport default CoreRenderer;","/**\r\n * RotationBrake - Simple braking system using DEGREES like the working demo\r\n * @module core/animation/RotationBrake\r\n */\r\n\r\nexport class RotationBrake {\r\n    constructor(renderer) {\r\n        this.renderer = renderer;\r\n\r\n        // Braking state - EXACTLY like the demo\r\n        this.brakeStartTime = null;\r\n        this.brakeDuration = 2500; // Will be calculated dynamically\r\n        this.brakeStartRotation = 0;\r\n        this.brakeTargetRotation = 0;\r\n        this.brakeStartVelocity = 0;\r\n\r\n        // Callbacks\r\n        this.onComplete = null;\r\n        this.onProgress = null;\r\n\r\n        // Constants\r\n        this.DURATION_FACTOR = 14; // Tuned for natural deceleration feel\r\n    }\r\n\r\n    /**\r\n     * Brake to upright position (0 degrees)\r\n     * @param {Object} options - Brake options\r\n     * @returns {Promise} Resolves when braking complete\r\n     */\r\n    brakeToUpright(options = {}) {\r\n        return this.brakeToTarget(0, options);\r\n    }\r\n\r\n    /**\r\n     * Brake to nearest multiple of given angle\r\n     * @param {number} angleStep - Angle step in DEGREES (e.g., 90 for 90°)\r\n     * @param {Object} options - Brake options\r\n     * @returns {Promise} Resolves when braking complete\r\n     */\r\n    brakeToNearest(angleStep, options = {}) {\r\n        const currentAngle = this.renderer.state.manualRotation || 0;\r\n        const steps = Math.round(currentAngle / angleStep);\r\n        const targetAngle = steps * angleStep;\r\n        return this.brakeToTarget(targetAngle, options);\r\n    }\r\n\r\n    /**\r\n     * Brake to specific target angle\r\n     * @param {number} targetAngle - Target angle in DEGREES (0 = upright)\r\n     * @param {Object} options - Brake options\r\n     * @returns {Promise} Resolves when braking complete\r\n     */\r\n    brakeToTarget(targetAngle, options = {}) {\r\n        return new Promise((resolve) => {\r\n            const {\r\n                onProgress = null,\r\n                onComplete = null\r\n            } = options;\r\n\r\n            this.onProgress = onProgress;\r\n            this.onComplete = onComplete;\r\n\r\n            // Get current state - ALL IN DEGREES\r\n            const currentVelocity = this.renderer.state.rotationSpeed || 0;\r\n            const rotation = this.renderer.state.manualRotation || 0;\r\n\r\n            // Do nothing if not moving or already braking\r\n            if (currentVelocity === 0 || this.brakeStartTime) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            // Initialize braking state\r\n            this.brakeStartTime = performance.now();\r\n            this.brakeStartRotation = rotation;\r\n            this.brakeStartVelocity = currentVelocity;\r\n\r\n            // Calculate the nearest upright target rotation\r\n            if (targetAngle === 0) {\r\n                // Special case for upright\r\n                if (currentVelocity > 0) { // Spinning clockwise\r\n                    this.brakeTargetRotation = (Math.floor(rotation / 360) + 1) * 360;\r\n                } else { // Spinning counter-clockwise\r\n                    this.brakeTargetRotation = Math.floor(rotation / 360) * 360;\r\n                }\r\n            } else {\r\n                // General case\r\n                const normalizedTarget = targetAngle % 360;\r\n                const baseCycles = Math.floor(rotation / 360);\r\n\r\n                if (currentVelocity > 0) {\r\n                    if (normalizedTarget > (rotation % 360)) {\r\n                        this.brakeTargetRotation = baseCycles * 360 + normalizedTarget;\r\n                    } else {\r\n                        this.brakeTargetRotation = (baseCycles + 1) * 360 + normalizedTarget;\r\n                    }\r\n                } else {\r\n                    if (normalizedTarget < (rotation % 360)) {\r\n                        this.brakeTargetRotation = baseCycles * 360 + normalizedTarget;\r\n                    } else {\r\n                        this.brakeTargetRotation = (baseCycles - 1) * 360 + normalizedTarget;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // DYNAMIC DURATION CALCULATION - EXACTLY like the demo\r\n            const angleToTravel = Math.abs(this.brakeTargetRotation - this.brakeStartRotation);\r\n            this.brakeDuration = Math.max(500, (angleToTravel / Math.abs(currentVelocity)) * this.DURATION_FACTOR * 5);\r\n\r\n            console.log('Brake started:', {\r\n                from: rotation.toFixed(1) + '°',\r\n                to: this.brakeTargetRotation.toFixed(1) + '°',\r\n                velocity: currentVelocity,\r\n                duration: this.brakeDuration.toFixed(0) + 'ms'\r\n            });\r\n\r\n            // Stop adding velocity immediately\r\n            this.renderer.setRotationSpeed(0);\r\n\r\n            this.resolvePromise = resolve;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update brake state - called by renderer each frame\r\n     * @param {number} currentTime - Current timestamp from requestAnimationFrame\r\n     * @returns {Object|null} - Rotation update or null if not braking\r\n     */\r\n    updateBrake(currentTime) {\r\n        if (!this.brakeStartTime) {\r\n            return null; // Not braking\r\n        }\r\n\r\n        const elapsed = currentTime - this.brakeStartTime;\r\n        const progress = Math.min(elapsed / this.brakeDuration, 1);\r\n\r\n        // Ease-out quartic for smooth deceleration (starts fast, ends slow)\r\n        const easedProgress = 1 - Math.pow(1 - progress, 4);\r\n\r\n        // Calculate new rotation based on eased progress\r\n        const rotation = this.brakeStartRotation +\r\n            (this.brakeTargetRotation - this.brakeStartRotation) * easedProgress;\r\n\r\n        // Calculate virtual speed for UI (decreases with progress)\r\n        const virtualSpeed = this.brakeStartVelocity * Math.pow(1 - easedProgress, 2);\r\n\r\n        // Progress callback\r\n        if (this.onProgress) {\r\n            this.onProgress(easedProgress, virtualSpeed, rotation);\r\n        }\r\n\r\n        if (progress >= 1) {\r\n            // Stop the animation when braking is complete\r\n            this.brakeStartTime = null;\r\n\r\n            console.log('Brake complete:', {\r\n                target: this.brakeTargetRotation.toFixed(1) + '°',\r\n                duration: elapsed.toFixed(0) + 'ms'\r\n            });\r\n\r\n            this.complete();\r\n\r\n            // Return final position\r\n            return {\r\n                rotation: this.brakeTargetRotation,\r\n                speed: 0,\r\n                complete: true\r\n            };\r\n        }\r\n\r\n        // Continue braking\r\n        return {\r\n            rotation: rotation,\r\n            speed: virtualSpeed,\r\n            complete: false\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Stop any active braking\r\n     */\r\n    stop() {\r\n        this.brakeStartTime = null;\r\n    }\r\n\r\n    /**\r\n     * Complete the braking operation\r\n     * @private\r\n     */\r\n    complete() {\r\n        if (this.onComplete) {\r\n            this.onComplete();\r\n        }\r\n\r\n        if (this.resolvePromise) {\r\n            this.resolvePromise();\r\n            this.resolvePromise = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if currently braking\r\n     * @returns {boolean}\r\n     */\r\n    isBraking() {\r\n        return this.brakeStartTime !== null;\r\n    }\r\n\r\n    /**\r\n     * Emergency stop - immediately halt rotation\r\n     */\r\n    emergencyStop() {\r\n        this.stop();\r\n        this.renderer.setRotationSpeed(0);\r\n        this.complete();\r\n    }\r\n\r\n    /**\r\n     * Get current brake progress\r\n     * @returns {number} Progress from 0 to 1\r\n     */\r\n    getProgress() {\r\n        if (!this.brakeStartTime) return 0;\r\n        const elapsed = performance.now() - this.brakeStartTime;\r\n        return Math.min(elapsed / this.brakeDuration, 1);\r\n    }\r\n}\r\n\r\nexport default RotationBrake;","/**\r\n * AmbientDanceAnimator - Connects ambient dance gestures to the renderer\r\n * Bridges the GestureBlender output with the actual rendering system\r\n */\r\n\r\nclass AmbientDanceAnimator {\r\n    constructor(renderer) {\r\n        this.renderer = renderer;\r\n\r\n        // Animation states for ambient gestures\r\n        this.animations = {\r\n            grooveSway: null,\r\n            grooveBob: null,\r\n            grooveFlow: null,\r\n            groovePulse: null,\r\n            grooveStep: null\r\n        };\r\n\r\n        // Current active animation\r\n        this.activeAnimation = null;\r\n\r\n        // Blend state from GestureBlender\r\n        this.blendState = {\r\n            x: 0,\r\n            y: 0,\r\n            rotation: 0,\r\n            scale: 1,\r\n            opacity: 1\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Start an ambient dance animation\r\n     * @param {string} animationName - Name of the ambient gesture\r\n     * @param {Object} options - Animation options\r\n     */\r\n    startAmbientAnimation(animationName, options = {}) {\r\n        // Stop previous animation\r\n        if (this.activeAnimation && this.activeAnimation !== animationName) {\r\n            this.stopAmbientAnimation(this.activeAnimation);\r\n        }\r\n\r\n        this.activeAnimation = animationName;\r\n        this.animations[animationName] = {\r\n            startTime: Date.now(),\r\n            intensity: options.intensity || 1.0,\r\n            frequency: options.frequency || 1.0,\r\n            options: options\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Stop an ambient animation\r\n     */\r\n    stopAmbientAnimation(animationName) {\r\n        if (this.animations[animationName]) {\r\n            this.animations[animationName] = null;\r\n        }\r\n        if (this.activeAnimation === animationName) {\r\n            this.activeAnimation = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update blend state from GestureBlender\r\n     */\r\n    updateBlendState(blendState) {\r\n        if (!blendState) return;\r\n\r\n        // Smooth interpolation\r\n        const lerpFactor = 0.2;\r\n        this.blendState.x = this.lerp(this.blendState.x, blendState.x || 0, lerpFactor);\r\n        this.blendState.y = this.lerp(this.blendState.y, blendState.y || 0, lerpFactor);\r\n        this.blendState.rotation = this.lerp(this.blendState.rotation, blendState.rotation || 0, lerpFactor);\r\n        this.blendState.scale = this.lerp(this.blendState.scale, blendState.scale || 1, lerpFactor);\r\n        this.blendState.opacity = this.lerp(this.blendState.opacity, blendState.opacity || 1, lerpFactor);\r\n    }\r\n\r\n    /**\r\n     * Get current animation transform\r\n     */\r\n    getTransform(deltaTime) {\r\n        const transform = {\r\n            x: this.blendState.x,\r\n            y: this.blendState.y,\r\n            rotation: this.blendState.rotation,\r\n            scale: this.blendState.scale,\r\n            opacity: this.blendState.opacity\r\n        };\r\n\r\n        // Apply active animation on top\r\n        if (this.activeAnimation) {\r\n            const animation = this.animations[this.activeAnimation];\r\n            if (animation) {\r\n                const elapsed = Date.now() - animation.startTime;\r\n\r\n                switch (this.activeAnimation) {\r\n                    case 'grooveSway':\r\n                        transform.x += Math.sin(elapsed / 500 * animation.frequency) * 15 * animation.intensity;\r\n                        transform.rotation += Math.sin(elapsed / 500 * animation.frequency + Math.PI/4) * 5 * animation.intensity;\r\n                        break;\r\n\r\n                    case 'grooveBob':\r\n                        transform.y += Math.sin(elapsed / 400 * animation.frequency) * 10 * animation.intensity;\r\n                        transform.scale *= 1 + Math.sin(elapsed / 400 * animation.frequency) * 0.03 * animation.intensity;\r\n                        break;\r\n\r\n                    case 'grooveFlow':\r\n                        const t = elapsed / 1000 * animation.frequency;\r\n                        transform.x += Math.sin(t) * Math.cos(t * 2) * 20 * animation.intensity;\r\n                        transform.y += Math.cos(t) * Math.sin(t * 2) * 10 * animation.intensity;\r\n                        transform.rotation += Math.sin(t * 2) * 8 * animation.intensity;\r\n                        break;\r\n\r\n                    case 'groovePulse':\r\n                        transform.scale *= 1 + Math.sin(elapsed / 250 * animation.frequency) * 0.05 * animation.intensity;\r\n                        transform.opacity *= 0.9 + Math.sin(elapsed / 250 * animation.frequency) * 0.1 * animation.intensity;\r\n                        break;\r\n\r\n                    case 'grooveStep':\r\n                        const stepPhase = Math.floor(elapsed / 500 * animation.frequency) % 4;\r\n                        const stepProgress = (elapsed / 500 * animation.frequency) % 1;\r\n                        const smoothStep = this.smoothStep(stepProgress);\r\n\r\n                        if (stepPhase === 0) transform.x += smoothStep * 25 * animation.intensity;\r\n                        else if (stepPhase === 2) transform.x -= smoothStep * 25 * animation.intensity;\r\n\r\n                        transform.y += Math.abs(Math.sin(elapsed / 250 * animation.frequency)) * 5 * animation.intensity;\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return transform;\r\n    }\r\n\r\n    /**\r\n     * Linear interpolation\r\n     */\r\n    lerp(a, b, t) {\r\n        return a + (b - a) * t;\r\n    }\r\n\r\n    /**\r\n     * Smooth step function\r\n     */\r\n    smoothStep(t) {\r\n        return t * t * (3 - 2 * t);\r\n    }\r\n}\r\n\r\n// Export for ES6 modules\r\nexport { AmbientDanceAnimator };\r\n\r\n// Also export as default\r\nexport default AmbientDanceAnimator;","/**\r\n * Animation Loop Manager\r\n * Consolidates all requestAnimationFrame calls into a single, efficient loop\r\n *\r\n * @module core/AnimationLoopManager\r\n * @version 1.0.0\r\n */\r\n\r\n/**\r\n * Priority levels for animations\r\n * @enum {number}\r\n */\r\nexport const AnimationPriority = {\r\n    CRITICAL: 0,    // Must run every frame (e.g., main render)\r\n    HIGH: 1,        // Should run every frame if possible\r\n    MEDIUM: 2,      // Can skip frames if needed\r\n    LOW: 3,         // Background tasks, can be throttled\r\n    IDLE: 4         // Only run when idle\r\n};\r\n\r\n/**\r\n * Centralized animation loop manager\r\n * Replaces multiple requestAnimationFrame calls with a single, optimized loop\r\n */\r\nexport class AnimationLoopManager {\r\n    constructor() {\r\n        // Animation callbacks organized by priority\r\n        this.callbacks = new Map();\r\n        this.callbackIdCounter = 0;\r\n\r\n        // Frame timing\r\n        this.frameId = null;\r\n        this.isRunning = false;\r\n        this.lastFrameTime = 0;\r\n        this.deltaTime = 0;\r\n        this.fps = 60;\r\n        this.frameCount = 0;\r\n\r\n        // Performance\r\n        this.targetFPS = 60;\r\n        this.targetFrameTime = 1000 / this.targetFPS;\r\n        this.frameBudget = 16.67; // ms\r\n\r\n        // Frame skipping for low priority\r\n        this.prioritySkipCounters = {\r\n            [AnimationPriority.MEDIUM]: 0,\r\n            [AnimationPriority.LOW]: 0,\r\n            [AnimationPriority.IDLE]: 0\r\n        };\r\n\r\n        // Performance monitoring\r\n        this.performanceMonitor = null;\r\n        this.frameTimeHistory = [];\r\n        this.maxHistorySize = 60;\r\n\r\n        // Bind methods\r\n        this.loop = this.loop.bind(this);\r\n    }\r\n\r\n    /**\r\n     * Register an animation callback\r\n     * @param {Function} callback - Function to call each frame (receives deltaTime, timestamp)\r\n     * @param {number} priority - Priority level from AnimationPriority enum\r\n     * @param {Object} context - Optional context for callback\r\n     * @returns {number} Callback ID for later removal\r\n     */\r\n    register(callback, priority = AnimationPriority.MEDIUM, context = null) {\r\n        if (typeof callback !== 'function') {\r\n            throw new Error('Callback must be a function');\r\n        }\r\n\r\n        const id = ++this.callbackIdCounter;\r\n\r\n        // Store callback with metadata\r\n        this.callbacks.set(id, {\r\n            callback,\r\n            priority,\r\n            context,\r\n            lastRun: 0,\r\n            runCount: 0,\r\n            totalTime: 0,\r\n            enabled: true\r\n        });\r\n\r\n        // Auto-start if this is the first callback\r\n        if (this.callbacks.size === 1 && !this.isRunning) {\r\n            this.start();\r\n        }\r\n\r\n        return id;\r\n    }\r\n\r\n    /**\r\n     * Unregister an animation callback\r\n     * @param {number} id - Callback ID returned from register()\r\n     */\r\n    unregister(id) {\r\n        this.callbacks.delete(id);\r\n\r\n        // Auto-stop if no callbacks remain\r\n        if (this.callbacks.size === 0 && this.isRunning) {\r\n            this.stop();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enable/disable a callback without removing it\r\n     * @param {number} id - Callback ID\r\n     * @param {boolean} enabled - Whether to enable or disable\r\n     */\r\n    setEnabled(id, enabled) {\r\n        const callback = this.callbacks.get(id);\r\n        if (callback) {\r\n            callback.enabled = enabled;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Start the animation loop\r\n     */\r\n    start() {\r\n        if (this.isRunning) return;\r\n\r\n        this.isRunning = true;\r\n        this.lastFrameTime = performance.now();\r\n        this.frameId = requestAnimationFrame(this.loop);\r\n    }\r\n\r\n    /**\r\n     * Stop the animation loop\r\n     */\r\n    stop() {\r\n        if (!this.isRunning) return;\r\n\r\n        this.isRunning = false;\r\n        if (this.frameId) {\r\n            cancelAnimationFrame(this.frameId);\r\n            this.frameId = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Main animation loop\r\n     * @param {number} timestamp - Current timestamp from requestAnimationFrame\r\n     */\r\n    loop(timestamp) {\r\n        if (!this.isRunning) return;\r\n\r\n        // Calculate delta time\r\n        this.deltaTime = timestamp - this.lastFrameTime;\r\n        this.lastFrameTime = timestamp;\r\n\r\n        // Update FPS\r\n        this.frameCount++;\r\n        if (this.frameCount % 60 === 0) {\r\n            this.fps = Math.round(1000 / (this.deltaTime || 16.67));\r\n        }\r\n\r\n        // Track frame time\r\n        this.frameTimeHistory.push(this.deltaTime);\r\n        if (this.frameTimeHistory.length > this.maxHistorySize) {\r\n            this.frameTimeHistory.shift();\r\n        }\r\n\r\n        // Performance marker start\r\n        const frameStartTime = performance.now();\r\n\r\n        // Group callbacks by priority\r\n        const callbacksByPriority = this.groupCallbacksByPriority();\r\n\r\n        // Execute callbacks by priority\r\n        let timeSpent = 0;\r\n\r\n        for (const priority of [\r\n            AnimationPriority.CRITICAL,\r\n            AnimationPriority.HIGH,\r\n            AnimationPriority.MEDIUM,\r\n            AnimationPriority.LOW,\r\n            AnimationPriority.IDLE\r\n        ]) {\r\n            // Check frame budget (except for CRITICAL)\r\n            if (priority > AnimationPriority.CRITICAL && timeSpent > this.frameBudget * 0.8) {\r\n                break; // Skip lower priorities if running out of time\r\n            }\r\n\r\n            // Check if we should skip this priority level\r\n            if (this.shouldSkipPriority(priority)) {\r\n                continue;\r\n            }\r\n\r\n            // Execute callbacks at this priority\r\n            const callbacks = callbacksByPriority.get(priority) || [];\r\n\r\n            for (const callbackData of callbacks) {\r\n                if (!callbackData.enabled) continue;\r\n\r\n                const callbackStart = performance.now();\r\n\r\n                try {\r\n                    // Call with context if provided\r\n                    if (callbackData.context) {\r\n                        callbackData.callback.call(callbackData.context, this.deltaTime, timestamp);\r\n                    } else {\r\n                        callbackData.callback(this.deltaTime, timestamp);\r\n                    }\r\n\r\n                    // Track performance\r\n                    const callbackTime = performance.now() - callbackStart;\r\n                    callbackData.totalTime += callbackTime;\r\n                    callbackData.runCount++;\r\n                    callbackData.lastRun = timestamp;\r\n                    timeSpent += callbackTime;\r\n\r\n                } catch (error) {\r\n                    console.error('Animation callback error:', error);\r\n                    // Disable problematic callbacks\r\n                    if (callbackData.runCount > 0 && callbackData.totalTime / callbackData.runCount > 10) {\r\n                        console.warn('Disabling slow callback');\r\n                        callbackData.enabled = false;\r\n                    }\r\n                }\r\n\r\n                // Break if spending too much time\r\n                if (timeSpent > this.frameBudget) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Performance marker end\r\n        const frameTime = performance.now() - frameStartTime;\r\n\r\n        // Warn if frame took too long\r\n        if (frameTime > this.frameBudget * 1.5) {\r\n            console.warn(`Frame took ${frameTime.toFixed(2)}ms (target: ${this.frameBudget}ms)`);\r\n        }\r\n\r\n        // Schedule next frame\r\n        this.frameId = requestAnimationFrame(this.loop);\r\n    }\r\n\r\n    /**\r\n     * Group callbacks by priority for efficient execution\r\n     * @returns {Map} Map of priority to callback arrays\r\n     */\r\n    groupCallbacksByPriority() {\r\n        const groups = new Map();\r\n\r\n        for (const [id, callbackData] of this.callbacks) {\r\n            const priority = callbackData.priority;\r\n\r\n            if (!groups.has(priority)) {\r\n                groups.set(priority, []);\r\n            }\r\n\r\n            groups.get(priority).push(callbackData);\r\n        }\r\n\r\n        return groups;\r\n    }\r\n\r\n    /**\r\n     * Determine if we should skip a priority level this frame\r\n     * @param {number} priority - Priority level to check\r\n     * @returns {boolean} True if should skip\r\n     */\r\n    shouldSkipPriority(priority) {\r\n        // Never skip critical\r\n        if (priority === AnimationPriority.CRITICAL) return false;\r\n\r\n        // Skip based on frame rate\r\n        if (this.fps < 30 && priority >= AnimationPriority.LOW) return true;\r\n        if (this.fps < 45 && priority === AnimationPriority.IDLE) return true;\r\n\r\n        // Frame skipping for lower priorities\r\n        if (priority === AnimationPriority.MEDIUM) {\r\n            // Run every 2nd frame if FPS is low\r\n            if (this.fps < 50) {\r\n                this.prioritySkipCounters[priority]++;\r\n                if (this.prioritySkipCounters[priority] % 2 !== 0) return true;\r\n            }\r\n        } else if (priority === AnimationPriority.LOW) {\r\n            // Run every 3rd frame if FPS is low\r\n            if (this.fps < 50) {\r\n                this.prioritySkipCounters[priority]++;\r\n                if (this.prioritySkipCounters[priority] % 3 !== 0) return true;\r\n            }\r\n        } else if (priority === AnimationPriority.IDLE) {\r\n            // Run every 5th frame\r\n            this.prioritySkipCounters[priority]++;\r\n            if (this.prioritySkipCounters[priority] % 5 !== 0) return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Get performance statistics\r\n     * @returns {Object} Performance stats\r\n     */\r\n    getStats() {\r\n        const stats = {\r\n            fps: this.fps,\r\n            frameCount: this.frameCount,\r\n            callbackCount: this.callbacks.size,\r\n            averageFrameTime: 0,\r\n            maxFrameTime: 0,\r\n            minFrameTime: Infinity\r\n        };\r\n\r\n        // Calculate frame time stats\r\n        if (this.frameTimeHistory.length > 0) {\r\n            let total = 0;\r\n            for (const time of this.frameTimeHistory) {\r\n                total += time;\r\n                stats.maxFrameTime = Math.max(stats.maxFrameTime, time);\r\n                stats.minFrameTime = Math.min(stats.minFrameTime, time);\r\n            }\r\n            stats.averageFrameTime = total / this.frameTimeHistory.length;\r\n        }\r\n\r\n        // Get callback stats by priority\r\n        stats.callbacksByPriority = {};\r\n        for (const [id, callback] of this.callbacks) {\r\n            const priority = callback.priority;\r\n            if (!stats.callbacksByPriority[priority]) {\r\n                stats.callbacksByPriority[priority] = {\r\n                    count: 0,\r\n                    totalTime: 0,\r\n                    enabled: 0\r\n                };\r\n            }\r\n            stats.callbacksByPriority[priority].count++;\r\n            stats.callbacksByPriority[priority].totalTime += callback.totalTime;\r\n            if (callback.enabled) stats.callbacksByPriority[priority].enabled++;\r\n        }\r\n\r\n        return stats;\r\n    }\r\n\r\n    /**\r\n     * Set target FPS\r\n     * @param {number} fps - Target frames per second\r\n     */\r\n    setTargetFPS(fps) {\r\n        this.targetFPS = Math.max(15, Math.min(120, fps));\r\n        this.targetFrameTime = 1000 / this.targetFPS;\r\n        this.frameBudget = this.targetFrameTime;\r\n    }\r\n\r\n    /**\r\n     * Set performance monitor\r\n     * @param {PerformanceMonitor} monitor - Performance monitor instance\r\n     */\r\n    setPerformanceMonitor(monitor) {\r\n        this.performanceMonitor = monitor;\r\n    }\r\n\r\n    /**\r\n     * Destroy and cleanup\r\n     */\r\n    destroy() {\r\n        this.stop();\r\n        this.callbacks.clear();\r\n        this.frameTimeHistory = [];\r\n    }\r\n}\r\n\r\n// Create singleton instance\r\nexport const animationLoopManager = new AnimationLoopManager();\r\n\r\n// Export for convenience\r\nexport default animationLoopManager;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                      ◐ ◑ ◒ ◓  EMOTIVE RENDERER  ◓ ◒ ◑ ◐                      \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Emotive Renderer - Visual Rendering Engine\r\n * @author Emotive Engine Team\r\n * @version 2.4.0\r\n * @module EmotiveRenderer\r\n * @changelog 2.4.0 - Added offscreen canvas caching for glow gradients\r\n * @changelog 2.3.0 - Optimized color transitions to use main render loop\r\n * @changelog 2.2.0 - Dynamic visual resampling on resize for consistent quality\r\n * @changelog 2.1.0 - Implemented undertone saturation system for glow colors\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The VISUAL ARTIST of the Emotive Engine. Renders the iconic orb with its          \r\n * ║ glowing core, breathing animation, eye expressions, and gesture animations.       \r\n * ║ Creates the minimalist yet expressive visual that defines Emotive.                \r\n * ║                                                                                    \r\n * ║ NEW: Undertone saturation creates visual depth by adjusting glow color            \r\n * ║ saturation based on emotional intensity (intense→electric, subdued→ghostly)       \r\n * ║ NEW: Dynamic visual resampling ensures consistent quality at any canvas size      \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎨 VISUAL COMPONENTS                                                              \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • White Core      : The solid center orb (#FFFFFF)                                \r\n * │ • Colored Glow    : Emotional aura surrounding the core                           \r\n * │ • Eye Shape       : Arc-based expressions (happiness, sadness, focus)             \r\n * │ • Breathing       : Subtle size pulsation for life-like quality                   \r\n * │ • Gesture Motion  : Position, scale, and rotation animations                      \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎭 RENDERING PIPELINE                                                             \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ 1. Clear canvas or apply motion blur                                              \r\n * │ 2. Calculate breathing scale factor                                               \r\n * │ 3. Apply gesture transformations (position, scale, rotation)                      \r\n * │ 4. Draw colored glow layers (3 gradient circles)                                  \r\n * │ 5. Draw white core circle                                                         \r\n * │ 6. Draw eye expression if not neutral                                             \r\n * │ 7. Apply special effects (jitter, zen morph, etc.)                                \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ⚙️  CONFIGURABLE PROPERTIES                                                       \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • coreSizeDivisor  : Orb size relative to canvas (default: 12)                    \r\n * │ • glowMultiplier   : Glow radius vs core (default: 2.5x)                          \r\n * │ • breathingSpeed   : Breaths per minute (default: 16)                             \r\n * │ • breathingDepth   : Scale variation % (default: 8%)                              \r\n * │ • renderingStyle   : 'classic' | 'soft' | 'sharp'                                 \r\n * │ • referenceSize    : Reference canvas size for scaling (default: 400)             \r\n * │ • baseScale        : Global scale multiplier (default: 1.0)                       \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 👁️ EYE EXPRESSION SYSTEM                                                          \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Openness    : 0.0 (closed) to 1.0 (fully open)                                  \r\n * │ • Arc         : -1.0 (sad ∩) to 1.0 (happy ∪)                                    \r\n * │ • Asymmetry   : Different shapes for left/right eyes                              \r\n * │ • Blinking    : Smooth open/close animations                                      \r\n * │ • Zen Morph   : Special ∩∩ shape for meditation                                   \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ❌ PERFORMANCE CRITICAL                                                           \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ ✗ Gradient caching     → Recreating gradients kills FPS                          \r\n * │ ✗ Canvas save/restore  → Excessive use causes slowdown                           \r\n * │ ✗ Clear rect timing    → Motion blur depends on this                             \r\n * │ ✗ Animation frame IDs  → Must track to prevent memory leaks                      \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nimport { interpolateHsl, applyUndertoneSaturation, rgbToHex, hexToRgb } from '../utils/colorUtils.js';\r\nimport GestureCompositor from './GestureCompositor.js';\r\nimport { getEmotion } from './emotions/index.js';\r\nimport { getEffect, applyEffect, isEffectActive } from './effects/index.js';\r\nimport { getGesture } from './gestures/index.js';\r\nimport musicalDuration from './MusicalDuration.js';\r\n\r\n// Import modular renderer components\r\nimport { GestureAnimator } from './renderer/GestureAnimator.js';\r\nimport { ColorUtilities } from './renderer/ColorUtilities.js';\r\nimport { SpecialEffects } from './renderer/SpecialEffects.js';\r\nimport { EyeRenderer } from './renderer/EyeRenderer.js';\r\nimport { BreathingAnimator } from './renderer/BreathingAnimator.js';\r\nimport { GlowRenderer } from './renderer/GlowRenderer.js';\r\nimport { CoreRenderer } from './renderer/CoreRenderer.js';\r\nimport { RotationBrake } from './animation/RotationBrake.js';\r\nimport { AmbientDanceAnimator } from './renderer/AmbientDanceAnimator.js';\r\nimport { animationLoopManager, AnimationPriority } from './AnimationLoopManager.js';\r\nimport { gradientCache } from './renderer/GradientCache.js';\r\n\r\nclass EmotiveRenderer {\r\n    constructor(canvasManager, options = {}) {\r\n        this.canvasManager = canvasManager;\r\n        this.ctx = canvasManager.getContext();\r\n        \r\n        if (!this.ctx) {\r\n        }\r\n        \r\n        // Gesture compositor for emotion/undertone modulation\r\n        this.gestureCompositor = new GestureCompositor();\r\n        \r\n        // Initialize current undertone\r\n        this.currentUndertone = null;\r\n        \r\n        // Initialize modular components\r\n        this.gestureAnimator = new GestureAnimator(this);\r\n        this.colorUtilities = new ColorUtilities();\r\n        this.specialEffects = new SpecialEffects(this);\r\n        this.eyeRenderer = new EyeRenderer(this);\r\n        this.breathingAnimator = new BreathingAnimator(this);\r\n        this.glowRenderer = new GlowRenderer(this);\r\n        this.coreRenderer = new CoreRenderer(this);\r\n        this.rotationBrake = new RotationBrake(this);\r\n        this.ambientDanceAnimator = new AmbientDanceAnimator(this);\r\n\r\n        // Configuration - matching original Emotive proportions\r\n        this.config = {\r\n            coreColor: options.coreColor || '#FFFFFF',\r\n            coreSizeDivisor: options.coreSizeDivisor || 12,  // Core radius = min(width,height) / 12\r\n            glowMultiplier: options.glowMultiplier || 2.5,   // Glow radius = core radius * 2.5\r\n            defaultGlowColor: options.defaultGlowColor || '#14B8A6',  // Teal\r\n            breathingSpeed: options.breathingSpeed || 0.42,  // 16 breaths/min (0.42 rad/s = 4 sec/cycle = 15-16 bpm)\r\n            breathingDepth: options.breathingDepth || 0.08,  // 8% size variation for visible breathing\r\n            renderingStyle: options.renderingStyle || 'classic',\r\n            baseScale: options.baseScale || 1.0,  // Global scale multiplier for entire system\r\n            referenceSize: 400,  // Reference canvas size for scale calculations\r\n            topOffset: options.topOffset || 0  // Vertical offset to align with layout\r\n        };\r\n        \r\n        // Initialize scaleFactor based on current canvas size\r\n        const canvasSize = Math.min(\r\n            this.canvasManager.width || 400, \r\n            this.canvasManager.height || 400\r\n        );\r\n        this.scaleFactor = (canvasSize / this.config.referenceSize) * this.config.baseScale;\r\n        \r\n        // State\r\n        this.state = {\r\n            emotion: 'neutral',\r\n            glowColor: this.config.defaultGlowColor,\r\n            glowIntensity: 1.0,\r\n            breathRate: 1.0,\r\n            breathDepth: this.config.breathingDepth,\r\n            coreJitter: false,\r\n            speaking: false,\r\n            recording: false,\r\n            sleeping: false,\r\n            blinking: false,\r\n            blinkingEnabled: true,  // Add flag to control blinking\r\n            gazeOffset: { x: 0, y: 0 },\r\n            gazeIntensity: 0,\r\n            gazeLocked: false,\r\n            gazeTrackingEnabled: false,  // Whether to track mouse/touch\r\n            gazeTarget: { x: 0, y: 0 },  // Target position for gaze (-1 to 1)\r\n            zenVortexIntensity: 1.0,  // Adjustable whirlpool intensity for zen\r\n            // Suspicion state\r\n            squintAmount: 0,         // 0-1, how much the eye is narrowed\r\n            targetSquintAmount: 0,   // Target squint amount to animate to\r\n            scanPhase: 0,            // Current phase of scanning animation\r\n            lastScanTime: 0,         // Last time we did a scan\r\n            isSuspicious: false,     // Track if we're in suspicion mode\r\n            // Custom scale for breathing\r\n            customScale: null,       // When set, overrides normal breathing scale\r\n            // Undertone modifiers - initialize with defaults\r\n            sizeMultiplier: 1.0,\r\n            jitterAmount: 0,\r\n            episodicFlutter: false,\r\n            glowRadiusMult: 1.0,\r\n            breathRateMult: 1.0,\r\n            breathDepthMult: 1.0,\r\n            breathIrregular: false,\r\n            particleRateMult: 1.0,\r\n            // Manual rotation control (not BPM-locked)\r\n            manualRotation: 0,        // Current rotation angle in DEGREES\r\n            rotationSpeed: 0,         // Rotation speed in DEGREES per frame (like velocity in demo)\r\n            lastRotationUpdate: performance.now()\r\n        };\r\n        \r\n        // Animation state (now delegated to modules)\r\n        // Breathing is handled by BreathingAnimator\r\n        // Blinking is handled by EyeRenderer\r\n        \r\n        // Track animation frame IDs to prevent memory leaks\r\n        this.animationFrameIds = {\r\n            colorTransition: null,\r\n            eyeClose: null,\r\n            eyeOpen: null,\r\n            zenEnter: null,\r\n            zenExit: null\r\n        };\r\n\r\n        // Track loop manager callback IDs\r\n        this.loopCallbackIds = {\r\n            eyeClose: null,\r\n            eyeOpen: null,\r\n            zenEnter: null,\r\n            zenExit: null\r\n        };\r\n        \r\n        // Offscreen canvas for double buffering\r\n        this.offscreenCanvas = null;\r\n        this.offscreenCtx = null;\r\n        this.initOffscreenCanvas();\r\n\r\n        // Store canvas reference for gaze tracking\r\n        this.canvas = canvasManager.canvas;\r\n        \r\n        // Cache for expensive gradients\r\n        this.glowCache = new Map();\r\n        this.maxCacheSize = 10;\r\n        \r\n        // Gesture animations\r\n        this.gestureAnimations = {\r\n            bounce: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            pulse: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            shake: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            spin: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            nod: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            tilt: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            expand: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            contract: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            flash: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            drift: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null,\r\n                startX: 0,\r\n                startY: 0\r\n            },\r\n            stretch: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            glow: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            flicker: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            vibrate: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            wave: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            breathe: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            morph: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            slowBlink: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            look: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null,\r\n                targetX: 0,\r\n                targetY: 0\r\n            },\r\n            settle: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            breathIn: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            breathOut: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            breathHold: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            breathHoldEmpty: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            jump: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            orbital: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            },\r\n            hula: {\r\n                active: false,\r\n                startTime: 0,\r\n                progress: 0,\r\n                params: null\r\n            }\r\n        };\r\n        \r\n        // Episodic effects for undertones\r\n        this.episodicEffects = {\r\n            nervous: {\r\n                active: false,\r\n                startTime: 0,\r\n                duration: 0,\r\n                intensity: 0,\r\n                nextTrigger: 3000 + Math.random() * 2000 // 3-5 seconds\r\n            },\r\n            confident: {\r\n                active: false,\r\n                startTime: 0,\r\n                duration: 0,\r\n                intensity: 0,\r\n                nextTrigger: 4000 + Math.random() * 2000 // 4-6 seconds\r\n            },\r\n            tired: {\r\n                active: false,\r\n                startTime: 0,\r\n                duration: 0,\r\n                intensity: 0,\r\n                nextTrigger: 5000 + Math.random() * 2000 // 5-7 seconds\r\n            },\r\n            intense: {\r\n                active: false,\r\n                startTime: 0,\r\n                duration: 0,\r\n                intensity: 0,\r\n                nextTrigger: 3000 + Math.random() * 3000 // 3-6 seconds\r\n            },\r\n            subdued: {\r\n                active: false,\r\n                startTime: 0,\r\n                duration: 0,\r\n                intensity: 0,\r\n                nextTrigger: 4000 + Math.random() * 3000 // 4-7 seconds\r\n            }\r\n        };\r\n        \r\n        // Speaking animation\r\n        this.speakingRings = [];\r\n        this.maxRings = 5;\r\n        this.ringSpawnTimer = 0;\r\n        this.ringSpawnInterval = 200; // ms between rings\r\n        \r\n        // Recording animation (rings move inward)\r\n        this.recordingRings = [];\r\n        this.recordingPulse = 0;\r\n        \r\n        // Sleep state - consolidated here for visualization\r\n        this.sleepZ = [];\r\n        \r\n        // Zen state animation\r\n        this.zenTransition = {\r\n            active: false,\r\n            phase: null, // 'entering', 'in', 'exiting'\r\n            startTime: 0,\r\n            previousEmotion: null,\r\n            targetEmotion: null,\r\n            scaleX: 1.0,\r\n            scaleY: 1.0,\r\n            arcHeight: 0,\r\n            lotusMorph: 0, // 0 = circle, 1 = full lotus\r\n            petalSpread: 0, // 0 = closed, 1 = fully open\r\n            smileCurve: 0  // 0 = straight, 1 = full smile\r\n        };\r\n        \r\n        // Standardized color transition system\r\n        this.colorTransition = {\r\n            active: false,\r\n            fromColor: this.state.glowColor,\r\n            toColor: this.state.glowColor,\r\n            fromIntensity: this.state.glowIntensity,\r\n            toIntensity: this.state.glowIntensity,\r\n            progress: 0,\r\n            startTime: 0,\r\n            duration: 1500  // Default 1.5s\r\n        };\r\n        \r\n        // Comprehensive undertone modifiers\r\n        this.undertoneModifiers = {\r\n            nervous: {\r\n                // Color - subtle shimmer, no major shift\r\n                hueShift: 0,          // No hue change\r\n                saturationMult: 1.05, // Tiny bit more vivid\r\n                brightnessMult: 1.0,  // Normal brightness\r\n                brightnessFlicker: 0.05, // 5% brightness variation\r\n                // Visual\r\n                sizeMultiplier: 1.0,  // Normal size\r\n                jitterAmount: 0,      // No constant jitter - handled by episodic flutter\r\n                episodicFlutter: true, // Occasional butterfly moments\r\n                glowRadiusMult: 1.0,  // Normal glow\r\n                glowPulse: 0.05,      // 5% subtle heartbeat pulse\r\n                // Breathing\r\n                breathRateMult: 1.1,  // Slightly faster\r\n                breathDepthMult: 0.9, // Slightly shallower\r\n                breathIrregular: true, // Occasional catch in rhythm\r\n            },\r\n            confident: {\r\n                // Color - warmer, vibrant\r\n                hueShift: 15,         // Warmer but not overwhelming\r\n                saturationMult: 1.2,  // More vibrant\r\n                brightnessMult: 1.1,  // Slightly brighter\r\n                // Visual\r\n                sizeMultiplier: 1.0,  // Normal size until episodes\r\n                jitterAmount: 0,      // Rock solid\r\n                episodicPowerPose: true, // Occasional chest puffs\r\n                glowRadiusMult: 1.15, // Slightly expanded glow\r\n                // Breathing\r\n                breathRateMult: 0.95, // Slightly slower, controlled\r\n                breathDepthMult: 1.1, // Fuller breaths\r\n                breathIrregular: false,\r\n            },\r\n            tired: {\r\n                // Color - slightly cooler, less saturated\r\n                hueShift: -5,         // Slightly cooler\r\n                saturationMult: 0.7,  // Less vibrant\r\n                brightnessMult: 0.85, // Slightly darker\r\n                // Visual\r\n                sizeMultiplier: 0.95, // Slightly smaller\r\n                jitterAmount: 0,\r\n                episodicMicroSleep: true, // Occasional drowsy sags\r\n                glowRadiusMult: 0.9,  // Slightly reduced glow\r\n                // Breathing\r\n                breathRateMult: 0.8,  // Slower\r\n                breathDepthMult: 1.2, // Deeper breaths\r\n                breathIrregular: false,\r\n            },\r\n            intense: {\r\n                // Color - high contrast, saturated\r\n                hueShift: 5,          // Very slightly warmer\r\n                saturationMult: 1.3,  // More saturated\r\n                brightnessMult: 1.15, // Brighter\r\n                // Visual\r\n                sizeMultiplier: 1.0,  // Normal until focus moments\r\n                jitterAmount: 0,      // Still, focused\r\n                episodicLaserFocus: true, // Brief concentration moments\r\n                glowRadiusMult: 1.2,  // Expanded glow\r\n                // Breathing\r\n                breathRateMult: 1.2,  // Faster but controlled\r\n                breathDepthMult: 0.9, // Shallower, focused breaths\r\n                breathIrregular: false,\r\n            },\r\n            subdued: {\r\n                // Color - slightly muted\r\n                hueShift: -10,        // Slightly cooler\r\n                saturationMult: 0.75, // Somewhat muted\r\n                brightnessMult: 0.9,  // Slightly dimmed\r\n                // Visual\r\n                sizeMultiplier: 0.95, // Slightly smaller\r\n                jitterAmount: 0,\r\n                episodicWithdrawal: true, // Brief inward pulls\r\n                glowRadiusMult: 0.85, // Slightly reduced glow\r\n                // Breathing\r\n                breathRateMult: 0.9,  // Slightly slower\r\n                breathDepthMult: 0.9, // Slightly shallow\r\n                breathIrregular: false,\r\n            }\r\n        };\r\n        \r\n        // Performance\r\n        this.lastFrameTime = 0;\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Scale a value based on current canvas size vs reference size\r\n     * Used to scale hard-coded values like shadowBlur, lineWidth, etc.\r\n     * @param {number} value - The base value to scale\r\n     * @returns {number} The scaled value\r\n     */\r\n    scaleValue(value) {\r\n        return value * this.scaleFactor;\r\n    }\r\n    \r\n    /**\r\n     * Initialize offscreen canvas for double buffering\r\n     */\r\n    initOffscreenCanvas() {\r\n        // Create offscreen canvas\r\n        this.offscreenCanvas = document.createElement('canvas');\r\n        this.offscreenCtx = this.offscreenCanvas.getContext('2d', {\r\n            alpha: true,\r\n            desynchronized: true,  // Reduces latency\r\n            willReadFrequently: false\r\n        });\r\n        \r\n        if (!this.offscreenCtx) {\r\n        }\r\n        \r\n        // Match dimensions\r\n        this.updateOffscreenSize();\r\n    }\r\n    \r\n    /**\r\n     * Update offscreen canvas size to match main canvas\r\n     */\r\n    updateOffscreenSize() {\r\n        if (this.offscreenCanvas && this.canvasManager) {\r\n            const width = this.canvasManager.canvas.width;\r\n            const height = this.canvasManager.canvas.height;\r\n            \r\n            if (this.offscreenCanvas.width !== width || this.offscreenCanvas.height !== height) {\r\n                this.offscreenCanvas.width = width;\r\n                this.offscreenCanvas.height = height;\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Main render method\r\n     */\r\n    render(state, deltaTime, gestureTransform = null) {\r\n        // Performance marker: Frame start\r\n        if (this.performanceMonitor) {\r\n            this.performanceMonitor.markFrameStart();\r\n        }\r\n        const frameStartTime = performance.now();\r\n\r\n        // Handle forced clean render after tab switch\r\n        if (this.forceCleanRender) {\r\n            this.forceCleanRender = false;\r\n            // Clear any rendering artifacts\r\n            if (this.canvas && this.ctx) {\r\n                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n            }\r\n        }\r\n\r\n        // Get ambient dance transform and merge with gesture transform\r\n        const ambientTransform = this.ambientDanceAnimator.getTransform(deltaTime);\r\n        if (gestureTransform) {\r\n            // Merge transforms\r\n            gestureTransform.x = (gestureTransform.x || 0) + (ambientTransform.x || 0);\r\n            gestureTransform.y = (gestureTransform.y || 0) + (ambientTransform.y || 0);\r\n            gestureTransform.rotation = (gestureTransform.rotation || 0) + (ambientTransform.rotation || 0);\r\n            gestureTransform.scale = (gestureTransform.scale || 1) * (ambientTransform.scale || 1);\r\n        } else {\r\n            gestureTransform = ambientTransform;\r\n        }\r\n\r\n        // Store gestureTransform for use in other methods\r\n        this.gestureTransform = gestureTransform;\r\n\r\n        // Update offscreen canvas size if needed\r\n        this.updateOffscreenSize();\r\n        \r\n        // Get logical dimensions from canvasManager (not scaled by DPR)\r\n        const logicalWidth = this.canvasManager.width || this.canvas.width || 400;\r\n        const logicalHeight = this.canvasManager.height || this.canvas.height || 400;\r\n        \r\n        // Store original context and switch to offscreen for double buffering\r\n        const originalCtx = this.ctx;\r\n        this.ctx = this.offscreenCtx;\r\n        \r\n        // Clear offscreen canvas for fresh render\r\n        this.ctx.clearRect(0, 0, logicalWidth, logicalHeight);\r\n        \r\n        // Update undertone modifiers every frame during transitions\r\n        if (this.stateMachine && this.stateMachine.getWeightedUndertoneModifiers) {\r\n            const weightedModifier = this.stateMachine.getWeightedUndertoneModifiers();\r\n            if (weightedModifier) {\r\n                this.applyUndertoneModifiers(weightedModifier);\r\n            } else {\r\n                // Reset to defaults when no undertone\r\n                this.applyUndertoneModifiers(null);\r\n            }\r\n        }\r\n        \r\n        // Update color transition (if active)\r\n        if (this.colorTransition && this.colorTransition.active) {\r\n            this.updateColorTransition(deltaTime);\r\n        }\r\n        \r\n        // Update animation timers\r\n        this.updateTimers(deltaTime);\r\n        \r\n        // Update gaze offset\r\n        if (this.state.gazeTrackingEnabled) {\r\n            // When gaze tracking is enabled, follow mouse/touch\r\n            const smoothing = 0.15;\r\n            const maxOffset = 50; // Maximum pixels the orb can move\r\n            this.state.gazeOffset.x += (this.state.gazeTarget.x * maxOffset - this.state.gazeOffset.x) * smoothing;\r\n            this.state.gazeOffset.y += (this.state.gazeTarget.y * maxOffset - this.state.gazeOffset.y) * smoothing;\r\n        } else {\r\n            // When gaze tracking is disabled, return to center\r\n            const smoothing = 0.1;\r\n            this.state.gazeOffset.x += (0 - this.state.gazeOffset.x) * smoothing;\r\n            this.state.gazeOffset.y += (0 - this.state.gazeOffset.y) * smoothing;\r\n        }\r\n        \r\n        // Calculate dimensions - using logical size for proper scaling\r\n        const canvasSize = Math.min(logicalWidth, logicalHeight);\r\n        let centerX = logicalWidth / 2;\r\n        let centerY = logicalHeight / 2 - this.config.topOffset;\r\n        \r\n        // Apply vertical offset for certain emotions (like excited for exclamation mark)\r\n        if (state.properties && state.properties.verticalOffset) {\r\n            centerY = (logicalHeight / 2 - this.config.topOffset) + (logicalHeight * state.properties.verticalOffset);\r\n        }\r\n        \r\n        // Calculate global scale factor based on canvas size and baseScale config\r\n        this.scaleFactor = (canvasSize / this.config.referenceSize) * this.config.baseScale;\r\n        \r\n        // Apply gesture transform if present\r\n        let scaleMultiplier = 1;\r\n        let rotationAngle = 0;\r\n        let glowMultiplier = 1;\r\n        \r\n        if (gestureTransform) {\r\n            centerX += gestureTransform.x || 0;\r\n            centerY += gestureTransform.y || 0;\r\n            scaleMultiplier = gestureTransform.scale || 1;\r\n            rotationAngle = (gestureTransform.rotation || 0) * Math.PI / 180;\r\n            glowMultiplier = gestureTransform.glowIntensity || 1;\r\n        }\r\n\r\n        // Apply gesture animations (delegate to GestureAnimator)\r\n        const gestureTransforms = this.gestureAnimator.applyGestureAnimations();\r\n        if (gestureTransforms) {\r\n            centerX += gestureTransforms.offsetX || 0;\r\n            centerY += gestureTransforms.offsetY || 0;\r\n            scaleMultiplier *= gestureTransforms.scale || 1;\r\n            rotationAngle += (gestureTransforms.rotation || 0) * Math.PI / 180;\r\n            // DON'T MULTIPLY - just use the glow value directly to prevent accumulation\r\n            glowMultiplier = gestureTransforms.glow || 1;\r\n        }\r\n        \r\n        // Apply zen levitation - lazy floating when in zen state\r\n        if (this.state.emotion === 'zen' && this.zenTransition.phase === 'in') {\r\n            const time = Date.now() / 1000;\r\n            // Lazy vertical float - slow sine wave\r\n            const floatY = Math.sin(time * 0.3) * 15 * this.scaleFactor; // Very slow, 15px amplitude\r\n            // Gentle horizontal sway - even slower\r\n            const swayX = Math.sin(time * 0.2) * 8 * this.scaleFactor; // Subtle 8px sway\r\n            // Small rotation for ethereal effect\r\n            const floatRotation = Math.sin(time * 0.25) * 0.05; // ±3 degrees\r\n            \r\n            centerY += floatY;\r\n            centerX += swayX;\r\n            rotationAngle += floatRotation;\r\n        }\r\n        \r\n        // Apply sleep state modifications (with animated dimming)\r\n        let sleepOpacityMod = 1;\r\n        let sleepScaleMod = 1;\r\n        let glowOpacityMod = 1;\r\n        if (this.state.sleeping || this.state.emotion === 'resting' || isEffectActive('sleeping', this.state)) {\r\n            const sleepEffect = getEffect('sleeping');\r\n            if (sleepEffect) {\r\n                const dimming = sleepEffect.getDimmingValues();\r\n                // Use effect's dimming values\r\n                sleepOpacityMod = this.state.sleepDimness !== undefined ? this.state.sleepDimness : dimming.orbDimming;\r\n                glowOpacityMod = dimming.glowDimming; // Dim glow even more\r\n                sleepScaleMod = this.state.sleepScale !== undefined ? this.state.sleepScale : 0.9;\r\n            } else {\r\n                // Fallback values\r\n                sleepOpacityMod = this.state.sleepDimness !== undefined ? this.state.sleepDimness : 0.3;\r\n                glowOpacityMod = 0.2;\r\n                sleepScaleMod = this.state.sleepScale !== undefined ? this.state.sleepScale : 0.9;\r\n            }\r\n            this.state.breathRate = 0.5;  // Slower breathing\r\n            this.state.breathDepth = 0.15; // Deeper breaths\r\n        }\r\n        \r\n        // Calculate breathing factors - INVERSE for core and glow\r\n        // Use custom scale if set (for breathing exercises), otherwise use normal breathing\r\n        let coreBreathFactor, glowBreathFactor;\r\n        \r\n        if (this.state.customScale !== null) {\r\n            // Use custom scale directly for breathing exercises\r\n            coreBreathFactor = this.state.customScale;\r\n            glowBreathFactor = 1 + (this.state.customScale - 1) * 0.5; // Glow follows at half intensity\r\n        } else {\r\n            // Normal breathing behavior\r\n            // Zen uses full breath depth regardless of breathRate\r\n            const effectiveBreathDepth = this.state.emotion === 'zen' ? this.state.breathDepth : \r\n                                         this.state.breathDepth * this.state.breathRate;\r\n            // Get breathing scale from BreathingAnimator\r\n            const breathingScale = this.breathingAnimator.getBreathingScale();\r\n            coreBreathFactor = breathingScale;\r\n            glowBreathFactor = 1 - (breathingScale - 1) * 0.5; // Glow breathes opposite, less pronounced\r\n        }\r\n        \r\n        // Add nervous glow pulse if needed\r\n        if (this.state.undertone === 'nervous' && this.undertoneModifiers.nervous.glowPulse) {\r\n            const nervousPulse = Math.sin(Date.now() / 200) * this.undertoneModifiers.nervous.glowPulse; // Fast subtle pulse\r\n            glowBreathFactor *= (1 + nervousPulse);\r\n        }\r\n        \r\n        // Calculate core dimensions - using unified scale factor\r\n        const baseRadius = (this.config.referenceSize / this.config.coreSizeDivisor) * this.scaleFactor;\r\n        \r\n        // Apply emotion core size from state properties\r\n        const emotionSizeMult = (state.properties && state.properties.coreSize) ? state.properties.coreSize : 1.0;\r\n        \r\n        // Apply undertone size multiplier\r\n        const undertoneSizeMult = this.state.sizeMultiplier || 1.0;\r\n        \r\n        let coreRadius = baseRadius * emotionSizeMult * coreBreathFactor * scaleMultiplier * sleepScaleMod * undertoneSizeMult;\r\n        let glowRadius = baseRadius * this.config.glowMultiplier * glowBreathFactor * this.state.glowIntensity * scaleMultiplier * sleepScaleMod * undertoneSizeMult * glowMultiplier;  // Apply gesture glow multiplier\r\n\r\n        // Use state glow intensity directly multiplied by gesture glow\r\n        const effectiveGlowIntensity = this.state.glowIntensity * glowMultiplier;\r\n        \r\n        \r\n        // Apply blinking (only when not sleeping or zen)\r\n        if (!this.state.sleeping && this.state.emotion !== 'zen') {\r\n            const blinkScale = this.eyeRenderer.getBlinkScale();\r\n            coreRadius *= blinkScale; // Apply blink squish\r\n        }\r\n        \r\n        // Apply jitter if needed (anger, fear, or undertone jitter)\r\n        let jitterX = 0, jitterY = 0;\r\n        const jitterAmount = this.state.jitterAmount || 0;\r\n        \r\n        // Handle episodic effects for undertones\r\n        if (this.currentUndertone && this.episodicEffects[this.currentUndertone]) {\r\n            const episode = this.episodicEffects[this.currentUndertone];\r\n            const modifier = this.undertoneModifiers[this.currentUndertone];\r\n            const now = performance.now();\r\n            \r\n            // Check if it's time to trigger a new episode\r\n            if (!episode.active && now >= episode.nextTrigger) {\r\n                episode.active = true;\r\n                episode.startTime = now;\r\n                \r\n                // Set episode parameters based on undertone type\r\n                switch(this.currentUndertone) {\r\n                    case 'nervous':\r\n                        episode.duration = 500 + Math.random() * 500; // 0.5-1 second\r\n                        episode.intensity = 2 + Math.random(); // 2-3px flutter\r\n                        episode.nextTrigger = now + 3000 + Math.random() * 2000; // 3-5 seconds\r\n                        break;\r\n                    case 'confident':\r\n                        episode.duration = 1000 + Math.random() * 1000; // 1-2 seconds\r\n                        episode.intensity = 0.15; // 15% size expansion\r\n                        episode.nextTrigger = now + 4000 + Math.random() * 2000; // 4-6 seconds\r\n                        break;\r\n                    case 'tired':\r\n                        episode.duration = 1000 + Math.random() * 2000; // 1-3 seconds\r\n                        episode.intensity = 0.2; // 20% size reduction\r\n                        episode.nextTrigger = now + 5000 + Math.random() * 2000; // 5-7 seconds\r\n                        break;\r\n                    case 'intense':\r\n                        episode.duration = 500 + Math.random() * 500; // 0.5-1 second\r\n                        episode.intensity = 0.5; // 50% glow boost, 5% size shrink\r\n                        episode.nextTrigger = now + 3000 + Math.random() * 3000; // 3-6 seconds\r\n                        break;\r\n                    case 'subdued':\r\n                        episode.duration = 2000 + Math.random() * 1000; // 2-3 seconds\r\n                        episode.intensity = 0.3; // 30% glow dim, 10% size shrink\r\n                        episode.nextTrigger = now + 4000 + Math.random() * 3000; // 4-7 seconds\r\n                        break;\r\n                }\r\n            }\r\n            \r\n            // Apply episode effects if active\r\n            if (episode.active) {\r\n                const elapsed = now - episode.startTime;\r\n                \r\n                if (elapsed < episode.duration) {\r\n                    const progress = elapsed / episode.duration;\r\n                    \r\n                    // Apply different effects based on undertone\r\n                    switch(this.currentUndertone) {\r\n                        case 'nervous':\r\n                            // Quick shiver that settles\r\n                            const damping = 1 - progress;\r\n                            const frequency = 15;\r\n                            const flutter = Math.sin(progress * Math.PI * frequency) * damping;\r\n                            jitterX = flutter * episode.intensity;\r\n                            jitterY = flutter * episode.intensity * 0.7;\r\n                            break;\r\n                            \r\n                        case 'confident':\r\n                            // Smooth chest puff that settles\r\n                            const puffCurve = Math.sin(progress * Math.PI); // Smooth rise and fall\r\n                            coreRadius *= (1 + episode.intensity * puffCurve);\r\n                            glowRadius *= (1 + episode.intensity * 0.5 * puffCurve);\r\n                            break;\r\n                            \r\n                        case 'tired':\r\n                            // Drowsy sag with slow recovery\r\n                            const sagCurve = Math.sin(progress * Math.PI * 0.5); // Slow droop\r\n                            coreRadius *= (1 - episode.intensity * sagCurve);\r\n                            // Also affect vertical position slightly\r\n                            jitterY += sagCurve * 5; // Slight downward sag\r\n                            break;\r\n                            \r\n                        case 'intense':\r\n                            // Sharp contraction with glow surge\r\n                            const focusCurve = 1 - Math.cos(progress * Math.PI); // Quick in-out\r\n                            coreRadius *= (1 - 0.05 * focusCurve); // 5% shrink\r\n                            glowRadius *= (1 + episode.intensity * focusCurve); // 50% glow boost\r\n                            break;\r\n                            \r\n                        case 'subdued':\r\n                            // Gentle inward pull\r\n                            const withdrawCurve = Math.sin(progress * Math.PI * 0.5); // Slow pull\r\n                            coreRadius *= (1 - 0.1 * withdrawCurve); // 10% shrink\r\n                            glowRadius *= (1 - episode.intensity * withdrawCurve); // 30% glow dim\r\n                            break;\r\n                    }\r\n                } else {\r\n                    // Episode finished\r\n                    episode.active = false;\r\n                }\r\n            }\r\n        } else if (this.state.coreJitter || jitterAmount > 0) {\r\n            // Regular jitter for other emotions\r\n            const jitterStrength = Math.max(jitterAmount, this.state.coreJitter ? this.scaleValue(2) : 0);\r\n            jitterX = (Math.random() - 0.5) * jitterStrength;\r\n            jitterY = (Math.random() - 0.5) * jitterStrength;\r\n        }\r\n        \r\n        // Calculate positions with gaze offset\r\n        const coreX = centerX + this.state.gazeOffset.x + jitterX;\r\n        const coreY = centerY + this.state.gazeOffset.y + jitterY;\r\n        \r\n        // Check if brake is active and update rotation accordingly\r\n        const now = performance.now();\r\n\r\n        if (this.rotationBrake && this.rotationBrake.isBraking()) {\r\n            // Brake is active - let it control rotation\r\n            const brakeUpdate = this.rotationBrake.updateBrake(now);\r\n            if (brakeUpdate) {\r\n                this.state.manualRotation = brakeUpdate.rotation;\r\n                this.state.rotationSpeed = brakeUpdate.complete ? 0 : brakeUpdate.speed;\r\n            }\r\n        } else if (this.state.rotationSpeed !== 0) {\r\n            // Normal rotation update - just add velocity each frame (DEGREES)\r\n            this.state.manualRotation += this.state.rotationSpeed;\r\n        }\r\n\r\n        // Calculate total rotation (gestures + manual rotation)\r\n        // Convert manual rotation from degrees to radians for rendering\r\n        const totalRotation = rotationAngle + (this.state.manualRotation * Math.PI / 180);\r\n\r\n        // Apply rotation if present\r\n        if (totalRotation !== 0) {\r\n            this.ctx.save();\r\n            this.ctx.translate(coreX, coreY);\r\n            this.ctx.rotate(totalRotation);\r\n            this.ctx.translate(-coreX, -coreY);\r\n        }\r\n        \r\n        // Render glow with visual effects\r\n        if (isEffectActive('recording-glow', this.state)) {\r\n            // Recording takes precedence over normal glow\r\n            applyEffect('recording-glow', this.ctx, {\r\n                x: coreX,\r\n                y: coreY,\r\n                radius: glowRadius,\r\n                deltaTime\r\n            });\r\n        } else if (isEffectActive('zen-vortex', this.state)) {\r\n            // Zen vortex handles its own visuals\r\n            // Skip normal glow to prevent flash\r\n        } else {\r\n            // Normal glow with sleep dimming\r\n            if (this.state.sleeping || this.state.emotion === 'resting' || isEffectActive('sleeping', this.state)) {\r\n                this.ctx.save();\r\n                this.ctx.globalAlpha = glowOpacityMod;\r\n                this.glowRenderer.renderGlow(coreX, coreY, glowRadius, { intensity: effectiveGlowIntensity });\r\n                this.ctx.restore();\r\n            } else {\r\n                this.glowRenderer.renderGlow(coreX, coreY, glowRadius, { intensity: effectiveGlowIntensity });\r\n            }\r\n        }\r\n        \r\n        // Render flash wave if present\r\n        if (gestureTransforms && gestureTransforms.flashWave) {\r\n            const wave = gestureTransforms.flashWave;\r\n            const ctx = this.ctx;\r\n            \r\n            ctx.save();\r\n            ctx.globalCompositeOperation = 'lighter';\r\n            \r\n            // Create a ring gradient for the wave\r\n            const innerR = coreRadius * wave.innerRadius;\r\n            const outerR = coreRadius * wave.outerRadius;\r\n            \r\n            if (outerR > innerR) {\r\n                // Use cached gradient for flash wave\r\n                const gradient = gradientCache.getRadialGradient(\r\n                    ctx, coreX, coreY, innerR, coreX, coreY, outerR,\r\n                    [\r\n                        { offset: 0, color: 'rgba(255, 255, 255, 0)' },\r\n                        { offset: 0.2, color: `rgba(255, 255, 255, ${wave.intensity * 0.15})` },\r\n                        { offset: 0.5, color: `rgba(255, 255, 255, ${wave.intensity * 0.25})` }, // Peak in center\r\n                        { offset: 0.8, color: `rgba(255, 255, 255, ${wave.intensity * 0.15})` },\r\n                        { offset: 1, color: 'rgba(255, 255, 255, 0)' }\r\n                    ]\r\n                );\r\n\r\n                ctx.fillStyle = gradient;\r\n                ctx.beginPath();\r\n                ctx.arc(coreX, coreY, outerR, 0, Math.PI * 2);\r\n                ctx.arc(coreX, coreY, Math.max(0, innerR), 0, Math.PI * 2, true);\r\n                ctx.fill();\r\n            }\r\n            \r\n            ctx.restore();\r\n        }\r\n        \r\n        // Apply speaking pulse effect\r\n        if (isEffectActive('speaking-pulse', this.state)) {\r\n            applyEffect('speaking-pulse', this.ctx, {\r\n                x: coreX,\r\n                y: coreY,\r\n                radius: coreRadius,\r\n                audioLevel: this.state.audioLevel || 0,\r\n                deltaTime\r\n            });\r\n        }\r\n        \r\n        // Recording indicator will be drawn after all transforms are restored\r\n        \r\n        // Apply sleep opacity to core\r\n        if (this.state.sleeping || this.state.emotion === 'resting') {\r\n            this.ctx.globalAlpha = sleepOpacityMod;\r\n        }\r\n        \r\n        // Render core (will cover REC if they overlap)\r\n        // Delegate core rendering to CoreRenderer\r\n        // First update the shape morpher if available\r\n        let shapePoints = null;\r\n        let currentShadow = null;\r\n        if (this.shapeMorpher) {\r\n            this.shapeMorpher.update();\r\n            // Get the canvas points relative to center (0,0) since CoreRenderer will translate\r\n            shapePoints = this.shapeMorpher.getCanvasPoints(0, 0, coreRadius);\r\n            currentShadow = this.shapeMorpher.getCurrentShadow();\r\n        }\r\n        \r\n        // Render sun effects BEFORE core (so they appear behind)\r\n        let renderingSunEffects = false;\r\n        if (currentShadow && (currentShadow.type === 'sun' || currentShadow.type === 'solar-hybrid')) {\r\n            this.renderSunEffects(coreX, coreY, coreRadius, currentShadow);\r\n            renderingSunEffects = true;\r\n        }\r\n        \r\n        // Drop shadow removed - was causing dimming\r\n        \r\n        // Update core rotation based on BPM (like a record player)\r\n        // Only rotate if BPM is greater than 0 (rhythm is active)\r\n        // Shapes that should NOT rotate: moon, heart\r\n        \r\n        // Render the core shape with rotation\r\n        // Note: We already applied rotation to the canvas, but CoreRenderer does its own transform\r\n        // So we need to pass the rotation value to it\r\n        this.coreRenderer.renderCore(coreX, coreY, coreRadius, {\r\n            scaleX: 1,\r\n            scaleY: 1,\r\n            rotation: totalRotation,\r\n            shapePoints: shapePoints\r\n        });\r\n        \r\n        // Update and render sparkles BEFORE moon shadow so they don't cover it\r\n        if (this.specialEffects) {\r\n            this.specialEffects.update(deltaTime);\r\n            this.specialEffects.renderSparkles();\r\n        }\r\n        \r\n        // Check if we're dealing with solar transitions\r\n        const currentShape = this.shapeMorpher ? this.shapeMorpher.currentShape : null;\r\n        const targetShape = this.shapeMorpher ? this.shapeMorpher.targetShape : null;\r\n        const isTransitioningToSolar = this.shapeMorpher && targetShape === 'solar' && this.shapeMorpher.isTransitioning;\r\n        const isTransitioningFromSolar = this.shapeMorpher && currentShape === 'solar' && this.shapeMorpher.isTransitioning;\r\n        const isAtSolar = currentShadow && currentShadow.type === 'solar-hybrid';\r\n        \r\n        // Check specific transition directions\r\n        const isSolarToMoon = this.shapeMorpher && this.shapeMorpher.isTransitioning &&\r\n            currentShape === 'solar' && targetShape === 'moon';\r\n        const isMoonToSolar = this.shapeMorpher && this.shapeMorpher.isTransitioning &&\r\n            currentShape === 'moon' && targetShape === 'solar';\r\n        \r\n        // Render moon/lunar shadows AFTER core AND sparkles (as top overlay)\r\n        // Always render moon shadow EXCEPT when transitioning FROM moon TO solar\r\n        if (currentShadow && (currentShadow.type === 'crescent' || currentShadow.type === 'lunar') && \r\n            !isMoonToSolar) {\r\n            // Shadow is rendered in the already-rotated coordinate space\r\n            this.renderMoonShadow(coreX, coreY, coreRadius, currentShadow, shapePoints, false, 0);\r\n        }\r\n        \r\n        // For solar-hybrid, render lunar overlay on top of sun\r\n        // Skip when transitioning FROM solar TO moon (let moon's shadow handle it)\r\n        if (((isAtSolar && currentShadow.lunarOverlay) || isTransitioningToSolar || isTransitioningFromSolar) && \r\n            !isSolarToMoon) {\r\n            // Use the lunar overlay from solar definition\r\n            const lunarShadow = (isAtSolar && currentShadow.lunarOverlay) ? currentShadow.lunarOverlay : {\r\n                type: 'lunar',\r\n                coverage: 1.0,\r\n                color: 'rgba(0, 0, 0, 1.0)',\r\n                progression: 'center'\r\n            };\r\n            \r\n            // Calculate shadow offset for Bailey's Beads\r\n            let shadowOffsetX = 0;\r\n            let shadowOffsetY = 0;\r\n            let morphProgress = 0;\r\n            \r\n            if (this.shapeMorpher) {\r\n                morphProgress = this.shapeMorpher.getProgress();\r\n                const currentShape = this.shapeMorpher.currentShape;\r\n                const targetShape = this.shapeMorpher.targetShape;\r\n                const fromLunar = currentShape === 'lunar' || currentShape === 'eclipse';\r\n                const toLunar = targetShape === 'lunar' || targetShape === 'eclipse';\r\n                \r\n                const slideDistance = coreRadius * 2.5;\r\n                \r\n                if (isTransitioningToSolar && morphProgress < 1) {\r\n                    // Shadow sliding in from bottom-left\r\n                    shadowOffsetX = -slideDistance * (1 - morphProgress);\r\n                    shadowOffsetY = slideDistance * (1 - morphProgress);\r\n                } else if (isTransitioningFromSolar && morphProgress < 1) {\r\n                    // Shadow sliding out to top-right\r\n                    shadowOffsetX = slideDistance * morphProgress;\r\n                    shadowOffsetY = -slideDistance * morphProgress;\r\n                }\r\n            }\r\n            \r\n            // Render the shadow\r\n            this.renderMoonShadow(coreX, coreY, coreRadius, lunarShadow, shapePoints, true);\r\n            \r\n            // Render Bailey's Beads during transitions\r\n            // Show beads when transitioning TO solar (which will have rays) or FROM solar (which had rays)\r\n            // But only if we're actually rendering or about to render sun effects\r\n            const willHaveSunEffects = isTransitioningToSolar || renderingSunEffects;\r\n            \r\n            if ((isTransitioningToSolar || isTransitioningFromSolar) && willHaveSunEffects) {\r\n                this.renderBaileysBeads(coreX, coreY, coreRadius, shadowOffsetX, shadowOffsetY, morphProgress, isTransitioningToSolar, true);\r\n                \r\n                // Trigger chromatic aberration when shadow is near center\r\n                const shadowNearCenter = Math.abs(shadowOffsetX) < 30 && Math.abs(shadowOffsetY) < 30;\r\n                if (shadowNearCenter && this.specialEffects) {\r\n                    // Stronger aberration as shadow gets closer to center\r\n                    const distance = Math.sqrt(shadowOffsetX * shadowOffsetX + shadowOffsetY * shadowOffsetY);\r\n                    const intensity = Math.max(0.1, 0.5 * (1 - distance / 30));\r\n                    this.specialEffects.triggerChromaticAberration(intensity);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Reset alpha\r\n        if (this.state.sleeping || this.state.emotion === 'resting') {\r\n            this.ctx.globalAlpha = 1;\r\n        }\r\n        \r\n        // Restore context if rotated\r\n        if (totalRotation !== 0) {\r\n            this.ctx.restore();\r\n        }\r\n        \r\n        // Recording indicator is now handled by the recording-glow effect module\r\n        // which draws a small indicator in the corner\r\n        \r\n        // Add sleep indicator if sleeping\r\n        if (this.state.sleeping) {\r\n            this.renderSleepIndicator(centerX, centerY - glowRadius - this.scaleValue(20), deltaTime);\r\n        }\r\n        \r\n        // Restore original context AFTER all rendering is done\r\n        this.ctx = originalCtx;\r\n        \r\n        // Simple blit - chromatic aberration is now handled via CSS filters\r\n        originalCtx.drawImage(this.offscreenCanvas, 0, 0);\r\n        \r\n        // Draw recording indicator on TOP of everything, with no transforms\r\n        if (isEffectActive('recording-glow', this.state)) {\r\n            const recordingEffect = getEffect('recording-glow');\r\n            if (recordingEffect && recordingEffect.drawRecordingIndicator) {\r\n                // Use original context to draw on top of the blitted image\r\n                recordingEffect.drawRecordingIndicator(originalCtx, this.canvas.width, this.canvas.height);\r\n            }\r\n        }\r\n\r\n        // Performance marker: Frame end\r\n        const frameEndTime = performance.now();\r\n        const frameTime = frameEndTime - frameStartTime;\r\n        if (this.performanceMonitor) {\r\n            this.performanceMonitor.markFrameEnd();\r\n            this.performanceMonitor.recordFrameTime(frameTime);\r\n        }\r\n    }\r\n    \r\n    // renderGlow method removed - now handled by GlowRenderer module\r\n    \r\n    // getCachedGlow method removed - now handled by GlowRenderer module\r\n    \r\n    /**\r\n     * Render recording glow (pulsating red)\r\n     */\r\n    renderRecordingGlow(x, y, radius, intensity) {\r\n        // Get canvas dimensions with fallbacks\r\n        const canvasWidth = this.canvas?.width || 600;\r\n        const canvasHeight = this.canvas?.height || 600;\r\n        \r\n        // Limit radius to prevent clipping at canvas boundaries\r\n        const maxRadius = Math.min(radius, \r\n            x - 10,  // Distance to left edge\r\n            y - 10,  // Distance to top edge\r\n            canvasWidth - x - 10,  // Distance to right edge\r\n            canvasHeight - y - 10  // Distance to bottom edge\r\n        );\r\n        const safeRadius = Math.max(50, maxRadius); // Ensure minimum radius\r\n        \r\n        // Use cached gradient for the recording glow\r\n        const gradient = gradientCache.getRadialGradient(\r\n            this.ctx, x, y, 0, x, y, safeRadius,\r\n            [\r\n                { offset: 0, color: this.hexToRgba('#FF0000', 0.7 * intensity) },\r\n                { offset: 0.3, color: this.hexToRgba('#FF0000', 0.5 * intensity) },\r\n                { offset: 0.6, color: this.hexToRgba('#FF0000', 0.3 * intensity) },\r\n                { offset: 0.85, color: this.hexToRgba('#FF0000', 0.1 * intensity) }, // Fade earlier\r\n                { offset: 1, color: this.hexToRgba('#FF0000', 0) }\r\n            ]\r\n        );\r\n        \r\n        // Draw the recording glow\r\n        this.ctx.fillStyle = gradient;\r\n        this.ctx.beginPath();\r\n        this.ctx.arc(x, y, safeRadius, 0, Math.PI * 2);\r\n        this.ctx.fill();\r\n    }\r\n    \r\n\r\n    /**\r\n     * Render drop shadow for depth\r\n     */\r\n    renderDropShadow(x, y, radius, shapePoints) {\r\n        const ctx = this.ctx;\r\n        \r\n        // Skip shadow during rapid animations for better performance\r\n        const isAnimating = this.shapeMorpher && this.shapeMorpher.isTransitioning;\r\n        const hasAudioDeformation = this.shapeMorpher && \r\n                                   (this.shapeMorpher.audioDeformation > 0.1 || \r\n                                    this.shapeMorpher.vocalEnergy > 0.1);\r\n        \r\n        if (!hasAudioDeformation && (!isAnimating || this.shapeMorpher.morphProgress > 0.8)) {\r\n            ctx.save();\r\n            ctx.translate(x, y);\r\n            \r\n            const shadowOffset = this.scaleValue(2);\r\n            ctx.translate(0, shadowOffset);\r\n            \r\n            // Use simpler shadow for complex deformed shapes\r\n            if (shapePoints && shapePoints.length > 32) {\r\n                // Simple dark circle shadow when shape is complex\r\n                ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';\r\n                ctx.beginPath();\r\n                ctx.arc(0, 0, radius * 1.05, 0, Math.PI * 2);\r\n                ctx.fill();\r\n            } else {\r\n                // Shadow gradient - dark center fading to transparent\r\n                const shadowGradient = ctx.createRadialGradient(0, 0, radius * 0.7, 0, 0, radius * 1.2);\r\n                shadowGradient.addColorStop(0, 'rgba(0, 0, 0, 0.2)');\r\n                shadowGradient.addColorStop(0.8, 'rgba(0, 0, 0, 0.1)');\r\n                shadowGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\r\n                \r\n                ctx.fillStyle = shadowGradient;\r\n                ctx.beginPath();\r\n                if (shapePoints) {\r\n                    // Scale points for shadow\r\n                    const scale = 1.1;\r\n                    const step = shapePoints.length > 20 ? 2 : 1; // Skip points for performance\r\n                    ctx.moveTo(shapePoints[0].x * scale, shapePoints[0].y * scale);\r\n                    for (let i = step; i < shapePoints.length; i += step) {\r\n                        ctx.lineTo(shapePoints[i].x * scale, shapePoints[i].y * scale);\r\n                    }\r\n                    ctx.closePath();\r\n                } else {\r\n                    ctx.arc(0, 0, radius * 1.1, 0, Math.PI * 2);\r\n                }\r\n                ctx.fill();\r\n            }\r\n            ctx.restore();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Render sun effects (corona, rays, etc)\r\n     */\r\n    renderSunEffects(x, y, radius, shadow) {\r\n        const ctx = this.ctx;\r\n        const time = Date.now() / 100;\r\n        \r\n        ctx.save();\r\n        ctx.translate(x, y);\r\n        \r\n        // 1. Surface texture - turbulent plasma\r\n        if (shadow.texture && (shadow.textureOpacity === undefined || shadow.textureOpacity > 0)) {\r\n            ctx.save();\r\n            ctx.globalCompositeOperation = 'screen';\r\n            ctx.globalAlpha = shadow.textureOpacity !== undefined ? shadow.textureOpacity : 1;\r\n            \r\n            const offset = time * 0.05 * (shadow.turbulence || 0.3) / 0.3;\r\n            const textureGradient = ctx.createRadialGradient(\r\n                Math.sin(offset) * radius * 0.15,\r\n                Math.cos(offset * 0.7) * radius * 0.15,\r\n                radius * 0.2,\r\n                0, 0, radius\r\n            );\r\n            textureGradient.addColorStop(0, 'rgba(255, 255, 200, 0)');\r\n            textureGradient.addColorStop(0.4, 'rgba(255, 200, 100, 0.1)');\r\n            textureGradient.addColorStop(0.7, 'rgba(255, 150, 50, 0.08)');\r\n            textureGradient.addColorStop(1, 'rgba(255, 100, 30, 0.05)');\r\n            \r\n            ctx.fillStyle = textureGradient;\r\n            ctx.beginPath();\r\n            ctx.arc(0, 0, radius, 0, Math.PI * 2);\r\n            ctx.fill();\r\n            \r\n            ctx.restore();\r\n        }\r\n        \r\n        // 2. Bright corona layers\r\n        const coronaOpacity = shadow.coronaOpacity !== undefined ? shadow.coronaOpacity : 1;\r\n        if (coronaOpacity > 0) {\r\n            ctx.save();\r\n            ctx.globalCompositeOperation = 'screen';\r\n            \r\n            // Inner bright glow\r\n            const innerGlow = ctx.createRadialGradient(0, 0, radius * 0.5, 0, 0, radius * 1.1);\r\n            innerGlow.addColorStop(0, `rgba(255, 255, 255, ${0.8 * coronaOpacity})`);\r\n            innerGlow.addColorStop(0.3, `rgba(255, 250, 200, ${0.6 * coronaOpacity})`);\r\n            innerGlow.addColorStop(0.5, `rgba(255, 200, 100, ${0.4 * coronaOpacity})`);\r\n            innerGlow.addColorStop(0.7, `rgba(255, 150, 50, ${0.2 * coronaOpacity})`);\r\n            innerGlow.addColorStop(1, 'rgba(255, 100, 20, 0)');\r\n            \r\n            ctx.fillStyle = innerGlow;\r\n            ctx.beginPath();\r\n            ctx.arc(0, 0, radius * 1.1, 0, Math.PI * 2);\r\n            ctx.fill();\r\n            \r\n            // Outer corona with animation\r\n            for (let i = 0; i < 2; i++) {\r\n                const scale = 1.3 + i * 0.4;\r\n                const opacity = (0.35 - i * 0.15) * coronaOpacity;\r\n                const wobble = Math.sin(time * 0.1 + i) * 0.05;\r\n                \r\n                const coronaGradient = ctx.createRadialGradient(\r\n                    0, 0, radius * (0.9 + wobble), \r\n                    0, 0, radius * (scale + wobble)\r\n                );\r\n                coronaGradient.addColorStop(0, 'rgba(255, 255, 200, 0)');\r\n                coronaGradient.addColorStop(0.4, `rgba(255, 200, 100, ${opacity * 0.5})`);\r\n                coronaGradient.addColorStop(0.7, `rgba(255, 150, 50, ${opacity})`);\r\n                coronaGradient.addColorStop(0.9, `rgba(255, 100, 30, ${opacity * 0.5})`);\r\n                coronaGradient.addColorStop(1, 'rgba(255, 50, 10, 0)');\r\n                \r\n                ctx.fillStyle = coronaGradient;\r\n                ctx.beginPath();\r\n                ctx.arc(0, 0, radius * (scale + wobble), 0, Math.PI * 2);\r\n                ctx.fill();\r\n            }\r\n            \r\n            ctx.restore();\r\n        }\r\n        \r\n        // 3. Optimized ethereal flame pennants - TONS of rays\r\n        if (shadow.flares) {\r\n            ctx.save();\r\n            \r\n            // Pre-calculate common values\r\n            const wave1 = Math.sin(time * 0.08);\r\n            const wave2 = Math.sin(time * 0.12);\r\n            const wave3 = Math.sin(time * 0.16);\r\n            \r\n            // Create single gradient for all flames\r\n            const grad = ctx.createLinearGradient(0, -radius, 0, -radius * 3);\r\n            grad.addColorStop(0, 'rgba(255, 255, 230, 0.4)');\r\n            grad.addColorStop(0.2, 'rgba(255, 220, 150, 0.25)');\r\n            grad.addColorStop(0.5, 'rgba(255, 180, 80, 0.15)');\r\n            grad.addColorStop(0.8, 'rgba(255, 120, 40, 0.08)');\r\n            grad.addColorStop(1, 'rgba(255, 60, 20, 0)');\r\n            \r\n            ctx.fillStyle = grad;\r\n            ctx.globalCompositeOperation = 'screen';\r\n            \r\n            // Single path for ALL flames\r\n            ctx.beginPath();\r\n            \r\n            // Helper function for flame shape\r\n            const addFlame = (angle, length, width, wave) => {\r\n                const cos = Math.cos(angle);\r\n                const sin = Math.sin(angle);\r\n                const baseX = cos * radius;\r\n                const baseY = sin * radius;\r\n                const tipX = cos * (radius + length);\r\n                const tipY = sin * (radius + length);\r\n                const perpX = -sin * width * 0.5;\r\n                const perpY = cos * width * 0.5;\r\n                const waveOffset = wave * width * 0.3;\r\n                \r\n                // Simple triangle with slight curve\r\n                ctx.moveTo(baseX - perpX, baseY - perpY);\r\n                ctx.quadraticCurveTo(\r\n                    (baseX + tipX) * 0.5 + perpX * waveOffset,\r\n                    (baseY + tipY) * 0.5 + perpY * waveOffset,\r\n                    tipX, tipY\r\n                );\r\n                ctx.quadraticCurveTo(\r\n                    (baseX + tipX) * 0.5 - perpX * waveOffset,\r\n                    (baseY + tipY) * 0.5 - perpY * waveOffset,\r\n                    baseX + perpX, baseY + perpY\r\n                );\r\n            };\r\n            \r\n            // Layer 1: Long primary rays (8)\r\n            for (let i = 0; i < 8; i++) {\r\n                const angle = (i / 8) * Math.PI * 2 + wave1 * 0.1;\r\n                const length = radius * (1.8 + Math.sin(time * 0.1 + i * 0.5) * 0.4);\r\n                const width = radius * 0.18;\r\n                const wave = Math.sin(time * 0.15 + i);\r\n                addFlame(angle, length, width, wave);\r\n            }\r\n            \r\n            // Layer 2: Medium rays between primaries (12)\r\n            for (let i = 0; i < 12; i++) {\r\n                const angle = ((i + 0.5) / 12) * Math.PI * 2 + wave2 * 0.08;\r\n                const length = radius * (1.2 + Math.sin(time * 0.13 + i * 0.7) * 0.3);\r\n                const width = radius * 0.12;\r\n                const wave = Math.sin(time * 0.18 + i * 1.2);\r\n                addFlame(angle, length, width, wave);\r\n            }\r\n            \r\n            // Layer 3: Short rays filling gaps (15)\r\n            for (let i = 0; i < 15; i++) {\r\n                const angle = (i / 15) * Math.PI * 2 + wave3 * 0.05;\r\n                const length = radius * (0.7 + Math.sin(time * 0.17 + i * 0.9) * 0.25);\r\n                const width = radius * 0.08;\r\n                const wave = Math.sin(time * 0.2 + i * 1.5);\r\n                addFlame(angle, length, width, wave);\r\n            }\r\n            \r\n            // Layer 4: Tiny rays for density (15)\r\n            for (let i = 0; i < 15; i++) {\r\n                const angle = ((i + 0.25) / 15) * Math.PI * 2;\r\n                const length = radius * (0.4 + Math.sin(time * 0.22 + i) * 0.2);\r\n                const width = radius * 0.06;\r\n                // Simple triangles for tiny rays\r\n                const cos = Math.cos(angle);\r\n                const sin = Math.sin(angle);\r\n                const baseX = cos * radius;\r\n                const baseY = sin * radius;\r\n                const tipX = cos * (radius + length);\r\n                const tipY = sin * (radius + length);\r\n                const perpX = -sin * width * 0.5;\r\n                const perpY = cos * width * 0.5;\r\n                \r\n                ctx.moveTo(baseX - perpX, baseY - perpY);\r\n                ctx.lineTo(tipX, tipY);\r\n                ctx.lineTo(baseX + perpX, baseY + perpY);\r\n            }\r\n            \r\n            // Single fill operation for all rays!\r\n            ctx.fill();\r\n            ctx.restore();\r\n        }\r\n        \r\n        // 4. Bright rim lighting\r\n        const rimGradient = ctx.createRadialGradient(0, 0, radius * 0.95, 0, 0, radius * 1.05);\r\n        rimGradient.addColorStop(0, 'rgba(255, 255, 255, 0)');\r\n        rimGradient.addColorStop(0.7, 'rgba(255, 255, 200, 0.2)');\r\n        rimGradient.addColorStop(0.9, 'rgba(255, 200, 100, 0.5)');\r\n        rimGradient.addColorStop(1, 'rgba(255, 150, 50, 0.3)');\r\n        \r\n        ctx.fillStyle = rimGradient;\r\n        ctx.beginPath();\r\n        ctx.arc(0, 0, radius * 1.05, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        \r\n        ctx.restore();\r\n    }\r\n    \r\n    /**\r\n     * Render Bailey's Beads for solar eclipse\r\n     */\r\n    renderBaileysBeads(x, y, radius, shadowOffsetX, shadowOffsetY, morphProgress, isTransitioningToSolar, hasSunRays) {\r\n        const ctx = this.ctx;\r\n        \r\n        // NEVER show beads if there are no sun rays visible\r\n        if (!hasSunRays) {\r\n            this._beadStartTime = null;\r\n            return;\r\n        }\r\n        \r\n        // Check if this is a lunar-solar transition (shadow stays centered)\r\n        const isLunarSolarTransition = Math.abs(shadowOffsetX) < 1 && Math.abs(shadowOffsetY) < 1;\r\n        \r\n        // Show beads when shadow is approaching center OR for lunar-solar transitions\r\n        // Different thresholds for entering vs leaving\r\n        const threshold = isTransitioningToSolar ? 30 : 15; // Disappear faster when leaving\r\n        const shadowNearCenter = Math.abs(shadowOffsetX) < threshold && Math.abs(shadowOffsetY) < threshold;\r\n        \r\n        if (!shadowNearCenter && !isLunarSolarTransition) {\r\n            // Reset when not near center (unless it's lunar-solar)\r\n            this._beadStartTime = null;\r\n            return;\r\n        }\r\n        \r\n        // Generate different beads for entering vs leaving\r\n        const beadKey = isTransitioningToSolar ? 'entering' : 'leaving';\r\n        \r\n        // Check if we need to generate new beads (first time shadow centers for this transition)\r\n        if (!this._beadStartTime) {\r\n            const beadCount = Math.floor(Math.random() * 4) + 1; // 1-4 beads\r\n            \r\n            this._currentBeads = [];\r\n            \r\n            // Create beads with random order\r\n            const angles = [];\r\n            for (let i = 0; i < beadCount; i++) {\r\n                angles.push(Math.random() * Math.PI * 2);\r\n            }\r\n            \r\n            // Shuffle the order they'll appear\r\n            const order = Array.from({length: beadCount}, (_, i) => i);\r\n            for (let i = order.length - 1; i > 0; i--) {\r\n                const j = Math.floor(Math.random() * (i + 1));\r\n                [order[i], order[j]] = [order[j], order[i]];\r\n            }\r\n            \r\n            for (let i = 0; i < beadCount; i++) {\r\n                this._currentBeads.push({\r\n                    angle: angles[i],\r\n                    size: 3 + Math.random() * 5, // Random size 3-8\r\n                    order: order[i], // Order in sequence\r\n                    delay: order[i] * 200 // 200ms between each bead\r\n                });\r\n            }\r\n            \r\n            this._beadStartTime = Date.now();\r\n        }\r\n        \r\n        const elapsedTime = Date.now() - this._beadStartTime;\r\n        \r\n        // Render the beads as chromatic lens flares (one at a time)\r\n        const beads = this._currentBeads || [];\r\n        \r\n        beads.forEach(bead => {\r\n            // Check if this bead should be visible yet\r\n            if (elapsedTime < bead.delay) return;\r\n            \r\n            // Calculate fade in (300ms fade)\r\n            const beadAge = elapsedTime - bead.delay;\r\n            const fadeInDuration = 300;\r\n            const opacity = Math.min(1, beadAge / fadeInDuration);\r\n            \r\n            // Calculate bead position on the edge of the sun (not shadow)\r\n            const beadX = x + Math.cos(bead.angle) * radius;\r\n            const beadY = y + Math.sin(bead.angle) * radius;\r\n            \r\n            ctx.save();\r\n            ctx.translate(beadX, beadY);\r\n            ctx.globalAlpha = opacity;\r\n            \r\n            // Draw chromatic aberration lens flare\r\n            const size = this.scaleValue(bead.size);\r\n            \r\n            // Chromatic layers - RGB separated for aberration effect\r\n            const colors = [\r\n                { color: `rgba(255, 100, 100, ${0.6 * opacity})`, offset: -2 },  // Red\r\n                { color: `rgba(100, 255, 100, ${0.6 * opacity})`, offset: 0 },   // Green  \r\n                { color: `rgba(100, 100, 255, ${0.6 * opacity})`, offset: 2 }    // Blue\r\n            ];\r\n            \r\n            ctx.globalCompositeOperation = 'screen';\r\n            \r\n            colors.forEach(({ color, offset }) => {\r\n                // Create radial gradient for each color channel\r\n                const gradient = ctx.createRadialGradient(\r\n                    offset, offset, 0,\r\n                    offset, offset, size * 2\r\n                );\r\n                \r\n                gradient.addColorStop(0, color);\r\n                gradient.addColorStop(0.2, color.replace(`${0.6 * opacity}`, `${0.4 * opacity}`));\r\n                gradient.addColorStop(0.5, color.replace(`${0.6 * opacity}`, `${0.2 * opacity}`));\r\n                gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');\r\n                \r\n                ctx.fillStyle = gradient;\r\n                ctx.beginPath();\r\n                ctx.arc(offset, offset, size * 2, 0, Math.PI * 2);\r\n                ctx.fill();\r\n            });\r\n            \r\n            // Add bright white core\r\n            ctx.globalCompositeOperation = 'lighter';\r\n            const coreGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, size);\r\n            coreGradient.addColorStop(0, `rgba(255, 255, 255, ${opacity})`);\r\n            coreGradient.addColorStop(0.3, `rgba(255, 255, 255, ${0.5 * opacity})`);\r\n            coreGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');\r\n            \r\n            ctx.fillStyle = coreGradient;\r\n            ctx.beginPath();\r\n            ctx.arc(0, 0, size, 0, Math.PI * 2);\r\n            ctx.fill();\r\n            \r\n            ctx.restore();\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Render moon/lunar shadow overlay\r\n     * @param {boolean} isSolarOverlay - True if this is being called for solar eclipse effect\r\n     * @param {number} rotation - Rotation angle to apply\r\n     */\r\n    renderMoonShadow(x, y, radius, shadow, shapePoints, isSolarOverlay = false, rotation = 0) {\r\n        const ctx = this.ctx;\r\n        \r\n        ctx.save();\r\n        ctx.translate(x, y);\r\n        \r\n        // Don't apply rotation - we're already in rotated coordinate space\r\n        \r\n        if (shadow.type === 'crescent') {\r\n            // Crescent moon - smooth shadow without pixelation\r\n            \r\n            // Get morph progress to animate the shadow sliding in\r\n            let shadowProgress = 1.0; // Default to fully visible\r\n            let animatedOffset = shadow.offset || 0.7; // Default to the shadow's offset\r\n            \r\n            if (this.shapeMorpher) {\r\n                const morphProgress = this.shapeMorpher.getProgress();\r\n                const currentShape = this.shapeMorpher.currentShape;\r\n                const targetShape = this.shapeMorpher.targetShape;\r\n                \r\n                // Animate shadow sliding in when morphing TO moon (and shadow.offset is not being controlled)\r\n                if (targetShape === 'moon' && morphProgress !== undefined && morphProgress < 1 && !shadow.shadowX) {\r\n                    // Shadow slides in from the left\r\n                    shadowProgress = morphProgress;\r\n                    const baseOffset = 0.7;\r\n                    // Animate the offset - starts far left (-2) and slides to final position\r\n                    animatedOffset = -2 + (baseOffset + 2) * shadowProgress;\r\n                }\r\n                // FROM MOON TO ANY SHAPE - ShapeMorpher is already controlling via shadow.offset\r\n                // so we just use whatever offset is provided in the shadow object\r\n            }\r\n            // Calculate shadow offset - shadow rotates with the moon\r\n            const angleRad = (shadow.angle || -30) * Math.PI / 180;\r\n            const offsetX = Math.cos(angleRad) * radius * animatedOffset;\r\n            const offsetY = Math.sin(angleRad) * radius * animatedOffset;\r\n            \r\n            // Enable high quality rendering\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality = 'high';\r\n            \r\n            // Clip to the moon shape\r\n            ctx.beginPath();\r\n            if (shapePoints) {\r\n                ctx.moveTo(shapePoints[0].x, shapePoints[0].y);\r\n                for (let i = 1; i < shapePoints.length; i++) {\r\n                    ctx.lineTo(shapePoints[i].x, shapePoints[i].y);\r\n                }\r\n                ctx.closePath();\r\n            } else {\r\n                ctx.arc(0, 0, radius, 0, Math.PI * 2);\r\n            }\r\n            ctx.clip();\r\n            \r\n            // Use a single smooth gradient for the entire shadow\r\n            const shadowGradient = ctx.createRadialGradient(\r\n                offsetX, offsetY, radius * 0.9,\r\n                offsetX, offsetY, radius * 1.1\r\n            );\r\n            \r\n            // More gradient stops for smoother transition\r\n            // Also fade opacity based on shadowProgress for smoother appearance\r\n            const baseCoverage = shadow.coverage !== undefined ? shadow.coverage : 0.85;\r\n            const shadowOpacity = Math.min(1, shadowProgress * 1.2) * (baseCoverage / 0.85);\r\n            shadowGradient.addColorStop(0, `rgba(0, 0, 0, ${1 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.80, `rgba(0, 0, 0, ${1 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.88, `rgba(0, 0, 0, ${0.98 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.91, `rgba(0, 0, 0, ${0.95 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.93, `rgba(0, 0, 0, ${0.9 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.95, `rgba(0, 0, 0, ${0.8 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.96, `rgba(0, 0, 0, ${0.65 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.97, `rgba(0, 0, 0, ${0.45 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.98, `rgba(0, 0, 0, ${0.25 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(0.99, `rgba(0, 0, 0, ${0.1 * shadowOpacity})`);\r\n            shadowGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\r\n            \r\n            ctx.fillStyle = shadowGradient;\r\n            ctx.beginPath();\r\n            // Always use a circular shadow - crescent effect only works with circles\r\n            ctx.arc(offsetX, offsetY, radius * 1.1, 0, Math.PI * 2);\r\n            ctx.fill();\r\n            \r\n        } else if (shadow.type === 'lunar') {\r\n            // Lunar eclipse - diffuse reddish shadow\r\n            const diffusion = shadow.diffusion !== undefined ? shadow.diffusion : 1;\r\n            const sharpness = 1 - diffusion;\r\n            \r\n            // Get morph progress to animate the shadow sliding in for solar\r\n            let shadowOffsetX = 0;\r\n            let shadowOffsetY = 0;\r\n            \r\n            if (this.shapeMorpher) {\r\n                const morphProgress = this.shapeMorpher.getProgress();\r\n                const currentShape = this.shapeMorpher.currentShape;\r\n                const targetShape = this.shapeMorpher.targetShape;\r\n                \r\n                // Don't skip animation for moon-solar transitions anymore\r\n                \r\n                // Animate shadow sliding in when morphing TO solar (for solar overlay)\r\n                if (isSolarOverlay && targetShape === 'solar' && morphProgress !== undefined && morphProgress < 1) {\r\n                    // Shadow slides in from bottom-left\r\n                    const slideDistance = radius * 2.5;\r\n                    // Start from bottom-left, move to center\r\n                    shadowOffsetX = -slideDistance * (1 - morphProgress);\r\n                    shadowOffsetY = slideDistance * (1 - morphProgress);\r\n                }\r\n                // Animate shadow sliding out when morphing FROM solar\r\n                else if (isSolarOverlay && currentShape === 'solar' && targetShape !== 'solar' && targetShape !== null && morphProgress !== undefined && morphProgress < 1) {\r\n                    // Shadow slides out to top-right\r\n                    const slideDistance = radius * 2.5;\r\n                    // Move from center to top-right\r\n                    shadowOffsetX = slideDistance * morphProgress;\r\n                    shadowOffsetY = -slideDistance * morphProgress;\r\n                }\r\n            }\r\n            \r\n            // Apply translation for shadow animation\r\n            ctx.translate(shadowOffsetX, shadowOffsetY);\r\n            \r\n            // For solar overlay, clip to the sun's core area only (not the corona)\r\n            if (isSolarOverlay) {\r\n                // Clip to a circle at the shadow's position that only covers the core\r\n                ctx.save();\r\n                ctx.beginPath();\r\n                // Create a clipping region that's the intersection of the sun and the shadow\r\n                ctx.arc(-shadowOffsetX, -shadowOffsetY, radius, 0, Math.PI * 2); // Sun position (inverse of shadow offset)\r\n                ctx.clip();\r\n            } else {\r\n                // Regular lunar clipping\r\n                ctx.beginPath();\r\n                ctx.arc(0, 0, radius, 0, Math.PI * 2);\r\n                ctx.clip();\r\n            }\r\n            \r\n            // Penumbra (diffuse outer shadow) - MUCH DARKER\r\n            const penumbraRadius = radius * (1.8 - sharpness * 0.5);\r\n            const penumbraGradient = ctx.createRadialGradient(\r\n                0, 0, radius * 0.2,\r\n                0, 0, penumbraRadius\r\n            );\r\n            \r\n            const baseOpacity = shadow.coverage || 0.9;\r\n            \r\n            // Use custom color if specified (for solar eclipse), otherwise use default lunar red\r\n            if (shadow.color && shadow.color.includes('0, 0, 0')) {\r\n                // Black shadow for solar eclipse\r\n                penumbraGradient.addColorStop(0, `rgba(0, 0, 0, ${baseOpacity})`);\r\n                penumbraGradient.addColorStop(0.3 + sharpness * 0.2, `rgba(0, 0, 0, ${baseOpacity * 0.95})`);\r\n                penumbraGradient.addColorStop(0.6 + sharpness * 0.2, `rgba(0, 0, 0, ${baseOpacity * 0.8})`);\r\n                penumbraGradient.addColorStop(0.85, `rgba(0, 0, 0, ${baseOpacity * 0.4})`);\r\n                penumbraGradient.addColorStop(1, `rgba(0, 0, 0, 0)`);\r\n            } else {\r\n                // Default reddish lunar eclipse colors\r\n                penumbraGradient.addColorStop(0, `rgba(10, 2, 0, ${baseOpacity})`);\r\n                penumbraGradient.addColorStop(0.3 + sharpness * 0.2, `rgba(20, 5, 0, ${baseOpacity * 0.95})`);\r\n                penumbraGradient.addColorStop(0.6 + sharpness * 0.2, `rgba(40, 10, 5, ${baseOpacity * 0.8})`);\r\n                penumbraGradient.addColorStop(0.85, `rgba(60, 15, 10, ${baseOpacity * 0.4})`);\r\n                penumbraGradient.addColorStop(1, `rgba(80, 20, 15, 0)`);\r\n            }\r\n            \r\n            ctx.fillStyle = penumbraGradient;\r\n            ctx.beginPath();\r\n            ctx.arc(0, 0, penumbraRadius, 0, Math.PI * 2);\r\n            ctx.fill();\r\n            \r\n            // Umbra (sharp inner shadow) - only when sharp\r\n            if (sharpness > 0.3) {\r\n                const umbraRadius = radius * (0.8 + sharpness * 0.3);\r\n                const umbraGradient = ctx.createRadialGradient(\r\n                    0, 0, 0,\r\n                    0, 0, umbraRadius\r\n                );\r\n                \r\n                // Use black for solar eclipse, reddish for lunar\r\n                if (shadow.color && shadow.color.includes('0, 0, 0')) {\r\n                    umbraGradient.addColorStop(0, `rgba(0, 0, 0, ${baseOpacity})`);\r\n                    umbraGradient.addColorStop(0.5, `rgba(0, 0, 0, ${baseOpacity * 0.9})`);\r\n                    umbraGradient.addColorStop(0.8, `rgba(0, 0, 0, ${baseOpacity * 0.5})`);\r\n                    umbraGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\r\n                } else {\r\n                    umbraGradient.addColorStop(0, `rgba(0, 0, 0, ${baseOpacity})`);\r\n                    umbraGradient.addColorStop(0.5, `rgba(10, 2, 0, ${baseOpacity * 0.9})`);\r\n                    umbraGradient.addColorStop(0.8, `rgba(20, 5, 0, ${baseOpacity * 0.5})`);\r\n                    umbraGradient.addColorStop(1, 'rgba(30, 8, 5, 0)');\r\n                }\r\n                \r\n                ctx.fillStyle = umbraGradient;\r\n                ctx.beginPath();\r\n                ctx.arc(0, 0, umbraRadius, 0, Math.PI * 2);\r\n                ctx.fill();\r\n            }\r\n        }\r\n        \r\n        // Restore extra save for solar overlay clipping\r\n        if (isSolarOverlay) {\r\n            ctx.restore();\r\n        }\r\n        \r\n        ctx.restore();\r\n    }\r\n    \r\n    /**\r\n     * Render zen meditation core with arc shape\r\n     */\r\n    renderZenCore(x, y, radius) {\r\n        this.ctx.save();\r\n        \r\n        // Apply shake offset if in awakening phase\r\n        if (this.state.shakeOffset) {\r\n            x += this.state.shakeOffset;\r\n        }\r\n        \r\n        // Apply drift Y if in awakening phase\r\n        if (this.state.driftY) {\r\n            y += this.state.driftY;\r\n        }\r\n        \r\n        this.ctx.translate(x, y);\r\n        \r\n        // Apply gesture rotation if present (for spin gesture)\r\n        if (this.gestureTransform && this.gestureTransform.rotation !== undefined) {\r\n            this.ctx.rotate(this.gestureTransform.rotation * Math.PI / 180);\r\n        }\r\n        \r\n        // Calculate zen energy pulsation (slow breathing effect)\r\n        const time = Date.now() / 1000; // Time in seconds\r\n        const basePulse = Math.sin(time * 0.5) * 0.5 + 1.5; // Base pulsation\r\n        \r\n        // Scale glow intensity based on transition phase\r\n        // Very dim during bloom/retract, bright when fully in zen\r\n        let glowIntensity = 0.1; // Start very dim\r\n        if (this.zenTransition.phase === 'in') {\r\n            // Full brightness when fully in zen\r\n            glowIntensity = 1.0;\r\n        } else if (this.zenTransition.phase === 'entering') {\r\n            // Gradually brighten only after lotus is mostly formed\r\n            glowIntensity = Math.max(0.1, (this.zenTransition.lotusMorph - 0.7) * 3.3); // Stay dim until 70% bloomed\r\n        } else if (this.zenTransition.phase === 'exiting') {\r\n            // Quickly dim when exiting\r\n            glowIntensity = Math.max(0.1, this.zenTransition.lotusMorph * 0.5);\r\n        }\r\n        const zenPulse = basePulse * glowIntensity; // Apply intensity scaling\r\n        \r\n        // Apply glow when lotus is morphing or fully formed\r\n        if (this.zenTransition.lotusMorph > 0) {\r\n            // Single smooth shadow glow \r\n            this.ctx.shadowBlur = this.scaleValue(100) * zenPulse;\r\n            this.ctx.shadowColor = `rgba(255, 223, 0, ${0.5 * zenPulse})`;\r\n            \r\n            // INNER RADIANCE GRADIENT - Much darker during transitions\r\n            const gradient = this.ctx.createRadialGradient(0, 0, 0, 0, 0, radius * 4);\r\n            \r\n            // During transitions, use much darker colors to see lotus\r\n            if (this.zenTransition.phase !== 'in') {\r\n                // Dark golden during transition - lotus will show as even darker cutout\r\n                gradient.addColorStop(0, `rgba(184, 134, 11, ${0.8})`); // Dark goldenrod core\r\n                gradient.addColorStop(0.3, `rgba(153, 101, 21, ${0.6})`); // Darker gold\r\n                gradient.addColorStop(0.6, `rgba(139, 69, 19, ${0.4})`); // Saddle brown\r\n                gradient.addColorStop(1, `rgba(101, 67, 33, 0)`); // Dark brown edge\r\n            } else {\r\n                // Full brightness only when fully in zen\r\n                gradient.addColorStop(0, `rgba(255, 255, 255, ${1.0 * zenPulse})`); // Pure white core\r\n                gradient.addColorStop(0.1, `rgba(255, 255, 240, ${1.0 * zenPulse})`); // Bright cream\r\n                gradient.addColorStop(0.2, `rgba(255, 250, 205, ${0.95 * zenPulse})`); // Warm light\r\n                gradient.addColorStop(0.35, `rgba(255, 240, 150, ${0.85 * zenPulse})`); // Bright gold\r\n                gradient.addColorStop(0.5, `rgba(255, 223, 0, ${0.7 * zenPulse})`); // Vibrant gold\r\n                gradient.addColorStop(0.65, `rgba(255, 215, 0, ${0.5 * zenPulse})`); // Fading gold\r\n                gradient.addColorStop(0.8, `rgba(255, 215, 0, ${0.3 * zenPulse})`); // Softer edge\r\n                gradient.addColorStop(0.9, `rgba(255, 215, 0, ${0.15 * zenPulse})`); // Very soft\r\n                gradient.addColorStop(0.95, `rgba(255, 215, 0, ${0.05 * zenPulse})`); // Almost gone\r\n                gradient.addColorStop(1, `rgba(255, 215, 0, 0)`); // Fully transparent edge\r\n            }\r\n            \r\n            this.ctx.fillStyle = gradient;\r\n            this.ctx.strokeStyle = `rgba(255, 255, 255, ${0.3})`; // Dimmer edge during transition\r\n            this.ctx.lineWidth = this.scaleValue(2);\r\n            \r\n            // STEP 1: Draw a circle with lotus cutout using evenodd fill rule\r\n            this.ctx.beginPath();\r\n            \r\n            // Draw outer circle (clockwise)\r\n            this.ctx.arc(0, 0, radius, 0, Math.PI * 2, false);\r\n            \r\n            // CLEAN LOTUS SILHOUETTE - matching reference image\r\n            const lotusSize = radius * 0.95; // Lotus fills nearly ALL of the orb\r\n            \r\n            // MORPHING LOTUS PETALS - animated based on lotusMorph value\r\n            const morph = this.zenTransition.lotusMorph;\r\n            const spread = this.zenTransition.petalSpread;\r\n            const smile = this.zenTransition.smileCurve;\r\n            \r\n            // Center/Top petal - morphs from small circle to full petal\r\n            // Only draw lotus if morph is significant (avoid tiny artifacts)\r\n            if (morph > 0.1) {\r\n                const centerPetalBase = radius * (0.05 + 0.15 * morph);\r\n                this.ctx.moveTo(0, centerPetalBase); // Start at base center\r\n                this.ctx.bezierCurveTo(\r\n                    -radius * (0.05 + 0.25 * morph * spread), radius * 0.1,    // Left control\r\n                    -radius * (0.05 + 0.3 * morph * spread), -radius * (0.1 + 0.4 * morph),  // Left control up\r\n                    0, -radius * (0.2 + 0.65 * morph)                // Top point\r\n                );\r\n                this.ctx.bezierCurveTo(\r\n                    radius * (0.05 + 0.3 * morph * spread), -radius * (0.1 + 0.4 * morph),   // Right control up\r\n                    radius * (0.05 + 0.25 * morph * spread), radius * 0.1,     // Right control\r\n                    0, centerPetalBase                 // Back to base\r\n                );\r\n                \r\n                if (morph > 0.3) { // Only show side petals after some morphing\r\n                const sidePetalAlpha = (morph - 0.3) / 0.7; // Fade in from 30% to 100%\r\n                \r\n                // Left petal - fades in and spreads\r\n                this.ctx.moveTo(-radius * 0.1 * sidePetalAlpha, radius * 0.2); \r\n                this.ctx.bezierCurveTo(\r\n                    -radius * (0.1 + 0.4 * sidePetalAlpha * spread), radius * 0.1,    \r\n                    -radius * (0.2 + 0.5 * sidePetalAlpha * spread), -radius * (0.1 + 0.2 * sidePetalAlpha),   \r\n                    -radius * (0.1 + 0.4 * sidePetalAlpha * spread), -radius * (0.2 + 0.45 * sidePetalAlpha)   \r\n                );\r\n                this.ctx.bezierCurveTo(\r\n                    -radius * (0.05 + 0.15 * sidePetalAlpha), -radius * (0.1 + 0.4 * sidePetalAlpha),   \r\n                    -radius * 0.05 * sidePetalAlpha, radius * 0.1,   \r\n                    -radius * 0.1 * sidePetalAlpha, radius * 0.2     \r\n                );\r\n                \r\n                // Right petal - fades in and spreads\r\n                this.ctx.moveTo(radius * 0.1 * sidePetalAlpha, radius * 0.2); \r\n                this.ctx.bezierCurveTo(\r\n                    radius * (0.1 + 0.4 * sidePetalAlpha * spread), radius * 0.1,     \r\n                    radius * (0.2 + 0.5 * sidePetalAlpha * spread), -radius * (0.1 + 0.2 * sidePetalAlpha),    \r\n                    radius * (0.1 + 0.4 * sidePetalAlpha * spread), -radius * (0.2 + 0.45 * sidePetalAlpha)    \r\n                );\r\n                this.ctx.bezierCurveTo(\r\n                    radius * (0.05 + 0.15 * sidePetalAlpha), -radius * (0.1 + 0.4 * sidePetalAlpha),    \r\n                    radius * 0.05 * sidePetalAlpha, radius * 0.1,    \r\n                    radius * 0.1 * sidePetalAlpha, radius * 0.2      \r\n                );\r\n            }\r\n            \r\n            // Bottom smile - morphs from straight to curved smile\r\n            if (smile > 0) {\r\n                const smileDepth = radius * 0.2 * smile; // How deep the smile curves\r\n                this.ctx.moveTo(-radius * 0.6, radius * (0.5 - 0.1 * smile));   // Corners rise with smile\r\n                this.ctx.quadraticCurveTo(\r\n                    0, radius * (0.5 + 0.1 * smile),     // Center dips for smile\r\n                    radius * 0.6, radius * (0.5 - 0.1 * smile)  // Right corner rises\r\n                );\r\n                }\r\n            }\r\n            \r\n            this.ctx.closePath();\r\n            \r\n            // Fill with gradient using evenodd rule to create the lotus cutout\r\n            this.ctx.fill('evenodd');\r\n            // Don't stroke the lotus cutout, only the outer circle\r\n            this.ctx.beginPath();\r\n            this.ctx.arc(0, 0, radius, 0, Math.PI * 2);\r\n            this.ctx.stroke();\r\n            \r\n            // Only add additional glow layers when fully in zen, not during transitions\r\n            if (this.zenTransition.phase === 'in') {\r\n                // Additional EXPANSIVE glow layers for inner radiance\r\n                // Layer 1: BRILLIANT lotus core intensifier - from lower quarter\r\n                const lotusRadius = radius * 2.0; // Larger radius for more expansion\r\n                const arcHeight = this.zenTransition.arcHeight * radius; // Get arc height from transition state\r\n                const glowOriginY = radius * 0.5; // Lower quarter origin\r\n                const lotusGlow = this.ctx.createRadialGradient(0, glowOriginY, 0, 0, glowOriginY, lotusRadius * 1.2);\r\n                lotusGlow.addColorStop(0, `rgba(255, 255, 255, ${1.0 * zenPulse})`);\r\n                lotusGlow.addColorStop(0.25, `rgba(255, 252, 240, ${0.8 * zenPulse})`);\r\n                lotusGlow.addColorStop(0.5, `rgba(255, 245, 200, ${0.6 * zenPulse})`);\r\n                lotusGlow.addColorStop(0.75, `rgba(255, 235, 150, ${0.4 * zenPulse})`);\r\n                lotusGlow.addColorStop(1, 'rgba(255, 223, 0, 0)');\r\n                this.ctx.fillStyle = lotusGlow;\r\n                this.ctx.fill();\r\n                \r\n                // Layer 2: GAUSSIAN outer halo for smooth falloff\r\n                const outerHalo = this.ctx.createRadialGradient(0, -arcHeight/2, radius * 0.5, 0, -arcHeight/2, radius * 5);\r\n                outerHalo.addColorStop(0, 'rgba(255, 223, 0, 0)');\r\n                outerHalo.addColorStop(0.1, `rgba(255, 223, 0, ${0.25 * zenPulse})`);\r\n                outerHalo.addColorStop(0.2, `rgba(255, 220, 0, ${0.2 * zenPulse})`);\r\n                outerHalo.addColorStop(0.35, `rgba(255, 215, 0, ${0.15 * zenPulse})`);\r\n                outerHalo.addColorStop(0.5, `rgba(255, 215, 0, ${0.1 * zenPulse})`);\r\n                outerHalo.addColorStop(0.65, `rgba(255, 215, 0, ${0.06 * zenPulse})`);\r\n                outerHalo.addColorStop(0.8, `rgba(255, 215, 0, ${0.03 * zenPulse})`);\r\n                outerHalo.addColorStop(0.9, `rgba(255, 215, 0, ${0.01 * zenPulse})`);\r\n                outerHalo.addColorStop(1, 'rgba(255, 215, 0, 0)');\r\n                this.ctx.fillStyle = outerHalo;\r\n                this.ctx.fill();\r\n            }\r\n        } else {\r\n            // Draw horizontal line or circle during transition\r\n            // Start with very dim golden color that brightens with lotus\r\n            \r\n            // No glow during transition to prevent flash\r\n            this.ctx.shadowBlur = 0;\r\n            this.ctx.shadowColor = 'transparent';\r\n            \r\n            // Use very dim golden color during transition\r\n            const dimIntensity = 0.3; // Keep consistently dim during transition\r\n            this.ctx.fillStyle = `rgba(255, 215, 0, ${dimIntensity})`;\r\n            this.ctx.beginPath();\r\n            this.ctx.arc(0, 0, radius, 0, Math.PI * 2);\r\n            this.ctx.fill();\r\n            \r\n            // Very subtle gradient during transition to see lotus clearly\r\n            const coreGradient = this.ctx.createRadialGradient(0, 0, 0, 0, 0, radius);\r\n            coreGradient.addColorStop(0, `rgba(255, 255, 255, 0.2)`);\r\n            coreGradient.addColorStop(0.5, `rgba(255, 250, 230, 0.1)`);\r\n            coreGradient.addColorStop(1, 'rgba(255, 215, 0, 0)');\r\n            this.ctx.fillStyle = coreGradient;\r\n            this.ctx.fill();\r\n        }\r\n        \r\n        this.ctx.restore();\r\n    }\r\n    \r\n    /**\r\n     * Render speaking animation rings\r\n     */\r\n    renderSpeakingRings(centerX, centerY, coreRadius, deltaTime) {\r\n        return this.specialEffects.renderSpeakingRings(centerX, centerY, coreRadius, deltaTime);\r\n    }\r\n    \r\n    \r\n    // Recording rings method removed - now using pulsating glow instead\r\n    \r\n    /**\r\n     * Render recording indicator - stylized REC text only\r\n     */\r\n    renderRecordingIndicator(x, y) {\r\n        return this.specialEffects.renderRecordingIndicator(x, y);\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Render sleep indicator (Z's) with cell-shaded style and gradient fade\r\n     */\r\n    renderSleepIndicator(x, y, deltaTime) {\r\n        return this.specialEffects.renderSleepIndicator(x, y, deltaTime);\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Update animation timers\r\n     */\r\n    updateTimers(deltaTime) {\r\n        // Update breathing animation via BreathingAnimator\r\n        this.breathingAnimator.update(deltaTime, this.state.emotion, this.currentUndertone);\r\n        \r\n        // Update special breathing modifiers\r\n        if (this.state.emotion === 'zen') {\r\n            this.breathingAnimator.setBreathRateMultiplier(0.15);\r\n            this.breathingAnimator.setBreathDepthMultiplier(2.5);\r\n        } else if (this.state.sleeping) {\r\n            this.breathingAnimator.setBreathRateMultiplier(0.5);\r\n            this.breathingAnimator.setBreathDepthMultiplier(1.2);\r\n        } else {\r\n            this.breathingAnimator.setBreathRateMultiplier(1.0);\r\n            this.breathingAnimator.setBreathDepthMultiplier(1.0);\r\n        }\r\n        \r\n        // Apply irregular breathing for nervous/tired\r\n        this.breathingAnimator.setIrregularBreathing(this.state.breathIrregular);\r\n        \r\n        // Update blinking via EyeRenderer\r\n        this.eyeRenderer.setBlinkingEnabled(this.state.blinkingEnabled && !this.state.sleeping && this.state.emotion !== 'zen');\r\n        this.eyeRenderer.update(deltaTime);\r\n        \r\n        // Sync blinking state back to our state for compatibility\r\n        this.state.blinking = this.eyeRenderer.blinking;\r\n        \r\n        // Note: Idle detection is handled by IdleBehavior.js, not here\r\n    }\r\n    \r\n    /**\r\n     * Apply all undertone modifiers to current state\r\n     * @param {string|null|Object} undertone - Undertone name or weighted modifier object\r\n     */\r\n    applyUndertoneModifiers(undertone) {\r\n        // Handle weighted modifier from state machine\r\n        if (undertone && typeof undertone === 'object' && undertone.weight !== undefined) {\r\n            const weight = undertone.weight;\r\n            \r\n            // Apply weighted modifiers for smooth transitions\r\n            // Use default value of 1.0 if property is undefined\r\n            this.state.sizeMultiplier = 1.0 + ((undertone.sizeMultiplier || 1.0) - 1.0) * weight;\r\n            this.state.jitterAmount = (undertone.jitterAmount || 0) * weight;\r\n            this.state.episodicFlutter = weight > 0.5 ? (undertone.episodicFlutter || false) : false;\r\n            this.state.glowRadiusMult = 1.0 + ((undertone.glowRadiusMult || 1.0) - 1.0) * weight;\r\n            this.state.breathRateMult = 1.0 + ((undertone.breathRateMult || 1.0) - 1.0) * weight;\r\n            this.state.breathDepthMult = 1.0 + ((undertone.breathDepthMult || 1.0) - 1.0) * weight;\r\n            this.state.breathIrregular = weight > 0.5 ? (undertone.breathIrregular || false) : false;\r\n            this.state.particleRateMult = 1.0;\r\n            return;\r\n        }\r\n        \r\n        // String-based undertone handling\r\n        if (!undertone || !this.undertoneModifiers[undertone]) {\r\n            // Reset to defaults if no undertone\r\n            this.state.sizeMultiplier = 1.0;\r\n            this.state.jitterAmount = 0;\r\n            this.state.episodicFlutter = false;\r\n            this.state.glowRadiusMult = 1.0;\r\n            this.state.breathRateMult = 1.0;\r\n            this.state.breathDepthMult = 1.0;\r\n            this.state.breathIrregular = false;\r\n            this.state.particleRateMult = 1.0;\r\n            return;\r\n        }\r\n        \r\n        const modifier = this.undertoneModifiers[undertone];\r\n        \r\n        // Apply all modifiers directly\r\n        this.state.sizeMultiplier = modifier.sizeMultiplier;\r\n        this.state.jitterAmount = modifier.jitterAmount || 0;\r\n        this.state.episodicFlutter = modifier.episodicFlutter || false;\r\n        this.state.glowRadiusMult = modifier.glowRadiusMult;\r\n        this.state.breathRateMult = modifier.breathRateMult;\r\n        this.state.breathDepthMult = modifier.breathDepthMult;\r\n        this.state.breathIrregular = modifier.breathIrregular || false;\r\n        this.state.particleRateMult = 1.0;\r\n    }\r\n    \r\n    /**\r\n     * Apply undertone shifts to a color using saturation-based depth\r\n     * @param {string} baseColor - Base hex color\r\n     * @param {string|null|Object} undertone - Undertone name or weighted modifier object\r\n     * @returns {string} Modified hex color\r\n     * \r\n     * Undertone saturation creates visual depth:\r\n     * - INTENSE   : +60% saturation (electric, overwhelming)\r\n     * - CONFIDENT : +30% saturation (bold, present) \r\n     * - NERVOUS   : +15% saturation (slightly heightened)\r\n     * - CLEAR     :   0% saturation (normal midtone)\r\n     * - TIRED     : -20% saturation (washed out, fading)\r\n     * - SUBDUED   : -50% saturation (ghostly, withdrawn)\r\n     */\r\n    applyUndertoneToColor(baseColor, undertone) {\r\n        return this.colorUtilities.applyUndertoneToColor(baseColor, undertone);\r\n    }\r\n    \r\n    hexToRgb(hex) {\r\n        return this.colorUtilities.hexToRgb(hex);\r\n    }\r\n    \r\n    rgbToHsl(r, g, b) {\r\n        return this.colorUtilities.rgbToHsl(r, g, b);\r\n    }\r\n    \r\n    hslToHex(h, s, l) {\r\n        return this.colorUtilities.hslToHex(h, s, l);\r\n    }\r\n    \r\n    hexToRgba(hex, alpha = 1) {\r\n        const rgb = this.hexToRgb(hex);\r\n        if (!rgb) return `rgba(255, 255, 255, ${alpha})`;\r\n        return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha})`;\r\n    }\r\n    \r\n    startColorTransition(targetColor, targetIntensity, duration = 1500) {\r\n        this.colorUtilities.currentColor = this.state.glowColor;\r\n        this.colorUtilities.currentIntensity = this.state.glowIntensity;\r\n        this.colorUtilities.startColorTransition(targetColor, targetIntensity, duration);\r\n        this.colorTransition = this.colorUtilities.colorTransition;\r\n    }\r\n    \r\n    updateColorTransition(deltaTime) {\r\n        const result = this.colorUtilities.updateColorTransition(deltaTime);\r\n        if (result) {\r\n            this.state.glowColor = result.color;\r\n            this.state.glowIntensity = result.intensity;\r\n            this.colorTransition = this.colorUtilities.colorTransition;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Update just the undertone without resetting emotion\r\n     */\r\n    updateUndertone(undertone) {\r\n        // Clear glow cache when undertone changes (colors will change)\r\n        if (this.state.undertone !== undertone) {\r\n            this.glowCache.clear();\r\n        }\r\n        \r\n        // Store undertone for color processing\r\n        this.state.undertone = undertone;\r\n        this.currentUndertone = undertone;\r\n        \r\n        // Get weighted undertone modifier from state machine if available\r\n        const weightedModifier = this.stateMachine && this.stateMachine.getWeightedUndertoneModifiers ? \r\n                                this.stateMachine.getWeightedUndertoneModifiers() : null;\r\n        \r\n        // Apply all undertone modifiers (visual, breathing only - no particles)\r\n        this.applyUndertoneModifiers(weightedModifier || undertone);\r\n        \r\n        // Update colors with the new undertone\r\n        if (this.state.emotion) {\r\n            const emotionConfig = getEmotion(this.state.emotion);\r\n            if (emotionConfig) {\r\n                const baseColor = emotionConfig.glowColor || this.config.defaultGlowColor;\r\n                const targetColor = this.applyUndertoneToColor(baseColor, weightedModifier || undertone);\r\n                \r\n                // Start color transition to new undertone color (faster for responsiveness)\r\n                this.startColorTransition(targetColor, 200); // 200ms transition\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set emotional state\r\n     */\r\n    setEmotionalState(emotion, properties, undertone = null) {\r\n        \r\n        // Clear glow cache when emotion or undertone changes (colors will change)\r\n        if (this.state.emotion !== emotion || this.state.undertone !== undertone) {\r\n            this.glowCache.clear();\r\n        }\r\n        \r\n        // Store undertone for color processing\r\n        this.state.undertone = undertone;\r\n        this.currentUndertone = undertone;\r\n        \r\n        // Get weighted undertone modifier from state machine if available\r\n        const weightedModifier = this.stateMachine && this.stateMachine.getWeightedUndertoneModifiers ? \r\n                                this.stateMachine.getWeightedUndertoneModifiers() : null;\r\n        \r\n        // Apply all undertone modifiers (visual, breathing, particles)\r\n        this.applyUndertoneModifiers(weightedModifier || undertone);\r\n        \r\n        // Get base color and apply undertone shifts\r\n        const baseColor = properties.glowColor || this.config.defaultGlowColor;\r\n        \r\n        // Get target color - for suspicion, use the dynamic color directly\r\n        let targetColor;\r\n        if (emotion === 'suspicion') {\r\n            // Use the dynamic color from properties (includes threat level)\r\n            targetColor = properties.glowColor || baseColor;\r\n        } else {\r\n            targetColor = this.applyUndertoneToColor(baseColor, weightedModifier || undertone);\r\n        }\r\n        \r\n        // Apply intensity modifier from undertone\r\n        const modifier = weightedModifier || (undertone ? this.undertoneModifiers[undertone] : null);\r\n        const baseIntensity = properties.glowIntensity || 1.0;\r\n        \r\n        // Get the glow multiplier - check for glowRadiusMult or use default of 1.0\r\n        let glowMult = 1.0;\r\n        if (modifier) {\r\n            if (weightedModifier) {\r\n                // For weighted modifiers, check if glowRadiusMult exists\r\n                // Check for NaN in weight calculation\r\n                const weight = modifier.weight || 0;\r\n                if (modifier.glowRadiusMult !== undefined && isFinite(modifier.glowRadiusMult) && isFinite(weight)) {\r\n                    glowMult = 1.0 + (modifier.glowRadiusMult - 1.0) * weight;\r\n                } else {\r\n                    glowMult = 1.0;\r\n                }\r\n            } else {\r\n                // For non-weighted modifiers, use glowRadiusMult if it exists\r\n                glowMult = modifier.glowRadiusMult !== undefined ? modifier.glowRadiusMult : 1.0;\r\n            }\r\n        }\r\n        \r\n        const targetIntensity = baseIntensity * glowMult;\r\n        \r\n        // Determine transition duration based on emotion\r\n        let duration = 1500; // Default 1.5s\r\n        if (emotion === 'anger' || emotion === 'fear') {\r\n            duration = 800; // Quick transitions for urgent emotions\r\n        } else if (emotion === 'sadness' || emotion === 'resting') {\r\n            duration = 2000; // Slower for calming emotions\r\n        } else if (emotion === 'zen') {\r\n            duration = 2000; // Zen gets special timing during lotus bloom\r\n        }\r\n        \r\n        // Update emotion state BEFORE handling transitions to avoid timing issues\r\n        const previousEmotion = this.state.emotion;\r\n        this.state.emotion = emotion;\r\n        \r\n        // Handle suspicion state\r\n        if (emotion === 'suspicion') {\r\n            this.state.isSuspicious = true;\r\n            // Store target squint amount, we'll animate to it\r\n            this.state.targetSquintAmount = properties && properties.coreSquint ? properties.coreSquint : 0.4;\r\n            if (this.state.squintAmount === undefined) {\r\n                this.state.squintAmount = 0; // Start from no squint\r\n            }\r\n            this.state.lastScanTime = Date.now();\r\n            this.state.scanPhase = 0;\r\n        } else {\r\n            this.state.isSuspicious = false;\r\n            this.state.targetSquintAmount = 0;\r\n            if (this.state.squintAmount === undefined) {\r\n                this.state.squintAmount = 0;\r\n            }\r\n        }\r\n        \r\n        // Handle zen state transitions specially\r\n        if (emotion === 'zen' && previousEmotion !== 'zen') {\r\n            // Entering zen - will handle its own color transition during lotus bloom\r\n            this.enterZenMode(targetColor, targetIntensity);\r\n        } else if (previousEmotion === 'zen' && emotion !== 'zen') {\r\n            // Exiting zen - will handle its own color transition during lotus close\r\n            this.exitZenMode(emotion, targetColor, targetIntensity);\r\n        } else {\r\n            // Standard color transition for all other state changes\r\n            this.startColorTransition(targetColor, targetIntensity, duration);\r\n        }\r\n        \r\n        // Apply breathing with undertone modifiers\r\n        const baseBreathRate = properties.breathRate || 1.0;\r\n        const baseBreathDepth = properties.breathDepth || this.config.breathingDepth;\r\n        this.state.breathRate = modifier ? baseBreathRate * modifier.breathRateMult : baseBreathRate;\r\n        this.state.breathDepth = modifier ? baseBreathDepth * modifier.breathDepthMult : baseBreathDepth;\r\n        \r\n        // Jitter combines emotion jitter with undertone jitter\r\n        this.state.coreJitter = properties.coreJitter || (modifier && modifier.jitterAmount > 0);\r\n        this.state.emotionEyeOpenness = properties.eyeOpenness;\r\n        this.state.emotionEyeArc = properties.eyeArc;\r\n    }\r\n    \r\n    /**\r\n     * Set BPM for rhythm features\r\n     * @param {number} bpm - Beats per minute\r\n     */\r\n    setBPM(bpm) {\r\n        // BPM-locked rotation has been removed\r\n        // This method is kept for other rhythm-related features\r\n    }\r\n\r\n    /**\r\n     * Set manual rotation speed\r\n     * @param {number} speed - Rotation speed in degrees per frame (like velocity)\r\n     */\r\n    setRotationSpeed(speed) {\r\n        // Direct degrees per frame, no conversion needed\r\n        this.state.rotationSpeed = speed;\r\n    }\r\n\r\n    /**\r\n     * Set manual rotation angle directly (for scratching)\r\n     * @param {number} angle - Rotation angle in DEGREES\r\n     */\r\n    setRotationAngle(angle) {\r\n        this.state.manualRotation = angle;\r\n    }\r\n    \r\n    /**\r\n     * Set gaze data from GazeTracker\r\n     * @param {Object} gazeData - Contains offset, proximity, and lock status\r\n     */\r\n    setGazeOffset(gazeData) {\r\n        // Handle both old format (just offset) and new format (full data)\r\n        if (typeof gazeData === 'object' && gazeData !== null) {\r\n            if (gazeData.hasOwnProperty('x') && gazeData.hasOwnProperty('y')) {\r\n                // Old format - just offset\r\n                this.state.gazeOffset = gazeData;\r\n            } else {\r\n                // New format - full gaze data\r\n                this.state.gazeOffset = gazeData.offset || { x: 0, y: 0 };\r\n                this.state.gazeIntensity = gazeData.proximity || 0;\r\n                this.state.gazeLocked = gazeData.isLocked || false;\r\n            }\r\n        }\r\n        \r\n        // Reset idle timer on interaction\r\n        this.idleTimer = 0;\r\n        if (this.isAsleep) {\r\n            this.wakeUp();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get current orb position (center + gaze offset)\r\n     */\r\n    getCurrentOrbPosition() {\r\n        const logicalWidth = this.canvasManager.width;\r\n        const logicalHeight = this.canvasManager.height;\r\n        const centerX = logicalWidth / 2;\r\n        const centerY = logicalHeight / 2 - this.config.topOffset;\r\n        \r\n        return {\r\n            x: centerX + this.state.gazeOffset.x,\r\n            y: centerY + this.state.gazeOffset.y\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Sets a custom scale for the orb (used for breathing exercises)\r\n     * @param {number} scale - Scale factor (1.0 = normal)\r\n     */\r\n    setCustomScale(scale) {\r\n        this.state.customScale = scale;\r\n    }\r\n    \r\n    /**\r\n     * Start speaking animation\r\n     */\r\n    startSpeaking() {\r\n        this.state.speaking = true;\r\n        this.speakingRings = [];\r\n        this.ringSpawnTimer = 0;\r\n    }\r\n    \r\n    /**\r\n     * Stop speaking animation\r\n     */\r\n    stopSpeaking() {\r\n        this.state.speaking = false;\r\n        this.speakingRings = [];\r\n    }\r\n    \r\n    /**\r\n     * Enter sleep mode with animation\r\n     */\r\n    enterSleepMode() {\r\n        this.state.sleeping = true;\r\n        this.sleepZ = []; // Reset Z's\r\n        this.state.eyeOpenness = 1.0; // Start with eyes open\r\n        \r\n        // Initialize dimming values (start at full brightness)\r\n        this.state.sleepDimness = 1.0;\r\n        this.state.sleepScale = 1.0;\r\n        \r\n        // Force end any active blink\r\n        this.state.blinking = false;\r\n        \r\n        // Animate eye closing, then dimming\r\n        this.animateEyeClose();\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Animate eye closing for sleep, then dim\r\n     */\r\n    animateEyeClose() {\r\n        // Cancel any existing eye animations\r\n        if (this.loopCallbackIds.eyeClose) {\r\n            animationLoopManager.unregister(this.loopCallbackIds.eyeClose);\r\n            this.loopCallbackIds.eyeClose = null;\r\n        }\r\n        if (this.loopCallbackIds.eyeOpen) {\r\n            animationLoopManager.unregister(this.loopCallbackIds.eyeOpen);\r\n            this.loopCallbackIds.eyeOpen = null;\r\n        }\r\n        \r\n        const startTime = performance.now();\r\n        const eyeCloseDuration = 2000; // 2 seconds to close eyes\r\n        const dimDuration = 1000; // 1 second to dim after eyes close\r\n        \r\n        const animate = () => {\r\n            if (!this.state.sleeping) {\r\n                // Clean up loop callback ID\r\n                this.loopCallbackIds.eyeClose = null;\r\n                return; // Stop if woken up\r\n            }\r\n            \r\n            const elapsed = performance.now() - startTime;\r\n            \r\n            if (elapsed < eyeCloseDuration) {\r\n                // Phase 1: Close eyes\r\n                const progress = elapsed / eyeCloseDuration;\r\n                const eased = 1 - Math.pow(progress, 2);\r\n                this.state.eyeOpenness = 0.1 + eased * 0.9; // Close to 0.1 (nearly closed)\r\n                \r\n                // Keep full brightness during eye closing\r\n                this.state.sleepDimness = 1.0;\r\n                this.state.sleepScale = 1.0;\r\n                \r\n                // Continue animation on next frame\r\n            } else if (elapsed < eyeCloseDuration + dimDuration) {\r\n                // Phase 2: Dim the orb\r\n                const dimProgress = (elapsed - eyeCloseDuration) / dimDuration;\r\n                const dimEased = 1 - Math.pow(1 - dimProgress, 3); // Ease out cubic\r\n                \r\n                // Keep eyes closed\r\n                this.state.eyeOpenness = 0.1;\r\n                \r\n                // Animate dimming and scaling\r\n                this.state.sleepDimness = 1.0 - (dimEased * 0.4); // Dim to 0.6\r\n                this.state.sleepScale = 1.0 - (dimEased * 0.1); // Scale to 0.9\r\n                \r\n                // Continue animation on next frame\r\n            } else {\r\n                // Final state\r\n                this.state.eyeOpenness = 0.1;\r\n                this.state.sleepDimness = 0.6;\r\n                this.state.sleepScale = 0.9;\r\n                // Clean up loop callback ID\r\n                this.loopCallbackIds.eyeClose = null;\r\n            }\r\n        };\r\n\r\n        // Register with AnimationLoopManager\r\n        this.loopCallbackIds.eyeClose = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.HIGH, // Eye animations are high priority\r\n            this\r\n        );\r\n    }\r\n    \r\n    /**\r\n     * Wake up from sleep with animation\r\n     */\r\n    wakeUp() {\r\n        if (!this.state.sleeping) return;\r\n        \r\n        this.state.sleeping = false;\r\n        this.state.breathRate = 1.0;\r\n        this.state.breathDepth = this.config.breathingDepth;\r\n        this.sleepZ = []; // Clear Z's\r\n        \r\n        // Reset blinking state\r\n        this.state.blinking = false;\r\n        // Blinking now handled by EyeRenderer\r\n        this.eyeRenderer.blinking = false;\r\n        this.eyeRenderer.blinkTimer = 0;\r\n        \r\n        // Animate eye opening\r\n        this.animateEyeOpen();\r\n        \r\n        // Quick shake animation\r\n        this.state.coreJitter = true;\r\n        setTimeout(() => {\r\n            this.state.coreJitter = false;\r\n        }, 200);\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Animate eye opening after wake - brighten first, then open eyes\r\n     */\r\n    animateEyeOpen() {\r\n        // Cancel any existing eye animations\r\n        if (this.loopCallbackIds.eyeOpen) {\r\n            animationLoopManager.unregister(this.loopCallbackIds.eyeOpen);\r\n            this.loopCallbackIds.eyeOpen = null;\r\n        }\r\n        if (this.loopCallbackIds.eyeClose) {\r\n            animationLoopManager.unregister(this.loopCallbackIds.eyeClose);\r\n            this.loopCallbackIds.eyeClose = null;\r\n        }\r\n        \r\n        const startTime = performance.now();\r\n        const brightenDuration = 500; // 0.5 seconds to brighten\r\n        const eyeOpenDuration = 1000; // 1 second to open eyes\r\n        \r\n        const animate = () => {\r\n            const elapsed = performance.now() - startTime;\r\n            \r\n            if (elapsed < brightenDuration) {\r\n                // Phase 1: Brighten the orb\r\n                const progress = elapsed / brightenDuration;\r\n                const eased = Math.sin(progress * Math.PI / 2); // Smooth acceleration\r\n                \r\n                // Animate brightening and scaling back\r\n                this.state.sleepDimness = 0.6 + (eased * 0.4); // Brighten from 0.6 to 1.0\r\n                this.state.sleepScale = 0.9 + (eased * 0.1); // Scale from 0.9 to 1.0\r\n                \r\n                // Keep eyes closed during brightening\r\n                this.state.eyeOpenness = 0.1;\r\n                \r\n                // Continue animation on next frame\r\n            } else if (elapsed < brightenDuration + eyeOpenDuration) {\r\n                // Phase 2: Open eyes\r\n                const eyeProgress = (elapsed - brightenDuration) / eyeOpenDuration;\r\n                const eyeEased = Math.sin(eyeProgress * Math.PI / 2); // Smooth acceleration\r\n                \r\n                // Keep full brightness\r\n                this.state.sleepDimness = 1.0;\r\n                this.state.sleepScale = 1.0;\r\n                \r\n                // Animate eye opening\r\n                this.state.eyeOpenness = 0.1 + eyeEased * 0.9; // Open from 0.1 to 1.0\r\n                \r\n                // Continue animation on next frame\r\n            } else {\r\n                // Final state\r\n                this.state.eyeOpenness = 1.0;\r\n                this.state.sleepDimness = 1.0;\r\n                this.state.sleepScale = 1.0;\r\n                // Clean up loop callback ID\r\n                this.loopCallbackIds.eyeOpen = null;\r\n            }\r\n        };\r\n\r\n        // Register with AnimationLoopManager\r\n        this.loopCallbackIds.eyeOpen = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.HIGH, // Eye animations are high priority\r\n            this\r\n        );\r\n    }\r\n    \r\n    /**\r\n     * Enter zen meditation mode with animation\r\n     */\r\n    enterZenMode(targetColor, targetIntensity) {\r\n        // Cancel any existing zen animations\r\n        if (this.animationFrameIds.zenEnter) {\r\n            cancelAnimationFrame(this.animationFrameIds.zenEnter);\r\n            this.animationFrameIds.zenEnter = null;\r\n        }\r\n        if (this.animationFrameIds.zenExit) {\r\n            cancelAnimationFrame(this.animationFrameIds.zenExit);\r\n            this.animationFrameIds.zenExit = null;\r\n        }\r\n        \r\n        // Set to zen color with target intensity\r\n        this.state.glowColor = targetColor;\r\n        this.state.glowIntensity = targetIntensity; // Keep the glow\r\n        \r\n        // Cancel any active color transition\r\n        this.colorTransition.active = false;\r\n        \r\n        this.zenTransition = {\r\n            active: true,\r\n            phase: 'entering',\r\n            startTime: performance.now(),\r\n            previousEmotion: this.state.emotion,\r\n            targetEmotion: null,\r\n            scaleX: 1.0,\r\n            scaleY: 1.0,\r\n            arcHeight: 0,\r\n            lotusMorph: 0,     // 0 = no lotus, 1 = full lotus\r\n            petalSpread: 0,    // 0 = closed petals, 1 = full spread\r\n            smileCurve: 0      // 0 = no smile, 1 = full smile\r\n        };\r\n        \r\n        const animate = () => {\r\n            if (!this.zenTransition.active || this.zenTransition.phase !== 'entering') {\r\n                // Clean up loop callback ID\r\n                this.loopCallbackIds.zenEnter = null;\r\n                return;\r\n            }\r\n            \r\n            const elapsed = performance.now() - this.zenTransition.startTime;\r\n            const lotusMorphDuration = 400; // 0.4s for lotus to bloom - smooth transition\r\n            \r\n            if (elapsed < lotusMorphDuration) {\r\n                // Direct lotus blooming - no intro animation\r\n                const lotusProgress = elapsed / lotusMorphDuration;\r\n                const lotusEased = 1 - Math.pow(1 - lotusProgress, 2); // Ease out quad\r\n                \r\n                // Direct lotus bloom without arc or narrowing\r\n                this.zenTransition.scaleX = 1.0;\r\n                this.zenTransition.scaleY = 1.0;  // Full size\r\n                this.zenTransition.arcHeight = 0;  // No arc\r\n                \r\n                // Morph the lotus shape directly\r\n                this.zenTransition.lotusMorph = lotusEased; // 0 to 100%\r\n                this.zenTransition.petalSpread = lotusEased;\r\n                \r\n                // Smile appears gradually\r\n                this.zenTransition.smileCurve = Math.sin(lotusProgress * Math.PI / 2); // Smooth ease\r\n                \r\n                // Register with AnimationLoopManager\r\n        this.loopCallbackIds.zenEnter = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.MEDIUM, // Zen animations are medium priority\r\n            this\r\n        );\r\n            } else {\r\n                // Final state - in meditation with full lotus, then start floating\r\n                this.zenTransition.phase = 'in';\r\n                this.zenTransition.scaleX = 1.0;\r\n                this.zenTransition.scaleY = 1.0;  // Full size\r\n                this.zenTransition.arcHeight = 0;  // No arc\r\n                this.zenTransition.lotusMorph = 1.0;\r\n                this.zenTransition.petalSpread = 1.0;\r\n                this.zenTransition.smileCurve = 1.0;\r\n                \r\n                // Set gentle vortex for zen state\r\n                this.state.zenVortexIntensity = 1.0;  // Can be adjusted: 0.5 = very gentle, 2.0 = strong\r\n                // Clean up loop callback ID\r\n                this.loopCallbackIds.zenEnter = null;\r\n            }\r\n        };\r\n        \r\n        // Register with AnimationLoopManager\r\n        this.loopCallbackIds.zenEnter = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.MEDIUM, // Zen animations are medium priority\r\n            this\r\n        );\r\n    }\r\n    \r\n    /**\r\n     * Exit zen meditation mode with awakening animation\r\n     */\r\n    exitZenMode(targetEmotion, targetColor, targetIntensity) {\r\n        if (!this.zenTransition.active || this.zenTransition.phase !== 'in') return;\r\n        \r\n        // Cancel any existing zen animations\r\n        if (this.animationFrameIds.zenEnter) {\r\n            cancelAnimationFrame(this.animationFrameIds.zenEnter);\r\n            this.animationFrameIds.zenEnter = null;\r\n        }\r\n        if (this.animationFrameIds.zenExit) {\r\n            cancelAnimationFrame(this.animationFrameIds.zenExit);\r\n            this.animationFrameIds.zenExit = null;\r\n        }\r\n        \r\n        this.zenTransition.phase = 'exiting';\r\n        this.zenTransition.startTime = performance.now();\r\n        this.zenTransition.targetEmotion = targetEmotion;\r\n        \r\n        const animate = () => {\r\n            if (!this.zenTransition.active || this.zenTransition.phase !== 'exiting') {\r\n                // Clean up loop callback ID\r\n                this.loopCallbackIds.zenExit = null;\r\n                return;\r\n            }\r\n            \r\n            const elapsed = performance.now() - this.zenTransition.startTime;\r\n            const straightenDuration = 150; // 0.15s to straighten arc - FAST\r\n            const awakeDuration = 200; // 0.2s for awakening gestures - FAST\r\n            const expandDuration = 200; // 0.2s to expand back - FAST\r\n            const settleDuration = 100; // 0.1s for final settle - FAST\r\n            \r\n            if (elapsed < straightenDuration) {\r\n                // Phase 1: Lotus closing and arc straightening - start color transition\r\n                const progress = elapsed / straightenDuration;\r\n                const eased = 1 - Math.pow(1 - progress, 2);\r\n                \r\n                // Start color transition at beginning of exit\r\n                if (progress === 0 || !this.colorTransition.active) {\r\n                    this.startColorTransition(targetColor, targetIntensity, straightenDuration);\r\n                }\r\n                \r\n                this.zenTransition.arcHeight = 1.5 * (1 - eased); // Flatten arc from full height\r\n                \r\n                // Close lotus petals quickly\r\n                this.zenTransition.smileCurve = 1.0 * (1 - eased); // Smile fades first\r\n                if (progress > 0.3) {\r\n                    const petalProgress = (progress - 0.3) / 0.7;\r\n                    this.zenTransition.petalSpread = 1.0 * (1 - petalProgress); // Petals close\r\n                }\r\n                if (progress > 0.5) {\r\n                    const morphProgress = (progress - 0.5) / 0.5;\r\n                    this.zenTransition.lotusMorph = 1.0 * (1 - morphProgress); // Lotus disappears\r\n                }\r\n                \r\n                // Register with AnimationLoopManager\r\n        this.loopCallbackIds.zenExit = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.MEDIUM, // Zen animations are medium priority\r\n            this\r\n        );\r\n            } else if (elapsed < straightenDuration + awakeDuration) {\r\n                // Phase 2: Awakening gestures\r\n                const awakeProgress = (elapsed - straightenDuration) / awakeDuration;\r\n                \r\n                // Lotus is fully closed by now\r\n                this.zenTransition.lotusMorph = 0;\r\n                this.zenTransition.petalSpread = 0;\r\n                this.zenTransition.smileCurve = 0;\r\n                \r\n                // Slow blink (0-0.3)\r\n                if (awakeProgress < 0.2) {\r\n                    const blinkProg = awakeProgress / 0.2;\r\n                    this.zenTransition.scaleY = 1.0 - (Math.sin(blinkProg * Math.PI) * 0.8);\r\n                }\r\n                // Gentle shake (0.3-0.6)\r\n                else if (awakeProgress < 0.6) {\r\n                    const shakeProg = (awakeProgress - 0.2) / 0.4;\r\n                    this.zenTransition.scaleY = 1.0;\r\n                    // Add small X offset for shake (will be applied in render)\r\n                    this.state.shakeOffset = Math.sin(shakeProg * Math.PI * 4) * 3;\r\n                }\r\n                // Upward drift with brighten (0.6-1.0)\r\n                else {\r\n                    const driftProg = (awakeProgress - 0.6) / 0.4;\r\n                    this.state.driftY = -10 * driftProg;\r\n                    this.state.glowIntensity = 1.0 + (0.5 * driftProg); // Brighten\r\n                }\r\n                \r\n                // Register with AnimationLoopManager\r\n        this.loopCallbackIds.zenExit = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.MEDIUM, // Zen animations are medium priority\r\n            this\r\n        );\r\n            } else if (elapsed < straightenDuration + awakeDuration + expandDuration) {\r\n                // Phase 3: Horizontal expansion (sunrise)\r\n                const expandProgress = (elapsed - straightenDuration - awakeDuration) / expandDuration;\r\n                const expandEased = Math.sin(expandProgress * Math.PI / 2);\r\n                \r\n                this.zenTransition.scaleX = 1.0;\r\n                this.zenTransition.scaleY = 0.2 + (expandEased * 0.8); // Expand vertically back to 1.0 (sunrise)\r\n                this.state.driftY = -10 * (1 - expandProgress); // Return to center\r\n                this.state.glowIntensity = 1.5 - (0.5 * expandProgress); // Normal glow\r\n                \r\n                // Register with AnimationLoopManager\r\n        this.loopCallbackIds.zenExit = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.MEDIUM, // Zen animations are medium priority\r\n            this\r\n        );\r\n            } else if (elapsed < straightenDuration + awakeDuration + expandDuration + settleDuration) {\r\n                // Phase 4: Final settle pulse\r\n                const settleProgress = (elapsed - straightenDuration - awakeDuration - expandDuration) / settleDuration;\r\n                const pulse = Math.sin(settleProgress * Math.PI);\r\n                \r\n                this.zenTransition.scaleX = 1.0 + (pulse * 0.05);\r\n                this.zenTransition.scaleY = 1.0 + (pulse * 0.05);\r\n                \r\n                // Register with AnimationLoopManager\r\n        this.loopCallbackIds.zenExit = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.MEDIUM, // Zen animations are medium priority\r\n            this\r\n        );\r\n            } else {\r\n                // Complete - reset to normal\r\n                this.zenTransition.active = false;\r\n                this.zenTransition.phase = null;\r\n                this.zenTransition.scaleX = 1.0;\r\n                this.zenTransition.scaleY = 1.0;\r\n                this.zenTransition.arcHeight = 0;\r\n                this.zenTransition.lotusMorph = 0;\r\n                this.zenTransition.petalSpread = 0;\r\n                this.zenTransition.smileCurve = 0;\r\n                this.state.shakeOffset = 0;\r\n                this.state.driftY = 0;\r\n                // Clean up loop callback ID\r\n                this.loopCallbackIds.zenExit = null;\r\n            }\r\n        };\r\n        \r\n        // Register with AnimationLoopManager\r\n        this.loopCallbackIds.zenExit = animationLoopManager.register(\r\n            animate,\r\n            AnimationPriority.MEDIUM, // Zen animations are medium priority\r\n            this\r\n        );\r\n    }\r\n    \r\n    /**\r\n     * Start recording mode\r\n     */\r\n    startRecording() {\r\n        this.state.recording = true;\r\n    }\r\n    \r\n    /**\r\n     * Stop recording mode\r\n     */\r\n    stopRecording() {\r\n        this.state.recording = false;\r\n    }\r\n    \r\n    /**\r\n     * Get random blink time (2-6 seconds)\r\n     */\r\n    \r\n    /**\r\n     * Set whether blinking is enabled\r\n     * @param {boolean} enabled - Whether blinking should be enabled\r\n     */\r\n    setBlinkingEnabled(enabled) {\r\n        this.state.blinkingEnabled = enabled;\r\n        if (!enabled) {\r\n            // If disabling blinking, immediately stop any current blink\r\n            this.state.blinking = false;\r\n            // Reset blinking via EyeRenderer\r\n            this.eyeRenderer.blinking = false;\r\n            this.eyeRenderer.blinkTimer = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set gaze tracking enabled state\r\n     * @param {boolean} enabled - Whether gaze tracking should be enabled\r\n     */\r\n    setGazeTracking(enabled) {\r\n        this.state.gazeTrackingEnabled = enabled;\r\n        if (enabled) {\r\n            // Start tracking mouse/touch position\r\n            if (!this.gazeTrackingInitialized) {\r\n                this.initGazeTracking();\r\n            }\r\n        } else {\r\n            // Reset gaze to center when disabled\r\n            this.state.gazeTarget = { x: 0, y: 0 };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Initialize gaze tracking event listeners\r\n     */\r\n    initGazeTracking() {\r\n        // Always set up listeners once\r\n        if (this.gazeTrackingInitialized) return;\r\n\r\n        this.handleMouseMove = (e) => {\r\n            if (!this.state.gazeTrackingEnabled) return;\r\n\r\n            const rect = this.canvas.getBoundingClientRect();\r\n            const centerX = rect.width / 2;\r\n            const centerY = rect.height / 2;\r\n            const x = e.clientX - rect.left - centerX;\r\n            const y = e.clientY - rect.top - centerY;\r\n\r\n            // Normalize to -1 to 1 range\r\n            this.state.gazeTarget = {\r\n                x: x / centerX,\r\n                y: y / centerY\r\n            };\r\n        };\r\n\r\n        this.handleTouchMove = (e) => {\r\n            if (!this.state.gazeTrackingEnabled) return;\r\n\r\n            if (e.touches.length > 0) {\r\n                const touch = e.touches[0];\r\n                const rect = this.canvas.getBoundingClientRect();\r\n                const centerX = rect.width / 2;\r\n                const centerY = rect.height / 2;\r\n                const x = touch.clientX - rect.left - centerX;\r\n                const y = touch.clientY - rect.top - centerY;\r\n\r\n                // Normalize to -1 to 1 range\r\n                this.state.gazeTarget = {\r\n                    x: x / centerX,\r\n                    y: y / centerY\r\n                };\r\n            }\r\n        };\r\n\r\n        document.addEventListener('mousemove', this.handleMouseMove);\r\n        document.addEventListener('touchmove', this.handleTouchMove);\r\n        this.gazeTrackingInitialized = true;\r\n    }\r\n\r\n    /**\r\n     * Clean up gaze tracking event listeners\r\n     */\r\n    cleanupGazeTracking() {\r\n        if (!this.gazeTrackingInitialized) return;\r\n\r\n        if (this.handleMouseMove) {\r\n            document.removeEventListener('mousemove', this.handleMouseMove);\r\n        }\r\n        if (this.handleTouchMove) {\r\n            document.removeEventListener('touchmove', this.handleTouchMove);\r\n        }\r\n        this.gazeTrackingInitialized = false;\r\n    }\r\n\r\n    /**\r\n     * Reset canvas context to fix rendering artifacts after tab switch\r\n     */\r\n    resetCanvasContext() {\r\n        if (!this.canvas || !this.ctx) return;\r\n\r\n        // Save current dimensions\r\n        const width = this.canvas.width;\r\n        const height = this.canvas.height;\r\n\r\n        // Reset all canvas state\r\n        this.ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n        this.ctx.globalAlpha = 1;\r\n        this.ctx.globalCompositeOperation = 'source-over';\r\n        this.ctx.imageSmoothingEnabled = true;\r\n        this.ctx.imageSmoothingQuality = 'high';\r\n\r\n        // Clear the entire canvas\r\n        this.ctx.clearRect(0, 0, width, height);\r\n\r\n        // Also reset offscreen canvas if it exists\r\n        if (this.offscreenCanvas && this.offscreenCtx) {\r\n            this.offscreenCtx.setTransform(1, 0, 0, 1, 0, 0);\r\n            this.offscreenCtx.globalAlpha = 1;\r\n            this.offscreenCtx.globalCompositeOperation = 'source-over';\r\n            this.offscreenCtx.imageSmoothingEnabled = true;\r\n            this.offscreenCtx.imageSmoothingQuality = 'high';\r\n            this.offscreenCtx.clearRect(0, 0, this.offscreenCanvas.width, this.offscreenCanvas.height);\r\n        }\r\n\r\n        // Reset context state manager if it exists\r\n        if (this.contextStateManager) {\r\n            this.contextStateManager.reset();\r\n        }\r\n\r\n        // Force a clean render on next frame\r\n        this.forceCleanRender = true;\r\n    }\r\n\r\n    /**\r\n     * Convert hex to rgba\r\n     */\r\n    hexToRgba(hex, alpha = 1) {\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        if (result) {\r\n            return `rgba(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}, ${alpha})`;\r\n        }\r\n        return `rgba(0, 0, 0, ${alpha})`;\r\n    }\r\n    \r\n    /**\r\n     * Set quality level for degradation manager compatibility\r\n     * @param {number} quality - Quality level (0-1)\r\n     */\r\n    setQualityLevel(quality) {\r\n        this.qualityLevel = Math.max(0, Math.min(1, quality));\r\n        \r\n        // Adjust rendering parameters based on quality\r\n        if (this.qualityLevel < 0.5) {\r\n            // Low quality mode\r\n            this.ctx.imageSmoothingEnabled = false;\r\n            this.state.breathDepth *= 0.5; // Reduce animation complexity\r\n        } else if (this.qualityLevel < 0.8) {\r\n            // Medium quality\r\n            this.ctx.imageSmoothingEnabled = true;\r\n            this.ctx.imageSmoothingQuality = 'medium';\r\n        } else {\r\n            // High quality\r\n            this.ctx.imageSmoothingEnabled = true;\r\n            this.ctx.imageSmoothingQuality = 'high';\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set quality reduction (for degradation manager)\r\n     * @param {boolean} enabled - Whether quality reduction is enabled\r\n     */\r\n    setQualityReduction(enabled) {\r\n        if (enabled) {\r\n            this.setQualityLevel(0.5);\r\n        } else {\r\n            this.setQualityLevel(1.0);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle canvas context recovery\r\n     * @param {CanvasRenderingContext2D} newContext - New context after recovery\r\n     */\r\n    handleContextRecovery(newContext) {\r\n        this.ctx = newContext;\r\n    }\r\n    \r\n    /**\r\n     * Get the current undertone modifier for particle system\r\n     * @returns {Object|null} Current undertone modifier or null\r\n     */\r\n    getUndertoneModifier() {\r\n        // Use the new weighted method from state machine if available\r\n        if (this.stateMachine && this.stateMachine.getWeightedUndertoneModifiers) {\r\n            return this.stateMachine.getWeightedUndertoneModifiers();\r\n        }\r\n        \r\n        // Fallback to old method\r\n        if (!this.currentUndertone || !this.undertoneModifiers[this.currentUndertone]) {\r\n            return null;\r\n        }\r\n        return this.undertoneModifiers[this.currentUndertone];\r\n    }\r\n    \r\n    /**\r\n     * Apply all active gesture animations\r\n     * Returns combined transform object\r\n     */\r\n    // Gesture animations moved to GestureAnimator module\r\n    applyGestureAnimations() {\r\n        return this.gestureAnimator.applyGestureAnimations();\r\n    }\r\n      \r\n    /**\r\n     * Start a gesture animation - delegates to GestureAnimator\r\n     */\r\n    startGesture(gestureName) {\r\n        // Simply delegate to GestureAnimator\r\n        return this.gestureAnimator.startGesture(gestureName);\r\n    }\r\n    \r\n    /**\r\n     * Get current active gesture information for particle system\r\n     * @returns {Object|null} Current gesture with particleMotion and progress, or null\r\n     */\r\n    getCurrentGesture() {\r\n        // Delegate to GestureAnimator to get current gesture\r\n        return this.gestureAnimator.getCurrentGesture();\r\n    }\r\n    \r\n    // Individual start methods for each gesture - delegate to GestureAnimator\r\n    startBounce() { this.gestureAnimator.startBounce(); }\r\n    startPulse() { this.gestureAnimator.startPulse(); }\r\n    startShake() { this.gestureAnimator.startShake(); }\r\n    startSpin() { this.gestureAnimator.startSpin(); }\r\n    startNod() { this.gestureAnimator.startNod(); }\r\n    startTilt() { this.gestureAnimator.startTilt(); }\r\n    startExpand() { this.gestureAnimator.startExpand(); }\r\n    startContract() { this.gestureAnimator.startContract(); }\r\n    startFlash() { this.gestureAnimator.startFlash(); }\r\n    startDrift() { this.gestureAnimator.startDrift(); }\r\n    startStretch() { this.gestureAnimator.startStretch(); }\r\n    startGlow() { this.gestureAnimator.startGlow(); }\r\n    startFlicker() { this.gestureAnimator.startFlicker(); }\r\n    startVibrate() { this.gestureAnimator.startVibrate(); }\r\n    startOrbital() { this.gestureAnimator.startOrbital(); }\r\n    startHula() { this.gestureAnimator.startHula(); }\r\n    startWave() { this.gestureAnimator.startWave(); }\r\n    startBreathe() { this.gestureAnimator.startBreathe(); }\r\n    startMorph() { this.gestureAnimator.startMorph(); }\r\n    startSlowBlink() { this.gestureAnimator.startSlowBlink(); }\r\n    startLook() { this.gestureAnimator.startLook(); }\r\n    startSettle() { this.gestureAnimator.startSettle(); }\r\n    startBreathIn() { this.gestureAnimator.startBreathIn(); }\r\n    startBreathOut() { this.gestureAnimator.startBreathOut(); }\r\n    startBreathHold() { this.gestureAnimator.startBreathHold(); }\r\n    startBreathHoldEmpty() { this.gestureAnimator.startBreathHoldEmpty(); }\r\n    startJump() { this.gestureAnimator.startJump(); }\r\n    startSway() { this.gestureAnimator.startSway(); }\r\n    startFloat() { this.gestureAnimator.startFloat(); }\r\n    startRain() { this.gestureAnimator.startRain(); }\r\n    startRunningMan() { this.gestureAnimator.startRunningMan(); }\r\n    startCharleston() { this.gestureAnimator.startCharleston(); }\r\n\r\n    // Ambient dance animations\r\n    startGrooveSway(options) { this.ambientDanceAnimator.startAmbientAnimation('grooveSway', options); }\r\n    startGrooveBob(options) { this.ambientDanceAnimator.startAmbientAnimation('grooveBob', options); }\r\n    startGrooveFlow(options) { this.ambientDanceAnimator.startAmbientAnimation('grooveFlow', options); }\r\n    startGroovePulse(options) { this.ambientDanceAnimator.startAmbientAnimation('groovePulse', options); }\r\n    startGrooveStep(options) { this.ambientDanceAnimator.startAmbientAnimation('grooveStep', options); }\r\n    startSparkle() { this.gestureAnimator.startSparkle(); }\r\n    startShimmer() { this.gestureAnimator.startShimmer(); }\r\n    startWiggle() { this.gestureAnimator.startWiggle(); }\r\n    startGroove() { this.gestureAnimator.startGroove(); }\r\n    startPoint() { this.gestureAnimator.startPoint(); }\r\n    startLean() { this.gestureAnimator.startLean(); }\r\n    startReach() { this.gestureAnimator.startReach(); }\r\n    startHeadBob() { this.gestureAnimator.startHeadBob(); }\r\n    startOrbit() { this.gestureAnimator.startOrbit(); }\r\n    \r\n    /**\r\n     * Stop all active gestures - delegates to GestureAnimator\r\n     */\r\n    stopAllGestures() {\r\n        this.gestureAnimator.stopAllGestures();\r\n        this.currentGesture = null;\r\n    }\r\n    \r\n    /**\r\n     * Check if any gesture is active - delegates to GestureAnimator\r\n     */\r\n    isGestureActive() {\r\n        return Object.values(this.gestureAnimator.gestureAnimations).some(anim => anim.active);\r\n    }\r\n    \r\n    /**\r\n     * Clean up resources\r\n     */\r\n    destroy() {\r\n        // Cancel all animation frames to prevent memory leaks\r\n        for (const key in this.animationFrameIds) {\r\n            if (this.animationFrameIds[key]) {\r\n                cancelAnimationFrame(this.animationFrameIds[key]);\r\n                this.animationFrameIds[key] = null;\r\n            }\r\n        }\r\n        \r\n        // Clear animation states\r\n        this.colorTransition.active = false;\r\n        if (this.zenTransition) {\r\n            this.zenTransition.active = false;\r\n        }\r\n        \r\n        // Clear other resources\r\n        this.speakingRings = [];\r\n        \r\n        // Clear gesture compositor cache\r\n        if (this.gestureCompositor) {\r\n            this.gestureCompositor.clearCache();\r\n        }\r\n    }\r\n}\r\n\r\nexport default EmotiveRenderer;","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                       ◐ ◑ ◒ ◓  GAZE TRACKER  ◓ ◒ ◑ ◐                       \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Gaze Tracker - Interactive Eye Following & Cursor Awareness\n * @author Emotive Engine Team\n * @version 2.1.0\n * @module GazeTracker\n * @changelog 2.1.0 - Cached canvas rect to eliminate reflows on mouse/touch moves\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Brings the orb to LIFE by making it aware of your cursor. Creates natural         \n * ║ eye-following behavior with smooth interpolation. When you move close,            \n * ║ the orb \"looks\" at you. Move away, and it relaxes back to center.                 \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 👁️ GAZE BEHAVIORS                                                                \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Smooth following with linear interpolation (lerp)                               \n * │ • Proximity-based engagement (closer = more response)                             \n * │ • Center lock when cursor is very close                                           \n * │ • Boundary constraints to keep pupils inside orb                                  \n * │ • Touch and mouse support                                                         \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🎮 CONFIGURATION                                                                   \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • smoothing       : 0.1 (lerp factor, 0.05-0.15 recommended)                      \n * │ • maxOffset       : 0.3 (max gaze offset as % of core radius)                     \n * │ • lockDistance    : 30px (distance to trigger center lock)                        \n * │ • boundaryPadding : 0.8 (keep gaze within 80% of core)                            \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\n\nclass GazeTracker {\n    constructor(canvas, options = {}) {\n        this.canvas = canvas;\n        \n        // Configuration\n        this.config = {\n            smoothing: options.smoothing || 0.1,  // Lerp factor (0.05-0.15 recommended)\n            maxOffset: options.maxOffset || 0.3,  // Max gaze offset (30% of core radius)\n            lockDistance: options.lockDistance || 30,  // Pixels from center to trigger lock\n            enabled: options.enabled !== false,\n            boundaryPadding: options.boundaryPadding || 0.8  // Keep gaze within 80% of core\n        };\n        \n        // State\n        this.canvasCenter = { x: 0, y: 0 };\n        this.mousePos = { x: 0, y: 0 };  // Will be initialized to center after updateCanvasCenter\n        this.targetGaze = { x: 0, y: 0 };\n        this.currentGaze = { x: 0, y: 0 };\n        this.isLocked = false;\n        this.proximity = 0;  // 0-1 value for how close cursor is\n        \n        // Cache canvas rect to avoid reflows\n        this.cachedRect = null;\n        \n        // Touch state\n        this.touches = new Map();\n        this.primaryTouch = null;\n        \n        // Bind event handlers\n        this.handleMouseMove = this.handleMouseMove.bind(this);\n        this.handleMouseLeave = this.handleMouseLeave.bind(this);\n        this.handleTouchStart = this.handleTouchStart.bind(this);\n        this.handleTouchMove = this.handleTouchMove.bind(this);\n        this.handleTouchEnd = this.handleTouchEnd.bind(this);\n        \n        // Interaction callback\n        this.onInteraction = null;\n        \n        // Initialize\n        this.updateCanvasCenter();\n        this.attachEventListeners();\n        \n        // Handle canvas resize\n        this.resizeObserver = new ResizeObserver(() => {\n            this.updateCanvasCenter();\n        });\n        this.resizeObserver.observe(this.canvas);\n    }\n    \n    /**\n     * Update canvas center point\n     */\n    updateCanvasCenter() {\n        // Cache the rect to avoid repeated reflows\n        this.cachedRect = this.canvas.getBoundingClientRect();\n        this.canvasCenter = {\n            x: this.cachedRect.width / 2,\n            y: this.cachedRect.height / 2\n        };\n        // Initialize mouse position to center if not set\n        if (this.mousePos.x === 0 && this.mousePos.y === 0) {\n            this.mousePos = { x: this.canvasCenter.x, y: this.canvasCenter.y };\n        }\n    }\n    \n    /**\n     * Attach event listeners\n     */\n    attachEventListeners() {\n        if (!this.config.enabled) return;\n        \n        // Mouse events\n        this.canvas.addEventListener('mousemove', this.handleMouseMove);\n        this.canvas.addEventListener('mouseleave', this.handleMouseLeave);\n        \n        // Touch events\n        this.canvas.addEventListener('touchstart', this.handleTouchStart, { passive: true });\n        this.canvas.addEventListener('touchmove', this.handleTouchMove, { passive: true });\n        this.canvas.addEventListener('touchend', this.handleTouchEnd, { passive: true });\n        this.canvas.addEventListener('touchcancel', this.handleTouchEnd, { passive: true });\n    }\n    \n    /**\n     * Handle mouse movement\n     */\n    handleMouseMove(event) {\n        // Use cached rect to avoid reflow on every mouse move\n        const rect = this.cachedRect || this.canvas.getBoundingClientRect();\n        this.mousePos = {\n            x: event.clientX - rect.left,\n            y: event.clientY - rect.top\n        };\n        this.updateTargetGaze();\n        \n        // Notify of interaction\n        if (this.onInteraction) {\n            this.onInteraction('mouse');\n        }\n    }\n    \n    /**\n     * Handle mouse leave\n     */\n    handleMouseLeave() {\n        // Return gaze to center when mouse leaves\n        this.targetGaze = { x: 0, y: 0 };\n        this.isLocked = false;\n        this.proximity = 0;\n        // Reset mouse position to center when leaving\n        this.mousePos = { x: this.canvasCenter.x, y: this.canvasCenter.y };\n    }\n    \n    /**\n     * Handle touch start\n     */\n    handleTouchStart(event) {\n        for (const touch of event.changedTouches) {\n            this.touches.set(touch.identifier, {\n                x: touch.clientX,\n                y: touch.clientY\n            });\n            \n            // Set first touch as primary\n            if (!this.primaryTouch && this.touches.size === 1) {\n                this.primaryTouch = touch.identifier;\n            }\n        }\n        \n        if (this.primaryTouch !== null) {\n            this.updateTouchPosition(event.touches);\n        }\n    }\n    \n    /**\n     * Handle touch move\n     */\n    handleTouchMove(event) {\n        for (const touch of event.changedTouches) {\n            if (this.touches.has(touch.identifier)) {\n                this.touches.set(touch.identifier, {\n                    x: touch.clientX,\n                    y: touch.clientY\n                });\n            }\n        }\n        \n        if (this.primaryTouch !== null) {\n            this.updateTouchPosition(event.touches);\n            \n            // Notify of interaction\n            if (this.onInteraction) {\n                this.onInteraction('touch');\n            }\n        }\n    }\n    \n    /**\n     * Handle touch end\n     */\n    handleTouchEnd(event) {\n        for (const touch of event.changedTouches) {\n            this.touches.delete(touch.identifier);\n            \n            // Reset primary touch if it ended\n            if (touch.identifier === this.primaryTouch) {\n                this.primaryTouch = null;\n                \n                // Select new primary touch if available\n                if (this.touches.size > 0) {\n                    this.primaryTouch = this.touches.keys().next().value;\n                } else {\n                    // No touches left, return to center\n                    this.handleMouseLeave();\n                }\n            }\n        }\n    }\n    \n    /**\n     * Update position from touch\n     */\n    updateTouchPosition(touches) {\n        for (const touch of touches) {\n            if (touch.identifier === this.primaryTouch) {\n                // Use cached rect to avoid reflow on every touch move\n                const rect = this.cachedRect || this.canvas.getBoundingClientRect();\n                this.mousePos = {\n                    x: touch.clientX - rect.left,\n                    y: touch.clientY - rect.top\n                };\n                this.updateTargetGaze();\n                break;\n            }\n        }\n    }\n    \n    /**\n     * Calculate target gaze position based on mouse/touch position\n     */\n    updateTargetGaze() {\n        // Calculate vector from center to mouse\n        const dx = this.mousePos.x - this.canvasCenter.x;\n        const dy = this.mousePos.y - this.canvasCenter.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        \n        // Calculate proximity (0-1, closer = higher)\n        const maxDistance = Math.min(this.canvasCenter.x, this.canvasCenter.y);\n        this.proximity = Math.max(0, 1 - (distance / maxDistance));\n        \n        // Check for gaze lock (very close to center)\n        this.isLocked = distance < this.config.lockDistance;\n        \n        if (this.isLocked) {\n            // When locked, gaze moves more dramatically\n            this.targetGaze = {\n                x: dx * this.config.maxOffset * 2,\n                y: dy * this.config.maxOffset * 2\n            };\n        } else {\n            // Normal gaze following with boundary constraints\n            const maxOffset = Math.min(this.canvasCenter.x, this.canvasCenter.y) * this.config.maxOffset;\n            \n            if (distance > 0) {\n                // Normalize and apply max offset\n                const factor = Math.min(1, distance / maxDistance);\n                this.targetGaze = {\n                    x: (dx / distance) * maxOffset * factor * this.config.boundaryPadding,\n                    y: (dy / distance) * maxOffset * factor * this.config.boundaryPadding\n                };\n            } else {\n                this.targetGaze = { x: 0, y: 0 };\n            }\n        }\n    }\n    \n    /**\n     * Update gaze position with smooth interpolation\n     * @param {number} deltaTime - Time since last update in ms\n     */\n    update(deltaTime) {\n        if (!this.config.enabled) return;\n        \n        // Smooth interpolation towards target\n        const smoothing = 1 - Math.pow(1 - this.config.smoothing, deltaTime / 16.67); // Normalize to 60fps\n        \n        this.currentGaze.x += (this.targetGaze.x - this.currentGaze.x) * smoothing;\n        this.currentGaze.y += (this.targetGaze.y - this.currentGaze.y) * smoothing;\n        \n        // Add micro jitter when locked for liveliness\n        if (this.isLocked) {\n            const jitter = 0.5;\n            this.currentGaze.x += (Math.random() - 0.5) * jitter;\n            this.currentGaze.y += (Math.random() - 0.5) * jitter;\n        }\n    }\n    \n    /**\n     * Get current gaze offset for rendering\n     * @param {number} coreRadius - The radius of the core\n     * @returns {Object} Gaze offset {x, y}\n     */\n    getGazeOffset(coreRadius) {\n        return {\n            x: this.currentGaze.x,\n            y: this.currentGaze.y\n        };\n    }\n    \n    /**\n     * Get current state\n     * @returns {Object} Current gaze state\n     */\n    getState() {\n        return {\n            gaze: { ...this.currentGaze },\n            target: { ...this.targetGaze },\n            proximity: this.proximity,\n            isLocked: this.isLocked,\n            isActive: this.config.enabled\n        };\n    }\n    \n    /**\n     * Enable gaze tracking\n     */\n    enable() {\n        if (!this.config.enabled) {\n            this.config.enabled = true;\n            this.attachEventListeners();\n        }\n    }\n    \n    /**\n     * Disable gaze tracking\n     */\n    disable() {\n        if (this.config.enabled) {\n            this.config.enabled = false;\n            this.detachEventListeners();\n            this.targetGaze = { x: 0, y: 0 };\n        }\n    }\n    \n    /**\n     * Detach event listeners\n     */\n    detachEventListeners() {\n        this.canvas.removeEventListener('mousemove', this.handleMouseMove);\n        this.canvas.removeEventListener('mouseleave', this.handleMouseLeave);\n        this.canvas.removeEventListener('touchstart', this.handleTouchStart);\n        this.canvas.removeEventListener('touchmove', this.handleTouchMove);\n        this.canvas.removeEventListener('touchend', this.handleTouchEnd);\n        this.canvas.removeEventListener('touchcancel', this.handleTouchEnd);\n    }\n    \n    /**\n     * Set interaction callback\n     * @param {Function} callback - Function to call on interaction\n     */\n    setInteractionCallback(callback) {\n        this.onInteraction = callback;\n    }\n    \n    /**\n     * Clean up resources\n     */\n    destroy() {\n        this.detachEventListeners();\n        if (this.resizeObserver) {\n            this.resizeObserver.disconnect();\n        }\n        this.touches.clear();\n    }\n}\n\nexport default GazeTracker;","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                       ◐ ◑ ◒ ◓  IDLE BEHAVIOR  ◓ ◒ ◑ ◐                       \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Idle Behavior - Organic Life Through Subtle Animations\n * @author Emotive Engine Team\n * @version 2.0.0\n * @module IdleBehavior\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Makes the orb feel ALIVE even when you're not interacting. Random blinks,         \n * ║ subtle swaying, gentle breathing - all the little unconscious movements           \n * ║ that make something feel like it has a soul rather than just code.                \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 😴 IDLE ANIMATIONS                                                                \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Blinking     : Random intervals (3-7 seconds)                                   \n * │ • Swaying      : Subtle drift (20-40 second intervals)                            \n * │ • Breathing    : Continuous gentle pulsing                                        \n * │ • Sleep Mode   : After timeout (default: never)                                   \n * │ • Weight Shift : Occasional position adjustments                                  \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ ⏱️ TIMING CONFIGURATION                                                             \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ BEHAVIOR       MIN TIME    MAX TIME    DURATION                                  \n * │ Blinking       3000ms      7000ms      150ms                                     \n * │ Swaying        20000ms     40000ms     4000ms                                    \n * │ Sleep          Infinity    -            -                                        \n * │ Breathing      continuous  -            0.25 rad/s                               \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\n\nclass IdleBehavior {\n    constructor(options = {}) {\n        // Configuration\n        this.config = {\n            blinkInterval: options.blinkInterval || { min: 3000, max: 7000 }, // ms - less frequent\n            blinkDuration: options.blinkDuration || 150, // ms\n            swayInterval: options.swayInterval || { min: 20000, max: 40000 }, // ms - very infrequent weight shifts\n            swayDuration: options.swayDuration || 4000, // ms - very slow, smooth transition\n            swayIntensity: options.swayIntensity || 1.5, // pixels - extremely subtle drift\n            sleepTimeout: options.sleepTimeout !== undefined ? options.sleepTimeout : Infinity, // Default: never auto-sleep\n            breathingSpeed: options.breathingSpeed || 0.25, // radians per second\n            breathingDepth: options.breathingDepth || 0.1, // 10% size variation\n            enabled: options.enabled !== false\n        };\n        \n        // State\n        this.state = {\n            isBlinking: false,\n            isSwaying: false,\n            isAsleep: false,\n            breathingPhase: 0,\n            breathRate: 1.0,\n            breathDepth: this.config.breathingDepth\n        };\n        \n        // Timers\n        this.timers = {\n            idle: 0,\n            blink: 0,\n            sway: 0,\n            swayProgress: 0,  // 0 to 1 progress through sway animation\n            nextBlink: this.getRandomInterval('blink'),\n            nextSway: this.getRandomInterval('sway')\n        };\n        \n        // Sway state - smooth weight shift\n        this.swayOffset = { x: 0, y: 0 };\n        this.swayTarget = { x: 0, y: 0 };\n        this.swayStart = { x: 0, y: 0 };\n        \n        // Callbacks\n        this.callbacks = {\n            onBlink: null,\n            onSway: null,\n            onSleep: null,\n            onWake: null\n        };\n        \n    }\n    \n    /**\n     * Update idle behaviors\n     * @param {number} deltaTime - Time since last update in ms\n     */\n    update(deltaTime) {\n        if (!this.config.enabled) return;\n        \n        // Update breathing\n        this.updateBreathing(deltaTime);\n        \n        // Update idle timer\n        this.timers.idle += deltaTime;\n        \n        // Check for sleep\n        if (!this.state.isAsleep && this.timers.idle >= this.config.sleepTimeout) {\n            this.enterSleep();\n        }\n        \n        // Update blinking (only when awake)\n        if (!this.state.isAsleep) {\n            this.updateBlinking(deltaTime);\n        }\n        \n        // Update swaying (only when awake)\n        if (!this.state.isAsleep) {\n            this.updateSwaying(deltaTime);\n        }\n    }\n    \n    /**\n     * Update breathing animation\n     */\n    updateBreathing(deltaTime) {\n        const speed = this.config.breathingSpeed * this.state.breathRate;\n        this.state.breathingPhase += (speed * deltaTime) / 1000;\n        \n        // Keep phase in reasonable range\n        if (this.state.breathingPhase > Math.PI * 2) {\n            this.state.breathingPhase -= Math.PI * 2;\n        }\n    }\n    \n    /**\n     * Update blinking behavior\n     */\n    updateBlinking(deltaTime) {\n        // Check if blinking is disabled\n        if (!this.isBlinkingEnabled()) {\n            return;\n        }\n        \n        if (!this.state.isBlinking) {\n            // Wait for next blink\n            this.timers.blink += deltaTime;\n            if (this.timers.blink >= this.timers.nextBlink) {\n                this.startBlink();\n            }\n        } else {\n            // Currently blinking\n            this.timers.blink += deltaTime;\n            if (this.timers.blink >= this.config.blinkDuration) {\n                this.endBlink();\n            }\n        }\n    }\n    \n    /**\n     * Update swaying behavior (smooth weight shift)\n     */\n    updateSwaying(deltaTime) {\n        if (!this.state.isSwaying) {\n            // Wait for next sway\n            this.timers.sway += deltaTime;\n            if (this.timers.sway >= this.timers.nextSway) {\n                this.startSway();\n            }\n        } else {\n            // Currently swaying - smooth interpolation\n            this.timers.sway += deltaTime;\n            const progress = Math.min(this.timers.sway / this.config.swayDuration, 1);\n            \n            // Use sine wave for smooth in-out easing\n            const easedProgress = (Math.sin((progress - 0.5) * Math.PI) + 1) / 2;\n            \n            // Interpolate between start and target positions\n            this.swayOffset.x = this.swayStart.x + (this.swayTarget.x - this.swayStart.x) * easedProgress;\n            this.swayOffset.y = this.swayStart.y + (this.swayTarget.y - this.swayStart.y) * easedProgress;\n            \n            if (progress >= 1) {\n                this.endSway();\n            }\n        }\n    }\n    \n    /**\n     * Start a blink\n     */\n    startBlink() {\n        this.state.isBlinking = true;\n        this.timers.blink = 0;\n        \n        if (this.callbacks.onBlink) {\n            this.callbacks.onBlink({ phase: 'start' });\n        }\n    }\n    \n    /**\n     * End a blink\n     */\n    endBlink() {\n        this.state.isBlinking = false;\n        this.timers.blink = 0;\n        this.timers.nextBlink = this.getRandomInterval('blink');\n        \n        if (this.callbacks.onBlink) {\n            this.callbacks.onBlink({ phase: 'end' });\n        }\n    }\n    \n    /**\n     * Start a sway (smooth weight shift)\n     */\n    startSway() {\n        this.state.isSwaying = true;\n        this.timers.sway = 0;\n        \n        // Save current position as start\n        this.swayStart = { ...this.swayOffset };\n        \n        // Generate subtle target offset - like shifting weight\n        // Favor horizontal movement (side to side weight shift)\n        const angle = Math.random() * Math.PI * 2;\n        const distance = this.config.swayIntensity * (0.5 + Math.random() * 0.5);\n        this.swayTarget = {\n            x: Math.cos(angle) * distance * 1.5,  // Slightly more horizontal\n            y: Math.sin(angle) * distance * 0.5   // Less vertical\n        };\n        \n        if (this.callbacks.onSway) {\n            this.callbacks.onSway({ \n                phase: 'start',\n                offset: this.swayOffset\n            });\n        }\n    }\n    \n    /**\n     * End a sway\n     */\n    endSway() {\n        this.state.isSwaying = false;\n        this.timers.sway = 0;\n        this.timers.nextSway = this.getRandomInterval('sway');\n        \n        // Start position for next sway is current position\n        this.swayStart = { ...this.swayOffset };\n        \n        if (this.callbacks.onSway) {\n            this.callbacks.onSway({ \n                phase: 'end',\n                offset: this.swayOffset\n            });\n        }\n    }\n    \n    /**\n     * Enter sleep mode\n     */\n    enterSleep() {\n        this.state.isAsleep = true;\n        this.state.breathRate = 0.5; // Slower breathing\n        this.state.breathDepth = 0.15; // Deeper breaths\n        \n        // Force end any active blink\n        if (this.state.isBlinking) {\n            this.state.isBlinking = false;\n            this.timers.blink = 0;\n            if (this.callbacks.onBlink) {\n                this.callbacks.onBlink({ phase: 'end' });\n            }\n        }\n        \n        \n        if (this.callbacks.onSleep) {\n            this.callbacks.onSleep();\n        }\n    }\n    \n    /**\n     * Wake up from sleep\n     */\n    wakeUp() {\n        if (!this.state.isAsleep) return;\n        \n        this.state.isAsleep = false;\n        this.state.breathRate = 1.0;\n        this.state.breathDepth = this.config.breathingDepth;\n        this.timers.idle = 0; // Reset idle timer\n        \n        \n        // Trigger a shake animation\n        if (this.callbacks.onWake) {\n            this.callbacks.onWake();\n        }\n        \n        // Quick twitch series for wake animation\n        this.performWakeAnimation();\n    }\n    \n    /**\n     * Perform wake-up animation\n     */\n    performWakeAnimation() {\n        // Gentle stretch animation when waking\n        const stretchOffset = {\n            x: this.config.swayIntensity * 0.5,\n            y: -this.config.swayIntensity  // Slight upward stretch\n        };\n        \n        // Animate from current position to stretch and back\n        this.swayStart = { ...this.swayOffset };\n        this.swayTarget = stretchOffset;\n        this.state.isSwaying = true;\n        this.timers.sway = 0;\n        \n        if (this.callbacks.onSway) {\n            this.callbacks.onSway({ \n                phase: 'wake',\n                offset: this.swayOffset\n            });\n        }\n        \n        // Return to neutral after stretch\n        setTimeout(() => {\n            this.swayStart = { ...this.swayOffset };\n            this.swayTarget = { x: 0, y: 0 };\n            this.timers.sway = 0;\n        }, 1000);\n    }\n    \n    /**\n     * Reset idle timer (called on user interaction)\n     */\n    resetIdleTimer() {\n        this.timers.idle = 0;\n        if (this.state.isAsleep) {\n            this.wakeUp();\n        }\n    }\n    \n    /**\n     * Enable or disable blinking\n     * @param {boolean} enabled - Whether blinking should be enabled\n     */\n    setBlinkingEnabled(enabled) {\n        this.config.blinkingEnabled = enabled;\n        if (!enabled && this.state.isBlinking) {\n            // If currently blinking, finish the blink\n            this.endBlink();\n        }\n    }\n    \n    /**\n     * Check if blinking is enabled\n     * @returns {boolean} Whether blinking is enabled\n     */\n    isBlinkingEnabled() {\n        return this.config.blinkingEnabled !== false;\n    }\n    \n    /**\n     * Get breathing factor for current phase\n     * @returns {number} Breathing factor (0.9 - 1.1 typically)\n     */\n    getBreathingFactor() {\n        return 1 + Math.sin(this.state.breathingPhase) * this.state.breathDepth * this.state.breathRate;\n    }\n    \n    /**\n     * Get blink progress (0-1)\n     * @returns {number} Blink progress\n     */\n    getBlinkProgress() {\n        if (!this.state.isBlinking) return 0;\n        return Math.min(this.timers.blink / this.config.blinkDuration, 1);\n    }\n    \n    /**\n     * Get current sway offset\n     * @returns {Object} Sway offset {x, y}\n     */\n    getSwayOffset() {\n        return this.swayOffset || { x: 0, y: 0 };\n    }\n    \n    /**\n     * Get random interval for behavior\n     */\n    getRandomInterval(type) {\n        const interval = this.config[`${type}Interval`];\n        return interval.min + Math.random() * (interval.max - interval.min);\n    }\n    \n    /**\n     * Set callback for behavior events\n     */\n    setCallback(event, callback) {\n        if (this.callbacks.hasOwnProperty(event)) {\n            this.callbacks[event] = callback;\n        }\n    }\n    \n    /**\n     * Get current state\n     */\n    getState() {\n        return {\n            ...this.state,\n            breathingFactor: this.getBreathingFactor(),\n            blinkProgress: this.getBlinkProgress(),\n            swayOffset: this.getSwayOffset()\n        };\n    }\n    \n    /**\n     * Enable idle behaviors\n     */\n    enable() {\n        this.config.enabled = true;\n    }\n    \n    /**\n     * Disable idle behaviors\n     */\n    disable() {\n        this.config.enabled = false;\n        this.state.isBlinking = false;\n        this.state.isSwaying = false;\n        this.swayOffset = { x: 0, y: 0 };\n    }\n    \n    /**\n     * Clean up\n     */\n    destroy() {\n        this.callbacks = {\n            onBlink: null,\n            onSway: null,\n            onSleep: null,\n            onWake: null\n        };\n    }\n}\n\nexport default IdleBehavior;","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                      ♪ ♫ ♬ ♭  MUSIC THEORY SYSTEM  ♭ ♬ ♫ ♪                      \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Music Theory System - Musical Intelligence & Harmonic Generation\n * @author Emotive Engine Team\n * @version 1.0.0\n * @module MusicTheory\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ The MUSICAL BRAIN of the system. Provides comprehensive music theory utilities    \n * ║ for generating scales, chords, progressions, and harmonic relationships that      \n * ║ respond to emotional states and user interactions.                                \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🎼 MUSIC THEORY FEATURES                                                          \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Note frequency calculation (Equal Temperament)                                  \n * │ • Scale generation (Major, Minor, Modal, Exotic)                                  \n * │ • Chord construction (Triads, 7ths, Extensions)                                   \n * │ • Circle of Fifths navigation                                                     \n * │ • Interval relationships                                                          \n * │ • Chord progression generation                                                    \n * │ • Key signature management                                                        \n * │ • Emotion-to-mode mapping                                                         \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\n\nclass MusicTheory {\n    constructor() {\n        // A4 = 440Hz standard tuning\n        this.A4_FREQUENCY = 440;\n        \n        // Note names in chromatic scale\n        this.NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n        \n        // Interval definitions (in semitones)\n        this.INTERVALS = {\n            unison: 0,\n            minorSecond: 1,\n            majorSecond: 2,\n            minorThird: 3,\n            majorThird: 4,\n            perfectFourth: 5,\n            tritone: 6,\n            perfectFifth: 7,\n            minorSixth: 8,\n            majorSixth: 9,\n            minorSeventh: 10,\n            majorSeventh: 11,\n            octave: 12\n        };\n        \n        // Scale patterns (in semitones from root)\n        this.SCALES = {\n            // Traditional scales\n            major: [0, 2, 4, 5, 7, 9, 11],\n            naturalMinor: [0, 2, 3, 5, 7, 8, 10],\n            harmonicMinor: [0, 2, 3, 5, 7, 8, 11],\n            melodicMinor: [0, 2, 3, 5, 7, 9, 11],\n            \n            // Modes\n            ionian: [0, 2, 4, 5, 7, 9, 11],      // Major\n            dorian: [0, 2, 3, 5, 7, 9, 10],      // Minor with raised 6th\n            phrygian: [0, 1, 3, 5, 7, 8, 10],    // Spanish/Flamenco feel\n            lydian: [0, 2, 4, 6, 7, 9, 11],      // Dreamy, ethereal\n            mixolydian: [0, 2, 4, 5, 7, 9, 10],  // Bluesy major\n            aeolian: [0, 2, 3, 5, 7, 8, 10],     // Natural minor\n            locrian: [0, 1, 3, 5, 6, 8, 10],     // Diminished, unstable\n            \n            // Pentatonic scales\n            majorPentatonic: [0, 2, 4, 7, 9],\n            minorPentatonic: [0, 3, 5, 7, 10],\n            \n            // Exotic scales\n            blues: [0, 3, 5, 6, 7, 10],\n            chromatic: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],\n            wholeHalfDiminished: [0, 2, 3, 5, 6, 8, 9, 11],\n            arabic: [0, 1, 4, 5, 7, 8, 11],       // Hijaz scale\n            japanese: [0, 1, 5, 7, 8],            // Hirajoshi scale\n            hungarian: [0, 2, 3, 6, 7, 8, 11],    // Hungarian minor\n            bebopMajor: [0, 2, 4, 5, 7, 8, 9, 11] // Jazz bebop\n        };\n        \n        // Chord patterns (intervals from root)\n        this.CHORDS = {\n            // Triads\n            major: [0, 4, 7],\n            minor: [0, 3, 7],\n            diminished: [0, 3, 6],\n            augmented: [0, 4, 8],\n            sus2: [0, 2, 7],\n            sus4: [0, 5, 7],\n            \n            // Seventh chords\n            maj7: [0, 4, 7, 11],\n            min7: [0, 3, 7, 10],\n            dom7: [0, 4, 7, 10],\n            min7b5: [0, 3, 6, 10],\n            dim7: [0, 3, 6, 9],\n            \n            // Extended chords\n            maj9: [0, 4, 7, 11, 14],\n            min9: [0, 3, 7, 10, 14],\n            dom9: [0, 4, 7, 10, 14],\n            add9: [0, 4, 7, 14],\n            maj11: [0, 4, 7, 11, 14, 17],\n            min11: [0, 3, 7, 10, 14, 17],\n            maj13: [0, 4, 7, 11, 14, 17, 21],\n            min13: [0, 3, 7, 10, 14, 17, 21]\n        };\n        \n        // Emotion to musical mode mapping\n        this.EMOTION_MODES = {\n            excited: {\n                scale: 'lydian',\n                tempo: 140,\n                dynamics: 'forte',\n                articulation: 'staccato'\n            },\n            calm: {\n                scale: 'major',\n                tempo: 60,\n                dynamics: 'piano',\n                articulation: 'legato'\n            },\n            curious: {\n                scale: 'mixolydian',\n                tempo: 100,\n                dynamics: 'mezzoForte',\n                articulation: 'tenuto'\n            },\n            sleepy: {\n                scale: 'aeolian',\n                tempo: 50,\n                dynamics: 'pianissimo',\n                articulation: 'legato'\n            },\n            alert: {\n                scale: 'dorian',\n                tempo: 120,\n                dynamics: 'forte',\n                articulation: 'marcato'\n            },\n            pleased: {\n                scale: 'majorPentatonic',\n                tempo: 90,\n                dynamics: 'mezzoForte',\n                articulation: 'legato'\n            },\n            confused: {\n                scale: 'wholeHalfDiminished',\n                tempo: 80,\n                dynamics: 'mezzoPiano',\n                articulation: 'rubato'\n            },\n            energetic: {\n                scale: 'bebopMajor',\n                tempo: 160,\n                dynamics: 'fortissimo',\n                articulation: 'staccato'\n            },\n            melancholy: {\n                scale: 'harmonicMinor',\n                tempo: 70,\n                dynamics: 'mezzoPiano',\n                articulation: 'legato'\n            },\n            playful: {\n                scale: 'blues',\n                tempo: 110,\n                dynamics: 'mezzoForte',\n                articulation: 'swing'\n            }\n        };\n        \n        // Common chord progressions\n        this.PROGRESSIONS = {\n            // Pop/Rock progressions\n            I_V_vi_IV: [1, 5, 6, 4],           // Most common pop progression\n            I_IV_V: [1, 4, 5],                 // Classic rock/blues\n            ii_V_I: [2, 5, 1],                 // Jazz standard\n            I_vi_IV_V: [1, 6, 4, 5],           // 50s doo-wop\n            vi_IV_I_V: [6, 4, 1, 5],           // Alternative pop\n            \n            // Jazz progressions\n            I_VI_ii_V: [1, 6, 2, 5],           // Rhythm changes A\n            iii_vi_ii_V: [3, 6, 2, 5],         // Turnaround\n            I_ii_iii_IV: [1, 2, 3, 4],         // Modal jazz\n            \n            // Blues progressions\n            I_I_I_I_IV_IV_I_I_V_IV_I_V: [1, 1, 1, 1, 4, 4, 1, 1, 5, 4, 1, 5], // 12-bar blues\n            \n            // Modal progressions\n            i_VII_VI_VII: [1, 7, 6, 7],        // Aeolian vamp\n            I_II_IV_I: [1, 2, 4, 1],           // Lydian progression\n        };\n    }\n    \n    /**\n     * Convert note name to MIDI note number\n     * @param {string} note - Note name (e.g., 'C4', 'A#3')\n     * @returns {number} MIDI note number\n     */\n    noteToMidi(note) {\n        const noteName = note.slice(0, -1);\n        const octave = parseInt(note.slice(-1));\n        const noteIndex = this.NOTES.indexOf(noteName);\n        \n        if (noteIndex === -1) {\n            throw new Error(`Invalid note: ${note}`);\n        }\n        \n        // C4 = MIDI 60\n        return (octave + 1) * 12 + noteIndex;\n    }\n    \n    /**\n     * Convert MIDI note number to frequency\n     * @param {number} midiNote - MIDI note number\n     * @returns {number} Frequency in Hz\n     */\n    midiToFrequency(midiNote) {\n        // f = 440 * 2^((n - 69) / 12)\n        return this.A4_FREQUENCY * Math.pow(2, (midiNote - 69) / 12);\n    }\n    \n    /**\n     * Convert note name to frequency\n     * @param {string} note - Note name (e.g., 'C4', 'A#3')\n     * @returns {number} Frequency in Hz\n     */\n    noteToFrequency(note) {\n        return this.midiToFrequency(this.noteToMidi(note));\n    }\n    \n    /**\n     * Generate a scale from a root note\n     * @param {string} root - Root note (e.g., 'C4')\n     * @param {string} scaleType - Scale type from SCALES\n     * @returns {Array} Array of frequencies\n     */\n    generateScale(root, scaleType = 'major') {\n        const scale = this.SCALES[scaleType];\n        if (!scale) {\n            throw new Error(`Unknown scale type: ${scaleType}`);\n        }\n        \n        const rootMidi = this.noteToMidi(root);\n        return scale.map(interval => this.midiToFrequency(rootMidi + interval));\n    }\n    \n    /**\n     * Generate a chord from a root note\n     * @param {string} root - Root note (e.g., 'C4')\n     * @param {string} chordType - Chord type from CHORDS\n     * @returns {Array} Array of frequencies\n     */\n    generateChord(root, chordType = 'major') {\n        const chord = this.CHORDS[chordType];\n        if (!chord) {\n            throw new Error(`Unknown chord type: ${chordType}`);\n        }\n        \n        const rootMidi = this.noteToMidi(root);\n        return chord.map(interval => this.midiToFrequency(rootMidi + interval));\n    }\n    \n    /**\n     * Generate a chord progression\n     * @param {string} key - Key center (e.g., 'C4')\n     * @param {string} scaleType - Scale type for the key\n     * @param {Array} progression - Array of scale degrees\n     * @returns {Array} Array of chord arrays\n     */\n    generateProgression(key, scaleType = 'major', progression = this.PROGRESSIONS.I_V_vi_IV) {\n        const scale = this.generateScale(key, scaleType);\n        const chords = [];\n        \n        for (const degree of progression) {\n            const chordRoot = scale[(degree - 1) % scale.length];\n            \n            // Determine chord quality based on scale degree\n            let chordType = 'major';\n            if (scaleType === 'major') {\n                if (degree === 2 || degree === 3 || degree === 6) {\n                    chordType = 'minor';\n                } else if (degree === 7) {\n                    chordType = 'diminished';\n                }\n            } else if (scaleType === 'naturalMinor') {\n                if (degree === 1 || degree === 4 || degree === 5) {\n                    chordType = 'minor';\n                } else if (degree === 2) {\n                    chordType = 'diminished';\n                } else {\n                    chordType = 'major';\n                }\n            }\n            \n            // Convert frequency back to note for chord generation\n            const midiNote = Math.round(12 * Math.log2(chordRoot / this.A4_FREQUENCY) + 69);\n            const octave = Math.floor(midiNote / 12) - 1;\n            const noteIndex = midiNote % 12;\n            const noteName = this.NOTES[noteIndex] + octave;\n            \n            chords.push({\n                degree,\n                root: chordRoot,\n                frequencies: this.generateChord(noteName, chordType),\n                type: chordType\n            });\n        }\n        \n        return chords;\n    }\n    \n    /**\n     * Get musical parameters for an emotion\n     * @param {string} emotion - Emotion name\n     * @returns {Object} Musical parameters\n     */\n    getEmotionMusic(emotion) {\n        return this.EMOTION_MODES[emotion] || this.EMOTION_MODES.calm;\n    }\n    \n    /**\n     * Generate Circle of Fifths progression\n     * @param {string} startNote - Starting note\n     * @param {number} steps - Number of steps around the circle\n     * @param {boolean} clockwise - Direction (true = sharps, false = flats)\n     * @returns {Array} Array of note names\n     */\n    circleOfFifths(startNote = 'C', steps = 12, clockwise = true) {\n        const noteBase = startNote.replace(/\\d/, '');\n        let currentIndex = this.NOTES.indexOf(noteBase);\n        const notes = [startNote];\n        \n        for (let i = 1; i < steps; i++) {\n            // Perfect fifth = 7 semitones (clockwise) or 5 semitones (counter-clockwise)\n            currentIndex = clockwise ? \n                (currentIndex + 7) % 12 : \n                (currentIndex + 5) % 12;\n            \n            notes.push(this.NOTES[currentIndex]);\n        }\n        \n        return notes;\n    }\n    \n    /**\n     * Analyze interval between two notes\n     * @param {string} note1 - First note\n     * @param {string} note2 - Second note\n     * @returns {Object} Interval information\n     */\n    analyzeInterval(note1, note2) {\n        const midi1 = this.noteToMidi(note1);\n        const midi2 = this.noteToMidi(note2);\n        const semitones = Math.abs(midi2 - midi1);\n        \n        // Find interval name\n        let intervalName = 'unknown';\n        for (const [name, value] of Object.entries(this.INTERVALS)) {\n            if (value === semitones % 12) {\n                intervalName = name;\n                break;\n            }\n        }\n        \n        return {\n            semitones,\n            intervalName,\n            octaves: Math.floor(semitones / 12),\n            consonant: [0, 3, 4, 5, 7, 8, 9, 12].includes(semitones % 12),\n            ratio: this.getIntervalRatio(semitones % 12)\n        };\n    }\n    \n    /**\n     * Get frequency ratio for an interval\n     * @param {number} semitones - Number of semitones\n     * @returns {string} Simplified ratio\n     */\n    getIntervalRatio(semitones) {\n        const ratios = {\n            0: '1:1',    // Unison\n            1: '16:15',  // Minor second\n            2: '9:8',    // Major second\n            3: '6:5',    // Minor third\n            4: '5:4',    // Major third\n            5: '4:3',    // Perfect fourth\n            6: '45:32',  // Tritone\n            7: '3:2',    // Perfect fifth\n            8: '8:5',    // Minor sixth\n            9: '5:3',    // Major sixth\n            10: '16:9',  // Minor seventh\n            11: '15:8',  // Major seventh\n            12: '2:1'    // Octave\n        };\n        \n        return ratios[semitones] || 'complex';\n    }\n    \n    /**\n     * Generate a melody based on parameters\n     * @param {Object} params - Melody parameters\n     * @returns {Array} Array of note objects with timing\n     */\n    generateMelody(params = {}) {\n        const {\n            key = 'C4',\n            scale = 'major',\n            length = 8,\n            stepProbability = 0.7,  // Probability of stepwise motion\n            restProbability = 0.1    // Probability of rest\n        } = params;\n        \n        const scaleNotes = this.generateScale(key, scale);\n        const melody = [];\n        let currentIndex = 0;\n        \n        for (let i = 0; i < length; i++) {\n            // Decide if this is a rest\n            if (Math.random() < restProbability) {\n                melody.push({ frequency: 0, duration: 0.25, isRest: true });\n                continue;\n            }\n            \n            // Decide step size\n            let nextIndex;\n            if (Math.random() < stepProbability) {\n                // Stepwise motion\n                const direction = Math.random() < 0.5 ? -1 : 1;\n                nextIndex = Math.max(0, Math.min(scaleNotes.length - 1, currentIndex + direction));\n            } else {\n                // Leap\n                const leap = Math.floor(Math.random() * 3) + 2; // 2-4 scale degrees\n                const direction = Math.random() < 0.5 ? -1 : 1;\n                nextIndex = Math.max(0, Math.min(scaleNotes.length - 1, currentIndex + (leap * direction)));\n            }\n            \n            currentIndex = nextIndex;\n            \n            // Random duration\n            const durations = [0.25, 0.5, 0.75, 1];\n            const duration = durations[Math.floor(Math.random() * durations.length)];\n            \n            melody.push({\n                frequency: scaleNotes[currentIndex],\n                duration,\n                isRest: false\n            });\n        }\n        \n        return melody;\n    }\n}\n\nexport default MusicTheory;","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                      ♬ ♭ ♮ ♯  HARMONIC SYSTEM  ♯ ♮ ♭ ♬                      \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Harmonic System - Real-time Musical Intelligence\n * @author Emotive Engine Team\n * @version 1.0.0\n * @module HarmonicSystem\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ The CONDUCTOR of musical experiences. Orchestrates the music theory system with   \n * ║ the sound engine to create emotionally-responsive, harmonically-rich audio that   \n * ║ adapts in real-time to mascot states and user interactions.                       \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🎭 HARMONIC FEATURES                                                              \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Real-time harmonic generation                                                   \n * │ • Emotion-driven key modulation                                                   \n * │ • Adaptive tempo and dynamics                                                     \n * │ • Gesture-to-chord mapping                                                        \n * │ • Harmonic tension and release                                                    \n * │ • Polyrhythmic patterns                                                           \n * │ • Voice leading and smooth transitions                                            \n * │ • Ambient pad generation                                                          \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\n\nimport MusicTheory from './MusicTheory.js';\n\nclass HarmonicSystem {\n    constructor(audioContext) {\n        this.audioContext = audioContext;\n        this.musicTheory = new MusicTheory();\n        \n        // Current musical state\n        this.currentKey = 'C4';\n        this.currentScale = 'major';\n        this.currentTempo = 120; // BPM\n        this.currentEmotion = 'calm';\n        \n        // Active voices (oscillators and gains)\n        this.voices = new Map();\n        \n        // Harmonic layers\n        this.layers = {\n            bass: { active: false, gain: 0.3 },\n            chord: { active: false, gain: 0.2 },\n            melody: { active: false, gain: 0.4 },\n            pad: { active: false, gain: 0.15 }\n        };\n        \n        // Master output\n        this.masterGain = this.audioContext.createGain();\n        this.masterGain.gain.value = 0.5;\n        this.masterGain.connect(this.audioContext.destination);\n        \n        // Effects chain\n        this.reverb = this.createReverb();\n        this.delay = this.createDelay();\n        this.filter = this.createFilter();\n        \n        // Connect effects\n        this.filter.connect(this.delay);\n        this.delay.connect(this.reverb);\n        this.reverb.connect(this.masterGain);\n        \n        // Dry signal path\n        this.dryGain = this.audioContext.createGain();\n        this.dryGain.gain.value = 0.7;\n        this.dryGain.connect(this.masterGain);\n        \n        // Wet signal path\n        this.wetGain = this.audioContext.createGain();\n        this.wetGain.gain.value = 0.3;\n        this.wetGain.connect(this.filter);\n        \n        // Rhythm tracking\n        this.nextNoteTime = 0;\n        this.noteResolution = 0; // 0 = 16th, 1 = 8th, 2 = quarter\n        this.noteLength = 0.05; // Length of \"beep\" (staccato)\n        \n        // Sequence tracking\n        this.currentChordIndex = 0;\n        this.currentMelodyNote = 0;\n        this.progression = null;\n        \n        // Performance optimization\n        this.isPlaying = false;\n        this.lookahead = 25.0; // How frequently to call scheduling function (ms)\n        this.scheduleAheadTime = 0.1; // How far ahead to schedule audio (sec)\n    }\n    \n    /**\n     * Create reverb effect using convolver\n     */\n    createReverb() {\n        const convolver = this.audioContext.createConvolver();\n        const length = this.audioContext.sampleRate * 2; // 2 second reverb\n        const impulse = this.audioContext.createBuffer(2, length, this.audioContext.sampleRate);\n        \n        for (let channel = 0; channel < 2; channel++) {\n            const channelData = impulse.getChannelData(channel);\n            for (let i = 0; i < length; i++) {\n                // Exponential decay\n                channelData[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 2);\n            }\n        }\n        \n        convolver.buffer = impulse;\n        return convolver;\n    }\n    \n    /**\n     * Create delay effect\n     */\n    createDelay() {\n        const delay = this.audioContext.createDelay(1.0);\n        delay.delayTime.value = 0.15; // 150ms delay\n        \n        const feedback = this.audioContext.createGain();\n        feedback.gain.value = 0.3;\n        \n        delay.connect(feedback);\n        feedback.connect(delay);\n        \n        return delay;\n    }\n    \n    /**\n     * Create filter for tone shaping\n     */\n    createFilter() {\n        const filter = this.audioContext.createBiquadFilter();\n        filter.type = 'lowpass';\n        filter.frequency.value = 2000;\n        filter.Q.value = 1;\n        return filter;\n    }\n    \n    /**\n     * Update emotion and adapt musical parameters\n     */\n    setEmotion(emotion) {\n        this.currentEmotion = emotion;\n        const musicParams = this.musicTheory.getEmotionMusic(emotion);\n        \n        // Update scale and tempo\n        this.currentScale = musicParams.scale;\n        this.currentTempo = musicParams.tempo;\n        \n        // Adapt filter based on emotion\n        const filterSettings = {\n            excited: { freq: 4000, Q: 2 },\n            calm: { freq: 1500, Q: 0.7 },\n            curious: { freq: 2500, Q: 1.5 },\n            sleepy: { freq: 800, Q: 0.5 },\n            alert: { freq: 3000, Q: 1.8 },\n            energetic: { freq: 5000, Q: 2.5 }\n        };\n        \n        const settings = filterSettings[emotion] || { freq: 2000, Q: 1 };\n        this.filter.frequency.exponentialRampToValueAtTime(\n            settings.freq,\n            this.audioContext.currentTime + 0.5\n        );\n        this.filter.Q.linearRampToValueAtTime(\n            settings.Q,\n            this.audioContext.currentTime + 0.5\n        );\n        \n        // Generate new progression for this emotion\n        this.generateEmotionProgression();\n    }\n    \n    /**\n     * Generate chord progression based on current emotion\n     */\n    generateEmotionProgression() {\n        const progressionMap = {\n            excited: 'I_V_vi_IV',\n            calm: 'I_vi_IV_V',\n            curious: 'ii_V_I',\n            sleepy: 'vi_IV_I_V',\n            alert: 'I_IV_V',\n            energetic: 'I_V_vi_IV'\n        };\n        \n        const progressionType = progressionMap[this.currentEmotion] || 'I_V_vi_IV';\n        this.progression = this.musicTheory.generateProgression(\n            this.currentKey,\n            this.currentScale,\n            this.musicTheory.PROGRESSIONS[progressionType]\n        );\n    }\n    \n    /**\n     * Play a chord with voice leading\n     */\n    playChord(frequencies, duration = 1.0, attack = 0.01) {\n        const startTime = this.audioContext.currentTime;\n        const chordGain = this.audioContext.createGain();\n        \n        // ADSR envelope\n        chordGain.gain.setValueAtTime(0, startTime);\n        chordGain.gain.linearRampToValueAtTime(this.layers.chord.gain, startTime + attack);\n        chordGain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);\n        \n        // Connect to wet/dry mix\n        chordGain.connect(this.dryGain);\n        chordGain.connect(this.wetGain);\n        \n        // Create oscillators for each note\n        const oscillators = frequencies.map((freq, index) => {\n            const osc = this.audioContext.createOscillator();\n            osc.frequency.value = freq;\n            \n            // Different waveforms for different voices\n            if (index === 0) osc.type = 'sine';        // Root\n            else if (index === 1) osc.type = 'triangle'; // Third\n            else osc.type = 'sawtooth';                // Fifth and extensions\n            \n            // Slight detuning for richness\n            osc.detune.value = (Math.random() - 0.5) * 10;\n            \n            osc.connect(chordGain);\n            osc.start(startTime);\n            osc.stop(startTime + duration);\n            \n            return osc;\n        });\n        \n        // Store for potential manipulation\n        const chordId = `chord_${Date.now()}`;\n        this.voices.set(chordId, { oscillators, gain: chordGain });\n        \n        // Cleanup\n        setTimeout(() => {\n            this.voices.delete(chordId);\n        }, (duration + 0.1) * 1000);\n    }\n    \n    /**\n     * Play a melodic sequence\n     */\n    playMelody(notes, baseTime = 0) {\n        const startTime = baseTime || this.audioContext.currentTime;\n        let currentTime = startTime;\n        \n        notes.forEach((note, index) => {\n            if (note.isRest) {\n                currentTime += note.duration;\n                return;\n            }\n            \n            const osc = this.audioContext.createOscillator();\n            const noteGain = this.audioContext.createGain();\n            \n            osc.frequency.value = note.frequency;\n            osc.type = 'sine';\n            \n            // Vibrato for expressiveness\n            const vibrato = this.audioContext.createOscillator();\n            const vibratoGain = this.audioContext.createGain();\n            vibrato.frequency.value = 5; // 5 Hz vibrato\n            vibratoGain.gain.value = 5; // 5 cents depth\n            \n            vibrato.connect(vibratoGain);\n            vibratoGain.connect(osc.frequency);\n            \n            // Note envelope\n            noteGain.gain.setValueAtTime(0, currentTime);\n            noteGain.gain.linearRampToValueAtTime(this.layers.melody.gain, currentTime + 0.01);\n            noteGain.gain.exponentialRampToValueAtTime(0.01, currentTime + note.duration * 0.9);\n            \n            osc.connect(noteGain);\n            noteGain.connect(this.dryGain);\n            noteGain.connect(this.wetGain);\n            \n            osc.start(currentTime);\n            osc.stop(currentTime + note.duration);\n            vibrato.start(currentTime);\n            vibrato.stop(currentTime + note.duration);\n            \n            currentTime += note.duration;\n        });\n    }\n    \n    /**\n     * Create ambient pad layer\n     */\n    createPad(frequency, duration = 4.0) {\n        const startTime = this.audioContext.currentTime;\n        const voices = 4; // Number of detuned voices\n        const padGain = this.audioContext.createGain();\n        \n        // Slow attack and release for pad\n        padGain.gain.setValueAtTime(0, startTime);\n        padGain.gain.linearRampToValueAtTime(this.layers.pad.gain, startTime + 1.0);\n        padGain.gain.linearRampToValueAtTime(this.layers.pad.gain, startTime + duration - 1.0);\n        padGain.gain.linearRampToValueAtTime(0, startTime + duration);\n        \n        padGain.connect(this.wetGain); // Pads sound better with effects\n        \n        for (let i = 0; i < voices; i++) {\n            const osc = this.audioContext.createOscillator();\n            osc.frequency.value = frequency;\n            osc.type = 'sawtooth';\n            \n            // Detune each voice\n            osc.detune.value = (i - voices / 2) * 15;\n            \n            // Individual voice gain for stereo spread\n            const voiceGain = this.audioContext.createGain();\n            voiceGain.gain.value = 1 / voices;\n            \n            // Add slow LFO for movement\n            const lfo = this.audioContext.createOscillator();\n            const lfoGain = this.audioContext.createGain();\n            lfo.frequency.value = 0.2 + (i * 0.1); // Slightly different LFO rates\n            lfoGain.gain.value = 10; // Subtle pitch modulation\n            \n            lfo.connect(lfoGain);\n            lfoGain.connect(osc.frequency);\n            \n            osc.connect(voiceGain);\n            voiceGain.connect(padGain);\n            \n            osc.start(startTime);\n            osc.stop(startTime + duration);\n            lfo.start(startTime);\n            lfo.stop(startTime + duration);\n        }\n    }\n    \n    /**\n     * Map gesture to musical response\n     */\n    playGestureSound(gesture) {\n        const gestureMap = {\n            breathe: () => {\n                // Breathing creates slow, expanding chords\n                const chord = this.musicTheory.generateChord(this.currentKey, 'maj7');\n                this.playChord(chord, 2.0, 0.5);\n                this.createPad(chord[0] / 2, 3.0); // Sub bass pad\n            },\n            \n            excited: () => {\n                // Excited creates ascending arpeggios\n                const scale = this.musicTheory.generateScale(this.currentKey, 'lydian');\n                const arpeggio = scale.map((freq, i) => ({\n                    frequency: freq,\n                    duration: 0.1,\n                    isRest: false\n                }));\n                this.playMelody(arpeggio);\n            },\n            \n            wave: () => {\n                // Wave creates a glissando effect\n                const startFreq = this.musicTheory.noteToFrequency(this.currentKey);\n                const endFreq = startFreq * 2; // Octave up\n                \n                const osc = this.audioContext.createOscillator();\n                const gain = this.audioContext.createGain();\n                \n                osc.frequency.setValueAtTime(startFreq, this.audioContext.currentTime);\n                osc.frequency.exponentialRampToValueAtTime(endFreq, this.audioContext.currentTime + 0.5);\n                osc.frequency.exponentialRampToValueAtTime(startFreq, this.audioContext.currentTime + 1.0);\n                \n                gain.gain.setValueAtTime(0, this.audioContext.currentTime);\n                gain.gain.linearRampToValueAtTime(0.3, this.audioContext.currentTime + 0.1);\n                gain.gain.linearRampToValueAtTime(0.3, this.audioContext.currentTime + 0.9);\n                gain.gain.linearRampToValueAtTime(0, this.audioContext.currentTime + 1.0);\n                \n                osc.connect(gain);\n                gain.connect(this.wetGain);\n                \n                osc.start();\n                osc.stop(this.audioContext.currentTime + 1.0);\n            },\n            \n            morph: () => {\n                // Morph creates harmonic morphing between chords\n                const chord1 = this.musicTheory.generateChord(this.currentKey, 'minor');\n                const chord2 = this.musicTheory.generateChord(this.currentKey, 'major');\n                \n                // Play first chord\n                this.playChord(chord1, 0.5);\n                \n                // Morph to second chord\n                setTimeout(() => {\n                    this.playChord(chord2, 1.0);\n                }, 400);\n            },\n            \n            jump: () => {\n                // Jump creates staccato chord stabs\n                const chord = this.musicTheory.generateChord(this.currentKey, 'dom7');\n                for (let i = 0; i < 3; i++) {\n                    setTimeout(() => {\n                        this.playChord(chord.map(f => f * Math.pow(2, i/12)), 0.1, 0.001);\n                    }, i * 100);\n                }\n            },\n            \n            curious: () => {\n                // Curious creates questioning melodic phrases\n                const melody = this.musicTheory.generateMelody({\n                    key: this.currentKey,\n                    scale: 'mixolydian',\n                    length: 5,\n                    stepProbability: 0.3\n                });\n                this.playMelody(melody);\n            }\n        };\n        \n        const soundFunction = gestureMap[gesture];\n        if (soundFunction) {\n            soundFunction();\n        }\n    }\n    \n    /**\n     * Start background harmony generation\n     */\n    startHarmony() {\n        if (this.isPlaying) return;\n        \n        this.isPlaying = true;\n        this.currentChordIndex = 0;\n        this.nextNoteTime = this.audioContext.currentTime;\n        \n        // Generate initial progression\n        this.generateEmotionProgression();\n        \n        // Start the scheduling loop\n        this.scheduleHarmony();\n    }\n    \n    /**\n     * Schedule harmony playback\n     */\n    scheduleHarmony() {\n        if (!this.isPlaying) return;\n        \n        // Schedule notes that need to play in the next interval\n        while (this.nextNoteTime < this.audioContext.currentTime + this.scheduleAheadTime) {\n            // Play current chord in progression\n            if (this.progression && this.layers.chord.active) {\n                const chord = this.progression[this.currentChordIndex];\n                this.playChord(chord.frequencies, 0.5);\n                \n                // Advance to next chord\n                this.currentChordIndex = (this.currentChordIndex + 1) % this.progression.length;\n            }\n            \n            // Generate and play bass line\n            if (this.layers.bass.active && this.progression) {\n                const bassNote = this.progression[this.currentChordIndex].frequencies[0] / 2;\n                this.playBassNote(bassNote, 0.25);\n            }\n            \n            // Advance time based on tempo\n            const secondsPerBeat = 60.0 / this.currentTempo;\n            this.nextNoteTime += 0.25 * secondsPerBeat; // 16th notes\n        }\n        \n        // Continue scheduling\n        setTimeout(() => this.scheduleHarmony(), this.lookahead);\n    }\n    \n    /**\n     * Play a bass note\n     */\n    playBassNote(frequency, duration) {\n        const osc = this.audioContext.createOscillator();\n        const gain = this.audioContext.createGain();\n        \n        osc.frequency.value = frequency;\n        osc.type = 'sine';\n        \n        gain.gain.setValueAtTime(0, this.audioContext.currentTime);\n        gain.gain.linearRampToValueAtTime(this.layers.bass.gain, this.audioContext.currentTime + 0.01);\n        gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);\n        \n        osc.connect(gain);\n        gain.connect(this.dryGain);\n        \n        osc.start();\n        osc.stop(this.audioContext.currentTime + duration);\n    }\n    \n    /**\n     * Stop harmony generation\n     */\n    stopHarmony() {\n        this.isPlaying = false;\n    }\n    \n    /**\n     * Set layer active state\n     */\n    setLayerActive(layer, active) {\n        if (this.layers[layer]) {\n            this.layers[layer].active = active;\n        }\n    }\n    \n    /**\n     * Set master volume\n     */\n    setMasterVolume(volume) {\n        this.masterGain.gain.exponentialRampToValueAtTime(\n            Math.max(0.01, volume),\n            this.audioContext.currentTime + 0.1\n        );\n    }\n    \n    /**\n     * Set wet/dry mix for effects\n     */\n    setEffectsMix(wetness) {\n        const dry = 1 - wetness;\n        this.dryGain.gain.linearRampToValueAtTime(dry, this.audioContext.currentTime + 0.1);\n        this.wetGain.gain.linearRampToValueAtTime(wetness, this.audioContext.currentTime + 0.1);\n    }\n}\n\nexport default HarmonicSystem;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                       ◐ ◑ ◒ ◓  SOUND SYSTEM  ◓ ◒ ◑ ◐                       \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Sound System - Web Audio API Integration for Emotional Audio\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module SoundSystem\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Adds the VOICE of emotion through sound. Generates ambient tones that match       \r\n * ║ emotional states and plays gesture sound effects. Uses Web Audio API for          \r\n * ║ programmatic sound generation - no external audio files needed!                   \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎵 AUDIO FEATURES                                                                  \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Emotional ambient tones (frequency based on emotion)                            \r\n * │ • Gesture sound effects (pops, sweeps, chimes)                                    \r\n * │ • Volume control with fade in/out                                                 \r\n * │ • Warning throttling to reduce console spam                                       \r\n * │ • Graceful degradation if Web Audio unavailable                                   \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎼 EMOTIONAL TONE MAPPING                                                          \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ EMOTION        FREQUENCY    WAVEFORM    VOLUME                                   \r\n * │ neutral        220Hz        sine        0.1                                      \r\n * │ joy            440Hz        sine        0.15                                     \r\n * │ sadness        110Hz        sine        0.08                                     \r\n * │ anger          330Hz        sawtooth    0.2                                      \r\n * │ fear           550Hz        square      0.12                                     \r\n * │ love           262Hz        sine        0.12                                     \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\nimport HarmonicSystem from './HarmonicSystem.js';\r\n\r\nexport class SoundSystem {\r\n  constructor() {\r\n    this.context = null;\r\n    this.isEnabled = false;\r\n    this.isInitialized = false;\r\n    \r\n    // Audio nodes\r\n    this.nodes = {\r\n      master: null,      // Master gain node\r\n      ambient: null,     // Ambient oscillator for emotional tones\r\n      effects: null      // Effects gain node for gesture sounds\r\n    };\r\n    \r\n    // Harmonic system for musical intelligence\r\n    this.harmonicSystem = null;\r\n    this.useHarmonicSystem = false; // Toggle between old and new system\r\n    \r\n    // Track warning frequency to reduce spam\r\n    this.warningTimestamps = {};\r\n    this.warningThrottle = 5000; // Only show same warning every 5 seconds\r\n    \r\n    // Current ambient oscillator\r\n    this.currentOscillator = null;\r\n    this.currentGain = null;\r\n    \r\n    // Default settings\r\n    this.masterVolume = 0.5;\r\n    this.ambientVolume = 0.1;\r\n    \r\n    // Emotional tone mappings\r\n    this.emotionalTones = new Map([\r\n      ['neutral', { frequency: 220, waveform: 'sine', volume: 0.1 }],\r\n      ['joy', { frequency: 440, waveform: 'triangle', volume: 0.15 }],\r\n      ['sadness', { frequency: 165, waveform: 'sine', volume: 0.08 }],\r\n      ['anger', { frequency: 330, waveform: 'sawtooth', volume: 0.12 }],\r\n      ['fear', { frequency: 880, waveform: 'square', volume: 0.09 }],\r\n      ['surprise', { frequency: 660, waveform: 'triangle', volume: 0.13 }],\r\n      ['disgust', { frequency: 110, waveform: 'sawtooth', volume: 0.07 }],\r\n      ['love', { frequency: 528, waveform: 'sine', volume: 0.11 }]\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Initialize Web Audio API and create node architecture\r\n   * @returns {boolean} Success status\r\n   */\r\n  async initialize() {\r\n    try {\r\n      // Check for Web Audio API support\r\n      const AudioContextClass = window.AudioContext || window.webkitAudioContext;\r\n      if (!AudioContextClass) {\r\n        // SoundSystem: Web Audio API not supported, continuing without audio\r\n        return false;\r\n      }\r\n\r\n      // Create audio context\r\n      this.context = new AudioContextClass();\r\n      \r\n      // Initialize harmonic system\r\n      this.harmonicSystem = new HarmonicSystem(this.context);\r\n      \r\n      // Handle suspended context (required by browser autoplay policies)\r\n      if (this.context.state === 'suspended') {\r\n        // Will be resumed on first user interaction\r\n        // SoundSystem: AudioContext suspended, will resume on user interaction\r\n      }\r\n\r\n      // Create master gain node with default volume\r\n      this.nodes.master = this.context.createGain();\r\n      this.nodes.master.gain.setValueAtTime(this.masterVolume, this.context.currentTime);\r\n      this.nodes.master.connect(this.context.destination);\r\n\r\n      // Create effects gain node for gesture sounds\r\n      this.nodes.effects = this.context.createGain();\r\n      this.nodes.effects.gain.setValueAtTime(1.0, this.context.currentTime);\r\n      this.nodes.effects.connect(this.nodes.master);\r\n\r\n      this.isEnabled = true;\r\n      this.isInitialized = true;\r\n      \r\n      // SoundSystem: Successfully initialized Web Audio API\r\n      return true;\r\n\r\n    } catch (error) {\r\n      // SoundSystem: Failed to initialize Web Audio API\r\n      this.isEnabled = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resume audio context if suspended (call on user interaction)\r\n   */\r\n  async resumeContext() {\r\n    if (this.context && this.context.state === 'suspended') {\r\n      try {\r\n        await this.context.resume();\r\n        // Silently resume without logging\r\n      } catch (error) {\r\n        // Silently fail - this is expected before user interaction\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set master volume for all audio output\r\n   * @param {number} volume - Volume level (0.0 to 1.0)\r\n   * @param {string} currentEmotion - Current emotion for ambient tone volume update\r\n   */\r\n  setMasterVolume(volume, currentEmotion = null) {\r\n    this.masterVolume = Math.max(0, Math.min(1, volume));\r\n    \r\n    if (this.isEnabled && this.nodes.master) {\r\n      this.nodes.master.gain.setValueAtTime(\r\n        this.masterVolume, \r\n        this.context.currentTime\r\n      );\r\n\r\n      // Update ambient tone volume if active\r\n      if (currentEmotion) {\r\n        this.updateAmbientVolume(currentEmotion);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current master volume\r\n   * @returns {number} Current master volume\r\n   */\r\n  getMasterVolume() {\r\n    return this.masterVolume;\r\n  }\r\n\r\n  /**\r\n   * Check if sound system is available and enabled\r\n   * @returns {boolean} Availability status\r\n   */\r\n  isAvailable() {\r\n    return this.isEnabled && this.isInitialized;\r\n  }\r\n  \r\n  /**\r\n   * Enable or disable the harmonic music system\r\n   * @param {boolean} enabled - Whether to enable harmonic system\r\n   */\r\n  setHarmonicMode(enabled) {\r\n    this.useHarmonicSystem = enabled;\r\n    \r\n    if (enabled && this.harmonicSystem) {\r\n      // Stop simple ambient tone when switching to harmonic mode\r\n      this.stopAmbientTone();\r\n      // SoundSystem: Switched to harmonic music mode\r\n    } else if (!enabled && this.harmonicSystem) {\r\n      // Stop harmonic system when switching back\r\n      this.harmonicSystem.stopHarmony();\r\n      // SoundSystem: Switched to simple sound mode\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Start harmonic background music\r\n   */\r\n  startHarmony() {\r\n    if (this.harmonicSystem && this.useHarmonicSystem && this.isAvailable()) {\r\n      this.harmonicSystem.startHarmony();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Stop harmonic background music\r\n   */\r\n  stopHarmony() {\r\n    if (this.harmonicSystem) {\r\n      this.harmonicSystem.stopHarmony();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Set harmonic layer active state\r\n   * @param {string} layer - Layer name (bass, chord, melody, pad)\r\n   * @param {boolean} active - Whether layer should be active\r\n   */\r\n  setHarmonicLayer(layer, active) {\r\n    if (this.harmonicSystem) {\r\n      this.harmonicSystem.setLayerActive(layer, active);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Set harmonic effects mix\r\n   * @param {number} wetness - Wet/dry mix (0-1)\r\n   */\r\n  setHarmonicEffects(wetness) {\r\n    if (this.harmonicSystem) {\r\n      this.harmonicSystem.setEffectsMix(wetness);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up audio resources\r\n   */\r\n  cleanup() {\r\n    try {\r\n      // Stop current ambient oscillator\r\n      if (this.currentOscillator) {\r\n        this.currentOscillator.stop();\r\n        this.currentOscillator = null;\r\n      }\r\n      \r\n      if (this.currentGain) {\r\n        this.currentGain = null;\r\n      }\r\n\r\n      // Close audio context\r\n      if (this.context && this.context.state !== 'closed') {\r\n        this.context.close();\r\n      }\r\n\r\n      // SoundSystem: Cleaned up audio resources\r\n    } catch (error) {\r\n      // SoundSystem: Error during cleanup\r\n    } finally {\r\n      // Always reset state regardless of errors\r\n      this.context = null;\r\n      this.nodes = { master: null, ambient: null, effects: null };\r\n      this.currentOscillator = null;\r\n      this.currentGain = null;\r\n      this.isEnabled = false;\r\n      this.isInitialized = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get emotional tone configuration for given emotion\r\n   * @param {string} emotion - Emotion name\r\n   * @returns {Object|null} Tone configuration or null if not found\r\n   */\r\n  getEmotionalTone(emotion) {\r\n    return this.emotionalTones.get(emotion) || null;\r\n  }\r\n\r\n  /**\r\n   * Start ambient emotional tone for given emotion\r\n   * @param {string} emotion - Emotion name\r\n   * @param {number} transitionDuration - Transition duration in milliseconds (default: 500)\r\n   */\r\n  setAmbientTone(emotion, transitionDuration = 500) {\r\n    if (!this.isAvailable()) {\r\n      return;\r\n    }\r\n\r\n    // Use harmonic system if enabled\r\n    if (this.useHarmonicSystem && this.harmonicSystem) {\r\n      this.harmonicSystem.setEmotion(emotion);\r\n      return;\r\n    }\r\n\r\n    const toneConfig = this.getEmotionalTone(emotion);\r\n    if (!toneConfig) {\r\n      // SoundSystem: Unknown emotion, cannot set ambient tone\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Resume context if suspended\r\n      this.resumeContext();\r\n\r\n      const currentTime = this.context.currentTime;\r\n      const transitionTime = transitionDuration / 1000; // Convert to seconds\r\n\r\n      // Stop current oscillator with fade out\r\n      if (this.currentOscillator && this.currentGain) {\r\n        this.currentGain.gain.exponentialRampToValueAtTime(0.001, currentTime + transitionTime * 0.5);\r\n        this.currentOscillator.stop(currentTime + transitionTime * 0.5);\r\n      }\r\n\r\n      // Create new oscillator and gain for the new tone\r\n      const oscillator = this.context.createOscillator();\r\n      const gainNode = this.context.createGain();\r\n\r\n      // Configure oscillator\r\n      oscillator.type = toneConfig.waveform;\r\n      oscillator.frequency.setValueAtTime(toneConfig.frequency, currentTime);\r\n\r\n      // Configure gain with smooth transition\r\n      const targetVolume = toneConfig.volume * this.masterVolume;\r\n      gainNode.gain.setValueAtTime(0.001, currentTime); // Start silent\r\n      gainNode.gain.exponentialRampToValueAtTime(targetVolume, currentTime + transitionTime);\r\n\r\n      // Connect nodes\r\n      oscillator.connect(gainNode);\r\n      gainNode.connect(this.nodes.master);\r\n\r\n      // Start oscillator\r\n      oscillator.start(currentTime);\r\n\r\n      // Store references\r\n      this.currentOscillator = oscillator;\r\n      this.currentGain = gainNode;\r\n\r\n      // SoundSystem: Started ambient tone\r\n\r\n    } catch (error) {\r\n      // SoundSystem: Failed to set ambient tone\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop current ambient tone\r\n   * @param {number} fadeOutDuration - Fade out duration in milliseconds (default: 500)\r\n   */\r\n  stopAmbientTone(fadeOutDuration = 500) {\r\n    if (!this.isAvailable() || !this.currentOscillator) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const currentTime = this.context.currentTime;\r\n      const fadeTime = fadeOutDuration / 1000; // Convert to seconds\r\n\r\n      // Fade out current tone\r\n      if (this.currentGain) {\r\n        this.currentGain.gain.exponentialRampToValueAtTime(0.001, currentTime + fadeTime);\r\n      }\r\n\r\n      // Stop oscillator after fade\r\n      this.currentOscillator.stop(currentTime + fadeTime);\r\n\r\n      // Clear references\r\n      this.currentOscillator = null;\r\n      this.currentGain = null;\r\n\r\n      // SoundSystem: Stopped ambient tone\r\n\r\n    } catch (error) {\r\n      // SoundSystem: Failed to stop ambient tone\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update ambient tone volume based on master volume changes\r\n   * @param {string} currentEmotion - Current emotion for volume calculation\r\n   */\r\n  updateAmbientVolume(currentEmotion) {\r\n    if (!this.isAvailable() || !this.currentGain || !currentEmotion) {\r\n      return;\r\n    }\r\n\r\n    const toneConfig = this.getEmotionalTone(currentEmotion);\r\n    if (!toneConfig) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const targetVolume = toneConfig.volume * this.masterVolume;\r\n      const currentTime = this.context.currentTime;\r\n      \r\n      this.currentGain.gain.exponentialRampToValueAtTime(targetVolume, currentTime + 0.1);\r\n    } catch (error) {\r\n      // SoundSystem: Failed to update ambient volume\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Play gesture sound effect with frequency envelope\r\n   * @param {string} gestureId - Gesture identifier\r\n   * @param {string} emotionalContext - Current emotion for intensity modifiers\r\n   */\r\n  playGestureSound(gestureId, emotionalContext = 'neutral') {\r\n    if (!this.isAvailable()) {\r\n      return;\r\n    }\r\n\r\n    // Use harmonic system if enabled\r\n    if (this.useHarmonicSystem && this.harmonicSystem) {\r\n      this.harmonicSystem.playGestureSound(gestureId);\r\n      return;\r\n    }\r\n\r\n    const soundConfig = this.getGestureSoundConfig(gestureId);\r\n    if (!soundConfig) {\r\n      // Throttled warning for unknown gestures\r\n      this.throttledWarn(`Unknown gesture \"${gestureId}\", cannot play sound`, `gesture_${gestureId}`);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Resume context if suspended\r\n      this.resumeContext();\r\n\r\n      const currentTime = this.context.currentTime;\r\n      const duration = soundConfig.duration / 1000; // Convert to seconds\r\n\r\n      // Apply emotional modifiers\r\n      const modifiers = this.getEmotionalModifiers(emotionalContext);\r\n      const baseVolume = soundConfig.volume * this.masterVolume * modifiers.intensity;\r\n\r\n      // Create oscillator and gain for the effect\r\n      const oscillator = this.context.createOscillator();\r\n      const gainNode = this.context.createGain();\r\n\r\n      // Configure oscillator\r\n      oscillator.type = soundConfig.waveform;\r\n\r\n      // Apply frequency envelope\r\n      this.applyFrequencyEnvelope(oscillator, soundConfig.frequencyEnvelope, currentTime, duration);\r\n\r\n      // Apply volume envelope\r\n      this.applyVolumeEnvelope(gainNode, soundConfig.volumeEnvelope, currentTime, duration, baseVolume);\r\n\r\n      // Connect nodes\r\n      oscillator.connect(gainNode);\r\n      gainNode.connect(this.nodes.effects);\r\n\r\n      // Start and stop oscillator\r\n      oscillator.start(currentTime);\r\n      oscillator.stop(currentTime + duration);\r\n\r\n      // SoundSystem: Playing gesture sound\r\n\r\n    } catch (error) {\r\n      // SoundSystem: Failed to play gesture sound\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get gesture sound configuration\r\n   * @param {string} gestureId - Gesture identifier\r\n   * @returns {Object|null} Sound configuration or null if not found\r\n   */\r\n  getGestureSoundConfig(gestureId) {\r\n    const gestureSounds = new Map([\r\n      ['bounce', {\r\n        duration: 100,\r\n        waveform: 'triangle',\r\n        volume: 0.3,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 200 },\r\n          { time: 0.5, frequency: 400 },\r\n          { time: 1, frequency: 300 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 1.0 },\r\n          { time: 0.1, volume: 0.8 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['pulse', {\r\n        duration: 300,\r\n        waveform: 'sine',\r\n        volume: 0.25,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 300 },\r\n          { time: 0.5, frequency: 450 },\r\n          { time: 1, frequency: 300 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.3, volume: 1.0 },\r\n          { time: 0.7, volume: 1.0 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['shake', {\r\n        duration: 200,\r\n        waveform: 'sawtooth',\r\n        volume: 0.2,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 150 },\r\n          { time: 0.25, frequency: 200 },\r\n          { time: 0.5, frequency: 150 },\r\n          { time: 0.75, frequency: 200 },\r\n          { time: 1, frequency: 150 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.8 },\r\n          { time: 0.5, volume: 1.0 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['spin', {\r\n        duration: 600,\r\n        waveform: 'triangle',\r\n        volume: 0.35,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 220 },\r\n          { time: 0.3, frequency: 440 },\r\n          { time: 0.7, frequency: 660 },\r\n          { time: 1, frequency: 330 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.2, volume: 1.0 },\r\n          { time: 0.8, volume: 0.8 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['nod', {\r\n        duration: 150,\r\n        waveform: 'sine',\r\n        volume: 0.15,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 180 },\r\n          { time: 0.5, frequency: 220 },\r\n          { time: 1, frequency: 180 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.5 },\r\n          { time: 0.3, volume: 1.0 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['tilt', {\r\n        duration: 200,\r\n        waveform: 'triangle',\r\n        volume: 0.18,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 250 },\r\n          { time: 0.6, frequency: 350 },\r\n          { time: 1, frequency: 280 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.4, volume: 1.0 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['expand', {\r\n        duration: 500,\r\n        waveform: 'sine',\r\n        volume: 0.4,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 200 },\r\n          { time: 0.7, frequency: 500 },\r\n          { time: 1, frequency: 400 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.3, volume: 1.0 },\r\n          { time: 0.9, volume: 0.8 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['contract', {\r\n        duration: 400,\r\n        waveform: 'triangle',\r\n        volume: 0.22,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 400 },\r\n          { time: 0.8, frequency: 200 },\r\n          { time: 1, frequency: 180 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 1.0 },\r\n          { time: 0.6, volume: 0.8 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['flash', {\r\n        duration: 200,\r\n        waveform: 'square',\r\n        volume: 0.3,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 800 },\r\n          { time: 0.1, frequency: 1200 },\r\n          { time: 0.2, frequency: 800 },\r\n          { time: 1, frequency: 600 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.05, volume: 1.0 },\r\n          { time: 0.15, volume: 0.3 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['wave', {\r\n        duration: 400,\r\n        waveform: 'sine',\r\n        volume: 0.25,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 300 },\r\n          { time: 0.3, frequency: 500 },\r\n          { time: 0.6, frequency: 400 },\r\n          { time: 1, frequency: 350 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.2, volume: 0.8 },\r\n          { time: 0.7, volume: 0.6 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['breathe', {\r\n        duration: 800,  // Slightly shorter for more impact\r\n        waveform: 'triangle',  // Changed from sine for more harmonics\r\n        volume: 0.6,  // Much louder\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 300 },\r\n          { time: 0.3, frequency: 500 },\r\n          { time: 0.5, frequency: 600 },\r\n          { time: 0.7, frequency: 400 },\r\n          { time: 1, frequency: 250 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.2 },  // Start with some volume\r\n          { time: 0.2, volume: 1.0 }, // Quick attack\r\n          { time: 0.5, volume: 0.9 }, // Strong sustain\r\n          { time: 0.8, volume: 0.7 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['morph', {\r\n        duration: 600,\r\n        waveform: 'triangle',\r\n        volume: 0.3,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 100 },\r\n          { time: 0.2, frequency: 300 },\r\n          { time: 0.5, frequency: 600 },\r\n          { time: 0.8, frequency: 400 },\r\n          { time: 1, frequency: 200 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.5 },\r\n          { time: 0.3, volume: 1.0 },\r\n          { time: 0.7, volume: 0.8 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['jump', {\r\n        duration: 250,\r\n        waveform: 'square',\r\n        volume: 0.35,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 200 },\r\n          { time: 0.2, frequency: 600 },\r\n          { time: 0.4, frequency: 800 },\r\n          { time: 0.8, frequency: 400 },\r\n          { time: 1, frequency: 100 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.8 },\r\n          { time: 0.1, volume: 1.0 },\r\n          { time: 0.3, volume: 0.6 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['drift', {\r\n        duration: 800,\r\n        waveform: 'sine',\r\n        volume: 0.12,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 160 },\r\n          { time: 0.4, frequency: 240 },\r\n          { time: 0.8, frequency: 200 },\r\n          { time: 1, frequency: 180 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.2, volume: 1.0 },\r\n          { time: 0.8, volume: 0.8 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['wave', {\r\n        duration: 400,\r\n        waveform: 'sine',\r\n        volume: 0.25,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 200 },\r\n          { time: 0.25, frequency: 300 },\r\n          { time: 0.5, frequency: 250 },\r\n          { time: 0.75, frequency: 280 },\r\n          { time: 1, frequency: 200 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.2, volume: 0.8 },\r\n          { time: 0.8, volume: 0.8 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['breathe', {\r\n        duration: 3500,  // Match gesture duration\r\n        waveform: 'sine',\r\n        volume: 0.2,\r\n        // Deep, calming breath sound - low frequencies\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 80 },    // Start low (exhale)\r\n          { time: 0.4, frequency: 150 },  // Rise during inhale\r\n          { time: 0.5, frequency: 160 },  // Peak at full inhale\r\n          { time: 0.9, frequency: 100 },  // Fall during exhale\r\n          { time: 1, frequency: 80 }      // Back to low\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.3 },     // Quiet start\r\n          { time: 0.4, volume: 0.8 },   // Louder inhale\r\n          { time: 0.5, volume: 0.7 },   // Hold\r\n          { time: 0.9, volume: 0.6 },   // Quieter exhale\r\n          { time: 1, volume: 0.2 }      // Fade out\r\n        ]\r\n      }],\r\n      ['flicker', {\r\n        duration: 300,\r\n        waveform: 'square',\r\n        volume: 0.2,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 600 },\r\n          { time: 0.1, frequency: 400 },\r\n          { time: 0.2, frequency: 800 },\r\n          { time: 0.3, frequency: 300 },\r\n          { time: 0.5, frequency: 700 },\r\n          { time: 1, frequency: 500 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 1.0 },\r\n          { time: 0.1, volume: 0.2 },\r\n          { time: 0.2, volume: 0.9 },\r\n          { time: 0.3, volume: 0.3 },\r\n          { time: 0.5, volume: 0.8 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['vibrate', {\r\n        duration: 250,\r\n        waveform: 'sawtooth',\r\n        volume: 0.3,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 100 },\r\n          { time: 0.1, frequency: 150 },\r\n          { time: 0.2, frequency: 100 },\r\n          { time: 0.3, frequency: 150 },\r\n          { time: 0.4, frequency: 100 },\r\n          { time: 0.5, frequency: 150 },\r\n          { time: 0.6, frequency: 100 },\r\n          { time: 0.7, frequency: 150 },\r\n          { time: 1, frequency: 80 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 1.0 },\r\n          { time: 0.8, volume: 1.0 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['glow', {\r\n        duration: 600,\r\n        waveform: 'sine',\r\n        volume: 0.15,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 300 },\r\n          { time: 0.5, frequency: 500 },\r\n          { time: 1, frequency: 400 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.0 },\r\n          { time: 0.3, volume: 1.0 },\r\n          { time: 0.7, volume: 1.0 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }],\r\n      ['stretch', {\r\n        duration: 450,\r\n        waveform: 'triangle',\r\n        volume: 0.2,\r\n        frequencyEnvelope: [\r\n          { time: 0, frequency: 250 },\r\n          { time: 0.3, frequency: 180 },\r\n          { time: 0.7, frequency: 320 },\r\n          { time: 1, frequency: 250 }\r\n        ],\r\n        volumeEnvelope: [\r\n          { time: 0, volume: 0.6 },\r\n          { time: 0.2, volume: 1.0 },\r\n          { time: 0.8, volume: 0.9 },\r\n          { time: 1, volume: 0.0 }\r\n        ]\r\n      }]\r\n    ]);\r\n\r\n    return gestureSounds.get(gestureId) || null;\r\n  }\r\n\r\n  /**\r\n   * Apply frequency envelope to oscillator\r\n   * @param {OscillatorNode} oscillator - Web Audio oscillator\r\n   * @param {Array} envelope - Frequency envelope points\r\n   * @param {number} startTime - Start time in audio context\r\n   * @param {number} duration - Total duration in seconds\r\n   */\r\n  applyFrequencyEnvelope(oscillator, envelope, startTime, duration) {\r\n    envelope.forEach(point => {\r\n      const time = startTime + (point.time * duration);\r\n      oscillator.frequency.linearRampToValueAtTime(point.frequency, time);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Apply volume envelope to gain node\r\n   * @param {GainNode} gainNode - Web Audio gain node\r\n   * @param {Array} envelope - Volume envelope points\r\n   * @param {number} startTime - Start time in audio context\r\n   * @param {number} duration - Total duration in seconds\r\n   * @param {number} baseVolume - Base volume level\r\n   */\r\n  applyVolumeEnvelope(gainNode, envelope, startTime, duration, baseVolume) {\r\n    envelope.forEach((point, index) => {\r\n      const time = startTime + (point.time * duration);\r\n      const volume = point.volume * baseVolume;\r\n      \r\n      if (index === 0) {\r\n        gainNode.gain.setValueAtTime(volume, time);\r\n      } else {\r\n        gainNode.gain.linearRampToValueAtTime(volume, time);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get emotional modifiers for gesture sounds\r\n   * @param {string} emotion - Current emotion\r\n   * @returns {Object} Modifier values\r\n   */\r\n  getEmotionalModifiers(emotion) {\r\n    const modifiers = new Map([\r\n      ['neutral', { intensity: 1.0, speed: 1.0 }],\r\n      ['joy', { intensity: 1.3, speed: 1.2 }],\r\n      ['sadness', { intensity: 0.6, speed: 0.8 }],\r\n      ['anger', { intensity: 1.5, speed: 1.4 }],\r\n      ['fear', { intensity: 0.8, speed: 1.3 }],\r\n      ['surprise', { intensity: 1.4, speed: 1.5 }],\r\n      ['disgust', { intensity: 0.7, speed: 0.9 }],\r\n      ['love', { intensity: 1.1, speed: 0.9 }]\r\n    ]);\r\n\r\n    return modifiers.get(emotion) || modifiers.get('neutral');\r\n  }\r\n\r\n  /**\r\n   * Enable/disable quality reduction for performance\r\n   * @param {boolean} enabled - Whether to reduce quality\r\n   */\r\n  setQualityReduction(enabled) {\r\n    this.qualityReduction = enabled;\r\n    \r\n    if (enabled && this.audioContext) {\r\n      // Reduce audio quality for performance\r\n      // Lower sample rate if possible\r\n      if (this.audioContext.sampleRate > 22050) {\r\n        // Audio quality reduced for performance\r\n      }\r\n      // Reduce active oscillators\r\n      this.maxOscillators = 2;\r\n    } else {\r\n      // Restore full quality\r\n      this.maxOscillators = 4;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Check if Web Audio API is supported in current browser\r\n   * @returns {boolean} Support status\r\n   */\r\n  static isSupported() {\r\n    return !!(window.AudioContext || window.webkitAudioContext);\r\n  }\r\n  \r\n  /**\r\n   * Throttled warning to reduce console spam\r\n   * @param {string} message - Warning message\r\n   * @param {string} key - Unique key for this warning type\r\n   */\r\n  throttledWarn(message, key) {\r\n    const now = Date.now();\r\n    const lastWarning = this.warningTimestamps[key] || 0;\r\n    \r\n    if (now - lastWarning > this.warningThrottle) {\r\n      // SoundSystem warning\r\n      this.warningTimestamps[key] = now;\r\n    }\r\n  }\r\n}","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                     ◐ ◑ ◒ ◓  SIMPLE FPS COUNTER  ◓ ◒ ◑ ◐                     \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Simple FPS Counter - Accurate Frame Rate Measurement\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module SimpleFPSCounter\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The SPEEDOMETER of the engine. Accurately measures frames per second using        \r\n * ║ a rolling timestamp array. Shows exactly how smooth the animation is running.     \r\n * ║ Critical for performance monitoring and automatic quality degradation.            \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 📊 FPS CALCULATION METHOD                                                         \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Stores timestamps from the last second                                          \r\n * │ • Counts frames within 1000ms window                                              \r\n * │ • More accurate than delta time averaging                                         \r\n * │ • Updates every frame for real-time monitoring                                    \r\n * │ • Based on 2025 best practices for JavaScript FPS                                 \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ⚡ PERFORMANCE TARGETS                                                             \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • 60 FPS   : Smooth animation (16.67ms per frame)                                 \r\n * │ • 30 FPS   : Acceptable minimum (33.33ms per frame)                               \r\n * │ • < 30 FPS : Triggers quality degradation                                         \r\n * │ • < 15 FPS : Critical performance issues                                          \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ═══════════════════════════════════════════════════════════════════════════════════\r\n */\r\nclass SimpleFPSCounter {\r\n    constructor() {\r\n        // Array to store timestamps from the last second\r\n        this.timestamps = [];\r\n        \r\n        // Current FPS value\r\n        this.fps = 0;\r\n        \r\n        // Smoothed FPS for display (to reduce jitter)\r\n        this.smoothedFPS = 0;\r\n        this.smoothingFactor = 0.9; // Higher = more smoothing\r\n        \r\n        // Frame time tracking\r\n        this.lastFrameTime = 0;\r\n        this.frameTime = 0;\r\n        \r\n        // Average frame time over last N frames\r\n        this.frameTimes = [];\r\n        this.maxFrameTimeSamples = 10;\r\n        this.averageFrameTime = 0;\r\n    }\r\n    \r\n    /**\r\n     * Update FPS calculation with new frame\r\n     * Call this in your animation loop with the timestamp from requestAnimationFrame\r\n     * @param {number} timestamp - High resolution timestamp from requestAnimationFrame\r\n     */\r\n    update(timestamp) {\r\n        // Remove timestamps older than 1 second\r\n        while (this.timestamps.length > 0 && this.timestamps[0] <= timestamp - 1000) {\r\n            this.timestamps.shift();\r\n        }\r\n        \r\n        // Add current timestamp\r\n        this.timestamps.push(timestamp);\r\n        \r\n        // FPS is the number of frames in the last second\r\n        this.fps = this.timestamps.length;\r\n        \r\n        // Apply smoothing to reduce display jitter\r\n        if (this.smoothedFPS === 0) {\r\n            this.smoothedFPS = this.fps;\r\n        } else {\r\n            this.smoothedFPS = this.smoothedFPS * this.smoothingFactor + \r\n                               this.fps * (1 - this.smoothingFactor);\r\n        }\r\n        \r\n        // Calculate frame time\r\n        if (this.lastFrameTime > 0) {\r\n            this.frameTime = timestamp - this.lastFrameTime;\r\n            \r\n            // Track frame times for averaging\r\n            this.frameTimes.push(this.frameTime);\r\n            if (this.frameTimes.length > this.maxFrameTimeSamples) {\r\n                this.frameTimes.shift();\r\n            }\r\n            \r\n            // Calculate average frame time\r\n            if (this.frameTimes.length > 0) {\r\n                const sum = this.frameTimes.reduce((a, b) => a + b, 0);\r\n                this.averageFrameTime = sum / this.frameTimes.length;\r\n            }\r\n        }\r\n        this.lastFrameTime = timestamp;\r\n    }\r\n    \r\n    /**\r\n     * Get current FPS\r\n     * @returns {number} Current FPS (integer)\r\n     */\r\n    getFPS() {\r\n        return Math.round(this.fps);\r\n    }\r\n    \r\n    /**\r\n     * Get smoothed FPS for display\r\n     * @returns {number} Smoothed FPS (integer)\r\n     */\r\n    getSmoothedFPS() {\r\n        return Math.round(this.smoothedFPS);\r\n    }\r\n    \r\n    /**\r\n     * Get last frame time in milliseconds\r\n     * @returns {number} Frame time in ms\r\n     */\r\n    getFrameTime() {\r\n        return this.frameTime;\r\n    }\r\n    \r\n    /**\r\n     * Get average frame time over recent frames\r\n     * @returns {number} Average frame time in ms\r\n     */\r\n    getAverageFrameTime() {\r\n        return this.averageFrameTime;\r\n    }\r\n    \r\n    /**\r\n     * Reset the FPS counter\r\n     */\r\n    reset() {\r\n        this.timestamps = [];\r\n        this.fps = 0;\r\n        this.smoothedFPS = 0;\r\n        this.lastFrameTime = 0;\r\n        this.frameTime = 0;\r\n        this.frameTimes = [];\r\n        this.averageFrameTime = 0;\r\n    }\r\n    \r\n    /**\r\n     * Get all metrics\r\n     * @returns {Object} Object containing all FPS metrics\r\n     */\r\n    getMetrics() {\r\n        return {\r\n            fps: this.getFPS(),\r\n            smoothedFPS: this.getSmoothedFPS(),\r\n            frameTime: this.getFrameTime(),\r\n            averageFrameTime: this.getAverageFrameTime(),\r\n            // Performance status based on FPS\r\n            status: this.fps >= 55 ? 'good' : this.fps >= 30 ? 'okay' : 'poor'\r\n        };\r\n    }\r\n}\r\n\r\nexport default SimpleFPSCounter;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝\r\n *                    ◐ ◑ ◒ ◓  ANIMATION CONTROLLER  ◓ ◒ ◑ ◐\r\n *\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Animation Controller - Main Loop & Performance Management\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module AnimationController\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The HEARTBEAT of the Emotive Engine. Manages the main animation loop,             \r\n * ║ coordinates all subsystems, monitors performance, and ensures smooth              \r\n * ║ frame rates through adaptive quality control.                                     \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎬 CORE RESPONSIBILITIES                                                          \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Main requestAnimationFrame loop management                                      \r\n * │ • Frame timing and deltaTime calculation                                          \r\n * │ • Performance monitoring and FPS tracking                                         \r\n * │ • Adaptive quality degradation when performance drops                             \r\n * │ • Subsystem update coordination (render, particles, state)                        \r\n * │ • Visibility and pause state handling                                             \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ⚡ PERFORMANCE FEATURES                                                           \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Dynamic FPS targeting (15, 30, 45, 60 FPS)                                      \r\n * │ • Frame skipping for consistent timing                                            \r\n * │ • Automatic quality reduction when FPS drops                                      \r\n * │ • Recovery system when performance improves                                       \r\n * │ • Memory leak detection and prevention                                            \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🔧 CONFIGURATION OPTIONS                                                          \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • targetFPS         : Desired frame rate (default: 60)                            \r\n * │ • enableDegradation : Allow quality reduction (default: true)                     \r\n * │ • performanceMode   : 'adaptive' | 'fixed' | 'maximum'                           \r\n * │ • monitoringInterval: Performance check frequency (default: 1000ms)               \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ❌ CRITICAL - DO NOT MODIFY                                                       \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ ✗ Frame timing logic       → Breaks animation smoothness                         \r\n * │ ✗ Update order            → Causes render/state desync                           \r\n * │ ✗ Performance thresholds   → May cause excessive degradation                     \r\n * │ ✗ Memory cleanup          → Creates memory leaks                                 \r\n * │ ✗ RAF loop management     → Breaks entire animation system                       \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                          SUBSYSTEM UPDATE ORDER                                   \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ 1. Performance monitoring (FPS calculation)                                       \r\n * ║ 2. State machine update (emotions, transitions)                                   \r\n * ║ 3. Gesture processing (animation progress)                                        \r\n * ║ 4. Particle system update (movement, spawning)                                    \r\n * ║ 5. Renderer update (draw orb and particles)                                       \r\n * ║ 6. Cleanup and memory management                                                  \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nimport PerformanceMonitor from './PerformanceMonitor.js';\r\nimport SimpleFPSCounter from './SimpleFPSCounter.js';\r\nimport { animationLoopManager, AnimationPriority } from './AnimationLoopManager.js';\r\n\r\nclass AnimationController {\r\n    constructor(errorBoundary, config = {}) {\r\n        this.errorBoundary = errorBoundary;\r\n        this.config = config;\r\n        this.config.targetFPS = config.targetFPS || 60;\r\n        \r\n        // Animation state\r\n        this.isRunning = false;\r\n        this.animationFrameId = null;\r\n        this.loopCallbackId = null; // For AnimationLoopManager\r\n        this.lastFrameTime = 0;\r\n        this.deltaTime = 0;\r\n        this.isPaused = false;\r\n        \r\n        // Set up visibility change and window focus handling\r\n        this.handleVisibilityChange = this.handleVisibilityChange.bind(this);\r\n        this.handleWindowBlur = this.handleWindowBlur.bind(this);\r\n        this.handleWindowFocus = this.handleWindowFocus.bind(this);\r\n\r\n        if (typeof document !== 'undefined') {\r\n            document.addEventListener('visibilitychange', this.handleVisibilityChange);\r\n            window.addEventListener('blur', this.handleWindowBlur);\r\n            window.addEventListener('focus', this.handleWindowFocus);\r\n        }\r\n        \r\n        // PerformanceMonitor DISABLED - no FPS interference\r\n        this.performanceMonitor = null;\r\n        /* \r\n        this.performanceMonitor = new PerformanceMonitor(config);\r\n        this.performanceMonitor.setEventCallback((event, data) => {\r\n            this.emit(event, data);\r\n        });\r\n        */\r\n        \r\n        // Simple FPS counter for accurate display\r\n        this.fpsCounter = new SimpleFPSCounter();\r\n        \r\n        // Subsystem references (injected via setSubsystems)\r\n        this.subsystems = {};\r\n        \r\n        // Event callback for external integration\r\n        this.eventCallback = null;\r\n        \r\n        // Reference to parent EmotiveMascot for audio level updates\r\n        this.parentMascot = null;\r\n        \r\n    }\r\n\r\n    /**\r\n     * Injects subsystem dependencies\r\n     * @param {Object} subsystems - Object containing all required subsystems\r\n     */\r\n    setSubsystems(subsystems) {\r\n        this.subsystems = {\r\n            stateMachine: subsystems.stateMachine,\r\n            particleSystem: subsystems.particleSystem,\r\n            renderer: subsystems.renderer,\r\n            soundSystem: subsystems.soundSystem,\r\n            canvasManager: subsystems.canvasManager\r\n        };\r\n        \r\n        // Validate required subsystems\r\n        const required = ['stateMachine', 'particleSystem', 'renderer'];\r\n        for (const system of required) {\r\n            if (!this.subsystems[system]) {\r\n                throw new Error(`Required subsystem '${system}' not provided`);\r\n            }\r\n        }\r\n        \r\n        // PerformanceMonitor disabled\r\n        if (this.performanceMonitor) {\r\n            this.performanceMonitor.setSubsystems(this.subsystems);\r\n        }\r\n        \r\n    }\r\n\r\n    /**\r\n     * Sets the event callback for external integration\r\n     * @param {Function} callback - Function to call for event emission\r\n     */\r\n    setEventCallback(callback) {\r\n        if (typeof callback !== 'function') {\r\n            throw new Error('Event callback must be a function');\r\n        }\r\n        this.eventCallback = callback;\r\n    }\r\n\r\n    /**\r\n     * Sets the parent EmotiveMascot reference for audio level updates\r\n     * @param {EmotiveMascot} mascot - Parent mascot instance\r\n     */\r\n    setParentMascot(mascot) {\r\n        this.parentMascot = mascot;\r\n    }\r\n\r\n    /**\r\n     * Emits an event through the callback if available\r\n     * @param {string} event - Event name\r\n     * @param {*} data - Event data\r\n     */\r\n    emit(event, data = null) {\r\n        if (this.eventCallback) {\r\n            this.eventCallback(event, data);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Starts the animation loop\r\n     * @returns {boolean} Success status\r\n     */\r\n    start() {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.isRunning) {\r\n                return false;\r\n            }\r\n\r\n            if (!this.subsystems.stateMachine) {\r\n                throw new Error('Cannot start animation without subsystems configured');\r\n            }\r\n            \r\n            // Initialize animation state\r\n            this.isRunning = true;\r\n            this.lastFrameTime = performance.now();\r\n            \r\n            // Resume audio context if available\r\n            if (this.subsystems.soundSystem && this.subsystems.soundSystem.isAvailable()) {\r\n                this.subsystems.soundSystem.resumeContext();\r\n            }\r\n\r\n            // Register with AnimationLoopManager instead of direct RAF\r\n            this.loopCallbackId = animationLoopManager.register(\r\n                (deltaTime, timestamp) => this.animate(deltaTime, timestamp),\r\n                AnimationPriority.CRITICAL, // Main render loop is critical priority\r\n                this\r\n            );\r\n\r\n            // Emit start event\r\n            this.emit('animationStarted', { targetFPS: this.targetFPS });\r\n            \r\n            return true;\r\n        }, 'animation-start')();\r\n    }\r\n\r\n    /**\r\n     * Stops the animation loop\r\n     * @returns {boolean} Success status\r\n     */\r\n    stop() {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!this.isRunning) {\r\n                return false;\r\n            }\r\n            \r\n            // Stop animation loop\r\n            this.isRunning = false;\r\n\r\n            // Unregister from AnimationLoopManager\r\n            if (this.loopCallbackId) {\r\n                animationLoopManager.unregister(this.loopCallbackId);\r\n                this.loopCallbackId = null;\r\n            }\r\n\r\n            // Clean up old RAF if it exists (for backwards compatibility)\r\n            if (this.animationFrameId) {\r\n                cancelAnimationFrame(this.animationFrameId);\r\n                this.animationFrameId = null;\r\n            }\r\n\r\n\r\n            \r\n            // Stop all active gestures\r\n            if (this.subsystems.renderer && this.subsystems.renderer.stopAllGestures) {\r\n                this.subsystems.renderer.stopAllGestures();\r\n            }\r\n            \r\n            // Stop ambient audio\r\n            if (this.subsystems.soundSystem && this.subsystems.soundSystem.isAvailable()) {\r\n                this.subsystems.soundSystem.stopAmbientTone();\r\n            }\r\n            \r\n            // Clear particles\r\n            if (this.subsystems.particleSystem) {\r\n                this.subsystems.particleSystem.clear();\r\n            }\r\n            \r\n            // Emit stop event\r\n            this.emit('animationStopped');\r\n            \r\n            return true;\r\n        }, 'animation-stop')();\r\n    }\r\n\r\n    /**\r\n     * Handles window blur event\r\n     */\r\n    handleWindowBlur() {\r\n        // Use same logic as visibility change\r\n        if (!document.hidden) {\r\n            // Only pause if document isn't already hidden (avoid double-pause)\r\n            this.handleVisibilityChange();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles window focus event\r\n     */\r\n    handleWindowFocus() {\r\n        // Force a resume check\r\n        if (!document.hidden && this.isPaused) {\r\n            // Simulate visibility change to visible\r\n            this.handleVisibilityChange();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles document visibility changes to pause/resume animation\r\n     */\r\n    handleVisibilityChange() {\r\n        if (document.hidden) {\r\n            // Tab became hidden - pause animation\r\n            this.wasRunning = this.isRunning;\r\n            this.isPaused = true;\r\n\r\n            // Store current time to calculate gap when resuming\r\n            this.pauseTime = performance.now();\r\n\r\n            // Stop all active systems\r\n            if (this.subsystems?.particleSystem) {\r\n                // Clear spawn accumulator to prevent burst on resume\r\n                this.subsystems.particleSystem.resetAccumulator();\r\n                // Store particle count for debugging\r\n                this.pausedParticleCount = this.subsystems.particleSystem.particles?.length || 0;\r\n            }\r\n\r\n            // Pause gesture animations if any are active\r\n            if (this.subsystems?.renderer?.gestureAnimator) {\r\n                this.subsystems.renderer.gestureAnimator.pauseCurrentAnimation?.();\r\n            }\r\n\r\n            // Notify parent mascot to pause\r\n            if (this.parentMascot?.pause) {\r\n                this.parentMascot.pause();\r\n            }\r\n        } else {\r\n            // Tab became visible - resume animation smoothly\r\n            if (this.isPaused && this.wasRunning) {\r\n                // Calculate time gap\r\n                const resumeTime = performance.now();\r\n                const gap = resumeTime - this.pauseTime;\r\n\r\n                // Reset timing to prevent huge deltaTime spike\r\n                this.lastFrameTime = resumeTime;\r\n                this.frameTimeAccumulator = 0;\r\n\r\n                // Clear and reset all systems\r\n                if (this.subsystems?.particleSystem) {\r\n                    // Clear accumulator again to be safe\r\n                    this.subsystems.particleSystem.resetAccumulator();\r\n                    // Clear any stuck particles if gap was too long\r\n                    if (gap > 5000) { // More than 5 seconds\r\n                        this.subsystems.particleSystem.particles = [];\r\n                    }\r\n                }\r\n\r\n                // Reset canvas context to fix any rendering artifacts\r\n                if (this.renderer) {\r\n                    this.renderer.resetCanvasContext();\r\n\r\n                    // Reset any active animations\r\n                    if (this.renderer.gestureAnimator) {\r\n                        this.renderer.gestureAnimator.resumeAnimation?.();\r\n                    }\r\n\r\n                    // Force a clean frame\r\n                    this.renderer.forceCleanRender = true;\r\n                }\r\n\r\n                // Reset state machine timing\r\n                if (this.subsystems?.stateMachine) {\r\n                    // Update state machine's last update time\r\n                    this.subsystems.stateMachine.lastUpdateTime = resumeTime;\r\n                }\r\n\r\n                // Notify parent mascot to resume\r\n                if (this.parentMascot?.resume) {\r\n                    this.parentMascot.resume();\r\n                }\r\n\r\n                // Finally unpause\r\n                this.isPaused = false;\r\n\r\n                // Log for debugging\r\n                if (this.performanceMonitor) {\r\n                    console.log(`Resumed after ${(gap/1000).toFixed(1)}s pause. Cleared particles: ${this.pausedParticleCount || 0}`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Main animation loop with deltaTime calculation and performance monitoring\r\n     * Now called by AnimationLoopManager with centralized frame timing\r\n     * @param {number} deltaTime - Time since last frame from loop manager\r\n     * @param {number} timestamp - Current timestamp from loop manager\r\n     */\r\n    animate(deltaTime, timestamp) {\r\n        if (!this.isRunning || this.isPaused) return;\r\n\r\n        this.errorBoundary.wrap(() => {\r\n            // Use deltaTime from AnimationLoopManager if provided, else calculate\r\n            const currentTime = timestamp || performance.now();\r\n            this.deltaTime = deltaTime || (currentTime - this.lastFrameTime);\r\n            \r\n            // Cap deltaTime to prevent physics instability\r\n            // Use a consistent cap of 50ms (20 FPS minimum)\r\n            const skipParticleSpawn = this.deltaTime > 33; // Skip spawning if under 30fps\r\n            \r\n            if (this.deltaTime > 50) {\r\n                // Large gap detected - cap and reset accumulator\r\n                this.deltaTime = 50;\r\n                // Reset the accumulator to prevent burst spawning\r\n                if (this.subsystems?.particleSystem) {\r\n                    this.subsystems.particleSystem.resetAccumulator();\r\n                }\r\n            }\r\n            \r\n            // Store skip flag for particle system\r\n            if (this.subsystems?.particleSystem) {\r\n                this.subsystems.particleSystem.skipSpawnThisFrame = skipParticleSpawn;\r\n            }\r\n            \r\n            this.lastFrameTime = currentTime;\r\n            \r\n            // PerformanceMonitor disabled\r\n            if (this.performanceMonitor) {\r\n                this.performanceMonitor.startFrame(currentTime);\r\n            }\r\n            \r\n            // Update simple FPS counter\r\n            this.fpsCounter.update(currentTime);\r\n            \r\n            // Update all subsystems with integrated deltaTime\r\n            this.update(this.deltaTime);\r\n            \r\n            // Render the current frame\r\n            this.render();\r\n            \r\n            // PerformanceMonitor disabled\r\n            if (this.performanceMonitor) {\r\n                this.performanceMonitor.endFrame(performance.now());\r\n            }\r\n\r\n            // AnimationLoopManager now handles the loop scheduling\r\n            // No need to call requestAnimationFrame here\r\n\r\n        }, 'animation-loop')();\r\n    }\r\n\r\n    /**\r\n     * Updates all subsystems\r\n     * @param {number} deltaTime - Time since last frame in milliseconds\r\n     */\r\n    update(deltaTime) {\r\n        this.errorBoundary.wrap(() => {\r\n            const currentTime = performance.now();\r\n            \r\n            // Update state machine\r\n            if (this.subsystems.stateMachine) {\r\n                this.subsystems.stateMachine.update(deltaTime);\r\n            }\r\n            \r\n            // Gesture updates now handled by renderer\r\n            \r\n            // Update parent mascot for audio level monitoring\r\n            if (this.parentMascot && typeof this.parentMascot.update === 'function') {\r\n                this.parentMascot.update(deltaTime);\r\n            }\r\n            \r\n            // Only handle particles here if NOT in classic rendering mode\r\n            // Classic mode handles its own particles in EmotiveMascot.render()\r\n            const isClassicMode = this.parentMascot?.config?.renderingStyle === 'classic';\r\n            \r\n            if (!isClassicMode) {\r\n                // Get current emotional properties and center for particle system (advanced mode only)\r\n                if (this.subsystems.particleSystem && this.subsystems.stateMachine && this.subsystems.canvasManager) {\r\n                    const emotionalProps = this.subsystems.stateMachine.getCurrentEmotionalProperties();\r\n                    const center = this.subsystems.canvasManager.getCenter();\r\n                    \r\n                    // Get current gesture info from renderer if available\r\n                    let gestureMotion = null;\r\n                    let gestureProgress = 0;\r\n                    \r\n                    if (this.subsystems.renderer && this.subsystems.renderer.getCurrentGesture) {\r\n                        const currentGesture = this.subsystems.renderer.getCurrentGesture();\r\n                        if (currentGesture && currentGesture.particleMotion) {\r\n                            gestureMotion = currentGesture.particleMotion;\r\n                            gestureProgress = currentGesture.progress || 0;\r\n                        }\r\n                    }\r\n                    \r\n                    // Update particle system with current emotional context\r\n                    this.subsystems.particleSystem.spawn(\r\n                        emotionalProps.particleBehavior,\r\n                        this.subsystems.stateMachine.getCurrentState().emotion,\r\n                        emotionalProps.particleRate,\r\n                        center.x,\r\n                        center.y,\r\n                        deltaTime\r\n                    );\r\n                    \r\n                    // Update particles with gesture motion if available\r\n                    this.subsystems.particleSystem.update(deltaTime, center.x, center.y, gestureMotion, gestureProgress);\r\n                }\r\n            }\r\n            \r\n            // PerformanceMonitor disabled\r\n            if (this.performanceMonitor) {\r\n                this.performanceMonitor.updateMetrics({\r\n                    particleCount: this.subsystems.particleSystem?.getActiveParticleCount?.() || 0,\r\n                    audioLatency: this.subsystems.soundSystem?.getLatency?.() || 0\r\n                });\r\n            }\r\n            \r\n        }, 'subsystem-update')();\r\n    }\r\n\r\n    /**\r\n     * Renders the current frame\r\n     */\r\n    render() {\r\n        this.errorBoundary.wrap(() => {\r\n            // Call parent mascot's render method if available\r\n            if (this.parentMascot && typeof this.parentMascot.render === 'function') {\r\n                this.parentMascot.render();\r\n            } else if (this.subsystems.renderer) {\r\n                // Fallback to direct renderer call\r\n                this.subsystems.renderer.render();\r\n            }\r\n        }, 'frame-render')();\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Gets current performance metrics (delegated to PerformanceMonitor)\r\n     * @returns {Object} Performance data\r\n     */\r\n    getPerformanceMetrics() {\r\n        // PerformanceMonitor disabled - use simple FPS counter only\r\n        const fpsMetrics = this.fpsCounter ? this.fpsCounter.getMetrics() : {};\r\n        return {\r\n            fps: fpsMetrics.fps || 60,\r\n            instantFps: fpsMetrics.smoothedFPS || 60,\r\n            frameTime: fpsMetrics.frameTime || 16.67,\r\n            averageFrameTime: fpsMetrics.averageFrameTime || 16.67,\r\n            isRunning: this.isRunning,\r\n            deltaTime: this.deltaTime\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Sets the target FPS (delegated to PerformanceMonitor)\r\n     * @param {number} fps - Target FPS value\r\n     */\r\n    setTargetFPS(fps) {\r\n        // DISABLED - no FPS changes allowed\r\n        return;\r\n    }\r\n\r\n    /**\r\n     * Gets the target FPS\r\n     * @returns {number} Target FPS value\r\n     */\r\n    get targetFPS() {\r\n        return this.config.targetFPS || 60;\r\n    }\r\n\r\n    /**\r\n     * Checks if the animation is currently running\r\n     * @returns {boolean} Running status\r\n     */\r\n    isAnimating() {\r\n        return this.isRunning;\r\n    }\r\n\r\n    /**\r\n     * Destroys the animation controller and cleans up resources\r\n     */\r\n    destroy() {\r\n        this.stop();\r\n        \r\n        // Remove visibility change and focus listeners\r\n        if (typeof document !== 'undefined') {\r\n            document.removeEventListener('visibilitychange', this.handleVisibilityChange);\r\n            window.removeEventListener('blur', this.handleWindowBlur);\r\n            window.removeEventListener('focus', this.handleWindowFocus);\r\n        }\r\n        \r\n        // Destroy performance monitor\r\n        if (this.performanceMonitor) {\r\n            this.performanceMonitor.destroy();\r\n            this.performanceMonitor = null;\r\n        }\r\n        \r\n        // Clear subsystem references\r\n        this.subsystems = {};\r\n        this.eventCallback = null;\r\n        \r\n    }\r\n}\r\n\r\nexport default AnimationController;","/**\n * ═══════════════════════════════════════════════════════════════════════════════════════\n *  ╔═○─┐ emotive\n *    ●●  ENGINE\n *  └─○═╝                                                                             \n *                   ◐ ◑ ◒ ◓  AUDIO LEVEL PROCESSOR  ◓ ◒ ◑ ◐                   \n *                                                                                    \n * ═══════════════════════════════════════════════════════════════════════════════════════\n *\n * @fileoverview Audio Level Processor - Real-time Audio Analysis & Reactivity\n * @author Emotive Engine Team\n * @version 2.0.0\n * @module AudioLevelProcessor\n * \n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                   PURPOSE                                         \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ Analyzes real-time audio input to make the mascot react to speech and sound.      \n * ║ Detects volume spikes, tracks audio history, and triggers emotional responses      \n * ║ based on audio levels. Makes the orb \"listen\" and respond to your voice!          \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🎤 AUDIO ANALYSIS FEATURES                                                        \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Real-time RMS level calculation                                                 \n * │ • Volume spike detection with cooldown                                            \n * │ • Audio level history tracking                                                    \n * │ • Frequency analysis via FFT                                                      \n * │ • Smooth level transitions                                                        \n * │ • Microphone permission handling                                                  \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 📊 PROCESSING PIPELINE                                                            \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ 1. Microphone → getUserMedia()                                                    \n * │ 2. MediaStream → AudioContext                                                     \n * │ 3. AudioContext → AnalyserNode                                                    \n * │ 4. AnalyserNode → Frequency Data (FFT)                                            \n * │ 5. Frequency Data → RMS Calculation                                               \n * │ 6. RMS → Spike Detection & Level Events                                           \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ ⚡ SPIKE DETECTION                                                                \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • Threshold: Current level > average * spikeThreshold                            \n * │ • Cooldown: Minimum interval between spikes (default: 1000ms)                    \n * │ • Triggers: \"nod\" gesture for speech acknowledgment                              \n * │ • Sensitivity: Configurable via spikeThreshold (1.5 = 50% above average)         \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 🔧 CONFIGURATION                                                                   \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ PARAMETER              DEFAULT    DESCRIPTION                                     \n * │ spikeThreshold         1.5        Multiplier for spike detection                  \n * │ minimumSpikeLevel      0.1        Minimum level to trigger spike                  \n * │ spikeMinInterval       1000       Cooldown between spikes (ms)                   \n * │ historySize            10         Audio level history buffer size                 \n * │ smoothingTimeConstant  0.8        FFT smoothing (0=none, 1=max)                  \n * │ fftSize                256        FFT bin size for frequency analysis             \n * │ levelUpdateThrottle    100        Throttle for level update events (ms)          \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ┌───────────────────────────────────────────────────────────────────────────────────\n * │ 📡 EVENTS                                                                          \n * ├───────────────────────────────────────────────────────────────────────────────────\n * │ • levelUpdate  : Emitted when audio level changes (throttled)                     \n * │ • volumeSpike  : Emitted when spike detected (with cooldown)                      \n * │ • error        : Emitted on processing errors                                     \n * └───────────────────────────────────────────────────────────────────────────────────\n *\n * ╔═══════════════════════════════════════════════════════════════════════════════════\n * ║                                USAGE EXAMPLE                                      \n * ╠═══════════════════════════════════════════════════════════════════════════════════\n * ║ const processor = new AudioLevelProcessor({                                       \n * ║     spikeThreshold: 1.5,                                                          \n * ║     spikeMinInterval: 500                                                         \n * ║ });                                                                                \n * ║                                                                                    \n * ║ processor.on('volumeSpike', (level) => {                                          \n * ║     mascot.triggerGesture('nod');  // React to speech                            \n * ║ });                                                                                \n * ║                                                                                    \n * ║ processor.on('levelUpdate', (level) => {                                          \n * ║     mascot.setAudioLevel(level);   // Smooth breathing with speech               \n * ║ });                                                                                \n * ╚═══════════════════════════════════════════════════════════════════════════════════\n *\n * ════════════════════════════════════════════════════════════════════════════════════\n */\nexport class AudioLevelProcessor {\n    constructor(config = {}) {\n        // Configuration with defaults\n        this.config = {\n            spikeThreshold: config.spikeThreshold || 1.5,\n            minimumSpikeLevel: config.minimumSpikeLevel || 0.1,\n            spikeMinInterval: config.spikeMinInterval || 1000, // ms between spikes\n            historySize: config.historySize || 10,\n            smoothingTimeConstant: config.smoothingTimeConstant || 0.8,\n            fftSize: config.fftSize || 256,\n            levelUpdateThrottle: config.levelUpdateThrottle || 100, // ms\n            ...config\n        };\n        \n        // Audio context and analysis\n        this.audioContext = null;\n        this.analyser = null;\n        this.dataArray = null;\n        \n        // Audio level state\n        this.currentLevel = 0;\n        this.levelHistory = [];\n        this.isActive = false;\n        \n        // Spike detection state\n        this.lastVolumeSpike = 0;\n        \n        // Event throttling\n        this.lastLevelEmit = 0;\n        \n        // Event callbacks\n        this.callbacks = {\n            levelUpdate: null,\n            volumeSpike: null,\n            error: null\n        };\n    }\n\n    /**\n     * Initialize audio level processing with provided audio context\n     * @param {AudioContext} audioContext - Web Audio API context\n     * @returns {boolean} Success status\n     */\n    initialize(audioContext) {\n        try {\n            if (!audioContext) {\n                throw new Error('AudioContext is required for audio level processing');\n            }\n            \n            // Validate AudioContext\n            if (typeof audioContext.createAnalyser !== 'function') {\n                throw new Error('Invalid AudioContext provided');\n            }\n            \n            // Store audio context\n            this.audioContext = audioContext;\n            \n            // Create audio analyser for level monitoring\n            this.analyser = audioContext.createAnalyser();\n            this.analyser.fftSize = this.config.fftSize;\n            this.analyser.smoothingTimeConstant = this.config.smoothingTimeConstant;\n            \n            // Create data array for frequency analysis\n            this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n            \n            // Initialize state\n            this.currentLevel = 0;\n            this.levelHistory = [];\n            this.lastVolumeSpike = 0;\n            this.isActive = true;\n            \n            // Resume audio context if suspended\n            if (audioContext.state === 'suspended') {\n                audioContext.resume().catch(error => {\n                    this.emitError('Failed to resume AudioContext', error);\n                });\n            }\n            \n            return true;\n            \n        } catch (error) {\n            this.emitError('Failed to initialize AudioLevelProcessor', error);\n            return false;\n        }\n    }\n\n    /**\n     * Clean up audio level processing resources\n     */\n    cleanup() {\n        try {\n            // Reset state\n            this.isActive = false;\n            this.currentLevel = 0;\n            this.levelHistory = [];\n            this.lastVolumeSpike = 0;\n            this.lastLevelEmit = 0;\n            \n            // Clear references\n            this.audioContext = null;\n            this.analyser = null;\n            this.dataArray = null;\n            \n            \n        } catch (error) {\n            this.emitError('Error during AudioLevelProcessor cleanup', error);\n        }\n    }\n\n    /**\n     * Update audio level from analyser (called each frame)\n     * @param {number} deltaTime - Time since last frame in milliseconds\n     */\n    updateAudioLevel(deltaTime = 16) {\n        if (!this.isActive || !this.analyser || !this.dataArray) {\n            return;\n        }\n        \n        try {\n            // Get frequency data from analyser\n            this.analyser.getByteFrequencyData(this.dataArray);\n            \n            // Calculate RMS (Root Mean Square) for accurate level detection\n            const rms = this.calculateRMS();\n            \n            // Update current level with normalization and amplification\n            this.currentLevel = Math.min(1, rms * 2); // Amplify for better sensitivity\n            \n            // Update audio level history for spike detection\n            this.updateLevelHistory();\n            \n            // Check for volume spikes and trigger events\n            this.detectVolumeSpikes();\n            \n            // Emit throttled level update events\n            this.emitLevelUpdate();\n            \n        } catch (error) {\n            this.emitError('Error updating audio level', error);\n            this.currentLevel = 0;\n        }\n    }\n\n    /**\n     * Calculate RMS (Root Mean Square) from frequency data\n     * @returns {number} RMS value normalized to 0-1 range\n     */\n    calculateRMS() {\n        if (!this.dataArray || this.dataArray.length === 0) {\n            return 0;\n        }\n        \n        let sumSquares = 0;\n        \n        // Calculate sum of squares for all frequency bins\n        for (let i = 0; i < this.dataArray.length; i++) {\n            const normalized = this.dataArray[i] / 255; // Normalize to 0-1\n            sumSquares += normalized * normalized;\n        }\n        \n        // Return RMS value\n        return Math.sqrt(sumSquares / this.dataArray.length);\n    }\n\n    /**\n     * Update audio level history for spike detection analysis\n     */\n    updateLevelHistory() {\n        // Add current level to history\n        this.levelHistory.push(this.currentLevel);\n        \n        // Maintain history size limit\n        if (this.levelHistory.length > this.config.historySize) {\n            this.levelHistory.shift();\n        }\n    }\n\n    /**\n     * Detect volume spikes and emit events for gesture triggering\n     */\n    detectVolumeSpikes() {\n        // Need sufficient history for spike detection\n        if (this.levelHistory.length < 5) {\n            return;\n        }\n        \n        const currentTime = performance.now();\n        \n        // Prevent too frequent spike detection\n        if (currentTime - this.lastVolumeSpike < this.config.spikeMinInterval) {\n            return;\n        }\n        \n        // Calculate average of previous levels (excluding current)\n        const previousLevels = this.levelHistory.slice(0, -1);\n        const averagePrevious = previousLevels.reduce((sum, level) => sum + level, 0) / previousLevels.length;\n        \n        // Check for volume spike conditions\n        const isSpike = this.currentLevel >= averagePrevious * this.config.spikeThreshold &&\n                       averagePrevious >= this.config.minimumSpikeLevel &&\n                       this.currentLevel >= this.config.minimumSpikeLevel * 2;\n        \n        if (isSpike) {\n            this.lastVolumeSpike = currentTime;\n            \n            // Emit volume spike event with detailed information\n            this.emitVolumeSpike({\n                level: this.currentLevel,\n                previousAverage: averagePrevious,\n                spikeRatio: this.currentLevel / averagePrevious,\n                timestamp: currentTime,\n                threshold: this.config.spikeThreshold,\n                minimumLevel: this.config.minimumSpikeLevel\n            });\n            \n        }\n    }\n\n    /**\n     * Clear audio level history\n     */\n    clearHistory() {\n        this.levelHistory = [];\n    }\n\n    /**\n     * Get current audio level\n     * @returns {number} Current audio level (0-1)\n     */\n    getCurrentLevel() {\n        return this.currentLevel;\n    }\n\n    /**\n     * Get audio level history\n     * @returns {Array<number>} Array of recent audio levels\n     */\n    getLevelHistory() {\n        return [...this.levelHistory]; // Return copy to prevent external modification\n    }\n\n    /**\n     * Get analyser node for external audio source connection\n     * @returns {AnalyserNode|null} Web Audio analyser node\n     */\n    getAnalyser() {\n        return this.analyser;\n    }\n\n    /**\n     * Get current frequency data as array\n     * @returns {Uint8Array|null} Frequency data array\n     */\n    getFrequencyData() {\n        if (!this.dataArray) {\n            return null;\n        }\n        \n        // Return copy of current frequency data\n        return new Uint8Array(this.dataArray);\n    }\n\n    /**\n     * Check if audio level processing is active\n     * @returns {boolean} Active status\n     */\n    isProcessingActive() {\n        return this.isActive;\n    }\n\n    /**\n     * Set callback for audio level updates\n     * @param {Function} callback - Callback function receiving level data\n     */\n    onLevelUpdate(callback) {\n        if (typeof callback === 'function') {\n            this.callbacks.levelUpdate = callback;\n        } else {\n            throw new Error('Level update callback must be a function');\n        }\n    }\n\n    /**\n     * Set callback for volume spike events\n     * @param {Function} callback - Callback function receiving spike data\n     */\n    onVolumeSpike(callback) {\n        if (typeof callback === 'function') {\n            this.callbacks.volumeSpike = callback;\n        } else {\n            throw new Error('Volume spike callback must be a function');\n        }\n    }\n\n    /**\n     * Set callback for error events\n     * @param {Function} callback - Callback function receiving error data\n     */\n    onError(callback) {\n        if (typeof callback === 'function') {\n            this.callbacks.error = callback;\n        } else {\n            throw new Error('Error callback must be a function');\n        }\n    }\n\n    /**\n     * Remove all event callbacks\n     */\n    removeAllCallbacks() {\n        this.callbacks = {\n            levelUpdate: null,\n            volumeSpike: null,\n            error: null\n        };\n    }\n\n    /**\n     * Update configuration settings\n     * @param {Object} newConfig - New configuration options\n     */\n    updateConfig(newConfig) {\n        this.config = { ...this.config, ...newConfig };\n        \n        // Update analyser settings if active\n        if (this.analyser) {\n            if (newConfig.fftSize) {\n                this.analyser.fftSize = this.config.fftSize;\n                this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n            }\n            \n            if (newConfig.smoothingTimeConstant !== undefined) {\n                this.analyser.smoothingTimeConstant = this.config.smoothingTimeConstant;\n            }\n        }\n        \n    }\n\n    /**\n     * Get current configuration\n     * @returns {Object} Current configuration object\n     */\n    getConfig() {\n        return { ...this.config }; // Return copy to prevent external modification\n    }\n\n    /**\n     * Get processing statistics\n     * @returns {Object} Statistics object\n     */\n    getStats() {\n        return {\n            isActive: this.isActive,\n            currentLevel: this.currentLevel,\n            historySize: this.levelHistory.length,\n            maxHistorySize: this.config.historySize,\n            lastSpikeTime: this.lastVolumeSpike,\n            timeSinceLastSpike: this.lastVolumeSpike > 0 ? performance.now() - this.lastVolumeSpike : 0,\n            averageLevel: this.levelHistory.length > 0 ? \n                this.levelHistory.reduce((sum, level) => sum + level, 0) / this.levelHistory.length : 0\n        };\n    }\n\n    /**\n     * Emit throttled audio level update event\n     */\n    emitLevelUpdate() {\n        const currentTime = performance.now();\n        \n        // Throttle level update events\n        if (currentTime - this.lastLevelEmit < this.config.levelUpdateThrottle) {\n            return;\n        }\n        \n        this.lastLevelEmit = currentTime;\n        \n        if (this.callbacks.levelUpdate) {\n            try {\n                this.callbacks.levelUpdate({\n                    level: this.currentLevel,\n                    rawData: this.getFrequencyData(),\n                    timestamp: currentTime,\n                    history: this.getLevelHistory()\n                });\n            } catch (error) {\n            }\n        }\n    }\n\n    /**\n     * Emit volume spike event\n     * @param {Object} spikeData - Spike detection data\n     */\n    emitVolumeSpike(spikeData) {\n        if (this.callbacks.volumeSpike) {\n            try {\n                this.callbacks.volumeSpike(spikeData);\n            } catch (error) {\n            }\n        }\n    }\n\n    /**\n     * Emit error event\n     * @param {string} message - Error message\n     * @param {Error} error - Original error object\n     */\n    emitError(message, error) {\n        \n        if (this.callbacks.error) {\n            try {\n                this.callbacks.error({\n                    message,\n                    error,\n                    timestamp: performance.now()\n                });\n            } catch (callbackError) {\n            }\n        }\n    }\n\n    /**\n     * Check if Web Audio API is supported\n     * @returns {boolean} Support status\n     */\n    static isSupported() {\n        return !!(window.AudioContext || window.webkitAudioContext);\n    }\n}\n\nexport default AudioLevelProcessor;","/**\r\n * Event Manager\r\n * Centralized event listener management to prevent memory leaks\r\n *\r\n * @module core/EventManager\r\n * @version 1.0.0\r\n */\r\n\r\n/**\r\n * Manages all event listeners to ensure proper cleanup\r\n */\r\nexport class EventManager {\r\n    constructor() {\r\n        // Track all registered listeners\r\n        this.listeners = new Map();\r\n\r\n        // Track listener groups for batch operations\r\n        this.groups = new Map();\r\n\r\n        // Auto-cleanup on page unload\r\n        // Removed unload handler - not needed and causes violations\r\n\r\n        // Stats\r\n        this.stats = {\r\n            registered: 0,\r\n            removed: 0,\r\n            active: 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Register an event listener\r\n     * @param {EventTarget} target - Event target (element, window, document, etc.)\r\n     * @param {string} eventType - Event type (click, resize, etc.)\r\n     * @param {Function} handler - Event handler function\r\n     * @param {Object} options - addEventListener options\r\n     * @param {string} group - Optional group name for batch operations\r\n     * @returns {string} Listener ID for later removal\r\n     */\r\n    addEventListener(target, eventType, handler, options = {}, group = 'default') {\r\n        // Generate unique ID\r\n        const id = this.generateId();\r\n\r\n        // Create listener info\r\n        const listenerInfo = {\r\n            id,\r\n            target,\r\n            eventType,\r\n            handler,\r\n            options,\r\n            group,\r\n            active: true\r\n        };\r\n\r\n        // Store listener\r\n        this.listeners.set(id, listenerInfo);\r\n\r\n        // Add to group\r\n        if (!this.groups.has(group)) {\r\n            this.groups.set(group, new Set());\r\n        }\r\n        this.groups.get(group).add(id);\r\n\r\n        // Actually add the listener\r\n        target.addEventListener(eventType, handler, options);\r\n\r\n        // Update stats\r\n        this.stats.registered++;\r\n        this.stats.active++;\r\n\r\n        return id;\r\n    }\r\n\r\n    /**\r\n     * Remove an event listener by ID\r\n     * @param {string} id - Listener ID\r\n     * @returns {boolean} Success status\r\n     */\r\n    removeEventListener(id) {\r\n        const listenerInfo = this.listeners.get(id);\r\n\r\n        if (!listenerInfo || !listenerInfo.active) {\r\n            return false;\r\n        }\r\n\r\n        // Remove the actual listener\r\n        listenerInfo.target.removeEventListener(\r\n            listenerInfo.eventType,\r\n            listenerInfo.handler,\r\n            listenerInfo.options\r\n        );\r\n\r\n        // Mark as inactive\r\n        listenerInfo.active = false;\r\n\r\n        // Remove from group\r\n        const group = this.groups.get(listenerInfo.group);\r\n        if (group) {\r\n            group.delete(id);\r\n            if (group.size === 0) {\r\n                this.groups.delete(listenerInfo.group);\r\n            }\r\n        }\r\n\r\n        // Remove from listeners map\r\n        this.listeners.delete(id);\r\n\r\n        // Update stats\r\n        this.stats.removed++;\r\n        this.stats.active--;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Remove all listeners in a group\r\n     * @param {string} group - Group name\r\n     * @returns {number} Number of listeners removed\r\n     */\r\n    removeGroup(group) {\r\n        const groupSet = this.groups.get(group);\r\n\r\n        if (!groupSet) {\r\n            return 0;\r\n        }\r\n\r\n        let removed = 0;\r\n\r\n        for (const id of groupSet) {\r\n            if (this.removeEventListener(id)) {\r\n                removed++;\r\n            }\r\n        }\r\n\r\n        return removed;\r\n    }\r\n\r\n    /**\r\n     * Remove all listeners for a specific target\r\n     * @param {EventTarget} target - Event target\r\n     * @returns {number} Number of listeners removed\r\n     */\r\n    removeAllForTarget(target) {\r\n        let removed = 0;\r\n\r\n        for (const [id, info] of this.listeners.entries()) {\r\n            if (info.target === target && info.active) {\r\n                if (this.removeEventListener(id)) {\r\n                    removed++;\r\n                }\r\n            }\r\n        }\r\n\r\n        return removed;\r\n    }\r\n\r\n    /**\r\n     * Remove all listeners of a specific type\r\n     * @param {string} eventType - Event type\r\n     * @returns {number} Number of listeners removed\r\n     */\r\n    removeAllOfType(eventType) {\r\n        let removed = 0;\r\n\r\n        for (const [id, info] of this.listeners.entries()) {\r\n            if (info.eventType === eventType && info.active) {\r\n                if (this.removeEventListener(id)) {\r\n                    removed++;\r\n                }\r\n            }\r\n        }\r\n\r\n        return removed;\r\n    }\r\n\r\n    /**\r\n     * Remove all listeners\r\n     * @returns {number} Number of listeners removed\r\n     */\r\n    removeAll() {\r\n        let removed = 0;\r\n\r\n        for (const [id, info] of this.listeners.entries()) {\r\n            if (info.active) {\r\n                if (this.removeEventListener(id)) {\r\n                    removed++;\r\n                }\r\n            }\r\n        }\r\n\r\n        return removed;\r\n    }\r\n\r\n    /**\r\n     * Create a bound listener that auto-removes\r\n     * @param {EventTarget} target - Event target\r\n     * @param {string} eventType - Event type\r\n     * @param {Function} handler - Event handler\r\n     * @param {Object} options - Options\r\n     * @returns {Object} Controller with remove method\r\n     */\r\n    createAutoRemove(target, eventType, handler, options = {}) {\r\n        const id = this.addEventListener(target, eventType, handler, options);\r\n\r\n        return {\r\n            id,\r\n            remove: () => this.removeEventListener(id)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Add listener that fires only once\r\n     * @param {EventTarget} target - Event target\r\n     * @param {string} eventType - Event type\r\n     * @param {Function} handler - Event handler\r\n     * @param {Object} options - Options\r\n     * @returns {string} Listener ID\r\n     */\r\n    once(target, eventType, handler, options = {}) {\r\n        const wrappedHandler = (event) => {\r\n            handler(event);\r\n            this.removeEventListener(id);\r\n        };\r\n\r\n        const id = this.addEventListener(target, eventType, wrappedHandler, options);\r\n\r\n        return id;\r\n    }\r\n\r\n    /**\r\n     * Debounced event listener\r\n     * @param {EventTarget} target - Event target\r\n     * @param {string} eventType - Event type\r\n     * @param {Function} handler - Event handler\r\n     * @param {number} delay - Debounce delay in ms\r\n     * @param {Object} options - Options\r\n     * @returns {string} Listener ID\r\n     */\r\n    debounced(target, eventType, handler, delay = 250, options = {}) {\r\n        let timeoutId;\r\n\r\n        const debouncedHandler = (event) => {\r\n            clearTimeout(timeoutId);\r\n            timeoutId = setTimeout(() => handler(event), delay);\r\n        };\r\n\r\n        return this.addEventListener(target, eventType, debouncedHandler, options);\r\n    }\r\n\r\n    /**\r\n     * Throttled event listener\r\n     * @param {EventTarget} target - Event target\r\n     * @param {string} eventType - Event type\r\n     * @param {Function} handler - Event handler\r\n     * @param {number} limit - Throttle limit in ms\r\n     * @param {Object} options - Options\r\n     * @returns {string} Listener ID\r\n     */\r\n    throttled(target, eventType, handler, limit = 100, options = {}) {\r\n        let inThrottle = false;\r\n\r\n        const throttledHandler = (event) => {\r\n            if (!inThrottle) {\r\n                handler(event);\r\n                inThrottle = true;\r\n                setTimeout(() => {\r\n                    inThrottle = false;\r\n                }, limit);\r\n            }\r\n        };\r\n\r\n        return this.addEventListener(target, eventType, throttledHandler, options);\r\n    }\r\n\r\n    // Removed setupUnloadHandler - causes permission violations\r\n    // Browser automatically cleans up event listeners on unload\r\n\r\n    /**\r\n     * Generate unique ID\r\n     * @private\r\n     * @returns {string} Unique ID\r\n     */\r\n    generateId() {\r\n        return `listener_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    /**\r\n     * Get statistics\r\n     * @returns {Object} Statistics\r\n     */\r\n    getStats() {\r\n        return {\r\n            ...this.stats,\r\n            groups: this.groups.size,\r\n            listeners: this.listeners.size\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get active listeners for debugging\r\n     * @returns {Array} Active listener info\r\n     */\r\n    getActiveListeners() {\r\n        const active = [];\r\n\r\n        for (const [id, info] of this.listeners.entries()) {\r\n            if (info.active) {\r\n                active.push({\r\n                    id,\r\n                    eventType: info.eventType,\r\n                    group: info.group,\r\n                    target: info.target.constructor.name\r\n                });\r\n            }\r\n        }\r\n\r\n        return active;\r\n    }\r\n\r\n    /**\r\n     * Check for potential memory leaks\r\n     * @returns {Object} Leak analysis\r\n     */\r\n    analyzeLeaks() {\r\n        const analysis = {\r\n            totalListeners: this.listeners.size,\r\n            activeListeners: this.stats.active,\r\n            inactiveButNotRemoved: 0,\r\n            byTarget: new Map(),\r\n            byType: new Map(),\r\n            potentialLeaks: []\r\n        };\r\n\r\n        for (const [id, info] of this.listeners.entries()) {\r\n            // Count by target\r\n            const targetName = info.target.constructor.name;\r\n            analysis.byTarget.set(\r\n                targetName,\r\n                (analysis.byTarget.get(targetName) || 0) + 1\r\n            );\r\n\r\n            // Count by type\r\n            analysis.byType.set(\r\n                info.eventType,\r\n                (analysis.byType.get(info.eventType) || 0) + 1\r\n            );\r\n\r\n            // Check for inactive but not removed\r\n            if (!info.active) {\r\n                analysis.inactiveButNotRemoved++;\r\n                analysis.potentialLeaks.push({\r\n                    id,\r\n                    eventType: info.eventType,\r\n                    target: targetName\r\n                });\r\n            }\r\n        }\r\n\r\n        // Convert maps to objects for easier reading\r\n        analysis.byTarget = Object.fromEntries(analysis.byTarget);\r\n        analysis.byType = Object.fromEntries(analysis.byType);\r\n\r\n        return analysis;\r\n    }\r\n\r\n    /**\r\n     * Clean up inactive listeners\r\n     * @returns {number} Number cleaned\r\n     */\r\n    cleanup() {\r\n        let cleaned = 0;\r\n\r\n        for (const [id, info] of this.listeners.entries()) {\r\n            if (!info.active) {\r\n                this.listeners.delete(id);\r\n                cleaned++;\r\n            }\r\n        }\r\n\r\n        return cleaned;\r\n    }\r\n}\r\n\r\n// Create singleton instance\r\nexport const eventManager = new EventManager();\r\n\r\n// Export for convenience\r\nexport default eventManager;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                   ◐ ◑ ◒ ◓  ACCESSIBILITY MANAGER  ◓ ◒ ◑ ◐                   \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Accessibility Manager - Inclusive Design & A11y Support\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module AccessibilityManager\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Makes the Emotive Engine accessible to EVERYONE. Handles reduced motion,          \r\n * ║ screen readers, keyboard navigation, color blindness, and more.                   \r\n * ║ Because emotional expression should be universal.                                 \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ♿ ACCESSIBILITY FEATURES                                                         \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Reduced Motion     : Respects prefers-reduced-motion                            \r\n * │ • High Contrast      : Enhanced visibility mode                                   \r\n * │ • Screen Readers     : ARIA labels and live announcements                         \r\n * │ • Keyboard Nav       : Full keyboard control support                              \r\n * │ • Focus Indicators   : Clear visual focus states                                  \r\n * │ • Color Blind Modes  : Protanopia, Deuteranopia, Tritanopia                       \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎨 COLOR BLIND MODES                                                              \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • none         : Standard colors                                                  \r\n * │ • protanopia   : Red-blind friendly palette                                       \r\n * │ • deuteranopia : Green-blind friendly palette                                     \r\n * │ • tritanopia   : Blue-blind friendly palette                                      \r\n * │ • highContrast : Maximum contrast (black/white/yellow)                            \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ⌨️ KEYBOARD CONTROLS                                                              \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Tab/Shift+Tab : Navigate between elements                                      \r\n * │ • Enter/Space   : Activate focused element                                        \r\n * │ • Arrow Keys    : Directional navigation                                          \r\n * │ • Escape        : Cancel/close operations                                         \r\n * │ • Numbers 1-9   : Quick emotion selection                                         \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 📢 SCREEN READER SUPPORT                                                          \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • ARIA Labels      : Descriptive labels for all elements                          \r\n * │ • Live Regions     : Real-time state announcements                                \r\n * │ • Role Attributes  : Semantic HTML roles                                          \r\n * │ • State Changes    : Announced through live region                                \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🔧 CONFIGURATION OPTIONS                                                          \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • enableReducedMotion      : Honor system preference (default: true)              \r\n * │ • enableHighContrast       : Allow high contrast mode (default: true)             \r\n * │ • enableScreenReaderSupport: ARIA and announcements (default: true)               \r\n * │ • enableKeyboardNavigation : Keyboard controls (default: true)                    \r\n * │ • announceStateChanges     : Announce emotion changes (default: true)             \r\n * │ • colorBlindMode          : Color adjustment mode (default: 'none')              \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ ⚠️  IMPORTANT CONSIDERATIONS                                                      \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Always test with screen readers (NVDA, JAWS, VoiceOver)                         \r\n * │ • Validate color contrasts meet WCAG 2.1 AA standards                             \r\n * │ • Ensure all interactive elements are keyboard accessible                         \r\n * │ • Provide alternative text for visual-only information                            \r\n * │ • Test with browser zoom at 200% and 400%                                        \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                         IMPLEMENTING ACCESSIBILITY                                \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ const a11y = new AccessibilityManager({                                           \r\n * ║     colorBlindMode: 'protanopia',                                                 \r\n * ║     announceStateChanges: true                                                    \r\n * ║ });                                                                                \r\n * ║                                                                                    \r\n * ║ // Announce emotion change                                                        \r\n * ║ a11y.announceStateChange('Emotion changed to joy');                               \r\n * ║                                                                                    \r\n * ║ // Apply reduced motion                                                           \r\n * ║ if (a11y.shouldReduceMotion()) {                                                  \r\n * ║     // Use simpler animations                                                     \r\n * ║ }                                                                                  \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport class AccessibilityManager {\r\n    constructor(config = {}) {\r\n        this.config = {\r\n            enableReducedMotion: config.enableReducedMotion !== false,\r\n            enableHighContrast: config.enableHighContrast !== false,\r\n            enableScreenReaderSupport: config.enableScreenReaderSupport !== false,\r\n            enableKeyboardNavigation: config.enableKeyboardNavigation !== false,\r\n            enableFocusIndicators: config.enableFocusIndicators !== false,\r\n            announceStateChanges: config.announceStateChanges !== false,\r\n            colorBlindMode: config.colorBlindMode || 'none', // none, protanopia, deuteranopia, tritanopia\r\n            ...config\r\n        };\r\n        \r\n        // Accessibility state\r\n        this.reducedMotionPreferred = false;\r\n        this.highContrastEnabled = false;\r\n        this.screenReaderActive = false;\r\n        this.keyboardNavigationActive = false;\r\n        this.currentColorBlindMode = this.config.colorBlindMode;\r\n        \r\n        // Focus management\r\n        this.focusableElements = new Map();\r\n        this.currentFocusIndex = -1;\r\n        this.focusHistory = [];\r\n        \r\n        // ARIA live region for announcements\r\n        this.liveRegion = null;\r\n        this.announcementQueue = [];\r\n        \r\n        // Color schemes for different accessibility needs\r\n        this.colorSchemes = {\r\n            normal: null, // Will be set from current colors\r\n            highContrast: {\r\n                primary: '#FFFFFF',\r\n                secondary: '#000000',\r\n                accent: '#FFFF00',\r\n                background: '#000000',\r\n                particles: '#FFFFFF'\r\n            },\r\n            protanopia: { // Red-blind\r\n                primary: '#0066CC',\r\n                secondary: '#FFCC00',\r\n                accent: '#00CCFF',\r\n                background: '#1A1A1A',\r\n                particles: '#66CCFF'\r\n            },\r\n            deuteranopia: { // Green-blind\r\n                primary: '#0099FF',\r\n                secondary: '#FF9900',\r\n                accent: '#FF00FF',\r\n                background: '#1A1A1A',\r\n                particles: '#9966FF'\r\n            },\r\n            tritanopia: { // Blue-blind\r\n                primary: '#FF0066',\r\n                secondary: '#00FF66',\r\n                accent: '#FF6600',\r\n                background: '#1A1A1A',\r\n                particles: '#FFCC00'\r\n            }\r\n        };\r\n        \r\n        // Pattern overlays for color-blind modes\r\n        this.patterns = {\r\n            dots: 'dots',\r\n            stripes: 'stripes',\r\n            crosshatch: 'crosshatch',\r\n            solid: 'solid'\r\n        };\r\n        \r\n        // Emotional state patterns for color-blind users\r\n        this.statePatterns = {\r\n            idle: this.patterns.solid,\r\n            happy: this.patterns.dots,\r\n            excited: this.patterns.stripes,\r\n            calm: this.patterns.solid,\r\n            curious: this.patterns.crosshatch,\r\n            frustrated: this.patterns.stripes,\r\n            sad: this.patterns.dots,\r\n            neutral: this.patterns.solid\r\n        };\r\n        \r\n        // Initialize accessibility features\r\n        this.initialize();\r\n    }\r\n    \r\n    /**\r\n     * Initialize accessibility features\r\n     */\r\n    initialize() {\r\n        // Detect user preferences\r\n        this.detectUserPreferences();\r\n        \r\n        // Set up ARIA live region\r\n        this.setupLiveRegion();\r\n        \r\n        // Set up keyboard navigation if enabled\r\n        if (this.config.enableKeyboardNavigation) {\r\n            this.setupKeyboardNavigation();\r\n        }\r\n        \r\n        // Listen for preference changes\r\n        this.setupPreferenceListeners();\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Detect user accessibility preferences\r\n     */\r\n    detectUserPreferences() {\r\n        // Detect reduced motion preference\r\n        if (this.config.enableReducedMotion && window.matchMedia) {\r\n            const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\r\n            this.reducedMotionPreferred = motionQuery.matches;\r\n        }\r\n        \r\n        // Detect high contrast preference\r\n        if (this.config.enableHighContrast && window.matchMedia) {\r\n            const contrastQuery = window.matchMedia('(prefers-contrast: high)');\r\n            this.highContrastEnabled = contrastQuery.matches;\r\n            \r\n            // Also check for Windows high contrast mode\r\n            if (!this.highContrastEnabled) {\r\n                const windowsHCQuery = window.matchMedia('(-ms-high-contrast: active)');\r\n                this.highContrastEnabled = windowsHCQuery.matches;\r\n            }\r\n        }\r\n        \r\n        // Detect screen reader (heuristic approach)\r\n        this.detectScreenReader();\r\n    }\r\n    \r\n    /**\r\n     * Detect if a screen reader is likely active\r\n     */\r\n    detectScreenReader() {\r\n        // Check for ARIA attributes being actively used\r\n        const hasAriaLive = document.querySelector('[aria-live]');\r\n        const hasAriaAtomic = document.querySelector('[aria-atomic]');\r\n        \r\n        // Check for screen reader specific attributes\r\n        const hasRole = document.querySelector('[role=\"application\"]');\r\n        \r\n        // Check user agent for assistive technology hints\r\n        const userAgent = navigator.userAgent.toLowerCase();\r\n        const hasATHints = userAgent.includes('nvda') || \r\n                          userAgent.includes('jaws') || \r\n                          userAgent.includes('voiceover');\r\n        \r\n        this.screenReaderActive = !!(hasAriaLive || hasAriaAtomic || hasRole || hasATHints);\r\n    }\r\n    \r\n    /**\r\n     * Set up ARIA live region for announcements\r\n     */\r\n    setupLiveRegion() {\r\n        if (!this.config.enableScreenReaderSupport) return;\r\n        \r\n        // Create live region if it doesn't exist\r\n        this.liveRegion = document.getElementById('mascot-announcements');\r\n        if (!this.liveRegion) {\r\n            this.liveRegion = document.createElement('div');\r\n            this.liveRegion.id = 'mascot-announcements';\r\n            this.liveRegion.setAttribute('aria-live', 'polite');\r\n            this.liveRegion.setAttribute('aria-atomic', 'true');\r\n            this.liveRegion.style.position = 'absolute';\r\n            this.liveRegion.style.left = '-10000px';\r\n            this.liveRegion.style.width = '1px';\r\n            this.liveRegion.style.height = '1px';\r\n            this.liveRegion.style.overflow = 'hidden';\r\n            document.body.appendChild(this.liveRegion);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set up keyboard navigation\r\n     */\r\n    setupKeyboardNavigation() {\r\n        document.addEventListener('keydown', this.handleKeyDown.bind(this));\r\n        document.addEventListener('keyup', this.handleKeyUp.bind(this));\r\n    }\r\n    \r\n    /**\r\n     * Set up listeners for preference changes\r\n     */\r\n    setupPreferenceListeners() {\r\n        if (window.matchMedia) {\r\n            // Listen for reduced motion changes\r\n            const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\r\n            motionQuery.addListener((e) => {\r\n                this.reducedMotionPreferred = e.matches;\r\n                this.onPreferenceChange('reducedMotion', e.matches);\r\n            });\r\n            \r\n            // Listen for high contrast changes\r\n            const contrastQuery = window.matchMedia('(prefers-contrast: high)');\r\n            contrastQuery.addListener((e) => {\r\n                this.highContrastEnabled = e.matches;\r\n                this.onPreferenceChange('highContrast', e.matches);\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle keyboard navigation\r\n     * @param {KeyboardEvent} event - Keyboard event\r\n     */\r\n    handleKeyDown(event) {\r\n        if (!this.config.enableKeyboardNavigation) return;\r\n        \r\n        switch (event.key) {\r\n            case 'Tab':\r\n                event.preventDefault();\r\n                this.navigateFocus(event.shiftKey ? -1 : 1);\r\n                break;\r\n            case 'Enter':\r\n            case ' ':\r\n                this.activateCurrentFocus();\r\n                break;\r\n            case 'Escape':\r\n                this.clearFocus();\r\n                break;\r\n            case 'ArrowLeft':\r\n            case 'ArrowRight':\r\n            case 'ArrowUp':\r\n            case 'ArrowDown':\r\n                this.handleArrowNavigation(event.key);\r\n                break;\r\n        }\r\n        \r\n        this.keyboardNavigationActive = true;\r\n    }\r\n    \r\n    /**\r\n     * Handle key up events\r\n     * @param {KeyboardEvent} event - Keyboard event\r\n     */\r\n    handleKeyUp(event) {\r\n        // Could be used for specific key release actions\r\n    }\r\n    \r\n    /**\r\n     * Navigate focus between elements\r\n     * @param {number} direction - Direction to navigate (1 or -1)\r\n     */\r\n    navigateFocus(direction) {\r\n        const focusableArray = Array.from(this.focusableElements.values());\r\n        if (focusableArray.length === 0) return;\r\n        \r\n        this.currentFocusIndex += direction;\r\n        \r\n        // Wrap around\r\n        if (this.currentFocusIndex < 0) {\r\n            this.currentFocusIndex = focusableArray.length - 1;\r\n        } else if (this.currentFocusIndex >= focusableArray.length) {\r\n            this.currentFocusIndex = 0;\r\n        }\r\n        \r\n        const element = focusableArray[this.currentFocusIndex];\r\n        this.setFocus(element);\r\n        \r\n        // Announce focus change\r\n        if (element.label) {\r\n            this.announce(`Focused on ${element.label}`);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle arrow key navigation\r\n     * @param {string} key - Arrow key pressed\r\n     */\r\n    handleArrowNavigation(key) {\r\n        // This would be implemented based on spatial navigation needs\r\n        const directions = {\r\n            'ArrowLeft': { x: -1, y: 0 },\r\n            'ArrowRight': { x: 1, y: 0 },\r\n            'ArrowUp': { x: 0, y: -1 },\r\n            'ArrowDown': { x: 0, y: 1 }\r\n        };\r\n        \r\n        const direction = directions[key];\r\n        if (direction && this.onArrowNavigation) {\r\n            this.onArrowNavigation(direction);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Register a focusable element\r\n     * @param {string} id - Element identifier\r\n     * @param {Object} element - Element properties\r\n     */\r\n    registerFocusableElement(id, element) {\r\n        this.focusableElements.set(id, {\r\n            id,\r\n            label: element.label || id,\r\n            bounds: element.bounds || null,\r\n            action: element.action || null,\r\n            type: element.type || 'button'\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Unregister a focusable element\r\n     * @param {string} id - Element identifier\r\n     */\r\n    unregisterFocusableElement(id) {\r\n        this.focusableElements.delete(id);\r\n    }\r\n    \r\n    /**\r\n     * Set focus on an element\r\n     * @param {Object} element - Element to focus\r\n     */\r\n    setFocus(element) {\r\n        if (this.onFocusChange) {\r\n            this.onFocusChange(element);\r\n        }\r\n        \r\n        this.focusHistory.push(element.id);\r\n        if (this.focusHistory.length > 10) {\r\n            this.focusHistory.shift();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clear current focus\r\n     */\r\n    clearFocus() {\r\n        this.currentFocusIndex = -1;\r\n        if (this.onFocusChange) {\r\n            this.onFocusChange(null);\r\n        }\r\n        \r\n        this.announce('Focus cleared');\r\n    }\r\n    \r\n    /**\r\n     * Activate the currently focused element\r\n     */\r\n    activateCurrentFocus() {\r\n        const focusableArray = Array.from(this.focusableElements.values());\r\n        if (this.currentFocusIndex >= 0 && this.currentFocusIndex < focusableArray.length) {\r\n            const element = focusableArray[this.currentFocusIndex];\r\n            if (element.action) {\r\n                element.action();\r\n                this.announce(`Activated ${element.label}`);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Announce a message to screen readers\r\n     * @param {string} message - Message to announce\r\n     * @param {string} priority - Priority level (polite, assertive)\r\n     */\r\n    announce(message, priority = 'polite') {\r\n        if (!this.config.enableScreenReaderSupport || !this.liveRegion) return;\r\n        \r\n        // Queue the announcement\r\n        this.announcementQueue.push({ message, priority });\r\n        \r\n        // Process queue\r\n        this.processAnnouncementQueue();\r\n    }\r\n    \r\n    /**\r\n     * Process announcement queue\r\n     */\r\n    processAnnouncementQueue() {\r\n        if (this.announcementQueue.length === 0) return;\r\n        \r\n        const { message, priority } = this.announcementQueue.shift();\r\n        \r\n        // Update live region\r\n        this.liveRegion.setAttribute('aria-live', priority);\r\n        this.liveRegion.textContent = message;\r\n        \r\n        // Clear after a delay to allow screen reader to announce\r\n        setTimeout(() => {\r\n            if (this.liveRegion) {\r\n                this.liveRegion.textContent = '';\r\n            }\r\n            \r\n            // Process next announcement if any\r\n            if (this.announcementQueue.length > 0) {\r\n                this.processAnnouncementQueue();\r\n            }\r\n        }, 100);\r\n    }\r\n    \r\n    /**\r\n     * Get adjusted animation settings based on accessibility preferences\r\n     * @param {Object} originalSettings - Original animation settings\r\n     * @returns {Object} Adjusted settings\r\n     */\r\n    getAnimationSettings(originalSettings = {}) {\r\n        if (!this.reducedMotionPreferred) {\r\n            return originalSettings;\r\n        }\r\n        \r\n        // Reduce or disable animations for users who prefer reduced motion\r\n        return {\r\n            ...originalSettings,\r\n            duration: originalSettings.duration ? originalSettings.duration * 0.5 : 0,\r\n            iterations: 1,\r\n            easing: 'linear',\r\n            particlesEnabled: false,\r\n            complexAnimations: false,\r\n            autoPlay: false\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Get adjusted color scheme based on accessibility preferences\r\n     * @param {Object} originalColors - Original color scheme\r\n     * @returns {Object} Adjusted colors\r\n     */\r\n    getColorScheme(originalColors = {}) {\r\n        // Store original colors if not set\r\n        if (!this.colorSchemes.normal) {\r\n            this.colorSchemes.normal = { ...originalColors };\r\n        }\r\n        \r\n        // Apply high contrast if needed\r\n        if (this.highContrastEnabled) {\r\n            return this.colorSchemes.highContrast;\r\n        }\r\n        \r\n        // Apply color blind mode if set\r\n        if (this.currentColorBlindMode !== 'none' && this.colorSchemes[this.currentColorBlindMode]) {\r\n            return this.colorSchemes[this.currentColorBlindMode];\r\n        }\r\n        \r\n        return originalColors;\r\n    }\r\n    \r\n    /**\r\n     * Get pattern for current state (for color blind users)\r\n     * @param {string} state - Current emotional state\r\n     * @returns {string} Pattern identifier\r\n     */\r\n    getStatePattern(state) {\r\n        if (this.currentColorBlindMode === 'none') {\r\n            return this.patterns.solid;\r\n        }\r\n        \r\n        return this.statePatterns[state] || this.patterns.solid;\r\n    }\r\n    \r\n    /**\r\n     * Apply pattern overlay to canvas\r\n     * @param {CanvasRenderingContext2D} ctx - Canvas context\r\n     * @param {string} pattern - Pattern type\r\n     * @param {Object} bounds - Area to apply pattern\r\n     */\r\n    applyPatternOverlay(ctx, pattern, bounds) {\r\n        if (pattern === this.patterns.solid) return;\r\n        \r\n        ctx.save();\r\n        \r\n        const patternCanvas = document.createElement('canvas');\r\n        const patternCtx = patternCanvas.getContext('2d');\r\n        \r\n        switch (pattern) {\r\n            case this.patterns.dots:\r\n                this.createDotPattern(patternCtx, patternCanvas);\r\n                break;\r\n            case this.patterns.stripes:\r\n                this.createStripePattern(patternCtx, patternCanvas);\r\n                break;\r\n            case this.patterns.crosshatch:\r\n                this.createCrosshatchPattern(patternCtx, patternCanvas);\r\n                break;\r\n        }\r\n        \r\n        const canvasPattern = ctx.createPattern(patternCanvas, 'repeat');\r\n        ctx.fillStyle = canvasPattern;\r\n        ctx.globalAlpha = 0.3; // Semi-transparent overlay\r\n        ctx.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);\r\n        \r\n        ctx.restore();\r\n    }\r\n    \r\n    /**\r\n     * Create dot pattern\r\n     * @param {CanvasRenderingContext2D} ctx - Pattern canvas context\r\n     * @param {HTMLCanvasElement} canvas - Pattern canvas\r\n     */\r\n    createDotPattern(ctx, canvas) {\r\n        canvas.width = 10;\r\n        canvas.height = 10;\r\n        \r\n        ctx.fillStyle = 'white';\r\n        ctx.beginPath();\r\n        ctx.arc(5, 5, 2, 0, Math.PI * 2);\r\n        ctx.fill();\r\n    }\r\n    \r\n    /**\r\n     * Create stripe pattern\r\n     * @param {CanvasRenderingContext2D} ctx - Pattern canvas context\r\n     * @param {HTMLCanvasElement} canvas - Pattern canvas\r\n     */\r\n    createStripePattern(ctx, canvas) {\r\n        canvas.width = 10;\r\n        canvas.height = 10;\r\n        \r\n        ctx.strokeStyle = 'white';\r\n        ctx.lineWidth = 2;\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, 10);\r\n        ctx.lineTo(10, 0);\r\n        ctx.stroke();\r\n    }\r\n    \r\n    /**\r\n     * Create crosshatch pattern\r\n     * @param {CanvasRenderingContext2D} ctx - Pattern canvas context\r\n     * @param {HTMLCanvasElement} canvas - Pattern canvas\r\n     */\r\n    createCrosshatchPattern(ctx, canvas) {\r\n        canvas.width = 10;\r\n        canvas.height = 10;\r\n        \r\n        ctx.strokeStyle = 'white';\r\n        ctx.lineWidth = 1;\r\n        \r\n        // Diagonal lines\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, 10);\r\n        ctx.lineTo(10, 0);\r\n        ctx.stroke();\r\n        \r\n        ctx.beginPath();\r\n        ctx.moveTo(0, 0);\r\n        ctx.lineTo(10, 10);\r\n        ctx.stroke();\r\n    }\r\n    \r\n    /**\r\n     * Set color blind mode\r\n     * @param {string} mode - Color blind mode\r\n     */\r\n    setColorBlindMode(mode) {\r\n        const validModes = ['none', 'protanopia', 'deuteranopia', 'tritanopia'];\r\n        if (!validModes.includes(mode)) {\r\n            return;\r\n        }\r\n        \r\n        this.currentColorBlindMode = mode;\r\n        this.announce(`Color blind mode set to ${mode}`);\r\n        \r\n        if (this.onColorSchemeChange) {\r\n            this.onColorSchemeChange(this.getColorScheme());\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get accessibility status report\r\n     * @returns {Object} Accessibility status\r\n     */\r\n    getStatus() {\r\n        return {\r\n            reducedMotion: this.reducedMotionPreferred,\r\n            highContrast: this.highContrastEnabled,\r\n            screenReader: this.screenReaderActive,\r\n            keyboardNavigation: this.keyboardNavigationActive,\r\n            colorBlindMode: this.currentColorBlindMode,\r\n            focusedElement: this.currentFocusIndex >= 0 ? \r\n                Array.from(this.focusableElements.values())[this.currentFocusIndex] : null,\r\n            registeredElements: this.focusableElements.size\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Handle preference change\r\n     * @param {string} preference - Preference that changed\r\n     * @param {*} value - New value\r\n     */\r\n    onPreferenceChange(preference, value) {\r\n        \r\n        // Notify about the change\r\n        this.announce(`${preference} is now ${value ? 'enabled' : 'disabled'}`);\r\n        \r\n        // Trigger callbacks if set\r\n        if (preference === 'reducedMotion' && this.onReducedMotionChange) {\r\n            this.onReducedMotionChange(value);\r\n        }\r\n        \r\n        if (preference === 'highContrast' && this.onHighContrastChange) {\r\n            this.onHighContrastChange(value);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Create ARIA description for mascot state\r\n     * @param {Object} state - Current mascot state\r\n     * @returns {string} ARIA description\r\n     */\r\n    createStateDescription(state) {\r\n        const descriptions = {\r\n            idle: 'Mascot is idle and gently breathing',\r\n            happy: 'Mascot is happy and bouncing',\r\n            excited: 'Mascot is excited with particles flying',\r\n            calm: 'Mascot is calm and peaceful',\r\n            curious: 'Mascot is curious and looking around',\r\n            frustrated: 'Mascot is frustrated and shaking',\r\n            sad: 'Mascot is sad and drooping',\r\n            neutral: 'Mascot is in a neutral state'\r\n        };\r\n        \r\n        return descriptions[state.emotional] || 'Mascot is active';\r\n    }\r\n    \r\n    /**\r\n     * Destroy accessibility manager\r\n     */\r\n    destroy() {\r\n        // Remove event listeners\r\n        document.removeEventListener('keydown', this.handleKeyDown);\r\n        document.removeEventListener('keyup', this.handleKeyUp);\r\n        \r\n        // Remove live region\r\n        if (this.liveRegion && this.liveRegion.parentNode) {\r\n            this.liveRegion.parentNode.removeChild(this.liveRegion);\r\n        }\r\n        \r\n        // Clear data\r\n        this.focusableElements.clear();\r\n        this.announcementQueue = [];\r\n        this.focusHistory = [];\r\n        \r\n    }\r\n}\r\n\r\nexport default AccessibilityManager;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                  ◐ ◑ ◒ ◓  MOBILE OPTIMIZATION  ◓ ◒ ◑ ◐                  \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Mobile Optimization - Touch & Mobile Device Support\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module MobileOptimization\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ Makes the orb TOUCHABLE and mobile-friendly. Handles all the quirks of           \r\n * ║ mobile browsers, touch events, viewport changes, and battery optimization.        \r\n * ║ Ensures smooth performance even on low-end phones.                               \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 📱 MOBILE FEATURES                                                                 \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Touch event handling (tap, swipe, pinch)                                        \r\n * │ • Viewport resize handling                                                        \r\n * │ • Orientation change detection                                                    \r\n * │ • Battery-aware performance                                                       \r\n * │ • Reduced particle count on mobile                                                \r\n * │ • Touch-friendly interaction zones                                                \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport class MobileOptimization {\r\n    constructor(config = {}) {\r\n        this.config = {\r\n            enableTouchOptimization: config.enableTouchOptimization !== false,\r\n            enableViewportHandling: config.enableViewportHandling !== false,\r\n            enableBatteryOptimization: config.enableBatteryOptimization !== false,\r\n            enableOrientationSupport: config.enableOrientationSupport !== false,\r\n            enableResponsiveScaling: config.enableResponsiveScaling !== false,\r\n            touchSensitivity: config.touchSensitivity || 1.0,\r\n            doubleTapDelay: config.doubleTapDelay || 300,\r\n            swipeThreshold: config.swipeThreshold || 50,\r\n            pinchThreshold: config.pinchThreshold || 0.1,\r\n            ...config\r\n        };\r\n        \r\n        // Device detection\r\n        this.isMobile = this.detectMobile();\r\n        this.isTablet = this.detectTablet();\r\n        this.isTouchDevice = this.detectTouch();\r\n        this.isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\r\n        this.isAndroid = /Android/.test(navigator.userAgent);\r\n        \r\n        // Touch state\r\n        this.touches = new Map();\r\n        this.lastTouchTime = 0;\r\n        this.lastTapTime = 0;\r\n        this.tapCount = 0;\r\n        this.touchStartPosition = null;\r\n        this.isPinching = false;\r\n        this.isRotating = false;\r\n        this.lastPinchDistance = 0;\r\n        this.lastRotation = 0;\r\n        \r\n        // Gesture recognition\r\n        this.currentGesture = null;\r\n        this.gestureStartTime = 0;\r\n        this.gestureHistory = [];\r\n        \r\n        // Viewport state\r\n        this.viewportSize = { width: window.innerWidth, height: window.innerHeight };\r\n        this.orientation = this.getOrientation();\r\n        this.pixelRatio = window.devicePixelRatio || 1;\r\n        this.lastViewportChange = 0;\r\n        \r\n        // Battery state\r\n        this.batteryLevel = 1.0;\r\n        this.isCharging = true;\r\n        this.lowPowerMode = false;\r\n        \r\n        // Performance adjustments for mobile\r\n        this.mobilePerformanceSettings = {\r\n            reducedParticles: this.isMobile,\r\n            simplifiedAnimations: this.isMobile,\r\n            lowerFrameRate: this.isMobile,\r\n            reducedEffects: this.isMobile || this.isTablet,\r\n            targetFPS: this.isMobile ? 30 : 60,\r\n            maxParticles: this.isMobile ? 20 : 50\r\n        };\r\n        \r\n        // Canvas optimization\r\n        this.canvasScale = 1.0;\r\n        this.useOffscreenCanvas = this.supportsOffscreenCanvas();\r\n        \r\n        // Event handlers bound to this\r\n        this.handleTouchStart = this.handleTouchStart.bind(this);\r\n        this.handleTouchMove = this.handleTouchMove.bind(this);\r\n        this.handleTouchEnd = this.handleTouchEnd.bind(this);\r\n        this.handleTouchCancel = this.handleTouchCancel.bind(this);\r\n        this.handleOrientationChange = this.handleOrientationChange.bind(this);\r\n        this.handleViewportChange = this.handleViewportChange.bind(this);\r\n        this.handleVisibilityChange = this.handleVisibilityChange.bind(this);\r\n        \r\n        // Initialize\r\n        this.initialize();\r\n    }\r\n    \r\n    /**\r\n     * Initialize mobile optimization\r\n     */\r\n    initialize() {\r\n        if (this.config.enableTouchOptimization && this.isTouchDevice) {\r\n            this.setupTouchHandlers();\r\n        }\r\n        \r\n        if (this.config.enableViewportHandling) {\r\n            this.setupViewportHandlers();\r\n        }\r\n        \r\n        if (this.config.enableBatteryOptimization) {\r\n            this.setupBatteryMonitoring();\r\n        }\r\n        \r\n        if (this.config.enableOrientationSupport) {\r\n            this.setupOrientationHandlers();\r\n        }\r\n        \r\n        // Apply initial optimizations\r\n        this.applyMobileOptimizations();\r\n    }\r\n    \r\n    /**\r\n     * Detect if device is mobile\r\n     * @returns {boolean} True if mobile device\r\n     */\r\n    detectMobile() {\r\n        const userAgent = navigator.userAgent.toLowerCase();\r\n        const mobileKeywords = ['android', 'iphone', 'ipod', 'windows phone', 'blackberry'];\r\n        \r\n        // Check user agent\r\n        const isMobileUA = mobileKeywords.some(keyword => userAgent.includes(keyword));\r\n        \r\n        // Check screen size\r\n        const isMobileSize = window.innerWidth <= 768;\r\n        \r\n        // Check for touch and small screen\r\n        const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\r\n        \r\n        return isMobileUA || (isMobileSize && hasTouch);\r\n    }\r\n    \r\n    /**\r\n     * Detect if device is tablet\r\n     * @returns {boolean} True if tablet device\r\n     */\r\n    detectTablet() {\r\n        const userAgent = navigator.userAgent.toLowerCase();\r\n        const isIPad = /ipad/.test(userAgent);\r\n        const isAndroidTablet = /android/.test(userAgent) && !/mobile/.test(userAgent);\r\n        const isWindowsTablet = /windows/.test(userAgent) && /touch/.test(userAgent);\r\n        \r\n        // Check screen size for tablet range\r\n        const isTabletSize = window.innerWidth > 768 && window.innerWidth <= 1024;\r\n        const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\r\n        \r\n        return isIPad || isAndroidTablet || isWindowsTablet || (isTabletSize && hasTouch);\r\n    }\r\n    \r\n    /**\r\n     * Detect touch support\r\n     * @returns {boolean} True if touch is supported\r\n     */\r\n    detectTouch() {\r\n        return 'ontouchstart' in window || \r\n               navigator.maxTouchPoints > 0 || \r\n               navigator.msMaxTouchPoints > 0;\r\n    }\r\n    \r\n    /**\r\n     * Check if offscreen canvas is supported\r\n     * @returns {boolean} True if OffscreenCanvas is supported\r\n     */\r\n    supportsOffscreenCanvas() {\r\n        return typeof OffscreenCanvas !== 'undefined';\r\n    }\r\n    \r\n    /**\r\n     * Set up touch event handlers\r\n     */\r\n    setupTouchHandlers() {\r\n        const canvas = this.getCanvas();\r\n        if (!canvas) return;\r\n        \r\n        // Prevent default touch behaviors\r\n        canvas.style.touchAction = 'none';\r\n        canvas.style.userSelect = 'none';\r\n        canvas.style.webkitUserSelect = 'none';\r\n        \r\n        // Add touch event listeners\r\n        canvas.addEventListener('touchstart', this.handleTouchStart, { passive: false });\r\n        canvas.addEventListener('touchmove', this.handleTouchMove, { passive: false });\r\n        canvas.addEventListener('touchend', this.handleTouchEnd, { passive: false });\r\n        canvas.addEventListener('touchcancel', this.handleTouchCancel, { passive: false });\r\n        \r\n        // Prevent context menu on long press\r\n        canvas.addEventListener('contextmenu', (e) => e.preventDefault());\r\n    }\r\n    \r\n    /**\r\n     * Set up viewport change handlers\r\n     */\r\n    setupViewportHandlers() {\r\n        window.addEventListener('resize', this.handleViewportChange);\r\n        window.addEventListener('orientationchange', this.handleOrientationChange);\r\n        \r\n        // Handle visibility changes for battery optimization\r\n        document.addEventListener('visibilitychange', this.handleVisibilityChange);\r\n        \r\n        // Handle viewport meta changes\r\n        this.setupViewportMeta();\r\n    }\r\n    \r\n    /**\r\n     * Set up viewport meta tag for mobile\r\n     */\r\n    setupViewportMeta() {\r\n        let viewportMeta = document.querySelector('meta[name=\"viewport\"]');\r\n        \r\n        if (!viewportMeta) {\r\n            viewportMeta = document.createElement('meta');\r\n            viewportMeta.name = 'viewport';\r\n            document.head.appendChild(viewportMeta);\r\n        }\r\n        \r\n        // Set optimal viewport for mobile\r\n        viewportMeta.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';\r\n    }\r\n    \r\n    /**\r\n     * Set up battery monitoring\r\n     */\r\n    async setupBatteryMonitoring() {\r\n        if (!navigator.getBattery) return;\r\n        \r\n        try {\r\n            const battery = await navigator.getBattery();\r\n            \r\n            this.batteryLevel = battery.level;\r\n            this.isCharging = battery.charging;\r\n            \r\n            // Listen for battery changes\r\n            battery.addEventListener('levelchange', () => {\r\n                this.batteryLevel = battery.level;\r\n                this.onBatteryChange();\r\n            });\r\n            \r\n            battery.addEventListener('chargingchange', () => {\r\n                this.isCharging = battery.charging;\r\n                this.onBatteryChange();\r\n            });\r\n            \r\n            // Initial battery optimization\r\n            this.onBatteryChange();\r\n        } catch (error) {\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set up orientation change handlers\r\n     */\r\n    setupOrientationHandlers() {\r\n        if (window.DeviceOrientationEvent) {\r\n            window.addEventListener('deviceorientation', (event) => {\r\n                this.handleDeviceOrientation(event);\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle touch start\r\n     * @param {TouchEvent} event - Touch event\r\n     */\r\n    handleTouchStart(event) {\r\n        event.preventDefault();\r\n        \r\n        const now = Date.now();\r\n        this.gestureStartTime = now;\r\n        \r\n        // Store all touches\r\n        for (const touch of event.touches) {\r\n            this.touches.set(touch.identifier, {\r\n                id: touch.identifier,\r\n                startX: touch.clientX,\r\n                startY: touch.clientY,\r\n                currentX: touch.clientX,\r\n                currentY: touch.clientY,\r\n                startTime: now\r\n            });\r\n        }\r\n        \r\n        // Handle different touch counts\r\n        if (event.touches.length === 1) {\r\n            this.handleSingleTouchStart(event.touches[0]);\r\n        } else if (event.touches.length === 2) {\r\n            this.handleMultiTouchStart(event.touches);\r\n        }\r\n        \r\n        // Emit touch event\r\n        this.emitTouchEvent('touchStart', {\r\n            touches: Array.from(this.touches.values()),\r\n            timestamp: now\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Handle single touch start\r\n     * @param {Touch} touch - Touch object\r\n     */\r\n    handleSingleTouchStart(touch) {\r\n        const now = Date.now();\r\n        \r\n        // Check for double tap\r\n        if (now - this.lastTapTime < this.config.doubleTapDelay) {\r\n            this.tapCount++;\r\n        } else {\r\n            this.tapCount = 1;\r\n        }\r\n        \r\n        this.lastTapTime = now;\r\n        this.touchStartPosition = { x: touch.clientX, y: touch.clientY };\r\n    }\r\n    \r\n    /**\r\n     * Handle multi-touch start\r\n     * @param {TouchList} touches - Touch list\r\n     */\r\n    handleMultiTouchStart(touches) {\r\n        if (touches.length === 2) {\r\n            // Initialize pinch/rotate\r\n            const touch1 = touches[0];\r\n            const touch2 = touches[1];\r\n            \r\n            this.lastPinchDistance = this.getDistance(\r\n                touch1.clientX, touch1.clientY,\r\n                touch2.clientX, touch2.clientY\r\n            );\r\n            \r\n            this.lastRotation = this.getAngle(\r\n                touch1.clientX, touch1.clientY,\r\n                touch2.clientX, touch2.clientY\r\n            );\r\n            \r\n            this.isPinching = true;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle touch move\r\n     * @param {TouchEvent} event - Touch event\r\n     */\r\n    handleTouchMove(event) {\r\n        event.preventDefault();\r\n        \r\n        // Update touch positions\r\n        for (const touch of event.touches) {\r\n            const storedTouch = this.touches.get(touch.identifier);\r\n            if (storedTouch) {\r\n                storedTouch.currentX = touch.clientX;\r\n                storedTouch.currentY = touch.clientY;\r\n            }\r\n        }\r\n        \r\n        // Handle gestures based on touch count\r\n        if (event.touches.length === 1) {\r\n            this.handleSingleTouchMove(event.touches[0]);\r\n        } else if (event.touches.length === 2) {\r\n            this.handleMultiTouchMove(event.touches);\r\n        }\r\n        \r\n        // Emit touch event\r\n        this.emitTouchEvent('touchMove', {\r\n            touches: Array.from(this.touches.values()),\r\n            gesture: this.currentGesture\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Handle single touch move\r\n     * @param {Touch} touch - Touch object\r\n     */\r\n    handleSingleTouchMove(touch) {\r\n        const storedTouch = this.touches.get(touch.identifier);\r\n        if (!storedTouch) return;\r\n        \r\n        const deltaX = touch.clientX - storedTouch.startX;\r\n        const deltaY = touch.clientY - storedTouch.startY;\r\n        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n        \r\n        // Detect swipe gesture\r\n        if (distance > this.config.swipeThreshold) {\r\n            const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;\r\n            \r\n            if (Math.abs(deltaX) > Math.abs(deltaY)) {\r\n                this.currentGesture = deltaX > 0 ? 'swipeRight' : 'swipeLeft';\r\n            } else {\r\n                this.currentGesture = deltaY > 0 ? 'swipeDown' : 'swipeUp';\r\n            }\r\n        } else {\r\n            this.currentGesture = 'pan';\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle multi-touch move\r\n     * @param {TouchList} touches - Touch list\r\n     */\r\n    handleMultiTouchMove(touches) {\r\n        if (touches.length !== 2) return;\r\n        \r\n        const touch1 = touches[0];\r\n        const touch2 = touches[1];\r\n        \r\n        // Calculate pinch\r\n        const currentDistance = this.getDistance(\r\n            touch1.clientX, touch1.clientY,\r\n            touch2.clientX, touch2.clientY\r\n        );\r\n        \r\n        const pinchDelta = currentDistance - this.lastPinchDistance;\r\n        const pinchRatio = currentDistance / this.lastPinchDistance;\r\n        \r\n        if (Math.abs(pinchDelta) > this.config.pinchThreshold) {\r\n            this.currentGesture = pinchRatio > 1 ? 'pinchOut' : 'pinchIn';\r\n            \r\n            // Emit pinch event\r\n            this.emitTouchEvent('pinch', {\r\n                scale: pinchRatio,\r\n                delta: pinchDelta\r\n            });\r\n        }\r\n        \r\n        // Calculate rotation\r\n        const currentRotation = this.getAngle(\r\n            touch1.clientX, touch1.clientY,\r\n            touch2.clientX, touch2.clientY\r\n        );\r\n        \r\n        const rotationDelta = currentRotation - this.lastRotation;\r\n        \r\n        if (Math.abs(rotationDelta) > 5) { // 5 degree threshold\r\n            this.currentGesture = 'rotate';\r\n            \r\n            // Emit rotation event\r\n            this.emitTouchEvent('rotate', {\r\n                angle: currentRotation,\r\n                delta: rotationDelta\r\n            });\r\n        }\r\n        \r\n        this.lastPinchDistance = currentDistance;\r\n        this.lastRotation = currentRotation;\r\n    }\r\n    \r\n    /**\r\n     * Handle touch end\r\n     * @param {TouchEvent} event - Touch event\r\n     */\r\n    handleTouchEnd(event) {\r\n        event.preventDefault();\r\n        \r\n        const now = Date.now();\r\n        \r\n        // Process ended touches\r\n        for (const touch of event.changedTouches) {\r\n            const storedTouch = this.touches.get(touch.identifier);\r\n            \r\n            if (storedTouch) {\r\n                const duration = now - storedTouch.startTime;\r\n                const deltaX = storedTouch.currentX - storedTouch.startX;\r\n                const deltaY = storedTouch.currentY - storedTouch.startY;\r\n                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n                \r\n                // Detect tap\r\n                if (duration < 300 && distance < 10) {\r\n                    if (this.tapCount === 2) {\r\n                        this.emitTouchEvent('doubleTap', {\r\n                            x: storedTouch.currentX,\r\n                            y: storedTouch.currentY\r\n                        });\r\n                        this.tapCount = 0;\r\n                    } else {\r\n                        this.emitTouchEvent('tap', {\r\n                            x: storedTouch.currentX,\r\n                            y: storedTouch.currentY\r\n                        });\r\n                    }\r\n                }\r\n                \r\n                // Detect long press\r\n                if (duration > 500 && distance < 10) {\r\n                    this.emitTouchEvent('longPress', {\r\n                        x: storedTouch.currentX,\r\n                        y: storedTouch.currentY\r\n                    });\r\n                }\r\n                \r\n                this.touches.delete(touch.identifier);\r\n            }\r\n        }\r\n        \r\n        // Reset gesture state\r\n        if (event.touches.length === 0) {\r\n            this.currentGesture = null;\r\n            this.isPinching = false;\r\n            this.isRotating = false;\r\n        }\r\n        \r\n        // Emit touch end event\r\n        this.emitTouchEvent('touchEnd', {\r\n            gesture: this.currentGesture,\r\n            duration: now - this.gestureStartTime\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Handle touch cancel\r\n     * @param {TouchEvent} event - Touch event\r\n     */\r\n    handleTouchCancel(event) {\r\n        // Clear all touches\r\n        this.touches.clear();\r\n        this.currentGesture = null;\r\n        this.isPinching = false;\r\n        this.isRotating = false;\r\n        \r\n        this.emitTouchEvent('touchCancel', {});\r\n    }\r\n    \r\n    /**\r\n     * Handle orientation change\r\n     * @param {Event} event - Orientation change event\r\n     */\r\n    handleOrientationChange(event) {\r\n        this.orientation = this.getOrientation();\r\n        \r\n        // Emit orientation change event\r\n        this.emitTouchEvent('orientationChange', {\r\n            orientation: this.orientation,\r\n            angle: window.orientation || 0\r\n        });\r\n        \r\n        // Apply orientation-specific optimizations\r\n        this.applyOrientationOptimizations();\r\n    }\r\n    \r\n    /**\r\n     * Handle device orientation\r\n     * @param {DeviceOrientationEvent} event - Device orientation event\r\n     */\r\n    handleDeviceOrientation(event) {\r\n        // Could be used for gyroscope-based interactions\r\n        const { alpha, beta, gamma } = event;\r\n        \r\n        this.emitTouchEvent('deviceOrientation', {\r\n            alpha, // Z axis rotation\r\n            beta,  // X axis rotation\r\n            gamma  // Y axis rotation\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Handle viewport change\r\n     * @param {Event} event - Resize event\r\n     */\r\n    handleViewportChange(event) {\r\n        const now = Date.now();\r\n        \r\n        // Debounce viewport changes\r\n        if (now - this.lastViewportChange < 100) return;\r\n        \r\n        this.lastViewportChange = now;\r\n        this.viewportSize = {\r\n            width: window.innerWidth,\r\n            height: window.innerHeight\r\n        };\r\n        \r\n        // Update pixel ratio\r\n        this.pixelRatio = window.devicePixelRatio || 1;\r\n        \r\n        // Emit viewport change event\r\n        this.emitTouchEvent('viewportChange', {\r\n            size: this.viewportSize,\r\n            pixelRatio: this.pixelRatio,\r\n            orientation: this.getOrientation()\r\n        });\r\n        \r\n        // Apply responsive scaling\r\n        if (this.config.enableResponsiveScaling) {\r\n            this.applyResponsiveScaling();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle visibility change\r\n     * @param {Event} event - Visibility change event\r\n     */\r\n    handleVisibilityChange(event) {\r\n        const isVisible = !document.hidden;\r\n        \r\n        this.emitTouchEvent('visibilityChange', {\r\n            visible: isVisible\r\n        });\r\n        \r\n        // Apply optimizations based on visibility\r\n        if (!isVisible && this.config.enableBatteryOptimization) {\r\n            // Reduce performance when app is in background\r\n            this.applyBackgroundOptimizations();\r\n        } else {\r\n            // Restore performance when app is visible\r\n            this.restorePerformance();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get current orientation\r\n     * @returns {string} Orientation (portrait or landscape)\r\n     */\r\n    getOrientation() {\r\n        return window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';\r\n    }\r\n    \r\n    /**\r\n     * Get distance between two points\r\n     * @param {number} x1 - First X coordinate\r\n     * @param {number} y1 - First Y coordinate\r\n     * @param {number} x2 - Second X coordinate\r\n     * @param {number} y2 - Second Y coordinate\r\n     * @returns {number} Distance\r\n     */\r\n    getDistance(x1, y1, x2, y2) {\r\n        const dx = x2 - x1;\r\n        const dy = y2 - y1;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n    \r\n    /**\r\n     * Get angle between two points\r\n     * @param {number} x1 - First X coordinate\r\n     * @param {number} y1 - First Y coordinate\r\n     * @param {number} x2 - Second X coordinate\r\n     * @param {number} y2 - Second Y coordinate\r\n     * @returns {number} Angle in degrees\r\n     */\r\n    getAngle(x1, y1, x2, y2) {\r\n        return Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;\r\n    }\r\n    \r\n    /**\r\n     * Apply mobile optimizations\r\n     */\r\n    applyMobileOptimizations() {\r\n        if (!this.isMobile && !this.isTablet) return;\r\n        \r\n        const optimizations = {\r\n            ...this.mobilePerformanceSettings,\r\n            canvasScale: this.calculateOptimalCanvasScale(),\r\n            useWebGL: false, // Disable WebGL on mobile for battery\r\n            useOffscreenCanvas: this.useOffscreenCanvas\r\n        };\r\n        \r\n        // Emit optimization settings\r\n        this.emitTouchEvent('mobileOptimizations', optimizations);\r\n        \r\n        return optimizations;\r\n    }\r\n    \r\n    /**\r\n     * Apply orientation-specific optimizations\r\n     */\r\n    applyOrientationOptimizations() {\r\n        const isLandscape = this.orientation === 'landscape';\r\n        \r\n        const optimizations = {\r\n            layoutMode: isLandscape ? 'horizontal' : 'vertical',\r\n            particleDirection: isLandscape ? 'horizontal' : 'vertical',\r\n            uiScale: isLandscape ? 0.8 : 1.0\r\n        };\r\n        \r\n        this.emitTouchEvent('orientationOptimizations', optimizations);\r\n        \r\n        return optimizations;\r\n    }\r\n    \r\n    /**\r\n     * Apply responsive scaling\r\n     */\r\n    applyResponsiveScaling() {\r\n        const baseWidth = 375; // iPhone 6/7/8 width as base\r\n        const scaleFactor = Math.min(\r\n            this.viewportSize.width / baseWidth,\r\n            2.0 // Max scale factor\r\n        );\r\n        \r\n        this.canvasScale = scaleFactor;\r\n        \r\n        this.emitTouchEvent('responsiveScale', {\r\n            scale: this.canvasScale,\r\n            viewport: this.viewportSize\r\n        });\r\n        \r\n        return this.canvasScale;\r\n    }\r\n    \r\n    /**\r\n     * Apply background optimizations for battery saving\r\n     */\r\n    applyBackgroundOptimizations() {\r\n        const optimizations = {\r\n            targetFPS: 5, // Very low FPS in background\r\n            particlesEnabled: false,\r\n            animationsEnabled: false,\r\n            audioEnabled: false\r\n        };\r\n        \r\n        this.emitTouchEvent('backgroundOptimizations', optimizations);\r\n        \r\n        return optimizations;\r\n    }\r\n    \r\n    /**\r\n     * Restore performance settings\r\n     */\r\n    restorePerformance() {\r\n        const settings = this.applyMobileOptimizations();\r\n        \r\n        this.emitTouchEvent('performanceRestore', settings);\r\n        \r\n        return settings;\r\n    }\r\n    \r\n    /**\r\n     * Handle battery change\r\n     */\r\n    onBatteryChange() {\r\n        this.lowPowerMode = this.batteryLevel < 0.2 && !this.isCharging;\r\n        \r\n        if (this.lowPowerMode) {\r\n            // Apply low power optimizations\r\n            const optimizations = {\r\n                targetFPS: 15,\r\n                maxParticles: 5,\r\n                reducedEffects: true,\r\n                audioEnabled: false\r\n            };\r\n            \r\n            this.emitTouchEvent('lowPowerMode', {\r\n                batteryLevel: this.batteryLevel,\r\n                isCharging: this.isCharging,\r\n                optimizations\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Calculate optimal canvas scale for device\r\n     * @returns {number} Scale factor\r\n     */\r\n    calculateOptimalCanvasScale() {\r\n        // Balance between quality and performance\r\n        if (this.isMobile) {\r\n            return Math.min(this.pixelRatio, 2); // Cap at 2x for mobile\r\n        } else if (this.isTablet) {\r\n            return Math.min(this.pixelRatio, 2.5); // Slightly higher for tablets\r\n        }\r\n        \r\n        return this.pixelRatio; // Full resolution for desktop\r\n    }\r\n    \r\n    /**\r\n     * Get canvas element\r\n     * @returns {HTMLCanvasElement} Canvas element\r\n     */\r\n    getCanvas() {\r\n        // This would be set by the main application\r\n        return this.canvas || document.querySelector('canvas');\r\n    }\r\n    \r\n    /**\r\n     * Set canvas element\r\n     * @param {HTMLCanvasElement} canvas - Canvas element\r\n     */\r\n    setCanvas(canvas) {\r\n        this.canvas = canvas;\r\n        \r\n        if (this.config.enableTouchOptimization && this.isTouchDevice) {\r\n            this.setupTouchHandlers();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Emit touch event\r\n     * @param {string} eventType - Event type\r\n     * @param {Object} data - Event data\r\n     */\r\n    emitTouchEvent(eventType, data) {\r\n        if (this.onTouchEvent) {\r\n            this.onTouchEvent(eventType, data);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get mobile optimization status\r\n     * @returns {Object} Status report\r\n     */\r\n    getStatus() {\r\n        return {\r\n            device: {\r\n                isMobile: this.isMobile,\r\n                isTablet: this.isTablet,\r\n                isTouchDevice: this.isTouchDevice,\r\n                isIOS: this.isIOS,\r\n                isAndroid: this.isAndroid\r\n            },\r\n            viewport: {\r\n                size: this.viewportSize,\r\n                orientation: this.orientation,\r\n                pixelRatio: this.pixelRatio,\r\n                canvasScale: this.canvasScale\r\n            },\r\n            battery: {\r\n                level: this.batteryLevel,\r\n                isCharging: this.isCharging,\r\n                lowPowerMode: this.lowPowerMode\r\n            },\r\n            touch: {\r\n                activeTouches: this.touches.size,\r\n                currentGesture: this.currentGesture,\r\n                isPinching: this.isPinching,\r\n                isRotating: this.isRotating\r\n            },\r\n            performance: this.mobilePerformanceSettings\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Destroy mobile optimization\r\n     */\r\n    destroy() {\r\n        const canvas = this.getCanvas();\r\n        \r\n        if (canvas) {\r\n            canvas.removeEventListener('touchstart', this.handleTouchStart);\r\n            canvas.removeEventListener('touchmove', this.handleTouchMove);\r\n            canvas.removeEventListener('touchend', this.handleTouchEnd);\r\n            canvas.removeEventListener('touchcancel', this.handleTouchCancel);\r\n        }\r\n        \r\n        window.removeEventListener('resize', this.handleViewportChange);\r\n        window.removeEventListener('orientationchange', this.handleOrientationChange);\r\n        document.removeEventListener('visibilitychange', this.handleVisibilityChange);\r\n        \r\n        this.touches.clear();\r\n        this.gestureHistory = [];\r\n        \r\n    }\r\n}\r\n\r\nexport default MobileOptimization;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                      ◐ ◑ ◒ ◓  PLUGIN SYSTEM  ◓ ◒ ◑ ◐                      \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Plugin System - Extensible Architecture for Custom Behaviors\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module PluginSystem\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The EXPANSION SLOT for creativity. Allows developers to extend the mascot         \r\n * ║ with custom emotions, gestures, particles, and behaviors without modifying        \r\n * ║ core code. Build your own emotional expressions!                                  \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🔌 PLUGIN TYPES                                                                    \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • emotion  : Add custom emotional states                                          \r\n * │ • gesture  : Define new gesture animations                                        \r\n * │ • particle : Create custom particle behaviors                                     \r\n * │ • audio    : Add sound effects and tones                                          \r\n * │ • renderer : Modify rendering pipeline                                            \r\n * │ • behavior : Add complex behavioral patterns                                      \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎯 LIFECYCLE HOOKS                                                                 \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • init()     : Called when plugin is registered                                   \r\n * │ • update()   : Called every frame                                                 \r\n * │ • render()   : Called during render phase                                         \r\n * │ • destroy()  : Called when plugin is unregistered                                 \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport class PluginSystem {\r\n    constructor(config = {}) {\r\n        this.config = {\r\n            enablePlugins: config.enablePlugins !== false,\r\n            validatePlugins: config.validatePlugins !== false,\r\n            sandboxPlugins: config.sandboxPlugins !== false,\r\n            maxPlugins: config.maxPlugins || 50,\r\n            pluginTimeout: config.pluginTimeout || 5000,\r\n            allowOverrides: config.allowOverrides !== false,\r\n            ...config\r\n        };\r\n        \r\n        // Plugin registry\r\n        this.plugins = new Map();\r\n        this.pluginTypes = ['emotion', 'gesture', 'particle', 'audio', 'renderer', 'animation'];\r\n        this.pluginsByType = new Map(this.pluginTypes.map(type => [type, new Set()]));\r\n        \r\n        // Plugin dependencies\r\n        this.dependencies = new Map();\r\n        this.dependencyGraph = new Map();\r\n        \r\n        // Plugin lifecycle states\r\n        this.pluginStates = new Map();\r\n        this.loadingPlugins = new Set();\r\n        this.activePlugins = new Set();\r\n        \r\n        // Plugin hooks\r\n        this.hooks = new Map([\r\n            ['beforeInit', new Set()],\r\n            ['afterInit', new Set()],\r\n            ['beforeUpdate', new Set()],\r\n            ['afterUpdate', new Set()],\r\n            ['beforeRender', new Set()],\r\n            ['afterRender', new Set()],\r\n            ['beforeDestroy', new Set()],\r\n            ['afterDestroy', new Set()]\r\n        ]);\r\n        \r\n        // Plugin API exposed to plugins\r\n        this.pluginAPI = this.createPluginAPI();\r\n        \r\n        // Conflict resolution\r\n        this.conflicts = new Map();\r\n        this.resolutionStrategies = {\r\n            'override': this.overrideConflict.bind(this),\r\n            'merge': this.mergeConflict.bind(this),\r\n            'reject': this.rejectConflict.bind(this),\r\n            'queue': this.queueConflict.bind(this)\r\n        };\r\n        \r\n        // Plugin validation schemas\r\n        this.validationSchemas = this.createValidationSchemas();\r\n        \r\n        // Sandbox environment for plugins\r\n        this.sandbox = null;\r\n        if (this.config.sandboxPlugins) {\r\n            this.sandbox = this.createSandbox();\r\n        }\r\n        \r\n        // PluginSystem initialized\r\n    }\r\n    \r\n    /**\r\n     * Create plugin API exposed to plugins\r\n     * @returns {Object} Plugin API\r\n     */\r\n    createPluginAPI() {\r\n        return {\r\n            // Core functionality\r\n            registerHook: this.registerHook.bind(this),\r\n            emit: this.emitPluginEvent.bind(this),\r\n            on: this.onPluginEvent.bind(this),\r\n            \r\n            // Access to other plugins\r\n            getPlugin: this.getPlugin.bind(this),\r\n            hasPlugin: this.hasPlugin.bind(this),\r\n            \r\n            // Utilities\r\n            log: this.logFromPlugin.bind(this),\r\n            error: this.errorFromPlugin.bind(this),\r\n            \r\n            // State management\r\n            setState: this.setPluginState.bind(this),\r\n            getState: this.getPluginState.bind(this),\r\n            \r\n            // Configuration\r\n            getConfig: () => ({ ...this.config }),\r\n            \r\n            // Version info\r\n            version: '1.0.0'\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Create validation schemas for different plugin types\r\n     * @returns {Map} Validation schemas\r\n     */\r\n    createValidationSchemas() {\r\n        const schemas = new Map();\r\n        \r\n        // Base schema for all plugins\r\n        const baseSchema = {\r\n            name: { type: 'string', required: true },\r\n            version: { type: 'string', required: true },\r\n            type: { type: 'string', required: true, enum: this.pluginTypes },\r\n            description: { type: 'string', required: false },\r\n            author: { type: 'string', required: false },\r\n            dependencies: { type: 'array', required: false },\r\n            conflicts: { type: 'array', required: false },\r\n            init: { type: 'function', required: true },\r\n            destroy: { type: 'function', required: true }\r\n        };\r\n        \r\n        // Emotion plugin schema\r\n        schemas.set('emotion', {\r\n            ...baseSchema,\r\n            emotion: {\r\n                type: 'object',\r\n                required: true,\r\n                properties: {\r\n                    name: { type: 'string', required: true },\r\n                    color: { type: 'string', required: true },\r\n                    particleColor: { type: 'string', required: false },\r\n                    animation: { type: 'object', required: true },\r\n                    transitions: { type: 'object', required: false }\r\n                }\r\n            },\r\n            updateEmotion: { type: 'function', required: true },\r\n            renderEmotion: { type: 'function', required: false }\r\n        });\r\n        \r\n        // Gesture plugin schema\r\n        schemas.set('gesture', {\r\n            ...baseSchema,\r\n            gesture: {\r\n                type: 'object',\r\n                required: true,\r\n                properties: {\r\n                    name: { type: 'string', required: true },\r\n                    duration: { type: 'number', required: true },\r\n                    keyframes: { type: 'array', required: true },\r\n                    compatibility: { type: 'object', required: false }\r\n                }\r\n            },\r\n            executeGesture: { type: 'function', required: true },\r\n            canExecute: { type: 'function', required: false }\r\n        });\r\n        \r\n        // Particle plugin schema\r\n        schemas.set('particle', {\r\n            ...baseSchema,\r\n            particle: {\r\n                type: 'object',\r\n                required: true,\r\n                properties: {\r\n                    name: { type: 'string', required: true },\r\n                    maxParticles: { type: 'number', required: false },\r\n                    behavior: { type: 'function', required: true },\r\n                    render: { type: 'function', required: true }\r\n                }\r\n            },\r\n            updateParticles: { type: 'function', required: true },\r\n            spawnParticle: { type: 'function', required: false }\r\n        });\r\n        \r\n        // Audio plugin schema\r\n        schemas.set('audio', {\r\n            ...baseSchema,\r\n            audio: {\r\n                type: 'object',\r\n                required: true,\r\n                properties: {\r\n                    name: { type: 'string', required: true },\r\n                    sounds: { type: 'object', required: true },\r\n                    effects: { type: 'array', required: false }\r\n                }\r\n            },\r\n            playSound: { type: 'function', required: true },\r\n            processAudio: { type: 'function', required: false }\r\n        });\r\n        \r\n        return schemas;\r\n    }\r\n    \r\n    /**\r\n     * Create sandbox environment for plugin execution\r\n     * @returns {Object} Sandbox environment\r\n     */\r\n    createSandbox() {\r\n        // Create a limited execution environment\r\n        const sandbox = {\r\n            // Safe global objects\r\n            Math: Math,\r\n            Date: Date,\r\n            JSON: JSON,\r\n            \r\n            // Limited console\r\n            console: {\r\n                log: (...args) => null,\r\n                warn: (...args) => null,\r\n                error: (...args) => null\r\n            },\r\n            \r\n            // No access to window, document, or other globals\r\n            window: undefined,\r\n            document: undefined,\r\n            localStorage: undefined,\r\n            sessionStorage: undefined,\r\n            fetch: undefined,\r\n            XMLHttpRequest: undefined,\r\n            \r\n            // Plugin API\r\n            api: this.pluginAPI\r\n        };\r\n        \r\n        return sandbox;\r\n    }\r\n    \r\n    /**\r\n     * Register a plugin\r\n     * @param {Object} plugin - Plugin to register\r\n     * @returns {boolean} Success status\r\n     */\r\n    async registerPlugin(plugin) {\r\n        if (!this.config.enablePlugins) {\r\n            // Plugins are disabled\r\n            return false;\r\n        }\r\n        \r\n        // Check plugin limit\r\n        if (this.plugins.size >= this.config.maxPlugins) {\r\n            // Maximum plugin limit reached\r\n            return false;\r\n        }\r\n        \r\n        // Validate plugin\r\n        if (this.config.validatePlugins) {\r\n            const validation = this.validatePlugin(plugin);\r\n            if (!validation.valid) {\r\n                // Plugin validation failed\r\n                return false;\r\n            }\r\n        }\r\n        \r\n        // Check for conflicts\r\n        const conflicts = this.checkConflicts(plugin);\r\n        if (conflicts.length > 0 && !this.config.allowOverrides) {\r\n            // Plugin conflicts detected\r\n            return false;\r\n        }\r\n        \r\n        // Resolve dependencies\r\n        const dependencies = await this.resolveDependencies(plugin);\r\n        if (!dependencies.resolved) {\r\n            // Plugin dependencies not met\r\n            return false;\r\n        }\r\n        \r\n        // Initialize plugin in sandbox if enabled\r\n        try {\r\n            this.loadingPlugins.add(plugin.name);\r\n            \r\n            const context = this.config.sandboxPlugins ? this.sandbox : window;\r\n            const initialized = await this.initializePlugin(plugin, context);\r\n            \r\n            if (!initialized) {\r\n                throw new Error('Plugin initialization failed');\r\n            }\r\n            \r\n            // Register plugin\r\n            this.plugins.set(plugin.name, plugin);\r\n            this.pluginsByType.get(plugin.type).add(plugin.name);\r\n            this.pluginStates.set(plugin.name, 'active');\r\n            this.activePlugins.add(plugin.name);\r\n            \r\n            // Store dependencies\r\n            if (plugin.dependencies) {\r\n                this.dependencies.set(plugin.name, plugin.dependencies);\r\n                this.updateDependencyGraph(plugin.name, plugin.dependencies);\r\n            }\r\n            \r\n            // Register hooks if provided\r\n            if (plugin.hooks) {\r\n                Object.entries(plugin.hooks).forEach(([hook, handler]) => {\r\n                    this.registerHook(hook, handler, plugin.name);\r\n                });\r\n            }\r\n            \r\n            // Plugin registered\r\n            \r\n            // Emit registration event\r\n            this.emitPluginEvent('pluginRegistered', {\r\n                name: plugin.name,\r\n                type: plugin.type,\r\n                version: plugin.version\r\n            });\r\n            \r\n            return true;\r\n            \r\n        } catch (error) {\r\n            // Failed to register plugin\r\n            return false;\r\n        } finally {\r\n            this.loadingPlugins.delete(plugin.name);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Validate a plugin against its schema\r\n     * @param {Object} plugin - Plugin to validate\r\n     * @returns {Object} Validation result\r\n     */\r\n    validatePlugin(plugin) {\r\n        const errors = [];\r\n        \r\n        // Check required base properties\r\n        if (!plugin.name || typeof plugin.name !== 'string') {\r\n            errors.push('Plugin must have a valid name');\r\n        }\r\n        \r\n        if (!plugin.type || !this.pluginTypes.includes(plugin.type)) {\r\n            errors.push(`Plugin type must be one of: ${this.pluginTypes.join(', ')}`);\r\n        }\r\n        \r\n        if (!plugin.version || typeof plugin.version !== 'string') {\r\n            errors.push('Plugin must have a version');\r\n        }\r\n        \r\n        if (typeof plugin.init !== 'function') {\r\n            errors.push('Plugin must have an init function');\r\n        }\r\n        \r\n        if (typeof plugin.destroy !== 'function') {\r\n            errors.push('Plugin must have a destroy function');\r\n        }\r\n        \r\n        // Validate type-specific schema\r\n        if (plugin.type && this.validationSchemas.has(plugin.type)) {\r\n            const schema = this.validationSchemas.get(plugin.type);\r\n            const typeErrors = this.validateAgainstSchema(plugin, schema);\r\n            errors.push(...typeErrors);\r\n        }\r\n        \r\n        return {\r\n            valid: errors.length === 0,\r\n            errors\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Validate object against schema\r\n     * @param {Object} obj - Object to validate\r\n     * @param {Object} schema - Schema to validate against\r\n     * @returns {Array} Array of errors\r\n     */\r\n    validateAgainstSchema(obj, schema) {\r\n        const errors = [];\r\n        \r\n        Object.entries(schema).forEach(([key, rules]) => {\r\n            if (rules.required && !(key in obj)) {\r\n                errors.push(`Missing required property: ${key}`);\r\n            }\r\n            \r\n            if (key in obj) {\r\n                const value = obj[key];\r\n                \r\n                if (rules.type && typeof value !== rules.type) {\r\n                    errors.push(`Property ${key} must be of type ${rules.type}`);\r\n                }\r\n                \r\n                if (rules.enum && !rules.enum.includes(value)) {\r\n                    errors.push(`Property ${key} must be one of: ${rules.enum.join(', ')}`);\r\n                }\r\n                \r\n                if (rules.properties && typeof value === 'object') {\r\n                    const subErrors = this.validateAgainstSchema(value, rules.properties);\r\n                    errors.push(...subErrors.map(e => `${key}.${e}`));\r\n                }\r\n            }\r\n        });\r\n        \r\n        return errors;\r\n    }\r\n    \r\n    /**\r\n     * Check for plugin conflicts\r\n     * @param {Object} plugin - Plugin to check\r\n     * @returns {Array} Array of conflicts\r\n     */\r\n    checkConflicts(plugin) {\r\n        const conflicts = [];\r\n        \r\n        // Check explicit conflicts\r\n        if (plugin.conflicts) {\r\n            plugin.conflicts.forEach(conflictName => {\r\n                if (this.plugins.has(conflictName)) {\r\n                    conflicts.push(conflictName);\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Check type-specific conflicts\r\n        if (plugin.type === 'emotion' || plugin.type === 'gesture') {\r\n            // Check for name collisions\r\n            this.plugins.forEach((existingPlugin) => {\r\n                if (existingPlugin.type === plugin.type) {\r\n                    const existingName = existingPlugin[plugin.type]?.name;\r\n                    const newName = plugin[plugin.type]?.name;\r\n                    \r\n                    if (existingName === newName) {\r\n                        conflicts.push(`${plugin.type} name collision: ${newName}`);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        \r\n        return conflicts;\r\n    }\r\n    \r\n    /**\r\n     * Resolve plugin dependencies\r\n     * @param {Object} plugin - Plugin to resolve dependencies for\r\n     * @returns {Object} Resolution result\r\n     */\r\n    async resolveDependencies(plugin) {\r\n        if (!plugin.dependencies || plugin.dependencies.length === 0) {\r\n            return { resolved: true, missing: [] };\r\n        }\r\n        \r\n        const missing = [];\r\n        \r\n        for (const dep of plugin.dependencies) {\r\n            // Check if dependency is already loaded\r\n            if (!this.plugins.has(dep)) {\r\n                // Try to load dependency\r\n                const loaded = await this.tryLoadDependency(dep);\r\n                if (!loaded) {\r\n                    missing.push(dep);\r\n                }\r\n            }\r\n        }\r\n        \r\n        return {\r\n            resolved: missing.length === 0,\r\n            missing\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Try to load a dependency\r\n     * @param {string} dependencyName - Dependency name\r\n     * @returns {boolean} Success status\r\n     */\r\n    async tryLoadDependency(dependencyName) {\r\n        // This would attempt to load the dependency\r\n        // For now, just check if it exists\r\n        return this.plugins.has(dependencyName);\r\n    }\r\n    \r\n    /**\r\n     * Update dependency graph\r\n     * @param {string} pluginName - Plugin name\r\n     * @param {Array} dependencies - Dependencies\r\n     */\r\n    updateDependencyGraph(pluginName, dependencies) {\r\n        this.dependencyGraph.set(pluginName, new Set(dependencies));\r\n        \r\n        // Update reverse dependencies\r\n        dependencies.forEach(dep => {\r\n            if (!this.dependencyGraph.has(dep)) {\r\n                this.dependencyGraph.set(dep, new Set());\r\n            }\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Initialize a plugin\r\n     * @param {Object} plugin - Plugin to initialize\r\n     * @param {Object} context - Execution context\r\n     * @returns {boolean} Success status\r\n     */\r\n    async initializePlugin(plugin, context) {\r\n        try {\r\n            // Set timeout for initialization\r\n            const timeout = new Promise((_, reject) => {\r\n                setTimeout(() => reject(new Error('Plugin initialization timeout')), this.config.pluginTimeout);\r\n            });\r\n            \r\n            // Initialize plugin\r\n            const init = plugin.init.bind(context);\r\n            const result = await Promise.race([\r\n                init(this.pluginAPI),\r\n                timeout\r\n            ]);\r\n            \r\n            return result !== false;\r\n        } catch (error) {\r\n            // Plugin initialization error\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Unregister a plugin\r\n     * @param {string} pluginName - Name of plugin to unregister\r\n     * @returns {boolean} Success status\r\n     */\r\n    async unregisterPlugin(pluginName) {\r\n        const plugin = this.plugins.get(pluginName);\r\n        if (!plugin) {\r\n            // Plugin not found\r\n            return false;\r\n        }\r\n        \r\n        // Check for dependent plugins\r\n        const dependents = this.getDependentPlugins(pluginName);\r\n        if (dependents.length > 0) {\r\n            // Cannot unregister plugin - required by dependents\r\n            return false;\r\n        }\r\n        \r\n        try {\r\n            // Call destroy method\r\n            if (typeof plugin.destroy === 'function') {\r\n                await plugin.destroy();\r\n            }\r\n            \r\n            // Remove from registries\r\n            this.plugins.delete(pluginName);\r\n            this.pluginsByType.get(plugin.type).delete(pluginName);\r\n            this.pluginStates.delete(pluginName);\r\n            this.activePlugins.delete(pluginName);\r\n            this.dependencies.delete(pluginName);\r\n            this.dependencyGraph.delete(pluginName);\r\n            \r\n            // Remove hooks\r\n            this.hooks.forEach(hookSet => {\r\n                hookSet.forEach(hook => {\r\n                    if (hook.pluginName === pluginName) {\r\n                        hookSet.delete(hook);\r\n                    }\r\n                });\r\n            });\r\n            \r\n            // Plugin unregistered\r\n            \r\n            // Emit unregistration event\r\n            this.emitPluginEvent('pluginUnregistered', { name: pluginName });\r\n            \r\n            return true;\r\n        } catch (error) {\r\n            // Failed to unregister plugin\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get plugins dependent on a given plugin\r\n     * @param {string} pluginName - Plugin name\r\n     * @returns {Array} Array of dependent plugin names\r\n     */\r\n    getDependentPlugins(pluginName) {\r\n        const dependents = [];\r\n        \r\n        this.dependencies.forEach((deps, name) => {\r\n            if (deps.includes(pluginName)) {\r\n                dependents.push(name);\r\n            }\r\n        });\r\n        \r\n        return dependents;\r\n    }\r\n    \r\n    /**\r\n     * Register a hook handler\r\n     * @param {string} hookName - Hook name\r\n     * @param {Function} handler - Handler function\r\n     * @param {string} pluginName - Plugin name\r\n     */\r\n    registerHook(hookName, handler, pluginName) {\r\n        if (!this.hooks.has(hookName)) {\r\n            this.hooks.set(hookName, new Set());\r\n        }\r\n        \r\n        this.hooks.get(hookName).add({\r\n            handler,\r\n            pluginName\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Execute hooks for a given event\r\n     * @param {string} hookName - Hook name\r\n     * @param {*} data - Data to pass to hooks\r\n     * @returns {Array} Results from hooks\r\n     */\r\n    async executeHooks(hookName, data) {\r\n        const hooks = this.hooks.get(hookName);\r\n        if (!hooks || hooks.size === 0) return [];\r\n        \r\n        const results = [];\r\n        \r\n        for (const hook of hooks) {\r\n            try {\r\n                const result = await hook.handler(data);\r\n                results.push({ pluginName: hook.pluginName, result });\r\n            } catch (error) {\r\n                // Hook error in plugin\r\n            }\r\n        }\r\n        \r\n        return results;\r\n    }\r\n    \r\n    /**\r\n     * Get a plugin by name\r\n     * @param {string} pluginName - Plugin name\r\n     * @returns {Object} Plugin or null\r\n     */\r\n    getPlugin(pluginName) {\r\n        return this.plugins.get(pluginName) || null;\r\n    }\r\n    \r\n    /**\r\n     * Check if a plugin exists\r\n     * @param {string} pluginName - Plugin name\r\n     * @returns {boolean} True if plugin exists\r\n     */\r\n    hasPlugin(pluginName) {\r\n        return this.plugins.has(pluginName);\r\n    }\r\n    \r\n    /**\r\n     * Get plugins by type\r\n     * @param {string} type - Plugin type\r\n     * @returns {Array} Array of plugins\r\n     */\r\n    getPluginsByType(type) {\r\n        const pluginNames = this.pluginsByType.get(type);\r\n        if (!pluginNames) return [];\r\n        \r\n        return Array.from(pluginNames).map(name => this.plugins.get(name));\r\n    }\r\n    \r\n    /**\r\n     * Enable a plugin\r\n     * @param {string} pluginName - Plugin name\r\n     */\r\n    enablePlugin(pluginName) {\r\n        if (!this.plugins.has(pluginName)) return;\r\n        \r\n        this.pluginStates.set(pluginName, 'active');\r\n        this.activePlugins.add(pluginName);\r\n        \r\n        const plugin = this.plugins.get(pluginName);\r\n        if (plugin.onEnable) {\r\n            plugin.onEnable();\r\n        }\r\n        \r\n        this.emitPluginEvent('pluginEnabled', { name: pluginName });\r\n    }\r\n    \r\n    /**\r\n     * Disable a plugin\r\n     * @param {string} pluginName - Plugin name\r\n     */\r\n    disablePlugin(pluginName) {\r\n        if (!this.plugins.has(pluginName)) return;\r\n        \r\n        // Check dependents\r\n        const dependents = this.getDependentPlugins(pluginName);\r\n        if (dependents.length > 0) {\r\n            // Disabling plugin will affect dependents\r\n        }\r\n        \r\n        this.pluginStates.set(pluginName, 'disabled');\r\n        this.activePlugins.delete(pluginName);\r\n        \r\n        const plugin = this.plugins.get(pluginName);\r\n        if (plugin.onDisable) {\r\n            plugin.onDisable();\r\n        }\r\n        \r\n        this.emitPluginEvent('pluginDisabled', { name: pluginName });\r\n    }\r\n    \r\n    /**\r\n     * Emit plugin event\r\n     * @param {string} eventName - Event name\r\n     * @param {*} data - Event data\r\n     */\r\n    emitPluginEvent(eventName, data) {\r\n        // This would integrate with the main event system\r\n        if (this.onPluginEvent) {\r\n            this.onPluginEvent(eventName, data);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Listen for plugin events\r\n     * @param {string} eventName - Event name\r\n     * @param {Function} handler - Event handler\r\n     */\r\n    onPluginEvent(eventName, handler) {\r\n        // This would integrate with the main event system\r\n        // Placeholder for event listening\r\n    }\r\n    \r\n    /**\r\n     * Log from plugin context\r\n     * @param {string} pluginName - Plugin name\r\n     * @param {...*} args - Log arguments\r\n     */\r\n    logFromPlugin(pluginName, ...args) {\r\n        // Plugin log message\r\n    }\r\n    \r\n    /**\r\n     * Error from plugin context\r\n     * @param {string} pluginName - Plugin name\r\n     * @param {...*} args - Error arguments\r\n     */\r\n    errorFromPlugin(pluginName, ...args) {\r\n        // Plugin error message\r\n    }\r\n    \r\n    /**\r\n     * Set plugin state\r\n     * @param {string} pluginName - Plugin name\r\n     * @param {string} key - State key\r\n     * @param {*} value - State value\r\n     */\r\n    setPluginState(pluginName, key, value) {\r\n        if (!this.pluginStates.has(pluginName)) {\r\n            this.pluginStates.set(pluginName, {});\r\n        }\r\n        \r\n        const state = this.pluginStates.get(pluginName);\r\n        if (typeof state === 'object') {\r\n            state[key] = value;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get plugin state\r\n     * @param {string} pluginName - Plugin name\r\n     * @param {string} key - State key\r\n     * @returns {*} State value\r\n     */\r\n    getPluginState(pluginName, key) {\r\n        const state = this.pluginStates.get(pluginName);\r\n        if (typeof state === 'object') {\r\n            return state[key];\r\n        }\r\n        return undefined;\r\n    }\r\n    \r\n    /**\r\n     * Conflict resolution strategies\r\n     */\r\n    overrideConflict(existing, incoming) {\r\n        return incoming; // New plugin overrides existing\r\n    }\r\n    \r\n    mergeConflict(existing, incoming) {\r\n        return { ...existing, ...incoming }; // Merge properties\r\n    }\r\n    \r\n    rejectConflict(existing, incoming) {\r\n        return existing; // Keep existing, reject new\r\n    }\r\n    \r\n    queueConflict(existing, incoming) {\r\n        return [existing, incoming]; // Queue both\r\n    }\r\n    \r\n    /**\r\n     * Get plugin system status\r\n     * @returns {Object} Status report\r\n     */\r\n    getStatus() {\r\n        return {\r\n            enabled: this.config.enablePlugins,\r\n            totalPlugins: this.plugins.size,\r\n            activePlugins: this.activePlugins.size,\r\n            loadingPlugins: this.loadingPlugins.size,\r\n            pluginsByType: Object.fromEntries(\r\n                Array.from(this.pluginsByType.entries()).map(([type, plugins]) => [type, plugins.size])\r\n            ),\r\n            hooks: Object.fromEntries(\r\n                Array.from(this.hooks.entries()).map(([hook, handlers]) => [hook, handlers.size])\r\n            )\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Destroy plugin system\r\n     */\r\n    async destroy() {\r\n        // Unregister all plugins\r\n        const pluginNames = Array.from(this.plugins.keys());\r\n        \r\n        for (const name of pluginNames) {\r\n            await this.unregisterPlugin(name);\r\n        }\r\n        \r\n        // Clear all data\r\n        this.plugins.clear();\r\n        this.pluginsByType.clear();\r\n        this.dependencies.clear();\r\n        this.dependencyGraph.clear();\r\n        this.pluginStates.clear();\r\n        this.activePlugins.clear();\r\n        this.loadingPlugins.clear();\r\n        this.hooks.clear();\r\n        this.conflicts.clear();\r\n        \r\n        // PluginSystem destroyed\r\n    }\r\n}\r\n\r\nexport default PluginSystem;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                 ◐ ◑ ◒ ◓  BROWSER COMPATIBILITY  ◓ ◒ ◑ ◐                 \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Browser Compatibility - Feature Detection & Graceful Degradation\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module BrowserCompatibility\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The COMPATIBILITY LAYER of the engine. Ensures the Emotive Engine runs           \r\n * ║ smoothly across all modern browsers by detecting features, providing              \r\n * ║ polyfills, and enabling graceful degradation when features are missing.           \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🌐 BROWSER FEATURES                                                               \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Web Audio API detection and fallbacks                                           \r\n * │ • Canvas 2D context recovery and management                                       \r\n * │ • RequestAnimationFrame polyfills                                                 \r\n * │ • Device pixel ratio handling                                                     \r\n * │ • Performance API detection                                                       \r\n * │ • Media device capabilities                                                       \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\n/**\r\n * Feature detection utilities\r\n */\r\nexport class FeatureDetection {\r\n    constructor() {\r\n        // Cache detection results to avoid repeated expensive checks\r\n        if (FeatureDetection._cachedFeatures) {\r\n            this.features = FeatureDetection._cachedFeatures;\r\n            this.capabilities = FeatureDetection._cachedCapabilities;\r\n            return;\r\n        }\r\n        \r\n        this.features = {\r\n            webAudio: this.detectWebAudio(),\r\n            canvas2d: this.detectCanvas2D(),\r\n            requestAnimationFrame: this.detectRequestAnimationFrame(),\r\n            devicePixelRatio: this.detectDevicePixelRatio(),\r\n            audioContext: this.detectAudioContext(),\r\n            mediaDevices: this.detectMediaDevices(),\r\n            performance: this.detectPerformance(),\r\n            intersectionObserver: this.detectIntersectionObserver()\r\n        };\r\n        \r\n        this.capabilities = this.assessCapabilities();\r\n        \r\n        // Cache results for future instantiations\r\n        FeatureDetection._cachedFeatures = this.features;\r\n        FeatureDetection._cachedCapabilities = this.capabilities;\r\n    }\r\n\r\n    /**\r\n     * Detect Web Audio API support\r\n     * @returns {boolean} True if Web Audio API is supported\r\n     */\r\n    detectWebAudio() {\r\n        try {\r\n            return !!(window.AudioContext || window.webkitAudioContext);\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Detect Canvas 2D support\r\n     * @returns {boolean} True if Canvas 2D is supported\r\n     */\r\n    detectCanvas2D() {\r\n        try {\r\n            const canvas = document.createElement('canvas');\r\n            return !!(canvas.getContext && canvas.getContext('2d'));\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Detect requestAnimationFrame support\r\n     * @returns {boolean} True if requestAnimationFrame is supported\r\n     */\r\n    detectRequestAnimationFrame() {\r\n        return !!(window.requestAnimationFrame || \r\n                 window.webkitRequestAnimationFrame || \r\n                 window.mozRequestAnimationFrame || \r\n                 window.oRequestAnimationFrame || \r\n                 window.msRequestAnimationFrame);\r\n    }\r\n\r\n    /**\r\n     * Detect device pixel ratio support\r\n     * @returns {boolean} True if devicePixelRatio is supported\r\n     */\r\n    detectDevicePixelRatio() {\r\n        return typeof window.devicePixelRatio === 'number';\r\n    }\r\n\r\n    /**\r\n     * Detect AudioContext support (more specific than Web Audio)\r\n     * @returns {boolean} True if AudioContext is supported\r\n     */\r\n    detectAudioContext() {\r\n        try {\r\n            const AudioContextClass = window.AudioContext || window.webkitAudioContext;\r\n            if (!AudioContextClass) return false;\r\n            \r\n            // Don't create a test context - just check if the class exists\r\n            // Creating contexts is expensive and has limits\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Detect MediaDevices API support\r\n     * @returns {boolean} True if MediaDevices API is supported\r\n     */\r\n    detectMediaDevices() {\r\n        return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);\r\n    }\r\n\r\n    /**\r\n     * Detect Performance API support\r\n     * @returns {boolean} True if Performance API is supported\r\n     */\r\n    detectPerformance() {\r\n        return !!(window.performance && window.performance.now);\r\n    }\r\n\r\n    /**\r\n     * Detect Intersection Observer support\r\n     * @returns {boolean} True if Intersection Observer is supported\r\n     */\r\n    detectIntersectionObserver() {\r\n        return typeof window.IntersectionObserver === 'function';\r\n    }\r\n\r\n    /**\r\n     * Assess overall browser capabilities\r\n     * @returns {Object} Capability assessment\r\n     */\r\n    assessCapabilities() {\r\n        const score = Object.values(this.features).filter(Boolean).length;\r\n        const total = Object.keys(this.features).length;\r\n        const percentage = (score / total) * 100;\r\n\r\n        let level = 'basic';\r\n        if (percentage >= 90) level = 'full';\r\n        else if (percentage >= 70) level = 'good';\r\n        else if (percentage >= 50) level = 'limited';\r\n\r\n        return {\r\n            score,\r\n            total,\r\n            percentage,\r\n            level,\r\n            recommendations: this.getRecommendations(level)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get recommendations based on capability level\r\n     * @param {string} level - Capability level\r\n     * @returns {Array<string>} Array of recommendations\r\n     */\r\n    getRecommendations(level) {\r\n        const recommendations = [];\r\n\r\n        if (!this.features.webAudio) {\r\n            recommendations.push('Audio features will be disabled');\r\n        }\r\n        if (!this.features.requestAnimationFrame) {\r\n            recommendations.push('Animation will use setTimeout fallback');\r\n        }\r\n        if (!this.features.performance) {\r\n            recommendations.push('Performance monitoring will be limited');\r\n        }\r\n        if (level === 'basic') {\r\n            recommendations.push('Consider using minimal build for better performance');\r\n        }\r\n\r\n        return recommendations;\r\n    }\r\n\r\n    /**\r\n     * Get all detected features\r\n     * @returns {Object} Feature detection results\r\n     */\r\n    getFeatures() {\r\n        return { ...this.features };\r\n    }\r\n\r\n    /**\r\n     * Get capability assessment\r\n     * @returns {Object} Capability assessment\r\n     */\r\n    getCapabilities() {\r\n        return { ...this.capabilities };\r\n    }\r\n}\r\n\r\n/**\r\n * Polyfill manager for missing browser features\r\n */\r\nexport class PolyfillManager {\r\n    constructor() {\r\n        this.polyfills = new Map();\r\n        this.applied = new Set();\r\n    }\r\n\r\n    /**\r\n     * Register a polyfill\r\n     * @param {string} feature - Feature name\r\n     * @param {Function} polyfillFn - Polyfill function\r\n     */\r\n    register(feature, polyfillFn) {\r\n        this.polyfills.set(feature, polyfillFn);\r\n    }\r\n\r\n    /**\r\n     * Apply a specific polyfill\r\n     * @param {string} feature - Feature name\r\n     * @returns {boolean} True if polyfill was applied\r\n     */\r\n    apply(feature) {\r\n        if (this.applied.has(feature)) {\r\n            return true; // Already applied\r\n        }\r\n\r\n        const polyfillFn = this.polyfills.get(feature);\r\n        if (!polyfillFn) {\r\n            // No polyfill registered for feature\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            polyfillFn();\r\n            this.applied.add(feature);\r\n            // Applied polyfill for feature\r\n            return true;\r\n        } catch (error) {\r\n            // Failed to apply polyfill for feature\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply all registered polyfills\r\n     * @returns {Array<string>} Array of successfully applied polyfills\r\n     */\r\n    applyAll() {\r\n        const applied = [];\r\n        for (const feature of this.polyfills.keys()) {\r\n            if (this.apply(feature)) {\r\n                applied.push(feature);\r\n            }\r\n        }\r\n        return applied;\r\n    }\r\n\r\n    /**\r\n     * Check if a polyfill has been applied\r\n     * @param {string} feature - Feature name\r\n     * @returns {boolean} True if polyfill has been applied\r\n     */\r\n    isApplied(feature) {\r\n        return this.applied.has(feature);\r\n    }\r\n}\r\n\r\n/**\r\n * RequestAnimationFrame polyfill\r\n */\r\nexport function polyfillRequestAnimationFrame() {\r\n    if (window.requestAnimationFrame) return;\r\n\r\n    // Try vendor prefixes first\r\n    window.requestAnimationFrame = \r\n        window.webkitRequestAnimationFrame ||\r\n        window.mozRequestAnimationFrame ||\r\n        window.oRequestAnimationFrame ||\r\n        window.msRequestAnimationFrame ||\r\n        function(callback) {\r\n            return window.setTimeout(function() {\r\n                callback(Date.now());\r\n            }, 1000 / 60); // 60 FPS fallback\r\n        };\r\n\r\n    window.cancelAnimationFrame = \r\n        window.webkitCancelAnimationFrame ||\r\n        window.mozCancelAnimationFrame ||\r\n        window.oCancelAnimationFrame ||\r\n        window.msCancelAnimationFrame ||\r\n        function(id) {\r\n            window.clearTimeout(id);\r\n        };\r\n}\r\n\r\n/**\r\n * Performance.now polyfill\r\n */\r\nexport function polyfillPerformanceNow() {\r\n    if (window.performance && window.performance.now) return;\r\n\r\n    if (!window.performance) {\r\n        window.performance = {};\r\n    }\r\n\r\n    const startTime = Date.now();\r\n    window.performance.now = function() {\r\n        return Date.now() - startTime;\r\n    };\r\n}\r\n\r\n/**\r\n * Web Audio API polyfill (basic fallback)\r\n */\r\nexport function polyfillWebAudio() {\r\n    if (window.AudioContext || window.webkitAudioContext) return;\r\n\r\n    // Create a minimal AudioContext-like interface\r\n    window.AudioContext = function() {\r\n        this.state = 'suspended';\r\n        this.sampleRate = 44100;\r\n        this.currentTime = 0;\r\n        this.destination = {\r\n            connect: function() {},\r\n            disconnect: function() {}\r\n        };\r\n\r\n        this.createGain = function() {\r\n            return {\r\n                gain: { value: 1 },\r\n                connect: function() {},\r\n                disconnect: function() {}\r\n            };\r\n        };\r\n\r\n        this.createOscillator = function() {\r\n            return {\r\n                frequency: { value: 440 },\r\n                type: 'sine',\r\n                start: function() {},\r\n                stop: function() {},\r\n                connect: function() {},\r\n                disconnect: function() {}\r\n            };\r\n        };\r\n\r\n        this.createAnalyser = function() {\r\n            return {\r\n                fftSize: 2048,\r\n                frequencyBinCount: 1024,\r\n                getByteFrequencyData: function(array) {\r\n                    // Fill with zeros\r\n                    for (let i = 0; i < array.length; i++) {\r\n                        array[i] = 0;\r\n                    }\r\n                },\r\n                connect: function() {},\r\n                disconnect: function() {}\r\n            };\r\n        };\r\n\r\n        this.resume = function() {\r\n            this.state = 'running';\r\n            return Promise.resolve();\r\n        };\r\n\r\n        this.suspend = function() {\r\n            this.state = 'suspended';\r\n            return Promise.resolve();\r\n        };\r\n\r\n        this.close = function() {\r\n            this.state = 'closed';\r\n            return Promise.resolve();\r\n        };\r\n    };\r\n\r\n    // Web Audio API not supported - using fallback implementation\r\n}\r\n\r\n/**\r\n * Canvas context recovery utilities\r\n */\r\nexport class CanvasContextRecovery {\r\n    constructor(canvas) {\r\n        this.canvas = canvas;\r\n        this.context = null;\r\n        this.isContextLost = false;\r\n        this.recoveryCallbacks = [];\r\n        \r\n        this.setupContextLossHandling();\r\n    }\r\n\r\n    /**\r\n     * Set up context loss and recovery handling\r\n     */\r\n    setupContextLossHandling() {\r\n        this.canvas.addEventListener('webglcontextlost', (event) => {\r\n            event.preventDefault();\r\n            this.isContextLost = true;\r\n            // Canvas context lost\r\n        });\r\n\r\n        this.canvas.addEventListener('webglcontextrestored', () => {\r\n            this.isContextLost = false;\r\n            this.context = this.canvas.getContext('2d');\r\n            // Canvas context restored\r\n            \r\n            // Execute recovery callbacks\r\n            this.recoveryCallbacks.forEach(callback => {\r\n                try {\r\n                    callback(this.context);\r\n                } catch (error) {\r\n                    // Context recovery callback failed\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get the canvas context with recovery handling\r\n     * @returns {CanvasRenderingContext2D|null} Canvas context or null if lost\r\n     */\r\n    getContext() {\r\n        if (this.isContextLost) {\r\n            return null;\r\n        }\r\n\r\n        if (!this.context) {\r\n            try {\r\n                this.context = this.canvas.getContext('2d');\r\n            } catch (error) {\r\n                // Failed to get canvas context\r\n                return null;\r\n            }\r\n        }\r\n\r\n        return this.context;\r\n    }\r\n\r\n    /**\r\n     * Add a callback to execute when context is recovered\r\n     * @param {Function} callback - Recovery callback\r\n     */\r\n    onRecovery(callback) {\r\n        this.recoveryCallbacks.push(callback);\r\n    }\r\n\r\n    /**\r\n     * Check if context is currently lost\r\n     * @returns {boolean} True if context is lost\r\n     */\r\n    isLost() {\r\n        return this.isContextLost;\r\n    }\r\n\r\n    /**\r\n     * Attempt to recover the context manually\r\n     * @returns {boolean} True if recovery was successful\r\n     */\r\n    recover() {\r\n        if (!this.isContextLost) {\r\n            return true;\r\n        }\r\n\r\n        try {\r\n            this.context = this.canvas.getContext('2d');\r\n            if (this.context) {\r\n                this.isContextLost = false;\r\n                return true;\r\n            }\r\n        } catch (error) {\r\n            // Manual context recovery failed\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Browser-specific optimization manager\r\n */\r\nexport class BrowserOptimizations {\r\n    constructor() {\r\n        // Cache browser detection\r\n        if (BrowserOptimizations._cachedBrowser) {\r\n            this.browser = BrowserOptimizations._cachedBrowser;\r\n            this.optimizations = BrowserOptimizations._cachedOptimizations;\r\n            return;\r\n        }\r\n        \r\n        this.browser = this.detectBrowser();\r\n        this.optimizations = new Map();\r\n        this.setupOptimizations();\r\n        \r\n        // Cache for future instances\r\n        BrowserOptimizations._cachedBrowser = this.browser;\r\n        BrowserOptimizations._cachedOptimizations = this.optimizations;\r\n    }\r\n\r\n    /**\r\n     * Detect the current browser\r\n     * @returns {Object} Browser information\r\n     */\r\n    detectBrowser() {\r\n        const userAgent = navigator.userAgent;\r\n        \r\n        let name = 'unknown';\r\n        let version = 'unknown';\r\n        \r\n        if (userAgent.includes('Chrome')) {\r\n            name = 'chrome';\r\n            const match = userAgent.match(/Chrome\\/(\\d+)/);\r\n            version = match ? match[1] : 'unknown';\r\n        } else if (userAgent.includes('Firefox')) {\r\n            name = 'firefox';\r\n            const match = userAgent.match(/Firefox\\/(\\d+)/);\r\n            version = match ? match[1] : 'unknown';\r\n        } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {\r\n            name = 'safari';\r\n            const match = userAgent.match(/Version\\/(\\d+)/);\r\n            version = match ? match[1] : 'unknown';\r\n        } else if (userAgent.includes('Edge')) {\r\n            name = 'edge';\r\n            const match = userAgent.match(/Edge\\/(\\d+)/);\r\n            version = match ? match[1] : 'unknown';\r\n        }\r\n\r\n        return { name, version, userAgent };\r\n    }\r\n\r\n    /**\r\n     * Set up browser-specific optimizations\r\n     */\r\n    setupOptimizations() {\r\n        // Chrome optimizations\r\n        this.optimizations.set('chrome', {\r\n            preferredAnimationMethod: 'requestAnimationFrame',\r\n            audioContextOptions: { latencyHint: 'interactive' },\r\n            canvasOptimizations: ['willReadFrequently'],\r\n            particleLimit: 50\r\n        });\r\n\r\n        // Firefox optimizations\r\n        this.optimizations.set('firefox', {\r\n            preferredAnimationMethod: 'requestAnimationFrame',\r\n            audioContextOptions: { latencyHint: 'balanced' },\r\n            canvasOptimizations: [],\r\n            particleLimit: 40\r\n        });\r\n\r\n        // Safari optimizations\r\n        this.optimizations.set('safari', {\r\n            preferredAnimationMethod: 'requestAnimationFrame',\r\n            audioContextOptions: { latencyHint: 'playback' },\r\n            canvasOptimizations: [],\r\n            particleLimit: 30\r\n        });\r\n\r\n        // Edge optimizations\r\n        this.optimizations.set('edge', {\r\n            preferredAnimationMethod: 'requestAnimationFrame',\r\n            audioContextOptions: { latencyHint: 'interactive' },\r\n            canvasOptimizations: ['willReadFrequently'],\r\n            particleLimit: 45\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get optimizations for the current browser\r\n     * @returns {Object} Browser-specific optimizations\r\n     */\r\n    getOptimizations() {\r\n        return this.optimizations.get(this.browser.name) || this.optimizations.get('chrome');\r\n    }\r\n\r\n    /**\r\n     * Get browser information\r\n     * @returns {Object} Browser information\r\n     */\r\n    getBrowser() {\r\n        return { ...this.browser };\r\n    }\r\n\r\n    /**\r\n     * Apply canvas optimizations\r\n     * @param {HTMLCanvasElement} canvas - Canvas element\r\n     * @param {CanvasRenderingContext2D} context - Canvas context\r\n     */\r\n    applyCanvasOptimizations(canvas, context) {\r\n        const opts = this.getOptimizations();\r\n        \r\n        if (opts.canvasOptimizations.includes('willReadFrequently')) {\r\n            try {\r\n                // Re-get context with optimization hint\r\n                const optimizedContext = canvas.getContext('2d', { willReadFrequently: true });\r\n                if (optimizedContext) {\r\n                    // Applied willReadFrequently optimization\r\n                }\r\n            } catch (error) {\r\n                // Failed to apply canvas optimization\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get recommended particle limit for current browser\r\n     * @returns {number} Recommended particle limit\r\n     */\r\n    getRecommendedParticleLimit() {\r\n        return this.getOptimizations().particleLimit;\r\n    }\r\n\r\n    /**\r\n     * Get audio context options for current browser\r\n     * @returns {Object} Audio context options\r\n     */\r\n    getAudioContextOptions() {\r\n        return this.getOptimizations().audioContextOptions;\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize all polyfills and compatibility features\r\n * @returns {Object} Initialization results\r\n */\r\nlet _initializationCache = null;\r\n\r\nexport function initializeBrowserCompatibility() {\r\n    // Return cached result if already initialized\r\n    if (_initializationCache) {\r\n        return _initializationCache;\r\n    }\r\n    \r\n    const featureDetection = new FeatureDetection();\r\n    const polyfillManager = new PolyfillManager();\r\n    const browserOptimizations = new BrowserOptimizations();\r\n\r\n    // Register polyfills\r\n    polyfillManager.register('requestAnimationFrame', polyfillRequestAnimationFrame);\r\n    polyfillManager.register('performanceNow', polyfillPerformanceNow);\r\n    polyfillManager.register('webAudio', polyfillWebAudio);\r\n\r\n    // Apply necessary polyfills based on feature detection\r\n    const appliedPolyfills = [];\r\n    \r\n    if (!featureDetection.features.requestAnimationFrame) {\r\n        if (polyfillManager.apply('requestAnimationFrame')) {\r\n            appliedPolyfills.push('requestAnimationFrame');\r\n        }\r\n    }\r\n    \r\n    if (!featureDetection.features.performance) {\r\n        if (polyfillManager.apply('performanceNow')) {\r\n            appliedPolyfills.push('performanceNow');\r\n        }\r\n    }\r\n    \r\n    if (!featureDetection.features.webAudio) {\r\n        if (polyfillManager.apply('webAudio')) {\r\n            appliedPolyfills.push('webAudio');\r\n        }\r\n    }\r\n\r\n    // Cache the result\r\n    _initializationCache = {\r\n        featureDetection,\r\n        polyfillManager,\r\n        browserOptimizations,\r\n        appliedPolyfills,\r\n        capabilities: featureDetection.getCapabilities(),\r\n        browser: browserOptimizations.getBrowser()\r\n    };\r\n    \r\n    return _initializationCache;\r\n}\r\n\r\n// Create singleton instance lazily\r\nlet _browserCompatibilityInstance = null;\r\n\r\nexport function getBrowserCompatibility() {\r\n    if (!_browserCompatibilityInstance) {\r\n        _browserCompatibilityInstance = initializeBrowserCompatibility();\r\n    }\r\n    return _browserCompatibilityInstance;\r\n}\r\n\r\n// Export getter for backward compatibility\r\nexport const browserCompatibility = getBrowserCompatibility();","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                      ◐ ◑ ◒ ◓  DEBUGGER  ◓ ◒ ◑ ◐                      \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Debugger - Enhanced Logging & Performance Profiling\r\n * @author Emotive Engine Team\r\n * @version 2.0.0\r\n * @module Debugger\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The DIAGNOSTIC CENTER of the engine. Provides comprehensive debugging tools,      \r\n * ║ performance profiling, memory tracking, and runtime diagnostics to ensure         \r\n * ║ smooth operation and help developers optimize their implementations.              \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🐛 DEBUG FEATURES                                                                 \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Multi-level logging (NONE, ERROR, WARN, INFO, DEBUG, TRACE)                     \r\n * │ • Performance profiling with timing metrics                                       \r\n * │ • Memory usage tracking and leak detection                                        \r\n * │ • Error tracking and stack trace capture                                          \r\n * │ • Runtime capability detection                                                    \r\n * │ • Visual debugging overlays                                                       \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\n/**\r\n * Debug levels for controlling log output\r\n */\r\nexport const DebugLevel = {\r\n    NONE: 0,\r\n    ERROR: 1,\r\n    WARN: 2,\r\n    INFO: 3,\r\n    DEBUG: 4,\r\n    TRACE: 5\r\n};\r\n\r\n/**\r\n * Enhanced debugger with performance profiling and error tracking\r\n */\r\nexport class EmotiveDebugger {\r\n    constructor(config = {}) {\r\n        this.config = {\r\n            enabled: config.enabled !== false,\r\n            level: config.level || DebugLevel.INFO,\r\n            enableProfiling: config.enableProfiling !== false,\r\n            enableErrorTracking: config.enableErrorTracking !== false,\r\n            enableMemoryTracking: config.enableMemoryTracking !== false,\r\n            maxLogEntries: config.maxLogEntries || 1000,\r\n            maxProfileEntries: config.maxProfileEntries || 500,\r\n            ...config\r\n        };\r\n\r\n        // Log storage\r\n        this.logs = [];\r\n        this.errors = [];\r\n        this.profiles = new Map();\r\n        this.memorySnapshots = [];\r\n        \r\n        // Performance tracking\r\n        this.frameTimings = [];\r\n        this.maxFrameTimings = 120; // 2 seconds at 60fps\r\n        \r\n        // Error tracking\r\n        this.errorCounts = new Map();\r\n        this.lastErrors = new Map();\r\n        \r\n        // Feature detection for debugging capabilities\r\n        this.capabilities = {\r\n            performance: typeof performance !== 'undefined' && performance.now,\r\n            memory: typeof performance !== 'undefined' && performance.memory,\r\n            console: typeof console !== 'undefined',\r\n            stackTrace: typeof Error !== 'undefined'\r\n        };\r\n\r\n        // Initialize\r\n        this.startTime = this.now();\r\n        this.setupErrorHandling();\r\n        \r\n        if (this.config.enabled) {\r\n            this.log('DEBUG', 'EmotiveDebugger initialized', {\r\n                config: this.config,\r\n                capabilities: this.capabilities\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current high-resolution timestamp\r\n     * @returns {number} Timestamp in milliseconds\r\n     */\r\n    now() {\r\n        if (this.capabilities.performance) {\r\n            return performance.now();\r\n        }\r\n        return Date.now() - this.startTime;\r\n    }\r\n\r\n    /**\r\n     * Set up global error handling\r\n     */\r\n    setupErrorHandling() {\r\n        if (!this.config.enableErrorTracking || typeof window === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        // Capture unhandled errors\r\n        window.addEventListener('error', (event) => {\r\n            this.trackError('UNHANDLED_ERROR', event.error || new Error(event.message), {\r\n                filename: event.filename,\r\n                lineno: event.lineno,\r\n                colno: event.colno\r\n            });\r\n        });\r\n\r\n        // Capture unhandled promise rejections\r\n        window.addEventListener('unhandledrejection', (event) => {\r\n            this.trackError('UNHANDLED_REJECTION', event.reason, {\r\n                promise: event.promise\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Log a message with specified level\r\n     * @param {string} level - Log level\r\n     * @param {string} message - Log message\r\n     * @param {*} data - Additional data\r\n     */\r\n    log(level, message, data = null) {\r\n        if (!this.config.enabled) return;\r\n\r\n        const levelValue = DebugLevel[level] || DebugLevel.INFO;\r\n        if (levelValue > this.config.level) return;\r\n\r\n        const timestamp = this.now();\r\n        const logEntry = {\r\n            timestamp,\r\n            level,\r\n            message,\r\n            data,\r\n            stackTrace: this.getStackTrace()\r\n        };\r\n\r\n        // Store log entry\r\n        this.logs.push(logEntry);\r\n        if (this.logs.length > this.config.maxLogEntries) {\r\n            this.logs.shift();\r\n        }\r\n\r\n        // Console output\r\n        if (this.capabilities.console) {\r\n            const consoleMethod = this.getConsoleMethod(level);\r\n            const timeStr = `[${(timestamp / 1000).toFixed(3)}s]`;\r\n            \r\n            if (data) {\r\n                consoleMethod(`${timeStr} [${level}] ${message}`, data);\r\n            } else {\r\n                consoleMethod(`${timeStr} [${level}] ${message}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get appropriate console method for log level\r\n     * @param {string} level - Log level\r\n     * @returns {Function} Console method\r\n     */\r\n    getConsoleMethod(level) {\r\n        switch (level) {\r\n            case 'ERROR': return (() => {}).bind(console);\r\n            case 'WARN': return (() => {}).bind(console);\r\n            case 'DEBUG': return (() => {}).bind(console);\r\n            case 'TRACE': return (() => {}).bind(console);\r\n            default: return (() => {}).bind(console);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current stack trace\r\n     * @returns {string|null} Stack trace or null if not available\r\n     */\r\n    getStackTrace() {\r\n        if (!this.capabilities.stackTrace) return null;\r\n        \r\n        try {\r\n            throw new Error();\r\n        } catch (e) {\r\n            return e.stack;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Track an error with context\r\n     * @param {string} type - Error type\r\n     * @param {Error} error - Error object\r\n     * @param {Object} context - Additional context\r\n     */\r\n    trackError(type, error, context = {}) {\r\n        if (!this.config.enableErrorTracking) return;\r\n\r\n        const timestamp = this.now();\r\n        const errorEntry = {\r\n            timestamp,\r\n            type,\r\n            message: error.message || String(error),\r\n            stack: error.stack,\r\n            context,\r\n            count: 1\r\n        };\r\n\r\n        // Update error counts\r\n        const errorKey = `${type}:${error.message}`;\r\n        if (this.errorCounts.has(errorKey)) {\r\n            this.errorCounts.set(errorKey, this.errorCounts.get(errorKey) + 1);\r\n            errorEntry.count = this.errorCounts.get(errorKey);\r\n        } else {\r\n            this.errorCounts.set(errorKey, 1);\r\n        }\r\n\r\n        // Store error\r\n        this.errors.push(errorEntry);\r\n        this.lastErrors.set(type, errorEntry);\r\n\r\n        // Log error\r\n        this.log('ERROR', `${type}: ${error.message}`, {\r\n            error: errorEntry,\r\n            context\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Start profiling a named operation\r\n     * @param {string} name - Profile name\r\n     * @param {Object} metadata - Additional metadata\r\n     */\r\n    startProfile(name, metadata = {}) {\r\n        if (!this.config.enableProfiling) return;\r\n\r\n        const profile = {\r\n            name,\r\n            startTime: this.now(),\r\n            metadata,\r\n            samples: [],\r\n            isActive: true\r\n        };\r\n\r\n        this.profiles.set(name, profile);\r\n        this.log('TRACE', `Started profiling: ${name}`, metadata);\r\n    }\r\n\r\n    /**\r\n     * Add a sample to an active profile\r\n     * @param {string} name - Profile name\r\n     * @param {string} label - Sample label\r\n     * @param {*} data - Sample data\r\n     */\r\n    profileSample(name, label, data = null) {\r\n        if (!this.config.enableProfiling) return;\r\n\r\n        const profile = this.profiles.get(name);\r\n        if (!profile || !profile.isActive) return;\r\n\r\n        const sample = {\r\n            timestamp: this.now(),\r\n            label,\r\n            data,\r\n            relativeTime: this.now() - profile.startTime\r\n        };\r\n\r\n        profile.samples.push(sample);\r\n    }\r\n\r\n    /**\r\n     * End profiling and get results\r\n     * @param {string} name - Profile name\r\n     * @returns {Object|null} Profile results or null if not found\r\n     */\r\n    endProfile(name) {\r\n        if (!this.config.enableProfiling) return null;\r\n\r\n        const profile = this.profiles.get(name);\r\n        if (!profile || !profile.isActive) return null;\r\n\r\n        profile.endTime = this.now();\r\n        profile.duration = profile.endTime - profile.startTime;\r\n        profile.isActive = false;\r\n\r\n        // Calculate statistics\r\n        profile.stats = this.calculateProfileStats(profile);\r\n\r\n        this.log('TRACE', `Ended profiling: ${name}`, {\r\n            duration: profile.duration,\r\n            samples: profile.samples.length,\r\n            stats: profile.stats\r\n        });\r\n\r\n        // Limit stored profiles\r\n        if (this.profiles.size > this.config.maxProfileEntries) {\r\n            const oldestKey = this.profiles.keys().next().value;\r\n            this.profiles.delete(oldestKey);\r\n        }\r\n\r\n        return { ...profile };\r\n    }\r\n\r\n    /**\r\n     * Calculate statistics for a profile\r\n     * @param {Object} profile - Profile data\r\n     * @returns {Object} Profile statistics\r\n     */\r\n    calculateProfileStats(profile) {\r\n        if (profile.samples.length === 0) {\r\n            return { sampleCount: 0 };\r\n        }\r\n\r\n        const durations = [];\r\n        for (let i = 1; i < profile.samples.length; i++) {\r\n            durations.push(profile.samples[i].relativeTime - profile.samples[i - 1].relativeTime);\r\n        }\r\n\r\n        if (durations.length === 0) {\r\n            return { sampleCount: profile.samples.length };\r\n        }\r\n\r\n        const sum = durations.reduce((a, b) => a + b, 0);\r\n        const avg = sum / durations.length;\r\n        const min = Math.min(...durations);\r\n        const max = Math.max(...durations);\r\n\r\n        return {\r\n            sampleCount: profile.samples.length,\r\n            avgSampleDuration: avg,\r\n            minSampleDuration: min,\r\n            maxSampleDuration: max,\r\n            totalDuration: profile.duration\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Track frame timing for performance analysis\r\n     * @param {number} frameTime - Frame time in milliseconds\r\n     */\r\n    trackFrameTiming(frameTime) {\r\n        if (!this.config.enableProfiling) return;\r\n\r\n        this.frameTimings.push({\r\n            timestamp: this.now(),\r\n            frameTime,\r\n            fps: 1000 / frameTime\r\n        });\r\n\r\n        if (this.frameTimings.length > this.maxFrameTimings) {\r\n            this.frameTimings.shift();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Take a memory snapshot (if supported)\r\n     * @param {string} label - Snapshot label\r\n     */\r\n    takeMemorySnapshot(label = 'snapshot') {\r\n        if (!this.config.enableMemoryTracking || !this.capabilities.memory) return;\r\n\r\n        const snapshot = {\r\n            timestamp: this.now(),\r\n            label,\r\n            memory: {\r\n                usedJSHeapSize: performance.memory.usedJSHeapSize,\r\n                totalJSHeapSize: performance.memory.totalJSHeapSize,\r\n                jsHeapSizeLimit: performance.memory.jsHeapSizeLimit\r\n            }\r\n        };\r\n\r\n        this.memorySnapshots.push(snapshot);\r\n        \r\n        // Limit snapshots\r\n        if (this.memorySnapshots.length > 100) {\r\n            this.memorySnapshots.shift();\r\n        }\r\n\r\n        this.log('DEBUG', `Memory snapshot: ${label}`, snapshot.memory);\r\n    }\r\n\r\n    /**\r\n     * Get comprehensive debug report\r\n     * @returns {Object} Debug report\r\n     */\r\n    getDebugReport() {\r\n        const report = {\r\n            timestamp: this.now(),\r\n            uptime: this.now() - 0,\r\n            config: this.config,\r\n            capabilities: this.capabilities,\r\n            \r\n            // Logs\r\n            logCount: this.logs.length,\r\n            recentLogs: this.logs.slice(-10),\r\n            \r\n            // Errors\r\n            errorCount: this.errors.length,\r\n            uniqueErrors: this.errorCounts.size,\r\n            recentErrors: this.errors.slice(-5),\r\n            errorCounts: Object.fromEntries(this.errorCounts),\r\n            \r\n            // Profiles\r\n            activeProfiles: Array.from(this.profiles.values()).filter(p => p.isActive).length,\r\n            completedProfiles: Array.from(this.profiles.values()).filter(p => !p.isActive).length,\r\n            \r\n            // Performance\r\n            frameTimings: this.getFrameTimingStats(),\r\n            \r\n            // Memory\r\n            memorySnapshots: this.memorySnapshots.slice(-5)\r\n        };\r\n\r\n        return report;\r\n    }\r\n\r\n    /**\r\n     * Get frame timing statistics\r\n     * @returns {Object} Frame timing stats\r\n     */\r\n    getFrameTimingStats() {\r\n        if (this.frameTimings.length === 0) {\r\n            return { sampleCount: 0 };\r\n        }\r\n\r\n        const frameTimes = this.frameTimings.map(f => f.frameTime);\r\n        const fps = this.frameTimings.map(f => f.fps);\r\n\r\n        return {\r\n            sampleCount: this.frameTimings.length,\r\n            avgFrameTime: frameTimes.reduce((a, b) => a + b, 0) / frameTimes.length,\r\n            minFrameTime: Math.min(...frameTimes),\r\n            maxFrameTime: Math.max(...frameTimes),\r\n            avgFPS: fps.reduce((a, b) => a + b, 0) / fps.length,\r\n            minFPS: Math.min(...fps),\r\n            maxFPS: Math.max(...fps)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Export debug data for external analysis\r\n     * @returns {Object} Exportable debug data\r\n     */\r\n    exportDebugData() {\r\n        return {\r\n            metadata: {\r\n                exportTime: Date.now(),\r\n                debuggerUptime: this.now(),\r\n                config: this.config,\r\n                capabilities: this.capabilities\r\n            },\r\n            logs: [...this.logs],\r\n            errors: [...this.errors],\r\n            profiles: Object.fromEntries(this.profiles),\r\n            frameTimings: [...this.frameTimings],\r\n            memorySnapshots: [...this.memorySnapshots],\r\n            errorCounts: Object.fromEntries(this.errorCounts)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Clear all debug data\r\n     */\r\n    clear() {\r\n        this.logs = [];\r\n        this.errors = [];\r\n        this.profiles.clear();\r\n        this.frameTimings = [];\r\n        this.memorySnapshots = [];\r\n        this.errorCounts.clear();\r\n        this.lastErrors.clear();\r\n        \r\n        this.log('INFO', 'Debug data cleared');\r\n    }\r\n\r\n    /**\r\n     * Destroy the debugger and clean up\r\n     */\r\n    destroy() {\r\n        this.clear();\r\n        this.config.enabled = false;\r\n        \r\n        // Remove event listeners if we added them\r\n        if (typeof window !== 'undefined') {\r\n            // Note: In a real implementation, we'd need to store references to remove them\r\n            // For now, just disable the debugger\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Runtime feature detection and capability reporting\r\n */\r\nexport class RuntimeCapabilities {\r\n    constructor() {\r\n        this.capabilities = this.detectCapabilities();\r\n        this.performance = this.measurePerformance();\r\n    }\r\n\r\n    /**\r\n     * Detect runtime capabilities\r\n     * @returns {Object} Capability detection results\r\n     */\r\n    detectCapabilities() {\r\n        const caps = {\r\n            // JavaScript features\r\n            es6: this.detectES6(),\r\n            es2017: this.detectES2017(),\r\n            modules: this.detectModules(),\r\n            \r\n            // Browser APIs\r\n            webGL: this.detectWebGL(),\r\n            webGL2: this.detectWebGL2(),\r\n            webWorkers: this.detectWebWorkers(),\r\n            serviceWorkers: this.detectServiceWorkers(),\r\n            \r\n            // Performance APIs\r\n            performanceObserver: this.detectPerformanceObserver(),\r\n            intersectionObserver: this.detectIntersectionObserver(),\r\n            resizeObserver: this.detectResizeObserver(),\r\n            \r\n            // Storage\r\n            localStorage: this.detectLocalStorage(),\r\n            sessionStorage: this.detectSessionStorage(),\r\n            indexedDB: this.detectIndexedDB(),\r\n            \r\n            // Network\r\n            fetch: this.detectFetch(),\r\n            webSockets: this.detectWebSockets(),\r\n            \r\n            // Device capabilities\r\n            touchEvents: this.detectTouchEvents(),\r\n            pointerEvents: this.detectPointerEvents(),\r\n            deviceOrientation: this.detectDeviceOrientation(),\r\n            \r\n            // Graphics\r\n            canvas2d: this.detectCanvas2D(),\r\n            canvasFilters: this.detectCanvasFilters(),\r\n            offscreenCanvas: this.detectOffscreenCanvas()\r\n        };\r\n\r\n        return caps;\r\n    }\r\n\r\n    detectES6() {\r\n        try {\r\n            // Check for arrow functions and classes without eval\r\n            return typeof Symbol !== 'undefined' && \r\n                   typeof Promise !== 'undefined' && \r\n                   typeof Map !== 'undefined' && \r\n                   typeof Set !== 'undefined';\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectES2017() {\r\n        try {\r\n            // Check for async/await support\r\n            return typeof async !== 'undefined' || \r\n                   (function() { \r\n                       try { \r\n                           return Function('return async function(){}')().constructor.name === 'AsyncFunction'; \r\n                       } catch(e) { \r\n                           return false; \r\n                       } \r\n                   })();\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectModules() {\r\n        try {\r\n            return typeof document !== 'undefined' && 'noModule' in document.createElement('script');\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectWebGL() {\r\n        try {\r\n            const canvas = document.createElement('canvas');\r\n            return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectWebGL2() {\r\n        try {\r\n            const canvas = document.createElement('canvas');\r\n            return !!canvas.getContext('webgl2');\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectWebWorkers() {\r\n        return typeof Worker !== 'undefined';\r\n    }\r\n\r\n    detectServiceWorkers() {\r\n        return 'serviceWorker' in navigator;\r\n    }\r\n\r\n    detectPerformanceObserver() {\r\n        return typeof PerformanceObserver !== 'undefined';\r\n    }\r\n\r\n    detectIntersectionObserver() {\r\n        return typeof IntersectionObserver !== 'undefined';\r\n    }\r\n\r\n    detectResizeObserver() {\r\n        return typeof ResizeObserver !== 'undefined';\r\n    }\r\n\r\n    detectLocalStorage() {\r\n        try {\r\n            return typeof localStorage !== 'undefined' && localStorage !== null;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectSessionStorage() {\r\n        try {\r\n            return typeof sessionStorage !== 'undefined' && sessionStorage !== null;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectIndexedDB() {\r\n        return typeof indexedDB !== 'undefined';\r\n    }\r\n\r\n    detectFetch() {\r\n        return typeof fetch !== 'undefined';\r\n    }\r\n\r\n    detectWebSockets() {\r\n        return typeof WebSocket !== 'undefined';\r\n    }\r\n\r\n    detectTouchEvents() {\r\n        return 'ontouchstart' in window || navigator.maxTouchPoints > 0;\r\n    }\r\n\r\n    detectPointerEvents() {\r\n        return typeof PointerEvent !== 'undefined';\r\n    }\r\n\r\n    detectDeviceOrientation() {\r\n        return 'ondeviceorientation' in window;\r\n    }\r\n\r\n    detectCanvas2D() {\r\n        try {\r\n            const canvas = document.createElement('canvas');\r\n            return !!canvas.getContext('2d');\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectCanvasFilters() {\r\n        try {\r\n            const canvas = document.createElement('canvas');\r\n            const ctx = canvas.getContext('2d');\r\n            return 'filter' in ctx;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    detectOffscreenCanvas() {\r\n        return typeof OffscreenCanvas !== 'undefined';\r\n    }\r\n\r\n    /**\r\n     * Measure basic performance characteristics\r\n     * @returns {Object} Performance measurements\r\n     */\r\n    measurePerformance() {\r\n        const measurements = {};\r\n\r\n        // Measure JavaScript execution speed\r\n        const start = performance.now();\r\n        let sum = 0;\r\n        for (let i = 0; i < 100000; i++) {\r\n            sum += Math.random();\r\n        }\r\n        measurements.jsExecutionSpeed = performance.now() - start;\r\n\r\n        // Measure canvas performance\r\n        try {\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = 100;\r\n            canvas.height = 100;\r\n            const ctx = canvas.getContext('2d');\r\n            \r\n            const canvasStart = performance.now();\r\n            for (let i = 0; i < 1000; i++) {\r\n                ctx.fillRect(Math.random() * 100, Math.random() * 100, 10, 10);\r\n            }\r\n            measurements.canvasPerformance = performance.now() - canvasStart;\r\n        } catch (e) {\r\n            measurements.canvasPerformance = null;\r\n        }\r\n\r\n        return measurements;\r\n    }\r\n\r\n    /**\r\n     * Get all capabilities\r\n     * @returns {Object} All detected capabilities\r\n     */\r\n    getCapabilities() {\r\n        return { ...this.capabilities };\r\n    }\r\n\r\n    /**\r\n     * Get performance measurements\r\n     * @returns {Object} Performance measurements\r\n     */\r\n    getPerformance() {\r\n        return { ...this.performance };\r\n    }\r\n\r\n    /**\r\n     * Generate capability report\r\n     * @returns {Object} Comprehensive capability report\r\n     */\r\n    generateReport() {\r\n        const supportedFeatures = Object.entries(this.capabilities)\r\n            .filter(([, supported]) => supported)\r\n            .map(([feature]) => feature);\r\n\r\n        const unsupportedFeatures = Object.entries(this.capabilities)\r\n            .filter(([, supported]) => !supported)\r\n            .map(([feature]) => feature);\r\n\r\n        const supportPercentage = (supportedFeatures.length / Object.keys(this.capabilities).length) * 100;\r\n\r\n        return {\r\n            timestamp: Date.now(),\r\n            userAgent: navigator.userAgent,\r\n            supportedFeatures,\r\n            unsupportedFeatures,\r\n            supportPercentage: Math.round(supportPercentage),\r\n            performance: this.performance,\r\n            recommendations: this.generateRecommendations(supportPercentage)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Generate recommendations based on capabilities\r\n     * @param {number} supportPercentage - Percentage of supported features\r\n     * @returns {Array<string>} Recommendations\r\n     */\r\n    generateRecommendations(supportPercentage) {\r\n        const recommendations = [];\r\n\r\n        if (supportPercentage < 50) {\r\n            recommendations.push('Consider using the minimal build for better compatibility');\r\n        }\r\n\r\n        if (!this.capabilities.webGL) {\r\n            recommendations.push('WebGL not supported - advanced graphics features unavailable');\r\n        }\r\n\r\n        if (!this.capabilities.webWorkers) {\r\n            recommendations.push('Web Workers not supported - background processing unavailable');\r\n        }\r\n\r\n        if (!this.capabilities.fetch) {\r\n            recommendations.push('Fetch API not supported - consider using XMLHttpRequest polyfill');\r\n        }\r\n\r\n        if (this.performance.jsExecutionSpeed > 50) {\r\n            recommendations.push('Slow JavaScript execution detected - consider performance optimizations');\r\n        }\r\n\r\n        if (this.performance.canvasPerformance > 100) {\r\n            recommendations.push('Slow canvas performance detected - consider reducing visual complexity');\r\n        }\r\n\r\n        return recommendations;\r\n    }\r\n}\r\n\r\n// Create singleton instances for convenience\r\nexport const emotiveDebugger = new EmotiveDebugger({\r\n    enabled: typeof window !== 'undefined' && window.location && window.location.search.includes('debug=true'),\r\n    level: DebugLevel.INFO\r\n});\r\n\r\nexport const runtimeCapabilities = new RuntimeCapabilities();","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Shape Definitions\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Static shape definitions for immediate loading\r\n * @author Emotive Engine Team\r\n * @module shapes/shapeDefinitions\r\n */\r\n\r\n/**\r\n * Generate circle points\r\n */\r\nfunction generateCircle(numPoints) {\r\n    const points = [];\r\n    for (let i = 0; i < numPoints; i++) {\r\n        const angle = (i / numPoints) * Math.PI * 2;\r\n        points.push({\r\n            x: 0.5 + Math.cos(angle) * 0.5,\r\n            y: 0.5 + Math.sin(angle) * 0.5\r\n        });\r\n    }\r\n    return points;\r\n}\r\n\r\n/**\r\n * Generate heart shape\r\n */\r\nfunction generateHeart(numPoints) {\r\n    const points = [];\r\n    for (let i = 0; i < numPoints; i++) {\r\n        const t = (i / numPoints) * Math.PI * 2;\r\n\r\n        // Heart parametric equations\r\n        const x = 16 * Math.pow(Math.sin(t), 3);\r\n        const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) -\r\n                  2 * Math.cos(3 * t) - Math.cos(4 * t));\r\n\r\n        // Normalize and scale\r\n        points.push({\r\n            x: 0.5 + x / 32,\r\n            y: 0.5 + y / 32\r\n        });\r\n    }\r\n    return points;\r\n}\r\n\r\n/**\r\n * Generate moon shape - keep it as a circle\r\n * The crescent effect should be done with visual shadows, not shape morphing\r\n */\r\nfunction generateMoon(numPoints) {\r\n    // Moon should stay as a circle - the crescent is a visual effect\r\n    return generateCircle(numPoints);\r\n}\r\n\r\n/**\r\n * Generate star shape - proper 5-pointed star\r\n */\r\nfunction generateStar(numPoints, starPoints = 5) {\r\n    const points = [];\r\n    const outerRadius = 0.5;\r\n    const innerRadius = outerRadius * 0.382; // Golden ratio for perfect star\r\n    \r\n    // Generate the 10 vertices (5 outer, 5 inner)\r\n    const vertices = [];\r\n    const angleStep = (Math.PI * 2) / starPoints; // 72 degrees between star points\r\n    const halfAngleStep = angleStep / 2; // 36 degrees offset for inner points\r\n    \r\n    for (let i = 0; i < starPoints; i++) {\r\n        // Outer point (star tip)\r\n        const outerAngle = (i * angleStep) - Math.PI / 2; // Start from top\r\n        vertices.push({\r\n            x: 0.5 + Math.cos(outerAngle) * outerRadius,\r\n            y: 0.5 + Math.sin(outerAngle) * outerRadius\r\n        });\r\n        \r\n        // Inner point (valley) - offset by half the angle\r\n        const innerAngle = outerAngle + halfAngleStep;\r\n        vertices.push({\r\n            x: 0.5 + Math.cos(innerAngle) * innerRadius,\r\n            y: 0.5 + Math.sin(innerAngle) * innerRadius\r\n        });\r\n    }\r\n    \r\n    // Now interpolate points along the star perimeter\r\n    for (let i = 0; i < numPoints; i++) {\r\n        const t = i / numPoints;\r\n        const vertexCount = vertices.length;\r\n        \r\n        // Which edge are we on?\r\n        const edgeFloat = t * vertexCount;\r\n        const edgeIndex = Math.floor(edgeFloat) % vertexCount;\r\n        const nextIndex = (edgeIndex + 1) % vertexCount;\r\n        const edgeProgress = edgeFloat - Math.floor(edgeFloat);\r\n        \r\n        // Linear interpolation between vertices\r\n        const v1 = vertices[edgeIndex];\r\n        const v2 = vertices[nextIndex];\r\n        \r\n        points.push({\r\n            x: v1.x + (v2.x - v1.x) * edgeProgress,\r\n            y: v1.y + (v2.y - v1.y) * edgeProgress\r\n        });\r\n    }\r\n    \r\n    return points;\r\n}\r\n\r\n/**\r\n * Generate sun shape - just a circle, rays are visual effects only\r\n */\r\nfunction generateSun(numPoints, numRays = 12) {\r\n    // Sun is just a circle - the rays are rendered as effects, not part of the shape\r\n    return generateCircle(numPoints);\r\n}\r\n\r\n\r\n/**\r\n * Generate suspicion shape (sly grin)\r\n */\r\nfunction generateSuspicion(numPoints) {\r\n    const points = [];\r\n    for (let i = 0; i < numPoints; i++) {\r\n        const t = (i / numPoints) * Math.PI * 2;\r\n        \r\n        let x, y;\r\n        if (t < Math.PI) {\r\n            // Right side - outer arc of the grin\r\n            x = Math.cos(t) * 0.45;\r\n            y = Math.sin(t) * 0.45;\r\n        } else {\r\n            // Left side - inner arc for the mischievous smile\r\n            const innerT = Math.PI * 2 - t;\r\n            x = Math.cos(innerT) * 0.25 - 0.1;\r\n            y = Math.sin(innerT) * 0.35;\r\n        }\r\n        \r\n        points.push({\r\n            x: 0.5 + x,\r\n            y: 0.5 + y\r\n        });\r\n    }\r\n    return points;\r\n}\r\n\r\n/**\r\n * Generate square shape\r\n */\r\nfunction generateSquare(numPoints) {\r\n    const points = [];\r\n    const pointsPerSide = Math.floor(numPoints / 4);\r\n    \r\n    for (let side = 0; side < 4; side++) {\r\n        for (let i = 0; i < pointsPerSide; i++) {\r\n            const t = i / pointsPerSide;\r\n            let x, y;\r\n            \r\n            switch (side) {\r\n                case 0: // Top\r\n                    x = -0.5 + t;\r\n                    y = -0.5;\r\n                    break;\r\n                case 1: // Right\r\n                    x = 0.5;\r\n                    y = -0.5 + t;\r\n                    break;\r\n                case 2: // Bottom\r\n                    x = 0.5 - t;\r\n                    y = 0.5;\r\n                    break;\r\n                case 3: // Left\r\n                    x = -0.5;\r\n                    y = 0.5 - t;\r\n                    break;\r\n            }\r\n            \r\n            points.push({\r\n                x: 0.5 + x * 0.8,\r\n                y: 0.5 + y * 0.8\r\n            });\r\n        }\r\n    }\r\n    return points;\r\n}\r\n\r\n/**\r\n * Generate triangle shape\r\n */\r\nfunction generateTriangle(numPoints) {\r\n    const points = [];\r\n    \r\n    const vertices = [\r\n        { x: 0, y: -0.5 },           // Top\r\n        { x: -0.433, y: 0.25 },      // Bottom left\r\n        { x: 0.433, y: 0.25 }        // Bottom right\r\n    ];\r\n    \r\n    // Calculate perimeter of triangle\r\n    const sides = [\r\n        Math.sqrt(Math.pow(vertices[1].x - vertices[0].x, 2) + Math.pow(vertices[1].y - vertices[0].y, 2)),\r\n        Math.sqrt(Math.pow(vertices[2].x - vertices[1].x, 2) + Math.pow(vertices[2].y - vertices[1].y, 2)),\r\n        Math.sqrt(Math.pow(vertices[0].x - vertices[2].x, 2) + Math.pow(vertices[0].y - vertices[2].y, 2))\r\n    ];\r\n    const perimeter = sides[0] + sides[1] + sides[2];\r\n    \r\n    // Distribute points based on side length\r\n    const pointsPerSide = sides.map(s => Math.round(numPoints * s / perimeter));\r\n    \r\n    // Adjust for rounding errors\r\n    const totalPoints = pointsPerSide.reduce((a, b) => a + b, 0);\r\n    if (totalPoints < numPoints) {\r\n        pointsPerSide[0] += numPoints - totalPoints;\r\n    }\r\n    \r\n    // Generate points along each edge\r\n    for (let side = 0; side < 3; side++) {\r\n        const v1 = vertices[side];\r\n        const v2 = vertices[(side + 1) % 3];\r\n        const sidePoints = pointsPerSide[side];\r\n        \r\n        for (let i = 0; i < sidePoints; i++) {\r\n            // Don't duplicate the corner point\r\n            if (i === sidePoints - 1 && side < 2) continue;\r\n            \r\n            const t = i / sidePoints;\r\n            const x = v1.x + (v2.x - v1.x) * t;\r\n            const y = v1.y + (v2.y - v1.y) * t;\r\n            \r\n            points.push({\r\n                x: 0.5 + x * 0.9,\r\n                y: 0.5 + y * 0.9\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Ensure we have exactly numPoints\r\n    while (points.length < numPoints) {\r\n        points.push(points[points.length - 1]);\r\n    }\r\n    while (points.length > numPoints) {\r\n        points.pop();\r\n    }\r\n    \r\n    return points;\r\n}\r\n\r\n/**\r\n * Shape definitions with their properties\r\n */\r\nexport const SHAPE_DEFINITIONS = {\r\n    circle: {\r\n        points: generateCircle(64),\r\n        shadow: { type: 'none' }\r\n    },\r\n    heart: {\r\n        points: generateHeart(64),\r\n        shadow: { type: 'none' }\r\n    },\r\n    star: {\r\n        points: generateStar(64, 5),\r\n        shadow: { type: 'none' }\r\n    },\r\n    sun: {\r\n        points: generateSun(64, 12),\r\n        shadow: {\r\n            type: 'sun',\r\n            corona: true,\r\n            intensity: 1.5,\r\n            flares: true,\r\n            texture: true,\r\n            turbulence: 0.3\r\n        }\r\n    },\r\n    moon: {\r\n        points: generateMoon(64),\r\n        shadow: {\r\n            type: 'crescent',\r\n            coverage: 0.85,\r\n            angle: -30,\r\n            softness: 0.05,\r\n            offset: 0.7\r\n        }\r\n    },\r\n    lunar: {\r\n        points: generateCircle(64),\r\n        shadow: {\r\n            type: 'lunar',\r\n            coverage: 0.7,\r\n            color: 'rgba(80, 20, 0, 0.8)',\r\n            progression: 'center'\r\n        }\r\n    },\r\n    suspicion: {\r\n        points: generateSuspicion(64),\r\n        shadow: { type: 'none' }\r\n    },\r\n    eclipse: {\r\n        points: generateCircle(64),\r\n        shadow: {\r\n            type: 'lunar',\r\n            coverage: 0.7,\r\n            color: 'rgba(80, 20, 0, 0.8)'\r\n        }\r\n    },\r\n    square: {\r\n        points: generateSquare(64),\r\n        shadow: { type: 'none' }\r\n    },\r\n    triangle: {\r\n        points: generateTriangle(64),\r\n        shadow: { type: 'none' }\r\n    },\r\n    solar: {\r\n        points: generateSun(64, 12),\r\n        shadow: {\r\n            type: 'solar-hybrid',\r\n            // Sun properties (rendered first)\r\n            corona: true,\r\n            intensity: 1.5,\r\n            flares: true,\r\n            texture: true,\r\n            turbulence: 0.3,\r\n            // Lunar shadow overlay (rendered on top) - BLACK for solar eclipse\r\n            lunarOverlay: {\r\n                type: 'lunar',\r\n                coverage: 1.0,  // Full coverage for total eclipse\r\n                color: 'rgba(0, 0, 0, 1.0)',  // Pure black shadow\r\n                progression: 'center'\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nexport default SHAPE_DEFINITIONS;","/**\r\n * ArrayPool - Reusable array pool to reduce garbage collection\r\n * @module ArrayPool\r\n */\r\n\r\nclass ArrayPool {\r\n    constructor() {\r\n        this.pools = new Map(); // Key: size, Value: array of available arrays\r\n        this.inUse = new Set(); // Track arrays currently in use\r\n    }\r\n\r\n    /**\r\n     * Get an array from the pool or create a new one\r\n     * @param {number} size - Size of array needed\r\n     * @param {string} type - Type of array ('float32', 'array', 'uint8')\r\n     * @returns {Array|Float32Array|Uint8Array}\r\n     */\r\n    acquire(size, type = 'array') {\r\n        const key = `${type}_${size}`;\r\n        \r\n        if (!this.pools.has(key)) {\r\n            this.pools.set(key, []);\r\n        }\r\n        \r\n        const pool = this.pools.get(key);\r\n        \r\n        // Try to get from pool\r\n        if (pool.length > 0) {\r\n            const array = pool.pop();\r\n            this.inUse.add(array);\r\n            return array;\r\n        }\r\n        \r\n        // Create new array if pool is empty\r\n        let newArray;\r\n        switch (type) {\r\n            case 'float32':\r\n                newArray = new Float32Array(size);\r\n                break;\r\n            case 'uint8':\r\n                newArray = new Uint8Array(size);\r\n                break;\r\n            default:\r\n                newArray = new Array(size).fill(0);\r\n        }\r\n        \r\n        this.inUse.add(newArray);\r\n        return newArray;\r\n    }\r\n\r\n    /**\r\n     * Return an array to the pool\r\n     * @param {Array|Float32Array|Uint8Array} array - Array to return\r\n     */\r\n    release(array) {\r\n        if (!this.inUse.has(array)) {\r\n            return; // Not from this pool\r\n        }\r\n        \r\n        this.inUse.delete(array);\r\n        \r\n        // Determine type and size\r\n        let type = 'array';\r\n        if (array instanceof Float32Array) type = 'float32';\r\n        else if (array instanceof Uint8Array) type = 'uint8';\r\n        \r\n        const size = array.length;\r\n        const key = `${type}_${size}`;\r\n        \r\n        // Clear the array\r\n        if (type === 'array') {\r\n            array.fill(0);\r\n        } else {\r\n            array.fill(0);\r\n        }\r\n        \r\n        // Return to pool\r\n        if (!this.pools.has(key)) {\r\n            this.pools.set(key, []);\r\n        }\r\n        \r\n        const pool = this.pools.get(key);\r\n        if (pool.length < 10) { // Keep max 10 arrays of each size\r\n            pool.push(array);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all pools\r\n     */\r\n    clear() {\r\n        this.pools.clear();\r\n        this.inUse.clear();\r\n    }\r\n}\r\n\r\n// Create singleton instance\r\nconst arrayPool = new ArrayPool();\r\n\r\nexport default arrayPool;","/**\r\n * AudioDeformer - Handles audio-based shape deformation\r\n * @module core/morpher/AudioDeformer\r\n */\r\n\r\nexport class AudioDeformer {\r\n    constructor(morpher) {\r\n        this.morpher = morpher;\r\n        \r\n        // Audio deformation state\r\n        this.audioDeformation = 0;\r\n        this.vocalEnergy = 0;\r\n        this.vocalEffectActive = false;\r\n        this.beatGlitchIntensity = 0;\r\n        this.glitchPoints = [];\r\n        \r\n        // Frequency analysis\r\n        this.bassEnergy = 0;\r\n        this.vocalPresence = 0;\r\n        this.highFreqEnergy = 0;\r\n        \r\n        // Transient detection\r\n        this.transientActive = false;\r\n        this.transientStrength = 0;\r\n        this.transientDecay = 0.92;\r\n        this.transientHoldTime = 8;\r\n        this.transientHoldCounter = 0;\r\n    }\r\n\r\n    /**\r\n     * Apply audio deformation to shape points\r\n     * @param {Array} points - Shape points to deform\r\n     * @returns {Array} Deformed points\r\n     */\r\n    applyAudioDeformation(points) {\r\n        // Validate points\r\n        if (!points || points.length === 0) {\r\n            return this.morpher.generateFallbackCircle();\r\n        }\r\n        \r\n        // Get fresh frequency data if analyzer is available\r\n        if (this.morpher.audioAnalyzer && this.morpher.audioAnalyzer.currentFrequencies && this.morpher.audioAnalyzer.currentFrequencies.length > 0) {\r\n            this.morpher.frequencyData = [...this.morpher.audioAnalyzer.currentFrequencies];\r\n            \r\n            \r\n            // We have 32 frequency bands (0-31) that cover the full spectrum\r\n            // Approximate mapping: each band covers ~750 Hz (24000 Hz / 32 bands)\r\n            // Band 0-1: Sub-bass\r\n            // Band 2-4: Bass\r\n            // Band 5-15: Midrange\r\n            // Band 16-25: Upper mids/presence\r\n            // Band 26-31: Treble\r\n            \r\n            // BASS THUMP DETECTION: Only trigger on meaty kicks\r\n            let currentBassEnergy = 0;\r\n            let bassCount = 0;\r\n            \r\n            // Focus on low bass (bands 0-2) for the real thumps\r\n            for (let i = 0; i <= 2 && i < this.morpher.frequencyData.length; i++) {\r\n                currentBassEnergy += this.morpher.frequencyData[i];\r\n                bassCount++;\r\n            }\r\n            if (bassCount > 0) {\r\n                currentBassEnergy /= bassCount;\r\n            }\r\n            \r\n            // Initialize bass thump detection\r\n            if (!this.morpher.bassPeakHistory) {\r\n                this.morpher.bassPeakHistory = [];\r\n                this.morpher.bassThumpTimer = 0;\r\n            }\r\n            \r\n            // Track recent bass peaks\r\n            this.morpher.bassPeakHistory.push(currentBassEnergy);\r\n            if (this.morpher.bassPeakHistory.length > 20) { // ~0.6 seconds of history\r\n                this.morpher.bassPeakHistory.shift();\r\n            }\r\n            \r\n            // Calculate dynamic threshold\r\n            const avgBass = this.morpher.bassPeakHistory.reduce((a, b) => a + b, 0) / this.morpher.bassPeakHistory.length;\r\n            const maxBass = Math.max(...this.morpher.bassPeakHistory);\r\n            \r\n            // THUMP = small increase above baseline\r\n            // Check if we're using microphone (lower levels) or audio file (higher levels)\r\n            const isMicrophoneMode = this.morpher.audioAnalyzer && this.morpher.audioAnalyzer.microphoneStream;\r\n            const minThreshold = isMicrophoneMode ? 0.15 : 0.25; // Lower threshold for both, but mic is lowest\r\n            \r\n            const isThump = currentBassEnergy > avgBass * 1.08 && // Just 8% above average\r\n                           currentBassEnergy > minThreshold;\r\n            \r\n            if (isThump) {\r\n                // Boost the effect more for microphone input\r\n                const effectMultiplier = isMicrophoneMode ? 8 : 6; // Increase audio multiplier too\r\n                this.bassEnergy = Math.min(1.0, (currentBassEnergy - avgBass) * effectMultiplier);\r\n                this.morpher.bassThumpTimer = 12; // Shorter hold (12 frames ~0.4 seconds)\r\n            } else if (this.morpher.bassThumpTimer > 0) {\r\n                this.morpher.bassThumpTimer--;\r\n                this.bassEnergy *= 0.9; // Slower decay for smooth wobble\r\n            } else {\r\n                this.bassEnergy = 0;\r\n            }\r\n            \r\n            // VOCAL PRESENCE DETECTION: 2-4 kHz range where vocals cut through\r\n            // With FFT 2048 and 48kHz sample rate:\r\n            // - 1024 bins cover 0-24kHz\r\n            // - Each bin = ~23.4 Hz\r\n            // - 32 bands get 32 bins each (1024/32)\r\n            // - Each band = ~750 Hz\r\n            \r\n            // Band mapping (LINEAR):\r\n            // Band 2: 1500-2250 Hz\r\n            // Band 3: 2250-3000 Hz  } Vocal presence range\r\n            // Band 4: 3000-3750 Hz\r\n            // Band 5: 3750-4500 Hz\r\n            \r\n            let vocalPresenceEnergy = 0;\r\n            let vocalBandCount = 0;\r\n            \r\n            // SPECTRAL FLUX: Detect onsets in the VOCAL RANGE you identified (bands 4-15, emphasis on 11)\r\n            // This targets the actual vocal/lead frequencies in Electric Glow\r\n            \r\n            // Initialize spectral history if needed\r\n            if (!this.morpher.spectralHistory) {\r\n                this.morpher.spectralHistory = [];\r\n                this.morpher.spectralFluxHistory = [];\r\n                // Music detection initialization\r\n                this.morpher.onsetThreshold = 0;\r\n                this.morpher.musicDetector.reset();\r\n                this.morpher.detectedBPM = 0;\r\n                \r\n                // Time signature detection\r\n                this.morpher.onsetStrengths = []; // Array of {time: ms, strength: 0-1, bassWeight: 0-1}\r\n                this.morpher.detectedTimeSignature = null;\r\n                this.morpher.timeSignatureConfidence = 0;\r\n                this.morpher.measureStartTime = 0;\r\n                this.morpher.timeSignatureHistory = [];\r\n                this.morpher.timeSignatureLocked = false;\r\n            }\r\n            \r\n            // Store current spectrum\r\n            const currentSpectrum = [...this.morpher.frequencyData];\r\n            \r\n            // SIMPLER APPROACH: Look for changes in vocal bands with bass rejection\r\n            let spectralFlux = 0;\r\n            let bassFlux = 0;\r\n            \r\n            if (this.morpher.spectralHistory.length > 0) {\r\n                const prevSpectrum = this.morpher.spectralHistory[this.morpher.spectralHistory.length - 1];\r\n                \r\n                // Calculate bass flux (bands 0-2)\r\n                for (let i = 0; i <= 2 && i < currentSpectrum.length; i++) {\r\n                    const diff = currentSpectrum[i] - prevSpectrum[i];\r\n                    if (diff > 0) bassFlux += diff;\r\n                }\r\n                \r\n                // Calculate flux in extended vocal range (bands 4-15)\r\n                // But weight the center (9-13) more heavily\r\n                for (let i = 4; i <= 15 && i < currentSpectrum.length; i++) {\r\n                    const diff = currentSpectrum[i] - prevSpectrum[i];\r\n                    if (diff > 0) {\r\n                        // Extra weight for bands 9-13\r\n                        const weight = (i >= 9 && i <= 13) ? 2.0 : 1.0;\r\n                        spectralFlux += diff * weight;\r\n                    }\r\n                }\r\n                \r\n                // Suppress if there's a strong bass hit (likely a drum)\r\n                if (bassFlux > 0.15) {\r\n                    spectralFlux *= 0.3; // Reduce by 70% for drum hits\r\n                }\r\n            }\r\n            \r\n            // Store history (keep last 30 frames for ~1 second at 30fps)\r\n            this.morpher.spectralHistory.push(currentSpectrum);\r\n            if (this.morpher.spectralHistory.length > 30) {\r\n                this.morpher.spectralHistory.shift();\r\n            }\r\n            \r\n            // Store flux history for adaptive thresholding\r\n            this.morpher.spectralFluxHistory.push(spectralFlux);\r\n            if (this.morpher.spectralFluxHistory.length > 30) {\r\n                this.morpher.spectralFluxHistory.shift();\r\n            }\r\n            \r\n            // Calculate adaptive threshold (median + margin)\r\n            if (this.morpher.spectralFluxHistory.length >= 10) {\r\n                const sorted = [...this.morpher.spectralFluxHistory].sort((a, b) => a - b);\r\n                const median = sorted[Math.floor(sorted.length / 2)];\r\n                const mean = sorted.reduce((a, b) => a + b, 0) / sorted.length;\r\n                \r\n                // Threshold is slightly above the median to catch significant onsets\r\n                this.morpher.onsetThreshold = median + (mean - median) * 0.5;\r\n            }\r\n            \r\n            // Detect onset (transient/attack) - focus on stronger transients for BPM\r\n            // Use higher threshold for BPM detection vs vocal detection\r\n            const isVocalOnset = spectralFlux > this.morpher.onsetThreshold * 1.2 && spectralFlux > 0.02;\r\n            const isBeatOnset = spectralFlux > this.morpher.onsetThreshold * 2.0 && spectralFlux > 0.05; // Stronger threshold for beats\r\n            \r\n            // Smooth the detection with a short hold time\r\n            if (isVocalOnset) {\r\n                this.transientHoldTime = 8; // Hold for 8 frames (~250ms) for visible glitches\r\n                this.morpher.vocalGlowBoost = 0.3; // Add 30% glow boost on vocal onset\r\n            }\r\n            \r\n            // BPM DETECTION: Only track stronger onsets that are likely beats\r\n            if (isBeatOnset) {\r\n                const now = performance.now();\r\n                \r\n                // Store onset strength for time signature detection\r\n                const onsetStrength = {\r\n                    time: now,\r\n                    strength: spectralFlux / (this.morpher.onsetThreshold || 1), // Normalized strength\r\n                    bassWeight: bassFlux // Keep bass weight for downbeat detection\r\n                };\r\n                this.morpher.onsetStrengths.push(onsetStrength);\r\n                // Keep last 40 onsets (about 16-20 beats)\r\n                if (this.morpher.onsetStrengths.length > 40) {\r\n                    this.morpher.onsetStrengths.shift();\r\n                }\r\n                \r\n                // Delegate onset tracking to music detector\r\n                this.morpher.musicDetector.addOnset(now, spectralFlux);\r\n                \r\n            }\r\n            \r\n            // Update BPM detection through music detector\r\n            this.morpher.musicDetector.update(performance.now());\r\n            this.morpher.detectedBPM = this.morpher.musicDetector.detectedBPM;\r\n            this.morpher.bpmConfidence = this.morpher.musicDetector.bpmConfidence;\r\n            \r\n            // Update local references for compatibility\r\n            if (this.morpher.detectedBPM > 0 && this.morpher.bpmConfidence > 0.8) {\r\n                // Clear fast mode once we've detected BPM with confidence\r\n                if (this.morpher.forceFastDetection) {\r\n                    this.morpher.forceFastDetection = false;\r\n                }\r\n            }\r\n            \r\n            if (this.transientHoldTime > 0) {\r\n                this.transientHoldTime--;\r\n            }\r\n            \r\n            // Decay glow boost smoothly\r\n            if (this.morpher.vocalGlowBoost > 0) {\r\n                this.morpher.vocalGlowBoost *= 0.92; // Smooth decay\r\n            }\r\n            \r\n            // Set vocal presence based on flux intensity\r\n            this.vocalPresence = spectralFlux;\r\n            \r\n            // No spectral contrast needed\r\n            const spectralContrast = 0;\r\n            \r\n            // Update rolling averages for smarter detection\r\n            this.morpher.bassHistory[this.morpher.historyIndex] = this.bassEnergy;\r\n            this.morpher.vocalHistory[this.morpher.historyIndex] = this.vocalPresence;\r\n            this.morpher.historyIndex = (this.morpher.historyIndex + 1) % this.morpher.bassHistory.length;\r\n            \r\n            // Calculate averages\r\n            const bassAvg = this.morpher.bassHistory.reduce((a, b) => a + b, 0) / this.morpher.bassHistory.length;\r\n            const vocalAvg = this.morpher.vocalHistory.reduce((a, b) => a + b, 0) / this.morpher.vocalHistory.length;\r\n            \r\n            // Bass effect is now controlled by thump detection above\r\n            this.morpher.bassEffectActive = this.morpher.bassThumpTimer > 0;\r\n            \r\n            // ENHANCED VOCAL DETECTION\r\n            // Vocals are present when:\r\n            // 1. Bands 9-13 have high contrast vs background\r\n            // 2. Energy is above minimum threshold\r\n            // 3. Either sudden spike OR sustained presence\r\n            \r\n            this.morpher.lastVocalPresence = this.morpher.lastVocalPresence || 0;\r\n            const vocalDelta = this.vocalPresence - this.morpher.lastVocalPresence;\r\n            this.morpher.lastVocalPresence = this.vocalPresence;\r\n            \r\n            // Transient detection - triggers on musical onsets\r\n            this.vocalEffectActive = this.transientHoldTime > 0;\r\n            \r\n        }\r\n        \r\n        // If no analyzer or no frequency data, fallback to using audioDeformation for effects\r\n        // This is especially important for microphone input where bass frequencies might be weak\r\n        const hasFrequencyData = this.morpher.frequencyData && this.morpher.frequencyData.some(f => f > 0.01);\r\n        if (!this.morpher.audioAnalyzer || !hasFrequencyData) {\r\n            // Enhanced fallback for microphone input\r\n            // Use audioDeformation as a proxy for bass effect when no frequency data\r\n            if (this.audioDeformation > 0.15) { // Lower threshold for mic sensitivity\r\n                this.morpher.bassEffectActive = true;\r\n                this.bassEnergy = Math.min(1.0, this.audioDeformation * 0.8); // Stronger response\r\n                \r\n                // Simulate bass thump timer for wobble effect\r\n                if (!this.morpher.bassThumpTimer || this.morpher.bassThumpTimer <= 0) {\r\n                    this.morpher.bassThumpTimer = 12; // Start wobble\r\n                }\r\n            } else if (this.morpher.bassThumpTimer > 0) {\r\n                // Decay the wobble\r\n                this.morpher.bassThumpTimer--;\r\n                this.bassEnergy *= 0.9;\r\n            }\r\n            \r\n            // Use vocalEnergy for vocal effects\r\n            if (this.vocalEnergy > 0.2) { // Lower threshold for mic\r\n                this.vocalEffectActive = true;\r\n                this.vocalPresence = this.vocalEnergy;\r\n            }\r\n        }\r\n        \r\n        // ONLY apply fallback bass wobble for microphone input when no frequency data\r\n        // This ensures wobble works for mic but NOT for web audio\r\n        if (!hasFrequencyData && this.audioDeformation > 0.15 && !this.morpher.bassEffectActive) {\r\n            this.morpher.bassEffectActive = true;\r\n            this.bassEnergy = Math.max(this.bassEnergy, this.audioDeformation * 0.8);\r\n            if (!this.morpher.bassThumpTimer || this.morpher.bassThumpTimer <= 0) {\r\n                this.morpher.bassThumpTimer = 12;\r\n            }\r\n        }\r\n        \r\n        // No deformation if no audio\r\n        const hasAudio = this.audioDeformation !== 0 || this.bassEnergy > 0.01 || \r\n                        this.vocalPresence > 0.01;\r\n        if (!hasAudio) {\r\n            return points;\r\n        }\r\n        \r\n        const deformed = [];\r\n        const center = { x: 0.5, y: 0.5 };\r\n        const time = Date.now() / 1000; // Time in seconds\r\n        \r\n        // Update undulation phase only when bass is active\r\n        if (this.morpher.bassEffectActive) {\r\n            // Randomly change direction occasionally\r\n            if (Math.random() < 0.05) { // 5% chance per frame\r\n                this.morpher.undulationDirection *= -1; // Reverse direction\r\n            }\r\n            this.morpher.undulationPhase += 0.08 * this.morpher.undulationDirection; // Apply direction\r\n        }\r\n        \r\n        // Update glitch points on beat\r\n        if (this.morpher.audioAnalyzer && this.beatGlitchIntensity > 0) {\r\n            this.beatGlitchIntensity *= 0.9; // Decay glitch intensity\r\n        }\r\n        \r\n        // Create SUBTLE glitch points when vocal presence is detected\r\n        if (this.vocalEffectActive && Math.random() < 0.2) { // 20% chance (reduced)\r\n            this.glitchPoints = [];\r\n            const numGlitches = 2 + Math.floor(Math.random() * 2); // 2-3 points (fewer)\r\n            for (let i = 0; i < numGlitches; i++) {\r\n                this.glitchPoints.push({\r\n                    index: Math.floor(Math.random() * points.length),\r\n                    intensity: 0.02 + Math.random() * 0.03, // 0.02-0.05 intensity (much subtler)\r\n                    decay: 0.94 + Math.random() * 0.02 // Slightly slower decay for smoothness\r\n                });\r\n            }\r\n        }\r\n        \r\n        // Update existing glitch points\r\n        this.glitchPoints = this.glitchPoints.filter(g => {\r\n            g.intensity *= g.decay;\r\n            return g.intensity > 0.01;\r\n        });\r\n        \r\n        for (let i = 0; i < points.length; i++) {\r\n            const point = points[i];\r\n            \r\n            // Handle invalid point\r\n            if (!point || typeof point.x === 'undefined' || typeof point.y === 'undefined') {\r\n                const angle = (i / points.length) * Math.PI * 2;\r\n                deformed.push({\r\n                    x: 0.5 + Math.cos(angle) * 0.5,\r\n                    y: 0.5 + Math.sin(angle) * 0.5\r\n                });\r\n                continue;\r\n            }\r\n            \r\n            // Calculate base position\r\n            const dx = point.x - center.x;\r\n            const dy = point.y - center.y;\r\n            const distance = Math.sqrt(dx * dx + dy * dy);\r\n            const angle = Math.atan2(dy, dx);\r\n            \r\n            // 1. Base expansion from overall amplitude - always active for responsiveness\r\n            const baseExpansion = Math.abs(this.audioDeformation) * 0.12; // Reduced to 12%\r\n            \r\n            // 2. Bass-triggered wiggle effect\r\n            let undulation = 0;\r\n            let breathPulse = 0;\r\n            \r\n            if (this.morpher.bassEffectActive) {\r\n                // Strong bass-driven undulation\r\n                const waveCount = 2; // 2 waves for clean look\r\n                const wiggleIntensity = this.bassEnergy * 0.25; // Increased from 0.15 to 0.25\r\n                undulation = Math.sin(angle * waveCount + this.morpher.undulationPhase) * wiggleIntensity;\r\n                \r\n                // Subtle breathing pulse synced with undulation\r\n                breathPulse = Math.sin(this.morpher.undulationPhase * 0.5) * this.bassEnergy * 0.08; // Increased from 0.05\r\n            }\r\n            \r\n            // 5. Check for glitch points - SUBTLE shimmer/ripple effect\r\n            let glitchOffset = 0;\r\n            const glitchPoint = this.glitchPoints.find(g => g.index === i);\r\n            if (glitchPoint) {\r\n                // Create a subtle ripple/shimmer instead of harsh glitch\r\n                const shimmerTime = Date.now() * 0.015; // Slower oscillation\r\n                const shimmer = Math.sin(shimmerTime + i * 0.5) * Math.cos(shimmerTime * 0.7);\r\n                glitchOffset = glitchPoint.intensity * shimmer * 0.5; // Can go in or out, very subtle\r\n            }\r\n            \r\n            // Combine all deformations - simpler, more selective\r\n            const totalDeformation = 1 + baseExpansion + undulation + breathPulse + glitchOffset;\r\n            \r\n            const newDistance = distance * Math.max(0.8, totalDeformation); // Never shrink below 80%\r\n            \r\n            deformed.push({\r\n                x: center.x + Math.cos(angle) * newDistance,\r\n                y: center.y + Math.sin(angle) * newDistance\r\n            });\r\n        }\r\n        \r\n        return deformed;\r\n    }\r\n\r\n    /**\r\n     * Set audio deformation value\r\n     * @param {number} value - Deformation value (0-1)\r\n     */\r\n    setAudioDeformation(value) {\r\n        this.audioDeformation = Math.max(0, Math.min(1, value));\r\n        this.vocalEffectActive = value > 0.01;\r\n    }\r\n\r\n    /**\r\n     * Set vocal energy for shape pulsing\r\n     * @param {number} value - Energy value (0-1)\r\n     */\r\n    setVocalEnergy(value) {\r\n        this.vocalEnergy = Math.max(0, Math.min(1, value));\r\n        this.vocalEffectActive = value > 0.01;\r\n    }\r\n\r\n    /**\r\n     * Update frequency band energies\r\n     * @param {Object} frequencyData - Frequency analysis data\r\n     */\r\n    updateFrequencyBands(frequencyData) {\r\n        if (frequencyData) {\r\n            this.bassEnergy = frequencyData.bass || 0;\r\n            this.vocalPresence = frequencyData.vocal || 0;\r\n            this.highFreqEnergy = frequencyData.high || 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Process transient/beat detection\r\n     * @param {number} amplitude - Current audio amplitude\r\n     * @param {number} threshold - Beat threshold\r\n     */\r\n    processTransient(amplitude, threshold) {\r\n        if (amplitude > threshold) {\r\n            this.transientActive = true;\r\n            this.transientStrength = amplitude;\r\n            this.transientHoldCounter = this.transientHoldTime;\r\n        } else if (this.transientHoldCounter > 0) {\r\n            this.transientHoldCounter--;\r\n        } else {\r\n            this.transientStrength *= this.transientDecay;\r\n            if (this.transientStrength < 0.01) {\r\n                this.transientActive = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current deformation state\r\n     */\r\n    getState() {\r\n        return {\r\n            audioDeformation: this.audioDeformation,\r\n            vocalEnergy: this.vocalEnergy,\r\n            vocalEffectActive: this.vocalEffectActive,\r\n            beatGlitchIntensity: this.beatGlitchIntensity,\r\n            transientActive: this.transientActive,\r\n            transientStrength: this.transientStrength\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Reset all audio effects\r\n     */\r\n    reset() {\r\n        this.audioDeformation = 0;\r\n        this.vocalEnergy = 0;\r\n        this.vocalEffectActive = false;\r\n        this.beatGlitchIntensity = 0;\r\n        this.glitchPoints = [];\r\n        this.transientActive = false;\r\n        this.transientStrength = 0;\r\n    }\r\n}\r\n\r\nexport default AudioDeformer;","/**\r\n * AgentBPMDetector - Fast, agent-based BPM detection\r\n * Uses multiple competing hypotheses that converge on the true tempo\r\n * @module core/morpher/AgentBPMDetector\r\n */\r\n\r\nexport class AgentBPMDetector {\r\n    constructor() {\r\n        // Agent pool\r\n        this.agents = [];\r\n        this.maxAgents = 8;\r\n\r\n        // Detection state\r\n        this.isActive = false;\r\n        this.confidence = 0;\r\n        this.lockedBPM = 0;\r\n        this.lastBeatTime = 0;\r\n\r\n        // Audio analysis\r\n        this.peakHistory = [];\r\n        this.maxHistoryLength = 100; // ~3 seconds at 30fps\r\n\r\n        // Configuration\r\n        this.minBPM = 40;\r\n        this.maxBPM = 300;\r\n        this.convergenceThreshold = 0.7; // Lower threshold for faster lock\r\n        this.subdivisionPreference = {\r\n            slow: { min: 40, max: 80, prefer: 1 },     // Keep normal for slow (40-80 is already slow)\r\n            normal: { min: 80, max: 140, prefer: 1 },  // Normal for mid\r\n            fast: { min: 140, max: 180, prefer: 0.5 }, // Half for moderately fast\r\n            veryfast: { min: 180, max: 300, prefer: 0.5 } // Half for very fast\r\n        };\r\n    }\r\n\r\n    /**\r\n     * BPM Agent - represents one tempo hypothesis\r\n     */\r\n    createAgent(bpm, subdivision = 1) {\r\n        return {\r\n            bpm: bpm,\r\n            subdivision: subdivision,\r\n            effectiveBPM: bpm * subdivision,\r\n            phase: 0,\r\n            confidence: 0.5,\r\n            hits: 0,\r\n            misses: 0,\r\n            lastBeatTime: performance.now(),\r\n            beatInterval: 60000 / (bpm * subdivision)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Initialize agents with diverse starting hypotheses\r\n     */\r\n    initializeAgents(initialGuess = 120) {\r\n        this.agents = [];\r\n\r\n        // Prefer lower subdivisions - if initial guess is high, try halving it\r\n        let subdivisions = [1]; // Start with normal\r\n\r\n        if (initialGuess > 180) {\r\n            // Very fast - prefer half speed\r\n            subdivisions = [0.5, 0.75, 1];\r\n        } else if (initialGuess > 140) {\r\n            // Fast - try half and normal\r\n            subdivisions = [0.5, 0.75, 1];\r\n        } else if (initialGuess < 60) {\r\n            // Very slow - try doubling\r\n            subdivisions = [1, 1.5, 2];\r\n        } else {\r\n            // Normal range - try various\r\n            subdivisions = [0.5, 1, 1.5];\r\n        }\r\n\r\n        subdivisions.forEach(sub => {\r\n            const agent = this.createAgent(initialGuess, sub);\r\n            // Give preference to lower effective BPMs\r\n            if (initialGuess * sub < 140) {\r\n                agent.confidence = 0.6; // Slight boost for sensible BPMs\r\n            }\r\n            this.agents.push(agent);\r\n        });\r\n\r\n        // Add some agents that try to find a lower BPM if initial is high\r\n        if (initialGuess > 140) {\r\n            this.agents.push(this.createAgent(initialGuess / 2, 1));\r\n            this.agents.push(this.createAgent(initialGuess / 2, 1.5));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Process new audio peak/onset\r\n     */\r\n    processPeak(strength, time = performance.now()) {\r\n        // Add to history\r\n        this.peakHistory.push({ strength, time });\r\n        if (this.peakHistory.length > this.maxHistoryLength) {\r\n            this.peakHistory.shift();\r\n        }\r\n\r\n        // Only process if we have enough history\r\n        if (this.peakHistory.length < 4) return;\r\n\r\n        // If not active, initialize from FFT guess\r\n        if (!this.isActive || this.agents.length === 0) {\r\n            const fftGuess = this.getFFTEstimate();\r\n            this.initializeAgents(fftGuess);\r\n            this.isActive = true;\r\n        }\r\n\r\n        // If already locked, be more conservative about changes\r\n        if (this.lockedBPM > 0 && this.confidence > 0.7) {\r\n            // Only update agents, don't evolve as aggressively\r\n            this.agents.forEach(agent => {\r\n                this.scoreAgent(agent, time, strength);\r\n            });\r\n\r\n            // Only evolve if confidence has dropped significantly\r\n            if (this.confidence < 0.6) {\r\n                this.evolveAgents();\r\n                this.checkConvergence();\r\n            }\r\n        } else {\r\n            // Not locked yet, be aggressive\r\n            // Score each agent against the peak\r\n            this.agents.forEach(agent => {\r\n                this.scoreAgent(agent, time, strength);\r\n            });\r\n\r\n            // Evolution step\r\n            this.evolveAgents();\r\n\r\n            // Check for convergence\r\n            this.checkConvergence();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Score agent based on how well it predicts this peak\r\n     */\r\n    scoreAgent(agent, peakTime, peakStrength) {\r\n        const timeSinceLastBeat = peakTime - agent.lastBeatTime;\r\n        const expectedNextBeat = agent.beatInterval;\r\n\r\n        // Calculate phase alignment (0-1, where 1 is perfect)\r\n        const phaseDiff = Math.abs((timeSinceLastBeat % expectedNextBeat) / expectedNextBeat - 0.5) * 2;\r\n        const alignment = 1 - phaseDiff;\r\n\r\n        // Strong peaks matter more\r\n        const weightedAlignment = alignment * peakStrength;\r\n\r\n        // Update agent stats (more aggressive confidence building)\r\n        if (alignment > 0.7) { // Lower threshold\r\n            agent.hits++;\r\n            agent.confidence = Math.min(1, agent.confidence + 0.1); // Faster increase\r\n\r\n            // Update phase if we're close\r\n            if (alignment > 0.85) {\r\n                agent.lastBeatTime = peakTime;\r\n            }\r\n        } else if (alignment < 0.3) {\r\n            agent.misses++;\r\n            agent.confidence = Math.max(0, agent.confidence - 0.03);\r\n        }\r\n\r\n        // Decay confidence slowly for inactive agents\r\n        agent.confidence *= 0.998; // Slower decay\r\n    }\r\n\r\n    /**\r\n     * Evolve agents - kill weak ones, spawn variations of strong ones\r\n     */\r\n    evolveAgents() {\r\n        // Sort by confidence\r\n        this.agents.sort((a, b) => b.confidence - a.confidence);\r\n\r\n        // Kill weakest if we have too many\r\n        if (this.agents.length > this.maxAgents) {\r\n            this.agents = this.agents.slice(0, this.maxAgents);\r\n        }\r\n\r\n        // If top agent is very confident, spawn slight variations\r\n        const bestAgent = this.agents[0];\r\n        if (bestAgent.confidence > 0.7 && this.agents.length < this.maxAgents) {\r\n            // Try slight BPM variations\r\n            const variation = 1 + (Math.random() - 0.5) * 0.02; // ±1%\r\n            const newAgent = this.createAgent(\r\n                bestAgent.bpm * variation,\r\n                bestAgent.subdivision\r\n            );\r\n            newAgent.confidence = bestAgent.confidence * 0.8;\r\n            this.agents.push(newAgent);\r\n        }\r\n\r\n        // Kill agents with very low confidence\r\n        this.agents = this.agents.filter(a => a.confidence > 0.1);\r\n    }\r\n\r\n    /**\r\n     * Check if agents have converged on a tempo\r\n     */\r\n    checkConvergence() {\r\n        if (this.agents.length === 0) return;\r\n\r\n        const bestAgent = this.agents[0];\r\n\r\n        // Need high confidence and clear winner\r\n        if (bestAgent.confidence > this.convergenceThreshold) {\r\n            // Check if other top agents agree (within 5% for faster convergence)\r\n            const similarAgents = this.agents.filter(a =>\r\n                Math.abs(a.effectiveBPM - bestAgent.effectiveBPM) / bestAgent.effectiveBPM < 0.05\r\n            );\r\n\r\n            // Only need 2 agents to agree for faster lock\r\n            if (similarAgents.length >= Math.min(2, this.agents.length * 0.3)) {\r\n                // We have convergence!\r\n                this.lockedBPM = Math.round(bestAgent.bpm);\r\n                this.confidence = bestAgent.confidence;\r\n\r\n                // Auto-select best subdivision\r\n                this.autoSelectSubdivision();\r\n\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Auto-select subdivision based on BPM range\r\n     */\r\n    autoSelectSubdivision() {\r\n        for (const [range, config] of Object.entries(this.subdivisionPreference)) {\r\n            if (this.lockedBPM >= config.min && this.lockedBPM < config.max) {\r\n                // Find agent with preferred subdivision\r\n                const preferredAgent = this.agents.find(a =>\r\n                    Math.abs(a.bpm - this.lockedBPM) < 2 &&\r\n                    Math.abs(a.subdivision - config.prefer) < 0.1\r\n                );\r\n\r\n                if (preferredAgent) {\r\n                    return config.prefer;\r\n                }\r\n            }\r\n        }\r\n        return 1; // Default\r\n    }\r\n\r\n    /**\r\n     * Get rough BPM estimate from FFT (frequency domain)\r\n     */\r\n    getFFTEstimate() {\r\n        if (this.peakHistory.length < 4) return 120; // Default\r\n\r\n        // Calculate intervals between recent peaks\r\n        const recentPeaks = this.peakHistory.slice(-10);\r\n        const intervals = [];\r\n\r\n        for (let i = 1; i < recentPeaks.length; i++) {\r\n            intervals.push(recentPeaks[i].time - recentPeaks[i-1].time);\r\n        }\r\n\r\n        if (intervals.length === 0) return 120;\r\n\r\n        // Find most common interval (mode)\r\n        intervals.sort((a, b) => a - b);\r\n        const median = intervals[Math.floor(intervals.length / 2)];\r\n\r\n        // Convert to BPM\r\n        let estimatedBPM = 60000 / median;\r\n\r\n        // Sanity check - if way out of range, try doubling/halving\r\n        if (estimatedBPM < this.minBPM) {\r\n            estimatedBPM *= 2;\r\n        } else if (estimatedBPM > this.maxBPM) {\r\n            estimatedBPM /= 2;\r\n        }\r\n\r\n        return Math.max(this.minBPM, Math.min(this.maxBPM, estimatedBPM));\r\n    }\r\n\r\n    /**\r\n     * Force reset detection with new seed\r\n     */\r\n    reset(seedBPM = null) {\r\n        this.agents = [];\r\n        this.confidence = 0;\r\n        this.lockedBPM = 0;\r\n        this.peakHistory = [];\r\n\r\n        if (seedBPM) {\r\n            this.initializeAgents(seedBPM);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current best BPM estimate\r\n     */\r\n    getBPM() {\r\n        if (this.lockedBPM > 0 && this.confidence > 0.8) {\r\n            return this.lockedBPM;\r\n        }\r\n\r\n        if (this.agents.length > 0) {\r\n            return Math.round(this.agents[0].bpm);\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Get recommended subdivision\r\n     */\r\n    getSubdivision() {\r\n        if (this.agents.length > 0) {\r\n            const bestAgent = this.agents[0];\r\n\r\n            // Check BPM range preferences\r\n            const bpm = bestAgent.bpm;\r\n            for (const [range, config] of Object.entries(this.subdivisionPreference)) {\r\n                if (bpm >= config.min && bpm < config.max) {\r\n                    return config.prefer;\r\n                }\r\n            }\r\n\r\n            return bestAgent.subdivision;\r\n        }\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * Get detection status\r\n     */\r\n    getStatus() {\r\n        return {\r\n            bpm: this.getBPM(),\r\n            subdivision: this.getSubdivision(),\r\n            confidence: this.confidence,\r\n            locked: this.lockedBPM > 0 && this.confidence > 0.8,\r\n            agentCount: this.agents.length,\r\n            topAgents: this.agents.slice(0, 3).map(a => ({\r\n                bpm: Math.round(a.bpm),\r\n                subdivision: a.subdivision,\r\n                confidence: a.confidence.toFixed(2)\r\n            }))\r\n        };\r\n    }\r\n}","/**\r\n * MusicDetector - Handles BPM and time signature detection\r\n * @module core/morpher/MusicDetector\r\n */\r\n\r\nimport { AgentBPMDetector } from './AgentBPMDetector.js';\r\n\r\nexport class MusicDetector {\r\n    constructor() {\r\n        // Beat detection state\r\n        this.onsetIntervals = [];\r\n        this.onsetStrengths = [];\r\n        this.lastOnsetTime = 0;\r\n        this.onsetThreshold = 0.3;\r\n\r\n        // BPM detection\r\n        this.detectedBPM = 0;\r\n        this.bpmConfidence = 0;\r\n        this.lastBPMCalculation = 0;\r\n        this.bpmCalculationInterval = 2000; // Recalculate every 2 seconds\r\n\r\n        // BPM tracking\r\n        this.bpmHistory = [];\r\n        this.tempoLocked = false;\r\n        this.fundamentalBPM = 0;\r\n\r\n        // Agent-based detector for fast convergence\r\n        this.agentDetector = new AgentBPMDetector();\r\n        this.useAgentDetection = true; // Flag to enable/disable\r\n\r\n        // Time signature detection\r\n        this.timeSignature = '4/4';\r\n        this.detectedTimeSignature = null;\r\n        this.timeSignatureConfidence = 0;\r\n        this.timeSignatureHistory = [];\r\n        this.timeSignatureLocked = false;\r\n        this.downbeatPhase = 0;\r\n        this.measureLength = 4;\r\n        this.measureStartTime = 0;\r\n\r\n        // Music state\r\n        this.isMusicalContent = false;\r\n        this.musicalityScore = 0;\r\n\r\n        // Fast detection mode\r\n        this.forceFastDetection = false;\r\n    }\r\n\r\n    /**\r\n     * Calculate BPM from onset intervals with improved stability\r\n     * @returns {number} Detected BPM\r\n     */\r\n    calculateBPM() {\r\n        // Try agent detector first for faster results\r\n        if (this.useAgentDetection) {\r\n            const agentStatus = this.agentDetector.getStatus();\r\n            if (agentStatus.locked && agentStatus.confidence > 0.6) { // Lower threshold\r\n                // Use agent's locked BPM\r\n                this.detectedBPM = agentStatus.bpm;\r\n                this.bpmConfidence = agentStatus.confidence;\r\n                this.tempoLocked = true;\r\n                this.fundamentalBPM = agentStatus.bpm;\r\n\r\n                // Update history\r\n                this.bpmHistory.push(this.detectedBPM);\r\n                if (this.bpmHistory.length > 10) {\r\n                    this.bpmHistory.shift();\r\n                }\r\n\r\n                return this.detectedBPM;\r\n            } else if (agentStatus.bpm > 0 && agentStatus.confidence > 0.4) { // Lower threshold\r\n                // Use agent's estimate if somewhat confident\r\n                this.detectedBPM = agentStatus.bpm;\r\n                this.bpmConfidence = agentStatus.confidence;\r\n\r\n                // Also mark as tempo locked if confidence is decent\r\n                if (agentStatus.confidence > 0.6) {\r\n                    this.tempoLocked = true;\r\n                }\r\n\r\n                return this.detectedBPM;\r\n            }\r\n        }\r\n\r\n        // Fall back to original method if agent not ready\r\n        if (this.onsetIntervals.length < 4) return this.detectedBPM;\r\n        \r\n        // Use appropriate window size based on available data\r\n        const analysisWindow = this.onsetIntervals.slice(-15);\r\n        \r\n        // Find tempo candidates using autocorrelation-like approach\r\n        const tempoCandidates = this.findTempoCandidates(analysisWindow);\r\n        if (tempoCandidates.length === 0) return this.detectedBPM;\r\n        \r\n        // Get the best tempo candidate\r\n        const bestCandidate = tempoCandidates[0];\r\n        const candidateBPM = Math.round(60000 / bestCandidate.interval);\r\n        \r\n        // If we haven't locked a tempo yet, establish the fundamental\r\n        if (!this.tempoLocked && this.bpmHistory.length > 3) {\r\n            // Check if we have consistent readings\r\n            const recentBPMs = this.bpmHistory.slice(-3);\r\n            const avgRecent = recentBPMs.reduce((a, b) => a + b, 0) / recentBPMs.length;\r\n            const variance = recentBPMs.reduce((sum, bpm) => sum + Math.pow(bpm - avgRecent, 2), 0) / recentBPMs.length;\r\n            \r\n            // Lock faster with tighter variance requirement\r\n            if (variance < 5) { // Less than ~2 BPM standard deviation - much tighter\r\n                this.fundamentalBPM = Math.round(avgRecent);\r\n                this.tempoLocked = true;\r\n                this.bpmConfidence = 1.0;\r\n            }\r\n        }\r\n        \r\n        // Check if new BPM is a harmonic of the fundamental\r\n        let finalBPM = candidateBPM;\r\n        if (this.tempoLocked) {\r\n            const harmonic = this.checkHarmonicRelation(candidateBPM, this.fundamentalBPM);\r\n            if (harmonic) {\r\n                // It's a valid harmonic, adjust to fundamental\r\n                finalBPM = this.fundamentalBPM;\r\n                this.bpmConfidence = Math.min(1.0, this.bpmConfidence + 0.1);\r\n            } else {\r\n                // Not a harmonic - check if we should update fundamental\r\n                this.bpmConfidence *= 0.9;\r\n                \r\n                // Only change if confidence is very low and new tempo is strong\r\n                if (this.bpmConfidence < 0.3 && bestCandidate.strength > 0.8) {\r\n                    this.fundamentalBPM = candidateBPM;\r\n                    this.bpmConfidence = 0.5;\r\n                } else {\r\n                    // Stick with fundamental\r\n                    finalBPM = this.fundamentalBPM;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Update history\r\n        this.bpmHistory.push(finalBPM);\r\n        if (this.bpmHistory.length > 10) {\r\n            this.bpmHistory.shift();\r\n        }\r\n        \r\n        // Apply smoothing\r\n        if (this.detectedBPM === 0) {\r\n            this.detectedBPM = finalBPM;\r\n        } else {\r\n            const maxChange = this.tempoLocked ? 1 : 2; // Reduced from 5 to 2 for stability\r\n            const diff = finalBPM - this.detectedBPM;\r\n            if (Math.abs(diff) <= maxChange) {\r\n                this.detectedBPM = finalBPM;\r\n            } else {\r\n                this.detectedBPM += Math.sign(diff) * maxChange;\r\n            }\r\n        }\r\n        \r\n        // Update rhythm engine if available\r\n        if (window.rhythmIntegration && window.rhythmIntegration.updateBPM) {\r\n            if (!window.rhythmManuallyStoppedForCurrentAudio) {\r\n                window.rhythmIntegration.updateBPM(this.detectedBPM);\r\n            }\r\n        }\r\n        \r\n        return this.detectedBPM;\r\n    }\r\n\r\n    /**\r\n     * Find tempo candidates from intervals\r\n     * @param {Array} intervals - Time intervals between onsets\r\n     * @returns {Array} Tempo candidates with confidence scores\r\n     */\r\n    findTempoCandidates(intervals) {\r\n        const candidates = [];\r\n        \r\n        // Test different interval groupings (1x, 2x, 4x) for beat patterns\r\n        for (let multiplier of [1, 2, 4]) {\r\n            const testIntervals = intervals.map(i => i * multiplier);\r\n            \r\n            // Find clusters of similar intervals\r\n            const clusters = this.clusterIntervals(testIntervals);\r\n            \r\n            for (let cluster of clusters) {\r\n                const avgInterval = cluster.intervals.reduce((a, b) => a + b, 0) / cluster.intervals.length;\r\n                const actualInterval = avgInterval / multiplier;\r\n                \r\n                // Calculate strength based on cluster size and consistency\r\n                const strength = (cluster.intervals.length / intervals.length) * cluster.consistency;\r\n                \r\n                // Only consider if it would result in reasonable BPM\r\n                const bpm = 60000 / actualInterval;\r\n                // Prefer common BPM ranges (120-140 is very common)\r\n                const commonBPMBonus = (bpm >= 120 && bpm <= 140) ? 0.2 : 0;\r\n                if (bpm >= 60 && bpm <= 220) {\r\n                    candidates.push({\r\n                        interval: actualInterval,\r\n                        strength: strength + commonBPMBonus,\r\n                        multiplier: multiplier\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Sort by strength\r\n        return candidates.sort((a, b) => b.strength - a.strength);\r\n    }\r\n\r\n    /**\r\n     * Cluster similar intervals together\r\n     * @param {Array} intervals - Time intervals\r\n     * @returns {Array} Clustered intervals\r\n     */\r\n    clusterIntervals(intervals) {\r\n        const sorted = [...intervals].sort((a, b) => a - b);\r\n        const clusters = [];\r\n        let currentCluster = [sorted[0]];\r\n        \r\n        for (let i = 1; i < sorted.length; i++) {\r\n            const tolerance = currentCluster[0] * 0.03; // 3% tolerance - tighter for stable BPM\r\n            if (sorted[i] - currentCluster[0] <= tolerance) {\r\n                currentCluster.push(sorted[i]);\r\n            } else {\r\n                if (currentCluster.length >= 2) {\r\n                    // Calculate consistency (inverse of variance)\r\n                    const avg = currentCluster.reduce((a, b) => a + b, 0) / currentCluster.length;\r\n                    const variance = currentCluster.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / currentCluster.length;\r\n                    const consistency = 1 / (1 + variance / (avg * avg)); // Normalized by average\r\n                    \r\n                    clusters.push({\r\n                        intervals: currentCluster,\r\n                        consistency: consistency\r\n                    });\r\n                }\r\n                currentCluster = [sorted[i]];\r\n            }\r\n        }\r\n        \r\n        // Don't forget the last cluster\r\n        if (currentCluster.length >= 3) {\r\n            const avg = currentCluster.reduce((a, b) => a + b, 0) / currentCluster.length;\r\n            const variance = currentCluster.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / currentCluster.length;\r\n            const consistency = 1 / (1 + variance / (avg * avg));\r\n            clusters.push({\r\n                intervals: currentCluster,\r\n                consistency: consistency\r\n            });\r\n        }\r\n        \r\n        return clusters;\r\n    }\r\n\r\n    /**\r\n     * Check if two BPMs are harmonically related\r\n     * @param {number} bpm1 - First BPM\r\n     * @param {number} bpm2 - Second BPM\r\n     * @returns {boolean} True if harmonically related\r\n     */\r\n    checkHarmonicRelation(bpm1, bpm2) {\r\n        const ratio = Math.max(bpm1, bpm2) / Math.min(bpm1, bpm2);\r\n        const tolerance = 0.03;\r\n        \r\n        // Check for simple ratios (2:1, 3:2, 4:3, etc.)\r\n        const simpleRatios = [2, 1.5, 1.333, 1.25];\r\n        return simpleRatios.some(r => Math.abs(ratio - r) < tolerance);\r\n    }\r\n\r\n    /**\r\n     * Detect time signature from onset patterns\r\n     * @returns {string} Detected time signature\r\n     */\r\n    detectTimeSignature() {\r\n        // Need at least a detected BPM and some onset data\r\n        const minOnsets = this.forceFastDetection ? 6 : 12;\r\n        if (this.detectedBPM === 0 || this.onsetStrengths.length < minOnsets) {\r\n            return this.timeSignature;\r\n        }\r\n        \r\n        // If already locked, don't change unless we're in fast mode (just reset)\r\n        if (this.timeSignatureLocked && !this.forceFastDetection) {\r\n            return this.detectedTimeSignature || this.timeSignature;\r\n        }\r\n        \r\n        const beatInterval = 60000 / this.detectedBPM;\r\n        \r\n        // Only test the most common measure length first (4 beats)\r\n        // We'll be conservative and mostly detect 4/4 unless very clear pattern\r\n        const measureLength = 4;\r\n        const beatBins = new Array(measureLength).fill(0).map(() => ({\r\n            strength: 0,\r\n            bassWeight: 0,\r\n            count: 0\r\n        }));\r\n        \r\n        // Align recent onsets to a 4-beat grid\r\n        const recentOnsets = this.onsetStrengths.slice(-Math.min(20, this.onsetStrengths.length));\r\n        if (recentOnsets.length === 0) return this.timeSignature;\r\n        const startTime = recentOnsets[0].time;\r\n        \r\n        for (let onset of recentOnsets) {\r\n            const timeSinceStart = onset.time - startTime;\r\n            const beatPosition = (timeSinceStart / beatInterval) % measureLength;\r\n            const binIndex = Math.round(beatPosition) % measureLength;\r\n            \r\n            beatBins[binIndex].strength += onset.strength;\r\n            beatBins[binIndex].bassWeight += onset.bassWeight || 0;\r\n            beatBins[binIndex].count++;\r\n        }\r\n        \r\n        // Normalize bins\r\n        let maxStrength = 0;\r\n        for (let bin of beatBins) {\r\n            if (bin.count > 0) {\r\n                bin.strength /= bin.count;\r\n                bin.bassWeight /= bin.count;\r\n                maxStrength = Math.max(maxStrength, bin.strength + bin.bassWeight);\r\n            }\r\n        }\r\n        \r\n        // Default to 4/4 for most music\r\n        let detectedSig = '4/4';\r\n        \r\n        // Only detect 3/4 if we have a VERY clear waltz pattern\r\n        // (strong-weak-weak with no emphasis on beat 4)\r\n        if (beatBins[0].strength > beatBins[1].strength * 2 &&\r\n            beatBins[0].strength > beatBins[2].strength * 2 &&\r\n            beatBins[3].count < beatBins[0].count * 0.5) {\r\n            // Might be 3/4, but need more confidence\r\n            const waltzConfidence = this.testWaltzPattern(recentOnsets, beatInterval);\r\n            if (waltzConfidence > 0.8) {\r\n                detectedSig = '3/4';\r\n            }\r\n        }\r\n        \r\n        // Add to history\r\n        this.timeSignatureHistory.push(detectedSig);\r\n        if (this.timeSignatureHistory.length > 3) {\r\n            this.timeSignatureHistory.shift();\r\n        }\r\n        \r\n        // Lock faster - only need 2 readings in fast mode, 3 normally\r\n        const minReadings = this.forceFastDetection ? 2 : 3;\r\n        if (this.timeSignatureHistory.length >= minReadings) {\r\n            const counts = {};\r\n            for (let sig of this.timeSignatureHistory) {\r\n                counts[sig] = (counts[sig] || 0) + 1;\r\n            }\r\n            \r\n            // Find most common\r\n            let mostCommon = '4/4';\r\n            let maxCount = 0;\r\n            for (let [sig, count] of Object.entries(counts)) {\r\n                if (count > maxCount) {\r\n                    maxCount = count;\r\n                    mostCommon = sig;\r\n                }\r\n            }\r\n            \r\n            // Lock if we have agreement (at least 2 out of 3)\r\n            if (maxCount >= 2) {\r\n                this.detectedTimeSignature = mostCommon;\r\n                this.timeSignatureLocked = true;\r\n                this.timeSignatureConfidence = maxCount / 3;\r\n                \r\n                // Update rhythm engine if available\r\n                if (window.rhythmIntegration && window.rhythmIntegration.setTimeSignature) {\r\n                    window.rhythmIntegration.setTimeSignature(this.detectedTimeSignature);\r\n                }\r\n                \r\n                \r\n                // Also directly update UI in case rhythmIntegration doesn't\r\n                const timeSigDisplay = document.getElementById('time-sig-display');\r\n                if (timeSigDisplay) {\r\n                    timeSigDisplay.textContent = this.detectedTimeSignature;\r\n                }\r\n            }\r\n        }\r\n        \r\n        return this.detectedTimeSignature || this.timeSignature;\r\n    }\r\n\r\n    /**\r\n     * Test for waltz pattern (3/4 time)\r\n     * @param {Array} onsets - Onset times and strengths\r\n     * @param {number} beatInterval - Beat interval in ms\r\n     * @returns {number} Confidence score (0-1) for waltz pattern\r\n     */\r\n    testWaltzPattern(onsets, beatInterval) {\r\n        // Look for groups of 3 beats with strong-weak-weak pattern\r\n        let waltzGroups = 0;\r\n        let totalGroups = 0;\r\n        \r\n        for (let i = 0; i < onsets.length - 2; i += 3) {\r\n            if (i + 2 < onsets.length) {\r\n                totalGroups++;\r\n                const first = onsets[i].strength + (onsets[i].bassWeight || 0);\r\n                const second = onsets[i + 1].strength + (onsets[i + 1].bassWeight || 0);\r\n                const third = onsets[i + 2].strength + (onsets[i + 2].bassWeight || 0);\r\n                \r\n                // Check for strong-weak-weak pattern\r\n                if (first > second * 1.5 && first > third * 1.5) {\r\n                    waltzGroups++;\r\n                }\r\n            }\r\n        }\r\n        \r\n        return totalGroups > 0 ? waltzGroups / totalGroups : 0;\r\n    }\r\n\r\n    /**\r\n     * Add onset event for analysis\r\n     * @param {number} time - Onset time\r\n     * @param {number} strength - Onset strength\r\n     * @param {number} bassWeight - Optional bass weight for downbeat detection\r\n     */\r\n    addOnset(time, strength, bassWeight = 0) {\r\n        // Feed to agent detector for fast convergence\r\n        if (this.useAgentDetection) {\r\n            this.agentDetector.processPeak(strength, time);\r\n        }\r\n\r\n        if (this.lastOnsetTime > 0) {\r\n            const interval = time - this.lastOnsetTime;\r\n            // Filter reasonable intervals (60-220 BPM range)\r\n            if (interval > 273 && interval < 1000) {\r\n                this.onsetIntervals.push(interval);\r\n                if (this.onsetIntervals.length > 20) {\r\n                    this.onsetIntervals.shift();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.onsetStrengths.push({ time, strength, bassWeight });\r\n        if (this.onsetStrengths.length > 40) {\r\n            this.onsetStrengths.shift();\r\n        }\r\n\r\n        this.lastOnsetTime = time;\r\n    }\r\n\r\n    /**\r\n     * Update music detection\r\n     * @param {number} now - Current time\r\n     */\r\n    update(now) {\r\n        // Periodically recalculate BPM\r\n        if (now - this.lastBPMCalculation > this.bpmCalculationInterval) {\r\n            this.calculateBPM();\r\n            this.detectTimeSignature();\r\n            this.lastBPMCalculation = now;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get recommended subdivision for current BPM\r\n     */\r\n    getRecommendedSubdivision() {\r\n        if (this.useAgentDetection) {\r\n            return this.agentDetector.getSubdivision();\r\n        }\r\n\r\n        // Fallback logic based on BPM ranges - prefer lower subdivisions\r\n        if (this.detectedBPM < 60) return 2;     // Double for very slow\r\n        if (this.detectedBPM < 80) return 1;     // Normal for slow\r\n        if (this.detectedBPM > 180) return 0.5;  // Half for very fast\r\n        if (this.detectedBPM > 140) return 0.5;  // Half for fast\r\n        return 1; // Normal for mid-range (80-140)\r\n    }\r\n\r\n    /**\r\n     * Reset music detection state\r\n     */\r\n    reset() {\r\n        this.onsetIntervals = [];\r\n        this.onsetStrengths = [];\r\n        this.lastOnsetTime = 0;\r\n        this.detectedBPM = 0;\r\n        this.bpmConfidence = 0;\r\n        this.bpmHistory = [];\r\n        this.tempoLocked = false;\r\n        this.fundamentalBPM = 0;\r\n        this.timeSignature = '4/4';\r\n        this.detectedTimeSignature = null;\r\n        this.timeSignatureConfidence = 0;\r\n        this.timeSignatureHistory = [];\r\n\r\n        // Reset agent detector\r\n        if (this.agentDetector) {\r\n            this.agentDetector.reset();\r\n        }\r\n        this.timeSignatureLocked = false;\r\n        this.isMusicalContent = false;\r\n        this.forceFastDetection = false;\r\n    }\r\n\r\n    /**\r\n     * Get current music information\r\n     */\r\n    getMusicInfo() {\r\n        return {\r\n            bpm: this.detectedBPM,\r\n            confidence: this.bpmConfidence,\r\n            timeSignature: this.timeSignature,\r\n            isMusical: this.isMusicalContent,\r\n            musicalityScore: this.musicalityScore\r\n        };\r\n    }\r\n}\r\n\r\nexport default MusicDetector;","/**\r\n * TransitionManager - Manages shape transitions and morphing queue\r\n * @module core/morpher/TransitionManager\r\n */\r\n\r\nexport class TransitionManager {\r\n    constructor(morpher) {\r\n        this.morpher = morpher;\r\n        \r\n        // Transition state\r\n        this.isTransitioning = false;\r\n        this.transitionStartTime = 0;\r\n        this.transitionDuration = 800;\r\n        this.transitionProgress = 0;\r\n        this.easingFunction = 'easeInOutQuad';\r\n        \r\n        // Shape state\r\n        this.currentShape = 'circle';\r\n        this.targetShape = null;\r\n        this.previousShape = null;\r\n        \r\n        // Morph queue\r\n        this.morphQueue = [];\r\n        this.maxQueueSize = 3;\r\n        \r\n        // Shadow effects\r\n        this.shadowConfig = null;\r\n        this.shadowProgress = 0;\r\n    }\r\n\r\n    /**\r\n     * Start a shape transition\r\n     * @param {string} targetShape - Target shape name\r\n     * @param {Object} options - Transition options\r\n     */\r\n    startTransition(targetShape, options = {}) {\r\n        // If already transitioning, queue it\r\n        if (this.isTransitioning && this.morphQueue.length < this.maxQueueSize) {\r\n            this.morphQueue.push({ shape: targetShape, options });\r\n            return;\r\n        }\r\n        \r\n        this.previousShape = this.currentShape;\r\n        this.targetShape = targetShape;\r\n        this.isTransitioning = true;\r\n        this.transitionStartTime = performance.now();\r\n        this.transitionDuration = options.duration || 800;\r\n        this.easingFunction = options.easing || 'easeInOutQuad';\r\n        this.transitionProgress = 0;\r\n        \r\n        // Get transition config for special effects\r\n        this.shadowConfig = this.getTransitionConfig(this.currentShape, targetShape);\r\n    }\r\n\r\n    /**\r\n     * Update transition progress\r\n     * @param {number} deltaTime - Time since last frame\r\n     */\r\n    update(deltaTime) {\r\n        if (!this.isTransitioning) return;\r\n        \r\n        const now = performance.now();\r\n        const elapsed = now - this.transitionStartTime;\r\n        const rawProgress = Math.min(1, elapsed / this.transitionDuration);\r\n        \r\n        // Apply easing\r\n        this.transitionProgress = this.applyEasing(rawProgress);\r\n        \r\n        // Update shadow progress if configured\r\n        if (this.shadowConfig) {\r\n            this.shadowProgress = this.calculateShadowProgress(rawProgress);\r\n        }\r\n        \r\n        // Complete transition if done\r\n        if (rawProgress >= 1) {\r\n            this.completeTransition();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Complete current transition\r\n     */\r\n    completeTransition() {\r\n        this.currentShape = this.targetShape;\r\n        this.targetShape = null;\r\n        this.isTransitioning = false;\r\n        this.transitionProgress = 0;\r\n        this.shadowConfig = null;\r\n        \r\n        // Process queue if there are pending morphs\r\n        if (this.morphQueue.length > 0) {\r\n            const next = this.morphQueue.shift();\r\n            this.startTransition(next.shape, next.options);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get transition configuration for special effects\r\n     * @param {string} from - Source shape\r\n     * @param {string} to - Target shape\r\n     * @returns {Object} Transition configuration\r\n     */\r\n    getTransitionConfig(from, to) {\r\n        // Special transition effects for certain shape combinations\r\n        const transitions = {\r\n            'circle-heart': {\r\n                type: 'bloom',\r\n                shadowColor: '#ff69b4',\r\n                shadowIntensity: 0.3\r\n            },\r\n            'heart-circle': {\r\n                type: 'contract',\r\n                shadowColor: '#ff69b4',\r\n                shadowIntensity: 0.2\r\n            },\r\n            'circle-star': {\r\n                type: 'burst',\r\n                shadowColor: '#ffd700',\r\n                shadowIntensity: 0.4\r\n            },\r\n            'star-circle': {\r\n                type: 'collapse',\r\n                shadowColor: '#ffd700',\r\n                shadowIntensity: 0.3\r\n            }\r\n        };\r\n        \r\n        const key = `${from}-${to}`;\r\n        return transitions[key] || null;\r\n    }\r\n\r\n    /**\r\n     * Calculate shadow progress for special effects\r\n     * @param {number} progress - Raw transition progress\r\n     * @returns {number} Shadow effect progress\r\n     */\r\n    calculateShadowProgress(progress) {\r\n        if (!this.shadowConfig) return 0;\r\n        \r\n        switch (this.shadowConfig.type) {\r\n            case 'bloom':\r\n                // Expand then fade\r\n                return progress < 0.5 \r\n                    ? progress * 2 \r\n                    : 2 - (progress * 2);\r\n            \r\n            case 'burst':\r\n                // Quick expand and fade\r\n                return Math.pow(1 - progress, 2);\r\n            \r\n            case 'contract':\r\n            case 'collapse':\r\n                // Fade in then shrink\r\n                return Math.sin(progress * Math.PI);\r\n            \r\n            default:\r\n                return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply easing function to progress\r\n     * @param {number} t - Linear progress (0-1)\r\n     * @returns {number} Eased progress\r\n     */\r\n    applyEasing(t) {\r\n        switch (this.easingFunction) {\r\n            case 'linear':\r\n                return t;\r\n            case 'easeInQuad':\r\n                return t * t;\r\n            case 'easeOutQuad':\r\n                return t * (2 - t);\r\n            case 'easeInOutQuad':\r\n                return t < 0.5 \r\n                    ? 2 * t * t \r\n                    : -1 + (4 - 2 * t) * t;\r\n            case 'easeInCubic':\r\n                return t * t * t;\r\n            case 'easeOutCubic':\r\n                return (--t) * t * t + 1;\r\n            case 'easeInOutCubic':\r\n                return t < 0.5 \r\n                    ? 4 * t * t * t \r\n                    : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\r\n            default:\r\n                return t;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear morph queue\r\n     */\r\n    clearQueue() {\r\n        this.morphQueue = [];\r\n    }\r\n\r\n    /**\r\n     * Check if has queued morphs\r\n     */\r\n    hasQueuedMorphs() {\r\n        return this.morphQueue.length > 0;\r\n    }\r\n\r\n    /**\r\n     * Get current state\r\n     */\r\n    getState() {\r\n        return {\r\n            isTransitioning: this.isTransitioning,\r\n            currentShape: this.currentShape,\r\n            targetShape: this.targetShape,\r\n            progress: this.transitionProgress,\r\n            queueLength: this.morphQueue.length\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Reset to default state\r\n     */\r\n    reset() {\r\n        this.isTransitioning = false;\r\n        this.currentShape = 'circle';\r\n        this.targetShape = null;\r\n        this.transitionProgress = 0;\r\n        this.morphQueue = [];\r\n        this.shadowConfig = null;\r\n    }\r\n}\r\n\r\nexport default TransitionManager;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Shape Morphing System\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Musical shape morphing system using modular shapes\r\n * @author Emotive Engine Team\r\n * @module core/ShapeMorpher\r\n */\r\n\r\nimport { MusicalDuration } from './MusicalDuration.js';\r\nimport { rhythmEngine } from './rhythm.js';\r\nimport { SHAPE_DEFINITIONS } from './shapes/shapeDefinitions.js';\r\nimport arrayPool from '../utils/ArrayPool.js';\r\n\r\n// Import modular components\r\nimport { AudioDeformer } from './morpher/AudioDeformer.js';\r\nimport { MusicDetector } from './morpher/MusicDetector.js';\r\nimport { TransitionManager } from './morpher/TransitionManager.js';\r\n\r\n/**\r\n * ShapeMorpher class - manages smooth transitions between shapes\r\n */\r\nclass ShapeMorpher {\r\n    constructor(options = {}) {\r\n        // Configuration\r\n        this.numPoints = options.numPoints || 64;\r\n        this.morphDuration = options.morphDuration || 1000; // Default 1 second\r\n        this.easing = options.easing || 'easeInOutCubic';\r\n        \r\n        // Initialize modular components\r\n        this.transitionManager = new TransitionManager(this);\r\n        this.audioDeformer = new AudioDeformer(this);\r\n        this.musicDetector = new MusicDetector();\r\n        \r\n        // State - delegated to TransitionManager\r\n        this.currentShape = 'circle';\r\n        this.targetShape = null;\r\n        this.morphProgress = 0;\r\n        this.visualProgress = 0; // Smoothed visual progress for rendering\r\n        this.morphStartTime = null;\r\n        this.isTransitioning = false;\r\n        \r\n        // Shape data cache\r\n        this.shapeCache = new Map();\r\n        this.currentPoints = [];\r\n        this.targetPoints = [];\r\n        \r\n        // Musical timing\r\n        this.musicalDuration = null;\r\n        this.onBeat = false;\r\n        \r\n        // Audio deformation with throttling - delegated to AudioDeformer\r\n        this.audioDeformation = 0;\r\n        this.vocalEnergy = 0;\r\n        this.lastAudioUpdate = 0;\r\n        this.lastVocalUpdate = 0;  // Separate timestamp for vocal updates\r\n        this.audioUpdateInterval = 33; // Update at ~30fps max\r\n        \r\n        // Enhanced audio visualization\r\n        this.audioAnalyzer = null; // Reference to audio analyzer for frequency data\r\n        this.frequencyData = arrayPool.acquire(32, 'float32'); // Store frequency bands\r\n        this.glitchPoints = []; // Track points that are glitching\r\n        this.undulationPhase = 0; // Phase for wave animation\r\n        this.undulationDirection = 1; // Random direction for bass wobble\r\n        this.beatGlitchIntensity = 0; // Intensity of beat-triggered glitches\r\n        \r\n        // Frequency-specific energy tracking\r\n        this.bassEnergy = 0; // Low frequency energy (20-250 Hz)\r\n        this.vocalPresence = 0; // Mid frequency energy (250-4000 Hz)\r\n        \r\n        // Rolling averages for dynamic thresholds\r\n        this.bassHistory = arrayPool.acquire(60, 'float32'); // 2 seconds at 30fps\r\n        this.vocalHistory = arrayPool.acquire(60, 'float32');\r\n        this.historyIndex = 0;\r\n        \r\n        // Cooldown timers to prevent effect spam\r\n        this.bassEffectCooldown = 0;\r\n        this.vocalEffectCooldown = 0;\r\n        \r\n        // Threshold multipliers (can be adjusted for mic vs audio)\r\n        this.bassThresholdMultiplier = 1.2;  // Lowered from 1.8 for testing\r\n        this.vocalThresholdMultiplier = 1.1;  // Even lower for more frequent vocal triggers\r\n        \r\n        // Effect states\r\n        this.bassEffectActive = false;\r\n        this.vocalEffectActive = false;\r\n        \r\n        // Transient detection\r\n        this.transientHoldTime = 0;\r\n        this.vocalGlowBoost = 0;\r\n        \r\n        // Callbacks\r\n        this.onComplete = null;\r\n        this.onProgress = null;\r\n        \r\n        // Morph queue\r\n        this.queuedMorph = null;\r\n        \r\n        // Initialize with circle shape\r\n        this.currentPoints = this.getShapePoints('circle');\r\n        this.shapesLoaded = true; // Static definitions are always loaded\r\n        \r\n        // Pre-warm the shape cache to prevent first-run choppiness\r\n        this.prewarmCache();\r\n    }\r\n    \r\n    /**\r\n     * Pre-warm the shape cache to prevent first-run lag\r\n     */\r\n    prewarmCache() {\r\n        // Pre-generate all common shapes\r\n        const commonShapes = [\r\n            'circle', 'heart', 'star', 'sun', 'moon', \r\n            'lunar', 'square', 'triangle'\r\n        ];\r\n        \r\n        \r\n        commonShapes.forEach(shape => {\r\n            if (SHAPE_DEFINITIONS[shape]) {\r\n                // Generate and cache the points\r\n                this.getShapePoints(shape);\r\n            }\r\n        });\r\n        \r\n        // Also pre-calculate some common easing values\r\n        const testProgress = [0, 0.25, 0.5, 0.75, 1];\r\n        testProgress.forEach(t => {\r\n            this.applyEasing(t); // Warm up easing calculations\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Get shape points from cache or generate\r\n     */\r\n    getShapePoints(shapeName) {\r\n        if (!this.shapeCache.has(shapeName)) {\r\n            const shapeDef = SHAPE_DEFINITIONS[shapeName];\r\n            if (!shapeDef || !shapeDef.points) {\r\n                const circlePoints = SHAPE_DEFINITIONS.circle.points;\r\n                this.shapeCache.set(shapeName, circlePoints);\r\n                return circlePoints;\r\n            }\r\n            // Store reference directly - shapes are immutable\r\n            const points = shapeDef.points;\r\n            this.shapeCache.set(shapeName, points);\r\n            return points;\r\n        }\r\n        return this.shapeCache.get(shapeName);\r\n    }\r\n    \r\n    /**\r\n     * Start morphing to a new shape\r\n     * @param {string} targetShape - Target shape name\r\n     * @param {Object} options - Morph options\r\n     */\r\n    morphTo(targetShape, options = {}) {\r\n        if (!this.shapesLoaded) {\r\n            return;\r\n        }\r\n        \r\n        if (targetShape === this.currentShape && !this.isTransitioning) {\r\n            return; // Already at target shape\r\n        }\r\n        \r\n        // Handle queueing or forcing\r\n        if (this.isTransitioning && !options.force) {\r\n            // Queue this morph for after current one completes\r\n            this.queuedMorph = { targetShape, options };\r\n            return 'queued'; // Return status so caller knows it was queued\r\n        } else if (this.isTransitioning && options.force) {\r\n            // Force interrupt current morph\r\n            this.completeMorph(true); // Skip to end without processing queue\r\n        }\r\n        \r\n        // Get transition configuration\r\n        const transitionConfig = this.getTransitionConfig(this.currentShape, targetShape);\r\n        \r\n        // Set up transition\r\n        this.targetShape = targetShape;\r\n        this.targetPoints = this.getShapePoints(targetShape);\r\n        this.morphStartTime = Date.now();\r\n        this.isTransitioning = true;\r\n        this.morphProgress = 0;\r\n        this.visualProgress = 0; // Reset visual progress\r\n\r\n        \r\n        // Configure timing - use transition config duration if available\r\n        if (options.duration === 'bar' || options.duration === 'beat') {\r\n            // Musical timing - calculate duration based on current BPM\r\n            const bpm = rhythmEngine.bpm || 120;\r\n            const beatDuration = 60000 / bpm; // ms per beat\r\n            \r\n            if (options.duration === 'bar') {\r\n                // Assume 4/4 time signature\r\n                this.morphDuration = beatDuration * 4; // 4 beats per bar\r\n            } else {\r\n                this.morphDuration = beatDuration; // 1 beat\r\n            }\r\n            \r\n            this.musicalDuration = true; // Flag for musical timing\r\n            this.onBeat = options.onBeat !== false; // Default true for musical timing\r\n        } else {\r\n            // Fixed duration - prefer transition config duration\r\n            this.morphDuration = transitionConfig?.duration || options.duration || 1000;\r\n            this.musicalDuration = null;\r\n            this.onBeat = false;\r\n        }\r\n        \r\n        // Store options\r\n        this.morphMode = options.mode || 'smooth';\r\n        this.transitionConfig = transitionConfig;\r\n        \r\n        // Callbacks\r\n        this.onComplete = options.onComplete;\r\n        this.onProgress = options.onProgress;\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Update morph animation\r\n     * @param {number} deltaTime - Time since last update (can be from RAF timestamp)\r\n     */\r\n    update(deltaTime) {\r\n        // Always update frequency data from audio analyzer if available\r\n        if (this.audioAnalyzer && this.audioAnalyzer.isAnalyzing) {\r\n            const audioData = this.audioAnalyzer.getShapeMorpherData();\r\n            if (audioData && audioData.frequencies) {\r\n                // Copy frequency data for visualization\r\n                let hasNonZero = false;\r\n                for (let i = 0; i < Math.min(audioData.frequencies.length, this.frequencyData.length); i++) {\r\n                    this.frequencyData[i] = audioData.frequencies[i];\r\n                    if (audioData.frequencies[i] > 0) hasNonZero = true;\r\n                }\r\n                // Log once if we start getting data\r\n                if (hasNonZero && !this._loggedAudioData) {\r\n                    console.log('ShapeMorpher: Receiving audio frequency data');\r\n                    this._loggedAudioData = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Update music detector BPM calculation\r\n        if (this.musicDetector) {\r\n            this.musicDetector.update(performance.now());\r\n        }\r\n\r\n        // Return early if not transitioning\r\n        if (!this.isTransitioning || !this.targetShape) return;\r\n        \r\n        // Calculate progress based on total elapsed time\r\n        const currentTime = Date.now();\r\n        const elapsed = currentTime - this.morphStartTime;\r\n        \r\n        // Recalculate duration if BPM changed during morph (for rhythm sync)\r\n        if (this.musicalDuration) {\r\n            const currentBpm = rhythmEngine.bpm || 120;\r\n            const beatDuration = 60000 / currentBpm;\r\n            // Recalculate based on original intention (bar or beat)\r\n            const originalDuration = this.morphDuration;\r\n            const wasBar = originalDuration > beatDuration * 2; // Heuristic: if > 2 beats, it was a bar\r\n            this.morphDuration = wasBar ? beatDuration * 4 : beatDuration;\r\n        }\r\n        \r\n        let progress = Math.min(elapsed / this.morphDuration, 1);\r\n        \r\n        // Apply musical quantization if needed\r\n        if (this.musicalDuration && this.onBeat) {\r\n            const bpm = rhythmEngine.bpm || 120;\r\n            \r\n            // Adaptive granularity - use coarser quantization at higher BPMs\r\n            let subdivision;\r\n            if (bpm > 140) {\r\n                subdivision = 2; // 8th notes for fast tempos\r\n            } else if (bpm > 100) {\r\n                subdivision = 4; // 16th notes for medium tempos  \r\n            } else {\r\n                subdivision = 8; // 32nd notes for slow tempos\r\n            }\r\n            \r\n            // Quantize to nearest subdivision\r\n            const beatDuration = 60000 / bpm;\r\n            const totalBeats = this.morphDuration / beatDuration;\r\n            const currentBeat = progress * totalBeats;\r\n            const quantizedBeat = Math.round(currentBeat * subdivision) / subdivision;\r\n            const quantizedProgress = Math.min(1, quantizedBeat / totalBeats);\r\n            \r\n            // BPM-based strength - weaker quantization at extremes (very slow or very fast)\r\n            const bpmFactor = bpm < 90 ? \r\n                Math.max(0.3, (bpm - 60) / 30) :  // 0.3 at 60bpm, 1.0 at 90bpm (weaker for slow)\r\n                Math.max(0.4, Math.min(1, 1 - ((bpm - 90) / 90))); // 1.0 at 90bpm, 0.4 at 180bpm (weaker for fast)\r\n            const baseStrength = 0.3 + (bpmFactor * 0.5); // Range: 0.3 to 0.8 based on BPM\r\n            \r\n            // Phase-aware quantization - weaker at start/end, stronger in middle\r\n            const phaseMultiplier = Math.sin(progress * Math.PI); // 0 at edges, 1 at center\r\n            const quantizationStrength = baseStrength * (0.3 + phaseMultiplier * 0.7); // Further modulated by phase\r\n            \r\n            // Apply smoothed quantization with cubic interpolation (smoothstep)\r\n            const t = quantizationStrength;\r\n            const cubicT = t * t * (3 - 2 * t); // Smoothstep for S-curve blending\r\n            progress = progress + (quantizedProgress - progress) * cubicT;\r\n        }\r\n        \r\n        // Apply easing\r\n        this.morphProgress = this.applyEasing(progress);\r\n\r\n        // Smooth visual progress for ultra-smooth rendering\r\n        // Heavy smoothing: 80% of previous frame, 20% of new\r\n        this.visualProgress = this.visualProgress * 0.8 + this.morphProgress * 0.2;\r\n\r\n        // Snap to final value when very close to avoid infinite approach\r\n        if (Math.abs(this.visualProgress - this.morphProgress) < 0.001) {\r\n            this.visualProgress = this.morphProgress;\r\n        }\r\n        \r\n        // Notify progress\r\n        if (this.onProgress) {\r\n            this.onProgress(this.morphProgress);\r\n        }\r\n        \r\n        // Check if complete (use logical progress, not visual)\r\n        if (this.morphProgress >= 1) {\r\n            this.visualProgress = 1; // Ensure visual completes too\r\n            this.completeMorph();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Complete the morph transition\r\n     * @param {boolean} skipQueue - Skip processing queued morphs (for force override)\r\n     */\r\n    completeMorph(skipQueue = false) {\r\n        // Only update current shape if we actually have a target\r\n        if (this.targetShape) {\r\n            this.currentShape = this.targetShape;\r\n            this.currentPoints = [...this.targetPoints];\r\n        }\r\n        this.targetShape = null;\r\n        this.isTransitioning = false;\r\n        this.morphProgress = 0;\r\n        this.visualProgress = 0; // Reset visual progress\r\n        \r\n        if (this.onComplete) {\r\n            this.onComplete(this.currentShape);\r\n        }\r\n        \r\n        // Process queued morph if exists and not skipping\r\n        if (!skipQueue && this.queuedMorph) {\r\n            const queued = this.queuedMorph;\r\n            this.queuedMorph = null; // Clear queue before morphing\r\n            \r\n            // Small delay to ensure smooth transition\r\n            setTimeout(() => {\r\n                this.morphTo(queued.targetShape, queued.options);\r\n            }, 50);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Check if there's a queued morph\r\n     * @returns {boolean} True if morph is queued\r\n     */\r\n    hasQueuedMorph() {\r\n        return this.queuedMorph !== null;\r\n    }\r\n    \r\n    /**\r\n     * Clear the morph queue\r\n     */\r\n    clearQueue() {\r\n        this.queuedMorph = null;\r\n    }\r\n    \r\n    /**\r\n     * Get shape points in canvas coordinates\r\n     * @param {number} centerX - Center X coordinate\r\n     * @param {number} centerY - Center Y coordinate  \r\n     * @param {number} radius - Shape radius\r\n     * @returns {Array} Points in canvas coordinates\r\n     */\r\n    getCanvasPoints(centerX, centerY, radius) {\r\n        let normalizedPoints;\r\n        \r\n        try {\r\n            normalizedPoints = this.getInterpolatedPoints();\r\n        } catch (e) {\r\n            normalizedPoints = this.generateFallbackCircle();\r\n        }\r\n        \r\n        // Reuse canvas points array\r\n        if (!this.canvasPointsCache) {\r\n            this.canvasPointsCache = [];\r\n        }\r\n        const canvasPoints = this.canvasPointsCache;\r\n        canvasPoints.length = 0; // Clear without allocating new array\r\n        \r\n        // Handle case where points aren't loaded yet\r\n        if (!normalizedPoints || normalizedPoints.length === 0) {\r\n            // Return fallback circle points\r\n            for (let i = 0; i < this.numPoints; i++) {\r\n                const angle = (i / this.numPoints) * Math.PI * 2;\r\n                canvasPoints.push({\r\n                    x: centerX + Math.cos(angle) * radius,\r\n                    y: centerY + Math.sin(angle) * radius\r\n                });\r\n            }\r\n            return canvasPoints;\r\n        }\r\n        \r\n        // Ensure we're working with an array\r\n        const pointsArray = Array.isArray(normalizedPoints) ? normalizedPoints : [];\r\n        \r\n        for (let i = 0; i < pointsArray.length; i++) {\r\n            const point = pointsArray[i];\r\n            if (!point || typeof point.x !== 'number' || typeof point.y !== 'number') {\r\n                // Add fallback point\r\n                const angle = (i / pointsArray.length) * Math.PI * 2;\r\n                canvasPoints.push({\r\n                    x: centerX + Math.cos(angle) * radius,\r\n                    y: centerY + Math.sin(angle) * radius\r\n                });\r\n            } else {\r\n                // Convert normalized (0-1) to canvas coordinates\r\n                const x = centerX + (point.x - 0.5) * radius * 2;\r\n                const y = centerY + (point.y - 0.5) * radius * 2;\r\n                canvasPoints.push({ x, y });\r\n            }\r\n        }\r\n        \r\n        // Ensure we have enough points\r\n        while (canvasPoints.length < this.numPoints) {\r\n            const i = canvasPoints.length;\r\n            const angle = (i / this.numPoints) * Math.PI * 2;\r\n            canvasPoints.push({\r\n                x: centerX + Math.cos(angle) * radius,\r\n                y: centerY + Math.sin(angle) * radius\r\n            });\r\n        }\r\n        \r\n        return canvasPoints;\r\n    }\r\n    \r\n    /**\r\n     * Get interpolated shape points\r\n     * @returns {Array} Current interpolated points\r\n     */\r\n    getInterpolatedPoints() {\r\n        // Ensure we always have points\r\n        if (!this.currentPoints || this.currentPoints.length === 0) {\r\n            this.currentPoints = this.generateFallbackCircle();\r\n        }\r\n        \r\n        if (!this.isTransitioning) {\r\n            return this.applyAudioDeformation(this.currentPoints);\r\n        }\r\n        \r\n        const points = [];\r\n        for (let i = 0; i < this.numPoints; i++) {\r\n            const current = this.currentPoints[i];\r\n            const target = this.targetPoints[i];\r\n            \r\n            // Handle missing points\r\n            if (!current || !target) {\r\n                const angle = (i / this.numPoints) * Math.PI * 2;\r\n                points.push({\r\n                    x: 0.5 + Math.cos(angle) * 0.5,\r\n                    y: 0.5 + Math.sin(angle) * 0.5\r\n                });\r\n                continue;\r\n            }\r\n            \r\n            // Interpolate based on mode - use visualProgress for smooth rendering\r\n            const progress = this.visualProgress;\r\n            let x, y;\r\n            \r\n            // RADIAL MORPH: These shapes radiate from/to center\r\n            const radialShapes = ['square', 'circle', 'star', 'triangle'];\r\n            const currentIsRadial = radialShapes.includes(this.currentShape);\r\n            const targetIsRadial = radialShapes.includes(this.targetShape);\r\n            const needsRadialMorph = currentIsRadial || targetIsRadial;\r\n            \r\n            if (needsRadialMorph) {\r\n                // RADIATE FROM/TO CENTER\r\n                const cx = 0.5, cy = 0.5;\r\n                \r\n                // Calculate radial interpolation\r\n                if (targetIsRadial && !currentIsRadial) {\r\n                    // Morphing TO a radial shape - expand from center\r\n                    // Start at center, expand to target position\r\n                    const targetDx = target.x - cx;\r\n                    const targetDy = target.y - cy;\r\n                    \r\n                    // Ease the expansion with a smooth curve\r\n                    const expandProgress = this.applyEasing(progress);\r\n                    \r\n                    // Start from center point for first half, then expand outward\r\n                    if (progress < 0.3) {\r\n                        // Gather at center\r\n                        const gatherProgress = progress / 0.3;\r\n                        x = current.x + (cx - current.x) * gatherProgress;\r\n                        y = current.y + (cy - current.y) * gatherProgress;\r\n                    } else {\r\n                        // Expand from center to target\r\n                        const expandPhase = (progress - 0.3) / 0.7;\r\n                        x = cx + targetDx * expandPhase;\r\n                        y = cy + targetDy * expandPhase;\r\n                    }\r\n                } else if (currentIsRadial && !targetIsRadial) {\r\n                    // Morphing FROM a radial shape - collapse to center then expand to target\r\n                    const currentDx = current.x - cx;\r\n                    const currentDy = current.y - cy;\r\n                    \r\n                    if (progress < 0.5) {\r\n                        // Collapse to center\r\n                        const collapseProgress = progress / 0.5;\r\n                        x = current.x - currentDx * collapseProgress;\r\n                        y = current.y - currentDy * collapseProgress;\r\n                    } else {\r\n                        // Expand from center to target\r\n                        const expandProgress = (progress - 0.5) / 0.5;\r\n                        x = cx + (target.x - cx) * expandProgress;\r\n                        y = cy + (target.y - cy) * expandProgress;\r\n                    }\r\n                } else {\r\n                    // Both are radial shapes - morph through center\r\n                    const currentDx = current.x - cx;\r\n                    const currentDy = current.y - cy;\r\n                    const targetDx = target.x - cx;\r\n                    const targetDy = target.y - cy;\r\n                    \r\n                    if (progress < 0.5) {\r\n                        // Collapse current shape to center\r\n                        const collapseProgress = progress / 0.5;\r\n                        x = current.x - currentDx * collapseProgress;\r\n                        y = current.y - currentDy * collapseProgress;\r\n                    } else {\r\n                        // Expand from center to target shape\r\n                        const expandProgress = (progress - 0.5) / 0.5;\r\n                        x = cx + targetDx * expandProgress;\r\n                        y = cy + targetDy * expandProgress;\r\n                    }\r\n                }\r\n            } else if (this.morphMode === 'spiral') {\r\n                // Spiral interpolation\r\n                const angle = progress * Math.PI * 2;\r\n                const spiral = Math.sin(angle + i * 0.2) * 0.02 * (1 - Math.abs(progress - 0.5) * 2);\r\n                x = current.x + (target.x - current.x) * progress + spiral;\r\n                y = current.y + (target.y - current.y) * progress + spiral;\r\n            } else if (this.morphMode === 'wave') {\r\n                // Wave interpolation\r\n                const wave = Math.sin(i * 0.3 + progress * Math.PI * 4) * 0.01;\r\n                x = current.x + (target.x - current.x) * progress + wave;\r\n                y = current.y + (target.y - current.y) * progress + wave;\r\n            } else {\r\n                // Smooth interpolation\r\n                x = current.x + (target.x - current.x) * progress;\r\n                y = current.y + (target.y - current.y) * progress;\r\n            }\r\n            \r\n            points.push({ x, y });\r\n        }\r\n        \r\n        return this.applyAudioDeformation(points);\r\n    }\r\n    \r\n    /**\r\n     * Apply audio-reactive deformation to points\r\n     */\r\n    applyAudioDeformation(points) {\r\n        // Delegate to AudioDeformer module\r\n        return this.audioDeformer.applyAudioDeformation(points);\r\n    }\r\n    \r\n    /**\r\n     * Set audio deformation from analyzer with throttling\r\n     * @param {number} value - Deformation value (-1 to 1)\r\n     */\r\n    setAudioDeformation(value) {\r\n        const now = Date.now();\r\n        if (now - this.lastAudioUpdate > this.audioUpdateInterval) {\r\n            this.audioDeformation = Math.max(-1, Math.min(1, value));\r\n            this.lastAudioUpdate = now;\r\n            // CRITICAL: Also update the AudioDeformer module!\r\n            if (this.audioDeformer) {\r\n                this.audioDeformer.setAudioDeformation(Math.abs(this.audioDeformation)); // Pass absolute value\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set vocal energy from analyzer with throttling\r\n     * @param {number} value - Energy value (0 to 1)\r\n     */\r\n    setVocalEnergy(value) {\r\n        const now = Date.now();\r\n        if (now - this.lastVocalUpdate > this.audioUpdateInterval) {\r\n            this.vocalEnergy = Math.max(0, Math.min(1, value));\r\n            this.lastVocalUpdate = now;\r\n            // Also update the AudioDeformer module\r\n            if (this.audioDeformer) {\r\n                this.audioDeformer.setVocalEnergy(this.vocalEnergy);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get transition configuration\r\n     */\r\n    getTransitionConfig(from, to) {\r\n        const fromShape = SHAPE_DEFINITIONS[from];\r\n        const toShape = SHAPE_DEFINITIONS[to];\r\n        \r\n        // Special transitions for moon - add a dreamy quality\r\n        if (to === 'moon') {\r\n            return {\r\n                type: 'to_moon',\r\n                easing: 'easeInOutCubic',  // Smooth acceleration/deceleration\r\n                duration: 1500,  // Slightly longer for dramatic effect\r\n                glowIntensity: 1.5,  // Extra glow during transition\r\n                fadeInCrescent: true  // Fade in the crescent shadow\r\n            };\r\n        }\r\n        \r\n        \r\n        // Moon to lunar - special eclipse transition\r\n        if (from === 'moon' && to === 'lunar') {\r\n            return {\r\n                type: 'moon_to_lunar',\r\n                easing: 'easeInOutSine',\r\n                duration: 2000,  // Slower for dramatic effect\r\n                slideOutCrescent: false, // Don't use standard slide\r\n                description: 'Crescent shadow moves to center and becomes lunar eclipse'\r\n            };\r\n        }\r\n        \r\n        // All other moon transitions - shadow slides away first\r\n        if (from === 'moon') {\r\n            return {\r\n                type: 'from_moon', \r\n                easing: 'easeInOutCubic',\r\n                duration: 1000,\r\n                slideOutCrescent: true,  // Shadow ALWAYS slides away\r\n                shadowSlideRatio: 0.4,   // First 40% for shadow slide\r\n                description: 'Moon shadow slides away THEN morphs to target'\r\n            };\r\n        }\r\n        \r\n        \r\n        // Other shapes to lunar - morph to circle first, then eclipse comes in\r\n        if (to === 'lunar') {\r\n            return {\r\n                type: 'eclipse_enter_lunar',\r\n                startAngle: -30  // Eclipse enters from top-left like moon crescent\r\n            };\r\n        }\r\n        \r\n        // Lunar to moon - special case: shadow exits to crescent position and stays\r\n        if (from === 'lunar' && to === 'moon') {\r\n            return {\r\n                type: 'lunar_to_moon',\r\n                exitAngle: -30\r\n            };\r\n        }\r\n        \r\n        // Lunar to other shapes - eclipse exits first, then morph to target shape\r\n        if (from === 'lunar') {\r\n            return {\r\n                type: 'eclipse_exit_lunar',\r\n                exitAngle: -30  // Eclipse exits at same angle\r\n            };\r\n        }\r\n        \r\n        // Special eclipse transitions for other shapes\r\n        if (fromShape?.shadow?.type === 'none' && toShape?.shadow?.type === 'solar') {\r\n            return {\r\n                type: 'eclipse_enter',\r\n                direction: 'right'\r\n            };\r\n        }\r\n        \r\n        if (fromShape?.shadow?.type === 'solar' && toShape?.shadow?.type === 'none') {\r\n            return {\r\n                type: 'eclipse_exit',\r\n                direction: 'left'\r\n            };\r\n        }\r\n        \r\n        // Sun transitions need effect fading/blooming\r\n        if (from === 'sun' && to !== 'sun') {\r\n            return {\r\n                type: 'sun_fade',\r\n                fadeEffects: true\r\n            };\r\n        }\r\n        \r\n        if (from !== 'sun' && to === 'sun') {\r\n            return {\r\n                type: 'sun_bloom',\r\n                bloomEffects: true\r\n            };\r\n        }\r\n        \r\n        return {\r\n            type: 'standard'\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Get current shadow configuration\r\n     * @returns {Object} Shadow configuration\r\n     */\r\n    getCurrentShadow() {\r\n        // Default to circle if currentShape is somehow null/undefined\r\n        const shapeName = this.currentShape || 'circle';\r\n        const currentDef = SHAPE_DEFINITIONS[shapeName];\r\n        const targetDef = this.targetShape ? SHAPE_DEFINITIONS[this.targetShape] : null;\r\n        \r\n        const currentShadow = currentDef?.shadow || { type: 'none' };\r\n        const targetShadow = targetDef?.shadow || null;\r\n        \r\n        \r\n        // If not transitioning, return current shadow\r\n        if (!this.isTransitioning || !targetShadow) {\r\n            return currentShadow;\r\n        }\r\n        \r\n        // Handle eclipse progressions and other special transitions\r\n        const easedProgress = this.morphProgress;\r\n        \r\n        \r\n        // FROM MOON - ALWAYS slide shadow away first (other shapes)\r\n        if (this.transitionConfig && this.transitionConfig.type === 'from_moon' && this.transitionConfig.slideOutCrescent) {\r\n            const slideRatio = this.transitionConfig.shadowSlideRatio || 0.4;\r\n            \r\n            // PHASE 1: Shadow slides away\r\n            if (easedProgress < slideRatio) {\r\n                const slideProgress = easedProgress / slideRatio; // 0 to 1 during slide\r\n                const angle = -30 * Math.PI / 180; // Moon shadow angle (bottom-left)\r\n                \r\n                // Shadow continues sliding in its direction (away to bottom-left)\r\n                const startOffset = 0.7;  // Where moon shadow normally sits\r\n                const endOffset = 2.5;    // Far off screen\r\n                const currentOffset = startOffset + (endOffset - startOffset) * slideProgress;\r\n                \r\n                const offsetX = Math.cos(angle) * currentOffset;\r\n                const offsetY = Math.sin(angle) * currentOffset;\r\n                \r\n                // Keep full opacity while sliding, slight fade at the end\r\n                const coverage = slideProgress > 0.8 ? 0.85 * (1 - (slideProgress - 0.8) * 5) : 0.85;\r\n                \r\n                return {\r\n                    type: 'crescent',\r\n                    coverage: coverage,\r\n                    angle: -30,\r\n                    offset: currentOffset,\r\n                    shadowX: offsetX,\r\n                    shadowY: offsetY\r\n                };\r\n            }\r\n            \r\n            // PHASE 2: No shadow, morph can proceed\r\n            return { type: 'none' };\r\n        }\r\n        \r\n        // Moon to lunar - smooth crescent to eclipse transition\r\n        if (this.transitionConfig && this.transitionConfig.type === 'moon_to_lunar') {\r\n            const angle = this.transitionConfig.startAngle * Math.PI / 180;\r\n            const offsetProgress = 1 - easedProgress; // Goes from 1 to 0 (crescent position to center)\r\n            const offsetX = Math.cos(angle) * 0.7 * offsetProgress;\r\n            const offsetY = Math.sin(angle) * 0.7 * offsetProgress;\r\n            \r\n            // Smooth transition from crescent to lunar\r\n            const lunarBlend = Math.pow(easedProgress, 2); // Quadratic for smooth blend\r\n            \r\n            // Gradually change from crescent to lunar shadow\r\n            if (easedProgress < 0.6) {\r\n                // Still mostly crescent, moving to center\r\n                return {\r\n                    type: 'crescent',\r\n                    coverage: 0.85 * (1 - lunarBlend * 0.2), // Slight fade\r\n                    angle: this.transitionConfig.startAngle,\r\n                    offset: 0.7 * offsetProgress,\r\n                    shadowX: offsetX,\r\n                    shadowY: offsetY\r\n                };\r\n            } else {\r\n                // Smooth blend to lunar shadow\r\n                const blendPhase = (easedProgress - 0.6) / 0.4; // 0 to 1 for last 40%\r\n                const smoothBlend = Math.sin(blendPhase * Math.PI / 2); // Smooth S-curve\r\n                \r\n                return {\r\n                    type: 'lunar',\r\n                    coverage: 0.85 + 0.1 * smoothBlend, // Gradually increase to 0.95\r\n                    color: `rgba(80, 20, 0, ${0.7 + 0.2 * smoothBlend})`, // Fade in red\r\n                    shadowX: offsetX * (1 - smoothBlend), // Smooth center\r\n                    shadowY: offsetY * (1 - smoothBlend),\r\n                    diffusion: smoothBlend,\r\n                    shadowProgress: easedProgress\r\n                };\r\n            }\r\n        }\r\n        \r\n        // Eclipse entering lunar - smooth shadow entry\r\n        if (this.transitionConfig && this.transitionConfig.type === 'eclipse_enter_lunar') {\r\n            // First 30%: Just morph shape, no shadow (reduced from 40%)\r\n            if (easedProgress < 0.3) {\r\n                return { type: 'none' };\r\n            }\r\n            \r\n            // Last 70%: Shadow smoothly enters and transforms\r\n            const shadowProgress = (easedProgress - 0.3) / 0.7; // 0 to 1 for shadow animation\r\n            const smoothProgress = Math.sin(shadowProgress * Math.PI / 2); // Smooth ease-in\r\n            const angle = this.transitionConfig.startAngle * Math.PI / 180;\r\n            const offsetProgress = 1 - smoothProgress; // Goes from 1 to 0\r\n            const offsetX = Math.cos(angle) * 0.7 * offsetProgress;\r\n            const offsetY = Math.sin(angle) * 0.7 * offsetProgress;\r\n            \r\n            // Smooth transition throughout\r\n            if (shadowProgress < 0.7) {\r\n                // Crescent shadow sliding in with gradual fade\r\n                const fadeIn = Math.pow(shadowProgress / 0.7, 0.5); // Smooth fade in\r\n                return {\r\n                    type: 'crescent',\r\n                    coverage: 0.85 * fadeIn,\r\n                    angle: this.transitionConfig.startAngle,\r\n                    offset: 0.7 * offsetProgress,\r\n                    shadowX: offsetX,\r\n                    shadowY: offsetY\r\n                };\r\n            } else {\r\n                // Smooth blend to lunar\r\n                const blendProgress = (shadowProgress - 0.7) / 0.3; // Last 30% for blend\r\n                const smoothBlend = Math.sin(blendProgress * Math.PI / 2); // Smooth curve\r\n                \r\n                return {\r\n                    type: 'lunar',\r\n                    coverage: 0.85 + 0.1 * smoothBlend,\r\n                    color: `rgba(80, 20, 0, ${0.6 + 0.3 * smoothBlend})`,\r\n                    shadowX: offsetX * (1 - smoothBlend),\r\n                    shadowY: offsetY * (1 - smoothBlend),\r\n                    diffusion: smoothBlend,\r\n                    shadowProgress: shadowProgress\r\n                };\r\n            }\r\n        }\r\n        \r\n        // Lunar to moon - smooth shadow transformation and movement\r\n        if (this.transitionConfig && this.transitionConfig.type === 'lunar_to_moon') {\r\n            const angle = this.transitionConfig.exitAngle * Math.PI / 180;\r\n            \r\n            // Smooth movement curve\r\n            const movementCurve = Math.sin(easedProgress * Math.PI / 2); // Smooth ease-out\r\n            const offsetX = Math.cos(angle) * 0.7 * movementCurve;\r\n            const offsetY = Math.sin(angle) * 0.7 * movementCurve;\r\n            \r\n            // Smooth blend between lunar and crescent\r\n            if (easedProgress < 0.6) {\r\n                // Lunar shadow gradually transforming\r\n                const transformPhase = easedProgress / 0.6;\r\n                const smoothTransform = Math.pow(transformPhase, 0.7);\r\n                \r\n                return {\r\n                    type: 'lunar',\r\n                    coverage: 0.95 - (0.1 * smoothTransform),\r\n                    color: `rgba(80, 20, 0, ${0.9 - 0.3 * smoothTransform})`,\r\n                    shadowX: offsetX * 0.7, // Start moving earlier\r\n                    shadowY: offsetY * 0.7,\r\n                    diffusion: 1 - smoothTransform\r\n                };\r\n            } else {\r\n                // Smooth transition to crescent\r\n                const crescentPhase = (easedProgress - 0.6) / 0.4;\r\n                const fadeIn = Math.sin(crescentPhase * Math.PI / 2);\r\n                \r\n                return {\r\n                    type: 'crescent',\r\n                    coverage: 0.85 * fadeIn + 0.1, // Smooth fade in\r\n                    angle: this.transitionConfig.exitAngle,\r\n                    offset: 0.7,\r\n                    shadowX: offsetX,\r\n                    shadowY: offsetY\r\n                };\r\n            }\r\n        }\r\n        \r\n        // Eclipse exiting lunar - smooth shadow exit\r\n        if (this.transitionConfig && this.transitionConfig.type === 'eclipse_exit_lunar') {\r\n            // First 70%: Shadow smoothly exits\r\n            if (easedProgress < 0.7) {\r\n                const shadowProgress = easedProgress / 0.7; // 0 to 1 for shadow exit\r\n                const smoothExit = Math.sin(shadowProgress * Math.PI / 2); // Smooth acceleration\r\n                const angle = this.transitionConfig.exitAngle * Math.PI / 180;\r\n                \r\n                // Gradual transformation and movement\r\n                if (shadowProgress < 0.4) {\r\n                    // Lunar shadow gradually transforming\r\n                    const transformPhase = shadowProgress / 0.4;\r\n                    const diffusion = 1 - transformPhase;\r\n                    const moveStart = transformPhase * 0.3; // Start moving early\r\n                    \r\n                    return {\r\n                        type: 'lunar',\r\n                        coverage: 0.95 - (0.1 * transformPhase),\r\n                        color: `rgba(80, 20, 0, ${0.9 - 0.2 * transformPhase})`,\r\n                        shadowX: Math.cos(angle) * 0.7 * moveStart,\r\n                        shadowY: Math.sin(angle) * 0.7 * moveStart,\r\n                        diffusion: diffusion\r\n                    };\r\n                } else {\r\n                    // Smooth exit as crescent\r\n                    const exitPhase = (shadowProgress - 0.4) / 0.6;\r\n                    const smoothMove = Math.pow(exitPhase, 0.8);\r\n                    const offsetX = Math.cos(angle) * 0.7 * smoothMove;\r\n                    const offsetY = Math.sin(angle) * 0.7 * smoothMove;\r\n                    const fadeOut = 1 - Math.pow(exitPhase, 2); // Gradual fade\r\n                    \r\n                    return {\r\n                        type: 'crescent',\r\n                        coverage: 0.85 * fadeOut,\r\n                        angle: this.transitionConfig.exitAngle,\r\n                        offset: 0.7 * smoothMove,\r\n                        shadowX: offsetX,\r\n                        shadowY: offsetY\r\n                    };\r\n                }\r\n            }\r\n            \r\n            // Last 30%: Just morph shape, no shadow\r\n            return { type: 'none' };\r\n        }\r\n        \r\n        // Solar eclipse transitions\r\n        if (this.transitionConfig && this.transitionConfig.type === 'eclipse_enter') {\r\n            const shadowX = 1.5 - (easedProgress * 1.5); // From right\r\n            \r\n            return {\r\n                ...targetShadow,\r\n                shadowX: shadowX,\r\n                shadowProgress: easedProgress\r\n            };\r\n        } else if (this.transitionConfig.type === 'eclipse_exit') {\r\n            const shadowX = -easedProgress * 1.5; // To left\r\n            \r\n            return {\r\n                ...currentShadow,\r\n                coverage: currentShadow.coverage * (1 - easedProgress),\r\n                shadowX: shadowX,\r\n                shadowProgress: 1 - easedProgress\r\n            };\r\n        } else if (this.transitionConfig.type === 'sun_fade') {\r\n            // Smooth fading of sun effects\r\n            const fadeMultiplier = 1 - easedProgress;\r\n            \r\n            // Gradual fade with different timing for each effect\r\n            return {\r\n                ...currentShadow,\r\n                intensity: (currentShadow.intensity || 1) * Math.pow(fadeMultiplier, 0.7), // Slower fade\r\n                corona: currentShadow.corona,\r\n                coronaOpacity: fadeMultiplier, // Fade corona smoothly\r\n                flares: currentShadow.flares,\r\n                flaresOpacity: Math.pow(fadeMultiplier, 1.5), // Flares fade faster\r\n                texture: currentShadow.texture,\r\n                textureOpacity: Math.pow(fadeMultiplier, 2), // Texture fades fastest\r\n                turbulence: (currentShadow.turbulence || 0.3) * fadeMultiplier\r\n            };\r\n        } else if (this.transitionConfig.type === 'sun_bloom') {\r\n            // Smooth blooming of sun effects\r\n            const bloomProgress = easedProgress;\r\n            \r\n            // Gradual bloom with different timing for each effect\r\n            return {\r\n                ...targetShadow,\r\n                intensity: (targetShadow.intensity || 1) * Math.pow(bloomProgress, 1.5), // Start slow\r\n                corona: targetShadow.corona,\r\n                coronaOpacity: Math.pow(bloomProgress, 0.8), // Corona blooms gradually\r\n                flares: targetShadow.flares,\r\n                flaresOpacity: bloomProgress > 0.3 ? Math.pow((bloomProgress - 0.3) / 0.7, 0.7) : 0, // Flares appear later\r\n                texture: targetShadow.texture,\r\n                textureOpacity: bloomProgress > 0.5 ? Math.pow((bloomProgress - 0.5) / 0.5, 2) : 0, // Texture appears last\r\n                turbulence: (targetShadow.turbulence || 0.3) * bloomProgress\r\n            };\r\n        }\r\n        \r\n        // Standard transition\r\n        if (currentShadow.type !== 'none' || targetShadow.type !== 'none') {\r\n            const coverage = (currentShadow.coverage || 0) + \r\n                           ((targetShadow.coverage || 0) - (currentShadow.coverage || 0)) * easedProgress;\r\n            \r\n            return {\r\n                type: targetShadow.type !== 'none' ? targetShadow.type : currentShadow.type,\r\n                coverage: coverage,\r\n                angle: targetShadow.angle || currentShadow.angle || 0,\r\n                softness: targetShadow.softness || currentShadow.softness || 0.2,\r\n                progress: easedProgress\r\n            };\r\n        }\r\n        \r\n        return currentShadow;\r\n    }\r\n    \r\n    /**\r\n     * Get custom renderer for current shape\r\n     * @returns {Function|null} Custom render function\r\n     */\r\n    getCurrentRenderer() {\r\n        // For now, return null - rendering is handled by EmotiveRenderer\r\n        // This can be extended later if we want shape-specific rendering\r\n        return null;\r\n    }\r\n    \r\n    /**\r\n     * Apply easing function\r\n     */\r\n    applyEasing(t) {\r\n        const easing = this.transitionConfig?.easing || this.easing || 'linear';\r\n        switch (easing) {\r\n            case 'linear':\r\n                return t;\r\n            case 'easeInQuad':\r\n                return t * t;\r\n            case 'easeOutQuad':\r\n                return t * (2 - t);\r\n            case 'easeInOutQuad':\r\n                return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\r\n            case 'easeInOutSine':\r\n                return -(Math.cos(Math.PI * t) - 1) / 2;\r\n            case 'easeInOutCubic':\r\n            default:\r\n                return t < 0.5 \r\n                    ? 4 * t * t * t \r\n                    : 1 - Math.pow(-2 * t + 2, 3) / 2;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Calculate BPM from onset intervals with improved stability\r\n     */\r\n    calculateBPM() {\r\n        return this.musicDetector.calculateBPM();\r\n    }\r\n    \r\n    /**\r\n     * Find tempo candidates from onset intervals\r\n     */\r\n    findTempoCandidates(intervals) {\r\n        return this.musicDetector.findTempoCandidates(intervals);\r\n    }\r\n    \r\n    /**\r\n     * Cluster similar intervals together\r\n     */\r\n    clusterIntervals(intervals) {\r\n        return this.musicDetector.clusterIntervals(intervals);\r\n    }\r\n    \r\n    /**\r\n     * Check if BPM is a harmonic of the fundamental\r\n     */\r\n    checkHarmonicRelation(bpm1, bpm2) {\r\n        return this.musicDetector.checkHarmonicRelation(bpm1, bpm2);\r\n    }\r\n    \r\n    /**\r\n     * Detect time signature from onset patterns - delegated to MusicDetector\r\n     */\r\n    detectTimeSignature() {\r\n        // Set fast detection mode if needed\r\n        this.musicDetector.forceFastDetection = this.forceFastDetection;\r\n        \r\n        // Delegate to MusicDetector\r\n        const timeSignature = this.musicDetector.detectTimeSignature();\r\n        \r\n        // Update local references for compatibility\r\n        this.detectedTimeSignature = this.musicDetector.detectedTimeSignature;\r\n        this.timeSignatureConfidence = this.musicDetector.timeSignatureConfidence;\r\n        this.timeSignatureLocked = this.musicDetector.timeSignatureLocked;\r\n        \r\n        return timeSignature;\r\n    }\r\n    \r\n    /**\r\n     * Test specifically for 3/4 waltz pattern - delegated to MusicDetector\r\n     */\r\n    testWaltzPattern(onsets, beatInterval) {\r\n        return this.musicDetector.testWaltzPattern(onsets, beatInterval);\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Reset music detection when new audio is loaded\r\n     */\r\n    resetMusicDetection() {\r\n        // Store if we should force fast detection (for resampling)\r\n        this.forceFastDetection = true;\r\n        \r\n        // Reset music detector\r\n        this.musicDetector.reset();\r\n        \r\n        // Set fast detection on the music detector\r\n        this.musicDetector.forceFastDetection = true;\r\n        \r\n        // Reset local references\r\n        this.onsetThreshold = 0;\r\n        this.detectedBPM = 0;\r\n        this.bpmConfidence = 0;\r\n        \r\n        // Reset time signature detection (still local for now)\r\n        this.onsetStrengths = [];\r\n        this.detectedTimeSignature = null;\r\n        this.timeSignatureConfidence = 0;\r\n        \r\n        // Force immediate resampling on next update\r\n        this.musicDetector.lastBPMCalculation = 0;\r\n        this.measureStartTime = 0;\r\n        this.timeSignatureHistory = [];\r\n        this.timeSignatureLocked = false;\r\n        \r\n        // Reset spectral analysis\r\n        this.spectralHistory = [];\r\n        this.spectralFluxHistory = [];\r\n        \r\n        // Clear UI displays\r\n        const timeSigDisplay = document.getElementById('time-sig-display');\r\n        if (timeSigDisplay) {\r\n            timeSigDisplay.textContent = '—';\r\n        }\r\n        \r\n    }\r\n    \r\n    /**\r\n     * Get current detected BPM and time signature\r\n     */\r\n    getCurrentMusicInfo() {\r\n        return {\r\n            bpm: this.detectedBPM,\r\n            timeSignature: this.detectedTimeSignature,\r\n            bpmLocked: this.tempoLocked,\r\n            timeSigLocked: this.timeSignatureLocked\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Fallback circle generation\r\n     */\r\n    generateFallbackCircle() {\r\n        const points = [];\r\n        for (let i = 0; i < this.numPoints; i++) {\r\n            const angle = (i / this.numPoints) * Math.PI * 2;\r\n            points.push({\r\n                x: 0.5 + Math.cos(angle) * 0.5,\r\n                y: 0.5 + Math.sin(angle) * 0.5\r\n            });\r\n        }\r\n        return points;\r\n    }\r\n    \r\n    /**\r\n     * Get current state\r\n     */\r\n    getState() {\r\n        return {\r\n            currentShape: this.currentShape,\r\n            targetShape: this.targetShape,\r\n            isTransitioning: this.isTransitioning,\r\n            progress: this.morphProgress,\r\n            audioDeformation: this.audioDeformation,\r\n            vocalEnergy: this.vocalEnergy\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Get progress (0-1)\r\n     * @param {boolean} visual - Return smoothed visual progress instead of logical\r\n     */\r\n    getProgress(visual = true) {\r\n        // Default to visual progress for smooth rendering\r\n        return visual ? this.visualProgress : this.morphProgress;\r\n    }\r\n    \r\n    /**\r\n     * Check if currently transitioning\r\n     */\r\n    isInTransition() {\r\n        return this.isTransitioning;\r\n    }\r\n}\r\n\r\nexport default ShapeMorpher;","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE - Audio Analysis System\r\n *  └─○═╝                                                                             \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview Real-time audio analysis for vocal visualization\r\n * @author Emotive Engine Team\r\n * @module core/AudioAnalyzer\r\n */\r\n\r\n/**\r\n * AudioAnalyzer - Analyzes audio for vocal visualization\r\n */\r\nexport class AudioAnalyzer {\r\n    constructor() {\r\n        this.audioContext = null;\r\n        this.analyser = null;\r\n        this.source = null;\r\n        this.elementSource = null;  // Track audio element source separately\r\n        this.dataArray = null;\r\n        this.isAnalyzing = false;\r\n        this.connectedElement = null;\r\n        this.gainNode = null;  // Store gain node for cleanup\r\n        \r\n        // Frequency band configuration\r\n        this.frequencyBands = 32;\r\n        this.smoothingFactor = 0.3; // Lower smoothing for better responsiveness\r\n        \r\n        // Vocal detection\r\n        this.vocalRange = { min: 80, max: 1000 }; // Hz - typical vocal range\r\n        this.currentAmplitude = 0;\r\n        this.currentFrequencies = new Array(this.frequencyBands).fill(0);\r\n        \r\n        // Beat detection (for rhythm sync)\r\n        this.beatThreshold = 0.3;\r\n        this.lastBeatTime = 0;\r\n        this.beatCallbacks = [];\r\n    }\r\n    \r\n    /**\r\n     * Initialize audio context and analyzer\r\n     */\r\n    async init() {\r\n        try {\r\n            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n            this.analyser = this.audioContext.createAnalyser();\r\n            this.analyser.fftSize = 2048; // Good balance of frequency/time resolution\r\n            this.analyser.smoothingTimeConstant = 0.5; // Moderate smoothing\r\n            \r\n            const bufferLength = this.analyser.frequencyBinCount;\r\n            this.dataArray = new Uint8Array(bufferLength);\r\n            \r\n            return true;\r\n        } catch (error) {\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Connect audio element for analysis\r\n     * @param {HTMLAudioElement} audioElement - Audio element to analyze\r\n     */\r\n    connectAudioElement(audioElement) {\r\n        if (!this.audioContext) {\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            // Create source from audio element (only if not already created)\r\n            if (!this.elementSource || this.connectedElement !== audioElement) {\r\n                this.elementSource = this.audioContext.createMediaElementSource(audioElement);\r\n                this.elementSource.connect(this.analyser);\r\n                this.elementSource.connect(this.audioContext.destination); // Pass through audio\r\n            }\r\n            this.source = this.elementSource;  // Set current source\r\n            this.connectedElement = audioElement;\r\n            this.isAnalyzing = true;\r\n            \r\n            // Start analysis loop\r\n            this.analyze();\r\n        } catch (error) {\r\n            // If already connected, just restart analysis\r\n            if (error.message && error.message.includes('already been used')) {\r\n                this.source = this.elementSource;  // Use existing source\r\n                this.connectedElement = audioElement;\r\n                this.isAnalyzing = true;\r\n                this.analyze();\r\n            } else {\r\n            }\r\n        }\r\n    }\r\n    \r\n    \r\n    /**\r\n     * Main analysis loop\r\n     */\r\n    analyze() {\r\n        if (!this.isAnalyzing) return;\r\n        \r\n        requestAnimationFrame(() => this.analyze());\r\n        \r\n        // Get frequency data\r\n        this.analyser.getByteFrequencyData(this.dataArray);\r\n        \r\n        // Also try time domain data to see if mic is working\r\n        const timeData = new Uint8Array(this.analyser.frequencyBinCount);\r\n        this.analyser.getByteTimeDomainData(timeData);\r\n        \r\n        // Debug: Check both frequency and time domain\r\n        if (!this._debugLogged) {\r\n            const freqMax = Math.max(...this.dataArray);\r\n            const timeMax = Math.max(...timeData);\r\n            const timeMin = Math.min(...timeData);\r\n            \r\n            if (freqMax > 0 || (timeMax !== 128 || timeMin !== 128)) {\r\n                console.log('AudioAnalyzer: Got audio data! Freq max:', freqMax, 'Time range:', timeMin, '-', timeMax);\r\n                this._debugLogged = true;\r\n            } else {\r\n                // Log every 60 frames (1 second at 60fps)\r\n                if (!this._debugCounter) this._debugCounter = 0;\r\n                this._debugCounter++;\r\n                if (this._debugCounter % 60 === 0) {\r\n                    console.log('AudioAnalyzer: No data. Freq all zeros, Time at 128 (silence)');\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Calculate overall amplitude\r\n        let sum = 0;\r\n        let vocalSum = 0;\r\n        let vocalCount = 0;\r\n        \r\n        // Frequency to bin conversion\r\n        const nyquist = this.audioContext.sampleRate / 2;\r\n        const binHz = nyquist / this.dataArray.length;\r\n        const vocalMinBin = Math.floor(this.vocalRange.min / binHz);\r\n        const vocalMaxBin = Math.ceil(this.vocalRange.max / binHz);\r\n        \r\n        // Process frequency data\r\n        for (let i = 0; i < this.dataArray.length; i++) {\r\n            const value = this.dataArray[i] / 255; // Normalize to 0-1\r\n            sum += value;\r\n            \r\n            // Check if in vocal range\r\n            if (i >= vocalMinBin && i <= vocalMaxBin) {\r\n                vocalSum += value;\r\n                vocalCount++;\r\n            }\r\n        }\r\n        \r\n        // Calculate amplitudes\r\n        this.currentAmplitude = sum / this.dataArray.length;\r\n        const vocalAmplitude = vocalCount > 0 ? vocalSum / vocalCount : 0;\r\n        \r\n        // Extract frequency bands for visualization\r\n        this.extractFrequencyBands();\r\n        \r\n        // Detect beats\r\n        this.detectBeat(this.currentAmplitude);\r\n        \r\n        // Return analysis data\r\n        return {\r\n            amplitude: this.currentAmplitude,\r\n            vocalAmplitude: vocalAmplitude,\r\n            frequencies: this.currentFrequencies,\r\n            rawData: this.dataArray\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Extract frequency bands for shape deformation\r\n     */\r\n    extractFrequencyBands() {\r\n        const bandsPerBin = Math.floor(this.dataArray.length / this.frequencyBands);\r\n        \r\n        for (let i = 0; i < this.frequencyBands; i++) {\r\n            let sum = 0;\r\n            const startBin = i * bandsPerBin;\r\n            const endBin = Math.min(startBin + bandsPerBin, this.dataArray.length);\r\n            \r\n            for (let j = startBin; j < endBin; j++) {\r\n                sum += this.dataArray[j] / 255; // Normalize\r\n            }\r\n            \r\n            // Apply smoothing\r\n            const newValue = sum / bandsPerBin;\r\n            this.currentFrequencies[i] = this.currentFrequencies[i] * this.smoothingFactor + \r\n                                         newValue * (1 - this.smoothingFactor);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Simple beat detection\r\n     */\r\n    detectBeat(amplitude) {\r\n        const now = performance.now();\r\n        \r\n        // Simple threshold-based beat detection\r\n        // Allow faster beats - 273ms = 220 BPM, but go down to 60ms for very fast tapping\r\n        if (amplitude > this.beatThreshold && now - this.lastBeatTime > 60) {\r\n            this.lastBeatTime = now;\r\n            \r\n            // Trigger beat callbacks\r\n            this.beatCallbacks.forEach(callback => callback(amplitude));\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get current vocal instability (0-1)\r\n     */\r\n    getVocalInstability() {\r\n        // Calculate instability based on frequency variance\r\n        let variance = 0;\r\n        const mean = this.currentFrequencies.reduce((a, b) => a + b, 0) / this.frequencyBands;\r\n        \r\n        for (let i = 0; i < this.frequencyBands; i++) {\r\n            variance += Math.pow(this.currentFrequencies[i] - mean, 2);\r\n        }\r\n        \r\n        variance = Math.sqrt(variance / this.frequencyBands);\r\n        \r\n        // Combine with amplitude for overall instability\r\n        const instability = Math.min(1, variance * 2 + this.currentAmplitude * 0.5);\r\n        return instability;\r\n    }\r\n    \r\n    /**\r\n     * Get analysis data formatted for ShapeMorpher\r\n     */\r\n    getShapeMorpherData() {\r\n        return {\r\n            instability: this.getVocalInstability(),\r\n            frequencies: [...this.currentFrequencies],\r\n            amplitude: this.currentAmplitude\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Add beat detection callback\r\n     */\r\n    onBeat(callback) {\r\n        this.beatCallbacks.push(callback);\r\n    }\r\n    \r\n    /**\r\n     * Stop analysis\r\n     */\r\n    stop() {\r\n        this.isAnalyzing = false;\r\n        \r\n        if (this.gainNode) {\r\n            try {\r\n                this.gainNode.disconnect();\r\n            } catch (e) {}\r\n            this.gainNode = null;\r\n        }\r\n        \r\n        // Reconnect element source to analyser if it was disconnected\r\n        if (this.elementSource && this.connectedElement) {\r\n            try {\r\n                this.elementSource.connect(this.analyser);\r\n            } catch (e) {\r\n                // Already connected, that's fine\r\n            }\r\n            this.source = this.elementSource;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Resume audio context (needed after user interaction)\r\n     */\r\n    async resume() {\r\n        if (this.audioContext && this.audioContext.state === 'suspended') {\r\n            await this.audioContext.resume();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Cleanup\r\n     */\r\n    destroy() {\r\n        this.stop();\r\n        \r\n        if (this.audioContext) {\r\n            this.audioContext.close();\r\n            this.audioContext = null;\r\n        }\r\n        \r\n        this.analyser = null;\r\n        this.dataArray = null;\r\n        this.beatCallbacks = [];\r\n    }\r\n}","/**\r\n * GestureCompatibility - Core gesture compatibility and chord system\r\n * Defines which gestures can execute simultaneously vs sequentially\r\n * Part of the Emotive Engine core\r\n */\r\n\r\nexport class GestureCompatibility {\r\n    constructor() {\r\n        // Musical timing classes - defines when gestures should fire\r\n        this.timingClasses = {\r\n            downbeat: {\r\n                gestures: ['bounce', 'jump', 'headBob', 'spin', 'orbit'],\r\n                timing: 1.0,  // Fire on the beat\r\n                priority: 1,\r\n                description: 'Strong emphasis on the downbeat'\r\n            },\r\n            upbeat: {\r\n                gestures: ['wave', 'nod', 'point', 'reach'],\r\n                timing: 0.5,  // Fire on the half-beat\r\n                priority: 2,\r\n                description: 'Medium emphasis on upbeat'\r\n            },\r\n            offbeat: {\r\n                gestures: ['wiggle', 'sway', 'lean', 'tilt', 'groove'],\r\n                timing: 0.5,  // Fire between beats (syncopated)\r\n                priority: 3,\r\n                description: 'Syncopated, creates groove'\r\n            },\r\n            subdivision: {\r\n                gestures: ['pulse', 'sparkle', 'flash', 'shimmer', 'flicker'],\r\n                timing: 0.25,  // Can fire on quarter beats\r\n                priority: 4,\r\n                description: 'Quick accents and fills'\r\n            },\r\n            continuous: {\r\n                gestures: ['breathe', 'float', 'rain'],\r\n                timing: -1,  // Can start anytime, flows across beats\r\n                priority: 5,\r\n                description: 'Ambient, continuous motion'\r\n            }\r\n        };\r\n\r\n        // Fill patterns for automatic motion between gestures\r\n        this.fillPatterns = {\r\n            subtle: ['breathe', 'float'],\r\n            rhythmic: ['pulse', 'shimmer'],\r\n            energetic: ['wiggle', 'sparkle'],\r\n            smooth: ['sway', 'glow']\r\n        };\r\n\r\n        // Dynamic density settings based on BPM\r\n        this.densityProfiles = {\r\n            sparse: {\r\n                fillProbability: 0.1,\r\n                subdivisionLevel: 2,  // Half notes only\r\n                description: 'Minimal movement'\r\n            },\r\n            moderate: {\r\n                fillProbability: 0.3,\r\n                subdivisionLevel: 4,  // Quarter notes\r\n                description: 'Balanced movement'\r\n            },\r\n            dense: {\r\n                fillProbability: 0.5,\r\n                subdivisionLevel: 8,  // Eighth notes\r\n                description: 'Busy, energetic'\r\n            },\r\n            chaos: {\r\n                fillProbability: 0.8,\r\n                subdivisionLevel: 16,  // Sixteenth notes\r\n                description: 'Maximum energy'\r\n            }\r\n        };\r\n\r\n        // Gesture group definitions\r\n        this.groups = {\r\n            // Primary movement - only one can execute at a time\r\n            movement: {\r\n                gestures: ['bounce', 'spin', 'orbit', 'sway', 'hula', 'jump', 'twist', 'groove'],\r\n                maxSimultaneous: 1,\r\n                priority: 1,\r\n                description: 'Primary body movements - mutually exclusive'\r\n            },\r\n\r\n            // Secondary movements - can layer 2 together\r\n            expression: {\r\n                gestures: ['wave', 'nod', 'shake', 'point', 'lean', 'tilt', 'reach'],\r\n                maxSimultaneous: 2,\r\n                priority: 2,\r\n                description: 'Expressive gestures - can combine up to 2'\r\n            },\r\n\r\n            // Dance moves - special category that can combine with effects\r\n            dance: {\r\n                gestures: ['headBob', 'wiggle', 'runningman', 'charleston'],\r\n                maxSimultaneous: 1,\r\n                priority: 2,\r\n                description: 'Dance moves - one at a time but can add effects'\r\n            },\r\n\r\n            // Visual effects - all can stack\r\n            effects: {\r\n                gestures: ['pulse', 'glow', 'sparkle', 'flash', 'shimmer', 'flicker'],\r\n                maxSimultaneous: -1, // Unlimited\r\n                priority: 3,\r\n                description: 'Visual effects - all can layer together'\r\n            },\r\n\r\n            // Ambient modifiers - always allowed to layer\r\n            modifiers: {\r\n                gestures: ['breathe', 'float', 'rain'],\r\n                maxSimultaneous: -1, // Unlimited\r\n                priority: 4,\r\n                description: 'Ambient effects - always allowed'\r\n            }\r\n        };\r\n\r\n        // Specific combinations that work well together\r\n        this.enhancingCombinations = [\r\n            ['bounce', 'sparkle'],\r\n            ['spin', 'glow'],\r\n            ['wave', 'pulse'],\r\n            ['nod', 'pulse'],\r\n            ['jump', 'flash'],\r\n            ['sway', 'breathe'],\r\n            ['float', 'shimmer'],\r\n            ['orbit', 'sparkle'],\r\n            ['headBob', 'pulse']\r\n        ];\r\n\r\n        // Gestures that should never combine\r\n        this.incompatiblePairs = [\r\n            ['bounce', 'jump'],\r\n            ['spin', 'orbit'],\r\n            ['wave', 'point'],\r\n            ['nod', 'shake'],\r\n            ['lean', 'tilt']\r\n        ];\r\n\r\n        // Pre-defined chord combinations\r\n        this.chords = {\r\n            celebrate: ['bounce', 'sparkle', 'pulse'],\r\n            greeting: ['wave', 'nod', 'glow'],\r\n            excited: ['jump', 'flash', 'wiggle'],\r\n            mystical: ['float', 'shimmer', 'breathe'],\r\n            party: ['headBob', 'pulse', 'sparkle'],\r\n            smooth: ['sway', 'glow', 'breathe'],\r\n            dramatic: ['spin', 'flash', 'sparkle']\r\n        };\r\n\r\n        // Chain definitions with simultaneous markers\r\n        // '+' means simultaneous, '>' means sequential\r\n        this.chains = {\r\n            buildup: 'pulse > pulse > bounce+sparkle > spin+flash',\r\n            cascade: 'wave > lean > tilt > spin > bounce+glow',\r\n            celebrate: 'bounce+sparkle > spin > jump+flash > headBob+pulse',\r\n            smooth: 'sway+breathe > float > orbit+shimmer > sway+glow',\r\n            chaos: 'wiggle > shake+flash > spin+sparkle > bounce+pulse > twist',\r\n            greeting: 'wave+glow > nod+pulse > wave',\r\n            mystical: 'float+shimmer > orbit+breathe > spin+sparkle > float+glow',\r\n            dance: 'headBob > bounce+pulse > spin > sway+glow > headBob+sparkle'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Check if two gestures can execute simultaneously\r\n     * @param {string} gesture1 - First gesture name\r\n     * @param {string} gesture2 - Second gesture name\r\n     * @returns {boolean} - True if they can execute together\r\n     */\r\n    canExecuteSimultaneously(gesture1, gesture2) {\r\n        // Check if they're the same gesture\r\n        if (gesture1 === gesture2) return false;\r\n\r\n        // Check if they're in incompatible list\r\n        const incompatible = this.incompatiblePairs.some(pair =>\r\n            (pair.includes(gesture1) && pair.includes(gesture2))\r\n        );\r\n        if (incompatible) return false;\r\n\r\n        // Get groups for each gesture\r\n        const group1 = this.getGestureGroup(gesture1);\r\n        const group2 = this.getGestureGroup(gesture2);\r\n\r\n        // If same group, check maxSimultaneous\r\n        if (group1 === group2) {\r\n            const group = this.groups[group1];\r\n            return group && group.maxSimultaneous !== 1;\r\n        }\r\n\r\n        // Different groups can usually combine\r\n        // Movement can't combine with other movement\r\n        if (group1 === 'movement' && group2 === 'movement') return false;\r\n        if (group1 === 'dance' && group2 === 'dance') return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Get the group a gesture belongs to\r\n     * @param {string} gesture - Gesture name\r\n     * @returns {string|null} - Group name or null\r\n     */\r\n    getGestureGroup(gesture) {\r\n        for (const [groupName, group] of Object.entries(this.groups)) {\r\n            if (group.gestures.includes(gesture)) {\r\n                return groupName;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Get priority of a gesture\r\n     * @param {string} gesture - Gesture name\r\n     * @returns {number} - Priority value (lower = higher priority)\r\n     */\r\n    getGesturePriority(gesture) {\r\n        const group = this.getGestureGroup(gesture);\r\n        return group ? this.groups[group].priority : 99;\r\n    }\r\n\r\n    /**\r\n     * Get compatible gestures from a list that can execute together\r\n     * @param {Array} gestures - Array of gesture objects or names\r\n     * @returns {Array} - Gestures that can execute simultaneously\r\n     */\r\n    getCompatibleGestures(gestures) {\r\n        if (!gestures || gestures.length === 0) return [];\r\n        if (gestures.length === 1) return gestures;\r\n\r\n        const chord = [];\r\n        const used = new Set();\r\n\r\n        // Normalize to gesture names\r\n        const normalizeGesture = (g) => typeof g === 'string' ? g : g.gestureName;\r\n\r\n        // Sort by priority\r\n        const sorted = [...gestures].sort((a, b) => {\r\n            const priorityA = this.getGesturePriority(normalizeGesture(a));\r\n            const priorityB = this.getGesturePriority(normalizeGesture(b));\r\n            return priorityA - priorityB;\r\n        });\r\n\r\n        for (const gesture of sorted) {\r\n            if (used.has(gesture)) continue;\r\n\r\n            const gestureName = normalizeGesture(gesture);\r\n\r\n            // Check if this gesture can combine with all in chord\r\n            let canAdd = true;\r\n            for (const chordItem of chord) {\r\n                const chordGestureName = normalizeGesture(chordItem);\r\n                if (!this.canExecuteSimultaneously(gestureName, chordGestureName)) {\r\n                    canAdd = false;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (canAdd) {\r\n                // Check group limits\r\n                const group = this.groups[this.getGestureGroup(gestureName)];\r\n                if (group && group.maxSimultaneous > 0) {\r\n                    const groupCount = chord.filter(c =>\r\n                        this.getGestureGroup(normalizeGesture(c)) === this.getGestureGroup(gestureName)\r\n                    ).length;\r\n                    if (groupCount >= group.maxSimultaneous) {\r\n                        continue; // Skip, group limit reached\r\n                    }\r\n                }\r\n\r\n                chord.push(gesture);\r\n                used.add(gesture);\r\n            }\r\n        }\r\n\r\n        return chord;\r\n    }\r\n\r\n    /**\r\n     * Parse a chain string into steps of simultaneous gestures\r\n     * @param {string} chainString - Chain definition string\r\n     * @returns {Array<Array<string>>} - Array of steps, each containing simultaneous gestures\r\n     */\r\n    parseChain(chainString) {\r\n        if (!chainString) return [];\r\n\r\n        // Handle predefined chains\r\n        if (this.chains[chainString]) {\r\n            chainString = this.chains[chainString];\r\n        }\r\n\r\n        const steps = chainString.split('>').map(s => s.trim());\r\n        return steps.map(step => {\r\n            // Split by + for simultaneous gestures\r\n            return step.split('+').map(g => g.trim()).filter(g => g);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Check if gestures form an enhancing combination\r\n     * @param {Array} gestures - Array of gesture names\r\n     * @returns {boolean} - True if they enhance each other\r\n     */\r\n    isEnhancingCombination(gestures) {\r\n        const gestureNames = gestures.map(g =>\r\n            typeof g === 'string' ? g : g.gestureName\r\n        );\r\n\r\n        return this.enhancingCombinations.some(combo =>\r\n            combo.every(gesture => gestureNames.includes(gesture))\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get a predefined chord by name\r\n     * @param {string} chordName - Name of the chord\r\n     * @returns {Array<string>|null} - Array of gesture names or null\r\n     */\r\n    getChord(chordName) {\r\n        return this.chords[chordName] || null;\r\n    }\r\n\r\n    /**\r\n     * Create a gesture chord command\r\n     * @param {Array<string>} gestures - Gestures to combine\r\n     * @returns {Object} - Chord command object\r\n     */\r\n    createChord(gestures) {\r\n        const compatible = this.getCompatibleGestures(gestures);\r\n        const isEnhancing = this.isEnhancingCombination(compatible);\r\n\r\n        return {\r\n            type: 'chord',\r\n            gestures: compatible.map(g => typeof g === 'string' ? g : g.gestureName),\r\n            isEnhancing,\r\n            timestamp: Date.now()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Validate if a gesture exists in the system\r\n     * @param {string} gesture - Gesture name\r\n     * @returns {boolean} - True if gesture is valid\r\n     */\r\n    isValidGesture(gesture) {\r\n        return this.getGestureGroup(gesture) !== null;\r\n    }\r\n\r\n    /**\r\n     * Get all available gestures\r\n     * @returns {Array<string>} - All gesture names\r\n     */\r\n    getAllGestures() {\r\n        const gestures = [];\r\n        for (const group of Object.values(this.groups)) {\r\n            gestures.push(...group.gestures);\r\n        }\r\n        return [...new Set(gestures)];\r\n    }\r\n\r\n    /**\r\n     * Get timing class for a gesture\r\n     * @param {string} gesture - Gesture name\r\n     * @returns {Object|null} - Timing class info\r\n     */\r\n    getGestureTiming(gesture) {\r\n        for (const [className, timingClass] of Object.entries(this.timingClasses)) {\r\n            if (timingClass.gestures.includes(gesture)) {\r\n                return {\r\n                    name: className,\r\n                    ...timingClass\r\n                };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Get next subdivision beat for a gesture\r\n     * @param {string} gesture - Gesture name\r\n     * @param {number} currentBeat - Current beat number\r\n     * @param {number} subdivision - Beat subdivision (1, 0.5, 0.25, etc)\r\n     * @returns {number} - Next beat to fire on\r\n     */\r\n    getNextBeatForGesture(gesture, currentBeat, subdivision = 1) {\r\n        const timing = this.getGestureTiming(gesture);\r\n        if (!timing) return currentBeat + 1;\r\n\r\n        // Continuous gestures can start immediately\r\n        if (timing.timing === -1) return currentBeat;\r\n\r\n        // Calculate next appropriate beat based on timing class\r\n        const beatInterval = timing.timing / subdivision;\r\n        const nextBeat = Math.ceil(currentBeat / beatInterval) * beatInterval;\r\n\r\n        // For offbeat gestures, add half beat offset\r\n        if (timing.name === 'offbeat') {\r\n            return nextBeat + 0.5;\r\n        }\r\n\r\n        return nextBeat;\r\n    }\r\n\r\n    /**\r\n     * Get fill gestures based on density and BPM\r\n     * @param {number} bpm - Current BPM\r\n     * @param {string} intensity - Intensity level (sparse, moderate, dense, chaos)\r\n     * @returns {Array<string>} - Suggested fill gestures\r\n     */\r\n    getFillGestures(bpm, intensity = 'moderate') {\r\n        const profile = this.densityProfiles[intensity] || this.densityProfiles.moderate;\r\n\r\n        // Determine fill pattern based on BPM\r\n        let pattern;\r\n        if (bpm < 80) {\r\n            pattern = 'energetic';  // More movement for slow tempos\r\n        } else if (bpm < 120) {\r\n            pattern = 'rhythmic';\r\n        } else if (bpm < 160) {\r\n            pattern = 'smooth';\r\n        } else {\r\n            pattern = 'subtle';  // Less movement for fast tempos\r\n        }\r\n\r\n        // Return fills based on probability\r\n        if (Math.random() < profile.fillProbability) {\r\n            return this.fillPatterns[pattern] || [];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * Get next beat timing for a gesture (for rhythm game mode)\r\n     * @param {string} gestureName - Name of the gesture\r\n     * @param {number} currentBeat - Current beat number\r\n     * @param {number} bpm - Current BPM\r\n     * @returns {number} - Next beat to trigger on\r\n     */\r\n    getNextBeatTiming(gestureName, currentBeat, bpm) {\r\n        // In rhythm game mode, this will be determined by the game logic\r\n        // For now, just return the next appropriate beat based on gesture type\r\n        const nextBeat = this.getNextBeatForGesture(gestureName, currentBeat);\r\n        return nextBeat;\r\n    }\r\n\r\n    /**\r\n     * Get intensity profile based on BPM\r\n     * @param {number} bpm - Current BPM\r\n     * @returns {string} - Intensity level\r\n     */\r\n    getIntensityFromBPM(bpm) {\r\n        if (bpm < 60) return 'dense';      // Very slow needs more fills\r\n        if (bpm < 100) return 'moderate';\r\n        if (bpm < 140) return 'moderate';\r\n        if (bpm < 180) return 'sparse';\r\n        return 'sparse';  // Very fast needs less\r\n    }\r\n\r\n    /**\r\n     * Create swing/shuffle timing\r\n     * @param {number} straightBeat - Straight beat number\r\n     * @param {number} swingRatio - Swing ratio (0.5 = straight, 0.67 = swing)\r\n     * @returns {number} - Adjusted beat with swing\r\n     */\r\n    applySwingTiming(straightBeat, swingRatio = 0.67) {\r\n        const beatPart = straightBeat % 1;\r\n        if (beatPart === 0.5) {\r\n            // Delay the offbeat for swing feel\r\n            return Math.floor(straightBeat) + swingRatio;\r\n        }\r\n        return straightBeat;\r\n    }\r\n}\r\n\r\n// Create singleton instance\r\nconst gestureCompatibility = new GestureCompatibility();\r\n\r\nexport default gestureCompatibility;","/**\n * GrooveTemplates - Musical rhythm patterns and groove definitions\n * Provides pre-defined rhythmic patterns that make the mascot dance musically\n */\n\nclass GrooveTemplates {\n    constructor() {\n        // Core groove definitions with emphasis patterns\n        this.templates = {\n            straight: {\n                name: 'Straight',\n                timeSignature: '4/4',\n                baseMovement: 'grooveBob', // Continuous base layer\n                transitionStyle: 'transitionLean',\n                pattern: {\n                    emphasis: [1, 0, 0.5, 0], // Strong on 1, medium on 3\n                    velocities: [1.0, 0, 0.6, 0],\n                    subdivisions: [0, 0.5] // Only play on beats and offbeats\n                },\n                swing: 0,\n                humanization: 0.05, // 5% timing variance for human feel\n                preferredGestures: {\n                    downbeat: ['bounce', 'headBob', 'jump'],\n                    offbeat: ['pulse', 'breathe'],\n                    fills: ['sparkle', 'glow']\n                },\n                compositeMove: null, // No special composite for straight\n                intensity: 'moderate',\n                description: 'Standard 4/4 rhythm, good for pop/rock'\n            },\n\n            swing: {\n                name: 'Swing',\n                timeSignature: '4/4',\n                baseMovement: 'grooveFlow',\n                transitionStyle: 'transitionGlide',\n                compositeMove: 'swingOut',\n                pattern: {\n                    emphasis: [1, 0, 0.66, 0], // Swung eighth notes\n                    velocities: [1.0, 0, 0.7, 0],\n                    subdivisions: [0, 0.66] // Delayed upbeat for swing feel\n                },\n                swing: 0.67, // 67% swing ratio (2:1 triplet feel)\n                humanization: 0.08,\n                preferredGestures: {\n                    downbeat: ['sway', 'lean', 'bounce'],\n                    offbeat: ['wiggle', 'pulse'],\n                    fills: ['shimmer', 'float']\n                },\n                intensity: 'moderate',\n                description: 'Jazz swing feel with triplet subdivision'\n            },\n\n            shuffle: {\n                name: 'Shuffle',\n                timeSignature: '4/4',\n                baseMovement: 'grooveBob',\n                transitionStyle: 'transitionLean',\n                compositeMove: null,\n                pattern: {\n                    emphasis: [1, 0.25, 0.5, 0.75], // Driving shuffle\n                    velocities: [1.0, 0.3, 0.7, 0.3],\n                    subdivisions: [0, 0.25, 0.5, 0.75]\n                },\n                swing: 0.75, // Heavy shuffle\n                humanization: 0.06,\n                preferredGestures: {\n                    downbeat: ['bounce', 'headBob'],\n                    upbeat: ['twist', 'wiggle'],\n                    offbeat: ['pulse', 'breathe'],\n                    fills: ['sparkle', 'flash']\n                },\n                intensity: 'dense',\n                description: 'Blues/rock shuffle with heavy swing'\n            },\n\n            latin: {\n                name: 'Latin',\n                timeSignature: '4/4',\n                baseMovement: 'grooveSway',\n                transitionStyle: 'transitionRoll',\n                compositeMove: 'latinHips',\n                pattern: {\n                    // Clave-inspired pattern: 1 e + a 2 e + a 3 e + a 4 e + a\n                    emphasis: [1, 0, 0.375, 0.5, 0, 0.75, 0, 0],\n                    velocities: [1.0, 0, 0.8, 0.9, 0, 0.8, 0, 0],\n                    subdivisions: [0, 0.375, 0.5, 0.75] // Syncopated\n                },\n                swing: 0,\n                humanization: 0.04,\n                preferredGestures: {\n                    downbeat: ['sway', 'wiggle'],\n                    syncopation: ['twist', 'lean'],\n                    offbeat: ['pulse', 'shimmer'],\n                    fills: ['sparkle', 'shake']\n                },\n                intensity: 'dense',\n                description: 'Latin clave rhythm with syncopation'\n            },\n\n            breakbeat: {\n                name: 'Breakbeat',\n                timeSignature: '4/4',\n                baseMovement: 'grooveStep',\n                transitionStyle: 'transitionGlide',\n                compositeMove: null,\n                pattern: {\n                    // Classic Amen break pattern simplified\n                    emphasis: [1, 0, 0, 0.75, 0.25, 0.5, 0, 0.625],\n                    velocities: [1.0, 0, 0, 0.9, 0.6, 0.8, 0, 0.7],\n                    subdivisions: [0, 0.25, 0.5, 0.625, 0.75] // Complex syncopation\n                },\n                swing: 0,\n                humanization: 0.03, // Tighter timing for electronic feel\n                preferredGestures: {\n                    downbeat: ['bounce', 'twist'],\n                    syncopation: ['flash', 'shake'],\n                    offbeat: ['pulse', 'wiggle'],\n                    fills: ['sparkle', 'glitch']\n                },\n                intensity: 'chaos',\n                description: 'Hip-hop/DnB breakbeat pattern'\n            },\n\n            waltz: {\n                name: 'Waltz',\n                timeSignature: '3/4',\n                baseMovement: 'grooveFlow',\n                transitionStyle: 'transitionGlide',\n                compositeMove: null,\n                pattern: {\n                    emphasis: [1, 0.33, 0.67], // 1-2-3, 1-2-3\n                    velocities: [1.0, 0.5, 0.5],\n                    subdivisions: [0, 0.33, 0.67]\n                },\n                swing: 0,\n                humanization: 0.07,\n                preferredGestures: {\n                    downbeat: ['sway', 'float'],\n                    weak: ['breathe', 'lean'],\n                    fills: ['shimmer', 'glow']\n                },\n                intensity: 'sparse',\n                description: '3/4 waltz time'\n            },\n\n            techno: {\n                name: 'Techno',\n                timeSignature: '4/4',\n                baseMovement: 'groovePulse',\n                transitionStyle: 'transitionLean',\n                compositeMove: 'robotPop',\n                pattern: {\n                    // Four-on-the-floor with 16th note variations\n                    emphasis: [1, 0.25, 0.5, 0.75, 1, 0.25, 0.5, 0.75],\n                    velocities: [1.0, 0.6, 1.0, 0.6, 1.0, 0.6, 1.0, 0.6],\n                    subdivisions: [0, 0.25, 0.5, 0.75] // All subdivisions\n                },\n                swing: 0,\n                humanization: 0.02, // Very tight, machine-like\n                preferredGestures: {\n                    downbeat: ['pulse', 'bounce'],\n                    subdivision: ['flash', 'glitch'],\n                    fills: ['sparkle', 'strobe']\n                },\n                intensity: 'dense',\n                description: 'Driving techno four-on-the-floor'\n            },\n\n            ambient: {\n                name: 'Ambient',\n                timeSignature: '4/4',\n                baseMovement: 'groovePulse',\n                transitionStyle: 'transitionGlide',\n                compositeMove: null,\n                pattern: {\n                    emphasis: [0.8, 0, 0.3, 0, 0.5, 0, 0.3, 0],\n                    velocities: [0.8, 0, 0.3, 0, 0.5, 0, 0.3, 0],\n                    subdivisions: [0, 0.5] // Sparse\n                },\n                swing: 0,\n                humanization: 0.15, // Very loose timing\n                preferredGestures: {\n                    downbeat: ['float', 'breathe'],\n                    offbeat: ['sway', 'shimmer'],\n                    fills: ['glow', 'pulse']\n                },\n                intensity: 'sparse',\n                description: 'Floating ambient rhythm'\n            },\n\n            funk: {\n                name: 'Funk',\n                timeSignature: '4/4',\n                baseMovement: 'grooveSway',\n                transitionStyle: 'transitionRoll',\n                compositeMove: 'funkChicken',\n                pattern: {\n                    // \"One\" emphasis with 16th note ghost notes\n                    emphasis: [1.2, 0.125, 0.25, 0, 0.625, 0.75, 0, 0.875],\n                    velocities: [1.2, 0.3, 0.4, 0, 0.8, 0.6, 0, 0.4],\n                    subdivisions: [0, 0.125, 0.25, 0.625, 0.75, 0.875]\n                },\n                swing: 0.1, // Slight swing\n                humanization: 0.06,\n                preferredGestures: {\n                    one: ['bounce', 'twist'], // THE ONE\n                    ghost: ['wiggle', 'pulse'], // Ghost notes\n                    syncopation: ['lean', 'shake'],\n                    fills: ['flash', 'sparkle']\n                },\n                intensity: 'chaos',\n                description: 'Funky syncopated rhythm with THE ONE'\n            },\n\n            trap: {\n                name: 'Trap',\n                timeSignature: '4/4',\n                baseMovement: 'grooveStep',\n                transitionStyle: 'transitionLean',\n                compositeMove: null,\n                pattern: {\n                    // Hi-hat rolls and syncopated kicks\n                    emphasis: [1, 0, 0, 0.375, 0, 0.75, 0.875, 0],\n                    velocities: [1.0, 0, 0, 0.7, 0, 0.8, 0.6, 0],\n                    subdivisions: [0, 0.375, 0.75, 0.875] // Triplet feel\n                },\n                swing: 0,\n                humanization: 0.03,\n                preferredGestures: {\n                    downbeat: ['bounce', 'lean'],\n                    hihat: ['shake', 'shimmer'],\n                    syncopation: ['twist', 'flash'],\n                    fills: ['sparkle', 'glitch']\n                },\n                intensity: 'moderate',\n                description: 'Trap rhythm with triplet hi-hats'\n            }\n        };\n\n        // Transition rules for smooth groove changes\n        this.transitions = {\n            instant: 0, // Change immediately\n            nextBar: 1, // Change on next bar line\n            nextPhrase: 4, // Change on next 4-bar phrase\n            fadeIn: 8 // Gradually introduce over 8 beats\n        };\n\n        // Current active groove\n        this.currentGroove = null;\n        this.transitionMode = 'nextBar';\n        this.pendingGroove = null;\n    }\n\n    /**\n     * Get a groove template by name\n     */\n    getTemplate(name) {\n        return this.templates[name.toLowerCase()] || this.templates.straight;\n    }\n\n    /**\n     * Get emphasis for current beat and subdivision\n     */\n    getEmphasis(groove, beatNumber, subdivision) {\n        if (!groove || !groove.pattern) return 0;\n\n        const beatInMeasure = beatNumber % 4; // Assuming 4/4 for now\n        const position = beatInMeasure + subdivision;\n\n        // Find closest pattern position\n        const patternIndex = groove.pattern.subdivisions.findIndex(\n            sub => Math.abs(sub - subdivision) < 0.01\n        );\n\n        if (patternIndex === -1) return 0;\n\n        return groove.pattern.emphasis[patternIndex] || 0;\n    }\n\n    /**\n     * Get velocity for current position\n     */\n    getVelocity(groove, beatNumber, subdivision) {\n        if (!groove || !groove.pattern) return 1.0;\n\n        const beatInMeasure = beatNumber % 4;\n        const position = beatInMeasure + subdivision;\n\n        const patternIndex = groove.pattern.subdivisions.findIndex(\n            sub => Math.abs(sub - subdivision) < 0.01\n        );\n\n        if (patternIndex === -1) return 0;\n\n        return groove.pattern.velocities[patternIndex] || 0;\n    }\n\n    /**\n     * Get preferred gesture for current position\n     */\n    getPreferredGesture(groove, beatNumber, subdivision, availableGestures = []) {\n        if (!groove || !groove.preferredGestures) return null;\n\n        // Determine the beat type\n        let beatType;\n        if (subdivision === 0) {\n            beatType = 'downbeat';\n        } else if (subdivision === 0.5) {\n            beatType = 'offbeat';\n        } else if (subdivision === 0.25 || subdivision === 0.75) {\n            beatType = 'subdivision';\n        } else {\n            beatType = 'syncopation';\n        }\n\n        // Special case for THE ONE in funk\n        if (groove.name === 'Funk' && beatNumber % 4 === 0 && subdivision === 0) {\n            beatType = 'one';\n        }\n\n        const preferred = groove.preferredGestures[beatType] || groove.preferredGestures.fills;\n        if (!preferred || preferred.length === 0) return null;\n\n        // Filter to available gestures if provided\n        if (availableGestures.length > 0) {\n            const available = preferred.filter(g => availableGestures.includes(g));\n            if (available.length > 0) {\n                return available[Math.floor(Math.random() * available.length)];\n            }\n        }\n\n        // Return random from preferred\n        return preferred[Math.floor(Math.random() * preferred.length)];\n    }\n\n    /**\n     * Apply humanization to timing\n     */\n    humanizeTiming(groove, timing) {\n        if (!groove || !groove.humanization) return timing;\n\n        const variance = groove.humanization;\n        const offset = (Math.random() - 0.5) * variance;\n        return Math.max(0, Math.min(1, timing + offset));\n    }\n\n    /**\n     * Apply swing to subdivision\n     */\n    applySwing(groove, subdivision) {\n        if (!groove || !groove.swing || groove.swing === 0) return subdivision;\n\n        // Apply swing to upbeats (0.5)\n        if (Math.abs(subdivision - 0.5) < 0.01) {\n            return 0.5 + (groove.swing - 0.5) * 0.5;\n        }\n\n        // Apply swing to 16th note upbeats (0.25, 0.75)\n        if (Math.abs(subdivision - 0.25) < 0.01) {\n            return 0.25 + (groove.swing - 0.5) * 0.25;\n        }\n        if (Math.abs(subdivision - 0.75) < 0.01) {\n            return 0.75 + (groove.swing - 0.5) * 0.25;\n        }\n\n        return subdivision;\n    }\n\n    /**\n     * Set active groove with optional transition\n     */\n    setGroove(name, transitionMode = null) {\n        const groove = this.getTemplate(name);\n        if (!groove) return false;\n\n        const mode = transitionMode || this.transitionMode;\n\n        if (mode === 'instant' || !this.currentGroove) {\n            this.currentGroove = groove;\n            this.pendingGroove = null;\n        } else {\n            this.pendingGroove = groove;\n            // Transition will happen based on mode\n        }\n\n        return true;\n    }\n\n    /**\n     * Handle beat transition\n     */\n    onBeat(beatNumber) {\n        if (!this.pendingGroove) return;\n\n        const shouldTransition =\n            (this.transitionMode === 'nextBar' && beatNumber % 4 === 0) ||\n            (this.transitionMode === 'nextPhrase' && beatNumber % 16 === 0);\n\n        if (shouldTransition) {\n            this.currentGroove = this.pendingGroove;\n            this.pendingGroove = null;\n        }\n    }\n\n    /**\n     * Get base movement for current groove\n     */\n    getBaseMovement() {\n        return this.currentGroove?.baseMovement || null;\n    }\n\n    /**\n     * Get transition style for current groove\n     */\n    getTransitionStyle() {\n        return this.currentGroove?.transitionStyle || 'transitionLean';\n    }\n\n    /**\n     * Get composite move for current groove\n     */\n    getCompositeMove() {\n        return this.currentGroove?.compositeMove || null;\n    }\n\n    /**\n     * Check if we should trigger composite move\n     * @param {number} beatNumber - Current beat number\n     * @returns {boolean} True if composite should trigger\n     */\n    shouldTriggerComposite(beatNumber) {\n        if (!this.currentGroove?.compositeMove) return false;\n\n        // Trigger composite every 4 or 8 bars depending on intensity\n        const interval = this.currentGroove.intensity === 'sparse' ? 32 : 16;\n        return beatNumber % interval === 0;\n    }\n\n    /**\n     * Get layered gesture configuration for current position\n     * @param {number} beatNumber - Current beat number\n     * @param {number} subdivision - Current subdivision (0, 0.25, 0.5, 0.75)\n     * @returns {Object} Configuration with base, accent, and transition layers\n     */\n    getLayeredGestures(beatNumber, subdivision) {\n        if (!this.currentGroove) return null;\n\n        const config = {\n            base: this.getBaseMovement(),\n            accent: null,\n            transition: null,\n            composite: null,\n            velocity: 1.0\n        };\n\n        // Check for composite move trigger\n        if (this.shouldTriggerComposite(beatNumber) && subdivision === 0) {\n            config.composite = this.getCompositeMove();\n        }\n\n        // Get accent gesture based on emphasis\n        const emphasis = this.getEmphasis(this.currentGroove, beatNumber, subdivision);\n        const velocity = this.getVelocity(this.currentGroove, beatNumber, subdivision);\n\n        if (emphasis > 0.3 && velocity > 0.3) {\n            config.accent = this.getPreferredGesture(\n                this.currentGroove,\n                beatNumber,\n                subdivision\n            );\n            config.velocity = velocity;\n        }\n\n        // Add transition if changing positions\n        if (config.accent && Math.random() < 0.3) {\n            config.transition = this.getTransitionStyle();\n        }\n\n        return config;\n    }\n\n    /**\n     * Get all available groove names\n     */\n    getGrooveNames() {\n        return Object.keys(this.templates);\n    }\n\n    /**\n     * Get groove info for UI\n     */\n    getGrooveInfo(name) {\n        const template = this.templates[name];\n        if (!template) return null;\n\n        return {\n            name: template.name,\n            timeSignature: template.timeSignature,\n            description: template.description,\n            intensity: template.intensity,\n            swing: template.swing,\n            baseMovement: template.baseMovement,\n            compositeMove: template.compositeMove\n        };\n    }\n}\n\n// Export as ES6 module\n// No longer polluting global scope with window assignment\nexport default GrooveTemplates;","/**\r\n * AudioHandler - Manages all audio-related functionality for EmotiveMascot\r\n * @module mascot/AudioHandler\r\n */\r\n\r\nexport class AudioHandler {\r\n    constructor(mascot) {\r\n        this.mascot = mascot;\r\n        this.vocalUpdateInterval = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize audio handler\r\n     */\r\n    init() {\r\n        // Will contain initialization logic\r\n    }\r\n\r\n\r\n    /**\r\n     * Disconnect audio analysis\r\n     * @returns {Object} The mascot instance for chaining\r\n     */\r\n    disconnectAudio() {\r\n        // Stop analysis\r\n        if (this.mascot.audioAnalyzer) {\r\n            this.mascot.audioAnalyzer.stop();\r\n        }\r\n        \r\n        // Clear update interval\r\n        if (this.vocalUpdateInterval) {\r\n            clearInterval(this.vocalUpdateInterval);\r\n            this.vocalUpdateInterval = null;\r\n        }\r\n        \r\n        \r\n        // Clear vocal data and analyzer reference\r\n        if (this.mascot.shapeMorpher) {\r\n            this.mascot.shapeMorpher.setVocalEnergy(0);\r\n            this.mascot.shapeMorpher.setAudioDeformation(0);\r\n            this.mascot.shapeMorpher.audioAnalyzer = null;\r\n            this.mascot.shapeMorpher.beatGlitchIntensity = 0;\r\n            this.mascot.shapeMorpher.glitchPoints = [];\r\n        }\r\n\r\n        // Stop ambient groove animation when audio stops\r\n        if (this.mascot.renderer) {\r\n            this.mascot.renderer.ambientDanceAnimator.stopAmbientAnimation('grooveBob');\r\n        }\r\n\r\n        return this.mascot;\r\n    }\r\n\r\n    /**\r\n     * Connect audio element for vocal visualization\r\n     * @param {HTMLAudioElement} audioElement - Audio element to analyze\r\n     * @returns {Object} The mascot instance for chaining\r\n     */\r\n    async connectAudio(audioElement) {\r\n        if (!this.mascot.audioAnalyzer) {\r\n            return this.mascot;\r\n        }\r\n        \r\n        // Initialize audio context if needed\r\n        if (!this.mascot.audioAnalyzer.audioContext) {\r\n            await this.mascot.audioAnalyzer.init();\r\n        }\r\n        \r\n        // Connect the audio element\r\n        this.mascot.audioAnalyzer.connectAudioElement(audioElement);\r\n        \r\n        // Pass analyzer reference to shape morpher for frequency data\r\n        if (this.mascot.shapeMorpher) {\r\n            this.mascot.shapeMorpher.audioAnalyzer = this.mascot.audioAnalyzer;\r\n            \r\n            // Set up beat detection callback for glitches and rhythm detection\r\n            this.mascot.audioAnalyzer.onBeat((amplitude) => {\r\n                if (this.mascot.shapeMorpher) {\r\n                    // Feed beat to music detector for BPM detection\r\n                    if (this.mascot.shapeMorpher.musicDetector) {\r\n                        const now = performance.now();\r\n                        this.mascot.shapeMorpher.musicDetector.addOnset(now, amplitude);\r\n                    }\r\n\r\n                    // Only trigger beat glitches when vocals are active\r\n                    if (this.mascot.shapeMorpher.vocalEffectActive) {\r\n                        this.mascot.shapeMorpher.beatGlitchIntensity = amplitude * 0.3;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Start updating shape morpher with vocal data\r\n        if (this.vocalUpdateInterval) {\r\n            clearInterval(this.vocalUpdateInterval);\r\n        }\r\n        \r\n        // Start ambient groove animation when audio starts\r\n        // This provides the continuous background movement\r\n        if (this.mascot.renderer) {\r\n            this.mascot.renderer.startGrooveBob({ intensity: 0.5, frequency: 1.0 });\r\n        }\r\n\r\n        this.vocalUpdateInterval = setInterval(() => {\r\n            if (this.mascot.audioAnalyzer.isAnalyzing && this.mascot.shapeMorpher) {\r\n                // Get current analysis data directly from properties\r\n                const amplitude = this.mascot.audioAnalyzer.currentAmplitude || 0;\r\n                const vocalInstability = this.mascot.audioAnalyzer.getVocalInstability() || 0;\r\n\r\n                // Set vocal energy for shape pulsing\r\n                this.mascot.shapeMorpher.setVocalEnergy(vocalInstability);\r\n\r\n                // Set overall deformation based on amplitude (0 to 1, no shrinking)\r\n                this.mascot.shapeMorpher.setAudioDeformation(amplitude * 2); // Keep positive for expansion only\r\n            }\r\n        }, 50); // Update at 20 FPS\r\n        \r\n        // Pass audio analyzer to renderer\r\n        if (this.mascot.renderer) {\r\n            this.mascot.renderer.audioAnalyzer = this.mascot.audioAnalyzer;\r\n        }\r\n        \r\n        return this.mascot;\r\n    }\r\n\r\n    /**\r\n     * Stops speech reactivity mode and returns to base emotional state\r\n     * @returns {Object} The mascot instance for chaining\r\n     */\r\n    stopSpeaking() {\r\n        if (!this.mascot.speaking) {\r\n            return this.mascot;\r\n        }\r\n        \r\n        // Store previous state for event\r\n        const previousAudioLevel = this.mascot.audioLevelProcessor.getCurrentLevel();\r\n        \r\n        // Clean up audio level processor\r\n        this.mascot.audioLevelProcessor.cleanup();\r\n        \r\n        // Reset speech state\r\n        this.mascot.speaking = false;\r\n        \r\n        // Notify renderer about speech stop (triggers 500ms return-to-base transition)\r\n        this.mascot.renderer.onSpeechStop();\r\n        \r\n        // Emit speech stop event\r\n        this.mascot.emit('speechStopped', { \r\n            previousAudioLevel,\r\n            returnToBaseTime: 500\r\n        });\r\n        \r\n        return this.mascot;\r\n    }\r\n\r\n    /**\r\n     * Sets master volume for all audio output\r\n     * @param {number} volume - Volume level (0.0 to 1.0)\r\n     * @returns {Object} The mascot instance for chaining\r\n     */\r\n    setVolume(volume) {\r\n        const clampedVolume = Math.max(0, Math.min(1, volume));\r\n        this.mascot.config.masterVolume = clampedVolume;\r\n        \r\n        if (this.mascot.soundSystem.isAvailable()) {\r\n            const currentEmotion = this.mascot.stateMachine.getCurrentState().emotion;\r\n            this.mascot.soundSystem.setMasterVolume(clampedVolume, currentEmotion);\r\n        }\r\n        \r\n        this.mascot.emit('volumeChanged', { volume: clampedVolume });\r\n        \r\n        return this.mascot;\r\n    }\r\n\r\n    /**\r\n     * Cleanup\r\n     */\r\n    destroy() {\r\n        this.disconnectAudio();\r\n    }\r\n}","/**\n * GestureController - Manages gesture animations and protocols\n * @module mascot/GestureController\n */\n\nexport class GestureController {\n    constructor(mascot) {\n        this.mascot = mascot;\n        this.currentGesture = null;\n    }\n\n    /**\n     * Initialize gesture controller\n     */\n    init() {\n        // Will contain initialization logic\n    }\n\n    /**\n     * Methods to be moved here:\n     * - setGestureProtocol()\n     * - performGesture()\n     * - Gesture animation logic\n     */\n\n    /**\n     * Cleanup\n     */\n    destroy() {\n        this.currentGesture = null;\n    }\n}","/**\n * StateCoordinator - Manages emotion states and transitions\n * @module mascot/StateCoordinator\n */\n\nimport { getEmotion, getEmotionVisualParams } from '../core/emotions/index.js';\nimport rhythmIntegration from '../core/rhythmIntegration.js';\n\nexport class StateCoordinator {\n    constructor(mascot) {\n        this.mascot = mascot;\n        this.currentEmotion = 'neutral';\n        this.emotionIntensity = 1.0;\n    }\n\n    /**\n     * Initialize state coordinator\n     */\n    init() {\n        // Will contain initialization logic\n    }\n\n    /**\n     * Sets the emotional state with optional undertone\n     * @param {string} emotion - The emotion to set\n     * @param {Object|string|null} options - Options object or undertone string for backward compatibility\n     * @returns {Object} The mascot instance for chaining\n     */\n    setEmotion(emotion, options = null) {\n        // Map common aliases to actual emotion states\n        const emotionMapping = {\n            'happy': 'joy',\n            'curious': 'surprise',\n            'frustrated': 'anger',\n            'sad': 'sadness'\n        };\n        \n        // Use mapped emotion or original if not an alias\n        const mappedEmotion = emotionMapping[emotion] || emotion;\n        \n        // Handle backward compatibility - if options is a string, treat as undertone\n        let undertone = null;\n        let duration = 500;\n        \n        if (typeof options === 'string') {\n            undertone = options;\n        } else if (options && typeof options === 'object') {\n            undertone = options.undertone || null;\n            duration = options.duration || 500;\n        }\n        \n        // Set emotional state in state machine\n        const success = this.mascot.stateMachine.setEmotion(mappedEmotion, undertone, duration);\n        \n        if (success) {\n            // Register emotion's rhythm configuration\n            const emotionConfig = getEmotion(mappedEmotion);\n            if (emotionConfig) {\n                rhythmIntegration.registerConfig('emotion', mappedEmotion, emotionConfig);\n            }\n            // Clear and reset particles when changing emotional states\n            if (this.mascot.particleSystem) {\n                // Clear all existing particles\n                this.mascot.particleSystem.clear();\n                \n                // Get the new emotional properties\n                const emotionalProps = this.mascot.stateMachine.getCurrentEmotionalProperties();\n                \n                // Spawn initial particles for the new state\n                // Use burst to immediately populate with a few particles\n                // DECIMATED neutral\n                let initialCount;\n                if (mappedEmotion === 'neutral') {\n                    initialCount = 1;  // DECIMATED to 1 particle\n                } else if (mappedEmotion === 'resting') {\n                    initialCount = 4;  // Keep resting at 4\n                } else {\n                    initialCount = Math.min(3, Math.floor(emotionalProps.particleRate / 4));\n                }\n                \n                if (initialCount > 0) {\n                    // Always spawn from canvas center, not gaze-adjusted position\n                    const centerX = this.mascot.canvasManager.width / 2;\n                    const centerY = this.mascot.canvasManager.height / 2;\n                    \n                    this.mascot.particleSystem.burst(\n                        initialCount, \n                        emotionalProps.particleBehavior,\n                        centerX,\n                        centerY\n                    );\n                }\n            }\n            \n            // Update sound system ambient tone - DISABLED (annoying)\n            // if (this.mascot.soundSystem.isAvailable()) {\n            //     this.mascot.soundSystem.setAmbientTone(mappedEmotion, duration);\n            // }\n            \n            // Update Emotive renderer if in classic mode\n            if (this.mascot.config.renderingStyle === 'classic' && this.mascot.renderer.setEmotionalState) {\n                const emotionParams = getEmotionVisualParams(mappedEmotion);\n                this.mascot.renderer.setEmotionalState(mappedEmotion, emotionParams, undertone);\n            }\n            \n            // Emit emotion change event\n            this.mascot.emit('emotionChanged', { emotion: mappedEmotion, undertone, duration });\n            \n        }\n        \n        this.currentEmotion = mappedEmotion;\n        return this.mascot;\n    }\n\n    /**\n     * Methods to be moved here:\n     * - getEmotion()\n     * - setUndertoneModifier()\n     * - transitionToEmotion() (new smooth transition)\n     * - setEmotionVector() (new 2D control)\n     * - Emotion blending logic\n     */\n\n    /**\n     * Cleanup\n     */\n    destroy() {\n        this.currentEmotion = 'neutral';\n    }\n}","/**\r\n * VisualizationRunner - Manages the main animation loop and rendering\r\n * @module mascot/VisualizationRunner\r\n */\r\n\r\nimport { getEmotionVisualParams, getEmotion } from '../core/emotions/index.js';\r\n\r\nexport class VisualizationRunner {\r\n    constructor(mascot) {\r\n        this.mascot = mascot;\r\n        this.animationId = null;\r\n        this.isRunning = false;\r\n        this.lastTime = 0;\r\n    }\r\n\r\n    /**\r\n     * Initialize visualization runner\r\n     */\r\n    init() {\r\n        // Will contain initialization logic\r\n    }\r\n\r\n    /**\r\n     * Starts the animation loop at target 60 FPS\r\n     * @returns {Object} The mascot instance for chaining\r\n     */\r\n    start() {\r\n        if (this.mascot.animationController.isAnimating()) {\r\n            return this.mascot;\r\n        }\r\n        \r\n        // Start the animation controller\r\n        const success = this.mascot.animationController.start();\r\n        \r\n        if (success) {\r\n            this.mascot.isRunning = true;\r\n            this.isRunning = true;\r\n            \r\n            // Spawn initial particles for classic mode\r\n            if (this.mascot.config.renderingStyle === 'classic' && this.mascot.particleSystem) {\r\n                const currentState = this.mascot.stateMachine.getCurrentState();\r\n                const emotion = currentState.emotion;\r\n                const undertone = currentState.undertone;\r\n                const emotionParams = getEmotionVisualParams(emotion);\r\n                \r\n                // Get the actual orb position from the renderer (includes gaze offset)\r\n                let orbX, orbY;\r\n                if (this.mascot.renderer && this.mascot.renderer.getCurrentOrbPosition) {\r\n                    const orbPos = this.mascot.renderer.getCurrentOrbPosition();\r\n                    orbX = orbPos.x;\r\n                    orbY = orbPos.y;\r\n                } else {\r\n                    // Fallback to center if method doesn't exist\r\n                    orbX = this.mascot.canvasManager.width / 2;\r\n                    orbY = this.mascot.canvasManager.height / 2;\r\n                }\r\n                \r\n                // Clear any existing particles first\r\n                this.mascot.particleSystem.clear();\r\n                \r\n                // Check if emotion has specific particle configuration\r\n                if (emotionParams.particleRate > 0) {\r\n                    // Spawn initial burst of particles\r\n                    const initialCount = Math.min(3, Math.floor(emotionParams.particleRate / 4));\r\n                    \r\n                    if (initialCount > 0) {\r\n                        this.mascot.particleSystem.burst(\r\n                            initialCount,\r\n                            emotionParams.particleBehavior,\r\n                            orbX,\r\n                            orbY\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // Start degradation monitoring\r\n            if (this.mascot.degradationManager) {\r\n                this.mascot.degradationManager.startMonitoring();\r\n            }\r\n            \r\n            // Emit start event\r\n            this.mascot.emit('started');\r\n        }\r\n        \r\n        return this.mascot;\r\n    }\r\n\r\n    /**\r\n     * Stops the animation loop and cleans up resources\r\n     * @returns {Object} The mascot instance for chaining\r\n     */\r\n    stop() {\r\n        if (!this.mascot.animationController.isAnimating()) {\r\n            return this.mascot;\r\n        }\r\n        \r\n        // Stop speech reactivity if active\r\n        if (this.mascot.speaking) {\r\n            this.mascot.audioHandler.stopSpeaking();\r\n        }\r\n        \r\n        // Stop the animation controller\r\n        const success = this.mascot.animationController.stop();\r\n        \r\n        if (success) {\r\n            this.mascot.isRunning = false;\r\n            this.isRunning = false;\r\n            \r\n            // Stop degradation monitoring\r\n            if (this.mascot.degradationManager) {\r\n                this.mascot.degradationManager.stopMonitoring();\r\n            }\r\n            \r\n            // Emit stop event\r\n            this.mascot.emit('stopped');\r\n        }\r\n        \r\n        return this.mascot;\r\n    }\r\n\r\n    /**\r\n     * Updates audio level monitoring and other per-frame updates\r\n     * @param {number} deltaTime - Time since last frame in milliseconds\r\n     */\r\n    update(deltaTime) {\r\n        // Update audio level monitoring if speaking\r\n        if (this.mascot.speaking && this.mascot.audioLevelProcessor.isProcessingActive()) {\r\n            this.mascot.audioLevelProcessor.updateAudioLevel(deltaTime);\r\n        }\r\n        \r\n        // Update classic mode components\r\n        if (this.mascot.config.renderingStyle === 'classic') {\r\n            // Update gaze tracker\r\n            if (this.mascot.gazeTracker) {\r\n                this.mascot.gazeTracker.update(deltaTime);\r\n                \r\n                // Update threat level for suspicion emotion\r\n                const currentEmotion = this.mascot.stateMachine.getCurrentState().emotion;\r\n                if (currentEmotion === 'suspicion') {\r\n                    // Get mouse position and calculate distance to center\r\n                    const mousePos = this.mascot.gazeTracker.mousePos;\r\n                    const centerX = this.mascot.canvas.width / 2;\r\n                    const centerY = this.mascot.canvas.height / 2;\r\n                    const distance = Math.sqrt(\r\n                        Math.pow(mousePos.x - centerX, 2) + \r\n                        Math.pow(mousePos.y - centerY, 2)\r\n                    );\r\n                    \r\n                    // Get emotion configuration\r\n                    const suspicionEmotion = getEmotion('suspicion');\r\n                    if (suspicionEmotion && suspicionEmotion.visual) {\r\n                        const maxDistance = Math.min(centerX, centerY);\r\n                        const threatLevel = Math.max(0, Math.min(1, 1 - (distance / maxDistance)));\r\n                        suspicionEmotion.visual.threatLevel = threatLevel;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // Update idle behaviors\r\n            if (this.mascot.idleBehavior) {\r\n                this.mascot.idleBehavior.update(deltaTime);\r\n            }\r\n            \r\n            // Combine gaze and sway offsets\r\n            if (this.mascot.gazeTracker && this.mascot.idleBehavior) {\r\n                const gazeOffset = this.mascot.gazeTracker.getGazeOffset();\r\n                const swayOffset = this.mascot.idleBehavior.getSwayOffset();\r\n                \r\n                // Get full gaze state including proximity for eye narrowing\r\n                const gazeState = this.mascot.gazeTracker.getState();\r\n                \r\n                // Combine the offsets and include proximity data\r\n                const gazeData = {\r\n                    offset: {\r\n                        x: gazeOffset.x + swayOffset.x,\r\n                        y: gazeOffset.y + swayOffset.y\r\n                    },\r\n                    proximity: gazeState.proximity,\r\n                    isFocused: gazeState.isFocused\r\n                };\r\n                \r\n                // Pass to renderer\r\n                if (this.mascot.renderer.setGazeData) {\r\n                    this.mascot.renderer.setGazeData(gazeData);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Cleanup\r\n     */\r\n    destroy() {\r\n        this.stop();\r\n    }\r\n}","/**\n * ConfigurationManager - Manages settings and configuration\n * @module mascot/ConfigurationManager\n */\n\nexport class ConfigurationManager {\n    constructor(mascot, config = {}) {\n        this.mascot = mascot;\n        this.config = this.validateConfig(config);\n    }\n\n    /**\n     * Validate and set defaults for configuration\n     */\n    validateConfig(config) {\n        return {\n            canvasId: config.canvasId || 'emotive-canvas',\n            startingEmotion: config.startingEmotion || 'neutral',\n            emotionalResponsiveness: config.emotionalResponsiveness ?? 0.5,\n            particleIntensity: config.particleIntensity ?? 1.0,\n            glowIntensity: config.glowIntensity ?? 1.0,\n            audioEnabled: config.audioEnabled ?? false,\n            showFPS: config.showFPS ?? false,\n            debugMode: config.debugMode ?? false,\n            renderMode: config.renderMode || 'default',\n            maxParticles: config.maxParticles || 100,\n            ...config\n        };\n    }\n\n    /**\n     * Methods to be moved here:\n     * - getConfig()\n     * - updateConfig()\n     * - Configuration validation\n     */\n\n    /**\n     * Get current configuration\n     */\n    getConfig() {\n        return { ...this.config };\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(updates) {\n        this.config = { ...this.config, ...updates };\n        return this.config;\n    }\n}","/**\r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *  ╔═○─┐ emotive\r\n *    ●●  ENGINE\r\n *  └─○═╝                                                                             \r\n *                   ◐ ◑ ◒ ◓  EMOTIVE MASCOT  ◓ ◒ ◑ ◐                   \r\n *                                                                                    \r\n * ═══════════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * @fileoverview EmotiveMascot - Main API Class for the Emotive Engine\r\n * @author Emotive Engine Team\r\n * @version 2.1.0\r\n * @module EmotiveMascot\r\n * @changelog 2.1.0 - Added resize handling with visual resampling for consistent quality\r\n * \r\n * ╔═══════════════════════════════════════════════════════════════════════════════════\r\n * ║                                   PURPOSE                                         \r\n * ╠═══════════════════════════════════════════════════════════════════════════════════\r\n * ║ The MAIN ORCHESTRATOR of the Emotive Engine. This is the primary API class        \r\n * ║ that developers interact with. It coordinates all subsystems, manages the         \r\n * ║ lifecycle, and provides the fluent API for emotional expression.                  \r\n * ╚═══════════════════════════════════════════════════════════════════════════════════\r\n *\r\n * ┌───────────────────────────────────────────────────────────────────────────────────\r\n * │ 🎭 CORE FEATURES                                                                  \r\n * ├───────────────────────────────────────────────────────────────────────────────────\r\n * │ • Emotional state management with smooth transitions                              \r\n * │ • Gesture triggering and animation control                                        \r\n * │ • Particle system orchestration                                                   \r\n * │ • Dynamic visual resampling on resize                                             \r\n * │ • Plugin system for extensibility                                                 \r\n * │ • Event handling and listener management                                          \r\n * │ • Performance optimization and degradation                                        \r\n * │ • Accessibility features                                                          \r\n * │ • Mobile optimization                                                             \r\n * └───────────────────────────────────────────────────────────────────────────────────\r\n *\r\n * ════════════════════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nimport CanvasManager from './core/CanvasManager.js';\r\nimport ErrorBoundary from './core/ErrorBoundary.js';\r\nimport EmotiveStateMachine from './core/EmotiveStateMachine.js';\r\nimport ParticleSystem from './core/ParticleSystem.js';\r\nimport EmotiveRenderer from './core/EmotiveRenderer.js';\r\nimport GazeTracker from './core/GazeTracker.js';\r\nimport IdleBehavior from './core/IdleBehavior.js';\r\nimport { getEmotionVisualParams, getEmotion } from './core/emotions/index.js';\r\nimport { getGesture } from './core/gestures/index.js';\r\nimport { SoundSystem } from './core/SoundSystem.js';\r\nimport AnimationController from './core/AnimationController.js';\r\nimport AudioLevelProcessor from './core/AudioLevelProcessor.js';\r\nimport { EventManager } from './core/EventManager.js';\r\nimport AccessibilityManager from './core/AccessibilityManager.js';\r\nimport MobileOptimization from './core/MobileOptimization.js';\r\nimport PluginSystem from './core/PluginSystem.js';\r\nimport { browserCompatibility, CanvasContextRecovery } from './utils/browserCompatibility.js';\r\nimport { emotiveDebugger, runtimeCapabilities } from './utils/debugger.js';\r\nimport rhythmIntegration from './core/rhythmIntegration.js';\r\nimport ShapeMorpher from './core/ShapeMorpher.js';\r\nimport { AudioAnalyzer } from './core/AudioAnalyzer.js';\r\nimport gestureCompatibility from './core/GestureCompatibility.js';\r\nimport GrooveTemplates from './core/GrooveTemplates.js';\r\n\r\n// Import modular handlers\r\nimport { AudioHandler } from './mascot/AudioHandler.js';\r\nimport { GestureController } from './mascot/GestureController.js';\r\nimport { StateCoordinator } from './mascot/StateCoordinator.js';\r\nimport { VisualizationRunner } from './mascot/VisualizationRunner.js';\r\nimport { ConfigurationManager } from './mascot/ConfigurationManager.js';\r\n\r\nclass EmotiveMascot {\r\n    constructor(config = {}) {\r\n        // Initialize error boundary first\r\n        this.errorBoundary = new ErrorBoundary();\r\n        \r\n        // Initialize EventManager with simple event emitter functionality\r\n        this.eventManager = new EventManager({\r\n            maxListeners: config.maxEventListeners || 100,\r\n            enableDebugging: config.enableEventDebugging || false,\r\n            enableMonitoring: config.enableEventMonitoring || true,\r\n            memoryWarningThreshold: config.eventMemoryWarningThreshold || 50\r\n        });\r\n\r\n        // Add simple event emitter methods if not present\r\n        if (!this.eventManager.emit) {\r\n            this.eventManager._listeners = {};\r\n            this.eventManager.emit = (event, data) => {\r\n                const listeners = this.eventManager._listeners[event];\r\n                if (listeners) {\r\n                    listeners.forEach(listener => listener(data));\r\n                }\r\n            };\r\n            this.eventManager.on = (event, listener) => {\r\n                if (!this.eventManager._listeners[event]) {\r\n                    this.eventManager._listeners[event] = [];\r\n                }\r\n                this.eventManager._listeners[event].push(listener);\r\n            };\r\n            this.eventManager.off = (event, listener) => {\r\n                const listeners = this.eventManager._listeners[event];\r\n                if (listeners) {\r\n                    const index = listeners.indexOf(listener);\r\n                    if (index > -1) {\r\n                        listeners.splice(index, 1);\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        \r\n        // Wrap initialization in error boundary\r\n        this.errorBoundary.wrap(() => {\r\n            this.initialize(config);\r\n        }, 'initialization')();\r\n    }\r\n\r\n    /**\r\n     * Get default duration for a gesture\r\n     */\r\n    /**\r\n     * Initialize the mascot system\r\n     * @param {Object} config - Configuration options\r\n     */\r\n    initialize(config) {\r\n        // Get browser-specific optimizations\r\n        const browserOpts = browserCompatibility.browserOptimizations.getOptimizations();\r\n        const capabilities = browserCompatibility.capabilities;\r\n        \r\n        // Default configuration with browser-specific optimizations\r\n        const defaults = {\r\n            canvasId: 'emotive-mascot',\r\n            targetFPS: 60,\r\n            enableAudio: browserCompatibility.featureDetection.features.webAudio,\r\n            soundEnabled: false,  // Disable gesture sounds by default\r\n            masterVolume: 0.5,\r\n            maxParticles: browserOpts.particleLimit,\r\n            defaultEmotion: 'neutral',\r\n            enableAutoOptimization: true,\r\n            enableGracefulDegradation: true,\r\n            renderingStyle: 'classic',  // 'classic' (Emotive) or 'advanced' (3-layer)\r\n            enableGazeTracking: true,\r\n            enableIdleBehaviors: true,\r\n            classicConfig: {\r\n                coreColor: '#FFFFFF',\r\n                coreSizeDivisor: 12,      // Core radius = canvas_size / 12 (original Emotive)\r\n                glowMultiplier: 2.5,      // Glow radius = core * 2.5 (original Emotive)\r\n                defaultGlowColor: '#14B8A6'\r\n            },\r\n            topOffset: 0  // Vertical offset to shift mascot upward (in pixels)\r\n        };\r\n        \r\n        this.config = { ...defaults, ...config };\r\n        \r\n        // Get canvas element\r\n        this.canvas = typeof this.config.canvasId === 'string' \r\n            ? document.getElementById(this.config.canvasId)\r\n            : this.config.canvasId;\r\n            \r\n        if (!this.canvas) {\r\n            throw new Error(`Canvas with ID '${this.config.canvasId}' not found`);\r\n        }\r\n\r\n        // Initialize core systems with browser compatibility\r\n        this.canvasManager = new CanvasManager(this.canvas);\r\n        \r\n        // Set up canvas context recovery\r\n        this.contextRecovery = new CanvasContextRecovery(this.canvas);\r\n        this.contextRecovery.onRecovery((context) => {\r\n            // Canvas context recovered, reinitializing renderer\r\n            if (this.renderer) {\r\n                this.renderer.handleContextRecovery(context);\r\n            }\r\n        });\r\n        \r\n        // Apply browser-specific canvas optimizations\r\n        browserCompatibility.browserOptimizations.applyCanvasOptimizations(\r\n            this.canvas, \r\n            this.canvasManager.getContext()\r\n        );\r\n        \r\n        this.stateMachine = new EmotiveStateMachine(this.errorBoundary);\r\n        this.particleSystem = new ParticleSystem(this.config.maxParticles, this.errorBoundary);\r\n        \r\n        // Always use EmotiveRenderer, pass full config including topOffset\r\n        this.renderer = new EmotiveRenderer(this.canvasManager, {\r\n            ...this.config.classicConfig,\r\n            topOffset: this.config.topOffset || 0\r\n        });\r\n        \r\n        // Initialize shape morphing and audio analysis early\r\n        this.shapeMorpher = new ShapeMorpher();\r\n        this.audioAnalyzer = new AudioAnalyzer();\r\n\r\n        // Gesture compatibility system\r\n        this.gestureCompatibility = gestureCompatibility;\r\n\r\n        // Groove templates for musical rhythm patterns\r\n        this.grooveTemplates = new GrooveTemplates();\r\n        \r\n        // Pass audioAnalyzer to shapeMorpher for audio-reactive deformation\r\n        this.shapeMorpher.audioAnalyzer = this.audioAnalyzer;\r\n        \r\n        // Pass them to renderer\r\n        this.renderer.shapeMorpher = this.shapeMorpher;\r\n        this.renderer.audioAnalyzer = this.audioAnalyzer;\r\n        \r\n        // Connect renderer and state machine for undertone modifiers\r\n        this.renderer.stateMachine = this.stateMachine;\r\n        this.stateMachine.renderer = this.renderer;\r\n        \r\n        // Initialize gaze tracking\r\n        if (this.config.enableGazeTracking) {\r\n            this.gazeTracker = new GazeTracker(this.canvas, {\r\n                smoothing: 0.1,\r\n                maxOffset: 0.15,\r\n                enabled: true\r\n            });\r\n            \r\n            // Reset idle timer on interaction and wake if sleeping\r\n            this.gazeTracker.setInteractionCallback(() => {\r\n                if (this.sleeping) {\r\n                    // Wake with full animation sequence\r\n                    this.wake();\r\n                } else if (this.idleBehavior) {\r\n                    // Just reset idle timer if not sleeping\r\n                    this.idleBehavior.resetIdleTimer();\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Initialize idle behaviors\r\n        if (this.config.enableIdleBehaviors) {\r\n            this.idleBehavior = new IdleBehavior({\r\n                enabled: true,\r\n                sleepTimeout: Infinity  // Disable automatic sleep\r\n            });\r\n            \r\n            // Connect idle behavior callbacks to renderer\r\n            this.idleBehavior.setCallback('onBlink', (data) => {\r\n                if (this.renderer && this.renderer.state) {\r\n                    this.renderer.state.blinking = data.phase === 'start';\r\n                }\r\n            });\r\n            \r\n            this.idleBehavior.setCallback('onSleep', () => {\r\n                if (this.renderer && this.renderer.enterSleepMode) {\r\n                    this.renderer.enterSleepMode();\r\n                }\r\n            });\r\n            \r\n            this.idleBehavior.setCallback('onWake', () => {\r\n                if (this.renderer && this.renderer.wakeUp) {\r\n                    this.renderer.wakeUp();\r\n                }\r\n            });\r\n        }\r\n        \r\n        this.soundSystem = new SoundSystem();\r\n        \r\n        // DegradationManager removed - no performance interference\r\n        this.degradationManager = null;\r\n        \r\n        // Initialize accessibility manager\r\n        this.accessibilityManager = new AccessibilityManager({\r\n            enableReducedMotion: this.config.enableReducedMotion !== false,\r\n            enableHighContrast: this.config.enableHighContrast !== false,\r\n            enableScreenReaderSupport: this.config.enableScreenReaderSupport !== false,\r\n            enableKeyboardNavigation: this.config.enableKeyboardNavigation !== false,\r\n            colorBlindMode: this.config.colorBlindMode || 'none'\r\n        });\r\n        \r\n        // Initialize mobile optimization\r\n        this.mobileOptimization = new MobileOptimization({\r\n            enableTouchOptimization: this.config.enableTouchOptimization !== false,\r\n            enableViewportHandling: this.config.enableViewportHandling !== false,\r\n            enableBatteryOptimization: this.config.enableBatteryOptimization !== false\r\n        });\r\n        \r\n        // Set canvas for mobile optimization\r\n        this.mobileOptimization.setCanvas(this.canvas);\r\n        \r\n        // Initialize plugin system\r\n        this.pluginSystem = new PluginSystem({\r\n            enablePlugins: this.config.enablePlugins !== false,\r\n            validatePlugins: this.config.validatePlugins !== false,\r\n            sandboxPlugins: this.config.sandboxPlugins !== false\r\n        });\r\n        \r\n        // Initialize audio level processor for speech reactivity\r\n        this.audioLevelProcessor = new AudioLevelProcessor({\r\n            spikeThreshold: this.config.spikeThreshold || 1.5,\r\n            minimumSpikeLevel: this.config.minimumSpikeLevel || 0.1,\r\n            spikeMinInterval: this.config.spikeMinInterval || 1000\r\n        });\r\n        \r\n        // Initialize animation controller\r\n        try {\r\n            this.animationController = new AnimationController(this.errorBoundary, {\r\n                targetFPS: this.config.targetFPS\r\n            });\r\n        } catch (error) {\r\n            // Failed to initialize AnimationController\r\n            // Fallback: create a minimal animation controller interface\r\n            this.animationController = {\r\n                isAnimating: () => this.isRunning,\r\n                start: () => { this.isRunning = true; return true; },\r\n                stop: () => { this.isRunning = false; return true; },\r\n                setTargetFPS: () => {},\r\n                targetFPS: this.config.targetFPS,\r\n                getPerformanceMetrics: () => ({ fps: 0, isRunning: this.isRunning, performanceDegradation: false, deltaTime: 16, frameCount: 0, targetFPS: this.config.targetFPS }),\r\n                setSubsystems: () => {},\r\n                setEventCallback: () => {},\r\n                setParentMascot: () => {},\r\n                destroy: () => {},\r\n                deltaTime: 16\r\n            };\r\n        }\r\n        \r\n        // Configure animation controller with subsystems\r\n        this.animationController.setSubsystems({\r\n            stateMachine: this.stateMachine,\r\n            particleSystem: this.particleSystem,\r\n            renderer: this.renderer,\r\n            soundSystem: this.soundSystem,\r\n            canvasManager: this.canvasManager\r\n        });\r\n        \r\n        // Set up event forwarding from animation controller\r\n        this.animationController.setEventCallback((event, data) => {\r\n            this.emit(event, data);\r\n        });\r\n        \r\n        // Set parent mascot reference for audio level updates\r\n        this.animationController.setParentMascot(this);\r\n        \r\n        // Runtime state\r\n        this.isRunning = false;\r\n        \r\n        // Initialize sound system if enabled\r\n        if (this.config.enableAudio) {\r\n            this.soundSystem.initialize().then(success => {\r\n                if (success) {\r\n                    this.soundSystem.setMasterVolume(this.config.masterVolume);\r\n                    // Sound system initialized successfully\r\n                } else {\r\n                    // Sound system initialization failed, continuing without audio\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Speech reactivity state\r\n        this.speaking = false;\r\n        \r\n        // Track warning frequency to reduce spam\r\n        this.warningTimestamps = {};\r\n        \r\n        // Initialize rhythm integration\r\n        this.rhythmEnabled = false;\r\n        rhythmIntegration.initialize();\r\n\r\n        // Expose rhythmIntegration globally for UI controls\r\n        // Store rhythm integration internally instead of global\r\n        this.rhythmIntegration = rhythmIntegration;\r\n        this.warningThrottle = 5000; // Only show same warning every 5 seconds\r\n        \r\n        // Recording state (listening/capturing)\r\n        this.recording = false;\r\n        \r\n        // Sleeping state\r\n        this.sleeping = false;\r\n        \r\n        // TTS (Text-to-Speech) state\r\n        this.tts = {\r\n            available: typeof window !== 'undefined' && 'speechSynthesis' in window,\r\n            speaking: false,\r\n            currentUtterance: null\r\n        };\r\n        \r\n        // Initialize modular handlers\r\n        this.audioHandler = new AudioHandler(this);\r\n        this.gestureController = new GestureController(this);\r\n        this.stateCoordinator = new StateCoordinator(this);\r\n        this.visualizationRunner = new VisualizationRunner(this);\r\n        this.configurationManager = new ConfigurationManager(this, config);\r\n        \r\n        // Initialize the handlers\r\n        this.audioHandler.init();\r\n        this.gestureController.init();\r\n        this.stateCoordinator.init();\r\n        this.visualizationRunner.init();\r\n        \r\n        // EventManager already initialized in constructor\r\n        \r\n        // Initialize debugging if enabled\r\n        this.debugMode = this.config.enableDebug || false;\r\n        if (this.debugMode) {\r\n            emotiveDebugger.log('INFO', 'Debug mode enabled for EmotiveMascot', {\r\n                config: this.config,\r\n                runtimeCapabilities: runtimeCapabilities.generateReport()\r\n            });\r\n            \r\n            // Start profiling initialization\r\n            emotiveDebugger.startProfile('mascot-initialization', {\r\n                canvasId: this.config.canvasId,\r\n                maxParticles: this.config.maxParticles\r\n            });\r\n        }\r\n        \r\n        // Set up audio level processor callbacks\r\n        this.setupAudioLevelProcessorCallbacks();\r\n        \r\n        // Set initial emotional state\r\n        this.stateMachine.setEmotion(this.config.defaultEmotion);\r\n        \r\n        // Register for canvas resize events to trigger visual resampling\r\n        this.canvasManager.onResize((width, height, dpr) => {\r\n            this.handleResize(width, height, dpr);\r\n        });\r\n        \r\n        // Log browser compatibility information\r\n        // EmotiveMascot initialized successfully\r\n        \r\n        // Complete initialization profiling\r\n        if (this.debugMode) {\r\n            emotiveDebugger.endProfile('mascot-initialization');\r\n            emotiveDebugger.takeMemorySnapshot('post-initialization');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle degradation manager events\r\n     * @param {string} event - Event type\r\n     * @param {Object} data - Event data\r\n     */\r\n    handleDegradationEvent(event, data) {\r\n        switch (event) {\r\n            case 'degradationApplied':\r\n                // Silently handle performance degradation\r\n                this.applyDegradationSettings(data.settings);\r\n                this.emit('performanceDegradation', data);\r\n                break;\r\n                \r\n            case 'recoveryApplied':\r\n                // Silently handle performance recovery\r\n                this.applyDegradationSettings(data.settings);\r\n                this.emit('performanceRecovery', data);\r\n                break;\r\n                \r\n            case 'levelChanged':\r\n                // Silently handle degradation level change\r\n                this.applyDegradationSettings(data.settings);\r\n                this.emit('degradationLevelChanged', data);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply degradation settings to all systems\r\n     * @param {Object} settings - Degradation settings\r\n     */\r\n    applyDegradationSettings(settings) {\r\n        // Update particle system limits\r\n        if (this.particleSystem && settings.particleLimit !== undefined) {\r\n            this.particleSystem.setMaxParticles(settings.particleLimit);\r\n        }\r\n        \r\n        // Update audio system\r\n        if (this.soundSystem && settings.audioEnabled !== undefined) {\r\n            if (!settings.audioEnabled && this.soundSystem.isAvailable()) {\r\n                this.soundSystem.stopAmbientTone(200);\r\n            }\r\n        }\r\n        \r\n        // DISABLED - Don't change FPS based on degradation\r\n        /*\r\n        // Update animation controller target FPS\r\n        if (this.animationController && settings.targetFPS !== undefined) {\r\n            this.animationController.setTargetFPS(settings.targetFPS);\r\n        }\r\n        */\r\n        \r\n        // Update renderer quality\r\n        if (this.renderer && settings.qualityLevel !== undefined) {\r\n            this.renderer.setQualityLevel(settings.qualityLevel);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set up callbacks for the audio level processor\r\n     */\r\n    setupAudioLevelProcessorCallbacks() {\r\n        // Handle audio level updates\r\n        this.audioLevelProcessor.onLevelUpdate((data) => {\r\n            // Update renderer with current audio level\r\n            this.renderer.updateAudioLevel(data.level);\r\n            \r\n            // Emit audio level update event\r\n            this.emit('audioLevelUpdate', {\r\n                level: data.level,\r\n                rawData: Array.from(data.rawData),\r\n                timestamp: data.timestamp\r\n            });\r\n        });\r\n        \r\n        // Handle volume spikes for gesture triggering\r\n        this.audioLevelProcessor.onVolumeSpike((spikeData) => {\r\n            // Trigger pulse gesture if not already active\r\n            // Check if any particle has an active gesture\r\n            const hasActiveGesture = this.particleSystem.particles.some(p => p.gestureProgress < 1);\r\n            if (!hasActiveGesture) {\r\n                const emotionalContext = {\r\n                    emotion: this.stateMachine.getCurrentState().emotion,\r\n                    properties: this.stateMachine.getCurrentEmotionalProperties()\r\n                };\r\n                \r\n                // Execute pulse gesture through express method\r\n                this.express('pulse');\r\n                const success = true;\r\n                \r\n                if (success) {\r\n                    // Emit volume spike event with gesture trigger info\r\n                    this.emit('volumeSpike', {\r\n                        ...spikeData,\r\n                        gestureTriggered: true\r\n                    });\r\n                    \r\n                    // Volume spike detected - triggered pulse gesture\r\n                } else {\r\n                    // Emit volume spike event without gesture trigger\r\n                    this.emit('volumeSpike', {\r\n                        ...spikeData,\r\n                        gestureTriggered: false\r\n                    });\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Handle audio processing errors\r\n        this.audioLevelProcessor.onError((errorData) => {\r\n            // AudioLevelProcessor error\r\n            this.emit('audioProcessingError', errorData);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Sets the emotional state with optional undertone\r\n     * @param {string} emotion - The emotion to set\r\n     * @param {Object|string|null} options - Options object or undertone string\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setEmotion(emotion, options = null) {\r\n        return this.errorBoundary.wrap(() => {\r\n            return this.stateCoordinator.setEmotion(emotion, options);\r\n        }, 'emotion-setting', this)();\r\n    }\r\n    \r\n    /**\r\n     * Update the undertone without resetting emotion\r\n     * @param {string|null} undertone - The undertone to apply (subdued, tired, nervous, energetic, confident, intense, or null)\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    updateUndertone(undertone) {\r\n        return this.errorBoundary.wrap(() => {\r\n            // Update state machine's undertone\r\n            this.stateMachine.applyUndertoneModifier(undertone);\r\n            // Update renderer's undertone without resetting emotion\r\n            if (this.renderer && this.renderer.updateUndertone) {\r\n                this.renderer.updateUndertone(undertone);\r\n            }\r\n            return this;\r\n        }, 'undertone-update', this)();\r\n    }\r\n    \r\n    /**\r\n     * Set BPM for core rotation (record player effect)\r\n     * @param {number} bpm - Beats per minute\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setBPM(bpm) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.renderer && this.renderer.setBPM) {\r\n                this.renderer.setBPM(bpm);\r\n            }\r\n            return this;\r\n        }, 'bpm-update', this)();\r\n    }\r\n\r\n    /**\r\n     * Set manual rotation speed for the shape\r\n     * @param {number} speed - Rotation speed (-1 to 1, negative for reverse)\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setRotationSpeed(speed) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.renderer && this.renderer.setRotationSpeed) {\r\n                this.renderer.setRotationSpeed(speed);\r\n            }\r\n            return this;\r\n        }, 'rotation-speed-update', this)();\r\n    }\r\n\r\n    /**\r\n     * Set manual rotation angle directly (for scratching)\r\n     * @param {number} angle - Rotation angle in radians\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setRotationAngle(angle) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.renderer && this.renderer.setRotationAngle) {\r\n                this.renderer.setRotationAngle(angle);\r\n            }\r\n            return this;\r\n        }, 'rotation-angle-update', this)();\r\n    }\r\n\r\n    /**\r\n     * Enable or disable gaze tracking\r\n     * @param {boolean} enabled - Whether to enable gaze tracking\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setGazeTracking(enabled) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.renderer && this.renderer.setGazeTracking) {\r\n                this.renderer.setGazeTracking(enabled);\r\n            }\r\n            return this;\r\n        }, 'gaze-tracking-update', this)();\r\n    }\r\n\r\n    /**\r\n     * Executes a single gesture or chord (multiple simultaneous gestures)\r\n     * @param {string|Array<string>|Object} gesture - Single gesture, array of gestures, or chord object\r\n     * @param {Object} options - Options for the gesture execution\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    express(gesture, options = {}) {\r\n        return this.errorBoundary.wrap(() => {\r\n            // Performance marker: Gesture start\r\n            const gestureStartTime = performance.now();\r\n            const gestureName = Array.isArray(gesture) ? 'chord' :\r\n                               (typeof gesture === 'object' && gesture.type === 'chord') ? 'chord' :\r\n                               gesture;\r\n\r\n            if (this.performanceMonitor) {\r\n                this.performanceMonitor.markGestureStart(gestureName);\r\n            }\r\n\r\n            if (!gesture) {\r\n                // No gesture provided to express()\r\n                if (this.performanceMonitor) {\r\n                    this.performanceMonitor.markGestureEnd(gestureName);\r\n                }\r\n                return this;\r\n            }\r\n\r\n            // Handle chord (multiple simultaneous gestures)\r\n            if (Array.isArray(gesture)) {\r\n                return this.expressChord(gesture, options);\r\n            }\r\n\r\n            // Handle chord object\r\n            if (typeof gesture === 'object' && gesture.type === 'chord') {\r\n                return this.expressChord(gesture.gestures, options);\r\n            }\r\n\r\n            // Express called with single gesture\r\n            // In rhythm game mode, gestures will be triggered directly by gameplay\r\n            // No queuing needed - immediate response to player actions\r\n\r\n            // Direct mapping to renderer methods for all gestures\r\n            const rendererMethods = {\r\n                'bounce': 'startBounce',\r\n                'pulse': 'startPulse',\r\n                'shake': 'startShake',\r\n                'spin': 'startSpin',\r\n                'nod': 'startNod',\r\n                'tilt': 'startTilt',\r\n                'expand': 'startExpand',\r\n                'contract': 'startContract',\r\n                'flash': 'startFlash',\r\n                'drift': 'startDrift',\r\n                'stretch': 'startStretch',\r\n                'glow': 'startGlow',\r\n                'sparkle': 'startSparkle',\r\n                'shimmer': 'startShimmer',\r\n                'wiggle': 'startWiggle',\r\n                'groove': 'startGroove',\r\n                'point': 'startPoint',\r\n                'lean': 'startLean',\r\n                'reach': 'startReach',\r\n                'headBob': 'startHeadBob',\r\n                'orbit': 'startOrbit',\r\n                'flicker': 'startFlicker',\r\n                'vibrate': 'startVibrate',\r\n                'wave': 'startWave',\r\n                'breathe': 'startBreathe',\r\n                'morph': 'startMorph',\r\n                'slowBlink': 'startSlowBlink',\r\n                'look': 'startLook',\r\n                'settle': 'startSettle',\r\n                'orbit': 'startOrbital',\r\n                'orbital': 'startOrbital',  // Alias for backwards compatibility\r\n                'hula': 'startHula',\r\n                'sway': 'startSway',\r\n                'breathIn': 'startBreathIn',\r\n                'breathOut': 'startBreathOut',\r\n                'breathHold': 'startBreathHold',\r\n                'breathHoldEmpty': 'startBreathHoldEmpty',\r\n                'jump': 'startJump',\r\n                'rain': 'startRain',\r\n                'runningman': 'startRunningMan',\r\n                'charleston': 'startCharleston',\r\n                // Ambient dance gestures\r\n                'grooveSway': 'startGrooveSway',\r\n                'grooveBob': 'startGrooveBob',\r\n                'grooveFlow': 'startGrooveFlow',\r\n                'groovePulse': 'startGroovePulse',\r\n                'grooveStep': 'startGrooveStep'\r\n                // Note: burst, peek, hold, scan, twitch, jitter, float\r\n                // are handled by the gesture system below\r\n            };\r\n            \r\n            // Check if this gesture has a direct renderer method\r\n            const methodName = rendererMethods[gesture];\r\n            if (methodName && this.renderer && this.renderer[methodName]) {\r\n                // Call the renderer method directly\r\n                this.renderer[methodName](options);\r\n\r\n                // Play gesture sound effect if available and enabled\r\n                if (this.config.soundEnabled && this.soundSystem.isAvailable()) {\r\n                    this.soundSystem.playGestureSound(gesture);\r\n                }\r\n\r\n                // Performance marker: Gesture end\r\n                if (this.performanceMonitor) {\r\n                    const gestureEndTime = performance.now();\r\n                    this.performanceMonitor.markGestureEnd(gestureName);\r\n                    this.performanceMonitor.recordGestureTime(gestureName, gestureEndTime - gestureStartTime);\r\n                }\r\n\r\n                return this;\r\n            }\r\n            \r\n            // Try to execute gesture through the particle system\r\n            // This handles modular gestures from the gesture registry\r\n            // Check if gesture exists in the gesture registry\r\n            const gestureConfig = getGesture(gesture);\r\n            \r\n            if (gestureConfig) {\r\n                // Register gesture's rhythm configuration\r\n                rhythmIntegration.registerConfig('gesture', gesture, gestureConfig);\r\n                \r\n                // Store the current gesture info for the particle system to use\r\n                this.currentModularGesture = {\r\n                    type: gesture,\r\n                    config: gestureConfig,\r\n                    startTime: performance.now(),\r\n                    duration: gestureConfig.defaultParams?.duration || 1000,\r\n                    progress: 0\r\n                };\r\n                \r\n                // Executed gesture through particle system\r\n                \r\n                // Play gesture sound effect if available and enabled\r\n                if (this.config.soundEnabled && this.soundSystem.isAvailable()) {\r\n                    this.soundSystem.playGestureSound(gesture);\r\n                }\r\n\r\n                // Performance marker: Gesture end\r\n                if (this.performanceMonitor) {\r\n                    const gestureEndTime = performance.now();\r\n                    this.performanceMonitor.markGestureEnd(gestureName);\r\n                    this.performanceMonitor.recordGestureTime(gestureName, gestureEndTime - gestureStartTime);\r\n                }\r\n\r\n                return this;\r\n            }\r\n            \r\n            // Unknown gesture - throttled warning\r\n            this.throttledWarn(`Unknown gesture: ${gesture}`, `gesture_${gesture}`);\r\n\r\n            // Performance marker: Gesture end (failed)\r\n            if (this.performanceMonitor) {\r\n                this.performanceMonitor.markGestureEnd(gestureName);\r\n            }\r\n\r\n            return this;\r\n        }, 'gesture-expression', this)();\r\n    }\r\n\r\n    /**\r\n     * Express multiple gestures simultaneously (chord)\r\n     * @param {Array<string>} gestures - Array of gesture names to execute together\r\n     * @param {Object} options - Options for the chord execution\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    expressChord(gestures, options = {}) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!gestures || !Array.isArray(gestures) || gestures.length === 0) {\r\n                return this;\r\n            }\r\n\r\n            // Import gesture compatibility if not loaded\r\n            if (!this.gestureCompatibility) {\r\n                // Try to load it dynamically\r\n                import('./core/GestureCompatibility.js').then(module => {\r\n                    this.gestureCompatibility = module.default;\r\n                }).catch(err => {\r\n                    console.warn('GestureCompatibility not available:', err);\r\n                });\r\n            }\r\n\r\n            // Use compatibility system if available\r\n            const compatibleGestures = this.gestureCompatibility ?\r\n                this.gestureCompatibility.getCompatibleGestures(gestures) :\r\n                gestures;\r\n\r\n            console.log('Executing gesture chord:', compatibleGestures);\r\n\r\n            // Execute all compatible gestures simultaneously\r\n            compatibleGestures.forEach(gestureName => {\r\n                const normalizedGesture = typeof gestureName === 'string' ?\r\n                    gestureName : gestureName.gestureName;\r\n\r\n                // Execute directly to ensure simultaneity\r\n                this.executeGestureDirectly(normalizedGesture, options);\r\n            });\r\n\r\n            // Check for enhancing combination\r\n            if (this.gestureCompatibility?.isEnhancingCombination?.(compatibleGestures)) {\r\n                // Add extra visual flair\r\n                this.renderer?.specialEffects?.addSparkle?.();\r\n            }\r\n\r\n            return this;\r\n        }, 'gesture-chord', this)();\r\n    }\r\n\r\n    /**\r\n     * Execute a gesture directly on the renderer (bypasses routing)\r\n     * @private\r\n     */\r\n    executeGestureDirectly(gesture, options = {}) {\r\n        // Direct mapping to renderer methods\r\n        const rendererMethods = {\r\n            'bounce': 'startBounce',\r\n            'pulse': 'startPulse',\r\n            'shake': 'startShake',\r\n            'spin': 'startSpin',\r\n            'nod': 'startNod',\r\n            'tilt': 'startTilt',\r\n            'flash': 'startFlash',\r\n            'glow': 'startGlow',\r\n            'sparkle': 'startSparkle',\r\n            'shimmer': 'startShimmer',\r\n            'wiggle': 'startWiggle',\r\n            'groove': 'startGroove',\r\n            'point': 'startPoint',\r\n            'lean': 'startLean',\r\n            'reach': 'startReach',\r\n            'headBob': 'startHeadBob',\r\n            'orbit': 'startOrbit',\r\n            'sway': 'startSway',\r\n            'jump': 'startJump',\r\n            'wave': 'startWave',\r\n            'flicker': 'startFlicker',\r\n            'breathe': 'startBreathe',\r\n            'float': 'startFloat',\r\n            'rain': 'startRain',\r\n            'hula': 'startHula',\r\n            'twist': 'startTwist'\r\n        };\r\n\r\n        const methodName = rendererMethods[gesture];\r\n        if (methodName && this.renderer && typeof this.renderer[methodName] === 'function') {\r\n            this.renderer[methodName](options);\r\n        }\r\n\r\n        // Emit event\r\n        this.emit('gesture', { name: gesture, options });\r\n    }\r\n\r\n    /**\r\n     * Chains multiple gestures for sequential execution\r\n     * @param {...string} gestures - Gestures to chain\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    chain(...gestures) {\r\n        // Parse the chain using GestureCompatibility if available\r\n        if (this.gestureCompatibility) {\r\n            const steps = this.gestureCompatibility.parseChain(gestures.join('>'));\r\n            // Execute first step (which might be a chord)\r\n            if (steps.length > 0) {\r\n                const firstStep = steps[0];\r\n                if (firstStep.length > 1) {\r\n                    this.expressChord(firstStep);\r\n                } else {\r\n                    this.express(firstStep[0]);\r\n                }\r\n            }\r\n        } else {\r\n            // Fallback: execute first gesture\r\n            if (gestures.length > 0) {\r\n                this.express(gestures[0]);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Starts speech reactivity mode with audio level monitoring\r\n     * @param {AudioContext} audioContext - Web Audio API context\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    startSpeaking(audioContext) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!audioContext) {\r\n                throw new Error('AudioContext is required for speech reactivity');\r\n            }\r\n            \r\n            if (!this.config.enableAudio) {\r\n                // Audio is disabled, cannot start speech reactivity\r\n                return this;\r\n            }\r\n            \r\n            if (this.speaking) {\r\n                // Speech reactivity is already active\r\n                return this;\r\n            }\r\n            \r\n            // Initialize audio level processor\r\n            const success = this.audioLevelProcessor.initialize(audioContext);\r\n            \r\n            if (!success) {\r\n                // Failed to initialize audio level processor\r\n                return this;\r\n            }\r\n            \r\n            // Update speech state\r\n            this.speaking = true;\r\n            \r\n            // Notify renderer about speech start\r\n            this.renderer.onSpeechStart(audioContext);\r\n            \r\n            // Emit speech start event with analyser for external connection\r\n            this.emit('speechStarted', { \r\n                audioContext, \r\n                analyser: this.audioLevelProcessor.getAnalyser(),\r\n                mascot: this\r\n            });\r\n            \r\n            // Speech reactivity started - connect audio source to analyser\r\n            return this;\r\n        }, 'speech-start', this)();\r\n    }\r\n\r\n    /**\r\n     * Stops speech reactivity mode and returns to base emotional state\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    stopSpeaking() {\r\n        return this.errorBoundary.wrap(() => {\r\n            return this.audioHandler.stopSpeaking();\r\n        }, 'speech-stop', this)();\r\n    }\r\n\r\n    /**\r\n     * Speaks text using the Web Speech API with visual feedback\r\n     * @param {string} text - Text to speak\r\n     * @param {Object} options - Speech options (rate, pitch, volume, voice)\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    speak(text, options = {}) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!this.tts.available) {\r\n                // Text-to-Speech is not available in this browser\r\n                return this;\r\n            }\r\n            \r\n            if (!text || typeof text !== 'string') {\r\n                // Invalid text provided to speak()\r\n                return this;\r\n            }\r\n            \r\n            // Cancel any ongoing speech\r\n            if (this.tts.speaking) {\r\n                window.speechSynthesis.cancel();\r\n            }\r\n            \r\n            // Create utterance\r\n            const utterance = new SpeechSynthesisUtterance(text);\r\n            \r\n            // Apply options\r\n            utterance.rate = options.rate || 1.0;\r\n            utterance.pitch = options.pitch || 1.0;\r\n            utterance.volume = options.volume || 1.0;\r\n            \r\n            // Select voice if specified\r\n            if (options.voice) {\r\n                const voices = window.speechSynthesis.getVoices();\r\n                const selectedVoice = voices.find(v => v.name === options.voice);\r\n                if (selectedVoice) {\r\n                    utterance.voice = selectedVoice;\r\n                }\r\n            }\r\n            \r\n            // Store current utterance\r\n            this.tts.currentUtterance = utterance;\r\n            \r\n            // Handle speech events\r\n            utterance.onstart = () => {\r\n                this.tts.speaking = true;\r\n                \r\n                // Trigger speaking gesture\r\n                this.express('pulse');\r\n                \r\n                // Emit TTS start event\r\n                this.emit('ttsStarted', { text, options });\r\n                \r\n                // TTS started\r\n            };\r\n            \r\n            utterance.onend = () => {\r\n                this.tts.speaking = false;\r\n                this.tts.currentUtterance = null;\r\n                \r\n                // Return to neutral\r\n                this.express('nod');\r\n                \r\n                // Emit TTS end event\r\n                this.emit('ttsEnded', { text });\r\n                \r\n                // TTS ended\r\n            };\r\n            \r\n            utterance.onerror = (error) => {\r\n                this.tts.speaking = false;\r\n                this.tts.currentUtterance = null;\r\n                \r\n                // TTS error\r\n                this.emit('ttsError', { error, text });\r\n            };\r\n            \r\n            // Add word boundary events for more dynamic animation\r\n            utterance.onboundary = (event) => {\r\n                if (event.name === 'word') {\r\n                    // Subtle pulse on each word\r\n                    if (Math.random() < 0.3) { // 30% chance per word\r\n                        // Trigger micro pulse gesture\r\n                        this.express('pulse');\r\n                    }\r\n                }\r\n            };\r\n            \r\n            // Start speaking\r\n            window.speechSynthesis.speak(utterance);\r\n            \r\n            return this;\r\n        }, 'tts-speak', this)();\r\n    }\r\n    \r\n    /**\r\n     * Stops any ongoing text-to-speech\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    stopTTS() {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!this.tts.available) {\r\n                return this;\r\n            }\r\n            \r\n            if (this.tts.speaking) {\r\n                window.speechSynthesis.cancel();\r\n                this.tts.speaking = false;\r\n                this.tts.currentUtterance = null;\r\n                \r\n                // Return to neutral\r\n                this.express('nod');\r\n                \r\n                // Emit TTS stopped event\r\n                this.emit('ttsStopped');\r\n                \r\n                // TTS stopped by user\r\n            }\r\n            \r\n            return this;\r\n        }, 'tts-stop', this)();\r\n    }\r\n    \r\n    /**\r\n     * Start recording state (listening/capturing mode)\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    startRecording() {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.recording) {\r\n                // Already recording\r\n                return this;\r\n            }\r\n            \r\n            this.recording = true;\r\n            \r\n            // Update renderer if using Emotive style\r\n            if (this.renderer && this.renderer.startRecording) {\r\n                this.renderer.startRecording();\r\n            }\r\n            \r\n            // Emit recording started event\r\n            this.emit('recordingStarted');\r\n            \r\n            // Recording started\r\n            return this;\r\n        }, 'recording-start', this)();\r\n    }\r\n    \r\n    /**\r\n     * Stop recording state\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    stopRecording() {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!this.recording) {\r\n                // Not currently recording\r\n                return this;\r\n            }\r\n            \r\n            this.recording = false;\r\n            \r\n            // Update renderer if using Emotive style\r\n            if (this.renderer && this.renderer.stopRecording) {\r\n                this.renderer.stopRecording();\r\n            }\r\n            \r\n            // Emit recording stopped event\r\n            this.emit('recordingStopped');\r\n            \r\n            // Recording stopped\r\n            return this;\r\n        }, 'recording-stop', this)();\r\n    }\r\n    \r\n    /**\r\n     * Enter sleep state with animation sequence\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    sleep() {\r\n        return this.errorBoundary.wrap(async () => {\r\n            if (this.sleeping) {\r\n                // Already sleeping\r\n                return this;\r\n            }\r\n            \r\n            // Sleep entry animation sequence\r\n            // Starting sleep sequence...\r\n            \r\n            // First: Yawn\r\n            this.express('yawn');\r\n            await new Promise(resolve => setTimeout(resolve, 1000));\r\n            \r\n            // Second: Drowsy sway\r\n            this.express('sway');\r\n            await new Promise(resolve => setTimeout(resolve, 1000));\r\n            \r\n            // Now enter sleep state\r\n            this.sleeping = true;\r\n            \r\n            // Update renderer if using Emotive style (handles eye closing)\r\n            if (this.renderer && this.renderer.enterSleepMode) {\r\n                this.renderer.enterSleepMode();\r\n            }\r\n            \r\n            // Update idle behavior if available\r\n            if (this.idleBehavior && this.idleBehavior.enterSleep) {\r\n                this.idleBehavior.enterSleep();\r\n            }\r\n            \r\n            // Emit sleep event\r\n            this.emit('sleep');\r\n            \r\n            // Mascot entered sleep state\r\n            return this;\r\n        }, 'sleep', this)();\r\n    }\r\n    \r\n    /**\r\n     * Wake up from sleep state with animation sequence\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    wake() {\r\n        return this.errorBoundary.wrap(async () => {\r\n            if (!this.sleeping) {\r\n                // Not currently sleeping\r\n                return this;\r\n            }\r\n            \r\n            // Exit sleep state first\r\n            this.sleeping = false;\r\n            \r\n            // Update renderer if using Emotive style (handles eye opening)\r\n            if (this.renderer && this.renderer.wakeUp) {\r\n                this.renderer.wakeUp();\r\n            }\r\n            \r\n            // Update idle behavior if available\r\n            if (this.idleBehavior && this.idleBehavior.wakeUp) {\r\n                this.idleBehavior.wakeUp();\r\n            }\r\n            \r\n            // Wake animation sequence\r\n            // Starting wake sequence...\r\n            \r\n            // First: Stretch\r\n            this.express('stretch');\r\n            await new Promise(resolve => setTimeout(resolve, 1000));\r\n            \r\n            // Second: Slow blink\r\n            this.express('slowBlink');\r\n            await new Promise(resolve => setTimeout(resolve, 1000));\r\n            \r\n            // Third: Small shake to fully wake\r\n            this.express('shake');\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            \r\n            // Emit wake event\r\n            this.emit('wake');\r\n            \r\n            // Mascot fully awake\r\n            return this;\r\n        }, 'wake', this)();\r\n    }\r\n    \r\n    /**\r\n     * Gets available TTS voices\r\n     * @returns {Array} Array of available voice objects\r\n     */\r\n    getTTSVoices() {\r\n        if (!this.tts.available) {\r\n            return [];\r\n        }\r\n        \r\n        return window.speechSynthesis.getVoices();\r\n    }\r\n    \r\n    /**\r\n     * Checks if TTS is currently speaking\r\n     * @returns {boolean} True if currently speaking\r\n     */\r\n    isTTSSpeaking() {\r\n        return this.tts.speaking;\r\n    }\r\n\r\n    /**\r\n     * Starts the animation loop at target 60 FPS\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    start() {\r\n        return this.errorBoundary.wrap(() => {\r\n            return this.visualizationRunner.start();\r\n        }, 'start', this)();\r\n    }\r\n\r\n    /**\r\n     * Stops the animation loop and cleans up resources\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    stop() {\r\n        return this.errorBoundary.wrap(() => {\r\n            return this.visualizationRunner.stop();\r\n        }, 'stop', this)();\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Sets a breathing pattern for the orb\r\n     * @param {number} inhale - Inhale duration in seconds\r\n     * @param {number} hold1 - Hold after inhale in seconds\r\n     * @param {number} exhale - Exhale duration in seconds\r\n     * @param {number} hold2 - Hold after exhale in seconds\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setBreathePattern(inhale, hold1, exhale, hold2) {\r\n        return this.errorBoundary.wrap(() => {\r\n            // Calculate total cycle time\r\n            const totalCycle = inhale + hold1 + exhale + hold2;\r\n            \r\n            // Store pattern for custom animation\r\n            this.breathePattern = {\r\n                inhale,\r\n                hold1,\r\n                exhale,\r\n                hold2,\r\n                totalCycle,\r\n                currentPhase: 'inhale',\r\n                phaseStartTime: Date.now(),\r\n                phaseProgress: 0\r\n            };\r\n            \r\n            // Start custom breathing animation\r\n            this.startBreathingAnimation();\r\n            \r\n            return this;\r\n        }, 'setBreathePattern', this)();\r\n    }\r\n    \r\n    /**\r\n     * Directly sets the orb scale with animation\r\n     * @param {number} scale - Target scale (1.0 = normal)\r\n     * @param {number} duration - Animation duration in milliseconds\r\n     * @param {string} easing - Easing function ('linear', 'ease', 'easeIn', 'easeOut', 'easeInOut')\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setOrbScale(scale, duration = 1000, easing = 'easeInOut') {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.renderer) {\r\n                // Create scale animation\r\n                const startScale = this.currentOrbScale || 1.0;\r\n                const startTime = Date.now();\r\n                \r\n                const animate = () => {\r\n                    const elapsed = Date.now() - startTime;\r\n                    const progress = Math.min(elapsed / duration, 1);\r\n                    \r\n                    // Apply easing\r\n                    let easedProgress = progress;\r\n                    if (easing === 'easeIn') {\r\n                        easedProgress = progress * progress;\r\n                    } else if (easing === 'easeOut') {\r\n                        easedProgress = progress * (2 - progress);\r\n                    } else if (easing === 'easeInOut') {\r\n                        easedProgress = progress < 0.5\r\n                            ? 2 * progress * progress\r\n                            : -1 + (4 - 2 * progress) * progress;\r\n                    }\r\n                    \r\n                    // Calculate current scale\r\n                    this.currentOrbScale = startScale + (scale - startScale) * easedProgress;\r\n                    \r\n                    // Apply to renderer\r\n                    if (this.renderer.setCustomScale) {\r\n                        this.renderer.setCustomScale(this.currentOrbScale);\r\n                    }\r\n                    \r\n                    // Continue animation\r\n                    if (progress < 1 && this.isRunning) {\r\n                        requestAnimationFrame(animate);\r\n                    }\r\n                };\r\n                \r\n                animate();\r\n            }\r\n            \r\n            return this;\r\n        }, 'setOrbScale', this)();\r\n    }\r\n    \r\n    /**\r\n     * Applies a preset breathing pattern\r\n     * @param {string} type - Preset type: 'calm', 'anxious', 'meditative', 'deep'\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    breathe(type = 'calm') {\r\n        return this.errorBoundary.wrap(() => {\r\n            const presets = {\r\n                calm: { inhale: 4, hold1: 0, exhale: 4, hold2: 0 },        // 4-4 breathing\r\n                anxious: { inhale: 2, hold1: 0, exhale: 2, hold2: 0 },    // Quick shallow\r\n                meditative: { inhale: 4, hold1: 7, exhale: 8, hold2: 0 }, // 4-7-8 breathing\r\n                deep: { inhale: 5, hold1: 5, exhale: 5, hold2: 5 },       // Box breathing\r\n                sleep: { inhale: 6, hold1: 0, exhale: 8, hold2: 2 }       // Sleep breathing\r\n            };\r\n            \r\n            const pattern = presets[type] || presets.calm;\r\n            return this.setBreathePattern(pattern.inhale, pattern.hold1, pattern.exhale, pattern.hold2);\r\n        }, 'breathe', this)();\r\n    }\r\n    \r\n    /**\r\n     * Starts the custom breathing animation\r\n     * @private\r\n     */\r\n    startBreathingAnimation() {\r\n        // Cancel any existing breathing animation\r\n        if (this.breathingAnimationId) {\r\n            cancelAnimationFrame(this.breathingAnimationId);\r\n        }\r\n        \r\n        const animate = () => {\r\n            if (!this.breathePattern || !this.isRunning) return;\r\n            \r\n            const pattern = this.breathePattern;\r\n            const now = Date.now();\r\n            const phaseElapsed = (now - pattern.phaseStartTime) / 1000; // Convert to seconds\r\n            \r\n            let scale = 1.0;\r\n            let nextPhase = pattern.currentPhase;\r\n            \r\n            // Determine current phase and scale\r\n            switch (pattern.currentPhase) {\r\n                case 'inhale':\r\n                    if (phaseElapsed >= pattern.inhale) {\r\n                        nextPhase = 'hold1';\r\n                        pattern.phaseStartTime = now;\r\n                        this.emit('hold-start', { type: 'post-inhale' });\r\n                    } else {\r\n                        // Scale up during inhale\r\n                        const progress = phaseElapsed / pattern.inhale;\r\n                        scale = 1.0 + (0.3 * progress); // Expand to 1.3x\r\n                    }\r\n                    break;\r\n                    \r\n                case 'hold1':\r\n                    if (phaseElapsed >= pattern.hold1) {\r\n                        nextPhase = 'exhale';\r\n                        pattern.phaseStartTime = now;\r\n                        this.emit('exhale-start');\r\n                    }\r\n                    scale = 1.3; // Stay expanded\r\n                    break;\r\n                    \r\n                case 'exhale':\r\n                    if (phaseElapsed >= pattern.exhale) {\r\n                        nextPhase = 'hold2';\r\n                        pattern.phaseStartTime = now;\r\n                        this.emit('hold-start', { type: 'post-exhale' });\r\n                    } else {\r\n                        // Scale down during exhale\r\n                        const progress = phaseElapsed / pattern.exhale;\r\n                        scale = 1.3 - (0.4 * progress); // Contract to 0.9x\r\n                    }\r\n                    break;\r\n                    \r\n                case 'hold2':\r\n                    if (phaseElapsed >= pattern.hold2) {\r\n                        nextPhase = 'inhale';\r\n                        pattern.phaseStartTime = now;\r\n                        this.emit('inhale-start');\r\n                    }\r\n                    scale = 0.9; // Stay contracted\r\n                    break;\r\n            }\r\n            \r\n            // Update phase\r\n            if (nextPhase !== pattern.currentPhase) {\r\n                pattern.currentPhase = nextPhase;\r\n            }\r\n            \r\n            // Apply scale to renderer\r\n            if (this.renderer && this.renderer.setCustomScale) {\r\n                this.renderer.setCustomScale(scale);\r\n            }\r\n            \r\n            // Continue animation\r\n            this.breathingAnimationId = requestAnimationFrame(animate);\r\n        };\r\n        \r\n        // Start with inhale\r\n        this.breathePattern.currentPhase = 'inhale';\r\n        this.breathePattern.phaseStartTime = Date.now();\r\n        this.emit('inhale-start');\r\n        animate();\r\n    }\r\n    \r\n    /**\r\n     * Stops any active breathing animation\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    stopBreathing() {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.breathingAnimationId) {\r\n                cancelAnimationFrame(this.breathingAnimationId);\r\n                this.breathingAnimationId = null;\r\n            }\r\n            \r\n            this.breathePattern = null;\r\n            \r\n            // Reset scale\r\n            if (this.renderer && this.renderer.setCustomScale) {\r\n                this.renderer.setCustomScale(1.0);\r\n            }\r\n            \r\n            return this;\r\n        }, 'stopBreathing', this)();\r\n    }\r\n    \r\n    /**\r\n     * Adds an event listener for external integration hooks\r\n     * @param {string} event - Event name\r\n     * @param {Function} callback - Event callback function\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    on(event, callback) {\r\n        return this.errorBoundary.wrap(() => {\r\n            const success = this.eventManager.on(event, callback);\r\n            if (!success) {\r\n                // Failed to add event listener\r\n            }\r\n            return this;\r\n        }, 'event-listener-add', this)();\r\n    }\r\n\r\n    /**\r\n     * Removes an event listener\r\n     * @param {string} event - Event name\r\n     * @param {Function} callback - Event callback function to remove\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    off(event, callback) {\r\n        return this.errorBoundary.wrap(() => {\r\n            this.eventManager.off(event, callback);\r\n            return this;\r\n        }, 'event-listener-remove', this)();\r\n    }\r\n\r\n    /**\r\n     * Adds a one-time event listener that removes itself after first execution\r\n     * @param {string} event - Event name\r\n     * @param {Function} callback - Event callback function\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    once(event, callback) {\r\n        return this.errorBoundary.wrap(() => {\r\n            const success = this.eventManager.once(event, callback);\r\n            if (!success) {\r\n                // Failed to add once event listener\r\n            }\r\n            return this;\r\n        }, 'event-listener-once', this)();\r\n    }\r\n\r\n    /**\r\n     * Removes all listeners for a specific event or all events\r\n     * @param {string|null} event - Event name to clear, or null to clear all\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    removeAllListeners(event = null) {\r\n        return this.errorBoundary.wrap(() => {\r\n            const removedCount = this.eventManager.removeAllListeners(event);\r\n            if (removedCount > 0) {\r\n                // Cleared event listeners\r\n            }\r\n            return this;\r\n        }, 'event-listeners-clear', this)();\r\n    }\r\n\r\n    /**\r\n     * Gets the number of listeners for an event\r\n     * @param {string} event - Event name\r\n     * @returns {number} Number of listeners\r\n     */\r\n    listenerCount(event) {\r\n        return this.eventManager.listenerCount(event);\r\n    }\r\n\r\n    /**\r\n     * Gets all registered event names\r\n     * @returns {Array<string>} Array of event names\r\n     */\r\n    getEventNames() {\r\n        return this.eventManager.getEventNames();\r\n    }\r\n\r\n    /**\r\n     * Gets comprehensive event system statistics\r\n     * @returns {Object} Event system statistics and monitoring data\r\n     */\r\n    getEventStats() {\r\n        return this.eventManager.getEventStats();\r\n    }\r\n\r\n    /**\r\n     * Gets EventManager debugging information\r\n     * @returns {Object} Debug information about the event system\r\n     */\r\n    getEventDebugInfo() {\r\n        return this.eventManager.getDebugInfo();\r\n    }\r\n\r\n    /**\r\n     * Gets browser compatibility information\r\n     * @returns {Object} Browser compatibility details\r\n     */\r\n    getBrowserCompatibility() {\r\n        return {\r\n            browser: browserCompatibility.browser,\r\n            features: browserCompatibility.featureDetection.getFeatures(),\r\n            capabilities: browserCompatibility.capabilities,\r\n            appliedPolyfills: browserCompatibility.appliedPolyfills,\r\n            optimizations: browserCompatibility.browserOptimizations.getOptimizations()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets degradation manager status and settings\r\n     * @returns {Object|null} Degradation manager information or null if disabled\r\n     */\r\n    getDegradationStatus() {\r\n        if (!this.degradationManager) {\r\n            return null;\r\n        }\r\n        \r\n        return {\r\n            currentLevel: this.degradationManager.getCurrentLevel(),\r\n            availableFeatures: this.degradationManager.getAvailableFeatures(),\r\n            recommendedSettings: this.degradationManager.getRecommendedSettings(),\r\n            performanceStats: this.degradationManager.getPerformanceStats(),\r\n            allLevels: this.degradationManager.getAllLevels()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Manually set degradation level\r\n     * @param {number|string} level - Degradation level index or name\r\n     * @returns {boolean} True if level was set successfully\r\n     */\r\n    setDegradationLevel(level) {\r\n        if (!this.degradationManager) {\r\n            // Degradation manager is not enabled\r\n            return false;\r\n        }\r\n        \r\n        return this.degradationManager.setLevel(level);\r\n    }\r\n\r\n    /**\r\n     * Check if a specific feature is available in current degradation level\r\n     * @param {string} feature - Feature name (audio, particles, fullEffects, etc.)\r\n     * @returns {boolean} True if feature is available\r\n     */\r\n    isFeatureAvailable(feature) {\r\n        if (!this.degradationManager) {\r\n            // Fallback to basic feature detection\r\n            const features = browserCompatibility.featureDetection.getFeatures();\r\n            return features[feature] || false;\r\n        }\r\n        \r\n        return this.degradationManager.isFeatureAvailable(feature);\r\n    }\r\n\r\n    /**\r\n     * Force canvas context recovery\r\n     * @returns {boolean} True if recovery was successful\r\n     */\r\n    recoverCanvasContext() {\r\n        if (!this.contextRecovery) {\r\n            return false;\r\n        }\r\n        \r\n        return this.contextRecovery.recover();\r\n    }\r\n\r\n    /**\r\n     * Check if canvas context is currently lost\r\n     * @returns {boolean} True if context is lost\r\n     */\r\n    isCanvasContextLost() {\r\n        if (!this.contextRecovery) {\r\n            return false;\r\n        }\r\n        \r\n        return this.contextRecovery.isLost();\r\n    }\r\n\r\n    /**\r\n     * Enable or disable debug mode\r\n     * @param {boolean} enabled - Whether to enable debug mode\r\n     */\r\n    setDebugMode(enabled) {\r\n        this.debugMode = enabled;\r\n        \r\n        if (enabled) {\r\n            emotiveDebugger.log('INFO', 'Debug mode enabled');\r\n            emotiveDebugger.takeMemorySnapshot('debug-mode-enabled');\r\n        } else {\r\n            emotiveDebugger.log('INFO', 'Debug mode disabled');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get comprehensive debug report\r\n     * @returns {Object} Debug report including all system states\r\n     */\r\n    getDebugReport() {\r\n        const report = {\r\n            timestamp: Date.now(),\r\n            mascot: {\r\n                isRunning: this.isRunning,\r\n                speaking: this.speaking,\r\n                debugMode: this.debugMode,\r\n                config: this.config\r\n            },\r\n            \r\n            // System states\r\n            currentState: this.getCurrentState(),\r\n            performanceMetrics: this.getPerformanceMetrics(),\r\n            audioStats: this.getAudioStats(),\r\n            eventStats: this.getEventStats(),\r\n            \r\n            // Browser compatibility\r\n            browserCompatibility: this.getBrowserCompatibility(),\r\n            degradationStatus: this.getDegradationStatus(),\r\n            \r\n            // Runtime capabilities\r\n            runtimeCapabilities: runtimeCapabilities.generateReport(),\r\n            \r\n            // Debugger data\r\n            debuggerReport: emotiveDebugger.getDebugReport()\r\n        };\r\n\r\n        if (this.debugMode) {\r\n            emotiveDebugger.log('DEBUG', 'Generated debug report', {\r\n                reportSize: JSON.stringify(report).length,\r\n                sections: Object.keys(report)\r\n            });\r\n        }\r\n\r\n        return report;\r\n    }\r\n\r\n    /**\r\n     * Export debug data for external analysis\r\n     * @returns {Object} Exportable debug data\r\n     */\r\n    exportDebugData() {\r\n        const data = {\r\n            metadata: {\r\n                exportTime: Date.now(),\r\n                version: '1.0.0', // Should be dynamically set\r\n                userAgent: navigator.userAgent,\r\n                url: window.location?.href\r\n            },\r\n            \r\n            mascotState: {\r\n                config: this.config,\r\n                currentState: this.getCurrentState(),\r\n                isRunning: this.isRunning,\r\n                speaking: this.speaking\r\n            },\r\n            \r\n            performance: {\r\n                metrics: this.getPerformanceMetrics(),\r\n                degradationStatus: this.getDegradationStatus(),\r\n                frameTimings: emotiveDebugger.frameTimings\r\n            },\r\n            \r\n            compatibility: {\r\n                browser: this.getBrowserCompatibility(),\r\n                runtimeCapabilities: runtimeCapabilities.generateReport()\r\n            },\r\n            \r\n            debuggerData: emotiveDebugger.exportDebugData()\r\n        };\r\n\r\n        if (this.debugMode) {\r\n            emotiveDebugger.log('INFO', 'Exported debug data', {\r\n                dataSize: JSON.stringify(data).length\r\n            });\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * Start profiling a named operation\r\n     * @param {string} name - Profile name\r\n     * @param {Object} metadata - Additional metadata\r\n     */\r\n    startProfiling(name, metadata = {}) {\r\n        if (this.debugMode) {\r\n            emotiveDebugger.startProfile(name, metadata);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * End profiling and get results\r\n     * @param {string} name - Profile name\r\n     * @returns {Object|null} Profile results\r\n     */\r\n    endProfiling(name) {\r\n        if (this.debugMode) {\r\n            return emotiveDebugger.endProfile(name);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Take a memory snapshot\r\n     * @param {string} label - Snapshot label\r\n     */\r\n    takeMemorySnapshot(label) {\r\n        if (this.debugMode) {\r\n            emotiveDebugger.takeMemorySnapshot(label);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all debug data\r\n     */\r\n    clearDebugData() {\r\n        emotiveDebugger.clear();\r\n        \r\n        if (this.debugMode) {\r\n            emotiveDebugger.log('INFO', 'Debug data cleared');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get runtime performance capabilities\r\n     * @returns {Object} Runtime capabilities report\r\n     */\r\n    getRuntimeCapabilities() {\r\n        return runtimeCapabilities.generateReport();\r\n    }\r\n\r\n    /**\r\n     * Emits an event to all registered listeners with error boundary protection\r\n     * @param {string} event - Event name\r\n     * @param {*} data - Event data\r\n     */\r\n    emit(event, data = null) {\r\n        this.eventManager.emit(event, data);\r\n    }\r\n\r\n    /**\r\n     * Updates audio level monitoring (called by AnimationController)\r\n     * @param {number} deltaTime - Time since last frame in milliseconds\r\n     */\r\n    update(deltaTime) {\r\n        this.errorBoundary.wrap(() => {\r\n            this.visualizationRunner.update(deltaTime);\r\n        }, 'audio-update')();\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    /**\r\n     * Renders the current frame (called by AnimationController)\r\n     */\r\n    render() {\r\n        let deltaTime = 16.67; // Default fallback value\r\n        let renderStart = 0;\r\n        \r\n        try {\r\n            renderStart = this.debugMode ? performance.now() : 0;\r\n            \r\n            // Get deltaTime from animation controller\r\n            deltaTime = this.animationController ? this.animationController.deltaTime : 16.67;\r\n            \r\n            // Prepare render state\r\n            const renderState = {\r\n                properties: this.stateMachine.getCurrentEmotionalProperties(),\r\n                emotion: this.stateMachine.getCurrentState().emotion,\r\n                undertone: this.stateMachine.getCurrentState().undertone,\r\n                particleSystem: this.particleSystem,\r\n                speaking: this.speaking,\r\n                audioLevel: this.audioLevelProcessor.getCurrentLevel(),\r\n                gazeOffset: this.gazeTracker ? this.gazeTracker.currentGaze : { x: 0, y: 0 }\r\n            };\r\n            \r\n            \r\n            // Track frame timing for debugging\r\n            if (this.debugMode) {\r\n                emotiveDebugger.trackFrameTiming(deltaTime);\r\n            }\r\n            \r\n            // Always use EmotiveRenderer\r\n            // Clear canvas ONCE at the beginning\r\n            this.canvasManager.clear();\r\n            \r\n            // Update gaze tracker\r\n            if (this.gazeTracker) {\r\n                this.gazeTracker.update(deltaTime);\r\n            }\r\n            \r\n            // Update threat level for suspicion state based on gaze distance\r\n            if (renderState.emotion === 'suspicion' && this.gazeTracker) {\r\n                const suspicionEmotion = getEmotion('suspicion');\r\n                if (suspicionEmotion && suspicionEmotion.visual) {\r\n                    const gazeState = this.gazeTracker.getState();\r\n                    const mousePos = this.gazeTracker.mousePos;\r\n                    const centerX = this.canvasManager.width / 2;\r\n                    const centerY = this.canvasManager.height / 2 - this.config.topOffset;\r\n                    \r\n                    // Calculate distance from mouse to center\r\n                    const distance = Math.sqrt(\r\n                        Math.pow(mousePos.x - centerX, 2) + \r\n                        Math.pow(mousePos.y - centerY, 2)\r\n                    );\r\n                    \r\n                    // Maximum distance for threat calculation (canvas diagonal / 3)\r\n                    const maxDist = Math.min(this.canvasManager.width, this.canvasManager.height) / 2;\r\n                    \r\n                    // Closer = higher threat (inverted distance)\r\n                    const threatLevel = Math.max(0, Math.min(1, 1 - (distance / maxDist)));\r\n                    \r\n                    // Update the threat level\r\n                    suspicionEmotion.visual.threatLevel = threatLevel;\r\n                }\r\n            }\r\n            \r\n            // For Emotive style, convert emotion to visual params (AFTER updating threat level)\r\n            let emotionParams = getEmotionVisualParams(renderState.emotion);\r\n            \r\n            this.renderer.setEmotionalState(renderState.emotion, emotionParams, renderState.undertone);\r\n            \r\n            // Always use center for particle spawning (not gaze-adjusted position)\r\n            const orbX = this.canvasManager.width / 2;\r\n            let orbY = this.canvasManager.height / 2 - this.config.topOffset;\r\n\r\n            // Spawn new particles based on emotion at ORB position\r\n            // Get min/max from state machine\r\n            const stateProps = this.stateMachine.getCurrentEmotionalProperties();\r\n\r\n            // Apply vertical offset for certain emotions (like excited for exclamation mark)\r\n            if (stateProps.verticalOffset) {\r\n                orbY = (this.canvasManager.height / 2 - this.config.topOffset) + (this.canvasManager.height * stateProps.verticalOffset);\r\n            }\r\n            \r\n            // Apply undertone modifiers to particle behavior\r\n            let particleBehavior = emotionParams.particleBehavior || 'ambient';\r\n            let particleRate = emotionParams.particleRate || 15;\r\n            // Use emotionParams min/max if available, otherwise fall back to stateProps\r\n            let minParticles = emotionParams.minParticles !== undefined ? emotionParams.minParticles : (stateProps.minParticles || 0);\r\n            let maxParticles = emotionParams.maxParticles !== undefined ? emotionParams.maxParticles : (stateProps.maxParticles || 10);\r\n            \r\n            \r\n            // Special case for zen: mix falling and orbiting behaviors\r\n            if (renderState.emotion === 'zen') {\r\n                // Randomly choose between falling (sad) and orbiting (love) for each spawn\r\n                particleBehavior = Math.random() < 0.6 ? 'falling' : 'orbiting';\r\n            }\r\n            \r\n            // Check if renderer has undertone overrides\r\n            if (this.renderer.state && this.renderer.state.particleBehaviorOverride) {\r\n                particleBehavior = this.renderer.state.particleBehaviorOverride;\r\n            }\r\n            if (this.renderer.state && this.renderer.state.particleRateMult) {\r\n                particleRate = Math.floor(particleRate * this.renderer.state.particleRateMult);\r\n                maxParticles = Math.floor(maxParticles * this.renderer.state.particleRateMult);\r\n            }\r\n            \r\n            this.particleSystem.spawn(\r\n                particleBehavior,\r\n                renderState.emotion,\r\n                particleRate,\r\n                orbX,\r\n                orbY,\r\n                deltaTime,\r\n                null,  // no forced count\r\n                minParticles,\r\n                maxParticles,\r\n                this.renderer.scaleFactor || 1,  // Pass scale factor\r\n                this.config.classicConfig?.particleSizeMultiplier || 1,  // Pass particle size multiplier\r\n                emotionParams.particleColors || null,  // Pass emotion colors\r\n                renderState.undertone  // Pass undertone for saturation adjustments\r\n            );\r\n            \r\n            // Debug logging disabled to prevent console spam\r\n            // Uncomment only for debugging particle issues\r\n            // if (!this._particleDebugCounter) this._particleDebugCounter = 0;\r\n            // this._particleDebugCounter++;\r\n            // if (this._particleDebugCounter % 120 === 0) {  // Log every 2 seconds at 60fps\r\n            //     Particle status:\r\n            //         behavior: particleBehavior,\r\n            //         rate: particleRate,\r\n            //         emotion: renderState.emotion,\r\n            //         minParticles,\r\n            //         maxParticles,\r\n            //         currentCount: this.particleSystem.particles.length,\r\n            //         stats: this.particleSystem.getStats(),\r\n            //         position: { x: orbX, y: orbY }\r\n            //     });\r\n            // }\r\n            \r\n            // Get undertone modifier from renderer if present\r\n            const undertoneModifier = this.renderer.getUndertoneModifier ? \r\n                this.renderer.getUndertoneModifier() : null;\r\n            \r\n            // Add zen vortex intensity to undertone modifier if in zen state\r\n            let particleModifier = undertoneModifier;\r\n            if (renderState.emotion === 'zen' && this.renderer.state.zenVortexIntensity) {\r\n                particleModifier = { ...(undertoneModifier || {}), zenVortexIntensity: this.renderer.state.zenVortexIntensity };\r\n            }\r\n            \r\n            // Get current gesture info from renderer or modular gesture\r\n            let gestureMotion = null;\r\n            let gestureProgress = 0;\r\n            \r\n            // First check for modular gesture\r\n            if (this.currentModularGesture) {\r\n                const elapsed = performance.now() - this.currentModularGesture.startTime;\r\n                gestureProgress = Math.min(elapsed / this.currentModularGesture.duration, 1);\r\n                \r\n                if (gestureProgress >= 1) {\r\n                    // Ensure cleanup happens before clearing gesture\r\n                    gestureMotion = {\r\n                        type: this.currentModularGesture.type,\r\n                        amplitude: 1.0,\r\n                        frequency: 1.0,\r\n                        intensity: 1.0\r\n                    };\r\n                    // Pass progress = 1 to trigger cleanup\r\n                    gestureProgress = 1.0;\r\n                    // Clear gesture on next frame after cleanup\r\n                    if (!this.currentModularGesture.cleanupPending) {\r\n                        this.currentModularGesture.cleanupPending = true;\r\n                    } else {\r\n                        // Cleanup was called last frame, now clear the gesture\r\n                        this.currentModularGesture = null;\r\n                    }\r\n                } else {\r\n                    // Set gesture motion for particles\r\n                    gestureMotion = {\r\n                        type: this.currentModularGesture.type,\r\n                        amplitude: 1.0,\r\n                        frequency: 1.0,\r\n                        intensity: 1.0\r\n                    };\r\n                }\r\n            }\r\n            // Fallback to renderer gesture\r\n            else if (this.renderer && this.renderer.getCurrentGesture) {\r\n                const currentGesture = this.renderer.getCurrentGesture();\r\n                if (currentGesture && currentGesture.particleMotion) {\r\n                    gestureMotion = currentGesture.particleMotion;\r\n                    gestureProgress = currentGesture.progress || 0;\r\n                }\r\n            }\r\n            \r\n            // Update particles with orb position, gesture motion, and modifier\r\n            this.particleSystem.update(deltaTime, orbX, orbY, gestureMotion, gestureProgress, particleModifier);\r\n\r\n            // Get gesture transform from renderer\r\n            const gestureTransform = this.renderer.gestureAnimator ?\r\n                this.renderer.gestureAnimator.applyGestureAnimations() : null;\r\n\r\n            // Render BACKGROUND particles (behind orb)\r\n            this.particleSystem.renderBackground(this.canvasManager.getContext(), emotionParams.glowColor, gestureTransform);\r\n\r\n            // Render the Emotive orb in the MIDDLE layer\r\n            this.renderer.render(renderState, deltaTime, gestureTransform);\r\n\r\n            // Render FOREGROUND particles (in front of orb)\r\n            this.particleSystem.renderForeground(this.canvasManager.getContext(), emotionParams.glowColor, gestureTransform);\r\n            \r\n            // Draw debug information if enabled\r\n            if (this.config.showFPS || this.config.showDebug) {\r\n                this.renderDebugInfo(deltaTime);\r\n            }\r\n            \r\n            // Log render performance if debugging\r\n            if (this.debugMode) {\r\n                const renderTime = performance.now() - renderStart;\r\n                if (renderTime > 16.67) { // Longer than 60fps frame\r\n                    emotiveDebugger.log('WARN', 'Slow render frame detected', {\r\n                        renderTime,\r\n                        deltaTime,\r\n                        particleCount: this.particleSystem.getStats().activeParticles\r\n                    });\r\n                }\r\n            }\r\n        } catch (error) {\r\n            this.errorBoundary.logError(error, 'main-render');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders debug information overlay\r\n     * @param {number} deltaTime - Time since last frame in milliseconds\r\n     */\r\n    renderDebugInfo(deltaTime) {\r\n        const ctx = this.canvasManager.getContext();\r\n        ctx.save();\r\n        \r\n        ctx.fillStyle = '#ffffff';\r\n        ctx.font = '12px monospace';\r\n        ctx.strokeStyle = '#000000';\r\n        ctx.lineWidth = 2;\r\n        \r\n        let y = 20;\r\n        const lineHeight = 16;\r\n        \r\n        if (this.config.showFPS) {\r\n            const metrics = this.animationController.getPerformanceMetrics();\r\n            // Use smoothed FPS for stable display\r\n            const fps = metrics.instantFps || metrics.fps || 0;\r\n            const frameTime = metrics.averageFrameTime ? metrics.averageFrameTime.toFixed(1) : '0.0';\r\n            const particleStats = this.particleSystem.getStats();\r\n            \r\n            // Build simple display\r\n            const lines = [\r\n                `FPS: ${fps}`,\r\n                `Frame: ${frameTime}ms`,\r\n                `Particles: ${particleStats.activeParticles}`\r\n            ];\r\n            \r\n            // Draw each line\r\n            const padding = 8;\r\n            let maxWidth = 0;\r\n            lines.forEach(line => {\r\n                const width = ctx.measureText(line).width;\r\n                if (width > maxWidth) maxWidth = width;\r\n            });\r\n            \r\n            const x = this.canvasManager.width - maxWidth - padding - 10;\r\n            \r\n            // Background box with semi-transparent dark background\r\n            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n            ctx.fillRect(x - padding, y - 14, maxWidth + padding * 2, 18 * lines.length + 4);\r\n            \r\n            // Border color based on FPS\r\n            let borderColor;\r\n            if (fps >= 55) {\r\n                borderColor = '#00ff00';  // Green for good FPS\r\n            } else if (fps >= 30) {\r\n                borderColor = '#ffff00';  // Yellow for okay FPS\r\n            } else {\r\n                borderColor = '#ff0000';  // Red for poor FPS\r\n            }\r\n            \r\n            ctx.strokeStyle = borderColor;\r\n            ctx.lineWidth = 2;\r\n            ctx.strokeRect(x - padding, y - 14, maxWidth + padding * 2, 18 * lines.length + 4);\r\n            \r\n            // Draw each line of text\r\n            lines.forEach((line, i) => {\r\n                const lineY = y + (i * lineHeight);\r\n                // No stroke for cleaner look\r\n                ctx.fillStyle = '#ffffff';\r\n                ctx.fillText(line, x, lineY);\r\n            });\r\n            \r\n            y += lineHeight * lines.length;\r\n        }\r\n        \r\n        if (this.config.showDebug) {\r\n            const state = this.stateMachine.getCurrentState();\r\n            const particleStats = this.particleSystem.getStats();\r\n            \r\n            const debugInfo = [\r\n                `Emotion: ${state.emotion}${state.undertone ? ` (${state.undertone})` : ''}`,\r\n                `Particles: ${particleStats.activeParticles}/${particleStats.maxParticles}`,\r\n                `Gesture: ${this.currentModularGesture ? this.currentModularGesture.type : 'none'}`,\r\n                `Speaking: ${this.speaking ? 'yes' : 'no'}`,\r\n                `Audio Level: ${(this.audioLevel * 100).toFixed(1)}%`\r\n            ];\r\n            \r\n            // Draw debug info with background for readability\r\n            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n            const debugWidth = Math.max(...debugInfo.map(line => ctx.measureText(line).width));\r\n            ctx.fillRect(8, y - 14, debugWidth + 16, debugInfo.length * lineHeight + 4);\r\n            \r\n            ctx.fillStyle = '#ffffff';\r\n            for (const info of debugInfo) {\r\n                ctx.fillText(info, 10, y);\r\n                y += lineHeight;\r\n            }\r\n        }\r\n        \r\n        ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * Gets the current emotional color\r\n     * @returns {string} Hex color for current emotion\r\n     */\r\n    getEmotionalColor() {\r\n        const properties = this.stateMachine.getCurrentEmotionalProperties();\r\n        // Fallback to neutral gray if properties are undefined\r\n        return properties?.primaryColor || '#B0B0B0';\r\n    }\r\n\r\n    /**\r\n     * Gets the current emotional state information\r\n     * @returns {Object} Current state with properties\r\n     */\r\n    getCurrentState() {\r\n        return this.stateMachine.getCurrentState();\r\n    }\r\n\r\n    /**\r\n     * Gets all available emotions\r\n     * @returns {Array<string>} Array of emotion names\r\n     */\r\n    getAvailableEmotions() {\r\n        return this.stateMachine.getAvailableEmotions();\r\n    }\r\n\r\n    /**\r\n     * Gets all available undertones\r\n     * @returns {Array<string>} Array of undertone names\r\n     */\r\n    getAvailableUndertones() {\r\n        return this.stateMachine.getAvailableUndertones();\r\n    }\r\n\r\n    /**\r\n     * Gets the current audio level (0-1 range)\r\n     * @returns {number} Current audio level\r\n     */\r\n    getAudioLevel() {\r\n        return this.audioLevelProcessor.getCurrentLevel();\r\n    }\r\n\r\n    /**\r\n     * Gets audio level processing statistics\r\n     * @returns {Object} Audio processing statistics\r\n     */\r\n    getAudioStats() {\r\n        return this.audioLevelProcessor.getStats();\r\n    }\r\n\r\n    /**\r\n     * Updates audio level processor configuration\r\n     * @param {Object} config - New configuration options\r\n     */\r\n    updateAudioConfig(config) {\r\n        this.audioLevelProcessor.updateConfig(config);\r\n    }\r\n\r\n    /**\r\n     * Gets all available gestures\r\n     * @returns {Array<string>} Array of gesture names\r\n     */\r\n    getAvailableGestures() {\r\n        return [\r\n            'bounce', 'pulse', 'shake', 'spin', 'drift', \r\n            'nod', 'tilt', 'expand', 'contract', 'flash',\r\n            'stretch', 'glow', 'flicker', 'vibrate', 'wave',\r\n            'morph', 'slowBlink', 'look', 'settle',\r\n            'breathIn', 'breathOut', 'breathHold', 'breathHoldEmpty', 'jump'\r\n        ];\r\n    }\r\n\r\n    /**\r\n     * Connects an audio source to the speech analyser\r\n     * @param {AudioNode} audioSource - Web Audio API source node\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    connectAudioSource(audioSource) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!this.audioAnalyser) {\r\n                // Speech reactivity not started. Call startSpeaking() first.\r\n                return this;\r\n            }\r\n            \r\n            if (!audioSource || typeof audioSource.connect !== 'function') {\r\n                // Invalid audio source provided to connectAudioSource()\r\n                return this;\r\n            }\r\n            \r\n            // Connect the audio source to our analyser\r\n            audioSource.connect(this.audioAnalyser);\r\n            \r\n            // Audio source connected to speech analyser\r\n            this.emit('audioSourceConnected', { audioSource });\r\n            \r\n            return this;\r\n        }, 'audio-source-connection', this)();\r\n    }\r\n\r\n    /**\r\n     * Sets master volume for all audio output\r\n     * @param {number} volume - Volume level (0.0 to 1.0)\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setVolume(volume) {\r\n        return this.errorBoundary.wrap(() => {\r\n            return this.audioHandler.setVolume(volume);\r\n        }, 'volume-setting', this)();\r\n    }\r\n\r\n    /**\r\n     * Gets current master volume\r\n     * @returns {number} Current volume level (0.0 to 1.0)\r\n     */\r\n    getVolume() {\r\n        return this.config.masterVolume;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable gesture sounds\r\n     * @param {boolean} enabled - Whether to enable gesture sounds\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setSoundEnabled(enabled) {\r\n        this.config.soundEnabled = enabled;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Check if gesture sounds are enabled\r\n     * @returns {boolean} Whether gesture sounds are enabled\r\n     */\r\n    isSoundEnabled() {\r\n        return this.config.soundEnabled;\r\n    }\r\n\r\n    /**\r\n     * Pauses the animation loop (can be resumed with start())\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    pause() {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!this.animationController.isAnimating()) {\r\n                // EmotiveMascot is not running\r\n                return this;\r\n            }\r\n            \r\n            // Stop animation controller\r\n            this.animationController.stop();\r\n            this.isRunning = false;\r\n            \r\n            // Pause ambient audio\r\n            if (this.soundSystem.isAvailable()) {\r\n                this.soundSystem.stopAmbientTone(200); // Quick fade out\r\n            }\r\n            \r\n            this.emit('paused');\r\n            // EmotiveMascot paused\r\n            return this;\r\n        }, 'pause', this)();\r\n    }\r\n\r\n    /**\r\n     * Resumes the animation loop from paused state\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    resume() {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (this.animationController.isAnimating()) {\r\n                // EmotiveMascot is already running\r\n                return this;\r\n            }\r\n            \r\n            // Start animation controller\r\n            this.animationController.start();\r\n            this.isRunning = true;\r\n            \r\n            // Resume ambient audio\r\n            // Update ambient tone based on emotional state - DISABLED (annoying)\r\n            // if (this.soundSystem.isAvailable()) {\r\n            //     const currentEmotion = this.stateMachine.getCurrentState().emotion;\r\n            //     this.soundSystem.setAmbientTone(currentEmotion, 200);\r\n            // }\r\n            \r\n            this.emit('resumed');\r\n            // EmotiveMascot resumed\r\n            return this;\r\n        }, 'resume', this)();\r\n    }\r\n\r\n    /**\r\n     * Checks if the mascot is currently running\r\n     * @returns {boolean} True if animation loop is active\r\n     */\r\n    isActive() {\r\n        return this.animationController.isAnimating();\r\n    }\r\n\r\n    /**\r\n     * Sets the target FPS for performance monitoring\r\n     * @param {number} targetFPS - Target frames per second (default: 60)\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setTargetFPS(targetFPS) {\r\n        const clampedFPS = Math.max(15, Math.min(120, targetFPS)); // Clamp between 15-120 FPS\r\n        this.config.targetFPS = clampedFPS;\r\n        this.animationController.setTargetFPS(clampedFPS);\r\n        \r\n        // Target FPS set\r\n        this.emit('targetFPSChanged', { targetFPS: clampedFPS });\r\n        \r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets the current target FPS\r\n     * @returns {number} Target frames per second\r\n     */\r\n    getTargetFPS() {\r\n        return this.animationController.targetFPS;\r\n    }\r\n\r\n    /**\r\n     * Forces performance degradation mode (for testing)\r\n     * @param {boolean} enabled - Whether to enable degradation mode\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setPerformanceDegradation(enabled) {\r\n        const metrics = this.animationController.getPerformanceMetrics();\r\n        \r\n        if (enabled && !metrics.performanceDegradation) {\r\n            const currentMax = this.particleSystem.maxParticles;\r\n            const newMax = Math.max(5, Math.floor(currentMax * 0.5));\r\n            this.particleSystem.setMaxParticles(newMax);\r\n            \r\n            // Forced performance degradation\r\n        } else if (!enabled && metrics.performanceDegradation) {\r\n            this.particleSystem.setMaxParticles(this.config.maxParticles);\r\n            \r\n            // Disabled performance degradation\r\n        }\r\n        \r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets the current audio level (0-1) if speech reactivity is active\r\n     * @returns {number} Current audio level or 0 if not speaking\r\n     */\r\n    getAudioLevel() {\r\n        return this.speaking ? this.audioLevel : 0;\r\n    }\r\n\r\n    /**\r\n     * Checks if speech reactivity is currently active\r\n     * @returns {boolean} True if speech monitoring is active\r\n     */\r\n    isSpeaking() {\r\n        return this.speaking;\r\n    }\r\n\r\n    /**\r\n     * Sets the audio analyser smoothing time constant\r\n     * @param {number} smoothing - Smoothing value (0-1, default: 0.8)\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setAudioSmoothing(smoothing) {\r\n        return this.errorBoundary.wrap(() => {\r\n            const clampedSmoothing = Math.max(0, Math.min(1, smoothing));\r\n            \r\n            if (this.audioAnalyser) {\r\n                this.audioAnalyser.smoothingTimeConstant = clampedSmoothing;\r\n                // Audio smoothing set\r\n            } else {\r\n                // No audio analyser available. Start speech reactivity first.\r\n            }\r\n            \r\n            return this;\r\n        }, 'audio-smoothing', this)();\r\n    }\r\n\r\n    /**\r\n     * Gets comprehensive system status for debugging and monitoring\r\n     * @returns {Object} Complete system status\r\n     */\r\n    getSystemStatus() {\r\n        return this.errorBoundary.wrap(() => {\r\n            const state = this.stateMachine.getCurrentState();\r\n            const particleStats = this.particleSystem.getStats();\r\n            const rendererStats = this.renderer.getStats();\r\n            \r\n            const animationMetrics = this.animationController.getPerformanceMetrics();\r\n            \r\n            return {\r\n                // Core status\r\n                isRunning: animationMetrics.isRunning,\r\n                fps: animationMetrics.fps,\r\n                targetFPS: animationMetrics.targetFPS,\r\n                performanceDegradation: animationMetrics.performanceDegradation,\r\n                \r\n                // Emotional state\r\n                emotion: state.emotion,\r\n                undertone: state.undertone,\r\n                isTransitioning: state.isTransitioning,\r\n                transitionProgress: state.transitionProgress,\r\n                \r\n                // Gesture system\r\n                currentGesture: this.renderer?.currentGesture || null,\r\n                gestureActive: this.renderer?.isGestureActive() || false,\r\n                \r\n                // Particle system\r\n                particles: {\r\n                    active: particleStats.activeParticles,\r\n                    max: particleStats.maxParticles,\r\n                    poolEfficiency: particleStats.poolEfficiency\r\n                },\r\n                \r\n                // Audio system\r\n                audioEnabled: this.config.enableAudio,\r\n                soundSystemAvailable: this.soundSystem.isAvailable(),\r\n                speaking: this.speaking,\r\n                audioLevel: this.audioLevel,\r\n                masterVolume: this.config.masterVolume,\r\n                \r\n                // Renderer\r\n                renderer: {\r\n                    gradientCacheSize: rendererStats.gradientCacheSize,\r\n                    breathingPhase: rendererStats.breathingPhase,\r\n                    layers: rendererStats.layers\r\n                },\r\n                \r\n                // Event system\r\n                eventListeners: this.getEventNames().length,\r\n                \r\n                // Error boundary\r\n                errorStats: this.errorBoundary.getErrorStats()\r\n            };\r\n        }, 'system-status', {})();\r\n    }\r\n\r\n    /**\r\n     * Enables or disables debug mode\r\n     * @param {boolean} enabled - Whether to enable debug mode\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setDebugMode(enabled) {\r\n        this.config.showDebug = !!enabled;\r\n        this.config.showFPS = !!enabled;\r\n        \r\n        if (enabled) {\r\n            // Debug mode enabled - performance and state info will be displayed\r\n        } else {\r\n            // Debug mode disabled\r\n        }\r\n        \r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Triggers a manual error for testing error boundary\r\n     * @param {string} context - Error context for testing\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    triggerTestError(context = 'manual-test') {\r\n        return this.errorBoundary.wrap(() => {\r\n            throw new Error(`Test error triggered in context: ${context}`);\r\n        }, context, this)();\r\n    }\r\n\r\n    /**\r\n     * Gets current performance metrics\r\n     * @returns {Object} Performance data\r\n     */\r\n    getPerformanceMetrics() {\r\n        const animationMetrics = this.animationController.getPerformanceMetrics();\r\n        const state = this.stateMachine.getCurrentState();\r\n        \r\n        return {\r\n            ...animationMetrics,\r\n            currentEmotion: state.emotion,\r\n            currentUndertone: state.undertone,\r\n            isTransitioning: state.isTransitioning,\r\n            errorStats: this.errorBoundary.getErrorStats()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Register a plugin\r\n     * @param {Object} plugin - Plugin to register\r\n     * @returns {Promise<boolean>} Success status\r\n     */\r\n    async registerPlugin(plugin) {\r\n        return this.pluginSystem.registerPlugin(plugin);\r\n    }\r\n    \r\n    /**\r\n     * Set accessibility options\r\n     * @param {Object} options - Accessibility options\r\n     */\r\n    setAccessibility(options) {\r\n        if (options.colorBlindMode) {\r\n            this.accessibilityManager.setColorBlindMode(options.colorBlindMode);\r\n        }\r\n        if (options.reducedMotion !== undefined) {\r\n            this.accessibilityManager.reducedMotionPreferred = options.reducedMotion;\r\n        }\r\n        if (options.highContrast !== undefined) {\r\n            this.accessibilityManager.highContrastEnabled = options.highContrast;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get mobile optimization status\r\n     * @returns {Object} Mobile optimization status\r\n     */\r\n    getMobileStatus() {\r\n        return this.mobileOptimization.getStatus();\r\n    }\r\n    \r\n    /**\r\n     * Get accessibility status\r\n     * @returns {Object} Accessibility status\r\n     */\r\n    getAccessibilityStatus() {\r\n        return this.accessibilityManager.getStatus();\r\n    }\r\n    \r\n    /**\r\n     * Set the emotional state (alias for setEmotion for compatibility)\r\n     * @param {string} newState - The emotion/state to set\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    setState(newState) {\r\n        return this.setEmotion(newState);\r\n    }\r\n    \r\n    /**\r\n     * Speak text using TTS with synchronized animation\r\n     * @param {string} text - The text to speak\r\n     * @param {Object} options - TTS options\r\n     * @returns {SpeechSynthesisUtterance} The utterance object for additional control\r\n     */\r\n    speak(text, options = {}) {\r\n        // Check if speech synthesis is available\r\n        if (!window.speechSynthesis) {\r\n            // Speech synthesis not available in this browser\r\n            return null;\r\n        }\r\n        \r\n        // Create utterance\r\n        const utterance = new SpeechSynthesisUtterance(text);\r\n        \r\n        // Apply options\r\n        if (options.voice) utterance.voice = options.voice;\r\n        if (options.rate) utterance.rate = options.rate;\r\n        if (options.pitch) utterance.pitch = options.pitch;\r\n        if (options.volume) utterance.volume = options.volume;\r\n        if (options.lang) utterance.lang = options.lang;\r\n        \r\n        // Set up event handlers for animation sync\r\n        utterance.onstart = () => {\r\n            // TTS: Starting speech\r\n            this.setTTSSpeaking(true);\r\n            this.emit('tts:start', { text });\r\n        };\r\n        \r\n        utterance.onend = () => {\r\n            // TTS: Speech ended\r\n            this.setTTSSpeaking(false);\r\n            this.emit('tts:end');\r\n        };\r\n        \r\n        utterance.onerror = (event) => {\r\n            // TTS: Speech error\r\n            this.setTTSSpeaking(false);\r\n            this.emit('tts:error', { error: event });\r\n        };\r\n        \r\n        utterance.onboundary = (event) => {\r\n            // Word/sentence boundaries for potential lip-sync\r\n            this.emit('tts:boundary', { \r\n                name: event.name,\r\n                charIndex: event.charIndex,\r\n                charLength: event.charLength\r\n            });\r\n        };\r\n        \r\n        // Speak the text\r\n        window.speechSynthesis.speak(utterance);\r\n        \r\n        return utterance;\r\n    }\r\n    \r\n    /**\r\n     * Set TTS speaking state (triggers visual animation)\r\n     * @param {boolean} speaking - Whether TTS is speaking\r\n     */\r\n    setTTSSpeaking(speaking) {\r\n        this.ttsSpeaking = speaking;\r\n        \r\n        // Update renderer if using Emotive style\r\n        if (this.renderer && this.renderer.startSpeaking) {\r\n            if (speaking) {\r\n                this.renderer.startSpeaking();\r\n            } else {\r\n                this.renderer.stopSpeaking();\r\n            }\r\n        }\r\n        \r\n        // Also update the speaking flag for compatibility\r\n        this.speaking = speaking;\r\n    }\r\n    \r\n    /**\r\n     * Get available TTS voices\r\n     * @returns {Array} Array of available voices\r\n     */\r\n    getVoices() {\r\n        if (!window.speechSynthesis) {\r\n            return [];\r\n        }\r\n        return window.speechSynthesis.getVoices();\r\n    }\r\n    \r\n    /**\r\n     * Stop any ongoing TTS speech\r\n     */\r\n    stopTTS() {\r\n        if (window.speechSynthesis) {\r\n            window.speechSynthesis.cancel();\r\n            this.setTTSSpeaking(false);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Handle canvas resize events to trigger visual resampling\r\n     * This ensures visuals look crisp at any size\r\n     * @param {number} width - New canvas width\r\n     * @param {number} height - New canvas height\r\n     * @param {number} dpr - Device pixel ratio\r\n     */\r\n    handleResize(width, height, dpr) {\r\n        // EmotiveMascot handleResize\r\n        \r\n        // Force a re-initialization of the offscreen canvas in renderer\r\n        if (this.renderer && this.renderer.initOffscreenCanvas) {\r\n            this.renderer.initOffscreenCanvas();\r\n        }\r\n        \r\n        // Trigger a state update to recalculate all visual parameters\r\n        if (this.stateMachine) {\r\n            const currentEmotion = this.stateMachine.currentEmotion;\r\n            const currentUndertone = this.stateMachine.currentUndertone;\r\n            \r\n            // Re-apply current emotion to trigger fresh calculations\r\n            if (currentEmotion) {\r\n                this.stateMachine.setEmotion(currentEmotion);\r\n            }\r\n            \r\n            // Re-apply current undertone if any\r\n            if (currentUndertone && currentUndertone !== 'none') {\r\n                this.stateMachine.setUndertone(currentUndertone);\r\n            }\r\n        }\r\n        \r\n        // Emit resize event for any listeners\r\n        this.emit('resize', { width, height, dpr });\r\n    }\r\n    \r\n    /**\r\n     * Morph the core to a different shape\r\n     * @param {string} shape - Target shape name (circle, heart, star, sun, moon, eclipse, square, triangle)\r\n     * @param {Object} config - Morph configuration\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    morphTo(shape, config = {}) {\r\n        return this.errorBoundary.wrap(() => {\r\n            if (!this.shapeMorpher) {\r\n                // ShapeMorpher not initialized\r\n                return this;\r\n            }\r\n            \r\n            // Start the morph\r\n            this.shapeMorpher.morphTo(shape, config);\r\n            \r\n            // Pass shape morpher to renderer\r\n            if (this.renderer) {\r\n                this.renderer.shapeMorpher = this.shapeMorpher;\r\n            }\r\n            \r\n            // Emit event\r\n            this.emit('shapeMorphStarted', { from: this.shapeMorpher.currentShape, to: shape });\r\n            \r\n            // Morphing to new shape\r\n            return this;\r\n        }, 'morphTo', this)();\r\n    }\r\n    \r\n    /**\r\n     * Connect audio element for vocal visualization\r\n     * @param {HTMLAudioElement} audioElement - Audio element to analyze\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    connectAudio(audioElement) {\r\n        return this.errorBoundary.wrap(async () => {\r\n            return await this.audioHandler.connectAudio(audioElement);\r\n        }, 'connectAudio', this)();\r\n    }\r\n    \r\n    /**\r\n     * Disconnect audio analysis\r\n     * @returns {EmotiveMascot} This instance for chaining\r\n     */\r\n    disconnectAudio() {\r\n        return this.errorBoundary.wrap(() => {\r\n            return this.audioHandler.disconnectAudio();\r\n        }, 'disconnectAudio', this)();\r\n    }\r\n    \r\n    /**\r\n     * Get available shapes for morphing\r\n     * @returns {Array} List of available shape names\r\n     */\r\n    getAvailableShapes() {\r\n        return ShapeMorpher.getAvailableShapes();\r\n    }\r\n    \r\n    /**\r\n     * Destroys the mascot instance and cleans up resources\r\n     */\r\n    destroy() {\r\n        this.errorBoundary.wrap(() => {\r\n            // Stop animation\r\n            this.stop();\r\n            \r\n            // Stop speech reactivity\r\n            if (this.speaking) {\r\n                this.stopSpeaking();\r\n            }\r\n            \r\n            // Destroy animation controller\r\n            if (this.animationController) {\r\n                this.animationController.destroy();\r\n            }\r\n            \r\n            // Clean up all subsystems\r\n            if (this.soundSystem) {\r\n                this.soundSystem.cleanup();\r\n            }\r\n            \r\n            if (this.audioLevelProcessor) {\r\n                this.audioLevelProcessor.cleanup();\r\n            }\r\n            \r\n            if (this.particleSystem) {\r\n                this.particleSystem.destroy();\r\n            }\r\n            \r\n            if (this.renderer) {\r\n                // Stop all active gestures\r\n                this.renderer.stopAllGestures();\r\n                this.renderer.destroy();\r\n            }\r\n            \r\n            if (this.canvasManager) {\r\n                this.canvasManager.destroy();\r\n            }\r\n            \r\n            // Clear event listeners\r\n            if (this.eventManager) {\r\n                this.eventManager.destroy();\r\n            }\r\n            \r\n            // Destroy new systems\r\n            if (this.accessibilityManager) {\r\n                this.accessibilityManager.destroy();\r\n            }\r\n            \r\n            if (this.mobileOptimization) {\r\n                this.mobileOptimization.destroy();\r\n            }\r\n            \r\n            if (this.pluginSystem) {\r\n                this.pluginSystem.destroy();\r\n            }\r\n            \r\n            // Clean up shape morpher and audio analyzer\r\n            if (this.audioAnalyzer) {\r\n                this.disconnectAudio();\r\n                this.audioAnalyzer.destroy();\r\n            }\r\n            \r\n            if (this.shapeMorpher) {\r\n                this.shapeMorpher.reset();\r\n            }\r\n            \r\n            // DegradationManager removed\r\n            \r\n            // Clear error boundary\r\n            this.errorBoundary.clearErrors();\r\n            \r\n            // EmotiveMascot destroyed\r\n        }, 'destruction')();\r\n    }\r\n    \r\n    /**\r\n     * Throttled warning to reduce console spam\r\n     * @param {string} message - Warning message\r\n     * @param {string} key - Unique key for this warning type\r\n     */\r\n    throttledWarn(message, key) {\r\n        const now = Date.now();\r\n        const lastWarning = this.warningTimestamps[key] || 0;\r\n        \r\n        if (now - lastWarning > this.warningThrottle) {\r\n            // Warning message throttled\r\n            this.warningTimestamps[key] = now;\r\n        }\r\n    }\r\n}\r\n\r\nexport default EmotiveMascot;"],"names":["CanvasManager","constructor","canvas","this","ctx","getContext","alpha","desynchronized","willReadFrequently","dpr","window","devicePixelRatio","width","height","centerX","centerY","resizeCallbacks","handleResize","bind","addEventListener","resize","hasAttribute","attrWidth","parseInt","getAttribute","attrHeight","rect","getBoundingClientRect","scale","forEach","callback","error","onResize","push","clearTimeout","resizeTimeout","setTimeout","clear","clearRect","getCenter","x","y","setTransform","rotation","save","translate","rotate","restoreTransform","restore","getDimensions","destroy","removeEventListener","ErrorBoundary","errors","maxErrors","errorCounts","Map","defaults","emotion","gesture","audioLevel","particleCount","glowIntensity","coreSize","breathRate","color","wrap","fn","context","fallbackValue","args","logError","getDefault","errorEntry","timestamp","Date","toISOString","message","stack","count","get","set","length","shift","contextDefaults","rendering","hasOwnProperty","validateInput","value","type","defaultValue","includes","isNaN","hasExceededThreshold","threshold","getErrorStats","totalErrors","errorsByContext","Object","fromEntries","recentErrors","slice","clearErrors","attemptRecovery","operation","retryFn","maxRetries","attempts","Error","Promise","resolve","Math","pow","hexToRgb","hex","replace","split","map","char","join","r","substr","g","b","rgbToHex","toHex","component","round","max","min","toString","rgbToHsl","h","s","l","d","hslToRgb","hue2rgb","p","q","t","interpolateHsl","color1","color2","progress","rgb1","rgb2","hsl1","hsl2","h1","h2","hDiff","rgb","UNDERTONE_SATURATION","intense","confident","nervous","tired","subdued","applyUndertoneSaturation","undertone","factor","toLowerCase","hsl","adjustedRgb","adjustSaturation","linear","easeOutQuad","easeInQuad","easeInOutQuad","easeOutCubic","easeInCubic","easeInOutCubic","easeOutElastic","c4","PI","sin","easeOutBounce","n1","d1","easeInOutBack","c2","c1","easeOutSine","easeInOutSine","cos","applyEasing","start","end","easing","entries","neutral","joy","sadness","anger","fear","surprise","disgust","love","pluginEmotions","pluginAdapter$2","name","Array","from","keys","suspicion","emoji","description","visual","glowColor","particleRate","minParticles","maxParticles","particleBehavior","particleSpeed","breathDepth","coreJitter","particleColors","weight","threatLevel","getGlowIntensity","getParticleSpeed","getGlowColor","val","padStart","modifiers","speed","amplitude","intensity","smoothness","regularity","focus","addWobble","typicalGestures","transitions","duration","priority","special","coreSquint","scanInterval","scanDuration","scanAngle","twitchChance","peekInterval","maxThreatDistance","alertThreshold","glitch","primaryColor","eyeOpenness","glitchIntensity","flickerChance","rgbShift","digitalNoise","random","glitchColors","floor","addGlitch","addStutter","glitchIn","stutterInterval","stutterDuration","rgbOffset","scanlineEffect","datamoshChance","corruptionZones","digitalTearHeight","calm","addWeight","floatHeight","swayAmount","audio","ambientSound","transitionSound","gestureSound","volumeModifier","particleSpawn","pattern","frequency","burstOnEntry","fadeOnExit","spawnRadius","driftSpeed","coreAppearance","pupilSize","irisPattern","blinkRate","lookDirection","movement","floatPattern","floatPeriod","floatAmplitude","swayPattern","swayPeriod","swayAmplitude","microMovements","getCoreParams","state","time","now","breathPhase","scaleX","scaleY","eyeExpression","pupilOffset","glowPulse","updateParticle","particle","deltaTime","life","opacity","size","baseSize","renderCore","radius","emotionRegistry","emotionAliases","happy","peaceful","curious","frustrated","sad","getEmotion","emotionName","resolvedName","coreEmotion","pluginAdapter","getEmotionVisualParams","params","key","call","getParticleRate","addBounce","specialEffect","rhythm","enabled","particleEmission","syncMode","burstSize","offBeatRate","popcornSync","breathSync","mode","beatsPerBreath","glowSync","intensityRange","syncTo","attack","decay","patternBehaviors","waltz","swing","curve","dubstep","dropMultiplier","breakbeat","burstRange","sparkle","addGravity","addShake","shakeOnEntry","pulseRate","screenShake","particleTrails","temperatureEffect","addJitter","addPop","addRecoil","addWarmth","orbitalSync","speedMultiplier","onBeat","offBeat","radiusSync","subdivision","amount","barsPerBreath","intensityMapping","low","medium","high","addVibration","jitterSync","addLift","microAdjustments","addPrecision","EmotiveStateMachine","errorBoundary","speaking","emotional","current","target","startTime","isActive","currentWeight","targetWeight","interpolationCache","lastUpdate","cacheInterval","cachedProperties","cachedRenderState","initializeEmotionalStates","initializeUndertoneModifiers","emotionalStates","excited","resting","euphoria","focused","eyeArc","undertoneModifiers","jitterAmount","breathRateMultiplier","glowIntensityMultiplier","particleRateMultiplier","coreSizeMultiplier","amplificationFactor","dampeningFactor","setEmotion","has","hasEmotion","validEmotions","uniqueEmotions","Set","performance","undefined","_simulatedTime","applyUndertone","baseProperties","modifier","modified","update","updateEmotionalTransition","updateUndertoneTransition","transition","elapsed","easedProgress","getCurrentEmotionalProperties","properties","interpolateEmotionalProperties","fromEmotion","toEmotion","fromProps","toProps","getCurrentState","isTransitioning","transitionProgress","applyUndertoneModifier","clearUndertone","getUndertoneModifier","renderer","localMod","glowRadiusMult","getWeightedUndertoneModifiers","mod","targetMod","currentMod","reset","isValidEmotion","isValidUndertone","getAvailableEmotions","getAvailableUndertones","getTransitionProgress","completeTransition","interpolateProperty","to","easingType","enableSimulatedTime","selectWeightedColor","colors","totalExplicitWeight","unweightedCount","parsedColors","item","remainingWeight","defaultWeight","probTable","cumulative","entry","ambient","initialize","vx","vy","lifeDecay","emotionColors","behaviorData","upwardSpeed","waviness","friction","dt","data","PHYSICS","orbiting","isSparkle","baseRadius","scaleFactor","blinkPhase","blinkSpeed","blinkIntensity","fadePhase","fadeSpeed","minOpacity","maxOpacity","angle","angularVelocity","swaySpeed","floatOffset","floatSpeed","floatAmount","twinklePhase","twinkleSpeed","swayOffset","radiusPulse","currentRadius","targetX","targetY","verticalFloat","fadeValue","fadeOpacity","blinkValue","normalizedBlink","blink","baseOpacity","tempColor","rising","buoyancy","driftAmount","falling","gravity","drag","PLAYGROUND","popcorn","particleSizeMultiplier","hasGlow","glowSizeMultiplier","popDelay","hasPopped","popStrength","bounceDamping","bounceCount","maxBounces","spinRate","lifetime","popAngle","groundLevel","abs","sqrt","burst$1","isSuspicion","isSurprise","age","fadeStart","id","aggressive","acceleration","jitter","speedDecay","scattering","fleeSpeed","panicFactor","initialized","dx","dy","distance","repelling","repelStrength","minDistance","repelForce","connecting","attractionForce","chaosFactor","attractX","attractY","chaosX","chaosY","radiant","radialSpeed","shimmer","shimmerSpeed","dist","dirX","dirY","shimmerEffect","initializeAscending","ascensionSpeed","waveFactor","waveFrequency","fadeStartDistance","ascending","waveOffset","initialY","distanceTraveled","fadeProgress","fadeFactor","erratic","jitterStrength","directionChangeRate","speedVariation","newAngle","currentSpeed","spinPhase","cautious","pauseTimer","pauseDuration","moveDuration","isMoving","moveTimer","originalVx","originalVy","watchRadius","pullStrength","surveillance","config","behaviorState","scanDirection","scanSpeed","scanRange","scanCenter","modeTimer","nextModeChange","dartTarget","dartSpeed","patrolRadius","patrolAngle","alertLevel","lastPosition","role","primaryRole","changeMode","updateScanning","updateDarting","updateFrozen","updatePatrolling","sign","actualAngle","rand","glitchy","glitchTiming","probability","intensityOnBeat","intensityOffBeat","stutterSync","patterns","freezeOnDrop","dropDuration","randomFreeze","orbitRhythm","baseSpeed","wobbleSync","beatAcceleration","barReset","rgbSync","direction","maxSplit","noiseRhythm","trigger","orbitAngle","orbitRadius","orbitSpeed","glitchTimer","nextGlitch","isGlitching","glitchDuration","glitchOffset","stutterTimer","nextStutter","isFrozen","frozenPosition","frozenVelocity","hasGhost","ghostOffset","ghostAngle","rgbSplit","rgbPhase","noiseLevel","noiseBurst","beatPhase","beatFrequency","dropIntensity","beatIntensity","wobbleRadius","splitAmount","smoothing","directed","focusStrength","randomness","edgeBuffer","canvasWidth","canvasHeight","directedPhase","targetVx","targetVy","visuals","trailLength","sizeMultiplier","blurAmount","fizzy","baseRiseSpeed","wobbleAmplitude","wobbleFrequency","popChance","popForce","fizziness","wobblePhase","wobbleSpeed","bubbleSize","popTimer","isFizzing","wobble","zen","breathingOffset","breathIntensity","radiusVariation","floatY","pluginBehaviors","pluginAdapter$1","BEHAVIOR_REGISTRY","getBehavior","initializeBehavior","behaviorName","behavior","updateBehavior","burst","DEBUG_PARTICLES","ParticleBehaviors","registry","list","values","pluginGestures","bounce","musicalDuration","musical","beats","axis","damping","strength","particleMotion","timingSync","interruptible","blendable","crossfadePoint","amplitudeSync","frequencySync","multiplier","durationSync","accentResponse","patternOverrides","dropBeat","motion","gestureData","startY","startX","startVx","startVy","apply","easeProgress","phase","rhythmModulation","amplitudeMultiplier","accentMultiplier","frequencyMultiplier","oscillation","endFactor","cleanup","pulse","holdPeak","scaleAmount","glowAmount","range","atan2","baseDistance","pulseValue","rawPulse","expansion","targetDistance","moveSpeed","shake","axes","baseFrequency","scaling","originalX","originalY","randomAngle","offsetX","offsetY","pseudoRandom","seed","nod","minDuration","vibrate","tempoScaling","timer","vibrateX","vibrateY","orbit","rotations","zRotations","verticalOscillation","centripetal","speedSync","rotationSync","rotationsPerBar","zSync","pulsAmount","ratio","originalZ","z","initialAngle","orbitTilt","radiusPulseAmount","rotationMultiplier","transitionFactor","velocityTransition","zAngle","entryLerp","orbitalVx","orbitalVy","verticalOffset","lerpFactor","speedAngle","emotions","features","uses3D","smooth","looping","dramatic","twitch","recovery","maxOffset","sharpness","probabilitySync","accentBoost","intensitySync","twitchOffset","targetOffset","isTwitching","twitchTimer","cooldownTimer","lastTwitch","currentTime","sway","bars","float","wobbleAmount","originalSize","originalOpacity","wobbleMultiplier","jitterX","jitterY","fadeOut","spin","radiusMultiplier","spiralOut","accelerate","maintainDistance","accelerateOnBeat","expandOnBeat","contractOffBeat","startAngle","startRadius","speedProgress","rotationAmount","currentAngle","jump","jumpHeight","squashAmount","stretchAmount","anticipation","hangTime","landingImpact","driftOutward","squash","stretch","phaseSync","landing","heightSync","accent","deformationSync","squashOnBeat","stretchOnBeat","timing","hangTimeSync","baseDuration","dynamics","forte","piano","startSize","driftDirection","anticipationEnd","jumpEnd","squashProgress","easedSquash","jumpProgress","jumpCurve","hangProgress","stretchProgress","fallProgress","landProgress","easedLand","impactProgress","recoverProgress","morph","minBeats","maxBeats","phases","morphType","points","innerRadius","randomizeOrder","patternSync","verse","chorus","bridge","drop","formationBeat","holdBeats","dissolveBeat","sizeSync","degreesPerBar","mascot","rotationDirection","calculateStarPosition","calculateHeartPosition","calculateSquarePosition","calculateTrianglePosition","targetRadius","morphTargetX","morphTargetY","armAngle","armIndex","targetAngle","cosR","sinR","rotX","rotY","normalizedAngle","halfSize","tan","vertices","edgeIndex","nextIndex","edgeProgress","morphProgress","holdTime","holdStart","holdEnd","moveProgress","returnProgress","blendFactor","alternate","elastic","overshoot","centerBased","preserveArea","scaleSync","alternateSync","beatsPerChange","overlap","overshootSync","normal","downbeat","preservationSync","targetArea","altProgress","getElasticProgress","easeInElastic","tilt","gatherPhase","tiltAngle","liftAmount","homeRadius","angleSync","gatherSync","beatsBefore","releaseAfter","swaySync","syncopated","liftSync","upOnTilt","heightOnAccent","normalHeight","homeX","homeY","gatherProgress","easedGather","tiltProgress","maxTiltRad","swayAngle","tangentX","tangentY","returnX","returnY","orbital","maintainRadius","elliptical","use3D","zPhaseOffset","tonic","fifth","octave","third","bass","mid","treble","depthSync","major","minor","diminished","augmented","intervals","drift","calculatedRadius","zPhase","hula","verticalSync","radiusX","radiusY","verticalAmount","tiltOffset","scan","scanWidth","scanHeight","layers","sweepSync","beatsPerSweep","pauseOnDownbeat","reverseOnBar","layerSync","quiet","moderate","loud","stagger","pauseSync","widthSync","layer","isPaused","scanOffset","scanPosition","scanX","scanY","twist","rotationAngle","contractionFactor","twistFrequency","funk","disco","latin","startDistance","twistProgress","twistAmount","rotationRad","currentContraction","newDistance","moveStrength","bounceAmount","wave","phaseShift","liftHeight","fadeInOut","onWave","onStatic","slow","fast","adaptToPhrase","sustain","melodicResponse","ocean","electronic","orchestral","offset","adjustedPhase","radiusFactor","returnToOrigin","turbulence","angleSpread","distanceSync","crescendo","diminuendo","modulation","cadence","holdSync","shortPhrase","longPhrase","fermata","classical","jazz","new_age","driftAngle","spreadRad","angleOffset","turbulencePhase","homeProgress","easedHome","driftPhase","returnPhase","driftProgress","turbulenceX","turbulenceY","flicker","flickerRate","colorShift","strobe","pulseMode","groupFlicker","rateSync","triplet","opacitySync","onAccent","regular","strobeSync","isGrouped","baseColor","baseX","baseY","flickerTimer","lastFlicker","flickerState","groupId","colorHue","opacityMultiplier","pulsePhase","groupPhase","targetOpacity","currentOpacity","finalOpacity","hueShift","shiftHue","degrees","startsWith","hueRad","newG","newB","n","strengthSync","decaySync","rock","directional","outro","returnSync","onSectionChange","march","initialX","settle","dampingSync","onResolution","onTension","thresholdSync","cadenceResponse","minimalist","breathe","inhaleRadius","exhaleRadius","spiralStrength","breathRateSync","bpm","inhale","onUpbeat","onDownbeat","exhale","phrases","hold","ballad","uptempo","phaseOffset","referenceRadius","currentDx","currentDy","radiusDiff","moveX","moveY","expand","scaleTarget","persist","pianissimo","fortissimo","sforzando","scaleTargetSync","climax","build","release","expandFactor","contract","onRelease","metal","trap","contractFactor","flash","glowPeak","scalePeak","flashIntensity","burstStrength","glow","startOpacity","startGlow","glowValue","glowMultiplier","peek","peekDistance","peekSpeed","holdDuration","hideSpeed","offAccent","hideMultiplier","staggerBeats","syncopationResponse","peekAngle","originalDistance","staggerDelay","phaseTimer","peekOffset","adjustedProgress","peekProgress","hideProgress","peekX","peekY","createPlaceholderGesture","maxQueue","blend","wiggle","groove","point","lean","reach","headBob","GESTURE_REGISTRY","getGesture","syncType","override","shimmerProgress","rainEffect","rainProgress","fadeIn","fadePhaseSync","pulseSync","fade","holdStrength","allowDrift","onRest","onSound","pauseResponse","minimal","holdX","holdY","restoreFactor","slideDistance","stepHeight","syncToBeat","beatMultiplier","accentBeats","kickDistance","swivelRange","bounceHeight","rhythmEngine","timeSignature","isPlaying","currentBeat","currentBar","beatProgress","barProgress","beatDuration","barDuration","lastBeatTime","nextBeatTime","listeners","beatCallbacks","barCallbacks","subdivisions","sixteenth","eighth","audioSync","syncOffset","autoSync","humanize","currentPattern","initializePatterns","accents","isRunning","emit","stop","totalBeats","totalBars","beatsSinceStart","newBeat","newBar","onBar","updateSubdivisions","getTimeInfo","requestAnimationFrame","beatNumber","beatInBar","getAccent","humanTiming","beatInfo","beat","bar","barNumber","barInfo","swingRatio","nextBeatIn","setBPM","setTimeSignature","numerator","denominator","setPattern","patternName","onBeatCallback","add","delete","onBarCallback","event","on","syncToAudio","audioContext","audioSource","source","getAdapter","isOnBeat","tolerance","isOnSubdivision","getBeatSync","getAccentedValue","baseValue","beatsToMs","msToBeats","ms","getBPM","getPattern","rhythmIntegration","adapter","subsystemConfigs","activeModulations","handleBeat","handleBar","updateBPM","newBPM","rhythmManuallyStoppedForCurrentAudio","rhythmSyncVisualizer","active","registerConfig","rhythmConfig","originalConfig","applyGestureRhythm","sync","beatSync","accentedValue","assign","applyParticleRhythm","emotionState","particleSystem","timeInfo","emission","emitBurst","emissionRate","breath","breathProgress","applyBehaviorRhythm","triggerGlitch","speedBoost","resetOrbit","stutter","patternConfig","freeze","freezeDuration","lastBeatInfo","lastBarInfo","getMusicalDuration","originalDuration","isEnabled","bpmLocked","lockedBPM","resampleBPM","signature","timeSigDisplay","document","getElementById","textContent","Particle","zRoll","vz","maxLife","fadeInTime","fadeOutTime","isFadingOut","isCellShaded","cachedColors","lastColor","lastOpacity","undertoneModifier","gestureMotion","gestureProgress","gestureIsOverriding","isOverrideGesture","applyGestureMotion","gestureBehavior","margin","rhythmModifiedMotion","applyFullGestureMotion","isOutOfBounds","isAlive","setOutwardVelocity","outwardSpeed","upwardBias","getDepthAdjustedSize","depthScale","getState","position","velocity","getCachedColor","hexColor","roundedOpacity","cacheKey","hexToRgba","result","exec","render","emotionColor","isFinite","renderX","renderY","safeSize","particleColor","strokeStyle","lineWidth","beginPath","arc","stroke","discreteOpacity","fillStyle","fill","gradient","createRadialGradient","addColorStop","glowSize","glowGradient","minGlowOpacity","particleOpacity","globalCompositeOperation","ParticleSystem","absoluteMaxParticles","particles","pool","poolSize","totalParticlesCreated","totalParticlesDestroyed","stateChangeCount","lastMemoryCheck","lastLeakedCount","spawnAccumulator","poolHits","poolMisses","cleanupTimer","cleanupInterval","initializePool","getParticleFromPool","pop","currentEmotionColors","currentEmotion","returnParticleToPool","cachedGradient","cachedGradientKey","spawn","_spawn","resetAccumulator","_excitedDebugLogged","baseEmotionColors","currentUndertone","isArray","colorItem","applyUndertoneSaturationToArray","rhythmModulatedRate","emotionConfig","i","spawnSingleParticle","skipSpawnThisFrame","cappedDeltaTime","particlesPerMs","spawnPos","getSpawnPosition","clampedPos","clampToCanvas","palmCenter","swirlAngle","orbRadius","glowRadius","minSpawnRadius","maxSpawnRadius","ambientAngle","ambientRadius","aggressiveAngle","aggressiveRadius","burstAngle","burstRadius","repelAngle","repelRadius","cx","cy","gm","gp","um","_update","wrappedUpdate","performCleanup","leaked","removeParticle","setGestureBehavior","index","splice","gestureTransform","_render","renderBackground","_renderLayer","renderForeground","isForeground","visibleParticles","sort","a","_renderParticles","colorA","colorB","lastFillStyle","depthSize","fireflyGlow","fireflyEffect","particlePhase","fireflyTime","particleGlow","flickerEffect","flickerTime","normalizedDistance","shimmerTime","shimmerWave","glowEffect","glowProgress","radiateDelay","localProgress","localEnvelope","_originalGlow","globalAlpha","excess","_burst","actualCount","getStats","activeParticles","poolEfficiency","setMaxParticles","originalMaxParticles","cleanupDeadParticles","beforeCount","filter","removed","getParticlesByBehavior","validateParticles","UNDERTONE_MODIFIERS","none","addFlutter","addMicroShake","addPower","addHold","addDroop","addPause","addPulse","addFocus","addSoftness","addFade","GestureCompositor","cache","easingCache","preCalculateEasingCurves","easingTypes","Float32Array","steps","calculateEasing","getEasingValue","compose","gestureModule","base","emotionMod","getEmotionModifiers","undertoneMod","composed","applyModifiers","scaleModifier","selectEasing","effects","addFlow","addDrag","addTension","applyGestureSpecificMods","baseEasing","irregular","clearCache","zenVortex","vortexSpeed","spiralTightness","maxRadius","segments","arms","pulseSpeed","shouldActivate","zenTransition","arm","armOffset","drawSpiralArm","drawMeditationEyes","pulseMod","spiralRadius","moveTo","lineTo","createLinearGradient","eyeWidth","eyeSpacing","recordingGlow","minIntensity","maxIntensity","gradientStops","recording","drawRecordingIndicator","textSize","dotRadius","font","textAlign","textBaseline","strokeText","fillText","speakingPulse","scaleMultiplier","minPulse","ringEffect","smoothedLevel","rings","drawRings","ring","getScaleModifier","sleepingEffect","eyeClosedScale","breathingDepth","breathingRate","zParticleInterval","zDriftSpeed","zFadeSpeed","orbDimming","glowDimming","lastZSpawn","zParticles","sleeping","weights","randomWeight","drawZParticles","shadowBlur","shadowColor","getEyeOpenness","getBreathingModifiers","rate","depth","getDimmingValues","suspicionScan","squintAmount","squintSpeed","pupilShift","currentSquint","targetSquint","lastScanTime","scanPhase","scanning","suspicious","updateSquint","startScan","updateScan","diff","scanStartTime","getEyeModifiers","drawScanLines","setLineDash","endX","endY","gazeNarrowing","maxHorizontalScale","maxVerticalScale","focusThreshold","currentScaleX","currentScaleY","targetScaleX","targetScaleY","gazeIntensity","gazeLocked","narrowFactor","animateScales","diffX","diffY","getEyeScales","drawFocusIndicator","angles","rad","startDist","endDist","fingerprint","ringSpacing","rotationSpeed","waveAmplitude","breakPoints","scanLineSpeed","scanLineWidth","successColor","failColor","isScanning","scanResult","breaks","whorls","biometric","authenticating","ringBreaks","j","authResult","drawFingerprintPattern","drawScanLine","showAuthResult","ringRadius","shouldBreak","breakAngle","distortedRadius","distortedAngle","whorl","whorldX","whorldY","pointX","pointY","exp","px","py","text","completeScan","success","effectRegistry","registerEffect","effectModule","getEffect","effectName","applyEffect","effect","isEffectActive","noteDurations","whole","half","quarter","lastBPM","prewarmCache","commonDurations","JSON","stringify","toMilliseconds","currentBPM","toMusical","closestNote","closestDiff","note","closestSubdivision","exact","calculatePhases","phaseBeats","reduce","sum","cumulativeBeats","getBeatProgress","getBarProgress","timeToNextBoundary","boundary","beatsInBar","barsInPhrase","quantize","targetMs","isOnBoundary","timeToNext","getTempoAdaptation","baseTempo","tempoRatio","energy","GestureAnimator","activeGestures","gestureAnimations","slowBlink","look","breathIn","breathOut","breathHold","breathHoldEmpty","rain","runningman","charleston","startGesture","gestureName","specialEffects","slam","triggerChromaticAberration","gestureCompositor","lookDistance","wobbleFreq","anim","currentDriftAngle","tiltDirection","vibrateAngles","applyGestureAnimations","transform","applyBounce","applyPulse","applyShake","applySpin","applyNod","applyTilt","applyExpand","applyContract","applyFlash","applyDrift","applyStretch","applyGlow","applyFlicker","applyVibrate","applyOrbital","applyHula","applyWave","applyBreathe","applyMorph","applySlowBlink","applyLook","applySettle","applyBreathIn","applyBreathOut","applyBreathHold","applyBreathHoldEmpty","applyJump","applySway","applyFloat","applyRain","applyRunningMan","applyCharleston","applySparkle","applyShimmer","applyWiggle","applyGroove","applyPoint","applyLean","applyReach","applyHeadBob","applyOrbit","flashWave","glowTime","glowEnvelope","flashWaveData","stopAllGestures","getCurrentGesture","overrideGestures","gestureInfo","targetScale","outerRadius","waveIntensity","waveX","mag","vibration","amp","infinityX","holdPercent","exhaleProgress","lookProgress","yOffset","swayFrequency","rainIntensity","driftY","swayX","particleEffect","wiggleDirection","wiggleX","pointDirection","motionProgress","scaleProgress","side","bobPhase","bobY","startBounce","startPulse","startShake","startSpin","startNod","startTilt","startExpand","startContract","startFlash","startDrift","startStretch","startFlicker","startVibrate","startOrbital","startHula","startWave","startBreathe","startMorph","startSlowBlink","startLook","startSettle","startBreathIn","startBreathOut","startBreathHold","startBreathHoldEmpty","startJump","startSway","startFloat","startRain","startRunningMan","startCharleston","startSparkle","startShimmer","startWiggle","startGroove","startPoint","startLean","startReach","startHeadBob","startOrbit","slide","kick","pauseCurrentAnimation","pausedAt","pausedProgress","resumeAnimation","ColorUtilities","colorTransition","applyUndertoneModifiers","visualProperties","applyUndertoneToColor","undertoneType","fullySaturated","hslToHex","energetic","upbeat","mellow","startColorTransition","targetColor","targetIntensity","currentColor","currentIntensity","fromColor","toColor","fromIntensity","toIntensity","updateColorTransition","eased","SpecialEffects","canvasManager","recordingActive","sleepMode","speakingActive","zenModeActive","speakingRings","ringSpawnTimer","ringSpawnInterval","maxRings","sleepZ","sparkles","chromaticAberration","scaleValue","renderRecordingGlow","fillRect","renderRecordingIndicator","recSize","renderSleepIndicator","randomCase","renderSpeakingRings","coreRadius","renderZenCore","zenRadius","startRecording","stopRecording","enterSleepMode","wakeUp","startSpeaking","stopSpeaking","createSparkle","options","maxLifetime","renderSparkles","closePath","visibleCanvas","querySelector","style","animation","createElement","head","appendChild","applyChromaticAberration","sourceCanvas","prevComposite","drawImage","applyChromaticAberrationSimple","drawFunction","EyeRenderer","blinking","blinkingEnabled","blinkTimer","nextBlinkTime","getRandomBlinkTime","eyeClose","eyeOpen","startBlink","getBlinkScale","blinkProgress","drawEyes","lineCap","eyeY","eyeSize","drawHappyEyes","drawSadEyes","drawAngryEyes","drawSurprisedEyes","drawFocusedEyes","drawSleepyEyes","drawSuspiciousEyes","spacing","openness","setBlinkingEnabled","setSquintAmount","forceBlink","BreathingAnimator","breathingSpeed","breathingPhase","breathRateMult","breathDepthMult","breathIrregular","customScale","emotionBreathPatterns","angry","surprised","confused","amused","bored","anxious","determined","proud","content","hopeful","intrigued","embarrassed","grateful","inspired","silly","sleepy","undertoneRateMult","undertoneDepthMult","phaseIncrement","getBreathingScale","setCustomScale","setBreathingSpeed","setBreathingDepth","setBreathRateMultiplier","mult","setBreathDepthMultiplier","setIrregularBreathing","holdBreath","empty","releaseBreath","getBreathingInfo","isCustom","isIrregular","gradientCache","stats","hits","misses","evictions","maxSize","ttl","accessOrder","generateKey","x0","y0","r0","x1","y1","r1","stops","getRadialGradient","cached","updateAccessOrder","getLinearGradient","evictLRU","indexOf","keyToEvict","clearExpired","keysToDelete","hitRate","toFixed","createHelper","radial","GlowRenderer","targetGlowColor","glowColorTransition","glowColorTransitionSpeed","offscreenCanvas","offscreenCtx","cachedGlowColor","cachedGlowRadius","initOffscreenCanvas","updateOffscreenSize","renderGlow","renderGlowDirect","cacheGlowGradient","offCtx","center","renderZenGlow","updateGlowColor","lerpColor","setGlowIntensity","setGlowColor","CoreRenderer","coreColor","coreOpacity","coreBorderWidth","coreBorderColor","shapePoints","isMorphing","drawMorphedShape","drawCircle","drawDropShadow","shadowOffset","shadowGradient","step","shadowOffsetX","shadowOffsetY","renderSleepyCore","renderGlitchedCore","setShapePoints","clearShapePoints","setCoreColor","setCoreOpacity","setCoreBorder","getCoreInfo","hasBorder","shapePointCount","RotationBrake","brakeStartTime","brakeDuration","brakeStartRotation","brakeTargetRotation","brakeStartVelocity","onComplete","onProgress","DURATION_FACTOR","brakeToUpright","brakeToTarget","brakeToNearest","angleStep","manualRotation","currentVelocity","normalizedTarget","baseCycles","angleToTravel","setRotationSpeed","resolvePromise","updateBrake","virtualSpeed","complete","isBraking","emergencyStop","getProgress","AmbientDanceAnimator","animations","grooveSway","grooveBob","grooveFlow","groovePulse","grooveStep","activeAnimation","blendState","startAmbientAnimation","animationName","stopAmbientAnimation","updateBlendState","lerp","getTransform","stepPhase","stepProgress","smoothStep","AnimationPriority","animationLoopManager","callbacks","callbackIdCounter","frameId","lastFrameTime","fps","frameCount","targetFPS","targetFrameTime","frameBudget","prioritySkipCounters","AnimationPriority_MEDIUM","AnimationPriority_LOW","AnimationPriority_IDLE","performanceMonitor","frameTimeHistory","maxHistorySize","loop","register","lastRun","runCount","totalTime","unregister","setEnabled","cancelAnimationFrame","callbacksByPriority","groupCallbacksByPriority","timeSpent","shouldSkipPriority","callbackData","callbackStart","callbackTime","groups","callbackCount","averageFrameTime","maxFrameTime","minFrameTime","Infinity","total","setTargetFPS","setPerformanceMonitor","monitor","EmotiveRenderer","gestureAnimator","colorUtilities","eyeRenderer","breathingAnimator","glowRenderer","coreRenderer","rotationBrake","ambientDanceAnimator","coreSizeDivisor","defaultGlowColor","renderingStyle","baseScale","referenceSize","topOffset","canvasSize","gazeOffset","gazeTrackingEnabled","gazeTarget","zenVortexIntensity","targetSquintAmount","isSuspicious","episodicFlutter","particleRateMult","lastRotationUpdate","animationFrameIds","zenEnter","zenExit","loopCallbackIds","glowCache","maxCacheSize","episodicEffects","nextTrigger","recordingRings","recordingPulse","previousEmotion","targetEmotion","arcHeight","lotusMorph","petalSpread","smileCurve","saturationMult","brightnessMult","brightnessFlicker","episodicPowerPose","episodicMicroSleep","episodicLaserFocus","episodicWithdrawal","markFrameStart","frameStartTime","forceCleanRender","ambientTransform","logicalWidth","logicalHeight","originalCtx","stateMachine","weightedModifier","updateTimers","gestureTransforms","coreBreathFactor","glowBreathFactor","sleepOpacityMod","sleepScaleMod","glowOpacityMod","sleepEffect","dimming","sleepDimness","sleepScale","breathingScale","emotionSizeMult","undertoneSizeMult","effectiveGlowIntensity","episode","flutter","puffCurve","sagCurve","focusCurve","withdrawCurve","coreX","coreY","brakeUpdate","totalRotation","innerR","outerR","currentShadow","shapeMorpher","getCanvasPoints","getCurrentShadow","renderingSunEffects","renderSunEffects","currentShape","targetShape","isTransitioningToSolar","isTransitioningFromSolar","isAtSolar","isSolarToMoon","isMoonToSolar","renderMoonShadow","lunarOverlay","lunarShadow","coverage","progression","renderBaileysBeads","recordingEffect","frameTime","markFrameEnd","recordFrameTime","safeRadius","renderDropShadow","isAnimating","audioDeformation","vocalEnergy","shadow","texture","textureOpacity","textureGradient","coronaOpacity","innerGlow","coronaGradient","flares","wave1","wave2","wave3","grad","addFlame","tipX","tipY","perpX","perpY","quadraticCurveTo","rimGradient","hasSunRays","_beadStartTime","isLunarSolarTransition","beadCount","_currentBeads","order","_","delay","elapsedTime","bead","beadAge","beadX","beadY","coreGradient","isSolarOverlay","shadowProgress","animatedOffset","shadowX","angleRad","imageSmoothingEnabled","imageSmoothingQuality","clip","baseCoverage","shadowOpacity","diffusion","penumbraRadius","penumbraGradient","umbraRadius","umbraGradient","shakeOffset","basePulse","zenPulse","spread","smile","centerPetalBase","bezierCurveTo","sidePetalAlpha","lotusRadius","glowOriginY","lotusGlow","outerHalo","dimIntensity","updateUndertone","setEmotionalState","baseIntensity","glowMult","enterZenMode","exitZenMode","baseBreathRate","baseBreathDepth","emotionEyeOpenness","emotionEyeArc","setRotationAngle","setGazeOffset","gazeData","proximity","isLocked","idleTimer","isAsleep","getCurrentOrbPosition","animateEyeClose","eyeCloseDuration","dimProgress","dimEased","animateEyeOpen","brightenDuration","eyeProgress","eyeEased","animate","lotusProgress","lotusEased","straightenDuration","petalProgress","awakeProgress","blinkProg","shakeProg","driftProg","expandProgress","expandEased","settleProgress","setGazeTracking","gazeTrackingInitialized","initGazeTracking","handleMouseMove","e","clientX","left","clientY","top","handleTouchMove","touches","touch","cleanupGazeTracking","resetCanvasContext","contextStateManager","setQualityLevel","quality","qualityLevel","setQualityReduction","handleContextRecovery","newContext","startGrooveSway","startGrooveBob","startGrooveFlow","startGroovePulse","startGrooveStep","currentGesture","isGestureActive","some","GazeTracker","lockDistance","boundaryPadding","canvasCenter","mousePos","targetGaze","currentGaze","cachedRect","primaryTouch","handleMouseLeave","handleTouchStart","handleTouchEnd","onInteraction","updateCanvasCenter","attachEventListeners","resizeObserver","ResizeObserver","observe","passive","updateTargetGaze","changedTouches","identifier","updateTouchPosition","next","maxDistance","getGazeOffset","gaze","enable","disable","detachEventListeners","setInteractionCallback","disconnect","IdleBehavior","blinkInterval","blinkDuration","swayInterval","swayDuration","swayIntensity","sleepTimeout","isBlinking","isSwaying","timers","idle","swayProgress","nextBlink","getRandomInterval","nextSway","swayTarget","swayStart","onBlink","onSway","onSleep","onWake","updateBreathing","enterSleep","updateBlinking","updateSwaying","isBlinkingEnabled","endBlink","endSway","performWakeAnimation","stretchOffset","resetIdleTimer","getBreathingFactor","getBlinkProgress","getSwayOffset","interval","setCallback","breathingFactor","MusicTheory","A4_FREQUENCY","NOTES","INTERVALS","unison","minorSecond","majorSecond","minorThird","majorThird","perfectFourth","tritone","perfectFifth","minorSixth","majorSixth","minorSeventh","majorSeventh","SCALES","naturalMinor","harmonicMinor","melodicMinor","ionian","dorian","phrygian","lydian","mixolydian","aeolian","locrian","majorPentatonic","minorPentatonic","blues","chromatic","wholeHalfDiminished","arabic","japanese","hungarian","bebopMajor","CHORDS","sus2","sus4","maj7","min7","dom7","min7b5","dim7","maj9","min9","dom9","add9","maj11","min11","maj13","min13","EMOTION_MODES","tempo","articulation","alert","pleased","melancholy","playful","PROGRESSIONS","I_V_vi_IV","I_IV_V","ii_V_I","I_vi_IV_V","vi_IV_I_V","I_VI_ii_V","iii_vi_ii_V","I_ii_iii_IV","I_I_I_I_IV_IV_I_I_V_IV_I_V","i_VII_VI_VII","I_II_IV_I","noteToMidi","noteName","noteIndex","midiToFrequency","midiNote","noteToFrequency","generateScale","root","scaleType","rootMidi","generateChord","chordType","chord","generateProgression","chords","degree","chordRoot","log2","frequencies","getEmotionMusic","circleOfFifths","startNote","clockwise","noteBase","currentIndex","notes","analyzeInterval","note1","note2","midi1","midi2","semitones","intervalName","octaves","consonant","getIntervalRatio","generateMelody","stepProbability","restProbability","scaleNotes","melody","isRest","leap","durations","HarmonicSystem","musicTheory","currentKey","currentScale","currentTempo","voices","gain","pad","masterGain","createGain","connect","destination","reverb","createReverb","createDelay","createFilter","dryGain","wetGain","nextNoteTime","noteResolution","noteLength","currentChordIndex","currentMelodyNote","lookahead","scheduleAheadTime","convolver","createConvolver","sampleRate","impulse","createBuffer","channel","channelData","getChannelData","buffer","delayTime","feedback","createBiquadFilter","Q","musicParams","settings","freq","exponentialRampToValueAtTime","linearRampToValueAtTime","generateEmotionProgression","progressionType","playChord","chordGain","setValueAtTime","oscillators","osc","createOscillator","detune","chordId","playMelody","baseTime","noteGain","vibrato","vibratoGain","createPad","padGain","voiceGain","lfo","lfoGain","playGestureSound","soundFunction","arpeggio","startFreq","endFreq","chord1","chord2","f","startHarmony","scheduleHarmony","bassNote","playBassNote","secondsPerBeat","stopHarmony","setLayerActive","setMasterVolume","volume","setEffectsMix","wetness","dry","SoundSystem","isInitialized","nodes","master","harmonicSystem","useHarmonicSystem","warningTimestamps","warningThrottle","currentOscillator","currentGain","masterVolume","ambientVolume","emotionalTones","waveform","AudioContextClass","AudioContext","webkitAudioContext","resumeContext","resume","updateAmbientVolume","getMasterVolume","isAvailable","setHarmonicMode","stopAmbientTone","setHarmonicLayer","setHarmonicEffects","close","getEmotionalTone","setAmbientTone","transitionDuration","toneConfig","transitionTime","oscillator","gainNode","targetVolume","fadeOutDuration","fadeTime","gestureId","emotionalContext","soundConfig","getGestureSoundConfig","getEmotionalModifiers","baseVolume","applyFrequencyEnvelope","frequencyEnvelope","applyVolumeEnvelope","volumeEnvelope","throttledWarn","envelope","qualityReduction","maxOscillators","isSupported","SimpleFPSCounter","timestamps","smoothedFPS","smoothingFactor","frameTimes","maxFrameTimeSamples","getFPS","getSmoothedFPS","getFrameTime","getAverageFrameTime","getMetrics","status","AnimationController","animationFrameId","loopCallbackId","handleVisibilityChange","handleWindowBlur","handleWindowFocus","fpsCounter","subsystems","eventCallback","parentMascot","setSubsystems","soundSystem","required","system","setEventCallback","setParentMascot","hidden","wasRunning","pauseTime","pausedParticleCount","pause","resumeTime","gap","frameTimeAccumulator","lastUpdateTime","skipParticleSpawn","startFrame","endFrame","emotionalProps","updateMetrics","getActiveParticleCount","audioLatency","getLatency","getPerformanceMetrics","fpsMetrics","instantFps","AudioLevelProcessor","spikeThreshold","minimumSpikeLevel","spikeMinInterval","historySize","smoothingTimeConstant","fftSize","levelUpdateThrottle","analyser","dataArray","currentLevel","levelHistory","lastVolumeSpike","lastLevelEmit","levelUpdate","volumeSpike","createAnalyser","Uint8Array","frequencyBinCount","catch","emitError","updateAudioLevel","getByteFrequencyData","rms","calculateRMS","updateLevelHistory","detectVolumeSpikes","emitLevelUpdate","sumSquares","normalized","previousLevels","averagePrevious","level","emitVolumeSpike","previousAverage","spikeRatio","minimumLevel","clearHistory","getCurrentLevel","getLevelHistory","getAnalyser","getFrequencyData","isProcessingActive","onLevelUpdate","onVolumeSpike","onError","removeAllCallbacks","updateConfig","newConfig","getConfig","lastSpikeTime","timeSinceLastSpike","averageLevel","rawData","history","spikeData","callbackError","EventManager","registered","eventType","handler","group","generateId","listenerInfo","removeGroup","groupSet","removeAllForTarget","info","removeAllOfType","removeAll","createAutoRemove","remove","once","debounced","timeoutId","throttled","limit","inThrottle","getActiveListeners","analyzeLeaks","analysis","totalListeners","activeListeners","inactiveButNotRemoved","byTarget","byType","potentialLeaks","targetName","cleaned","AccessibilityManager","enableReducedMotion","enableHighContrast","enableScreenReaderSupport","enableKeyboardNavigation","enableFocusIndicators","announceStateChanges","colorBlindMode","reducedMotionPreferred","highContrastEnabled","screenReaderActive","keyboardNavigationActive","currentColorBlindMode","focusableElements","currentFocusIndex","focusHistory","liveRegion","announcementQueue","colorSchemes","highContrast","primary","secondary","background","protanopia","deuteranopia","tritanopia","dots","stripes","crosshatch","solid","statePatterns","detectUserPreferences","setupLiveRegion","setupKeyboardNavigation","setupPreferenceListeners","matchMedia","motionQuery","matches","contrastQuery","windowsHCQuery","detectScreenReader","hasAriaLive","hasAriaAtomic","hasRole","userAgent","navigator","hasATHints","setAttribute","overflow","body","handleKeyDown","handleKeyUp","addListener","onPreferenceChange","preventDefault","navigateFocus","shiftKey","activateCurrentFocus","clearFocus","handleArrowNavigation","focusableArray","element","setFocus","label","announce","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","onArrowNavigation","registerFocusableElement","bounds","action","unregisterFocusableElement","onFocusChange","processAnnouncementQueue","getAnimationSettings","originalSettings","iterations","particlesEnabled","complexAnimations","autoPlay","getColorScheme","originalColors","getStatePattern","applyPatternOverlay","patternCanvas","patternCtx","createDotPattern","createStripePattern","createCrosshatchPattern","canvasPattern","createPattern","setColorBlindMode","onColorSchemeChange","getStatus","reducedMotion","screenReader","keyboardNavigation","focusedElement","registeredElements","preference","onReducedMotionChange","onHighContrastChange","createStateDescription","parentNode","removeChild","MobileOptimization","enableTouchOptimization","enableViewportHandling","enableBatteryOptimization","enableOrientationSupport","enableResponsiveScaling","touchSensitivity","doubleTapDelay","swipeThreshold","pinchThreshold","isMobile","detectMobile","isTablet","detectTablet","isTouchDevice","detectTouch","isIOS","test","isAndroid","lastTouchTime","lastTapTime","tapCount","touchStartPosition","isPinching","isRotating","lastPinchDistance","lastRotation","gestureStartTime","gestureHistory","viewportSize","innerWidth","innerHeight","orientation","getOrientation","pixelRatio","lastViewportChange","batteryLevel","isCharging","lowPowerMode","mobilePerformanceSettings","reducedParticles","simplifiedAnimations","lowerFrameRate","reducedEffects","canvasScale","useOffscreenCanvas","supportsOffscreenCanvas","handleTouchCancel","handleOrientationChange","handleViewportChange","setupTouchHandlers","setupViewportHandlers","setupBatteryMonitoring","setupOrientationHandlers","applyMobileOptimizations","isMobileUA","keyword","isMobileSize","hasTouch","maxTouchPoints","isIPad","isAndroidTablet","isWindowsTablet","isTabletSize","msMaxTouchPoints","OffscreenCanvas","getCanvas","touchAction","userSelect","webkitUserSelect","setupViewportMeta","viewportMeta","getBattery","battery","charging","onBatteryChange","DeviceOrientationEvent","handleDeviceOrientation","currentX","currentY","handleSingleTouchStart","handleMultiTouchStart","emitTouchEvent","touch1","touch2","getDistance","getAngle","storedTouch","handleSingleTouchMove","handleMultiTouchMove","deltaX","deltaY","currentDistance","pinchDelta","pinchRatio","delta","currentRotation","rotationDelta","applyOrientationOptimizations","beta","gamma","applyResponsiveScaling","isVisible","visible","applyBackgroundOptimizations","restorePerformance","x2","y2","optimizations","calculateOptimalCanvasScale","useWebGL","isLandscape","layoutMode","particleDirection","uiScale","viewport","animationsEnabled","audioEnabled","setCanvas","onTouchEvent","device","activeTouches","PluginSystem","enablePlugins","validatePlugins","sandboxPlugins","maxPlugins","pluginTimeout","allowOverrides","plugins","pluginTypes","pluginsByType","dependencies","dependencyGraph","pluginStates","loadingPlugins","activePlugins","hooks","pluginAPI","createPluginAPI","conflicts","resolutionStrategies","overrideConflict","merge","mergeConflict","reject","rejectConflict","queue","queueConflict","validationSchemas","createValidationSchemas","sandbox","createSandbox","registerHook","emitPluginEvent","onPluginEvent","getPlugin","hasPlugin","log","logFromPlugin","errorFromPlugin","setState","setPluginState","getPluginState","version","schemas","baseSchema","enum","author","init","updateEmotion","renderEmotion","keyframes","compatibility","executeGesture","canExecute","updateParticles","spawnParticle","sounds","playSound","processAudio","console","warn","localStorage","sessionStorage","fetch","XMLHttpRequest","api","registerPlugin","plugin","validatePlugin","valid","checkConflicts","resolveDependencies","resolved","initializePlugin","updateDependencyGraph","hook","schema","typeErrors","validateAgainstSchema","obj","rules","subErrors","conflictName","existingPlugin","existingName","newName","missing","dep","tryLoadDependency","dependencyName","pluginName","timeout","race","unregisterPlugin","getDependentPlugins","hookSet","dependents","deps","hookName","executeHooks","results","getPluginsByType","pluginNames","enablePlugin","onEnable","disablePlugin","onDisable","eventName","existing","incoming","totalPlugins","handlers","FeatureDetection","_cachedFeatures","capabilities","_cachedCapabilities","webAudio","detectWebAudio","canvas2d","detectCanvas2D","detectRequestAnimationFrame","detectDevicePixelRatio","detectAudioContext","mediaDevices","detectMediaDevices","detectPerformance","intersectionObserver","detectIntersectionObserver","assessCapabilities","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","getUserMedia","IntersectionObserver","score","Boolean","percentage","recommendations","getRecommendations","getFeatures","getCapabilities","PolyfillManager","polyfills","applied","feature","polyfillFn","applyAll","isApplied","polyfillRequestAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","msCancelAnimationFrame","polyfillPerformanceNow","polyfillWebAudio","array","suspend","CanvasContextRecovery","isContextLost","recoveryCallbacks","setupContextLossHandling","onRecovery","isLost","recover","BrowserOptimizations","_cachedBrowser","browser","_cachedOptimizations","detectBrowser","setupOptimizations","match","preferredAnimationMethod","audioContextOptions","latencyHint","canvasOptimizations","particleLimit","getOptimizations","getBrowser","applyCanvasOptimizations","getRecommendedParticleLimit","getAudioContextOptions","_initializationCache","_browserCompatibilityInstance","browserCompatibility","featureDetection","polyfillManager","browserOptimizations","appliedPolyfills","initializeBrowserCompatibility","DebugLevel","NONE","ERROR","WARN","INFO","DEBUG","TRACE","emotiveDebugger","enableProfiling","enableErrorTracking","enableMemoryTracking","maxLogEntries","maxProfileEntries","logs","profiles","memorySnapshots","frameTimings","maxFrameTimings","lastErrors","memory","stackTrace","setupErrorHandling","trackError","filename","lineno","colno","reason","promise","logEntry","getStackTrace","consoleMethod","getConsoleMethod","timeStr","String","errorKey","startProfile","metadata","profile","samples","profileSample","sample","relativeTime","endProfile","endTime","calculateProfileStats","oldestKey","sampleCount","avg","avgSampleDuration","minSampleDuration","maxSampleDuration","totalDuration","trackFrameTiming","takeMemorySnapshot","snapshot","usedJSHeapSize","totalJSHeapSize","jsHeapSizeLimit","getDebugReport","uptime","logCount","recentLogs","errorCount","uniqueErrors","activeProfiles","completedProfiles","getFrameTimingStats","avgFrameTime","avgFPS","minFPS","maxFPS","exportDebugData","exportTime","debuggerUptime","location","search","runtimeCapabilities","detectCapabilities","measurePerformance","es6","detectES6","es2017","detectES2017","modules","detectModules","webGL","detectWebGL","webGL2","detectWebGL2","webWorkers","detectWebWorkers","serviceWorkers","detectServiceWorkers","performanceObserver","detectPerformanceObserver","detectResizeObserver","detectLocalStorage","detectSessionStorage","indexedDB","detectIndexedDB","detectFetch","webSockets","detectWebSockets","touchEvents","detectTouchEvents","pointerEvents","detectPointerEvents","deviceOrientation","detectDeviceOrientation","canvasFilters","detectCanvasFilters","detectOffscreenCanvas","Symbol","async","Function","Worker","PerformanceObserver","WebSocket","PointerEvent","measurements","jsExecutionSpeed","canvasStart","canvasPerformance","getPerformance","generateReport","supportedFeatures","supported","unsupportedFeatures","supportPercentage","generateRecommendations","generateCircle","numPoints","generateSun","numRays","SHAPE_DEFINITIONS","circle","heart","generateHeart","star","starPoints","halfAngleStep","outerAngle","innerAngle","vertexCount","edgeFloat","v1","v2","generateStar","sun","corona","moon","softness","lunar","innerT","generateSuspicion","eclipse","square","pointsPerSide","generateSquare","triangle","sides","perimeter","totalPoints","sidePoints","generateTriangle","solar","arrayPool","pools","inUse","acquire","newArray","AudioDeformer","morpher","vocalEffectActive","beatGlitchIntensity","glitchPoints","bassEnergy","vocalPresence","highFreqEnergy","transientActive","transientStrength","transientDecay","transientHoldTime","transientHoldCounter","applyAudioDeformation","generateFallbackCircle","audioAnalyzer","currentFrequencies","frequencyData","currentBassEnergy","bassCount","bassPeakHistory","bassThumpTimer","avgBass","isMicrophoneMode","microphoneStream","effectMultiplier","spectralHistory","spectralFluxHistory","onsetThreshold","musicDetector","detectedBPM","onsetStrengths","detectedTimeSignature","timeSignatureConfidence","measureStartTime","timeSignatureHistory","timeSignatureLocked","currentSpectrum","spectralFlux","bassFlux","prevSpectrum","sorted","median","mean","isVocalOnset","isBeatOnset","vocalGlowBoost","onsetStrength","bassWeight","addOnset","bpmConfidence","forceFastDetection","bassHistory","historyIndex","vocalHistory","bassEffectActive","lastVocalPresence","hasFrequencyData","deformed","undulationDirection","undulationPhase","numGlitches","baseExpansion","undulation","breathPulse","waveCount","wiggleIntensity","glitchPoint","find","totalDeformation","setAudioDeformation","setVocalEnergy","updateFrequencyBands","vocal","processTransient","AgentBPMDetector","agents","maxAgents","confidence","peakHistory","maxHistoryLength","minBPM","maxBPM","convergenceThreshold","subdivisionPreference","prefer","veryfast","createAgent","effectiveBPM","beatInterval","initializeAgents","initialGuess","sub","agent","processPeak","fftGuess","getFFTEstimate","scoreAgent","evolveAgents","checkConvergence","peakTime","peakStrength","timeSinceLastBeat","expectedNextBeat","alignment","bestAgent","variation","newAgent","autoSelectSubdivision","recentPeaks","estimatedBPM","seedBPM","getSubdivision","locked","agentCount","topAgents","MusicDetector","onsetIntervals","lastOnsetTime","lastBPMCalculation","bpmCalculationInterval","bpmHistory","tempoLocked","fundamentalBPM","agentDetector","useAgentDetection","downbeatPhase","measureLength","isMusicalContent","musicalityScore","calculateBPM","agentStatus","analysisWindow","tempoCandidates","findTempoCandidates","bestCandidate","candidateBPM","recentBPMs","avgRecent","finalBPM","checkHarmonicRelation","maxChange","candidates","testIntervals","clusters","clusterIntervals","cluster","actualInterval","consistency","commonBPMBonus","currentCluster","bpm1","bpm2","detectTimeSignature","minOnsets","beatBins","recentOnsets","onset","beatPosition","binIndex","bin","detectedSig","testWaltzPattern","minReadings","counts","sig","mostCommon","maxCount","onsets","waltzGroups","totalGroups","first","second","getRecommendedSubdivision","getMusicInfo","isMusical","TransitionManager","transitionStartTime","easingFunction","previousShape","morphQueue","maxQueueSize","shadowConfig","startTransition","shape","getTransitionConfig","rawProgress","calculateShadowProgress","shadowIntensity","clearQueue","hasQueuedMorphs","queueLength","ShapeMorpher","morphDuration","transitionManager","audioDeformer","visualProgress","morphStartTime","shapeCache","currentPoints","targetPoints","lastAudioUpdate","lastVocalUpdate","audioUpdateInterval","bassEffectCooldown","vocalEffectCooldown","bassThresholdMultiplier","vocalThresholdMultiplier","queuedMorph","getShapePoints","shapesLoaded","shapeName","shapeDef","circlePoints","morphTo","force","completeMorph","transitionConfig","morphMode","isAnalyzing","audioData","getShapeMorpherData","hasNonZero","_loggedAudioData","wasBar","quantizedBeat","quantizedProgress","quantizationStrength","skipQueue","queued","hasQueuedMorph","normalizedPoints","getInterpolatedPoints","canvasPointsCache","canvasPoints","pointsArray","radialShapes","currentIsRadial","targetIsRadial","targetDx","targetDy","expandPhase","collapseProgress","spiral","fromShape","toShape","fadeInCrescent","slideOutCrescent","shadowSlideRatio","exitAngle","fadeEffects","bloomEffects","currentDef","targetDef","targetShadow","slideRatio","slideProgress","startOffset","currentOffset","shadowY","offsetProgress","lunarBlend","blendPhase","smoothBlend","smoothProgress","blendProgress","movementCurve","transformPhase","smoothTransform","crescentPhase","moveStart","exitPhase","smoothMove","fadeMultiplier","flaresOpacity","bloomProgress","getCurrentRenderer","resetMusicDetection","getCurrentMusicInfo","timeSigLocked","isInTransition","AudioAnalyzer","elementSource","connectedElement","frequencyBands","vocalRange","currentAmplitude","beatThreshold","bufferLength","connectAudioElement","audioElement","createMediaElementSource","analyze","timeData","getByteTimeDomainData","_debugLogged","freqMax","timeMax","timeMin","_debugCounter","vocalSum","vocalCount","binHz","vocalMinBin","vocalMaxBin","ceil","vocalAmplitude","extractFrequencyBands","detectBeat","bandsPerBin","startBin","endBin","newValue","getVocalInstability","variance","instability","GestureCompatibility","timingClasses","gestures","offbeat","continuous","fillPatterns","subtle","rhythmic","densityProfiles","sparse","fillProbability","subdivisionLevel","dense","chaos","maxSimultaneous","expression","dance","enhancingCombinations","incompatiblePairs","celebrate","greeting","mystical","party","chains","buildup","cascade","canExecuteSimultaneously","gesture1","gesture2","pair","group1","getGestureGroup","group2","groupName","getGesturePriority","getCompatibleGestures","used","normalizeGesture","canAdd","chordItem","chordGestureName","c","parseChain","chainString","trim","isEnhancingCombination","gestureNames","combo","every","getChord","chordName","createChord","compatible","isEnhancing","isValidGesture","getAllGestures","getGestureTiming","className","timingClass","getNextBeatForGesture","nextBeat","getFillGestures","getNextBeatTiming","getIntensityFromBPM","applySwingTiming","straightBeat","gestureCompatibility","GrooveTemplates","templates","straight","baseMovement","transitionStyle","emphasis","velocities","humanization","preferredGestures","fills","compositeMove","shuffle","syncopation","weak","techno","one","ghost","hihat","instant","nextBar","nextPhrase","currentGroove","transitionMode","pendingGroove","getTemplate","getEmphasis","patternIndex","findIndex","getVelocity","getPreferredGesture","availableGestures","beatType","preferred","available","humanizeTiming","applySwing","setGroove","getBaseMovement","getTransitionStyle","getCompositeMove","shouldTriggerComposite","getLayeredGestures","composite","getGrooveNames","getGrooveInfo","template","AudioHandler","vocalUpdateInterval","disconnectAudio","clearInterval","connectAudio","setInterval","vocalInstability","previousAudioLevel","audioLevelProcessor","onSpeechStop","returnToBaseTime","setVolume","clampedVolume","GestureController","StateCoordinator","emotionIntensity","mappedEmotion","initialCount","emotionParams","VisualizationRunner","animationId","lastTime","animationController","orbX","orbY","orbPos","degradationManager","startMonitoring","audioHandler","stopMonitoring","gazeTracker","suspicionEmotion","idleBehavior","gazeState","isFocused","setGazeData","ConfigurationManager","validateConfig","canvasId","startingEmotion","emotionalResponsiveness","particleIntensity","showFPS","debugMode","renderMode","updates","EmotiveMascot","eventManager","maxListeners","maxEventListeners","enableDebugging","enableEventDebugging","enableMonitoring","enableEventMonitoring","memoryWarningThreshold","eventMemoryWarningThreshold","_listeners","listener","off","browserOpts","enableAudio","soundEnabled","defaultEmotion","enableAutoOptimization","enableGracefulDegradation","enableGazeTracking","enableIdleBehaviors","classicConfig","contextRecovery","grooveTemplates","wake","accessibilityManager","mobileOptimization","pluginSystem","performanceDegradation","then","rhythmEnabled","tts","currentUtterance","gestureController","stateCoordinator","visualizationRunner","configurationManager","enableDebug","setupAudioLevelProcessorCallbacks","handleDegradationEvent","applyDegradationSettings","express","gestureTriggered","errorData","markGestureStart","markGestureEnd","expressChord","methodName","gestureEndTime","recordGestureTime","gestureConfig","currentModularGesture","defaultParams","GestureCompatibility$1","module","default","err","compatibleGestures","normalizedGesture","executeGestureDirectly","addSparkle","chain","firstStep","onSpeechStart","speak","speechSynthesis","cancel","utterance","SpeechSynthesisUtterance","pitch","voice","selectedVoice","getVoices","v","onstart","onend","onerror","onboundary","stopTTS","sleep","getTTSVoices","isTTSSpeaking","setBreathePattern","hold1","hold2","totalCycle","breathePattern","currentPhase","phaseStartTime","phaseProgress","startBreathingAnimation","setOrbScale","startScale","currentOrbScale","presets","meditative","deep","breathingAnimationId","phaseElapsed","nextPhase","stopBreathing","removeAllListeners","listenerCount","getEventNames","getEventStats","getEventDebugInfo","getDebugInfo","getBrowserCompatibility","getDegradationStatus","availableFeatures","getAvailableFeatures","recommendedSettings","getRecommendedSettings","performanceStats","getPerformanceStats","allLevels","getAllLevels","setDegradationLevel","setLevel","isFeatureAvailable","recoverCanvasContext","isCanvasContextLost","setDebugMode","report","currentState","performanceMetrics","audioStats","getAudioStats","eventStats","degradationStatus","debuggerReport","reportSize","sections","url","href","mascotState","metrics","debuggerData","dataSize","startProfiling","endProfiling","clearDebugData","getRuntimeCapabilities","renderStart","renderState","maxDist","stateProps","particleBehaviorOverride","particleModifier","cleanupPending","showDebug","renderDebugInfo","renderTime","lines","padding","maxWidth","line","measureText","borderColor","strokeRect","lineY","particleStats","debugInfo","debugWidth","getEmotionalColor","getAudioLevel","updateAudioConfig","getAvailableGestures","connectAudioSource","audioAnalyser","getVolume","setSoundEnabled","isSoundEnabled","clampedFPS","getTargetFPS","setPerformanceDegradation","currentMax","newMax","isSpeaking","setAudioSmoothing","clampedSmoothing","getSystemStatus","rendererStats","animationMetrics","gestureActive","soundSystemAvailable","gradientCacheSize","eventListeners","errorStats","triggerTestError","setAccessibility","getMobileStatus","getAccessibilityStatus","newState","lang","setTTSSpeaking","charIndex","charLength","ttsSpeaking","setUndertone","getAvailableShapes"],"mappings":"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"}