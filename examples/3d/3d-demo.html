<!DOCTYPE html>
<!--
  FULL 3D DEMO - Emotive Engine Comprehensive Showcase

  A complete demonstration of all 3D geometries with emotional expression.

  Features:
  - Crystal, Moon, and Sun geometries with smooth morphing
  - 14 emotions with unique particle behaviors and colors
  - Moon phases and lunar eclipse (blood moon) effects
  - Solar eclipse effects (annular and total)
  - Camera controls with touch/mouse interaction
  - Particle systems with bloom effects

  Learn more: https://github.com/anthropics/emotive-engine
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Showcase - Emotive Engine</title>
    <meta name="description" content="Interactive 3D demo showcasing emotional expression through geometry, particles, and visual effects">
    <link rel="stylesheet" href="../3d-example-style.css">
    <style>
        /* Theme: Crystal blue-green gradient */
        :root {
            --accent: #6ee7ff;
            --accent-rgb: 100, 200, 255;
        }

        body {
            background: linear-gradient(180deg,
                #0a1810 0%,
                #1a2820 25%,
                #2a3530 50%,
                #4a3a30 75%,
                #5a4a40 100%);
        }
    </style>
</head>
<body>
    <!-- LEFT MENU: Emotions -->
    <div class="left-menu">
        <div class="section">
            <h2>Emotions</h2>
            <div class="section-content">
                <div class="button-grid">
                    <button data-action="emotion" data-value="joy">ğŸ˜Š Joy</button>
                    <button data-action="emotion" data-value="love">â¤ï¸ Love</button>
                    <button data-action="emotion" data-value="excited">ğŸ‰ Excited</button>
                    <button data-action="emotion" data-value="euphoria">âœ¨ Euphoria</button>
                    <button data-action="emotion" data-value="calm">ğŸ˜Œ Calm</button>
                    <button data-action="emotion" data-value="focused">ğŸ¯ Focused</button>
                    <button data-action="emotion" data-value="resting">ğŸ˜´ Resting</button>
                    <button data-action="emotion" data-value="sadness">ğŸ˜¢ Sadness</button>
                    <button data-action="emotion" data-value="anger">ğŸ˜  Anger</button>
                    <button data-action="emotion" data-value="fear">ğŸ˜° Fear</button>
                    <button data-action="emotion" data-value="surprise">ğŸ˜² Surprise</button>
                    <button data-action="emotion" data-value="suspicion">ğŸ¤¨ Suspicion</button>
                    <button data-action="emotion" data-value="disgust">ğŸ¤¢ Disgust</button>
                    <button data-action="emotion" data-value="neutral">ğŸ˜ Neutral</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Undertones</h2>
            <div class="section-content collapsed">
                <div class="button-grid">
                    <button data-action="undertone" data-value="null">Clear</button>
                    <button data-action="undertone" data-value="subdued">Subdued</button>
                    <button data-action="undertone" data-value="tired">Tired</button>
                    <button data-action="undertone" data-value="nervous">Nervous</button>
                    <button data-action="undertone" data-value="confident">Confident</button>
                    <button data-action="undertone" data-value="intense">Intense</button>
                    <button data-action="undertone" data-value="energetic">Energetic</button>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="info-box">
                <strong>Emotive Engine 3D</strong><br>
                Explore emotional expression through geometry, particles, and visual effects. Each emotion has unique behaviors!
            </div>
        </div>
    </div>

    <!-- CENTER: 3D Animation -->
    <div class="center-content">
        <div id="mascot-container"></div>
    </div>

    <!-- RIGHT MENU: Controls & Geometries -->
    <div class="right-menu">
        <div class="section">
            <h2>Geometry</h2>
            <div class="section-content">
                <div class="button-grid">
                    <button data-action="geometry" data-value="crystal" class="active">ğŸ’ Crystal</button>
                    <button data-action="geometry" data-value="moon">ğŸŒ™ Moon</button>
                    <button data-action="geometry" data-value="sun">â˜€ï¸ Sun</button>
                </div>

                <!-- Solar Eclipse controls (sun only) -->
                <div id="eclipse-section" style="display: none; margin-top: 12px;">
                    <div style="font-size: 10px; color: rgba(255,255,255,0.6); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px;">Solar Eclipse</div>
                    <div class="button-grid">
                        <button data-action="eclipse" data-value="annular">ğŸŒ‘ Annular</button>
                        <button data-action="eclipse" data-value="total">ğŸŒš Total</button>
                    </div>
                </div>

                <!-- Moon Phase controls (moon only) -->
                <div id="moon-phase-section" style="display: none; margin-top: 12px;">
                    <div style="font-size: 10px; color: rgba(255,255,255,0.6); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px;">Moon Phase</div>
                    <div class="button-grid">
                        <button data-action="moon-phase" data-value="new">ğŸŒ‘ New</button>
                        <button data-action="moon-phase" data-value="waxing-crescent">ğŸŒ’ Wax Cres</button>
                        <button data-action="moon-phase" data-value="first-quarter">ğŸŒ“ 1st Qtr</button>
                        <button data-action="moon-phase" data-value="waxing-gibbous">ğŸŒ” Wax Gib</button>
                        <button data-action="moon-phase" data-value="full" class="active">ğŸŒ• Full</button>
                        <button data-action="moon-phase" data-value="waning-gibbous">ğŸŒ– Wan Gib</button>
                        <button data-action="moon-phase" data-value="last-quarter">ğŸŒ— Last Qtr</button>
                        <button data-action="moon-phase" data-value="waning-crescent">ğŸŒ˜ Wan Cres</button>
                    </div>
                </div>

                <!-- Lunar Eclipse controls (moon only, full moon required) -->
                <div id="lunar-eclipse-section" style="display: none; margin-top: 12px;">
                    <div style="font-size: 10px; color: rgba(255,255,255,0.6); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px;">Lunar Eclipse</div>
                    <div class="button-grid">
                        <button data-action="lunar-eclipse" data-value="penumbral">ğŸŒ” Penumbral</button>
                        <button data-action="lunar-eclipse" data-value="partial">ğŸŒ— Partial</button>
                        <button data-action="lunar-eclipse" data-value="total">ğŸ©¸ Blood Moon</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="section visual-controls" id="visual-controls-section">
            <h2 class="collapsed">Visual Controls</h2>
            <div class="section-content collapsed">
                <div class="button-grid">
                    <button data-action="toggle-particles">âœ¨ Particles</button>
                    <button data-action="toggle-glow" class="active">ğŸ’« Core Glow</button>
                    <button data-action="toggle-blink" class="active">ğŸ‘ï¸ Blinking</button>
                    <button data-action="toggle-breathing" class="active">ğŸ« Breathing</button>
                    <button data-action="toggle-auto-rotate">ğŸ”„ Auto-Rotate</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Motion Gestures</h2>
            <div class="section-content collapsed">
                <div class="button-grid">
                    <button data-action="gesture" data-value="bounce">Bounce</button>
                    <button data-action="gesture" data-value="pulse">Pulse</button>
                    <button data-action="gesture" data-value="float">Float</button>
                    <button data-action="gesture" data-value="shake">Shake</button>
                    <button data-action="gesture" data-value="sway">Sway</button>
                    <button data-action="gesture" data-value="wiggle">Wiggle</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Transform Gestures</h2>
            <div class="section-content collapsed">
                <div class="button-grid">
                    <button data-action="gesture" data-value="spin">Spin</button>
                    <button data-action="gesture" data-value="jump">Jump</button>
                    <button data-action="gesture" data-value="twist">Twist</button>
                    <button data-action="gesture" data-value="stretch">Stretch</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Effect Gestures</h2>
            <div class="section-content collapsed">
                <div class="button-grid">
                    <button data-action="gesture" data-value="flash">Flash</button>
                    <button data-action="gesture" data-value="glow">Glow</button>
                    <button data-action="gesture" data-value="breathe">Breathe</button>
                    <button data-action="gesture" data-value="flicker">Flicker</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Camera</h2>
            <div class="section-content collapsed">
                <div class="button-grid">
                    <button data-action="camera" data-value="front" class="active">ğŸ“· Front</button>
                    <button data-action="camera" data-value="side">ğŸ“· Side</button>
                    <button data-action="camera" data-value="top">ğŸ“· Top</button>
                    <button data-action="camera" data-value="bottom">ğŸ“· Bottom</button>
                    <button data-action="camera" data-value="angle">ğŸ“· Angle</button>
                    <button data-action="camera" data-value="back">ğŸ“· Back</button>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="info-box">
                <strong>Tip:</strong> Click and drag to rotate. Scroll to zoom. Each geometry has unique materials and effects.
            </div>
        </div>
    </div>

    <script type="module">
        import EmotiveMascot3D, { animateMoonPhase } from '../../dist/emotive-mascot-3d.js';

        let mascot = null;
        let currentGeometry = 'crystal';
        let currentMoonPhase = 'full';

        // Initialize
        (async () => {
            try {
                const container = document.getElementById('mascot-container');
                mascot = new EmotiveMascot3D({
                    coreGeometry: 'crystal',
                    enableParticles: true,
                    enablePostProcessing: true,
                    enableShadows: false,
                    enableControls: true,
                    autoRotate: true,
                    cameraDistance: 1.2,
                    fov: 30,
                    minZoom: 0.9,
                    maxZoom: 2.0,
                    materialVariant: 'multiplexer'
                });

                mascot.init(container);
                mascot.start();
                mascot.setEmotion('joy');

                // Crystal defaults
                mascot.enableParticles();
                mascot.disableBlinking();

                // Update button states
                document.querySelector('[data-action="toggle-particles"]')?.classList.add('active');
                document.querySelector('[data-action="toggle-auto-rotate"]')?.classList.add('active');
                document.querySelector('[data-action="toggle-blink"]')?.classList.remove('active');
            } catch (error) {
                console.error('Failed to initialize EmotiveMascot3D:', error);
            }
        })();

        // Collapsible sections
        document.querySelectorAll('.section h2').forEach(h2 => {
            h2.addEventListener('click', () => {
                const content = h2.nextElementSibling;
                if (content?.classList.contains('section-content')) {
                    h2.classList.toggle('collapsed');
                    content.classList.toggle('collapsed');
                }
            });
        });

        // Event delegation
        document.addEventListener('click', (e) => {
            if (!e.target.matches('button[data-action]') || !mascot) return;

            const action = e.target.dataset.action;
            const value = e.target.dataset.value;

            switch (action) {
                case 'emotion':
                    mascot.setEmotion(value);
                    document.querySelectorAll('[data-action="emotion"]').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    break;

                case 'undertone':
                    mascot.setUndertone(value === 'null' ? null : value);
                    document.querySelectorAll('[data-action="undertone"]').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    break;

                case 'geometry':
                    mascot.morphTo(value);
                    currentGeometry = value;

                    document.querySelectorAll('[data-action="geometry"]').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');

                    // Show/hide geometry-specific controls
                    document.getElementById('eclipse-section').style.display = (value === 'sun') ? 'block' : 'none';
                    document.getElementById('moon-phase-section').style.display = (value === 'moon') ? 'block' : 'none';
                    document.getElementById('lunar-eclipse-section').style.display = (value === 'moon') ? 'block' : 'none';

                    // Apply geometry-specific defaults
                    const particlesBtn = document.querySelector('[data-action="toggle-particles"]');
                    const autoRotateBtn = document.querySelector('[data-action="toggle-auto-rotate"]');
                    const blinkBtn = document.querySelector('[data-action="toggle-blink"]');

                    if (value === 'crystal') {
                        mascot.enableParticles();
                        mascot.enableAutoRotate();
                        mascot.disableBlinking();
                        particlesBtn?.classList.add('active');
                        autoRotateBtn?.classList.add('active');
                        blinkBtn?.classList.remove('active');
                    } else if (value === 'moon') {
                        mascot.disableParticles();
                        mascot.disableAutoRotate();
                        mascot.disableBlinking();
                        particlesBtn?.classList.remove('active');
                        autoRotateBtn?.classList.remove('active');
                        blinkBtn?.classList.remove('active');

                        // Initialize moon to full phase after morph completes
                        setTimeout(() => {
                            if (mascot.core3D?.customMaterial?.uniforms?.shadowOffset) {
                                mascot.core3D.customMaterial.uniforms.shadowOffset.value.x = 0;
                                mascot.core3D.customMaterial.uniforms.shadowOffset.value.y = 0;
                            }
                            if (mascot.core3D?.renderer?.controls) {
                                mascot.core3D.renderer.controls.autoRotate = false;
                            }
                        }, 600);
                    } else if (value === 'sun') {
                        mascot.disableParticles();
                        mascot.enableAutoRotate();
                        mascot.disableBlinking();
                        particlesBtn?.classList.remove('active');
                        autoRotateBtn?.classList.add('active');
                        blinkBtn?.classList.remove('active');
                    }
                    break;

                case 'gesture':
                    mascot.express(value);
                    break;

                case 'toggle-particles':
                    if (mascot.core3D?.particleVisibility) {
                        mascot.disableParticles();
                        e.target.classList.remove('active');
                    } else {
                        mascot.enableParticles();
                        e.target.classList.add('active');
                    }
                    break;

                case 'toggle-glow':
                    if (mascot.core3D?.coreGlowEnabled !== false) {
                        mascot.core3D.setCoreGlowEnabled(false);
                        e.target.classList.remove('active');
                    } else {
                        mascot.core3D.setCoreGlowEnabled(true);
                        e.target.classList.add('active');
                    }
                    break;

                case 'toggle-blink':
                    if (mascot.blinkingEnabled) {
                        mascot.disableBlinking();
                        e.target.classList.remove('active');
                    } else {
                        mascot.enableBlinking();
                        e.target.classList.add('active');
                    }
                    break;

                case 'toggle-breathing':
                    if (mascot.breathingEnabled) {
                        mascot.disableBreathing();
                        e.target.classList.remove('active');
                    } else {
                        mascot.enableBreathing();
                        e.target.classList.add('active');
                    }
                    break;

                case 'toggle-auto-rotate':
                    if (mascot.autoRotateEnabled) {
                        mascot.disableAutoRotate();
                        e.target.classList.remove('active');
                    } else {
                        mascot.enableAutoRotate();
                        e.target.classList.add('active');
                    }
                    break;

                case 'eclipse':
                    if (currentGeometry !== 'sun') break;

                    const eclipseButtons = document.querySelectorAll('[data-action="eclipse"]');
                    if (e.target.classList.contains('active')) {
                        mascot.core3D.setSunShadow('off');
                        e.target.classList.remove('active');
                    } else {
                        eclipseButtons.forEach(btn => btn.classList.remove('active'));
                        mascot.core3D.setSunShadow(value);
                        e.target.classList.add('active');
                    }
                    break;

                case 'moon-phase':
                    if (currentGeometry !== 'moon') break;

                    if (mascot.core3D?.customMaterial) {
                        animateMoonPhase(mascot.core3D.customMaterial, value, 1500);
                        currentMoonPhase = value;

                        document.querySelectorAll('[data-action="moon-phase"]').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');

                        // Lunar eclipse only available on full moon
                        const lunarEclipseSection = document.getElementById('lunar-eclipse-section');
                        if (value === 'full') {
                            lunarEclipseSection.style.opacity = '1';
                            lunarEclipseSection.style.pointerEvents = 'auto';
                        } else {
                            mascot.core3D.setMoonEclipse('off');
                            document.querySelectorAll('[data-action="lunar-eclipse"]').forEach(btn => btn.classList.remove('active'));
                            lunarEclipseSection.style.opacity = '0.4';
                            lunarEclipseSection.style.pointerEvents = 'none';
                        }
                    }
                    break;

                case 'camera':
                    mascot.setCameraPreset(value, 1000);
                    document.querySelectorAll('[data-action="camera"]').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    break;

                case 'lunar-eclipse':
                    if (currentGeometry !== 'moon' || currentMoonPhase !== 'full') break;

                    const lunarEclipseButtons = document.querySelectorAll('[data-action="lunar-eclipse"]');
                    if (e.target.classList.contains('active')) {
                        mascot.core3D.setMoonEclipse('off');
                        e.target.classList.remove('active');
                        document.getElementById('moon-phase-section').style.display = 'block';
                    } else {
                        lunarEclipseButtons.forEach(btn => btn.classList.remove('active'));
                        mascot.core3D.setMoonEclipse(value);
                        e.target.classList.add('active');
                        document.getElementById('moon-phase-section').style.display = 'none';
                    }
                    break;
            }
        });

        // Set initial active button
        document.querySelector('[data-value="joy"]').classList.add('active');
    </script>
</body>
</html>
