<!DOCTYPE html>
<!--
  CRYSTAL SOUL - Emotive Engine 3D Demo

  A frosted crystal with an inner glowing "soul" that changes color
  based on emotional state.

  What you'll learn:
  - 3D rendering with OBJ model loading
  - Frosted glass shader with fresnel effects
  - Inner soul glow with emotion-driven color
  - Configurable animation speeds per emotion

  Complexity: ‚≠ê‚≠ê‚≠ê Advanced 3D
  Features: OBJ loading, custom shaders, emotion-driven effects
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Soul - Emotive Engine 3D</title>
    <meta name="description" content="Frosted crystal with inner soul glow driven by emotional states">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            /* Background gradient matching reference image: dark green-black top, warm brown bottom */
            background: linear-gradient(180deg,
                #0a1810 0%,
                #1a2820 25%,
                #2a3530 50%,
                #4a3a30 75%,
                #5a4a40 100%);
            color: white;
            width: 100vw;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .left-menu,
        .right-menu {
            width: 18vw;
            min-width: 200px;
            max-width: 280px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            padding: 1.5vw;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .left-menu {
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .right-menu {
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        .center-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
            padding: 2vmin;
        }

        .section {
            margin-bottom: clamp(15px, 2vw, 25px);
            padding-bottom: clamp(12px, 1.5vw, 20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section:last-child {
            border-bottom: none;
        }

        h2 {
            font-size: clamp(11px, 1vw, 13px);
            margin-bottom: clamp(8px, 1vw, 12px);
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 600;
        }

        .current-emotion {
            text-align: center;
            font-size: clamp(32px, 3vw, 42px);
            margin: clamp(10px, 1.2vw, 15px) 0;
            filter: drop-shadow(0 0 20px rgba(100, 200, 255, 0.5));
        }

        .current-name {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: clamp(11px, 1vw, 13px);
            margin-bottom: clamp(10px, 1.2vw, 15px);
        }

        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: clamp(6px, 0.6vw, 8px);
        }

        .emotion-grid button {
            padding: clamp(8px, 0.8vw, 12px);
            font-size: clamp(9px, 0.8vw, 11px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: clamp(6px, 0.6vw, 8px);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .emotion-grid button:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(100, 200, 255, 0.5);
        }

        .emotion-grid button.active {
            background: rgba(100, 200, 255, 0.3);
            border-color: rgba(100, 200, 255, 0.8);
        }

        .slider-control {
            margin-bottom: clamp(12px, 1.2vw, 16px);
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: clamp(10px, 0.9vw, 12px);
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: clamp(4px, 0.4vw, 6px);
        }

        .slider-value {
            color: #6ee7ff;
            font-family: monospace;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: clamp(12px, 1.2vw, 16px);
            height: clamp(12px, 1.2vw, 16px);
            background: #6ee7ff;
            border-radius: 50%;
            cursor: pointer;
        }

        .toggle-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: clamp(8px, 0.8vw, 12px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: clamp(6px, 0.6vw, 8px);
            margin-bottom: clamp(8px, 0.8vw, 12px);
        }

        .toggle-label {
            font-size: clamp(10px, 0.9vw, 12px);
            color: rgba(255, 255, 255, 0.8);
        }

        .toggle-switch {
            position: relative;
            width: 40px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: rgba(100, 200, 255, 0.6);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        .info-box {
            background: rgba(100, 200, 255, 0.1);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: clamp(8px, 0.8vw, 10px);
            padding: clamp(10px, 1vw, 12px);
            font-size: clamp(10px, 0.85vw, 11px);
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
        }

        .info-box strong {
            color: #6ee7ff;
        }

        #crystal-container {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            aspect-ratio: 1;
            border-radius: clamp(12px, 1.5vw, 20px);
            /* Subtle glow around container */
            box-shadow: 0 0 60px rgba(100, 200, 255, 0.15);
        }

        #crystal-container canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* Mobile/Tablet Responsive */
        @media (max-width: 1000px) {
            body {
                flex-direction: column;
            }

            .left-menu,
            .right-menu {
                width: 100%;
                min-width: unset;
                max-width: unset;
                max-height: 35vh;
                border: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                padding: 15px;
            }

            .left-menu {
                order: 1;
            }

            .center-content {
                order: 2;
                flex: 1;
                min-height: 30vh;
            }

            .right-menu {
                order: 3;
                border-bottom: none;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .emotion-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 600px) {
            .emotion-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Scrollbar styling */
        .left-menu::-webkit-scrollbar,
        .right-menu::-webkit-scrollbar {
            width: 6px;
        }

        .left-menu::-webkit-scrollbar-track,
        .right-menu::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .left-menu::-webkit-scrollbar-thumb,
        .right-menu::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="left-menu">
        <div class="section">
            <h2>Current Emotion</h2>
            <div class="current-emotion" id="current-emoji">üíé</div>
            <div class="current-name" id="current-name">Neutral</div>
        </div>

        <div class="section">
            <h2>Emotions</h2>
            <div class="emotion-grid">
                <button data-emotion="neutral" class="active">üòê Neutral</button>
                <button data-emotion="joy">üòä Joy</button>
                <button data-emotion="sadness">üò¢ Sadness</button>
                <button data-emotion="anger">üò† Anger</button>
                <button data-emotion="fear">üò® Fear</button>
                <button data-emotion="surprise">üò≤ Surprise</button>
                <button data-emotion="disgust">ü§¢ Disgust</button>
                <button data-emotion="love">‚ù§Ô∏è Love</button>
                <button data-emotion="calm">üòå Calm</button>
                <button data-emotion="excited">ü§© Excited</button>
                <button data-emotion="focused">üéØ Focused</button>
                <button data-emotion="suspicion">ü§® Suspicion</button>
                <button data-emotion="resting">üò¥ Resting</button>
                <button data-emotion="euphoria">ü§Ø Euphoria</button>
            </div>
        </div>

        <div class="section">
            <h2>Display Options</h2>
            <div class="toggle-control">
                <span class="toggle-label">Particles</span>
                <div class="toggle-switch" id="particles-toggle"></div>
            </div>
            <div class="toggle-control">
                <span class="toggle-label">Auto Rotate</span>
                <div class="toggle-switch active" id="rotate-toggle"></div>
            </div>
            <div class="toggle-control">
                <span class="toggle-label">Breathing</span>
                <div class="toggle-switch active" id="breathing-toggle"></div>
            </div>
        </div>
    </div>

    <div class="center-content">
        <div id="crystal-container">
            <canvas id="crystal"></canvas>
        </div>
    </div>

    <div class="right-menu">
        <div class="section">
            <h2>Crystal Size</h2>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Crystal Shell Size</span>
                    <span class="slider-value" id="shell-size-value">2.00</span>
                </div>
                <input type="range" id="shell-size-slider" min="0.5" max="3.0" step="0.05" value="2.0">
            </div>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Soul Size</span>
                    <span class="slider-value" id="soul-size-value">1.00</span>
                </div>
                <input type="range" id="soul-size-slider" min="0" max="1" step="0.05" value="1.0">
            </div>
        </div>

        <div class="section">
            <h2>Crystal Appearance</h2>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Frostiness</span>
                    <span class="slider-value" id="frostiness-value">0.10</span>
                </div>
                <input type="range" id="frostiness-slider" min="0" max="1" step="0.05" value="0.10">
            </div>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Inner Glow Strength</span>
                    <span class="slider-value" id="inner-glow-value">0.20</span>
                </div>
                <input type="range" id="inner-glow-slider" min="0" max="2" step="0.1" value="0.2">
            </div>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Fresnel Intensity</span>
                    <span class="slider-value" id="fresnel-value">0.30</span>
                </div>
                <input type="range" id="fresnel-slider" min="0" max="2" step="0.1" value="0.3">
            </div>
        </div>

        <div class="section">
            <h2>Noise Patterns</h2>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Surface Noise Scale</span>
                    <span class="slider-value" id="surface-noise-value">1.50</span>
                </div>
                <input type="range" id="surface-noise-slider" min="0.1" max="10" step="0.1" value="1.5">
            </div>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Inner Wisp Scale</span>
                    <span class="slider-value" id="inner-wisp-value">0.60</span>
                </div>
                <input type="range" id="inner-wisp-slider" min="0.1" max="5" step="0.1" value="0.6">
            </div>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Surface Roughness</span>
                    <span class="slider-value" id="surface-roughness-value">0.15</span>
                </div>
                <input type="range" id="surface-roughness-slider" min="0" max="1" step="0.05" value="0.15">
            </div>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Noise Frequency</span>
                    <span class="slider-value" id="noise-freq-value">1.33</span>
                </div>
                <input type="range" id="noise-freq-slider" min="0.01" max="5" step="0.01" value="1.33">
            </div>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Texture Strength</span>
                    <span class="slider-value" id="texture-strength-value">0.55</span>
                </div>
                <input type="range" id="texture-strength-slider" min="0" max="1" step="0.05" value="0.55">
            </div>
        </div>

        <div class="section">
            <h2>Soul Animation</h2>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Drift Speed</span>
                    <span class="slider-value" id="drift-speed-value">0.50</span>
                </div>
                <input type="range" id="drift-speed-slider" min="0.1" max="3" step="0.1" value="0.5">
            </div>

            <div class="slider-control">
                <div class="slider-label">
                    <span>Shimmer Speed</span>
                    <span class="slider-value" id="shimmer-speed-value">0.50</span>
                </div>
                <input type="range" id="shimmer-speed-slider" min="0.1" max="3" step="0.1" value="0.5">
            </div>

            <div class="toggle-control">
                <span class="toggle-label">Drift Enabled</span>
                <div class="toggle-switch active" id="drift-toggle"></div>
            </div>

            <div class="toggle-control">
                <span class="toggle-label">Shimmer Enabled</span>
                <div class="toggle-switch active" id="shimmer-toggle"></div>
            </div>
        </div>

        <div class="section">
            <div class="info-box">
                <strong>Crystal Soul:</strong><br>
                The inner glow represents the "soul" of the crystal, changing color based on emotional state. The frosted exterior diffuses the light while the fresnel effect creates bright edges.
            </div>
        </div>
    </div>

    <script type="module">
        import EmotiveMascot3D from '../../dist/emotive-mascot-3d.js';

        const container = document.getElementById('crystal-container');
        const mascot = new EmotiveMascot3D({
            canvasId: 'crystal',
            coreGeometry: 'crystal',
            enableParticles: false,
            enableControls: true,
            autoRotate: true,
            autoRotateSpeed: 0.3,
            enableBlinking: false,
            enableBreathing: true,
            cameraDistance: 2.5
        });

        mascot.init(container);
        mascot.start();

        // Set initial emotion
        mascot.setEmotion('neutral');

        console.log('üíé Crystal demo initialized');

        // Emotion emoji mapping
        const emotionEmojis = {
            'neutral': 'üòê',
            'joy': 'üòä',
            'sadness': 'üò¢',
            'anger': 'üò†',
            'fear': 'üò®',
            'surprise': 'üò≤',
            'disgust': 'ü§¢',
            'love': '‚ù§Ô∏è',
            'calm': 'üòå',
            'excited': 'ü§©',
            'focused': 'üéØ',
            'suspicion': 'ü§®',
            'resting': 'üò¥',
            'euphoria': 'ü§Ø'
        };

        const emotionNames = {
            'neutral': 'Neutral',
            'joy': 'Joy',
            'sadness': 'Sadness',
            'anger': 'Anger',
            'fear': 'Fear',
            'surprise': 'Surprise',
            'disgust': 'Disgust',
            'love': 'Love',
            'calm': 'Calm',
            'excited': 'Excited',
            'focused': 'Focused',
            'suspicion': 'Suspicion',
            'resting': 'Resting',
            'euphoria': 'Euphoria'
        };

        // Update current emotion display
        function updateEmotionDisplay(emotion) {
            document.getElementById('current-emoji').textContent = emotionEmojis[emotion] || 'üíé';
            document.getElementById('current-name').textContent = emotionNames[emotion] || emotion;
        }

        // Emotion buttons
        document.querySelectorAll('[data-emotion]').forEach(btn => {
            btn.addEventListener('click', () => {
                const emotion = btn.dataset.emotion;
                mascot.setEmotion(emotion);
                updateEmotionDisplay(emotion);

                // Update active state
                document.querySelectorAll('[data-emotion]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Toggle controls
        function setupToggle(id, onToggle, initialState = false) {
            const toggle = document.getElementById(id);
            if (initialState) toggle.classList.add('active');

            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
                onToggle(toggle.classList.contains('active'));
            });
        }

        setupToggle('particles-toggle', (enabled) => {
            if (enabled) mascot.enableParticles();
            else mascot.disableParticles();
        }, false);

        setupToggle('rotate-toggle', (enabled) => {
            if (mascot.core3D?.renderer?.controls) {
                mascot.core3D.renderer.controls.autoRotate = enabled;
            }
        }, true);

        setupToggle('breathing-toggle', (enabled) => {
            if (mascot.core3D) {
                mascot.core3D.breathingEnabled = enabled;
            }
        }, true);

        setupToggle('drift-toggle', (enabled) => {
            if (mascot.core3D?.setCrystalSoulEffects) {
                mascot.core3D.setCrystalSoulEffects({ driftEnabled: enabled });
            }
        }, true);

        setupToggle('shimmer-toggle', (enabled) => {
            if (mascot.core3D?.setCrystalSoulEffects) {
                mascot.core3D.setCrystalSoulEffects({ shimmerEnabled: enabled });
            }
        }, true);

        // Slider controls for crystal appearance
        function setupSlider(sliderId, valueId, onUpdate) {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(valueId);

            slider.addEventListener('input', () => {
                const value = parseFloat(slider.value);
                valueDisplay.textContent = value.toFixed(2);
                onUpdate(value);
            });
        }

        // Size sliders
        setupSlider('shell-size-slider', 'shell-size-value', (value) => {
            if (mascot.core3D?.setCrystalShellSize) {
                mascot.core3D.setCrystalShellSize(value);
            }
        });

        setupSlider('soul-size-slider', 'soul-size-value', (value) => {
            if (mascot.core3D?.setCrystalCoreSize) {
                mascot.core3D.setCrystalCoreSize(value);
            }
        });

        // Appearance sliders
        setupSlider('frostiness-slider', 'frostiness-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.frostiness) {
                mascot.core3D.customMaterial.uniforms.frostiness.value = value;
            }
        });

        setupSlider('inner-glow-slider', 'inner-glow-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.innerGlowStrength) {
                mascot.core3D.customMaterial.uniforms.innerGlowStrength.value = value;
            }
        });

        setupSlider('fresnel-slider', 'fresnel-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.fresnelIntensity) {
                mascot.core3D.customMaterial.uniforms.fresnelIntensity.value = value;
            }
        });

        // Noise pattern sliders
        setupSlider('surface-noise-slider', 'surface-noise-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.surfaceNoiseScale) {
                mascot.core3D.customMaterial.uniforms.surfaceNoiseScale.value = value;
            }
        });

        setupSlider('inner-wisp-slider', 'inner-wisp-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.innerWispScale) {
                mascot.core3D.customMaterial.uniforms.innerWispScale.value = value;
            }
        });

        setupSlider('surface-roughness-slider', 'surface-roughness-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.surfaceRoughness) {
                mascot.core3D.customMaterial.uniforms.surfaceRoughness.value = value;
            }
        });

        setupSlider('noise-freq-slider', 'noise-freq-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.noiseFrequency) {
                mascot.core3D.customMaterial.uniforms.noiseFrequency.value = value;
            }
        });

        setupSlider('texture-strength-slider', 'texture-strength-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.textureStrength) {
                mascot.core3D.customMaterial.uniforms.textureStrength.value = value;
            }
        });

        setupSlider('drift-speed-slider', 'drift-speed-value', (value) => {
            if (mascot.core3D?.setCrystalSoulEffects) {
                mascot.core3D.setCrystalSoulEffects({ driftSpeed: value });
            }
        });

        setupSlider('shimmer-speed-slider', 'shimmer-speed-value', (value) => {
            if (mascot.core3D?.setCrystalSoulEffects) {
                mascot.core3D.setCrystalSoulEffects({ shimmerSpeed: value });
            }
        });

        // Initial emotion display
        updateEmotionDisplay('neutral');

        // Apply initial slider values after mascot loads
        setTimeout(() => {
            // Crystal appearance
            if (mascot.core3D?.customMaterial?.uniforms) {
                mascot.core3D.customMaterial.uniforms.frostiness.value = 0.10;
                mascot.core3D.customMaterial.uniforms.innerGlowStrength.value = 0.20;
                mascot.core3D.customMaterial.uniforms.fresnelIntensity.value = 0.30;
                mascot.core3D.customMaterial.uniforms.surfaceNoiseScale.value = 1.50;
                mascot.core3D.customMaterial.uniforms.innerWispScale.value = 0.60;
                mascot.core3D.customMaterial.uniforms.surfaceRoughness.value = 0.15;
                mascot.core3D.customMaterial.uniforms.noiseFrequency.value = 1.33;
                mascot.core3D.customMaterial.uniforms.textureStrength.value = 0.55;
            }
            console.log('üíé Applied default crystal settings');
        }, 500);
    </script>
</body>
</html>
