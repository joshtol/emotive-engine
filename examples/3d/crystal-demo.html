<!DOCTYPE html>
<!--
  CRYSTAL SOUL - Emotive Engine 3D Demo

  A frosted crystal with an inner glowing "soul" that changes color
  based on emotional state.

  What you'll learn:
  - 3D rendering with OBJ model loading
  - Frosted glass shader with fresnel effects
  - Inner soul glow with emotion-driven color
  - Configurable animation speeds per emotion

  Complexity: ‚≠ê‚≠ê‚≠ê Advanced 3D
  Features: OBJ loading, custom shaders, emotion-driven effects
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Soul - Emotive Engine 3D</title>
    <meta name="description" content="Frosted crystal with inner soul glow driven by emotional states">

    <!-- Shared 3D example styles -->
    <link rel="stylesheet" href="../3d-example-style.css">

    <style>
        /* Theme: Cyan crystal */
        :root {
            --accent: #6ee7ff;
            --accent-rgb: 110, 231, 255;
        }

        body {
            /* Background gradient matching reference image: dark green-black top, warm brown bottom */
            background: linear-gradient(180deg,
                #0a1810 0%,
                #1a2820 25%,
                #2a3530 50%,
                #4a3a30 75%,
                #5a4a40 100%);
        }

        /* Crystal-specific: current emotion display */
        .current-emotion {
            text-align: center;
            font-size: clamp(32px, 3vw, 42px);
            margin: clamp(10px, 1.2vw, 15px) 0;
            filter: drop-shadow(0 0 20px rgba(100, 200, 255, 0.5));
        }

        .current-name {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: clamp(11px, 1vw, 13px);
            margin-bottom: clamp(10px, 1.2vw, 15px);
        }

        /* Crystal container */
        #crystal-container {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            aspect-ratio: 1;
            border-radius: clamp(12px, 1.5vw, 20px);
            /* Subtle glow around container */
            box-shadow: 0 0 60px rgba(100, 200, 255, 0.15);
        }

        #crystal-container canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* Mobile responsive */
        @media (max-width: 1000px) {
            /* Hide current emotion section on mobile */
            .current-emotion-section {
                display: none;
            }

            .emotion-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 600px) {
            .emotion-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .emotion-grid button {
                padding: clamp(6px, 0.6vw, 10px);
                font-size: clamp(8px, 0.7vw, 10px);
            }
        }
    </style>
</head>
<body>
    <div class="left-menu">
        <div class="section">
            <h2>Geometry</h2>
            <div class="section-content">
                <div class="button-grid">
                    <button data-geometry="crystal" class="active">üíé Crystal</button>
                    <button data-geometry="heart">üíó Heart</button>
                    <button data-geometry="rough">üíé Rough</button>
                </div>
            </div>
        </div>

        <div class="section current-emotion-section">
            <h2>Current Emotion</h2>
            <div class="section-content">
                <div class="current-emotion" id="current-emoji">üíé</div>
                <div class="current-name" id="current-name">Neutral</div>
            </div>
        </div>

        <div class="section">
            <h2>Emotions</h2>
            <div class="section-content">
                <div class="emotion-grid">
                    <button data-emotion="neutral" class="active">üòê Neutral</button>
                    <button data-emotion="joy">üòä Joy</button>
                    <button data-emotion="sadness">üò¢ Sadness</button>
                    <button data-emotion="anger">üò† Anger</button>
                    <button data-emotion="fear">üò® Fear</button>
                    <button data-emotion="surprise">üò≤ Surprise</button>
                    <button data-emotion="disgust">ü§¢ Disgust</button>
                    <button data-emotion="love">‚ù§Ô∏è Love</button>
                    <button data-emotion="calm">üòå Calm</button>
                    <button data-emotion="excited">ü§© Excited</button>
                    <button data-emotion="focused">üéØ Focused</button>
                    <button data-emotion="suspicion">ü§® Suspicion</button>
                    <button data-emotion="resting">üò¥ Resting</button>
                    <button data-emotion="euphoria">ü§Ø Euphoria</button>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="info-box">
                <strong>Crystal Soul</strong><br>
                A frosted crystal with an inner glowing "soul" that changes color based on emotional state.
            </div>
        </div>
    </div>

    <div class="center-content">
        <div id="crystal-container">
            <canvas id="crystal"></canvas>
        </div>
        <div class="camera-hint">Drag to rotate ‚Ä¢ Pinch or scroll to zoom</div>
    </div>

    <div class="right-menu">
        <div class="section visual-controls">
            <h2 class="collapsed">Visual Controls</h2>
            <div class="section-content collapsed">
                <div class="button-grid">
                    <button data-action="toggle-particles">‚ú® Particles</button>
                    <button data-action="toggle-glow" class="active">üí´ Core Glow</button>
                    <button data-action="toggle-breathing" class="active">ü´Å Breathing</button>
                    <button data-action="toggle-auto-rotate" class="active">üîÑ Auto-Rotate</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Crystal Size</h2>
            <div class="section-content collapsed">
                <div class="slider-control">
                    <div class="slider-label">
                        <span>Crystal Shell Size</span>
                        <span class="slider-value" id="shell-size-value">2.00</span>
                    </div>
                    <input type="range" id="shell-size-slider" min="0.5" max="3.0" step="0.05" value="2.0">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Soul Size</span>
                        <span class="slider-value" id="soul-size-value">0.25</span>
                    </div>
                    <input type="range" id="soul-size-slider" min="0" max="1" step="0.05" value="0.25">
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Crystal Appearance</h2>
            <div class="section-content collapsed">
                <div class="slider-control">
                    <div class="slider-label">
                        <span>Frostiness</span>
                        <span class="slider-value" id="frostiness-value">0.10</span>
                    </div>
                    <input type="range" id="frostiness-slider" min="0" max="1" step="0.05" value="0.10">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Inner Glow Strength</span>
                        <span class="slider-value" id="inner-glow-value">0.20</span>
                    </div>
                    <input type="range" id="inner-glow-slider" min="0" max="2" step="0.1" value="0.2">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Fresnel Intensity</span>
                        <span class="slider-value" id="fresnel-value">0.30</span>
                    </div>
                    <input type="range" id="fresnel-slider" min="0" max="2" step="0.1" value="0.3">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>SSS Strength</span>
                        <span class="slider-value" id="sss-value">0.00</span>
                    </div>
                    <input type="range" id="sss-slider" min="0" max="2" step="0.05" value="0">
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">SSS Material Preset</h2>
            <div class="section-content collapsed">
                <div class="button-grid">
                    <button data-sss-preset="jade" class="active">üü¢ Jade</button>
                    <button data-sss-preset="imperialJade">üíö Imperial</button>
                    <button data-sss-preset="whiteJade">‚ö™ White Jade</button>
                    <button data-sss-preset="wax">üïØÔ∏è Wax</button>
                    <button data-sss-preset="skin">üëã Skin</button>
                    <button data-sss-preset="marble">üèõÔ∏è Marble</button>
                    <button data-sss-preset="milk">ü•õ Milk</button>
                    <button data-sss-preset="honey">üçØ Honey</button>
                    <button data-sss-preset="crystal">üíé Crystal</button>
                    <button data-sss-preset="roseQuartz">üå∏ Rose Quartz</button>
                </div>

                <div class="slider-control" style="margin-top: 15px;">
                    <div class="slider-label">
                        <span>Thickness Bias</span>
                        <span class="slider-value" id="sss-thickness-bias-value">0.30</span>
                    </div>
                    <input type="range" id="sss-thickness-bias-slider" min="0" max="1" step="0.05" value="0.3">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Thickness Scale</span>
                        <span class="slider-value" id="sss-thickness-scale-value">0.70</span>
                    </div>
                    <input type="range" id="sss-thickness-scale-slider" min="0" max="2" step="0.05" value="0.7">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Curvature Scale</span>
                        <span class="slider-value" id="sss-curvature-value">1.50</span>
                    </div>
                    <input type="range" id="sss-curvature-slider" min="0" max="3" step="0.1" value="1.5">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>SSS Ambient</span>
                        <span class="slider-value" id="sss-ambient-value">0.15</span>
                    </div>
                    <input type="range" id="sss-ambient-slider" min="0" max="1" step="0.05" value="0.15">
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Noise Patterns</h2>
            <div class="section-content collapsed">
                <div class="slider-control">
                    <div class="slider-label">
                        <span>Surface Noise Scale</span>
                        <span class="slider-value" id="surface-noise-value">1.50</span>
                    </div>
                    <input type="range" id="surface-noise-slider" min="0.1" max="10" step="0.1" value="1.5">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Inner Wisp Scale</span>
                        <span class="slider-value" id="inner-wisp-value">0.60</span>
                    </div>
                    <input type="range" id="inner-wisp-slider" min="0.1" max="5" step="0.1" value="0.6">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Surface Roughness</span>
                        <span class="slider-value" id="surface-roughness-value">0.15</span>
                    </div>
                    <input type="range" id="surface-roughness-slider" min="0" max="1" step="0.05" value="0.15">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Noise Frequency</span>
                        <span class="slider-value" id="noise-freq-value">1.33</span>
                    </div>
                    <input type="range" id="noise-freq-slider" min="0.01" max="5" step="0.01" value="1.33">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Texture Strength</span>
                        <span class="slider-value" id="texture-strength-value">0.55</span>
                    </div>
                    <input type="range" id="texture-strength-slider" min="0" max="1" step="0.05" value="0.55">
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="collapsed">Soul Animation</h2>
            <div class="section-content collapsed">
                <div class="slider-control">
                    <div class="slider-label">
                        <span>Drift Speed</span>
                        <span class="slider-value" id="drift-speed-value">0.50</span>
                    </div>
                    <input type="range" id="drift-speed-slider" min="0.1" max="3" step="0.1" value="0.5">
                </div>

                <div class="slider-control">
                    <div class="slider-label">
                        <span>Shimmer Speed</span>
                        <span class="slider-value" id="shimmer-speed-value">0.50</span>
                    </div>
                    <input type="range" id="shimmer-speed-slider" min="0.1" max="3" step="0.1" value="0.5">
                </div>

                <div class="toggle-control">
                    <span class="toggle-label">Drift Enabled</span>
                    <div class="toggle-switch active" id="drift-toggle"></div>
                </div>

                <div class="toggle-control">
                    <span class="toggle-label">Shimmer Enabled</span>
                    <div class="toggle-switch active" id="shimmer-toggle"></div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Collapsible sections
        document.querySelectorAll('h2').forEach(h2 => {
            h2.addEventListener('click', () => {
                const content = h2.nextElementSibling;
                if (content && content.classList.contains('section-content')) {
                    h2.classList.toggle('collapsed');
                    content.classList.toggle('collapsed');
                }
            });
        });

    </script>

    <script type="module">
        import EmotiveMascot3D from '../../dist/emotive-mascot-3d.js';

        const container = document.getElementById('crystal-container');
        const mascot = new EmotiveMascot3D({
            canvasId: 'crystal',
            coreGeometry: 'crystal',
            enableParticles: false,
            enableControls: true,
            autoRotate: true,
            autoRotateSpeed: 0.3,
            enableBlinking: false,
            enableBreathing: true,
            cameraDistance: 1.2,
            fov: 30,
            minZoom: 0.9,
            maxZoom: 2.0
        });

        mascot.init(container);
        mascot.start();

        // Set initial emotion
        mascot.setEmotion('neutral');

        console.log('üíé Crystal demo initialized');

        // Initialize sliders with actual values from engine
        setTimeout(() => {
            if (mascot.core3D?.customMaterial?.uniforms) {
                const u = mascot.core3D.customMaterial.uniforms;

                // Helper to update slider and display
                const setSlider = (id, value, decimals = 2) => {
                    const slider = document.getElementById(id + '-slider');
                    const display = document.getElementById(id + '-value');
                    if (slider && value !== undefined) {
                        slider.value = value;
                        if (display) display.textContent = value.toFixed(decimals);
                    }
                };

                // Read values from shader uniforms
                setSlider('frostiness', u.frostiness?.value);
                setSlider('inner-glow', u.innerGlowStrength?.value);
                setSlider('fresnel', u.fresnelIntensity?.value);
                setSlider('surface-noise', u.surfaceNoiseScale?.value);
                setSlider('inner-wisp', u.innerWispScale?.value);
                setSlider('surface-roughness', u.surfaceRoughness?.value);
                setSlider('noise-freq', u.noiseFrequency?.value);
                setSlider('texture-strength', u.textureStrength?.value);

                // Soul size from crystalInnerCoreBaseScale
                if (mascot.core3D.crystalInnerCoreBaseScale !== undefined) {
                    // Reverse the scale mapping: scale = 0.3 + size * 1.2 ‚Üí size = (scale - 0.3) / 1.2
                    const soulSize = (mascot.core3D.crystalInnerCoreBaseScale - 0.3) / 1.2;
                    setSlider('soul-size', Math.max(0, Math.min(1, soulSize)));
                }

                console.log('üíé Sliders initialized from engine values');
            }
        }, 100);

        // Emotion emoji mapping
        const emotionEmojis = {
            'neutral': 'üòê',
            'joy': 'üòä',
            'sadness': 'üò¢',
            'anger': 'üò†',
            'fear': 'üò®',
            'surprise': 'üò≤',
            'disgust': 'ü§¢',
            'love': '‚ù§Ô∏è',
            'calm': 'üòå',
            'excited': 'ü§©',
            'focused': 'üéØ',
            'suspicion': 'ü§®',
            'resting': 'üò¥',
            'euphoria': 'ü§Ø'
        };

        const emotionNames = {
            'neutral': 'Neutral',
            'joy': 'Joy',
            'sadness': 'Sadness',
            'anger': 'Anger',
            'fear': 'Fear',
            'surprise': 'Surprise',
            'disgust': 'Disgust',
            'love': 'Love',
            'calm': 'Calm',
            'excited': 'Excited',
            'focused': 'Focused',
            'suspicion': 'Suspicion',
            'resting': 'Resting',
            'euphoria': 'Euphoria'
        };

        // Update current emotion display
        function updateEmotionDisplay(emotion) {
            document.getElementById('current-emoji').textContent = emotionEmojis[emotion] || 'üíé';
            document.getElementById('current-name').textContent = emotionNames[emotion] || emotion;
        }

        // Geometry buttons
        document.querySelectorAll('[data-geometry]').forEach(btn => {
            btn.addEventListener('click', () => {
                const geometry = btn.dataset.geometry;
                mascot.morphTo(geometry);

                // Update active state
                document.querySelectorAll('[data-geometry]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Emotion buttons
        document.querySelectorAll('[data-emotion]').forEach(btn => {
            btn.addEventListener('click', () => {
                const emotion = btn.dataset.emotion;
                mascot.setEmotion(emotion);
                updateEmotionDisplay(emotion);

                // Update active state
                document.querySelectorAll('[data-emotion]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Visual Controls event handlers
        document.querySelectorAll('[data-action]').forEach(button => {
            button.addEventListener('click', (e) => {
                const action = e.target.dataset.action;
                if (!action) return;

                switch (action) {
                    case 'toggle-particles':
                        if (mascot.particlesEnabled) {
                            mascot.disableParticles();
                            e.target.classList.remove('active');
                        } else {
                            mascot.enableParticles();
                            e.target.classList.add('active');
                        }
                        break;

                    case 'toggle-glow':
                        if (mascot.core3D?.coreGlowEnabled !== false) {
                            mascot.core3D.setCoreGlowEnabled(false);
                            e.target.classList.remove('active');
                        } else {
                            mascot.core3D.setCoreGlowEnabled(true);
                            e.target.classList.add('active');
                        }
                        break;

                    case 'toggle-breathing':
                        if (mascot.breathingEnabled) {
                            mascot.disableBreathing();
                            e.target.classList.remove('active');
                        } else {
                            mascot.enableBreathing();
                            e.target.classList.add('active');
                        }
                        break;

                    case 'toggle-auto-rotate':
                        if (mascot.autoRotateEnabled) {
                            mascot.disableAutoRotate();
                            e.target.classList.remove('active');
                        } else {
                            mascot.enableAutoRotate();
                            e.target.classList.add('active');
                        }
                        break;
                }
            });
        });

        // Soul Animation toggle controls (crystal-specific)
        function setupToggle(id, onToggle, initialState = false) {
            const toggle = document.getElementById(id);
            if (!toggle) return;
            if (initialState) toggle.classList.add('active');

            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
                onToggle(toggle.classList.contains('active'));
            });
        }

        setupToggle('drift-toggle', (enabled) => {
            if (mascot.core3D?.setCrystalSoulEffects) {
                mascot.core3D.setCrystalSoulEffects({ driftEnabled: enabled });
            }
        }, true);

        setupToggle('shimmer-toggle', (enabled) => {
            if (mascot.core3D?.setCrystalSoulEffects) {
                mascot.core3D.setCrystalSoulEffects({ shimmerEnabled: enabled });
            }
        }, true);

        // Slider controls for crystal appearance
        function setupSlider(sliderId, valueId, onUpdate) {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(valueId);

            slider.addEventListener('input', () => {
                const value = parseFloat(slider.value);
                valueDisplay.textContent = value.toFixed(2);
                onUpdate(value);
            });
        }

        // Size sliders
        setupSlider('shell-size-slider', 'shell-size-value', (value) => {
            if (mascot.core3D?.setCrystalShellSize) {
                mascot.core3D.setCrystalShellSize(value);
            }
        });

        setupSlider('soul-size-slider', 'soul-size-value', (value) => {
            if (mascot.core3D?.setCrystalCoreSize) {
                mascot.core3D.setCrystalCoreSize(value);
            }
        });

        // Appearance sliders
        setupSlider('frostiness-slider', 'frostiness-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.frostiness) {
                mascot.core3D.customMaterial.uniforms.frostiness.value = value;
            }
        });

        setupSlider('inner-glow-slider', 'inner-glow-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.innerGlowStrength) {
                mascot.core3D.customMaterial.uniforms.innerGlowStrength.value = value;
            }
        });

        setupSlider('fresnel-slider', 'fresnel-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.fresnelIntensity) {
                mascot.core3D.customMaterial.uniforms.fresnelIntensity.value = value;
            }
        });

        setupSlider('sss-slider', 'sss-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.sssStrength) {
                mascot.core3D.customMaterial.uniforms.sssStrength.value = value;
            }
        });

        // SSS advanced sliders
        setupSlider('sss-thickness-bias-slider', 'sss-thickness-bias-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.sssThicknessBias) {
                mascot.core3D.customMaterial.uniforms.sssThicknessBias.value = value;
            }
        });

        setupSlider('sss-thickness-scale-slider', 'sss-thickness-scale-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.sssThicknessScale) {
                mascot.core3D.customMaterial.uniforms.sssThicknessScale.value = value;
            }
        });

        setupSlider('sss-curvature-slider', 'sss-curvature-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.sssCurvatureScale) {
                mascot.core3D.customMaterial.uniforms.sssCurvatureScale.value = value;
            }
        });

        setupSlider('sss-ambient-slider', 'sss-ambient-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.sssAmbient) {
                mascot.core3D.customMaterial.uniforms.sssAmbient.value = value;
            }
        });

        // SSS Material Presets
        const sssPresets = {
            jade: {
                sssStrength: 1.0,
                sssAbsorption: [2.5, 0.3, 1.8],
                sssScatterDistance: [0.15, 0.4, 0.2],
                sssThicknessBias: 0.3,
                sssThicknessScale: 0.7,
                sssCurvatureScale: 1.5,
                sssAmbient: 0.15
            },
            imperialJade: {
                sssStrength: 1.0,
                sssAbsorption: [3.0, 0.2, 2.5],
                sssScatterDistance: [0.1, 0.5, 0.15],
                sssThicknessBias: 0.25,
                sssThicknessScale: 0.8,
                sssCurvatureScale: 1.8,
                sssAmbient: 0.2
            },
            whiteJade: {
                sssStrength: 0.9,
                sssAbsorption: [0.3, 0.3, 0.4],
                sssScatterDistance: [0.5, 0.5, 0.45],
                sssThicknessBias: 0.35,
                sssThicknessScale: 0.6,
                sssCurvatureScale: 1.2,
                sssAmbient: 0.25
            },
            wax: {
                sssStrength: 1.0,
                sssAbsorption: [0.2, 0.8, 1.5],
                sssScatterDistance: [0.8, 0.5, 0.3],
                sssThicknessBias: 0.4,
                sssThicknessScale: 0.6,
                sssCurvatureScale: 1.0,
                sssAmbient: 0.2
            },
            skin: {
                sssStrength: 0.8,
                sssAbsorption: [0.4, 1.2, 1.8],
                sssScatterDistance: [0.6, 0.35, 0.25],
                sssThicknessBias: 0.3,
                sssThicknessScale: 0.5,
                sssCurvatureScale: 2.0,
                sssAmbient: 0.1
            },
            marble: {
                sssStrength: 0.6,
                sssAbsorption: [0.4, 0.45, 0.5],
                sssScatterDistance: [0.3, 0.28, 0.25],
                sssThicknessBias: 0.5,
                sssThicknessScale: 0.4,
                sssCurvatureScale: 0.8,
                sssAmbient: 0.15
            },
            milk: {
                sssStrength: 1.0,
                sssAbsorption: [0.1, 0.15, 0.3],
                sssScatterDistance: [1.0, 0.9, 0.7],
                sssThicknessBias: 0.5,
                sssThicknessScale: 0.5,
                sssCurvatureScale: 0.5,
                sssAmbient: 0.3
            },
            honey: {
                sssStrength: 0.9,
                sssAbsorption: [0.1, 0.5, 2.0],
                sssScatterDistance: [0.6, 0.4, 0.1],
                sssThicknessBias: 0.35,
                sssThicknessScale: 0.7,
                sssCurvatureScale: 1.2,
                sssAmbient: 0.2
            },
            crystal: {
                sssStrength: 0.4,
                sssAbsorption: [0.1, 0.1, 0.08],
                sssScatterDistance: [0.2, 0.22, 0.25],
                sssThicknessBias: 0.2,
                sssThicknessScale: 0.8,
                sssCurvatureScale: 1.5,
                sssAmbient: 0.1
            },
            roseQuartz: {
                sssStrength: 0.8,
                sssAbsorption: [0.3, 0.8, 0.7],
                sssScatterDistance: [0.45, 0.3, 0.32],
                sssThicknessBias: 0.3,
                sssThicknessScale: 0.7,
                sssCurvatureScale: 1.3,
                sssAmbient: 0.15
            }
        };

        function applySSSPreset(presetName) {
            const preset = sssPresets[presetName];
            if (!preset || !mascot.core3D?.customMaterial?.uniforms) return;

            const u = mascot.core3D.customMaterial.uniforms;

            // Apply preset values
            if (u.sssStrength) u.sssStrength.value = preset.sssStrength;
            if (u.sssAbsorption) u.sssAbsorption.value.set(...preset.sssAbsorption);
            if (u.sssScatterDistance) u.sssScatterDistance.value.set(...preset.sssScatterDistance);
            if (u.sssThicknessBias) u.sssThicknessBias.value = preset.sssThicknessBias;
            if (u.sssThicknessScale) u.sssThicknessScale.value = preset.sssThicknessScale;
            if (u.sssCurvatureScale) u.sssCurvatureScale.value = preset.sssCurvatureScale;
            if (u.sssAmbient) u.sssAmbient.value = preset.sssAmbient;

            // Update sliders to reflect new values
            const setSlider = (id, value) => {
                const slider = document.getElementById(id + '-slider');
                const display = document.getElementById(id + '-value');
                if (slider) slider.value = value;
                if (display) display.textContent = value.toFixed(2);
            };

            setSlider('sss', preset.sssStrength);
            setSlider('sss-thickness-bias', preset.sssThicknessBias);
            setSlider('sss-thickness-scale', preset.sssThicknessScale);
            setSlider('sss-curvature', preset.sssCurvatureScale);
            setSlider('sss-ambient', preset.sssAmbient);

            console.log(`üé® Applied SSS preset: ${presetName}`);
        }

        // SSS preset buttons
        document.querySelectorAll('[data-sss-preset]').forEach(btn => {
            btn.addEventListener('click', () => {
                const presetName = btn.dataset.sssPreset;
                applySSSPreset(presetName);

                // Update active state
                document.querySelectorAll('[data-sss-preset]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Noise pattern sliders
        setupSlider('surface-noise-slider', 'surface-noise-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.surfaceNoiseScale) {
                mascot.core3D.customMaterial.uniforms.surfaceNoiseScale.value = value;
            }
        });

        setupSlider('inner-wisp-slider', 'inner-wisp-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.innerWispScale) {
                mascot.core3D.customMaterial.uniforms.innerWispScale.value = value;
            }
        });

        setupSlider('surface-roughness-slider', 'surface-roughness-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.surfaceRoughness) {
                mascot.core3D.customMaterial.uniforms.surfaceRoughness.value = value;
            }
        });

        setupSlider('noise-freq-slider', 'noise-freq-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.noiseFrequency) {
                mascot.core3D.customMaterial.uniforms.noiseFrequency.value = value;
            }
        });

        setupSlider('texture-strength-slider', 'texture-strength-value', (value) => {
            if (mascot.core3D?.customMaterial?.uniforms?.textureStrength) {
                mascot.core3D.customMaterial.uniforms.textureStrength.value = value;
            }
        });

        setupSlider('drift-speed-slider', 'drift-speed-value', (value) => {
            if (mascot.core3D?.setCrystalSoulEffects) {
                mascot.core3D.setCrystalSoulEffects({ driftSpeed: value });
            }
        });

        setupSlider('shimmer-speed-slider', 'shimmer-speed-value', (value) => {
            if (mascot.core3D?.setCrystalSoulEffects) {
                mascot.core3D.setCrystalSoulEffects({ shimmerSpeed: value });
            }
        });

        // Initial emotion display
        updateEmotionDisplay('neutral');

        // Apply initial slider values after mascot loads
        setTimeout(() => {
            // Crystal appearance
            if (mascot.core3D?.customMaterial?.uniforms) {
                mascot.core3D.customMaterial.uniforms.frostiness.value = 0.10;
                mascot.core3D.customMaterial.uniforms.innerGlowStrength.value = 0.20;
                mascot.core3D.customMaterial.uniforms.fresnelIntensity.value = 0.30;
                mascot.core3D.customMaterial.uniforms.surfaceNoiseScale.value = 1.50;
                mascot.core3D.customMaterial.uniforms.innerWispScale.value = 0.60;
                mascot.core3D.customMaterial.uniforms.surfaceRoughness.value = 0.15;
                mascot.core3D.customMaterial.uniforms.noiseFrequency.value = 1.33;
                mascot.core3D.customMaterial.uniforms.textureStrength.value = 0.55;
            }
            console.log('üíé Applied default crystal settings');
        }, 500);
    </script>
</body>
</html>
